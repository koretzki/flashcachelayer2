cscope 15 $HOME/disksim-4.0-fcl               0002221882
	@/Users/ysoh/disksim-4.0-fcl/diskmodel/convert.c

33 
	~"dm_c⁄fig.h
"

34 
	~"dm.h
"

40 
INLINE
 
dm_time_t
 
	$dm_time_dtoi
(
t
)

43  (
dm_time_t
)(
t
 * ()(
DM_TIME_MSEC
));

44 
	}
}

46 
INLINE
 
	$dm_time_ôod
(
dm_time_t
 
t
)

48  ()
t
 / ()(
DM_TIME_MSEC
);

49 
	}
}

57 
INLINE
 
	$dm_™gÀ_ôod
(
dm_™gÀ_t
 
a
)

60  ()
a
 / ()(()1 << 32);

61 
	}
}

63 
INLINE
 
dm_™gÀ_t
 
	$dm_™gÀ_dtoi
(
a
)

65 if(
a
 > 1.0)

66 
a
 -= ()a;

68  (
dm_™gÀ_t
)(
a
 * ()(()1 << 32));

69 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/dm.h

33 #i‚de‡
_DM_DM_H


34 
	#_DM_DM_H


	)

36 #ifde‡
__˝lu•lus


40 #ifde‡
_DM_SOURCE


41 
	~"dm_c⁄fig.h
"

43 
	~<diskmodñ/dm_ty≥s.h
>

48 
dm_disk_if
;

51 
dm_œyout_if
;

54 
dm_mech_if
;

63 
dm_time_t
 
dm_time_dtoi
();

64 
dm_time_ôod
(
dm_time_t
);

69 
	sdm_pbn
 {

70 
cyl
;

71 
hód
;

72 
£˘‹
;

76 
dm_to_pbn
(
dm_pbn_t
, 
dm_pbn
 *);

79 
dm_‰om_pbn
(
dm_pbn
 *, 
dm_pbn_t
 *);

83 
	sdm_mech_°©e
 {

84 
cyl
;

85 
hód
;

88 
dm_™gÀ_t
 
thëa
;

93 
dm_™gÀ_ôod
(
dm_™gÀ_t
);

94 
dm_™gÀ_t
 
dm_™gÀ_dtoi
();

99 
DM_SLIPPED
 = -1,

100 
DM_REMAPPED
 = -2,

101 
DM_OK
 = -3,

102 
DM_NX
 = -4

104 } 
	tdm_±ﬁ_ªsu…_t
;

108 
DM_SU_SECTORS
 = 0,

109 
DM_SU_REVOLUTIONS


110 } 
	tdm_skew_unô_t
;

114 
MAP_NONE
 = 0,

115 
MAP_IGNORESPARING
 = 1,

116 
MAP_ZONEONLY
 = 2,

117 
MAP_ADDSLIPS
 = 3,

118 
MAP_FULL
 = 4,

119 
MAP_FROMTRACE
 = 5,

120 
MAP_AVGCYLMAP
 = 6

121 } 
	tdm_œyout_m≠ty≥
;

122 
	#DM_MAXMAPTYPE
 
MAP_AVGCYLMAP


	)

157 
	sdm_œyout_z⁄e
 {

158 
•t
;

160 
lbn_low
;

161 
lbn_high
;

163 
cyl_low
;

164 
cyl_high
;

170 
	sdm_œyout_if
 {

175 
dm_±ﬁ_ªsu…_t


176 (*
dm_å™¶©e_…›
)(
dm_disk_if
 *,

177 
lbn
,

178 
dm_œyout_m≠ty≥
,

179 
dm_pbn
 *
ªsu…
,

180 *
ªm≠£˘‹
);

182 
dm_±ﬁ_ªsu…_t


183 (*
dm_å™¶©e_…›_0t
)(
dm_disk_if
 *,

184 
lbn
,

185 
dm_œyout_m≠ty≥
,

186 
dm_pbn
 *
ªsu…
,

187 *
ªm≠£˘‹
);

192 
dm_±ﬁ_ªsu…_t


193 (*
dm_å™¶©e_±ﬁ
)(
dm_disk_if
 *,

194 
dm_pbn
 *
p
,

195 *
ªm≠£˘‹
);

197 
dm_±ﬁ_ªsu…_t


198 (*
dm_å™¶©e_±ﬁ_0t
)(
dm_disk_if
 *,

199 
dm_pbn
 *
p
,

200 *
ªm≠£˘‹
);

205 (*
dm_gë_£˘‹s_lbn
)(
dm_disk_if
 *
d
,

206 
lbn
);

210 (*
dm_gë_£˘‹s_pbn
)(
dm_disk_if
 *
d
,

211 
dm_pbn
 *);

220 
dm_±ﬁ_ªsu…_t


221 (*
dm_gë_åack_bound¨õs
)(
dm_disk_if
 *
d
,

222 
dm_pbn
 *,

223 *
fú°_lbn
,

224 *
œ°_lbn
,

225 *
ªm≠£˘‹
);

231 
dm_±ﬁ_ªsu…_t


232 (*
dm_£ek_di°™˚
)(
dm_disk_if
 *,

233 
°¨t_lbn
,

234 
de°_lbn
);

238 
dm_™gÀ_t


239 (*
dm_pbn_skew
)(
dm_disk_if
 *,

240 
dm_pbn
 *);

243 
dm_™gÀ_t


244 (*
dm_gë_åack_zîﬁ
)(
dm_disk_if
 *,

245 
dm_mech_°©e
 *);

255 (*
dm_c⁄vît_±ﬂ
)(
dm_disk_if
 *,

256 
dm_pbn
 *,

257 
dm_™gÀ_t
 *
°¨t
,

258 
dm_™gÀ_t
 *
width
);

265 
dm_±ﬁ_ªsu…_t


266 (*
dm_c⁄vît_©›
)(
dm_disk_if
 *,

267 
dm_mech_°©e
 *,

268 
dm_pbn
 *);

273 
dm_™gÀ_t


274 (*
dm_gë_£˘‹_width
)(
dm_disk_if
 *,

275 
dm_pbn
 *
åack
,

276 
num
);

279 
dm_™gÀ_t


280 (*
dm_lbn_off£t
)(
dm_disk_if
 *,

281 
lbn1
,

282 
lbn2
);

286 (*
dm_m¨shÆed_Àn
)(
dm_disk_if
 *);

288 *(*
dm_m¨shÆ
)(
dm_disk_if
 *, *);

292 (*
dm_gë_numz⁄es
)(
dm_disk_if
 *);

297 (*
dm_gë_z⁄e
)(
dm_disk_if
 *, 
n
, 
dm_œyout_z⁄e
 *
z
);

303 
dm_±ﬁ_ªsu…_t


304 (*
dm_de„˘_cou¡
)(
dm_disk_if
 *
d
,

305 
dm_pbn
 *
åack
,

306 *
ªsu…
);

337 
	sdm_mech_ac˘imes
 {

338 
dm_time_t
 
£ektime
;

339 
dm_time_t
 
öôül_œãncy
;

340 
dm_time_t
 
öôül_x„r
;

341 
dm_time_t
 
addl_œãncy
;

342 
dm_time_t
 
addl_x„r
;

345 
	sdm_mech_if
 {

351 
dm_time_t
(*
dm_£ek_time
)(
dm_disk_if
 *,

352 
dm_mech_°©e
 *
°¨t_åack
,

353 
dm_mech_°©e
 *
íd_åack
,

354 
rw
);

360 (*
dm_ac˚ss_block
)(
dm_disk_if
 *,

361 
dm_mech_°©e
 *
öôül
,

362 
°¨t
,

363 
Àn
,

364 
immed
);

379 
dm_time_t
(*
dm_œãncy
)(
dm_disk_if
 *,

380 
dm_mech_°©e
 *
öôül
,

381 
°¨t
,

382 
Àn
,

383 
immed
,

384 
dm_time_t
 *
addtﬁ©ícy
);

395 
dm_time_t
(*
dm_œãncy_£q
)(
dm_disk_if
 *,

396 
dm_mech_°©e
 *
öôül
,

397 
°¨t
,

398 
Àn
,

399 
immed
,

400 
dm_time_t
 *
addtﬁ©ícy
);

406 
dm_time_t
(*
dm_pos_time
)(
dm_disk_if
 *,

407 
dm_mech_°©e
 *
öôül
,

408 
dm_pbn
 *
°¨t
,

409 
Àn
,

410 
rw
,

411 
immed
,

412 
dm_mech_ac˘imes
 *
bªakdown
);

425 
dm_time_t
(*
dm_ac˘ime
)(
dm_disk_if
 *,

426 
dm_mech_°©e
 *
öôül_°©e
,

427 
dm_pbn
 *
°¨t
,

428 
Àn
,

429 
rw
,

430 
immed
,

431 
dm_mech_°©e
 *
ªsu…_°©e
,

432 
dm_mech_ac˘imes
 *
bªakdown
);

436 
dm_time_t
(*
dm_rŸtime
)(
dm_disk_if
 *,

437 
dm_™gÀ_t
 
begö
,

438 
dm_™gÀ_t
 
íd
);

444 
dm_time_t
(*
dm_x„πime
)(
dm_disk_if
 *
d
,

445 
dm_mech_°©e
 *,

446 
Àn
);

450 
dm_time_t
(*
dm_hódswôch_time
)(
dm_disk_if
 *,

451 
h1
,

452 
h2
);

457 
dm_™gÀ_t
(*
dm_rŸ©e
)(
dm_disk_if
 *,

458 
dm_time_t
 *
time
);

461 
dm_time_t
(*
dm_≥riod
)(
dm_disk_if
 *);

466 (*
dm_øndomize_Ωm
)(
dm_disk_if
 *);

469 (*
dm_m¨shÆed_Àn
)(
dm_disk_if
 *);

473 *(*
dm_m¨shÆ
)(
dm_disk_if
 *, *);

479 
	sdm_disk_if
 {

481 
dm_cyls
;

484 
dm_surÁ˚s
;

485 
dm_£˘‹s
;

488 
dm_œyout_if
 *
œyout
;

489 
dm_mech_if
 *
mech
;

499 
Õ_block
;

502 
dm_mech_if
 *(*
	tdm_mech_lﬂdî_t
)(
	tÕ_block
 *, 
	tdm_disk_if
 *);

503 
dm_œyout_if
 *(*
	tdm_œyout_lﬂdî_t
)(
	tÕ_block
 *, 
	tdm_disk_if
 *);

506 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/dm_config.h

33 #i‚de‡
_DM_CONFIG_H


34 
	#_DM_CONFIG_H


	)

36 #ifde‡
_DM_SOURCE


37 
	~"dm_ty≥s.h
"

39 
	~<diskmodñ/dm_ty≥s.h
>

42 
	~<libddbg/libddbg.h
>

46 #ifde‡
WIN32


47 
	#INLINE


	)

49 
	#INLINE
 
ölöe


	)

54 #ifde‡
_DISKMODEL_FREEBSD


55 
	#_KERNEL


	)

56 
	~<sys/ty≥s.h
>

57 
	~<sys/mÆloc.h
>

58 
	#mÆloc
(
x
Ë
	`mÆloc
((x), 
M_DEVBUF
, 
M_WAITOK
)

	)

60 
	~<°dlib.h
>

63 
	~<°rög.h
>

65 
uöt32_t
 
sqπ32
(uint32_t);

66 
uöt64_t
 
sqπ64
(uint64_t);

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/dm_load.c

33 
	~"dm.h
"

35 
	~<lib∑øm/lib∑øm.h
>

36 
	~<lib∑øm/bôve˘‹.h
>

37 
	~<°rög.h
>

38 
	~<°dlib.h
>

40 
	~"moduÀs/moduÀs.h
"

41 
	~"moduÀs/dm_disk_∑øm.h
"

43 
	~"m¨shÆ.h
"

45 
dm_disk_if
 *

46 
	$dm_disk_lﬂd∑øms
(
Õ_block
 *
b
, *
junk
)

48 
dm_disk_if
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

52 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
dm_disk_mod
);

54  
ªsu…
;

55 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/dm_testsuite.c

33 
	~"dm.h
"

34 
	~"moduÀs/moduÀs.h
"

36 
	~<lib∑øm/lib∑øm.h
>

37 
	~<libddbg/libddbg.h
>

39 
	~<°dio.h
>

43 
	$œyout_ã°_sim∂e
(
dm_disk_if
 *
d
) {

44 
c
, 
lbn
, 
cou¡
 = 0, 
ru∆bn
 = 0;

45 
dm_pbn
 
pbn
, 
åkpbn
 = {0,0,0};

46 
	`¥ötf
("gŸá dm_disk wôh %d se˘‹s!\n", 
d
->
dm_£˘‹s
);

48 
c
 = 0; c < 
d
->
dm_£˘‹s
; c ++) {

49 
lbn2
;

50 
dm_™gÀ_t
 
skew
, 
zîﬁ
;

51 
dm_mech_°©e
 
åack
;

53 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
c
, 
MAP_FULL
, &
pbn
, 0);

54 
lbn2
 = 
d
->
œyout
->
	`dm_å™¶©e_±ﬁ
(d, &
pbn
, 0);

56 if(
c
 !
lbn2
) {

57 
	`¥ötf
("***Åest_0_t: %8d -> (%8d, %3d, %4d) -> %8d\n",

58 
c
, 
pbn
.
cyl
,Öbn.
hód
,Öbn.
£˘‹
, 
lbn2
);

61 if((
lbn
 > 0)

62 && (
åkpbn
.
hód
 =
pbn
.head)

63 && (
åkpbn
.
cyl
 =
pbn
.cyl)

64 && ((
åkpbn
.
£˘‹
+
cou¡
Ë=
pbn
.sector)) { count++; }

66 
	`¥ötf
("»%d %d %d %d %d\n", 
ru∆bn
, 
åkpbn
.
cyl
,Årkpbn.
hód
,Årkpbn.
£˘‹
, 
cou¡
);

67 
ru∆bn
 = 
c
;

68 
åkpbn
 = 
pbn
;

69 
cou¡
 = 1;

75 
	}
}

78 
	$ã°_rŸ©e
(
dm_disk_if
 *
d
) {

79 
t
;

80 
dm_™gÀ_t
 
a
;

81 
dm_time_t
 
t2
;

82 
t
 = 0.0;Å < 20.0;Å += 0.1) {

83 
t2
 = 
	`dm_time_dtoi
(
t
);

84 
a
 = 
d
->
mech
->
	`dm_rŸ©e
(d, &
t2
);

85 
	`¥ötf
("timê%f,ángÀ %f\n", 
t
, 
	`dm_™gÀ_ôod
(
a
));

88 
	}
}

90 
	$œyout_ã°_skew
(
dm_disk_if
 *
d
) {

91 
c
;

92 
dm_™gÀ_t
 
skew
;

93 
™gÀ
;

94 
dm_pbn
 
pbn
;

96 
c
 = 6281; c <= 6704; c++) {

97 
pbn
.
cyl
 = 
c
;

98 
pbn
.
hód
 = 3;

99 
pbn
.
£˘‹
 = 250;

101 
d
->
œyout
->
	`dm_c⁄vît_±ﬂ
(d, &
pbn
, &
skew
, 0);

102 
™gÀ
 = 
	`dm_™gÀ_ôod
(
skew
);

103 
	`¥ötf
("ptoa (%d,%d,%d): %f, %u\n",

104 
pbn
.
cyl
,Öbn.
hód
,Öbn.
£˘‹
, 
™gÀ
, 
skew
);

107 
c
 = 0; c < 1000000000; c += 10000000) {

108 
dm_mech_°©e
 
a
;

109 
a
.
hód
 = 3;

110 
a
.
cyl
 = 0;

111 
a
.
thëa
 = 
c
;

112 
d
->
œyout
->
	`dm_c⁄vît_©›
(d, &
a
, &
pbn
);

113 
	`¥ötf
("atop (%d,%d,%d) -> (%d,%d,%d)\n",

114 
a
.
hód
,á.
cyl
,á.
thëa
, 
pbn
.hód,Öbn.cyl,Öbn.
£˘‹
);

117 
	}
}

121 
	$mech_ã°_po°ime1
(
dm_disk_if
 *
d
) {

122 
dm_mech_°©e
 
begö
, 
íd
;

123 
dm_time_t
 
ªsu…
;

124 
time
;

125 
c
;

127 
begö
.
hód
 = 0;

128 
begö
.
cyl
 = 0;

129 
begö
.
thëa
 = 0;

131 
íd
.
hód
 = 0;

132 
íd
.
thëa
 = 0;

134 
c
 = 0; c < 1000; c++) {

135 
íd
.
cyl
 = 
c
;

137 
ªsu…
 = 
d
->
mech
->
	`dm_£ek_time
(d, &
begö
, &
íd
, 0);

138 
time
 = 
	`dm_time_ôod
(
ªsu…
);

139 
	`¥ötf
("cy»swôch %d: %Œd, %e\n", 
c
, 
ªsu…
, 
time
);

141 
	}
}

144 
	$mech_ã°_po°ime2
(
dm_disk_if
 *
d
) {

145 
dm_mech_°©e
 
begö
, 
íd
;

146 
dm_time_t
 
ªsu…
;

147 
time
;

149 
begö
.
hód
 = 0;

150 
begö
.
cyl
 = 0;

151 
begö
.
thëa
 = 0;

153 
íd
.
hód
 = 1;

154 
íd
.
cyl
 = 0;

155 
íd
.
thëa
 = 0;

157 
ªsu…
 = 
d
->
mech
->
	`dm_£ek_time
(d, &
begö
, &
íd
, 0);

158 
time
 = 
	`dm_time_ôod
(
ªsu…
);

159 
	`¥ötf
("sögÀ-hód swôch: %Œd, %e\n", 
ªsu…
, 
time
);

160 
	}
}

162 
	$mech_ã°_x„πime
(
dm_disk_if
 *
d
) {

163 
£˘‹s
;

164 
dm_mech_°©e
 
m
;

165 
dm_time_t
 
x„πime
;

166 
time
;

168 
m
.
hód
 = 0;

169 
m
.
cyl
 = 0;

170 
m
.
thëa
 = 0;

173 
£˘‹s
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_lbn
(d, 0);

174 
£˘‹s
 >>= 1;

177 
x„πime
 = 
d
->
mech
->
	`dm_x„πime
(d, &
m
, 
£˘‹s
);

178 
time
 = 
	`dm_time_ôod
(
x„πime
);

179 
	`¥ötf
("hÆf-åack x„r: %Œd, %e\n", 
x„πime
, 
time
);

180 
	}
}

182 
	$mech_ã°_ac˚ss
(
dm_disk_if
 *
d
) {

185 
£˘‹s
;

186 
dm_mech_°©e
 
m
;

187 
dm_time_t
 
ªsu…
;

188 
dm_pbn
 
°¨çbn
;

189 
time
;

191 
m
.
hód
 = 0;

192 
m
.
cyl
 = 0;

193 
m
.
thëa
 = 0;

197 
£˘‹s
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_lbn
(d, 0);

198 
£˘‹s
 /= 2;

200 
°¨çbn
.
hód
 = 0;

201 
°¨çbn
.
cyl
 = 0;

202 
°¨çbn
.
£˘‹
 = 0;

207 
time
 = 
	`dm_time_ôod
(
ªsu…
);

210 
	`¥ötf
("hÆf-åackác˚ss: %Œd, %e\n", 
ªsu…
, 
time
);

211 
	}
}

213 
	$mech_pos_vs_acc
(
dm_disk_if
 *
d
) {

215 
£˘‹s
;

216 
dm_mech_°©e
 
m
;

217 
dm_time_t
 
po°ime
, 
ac˘ime
;

218 
dm_pbn
 
°¨çbn
;

219 
time
;

220 
dm_mech_ac˘imes
 
bacc
, 
bpos
;

222 
m
.
hód
 = 0;

223 
m
.
cyl
 = 0;

224 
m
.
thëa
 = 0;

228 
£˘‹s
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_lbn
(d, 0);

229 
£˘‹s
 /= 2;

231 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 8955874, 
MAP_FULL
, &
°¨çbn
, 0);

232 
£˘‹s
 = 1;

234 
	`bzîo
(&
bacc
, (bacc));

235 
	`bzîo
(&
bpos
, (bpos));

237 
ac˘ime
 = 
d
->
mech
->
	`dm_ac˘ime
(d, &
m
, &
°¨çbn
, 
£˘‹s
, 0, 0, 0, &
bacc
);

238 
po°ime
 = 
d
->
mech
->
	`dm_pos_time
(d, &
m
, &
°¨çbn
, 
£˘‹s
, 0, 0, &
bpos
);

241 
	`¥ötf
("hÆf-åackÖos: %Œd,ácc: %Œd\n", 
po°ime
, 
ac˘ime
);

242 
	}
}

247 
	$mech_ã°_ac˚ss2
(
dm_disk_if
 *
d
) {

249 
£˘‹s
;

250 
dm_mech_°©e
 
m
;

251 
dm_time_t
 
ªsu…
;

252 
dm_pbn
 
°¨çbn
;

253 
time
;

255 
m
.
hód
 = 0;

256 
m
.
cyl
 = 0;

257 
m
.
thëa
 = 4282107939;

260 
£˘‹s
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_lbn
(d, 0);

261 
£˘‹s
 >>= 1;

263 
°¨çbn
.
hód
 = 1;

264 
°¨çbn
.
cyl
 = 0;

265 
°¨çbn
.
£˘‹
 = 0;

268 
ªsu…
 = 
d
->
mech
->
	`dm_ac˘ime
(d, &
m
, &
°¨çbn
, 
£˘‹s
, 0, 0, 0, 0);

269 
time
 = 
	`dm_time_ôod
(
ªsu…
);

272 
	`¥ötf
("ac˚ss2 (åack swôch): %Œd, %e\n", 
ªsu…
, 
time
);

273 
	}
}

276 
	$mech_ã°_ac˚ss3
(
dm_disk_if
 *
d
) {

278 
£˘‹s
;

279 
dm_mech_°©e
 
m
;

280 
dm_time_t
 
ªsu…
;

281 
dm_pbn
 
°¨çbn
;

282 
time
;

284 
m
.
hód
 = 0;

285 
m
.
cyl
 = 0;

286 
m
.
thëa
 = 0;

289 
£˘‹s
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_lbn
(d, 0);

290 
£˘‹s
 >>= 1;

292 
°¨çbn
.
hód
 = 0;

293 
°¨çbn
.
cyl
 = 1;

294 
°¨çbn
.
£˘‹
 = 0;

297 
ªsu…
 = 
d
->
mech
->
	`dm_ac˘ime
(d, &
m
, &
°¨çbn
, 
£˘‹s
, 0, 0, 0, 0);

298 
time
 = 
	`dm_time_ôod
(
ªsu…
);

301 
	`¥ötf
("ac˚ss3 (cy»swôch): %Œd, %e\n", 
ªsu…
, 
time
);

302 
	}
}

305 
	$mech_ã°_ac˚ss_big
(
dm_disk_if
 *
d
) {

307 
c
,
h
;

308 
£˘‹s
;

309 
dm_mech_°©e
 
m
 = {0,0,0}, 
ãmpm
, 
ªsu…°©e
 = {0,0,0};

310 
dm_time_t
 
ªsu…
;

311 
dm_pbn
 
°¨çbn
;

312 
time
;

313 
åacks
, 
lbn
 = 0;

317 
åacks
 = 10 * 
d
->
dm_surÁ˚s
;

318 
c
 = 0; c < 
åacks
; c++) {

319 
£˘‹s
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_lbn
(d, 
c
);

320 
lbn
 = 
c
 * 
£˘‹s
;

321 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
lbn
, 
MAP_FULL
, &
°¨çbn
, 0);

323 
ªsu…
 = 
d
->
mech
->
	`dm_ac˘ime
(d,

324 &
m
,

325 &
°¨çbn
,

329 &
ªsu…°©e
,

331 
time
 = 
	`dm_time_ôod
(
ªsu…
);

333 
	`¥ötf
("ac˚s†lb¿%d (%d,%d,%dË-> %‡", 
lbn
,

334 
°¨çbn
.
cyl
, sèπpbn.
hód
, sèπpbn.
£˘‹
, 
time
);

346 
m
 = 
ªsu…°©e
;

352 
	`¥ötf
("%f\n\n\n", 
	`dm_™gÀ_ôod
(
m
.
thëa
));

354 
	}
}

356 
	$mech_ã°_ac˚ss_immed
(
dm_disk_if
 *
d
) {

359 
c
,
h
;

360 
£˘‹s
;

361 
dm_mech_°©e
 
m
 = {0,0,0}, 
ãmpm
, 
ªsu…°©e
 = {0,0,0};

362 
dm_time_t
 
ªsu…
;

363 
dm_pbn
 
°¨çbn
, 
tmµbn
;

364 
time
;

365 
åacks
, 
lbn
 = 0;

369 
åacks
 = 10 * 
d
->
dm_surÁ˚s
;

371 
c
 = 0; c < 
åacks
; c++) {

372 
Àn
;

373 
£˘‹s
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_lbn
(d, 
c
);

374 
lbn
 = 
c
 * 
£˘‹s
;

375 
Àn
 = 
£˘‹s
 / 2;

377 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
lbn
, 
MAP_FULL
, &
°¨çbn
, 0);

379 
m
.
hód
 = 
°¨çbn
.head;

380 
m
.
cyl
 = 
°¨çbn
.cyl;

382 
m
.
thëa
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
°¨çbn
);

383 
m
.
thëa
 +
	`dm_™gÀ_dtoi
(()(
Àn
 / 2Ë/ ()
£˘‹s
);

387 
ªsu…
 = 
d
->
mech
->
	`dm_ac˘ime
(d,

388 &
m
,

389 &
°¨çbn
,

390 
Àn
,

393 &
ªsu…°©e
,

395 
time
 = 
	`dm_time_ôod
(
ªsu…
);

397 
	`¥ötf
("access_immed (%d, %d) -- %f\n\n\n",

398 
m
.
hód
, m.
cyl
, 
time
);

402 
	}
}

404 
	$mech_ã°_£ek
(
dm_disk_if
 *
d
) {

405 
c
;

406 
dm_mech_°©e
 
s1
 = {0,0,0}, 
s2
;

408 
c
 = 0; c < 1000; c++) {

409 
dm_time_t
 
n£cs
;

410 
t
;

411 
s2
.
cyl
 = 
c
;

412 
n£cs
 = 
d
->
mech
->
	`dm_£ek_time
(d, &
s1
, &
s2
, 0);

413 
t
 = 
	`dm_time_ôod
(
n£cs
);

414 
	`¥ötf
("£ek di° %dÅook %f\n", 
c
, 
t
);

416 
	}
}

419 
	$œyout_ã°_åackbound
(
dm_disk_if
 *
d
) {

420 
c
;

421 
lbn
 = 55000;

423 
c
 = 0; c < 1000; c++) {

424 
l1
, 
l2
;

425 
dm_pbn
 
pbn
;

426 
ªm≠£˘‹
 = 0;

428 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
lbn
, 
MAP_FULL
, &
pbn
, &
ªm≠£˘‹
);

430 
d
->
œyout
->
	`dm_gë_åack_bound¨õs
(d, &
pbn
, &
l1
, &
l2
, &
ªm≠£˘‹
);

432 
	`¥ötf
("ã°_åackbound: %d -> (%d, %dË(%d)\n", 
lbn
, 
l1
, 
l2
, 
ªm≠£˘‹
);

433 
	`ddbg_as£π
((
l1
 <
lbn
Ë&& (lb¿<
l2
));

435 
lbn
 +(
d
->
œyout
->
	`dm_gë_£˘‹s_lbn
(d,Übn) + 13);

437 
	}
}

439 
	$weúd_disksim_ã°
(
dm_disk_if
 *
d
) {

440 
dm_mech_°©e
 
°¨t°©e
 = { 446, 1, 4221625600 };

441 
dm_time_t
 
n£cs1
, 
n£cs2
;

442 
åack°¨t1
, 
åack°¨t2
;

444 
n£cs1
 = 
d
->
mech
->
	`dm_œãncy
(d, &
°¨t°©e
, 145, 334, 1, 0);

445 
åack°¨t1
 = 
d
->
mech
->
	`dm_ac˚ss_block
(d, &
°¨t°©e
, 145, 334, 1);

446 
n£cs2
 = 
d
->
mech
->
	`dm_œãncy
(d, &
°¨t°©e
, 
åack°¨t1
, 1, 0, 0);

447 
åack°¨t2
 = 
d
->
mech
->
	`dm_ac˚ss_block
(d, &
°¨t°©e
, 
åack°¨t1
, 1, 0);

449 
	`¥ötf
("%Œd %d %Œd %d\n", 
n£cs1
, 
åack°¨t1
, 
n£cs2
, 
åack°¨t2
);

451 
	}
}

453 
	$ã°_lbn_off£t
(
dm_disk_if
 *
d
) {

454 
d™gÀ
;

455 
dm_™gÀ_t
 
ªsu…
;

456 
c
;

458 
c
 = 0; c < 688; c++) {

459 
ªsu…
 = 
d
->
œyout
->
	`dm_lbn_off£t
(d, 0, 
c
);

460 
d™gÀ
 = 
	`dm_™gÀ_ôod
(
ªsu…
);

461 
	`¥ötf
("%8d %8d %20.10g\n", 0, 
c
, 
d™gÀ
);

464 
c
 = 0; c < 17966953; c += 10000) {

465 
ªsu…
 = 
d
->
œyout
->
	`dm_lbn_off£t
(d, 0, 
c
);

466 
d™gÀ
 = 
	`dm_™gÀ_ôod
(
ªsu…
);

467 
	`¥ötf
("%8d %8d %20.10g\n", 0, 
c
, 
d™gÀ
);

469 
	}
}

472 
	$ã°_bªakdown
(
dm_disk_if
 *
d
) {

473 
dm_mech_ac˘imes
 
bªakdown
;

474 
dm_time_t
 
ªsu…
;

475 
dm_time_t
 
checkªs
;

476 
dm_mech_°©e
 
hÆf
 = {0,0, 2000000000};

477 
dm_pbn
 
°¨t
 = { 0, 0, 0 };

479 
ªsu…
 = 
d
->
mech
->
	`dm_pos_time
(d, &
hÆf
, &
°¨t
, 300, 1, 0, &
bªakdown
);

480 
checkªs
 = 
bªakdown
.
£ektime
 + bªakdown.
öôül_œãncy
 +

481 
bªakdown
.
öôül_x„r
 + bªakdown.
addl_œãncy
 + bªakdown.
addl_x„r
;

483 
ªsu…
 = 
d
->
mech
->
	`dm_ac˘ime
(d, &
hÆf
, &
°¨t
, 3000, 1, 0, 0, &
bªakdown
);

484 
checkªs
 = 
bªakdown
.
£ektime
 + bªakdown.
öôül_œãncy
 +

485 
bªakdown
.
öôül_x„r
 + bªakdown.
addl_œãncy
 + bªakdown.
addl_x„r
;

488 
	}
}

490 
	$ã°_0t
(
dm_disk_if
 *
d
) {

491 
lbn
;

492 
dm_pbn
 
pbn
;

494 
lbn
 = 0;Übn < 1000000;Übn++) {

495 
lbn2
;

496 
d
->
œyout
->
	`dm_å™¶©e_…›_0t
(d, 
lbn
, 
MAP_FULL
, &
pbn
, 0);

497 
lbn2
 = 
d
->
œyout
->
	`dm_å™¶©e_±ﬁ_0t
(d, &
pbn
, 0);

498 if(
lbn
 !
lbn2
) {

499 
	`¥ötf
("***Åest_0_t: %8d -> (%8d, %3d, %4d) -> %8d\n",

500 
lbn
, 
pbn
.
cyl
,Öbn.
hód
,Öbn.
£˘‹
, 
lbn2
);

503 
	`¥ötf
("%d <-> (%d,%d,%dË\n", 
lbn
, 
pbn
.
cyl
,Öbn.
hód
,Öbn.
£˘‹
);

506 
	}
}

509 
	$ã°_1åack
(
dm_disk_if
 *
d
) {

510 
dm_mech_°©e
 
s
 = {0,0,0};

511 
dm_pbn
 
p
;

512 
dm_time_t
 
ªsu…
;

513 
dm_mech_ac˘imes
 
b
;

515 
p
.
hód
 = 1;

516 
p
.
£˘‹
 = 63;

517 
p
.
cyl
 = 0;

519 
ªsu…
 = 
d
->
mech
->
	`dm_pos_time
(d, &
s
, &
p
, 1, 1, 0, &
b
);

521 
	}
}

524 
	$ã°_skew2
(
dm_disk_if
 *
d
) {

525 
dm_™gÀ_t
 
ªsu…
;

526 
dm_pbn
 
pbn
;

527 
d™gÀ
;

528 
i
;

531 
i
 = 0; i < 
d
->
dm_£˘‹s
; i++) {

532 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
i
, 
MAP_FULL
, &
pbn
, 0);

533 
ªsu…
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
pbn
);

534 
d™gÀ
 = 
	`dm_™gÀ_ôod
(
ªsu…
);

535 
	`¥ötf
("lb¿%d -> %f\n", 
i
, 
d™gÀ
);

538 
	}
}

540 
	$ã°_g2_skew
(
dm_disk_if
 *
d
) {

541 
dm_™gÀ_t
 
a1
, 
a2
;

542 
i
;

543 
dm_pbn
 
p
 = {0,0,0};

545 
i
 = 0; i < 1000000; i++) {

546 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
i
, 
MAP_FULL
, &
p
, 0);

547 
a1
 = 
	`pbn_skew
(
d
, &
p
);

548 
a2
 = 
	`pbn_skew_√w
(
d
, &
p
);

551 
	`¥ötf
("(%d,%d,%d) -> %lf %lf\n",

552 
p
.
cyl
,Ö.
hód
,Ö.
£˘‹
,

553 
	`dm_™gÀ_ôod
(
a1
), dm_™gÀ_ôod(
a2
));

557 
	}
}

559 
	$ã°_z⁄efoo
(
dm_disk_if
 *
d
) {

560 
i
;

561 
nz
 = 
d
->
œyout
->
	`dm_gë_numz⁄es
(d);

562 
dm_œyout_z⁄e
 
z
;

564 
	`¥ötf
("gŸ %d z⁄es\n", 
nz
);

565 
i
 = 0; i < 
nz
; i++) {

566 
d
->
œyout
->
	`dm_gë_z⁄e
(d, 
i
, &
z
);

567 
	`¥ötf
("zone %2d: %d (%d,%d) (%d,%d)\n",

568 
i
, 
z
.
•t
,

569 
z
.
cyl_low
, z.
cyl_high
,

570 
z
.
lbn_low
, z.
lbn_high
);

574 
	}
}

576 
	$maö
(
¨gc
, **
¨gv
) {

577 
c
;

578 
FILE
 *
modñfûe
;

579 
dm_œyout_if
 
dif
;

580 
dm_disk_if
 *
disk
;

581 *
modñ«me
;

583 
	`ddbg_as£π_£tfûe
(
°dîr
);

585 if(
¨gc
 < 2) {

586 
	`Ârötf
(
°dîr
, "usage: dm_testsuite <model file> [modelÇame]\n");

587 
	`exô
(1);

593 
modñfûe
 = 
	`f›í
(
¨gv
[1], "r");

594 if(!
modñfûe
) {

595 
	`Ârötf
(
°dîr
, "***Éº‹: faûedÅÿ›í \"%s\"\n", 
¨gv
[1]);

598 
c
 = 0; c <
DM_MAX_MODULE
; c++) {

599 
Õ_mod
 *
mod
;

601 if(
c
 =
DM_MOD_DISK
) {

602 
mod
 = 
dm_mods
[
c
];

606 
mod
 = 
dm_mods
[
c
];

609 
	`Õ_ªgi°î_moduÀ
(
mod
);

612 
	`Õ_öô_ty≥tbl
();

613 
	`Õ_lﬂdfûe
(
modñfûe
, 0, 0, 
¨gv
[1], 0, 0);

614 
	`f˛o£
(
modñfûe
);

616 
modñ«me
 = 
¨gc
 >3 ? 
¨gv
[2] : 0;

618 
disk
 = 
	`Õ_ö°™tüã
("foo", 
modñ«me
);

621 
	`œyout_ã°_sim∂e
(
disk
);

654 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/dm_types.h

32 #i‚de‡
_DM_TYPES_H


33 
	#_DM_TYPES_H


	)

35 #ifde‡
__˝lu•lus


41 #ifde‡
_DISKMODEL_FREEBSD


42 
	~<sys/ty≥s.h
>

44 #ifde‡
WIN32


45 
__öt64
 
	töt64_t
;

46 
	t__öt64
 
	tuöt64_t
;

47 
	t__öt32
 
	tuöt32_t
;

48 
	t__öt16
 
	tuöt16_t
;

50 
	~<öây≥s.h
>

56 
uöt32_t
 
	tdm_™gÀ_t
;

59 
	#DM_ANGLE_DENOM
 ((
dm_™gÀ_t
)-1)

	)

62 
	#DM_ANGLE_EXP
 32

	)

64 
	#DM_TIME_EXP
 40

	)

65 
	#DM_TIME_PSEC
 ((
dm_time_t
)1)

66 
	#DM_TIME_NSEC
 (1000 * 
DM_TIME_PSEC
)

67 
	#DM_TIME_USEC
 (1000 * 
DM_TIME_NSEC
)

68 
	#DM_TIME_MSEC
 (1000 * 
DM_TIME_USEC
)

69 
	#DM_TIME_SEC
 (1000 * 
DM_TIME_MSEC
)

	)

72 
öt64_t
 
	tdm_time_t
;

74 
uöt64_t
 
	tdm_pbn_t
;

77 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/dm.h

33 #i‚de‡
_DM_DM_H


34 
	#_DM_DM_H


	)

36 #ifde‡
__˝lu•lus


40 #ifde‡
_DM_SOURCE


41 
	~"dm_c⁄fig.h
"

43 
	~<diskmodñ/dm_ty≥s.h
>

48 
dm_disk_if
;

51 
dm_œyout_if
;

54 
dm_mech_if
;

63 
dm_time_t
 
dm_time_dtoi
();

64 
dm_time_ôod
(
dm_time_t
);

69 
	sdm_pbn
 {

70 
cyl
;

71 
hód
;

72 
£˘‹
;

76 
dm_to_pbn
(
dm_pbn_t
, 
dm_pbn
 *);

79 
dm_‰om_pbn
(
dm_pbn
 *, 
dm_pbn_t
 *);

83 
	sdm_mech_°©e
 {

84 
cyl
;

85 
hód
;

88 
dm_™gÀ_t
 
thëa
;

93 
dm_™gÀ_ôod
(
dm_™gÀ_t
);

94 
dm_™gÀ_t
 
dm_™gÀ_dtoi
();

99 
DM_SLIPPED
 = -1,

100 
DM_REMAPPED
 = -2,

101 
DM_OK
 = -3,

102 
DM_NX
 = -4

104 } 
	tdm_±ﬁ_ªsu…_t
;

108 
DM_SU_SECTORS
 = 0,

109 
DM_SU_REVOLUTIONS


110 } 
	tdm_skew_unô_t
;

114 
MAP_NONE
 = 0,

115 
MAP_IGNORESPARING
 = 1,

116 
MAP_ZONEONLY
 = 2,

117 
MAP_ADDSLIPS
 = 3,

118 
MAP_FULL
 = 4,

119 
MAP_FROMTRACE
 = 5,

120 
MAP_AVGCYLMAP
 = 6

121 } 
	tdm_œyout_m≠ty≥
;

122 
	#DM_MAXMAPTYPE
 
MAP_AVGCYLMAP


	)

157 
	sdm_œyout_z⁄e
 {

158 
•t
;

160 
lbn_low
;

161 
lbn_high
;

163 
cyl_low
;

164 
cyl_high
;

170 
	sdm_œyout_if
 {

175 
dm_±ﬁ_ªsu…_t


176 (*
dm_å™¶©e_…›
)(
dm_disk_if
 *,

177 
lbn
,

178 
dm_œyout_m≠ty≥
,

179 
dm_pbn
 *
ªsu…
,

180 *
ªm≠£˘‹
);

182 
dm_±ﬁ_ªsu…_t


183 (*
dm_å™¶©e_…›_0t
)(
dm_disk_if
 *,

184 
lbn
,

185 
dm_œyout_m≠ty≥
,

186 
dm_pbn
 *
ªsu…
,

187 *
ªm≠£˘‹
);

192 
dm_±ﬁ_ªsu…_t


193 (*
dm_å™¶©e_±ﬁ
)(
dm_disk_if
 *,

194 
dm_pbn
 *
p
,

195 *
ªm≠£˘‹
);

197 
dm_±ﬁ_ªsu…_t


198 (*
dm_å™¶©e_±ﬁ_0t
)(
dm_disk_if
 *,

199 
dm_pbn
 *
p
,

200 *
ªm≠£˘‹
);

205 (*
dm_gë_£˘‹s_lbn
)(
dm_disk_if
 *
d
,

206 
lbn
);

210 (*
dm_gë_£˘‹s_pbn
)(
dm_disk_if
 *
d
,

211 
dm_pbn
 *);

220 
dm_±ﬁ_ªsu…_t


221 (*
dm_gë_åack_bound¨õs
)(
dm_disk_if
 *
d
,

222 
dm_pbn
 *,

223 *
fú°_lbn
,

224 *
œ°_lbn
,

225 *
ªm≠£˘‹
);

231 
dm_±ﬁ_ªsu…_t


232 (*
dm_£ek_di°™˚
)(
dm_disk_if
 *,

233 
°¨t_lbn
,

234 
de°_lbn
);

238 
dm_™gÀ_t


239 (*
dm_pbn_skew
)(
dm_disk_if
 *,

240 
dm_pbn
 *);

243 
dm_™gÀ_t


244 (*
dm_gë_åack_zîﬁ
)(
dm_disk_if
 *,

245 
dm_mech_°©e
 *);

255 (*
dm_c⁄vît_±ﬂ
)(
dm_disk_if
 *,

256 
dm_pbn
 *,

257 
dm_™gÀ_t
 *
°¨t
,

258 
dm_™gÀ_t
 *
width
);

265 
dm_±ﬁ_ªsu…_t


266 (*
dm_c⁄vît_©›
)(
dm_disk_if
 *,

267 
dm_mech_°©e
 *,

268 
dm_pbn
 *);

273 
dm_™gÀ_t


274 (*
dm_gë_£˘‹_width
)(
dm_disk_if
 *,

275 
dm_pbn
 *
åack
,

276 
num
);

279 
dm_™gÀ_t


280 (*
dm_lbn_off£t
)(
dm_disk_if
 *,

281 
lbn1
,

282 
lbn2
);

286 (*
dm_m¨shÆed_Àn
)(
dm_disk_if
 *);

288 *(*
dm_m¨shÆ
)(
dm_disk_if
 *, *);

292 (*
dm_gë_numz⁄es
)(
dm_disk_if
 *);

297 (*
dm_gë_z⁄e
)(
dm_disk_if
 *, 
n
, 
dm_œyout_z⁄e
 *
z
);

303 
dm_±ﬁ_ªsu…_t


304 (*
dm_de„˘_cou¡
)(
dm_disk_if
 *
d
,

305 
dm_pbn
 *
åack
,

306 *
ªsu…
);

337 
	sdm_mech_ac˘imes
 {

338 
dm_time_t
 
£ektime
;

339 
dm_time_t
 
öôül_œãncy
;

340 
dm_time_t
 
öôül_x„r
;

341 
dm_time_t
 
addl_œãncy
;

342 
dm_time_t
 
addl_x„r
;

345 
	sdm_mech_if
 {

351 
dm_time_t
(*
dm_£ek_time
)(
dm_disk_if
 *,

352 
dm_mech_°©e
 *
°¨t_åack
,

353 
dm_mech_°©e
 *
íd_åack
,

354 
rw
);

360 (*
dm_ac˚ss_block
)(
dm_disk_if
 *,

361 
dm_mech_°©e
 *
öôül
,

362 
°¨t
,

363 
Àn
,

364 
immed
);

379 
dm_time_t
(*
dm_œãncy
)(
dm_disk_if
 *,

380 
dm_mech_°©e
 *
öôül
,

381 
°¨t
,

382 
Àn
,

383 
immed
,

384 
dm_time_t
 *
addtﬁ©ícy
);

395 
dm_time_t
(*
dm_œãncy_£q
)(
dm_disk_if
 *,

396 
dm_mech_°©e
 *
öôül
,

397 
°¨t
,

398 
Àn
,

399 
immed
,

400 
dm_time_t
 *
addtﬁ©ícy
);

406 
dm_time_t
(*
dm_pos_time
)(
dm_disk_if
 *,

407 
dm_mech_°©e
 *
öôül
,

408 
dm_pbn
 *
°¨t
,

409 
Àn
,

410 
rw
,

411 
immed
,

412 
dm_mech_ac˘imes
 *
bªakdown
);

425 
dm_time_t
(*
dm_ac˘ime
)(
dm_disk_if
 *,

426 
dm_mech_°©e
 *
öôül_°©e
,

427 
dm_pbn
 *
°¨t
,

428 
Àn
,

429 
rw
,

430 
immed
,

431 
dm_mech_°©e
 *
ªsu…_°©e
,

432 
dm_mech_ac˘imes
 *
bªakdown
);

436 
dm_time_t
(*
dm_rŸtime
)(
dm_disk_if
 *,

437 
dm_™gÀ_t
 
begö
,

438 
dm_™gÀ_t
 
íd
);

444 
dm_time_t
(*
dm_x„πime
)(
dm_disk_if
 *
d
,

445 
dm_mech_°©e
 *,

446 
Àn
);

450 
dm_time_t
(*
dm_hódswôch_time
)(
dm_disk_if
 *,

451 
h1
,

452 
h2
);

457 
dm_™gÀ_t
(*
dm_rŸ©e
)(
dm_disk_if
 *,

458 
dm_time_t
 *
time
);

461 
dm_time_t
(*
dm_≥riod
)(
dm_disk_if
 *);

466 (*
dm_øndomize_Ωm
)(
dm_disk_if
 *);

469 (*
dm_m¨shÆed_Àn
)(
dm_disk_if
 *);

473 *(*
dm_m¨shÆ
)(
dm_disk_if
 *, *);

479 
	sdm_disk_if
 {

481 
dm_cyls
;

484 
dm_surÁ˚s
;

485 
dm_£˘‹s
;

488 
dm_œyout_if
 *
œyout
;

489 
dm_mech_if
 *
mech
;

499 
Õ_block
;

502 
dm_mech_if
 *(*
	tdm_mech_lﬂdî_t
)(
	tÕ_block
 *, 
	tdm_disk_if
 *);

503 
dm_œyout_if
 *(*
	tdm_œyout_lﬂdî_t
)(
	tÕ_block
 *, 
	tdm_disk_if
 *);

506 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/dm_config.h

33 #i‚de‡
_DM_CONFIG_H


34 
	#_DM_CONFIG_H


	)

36 #ifde‡
_DM_SOURCE


37 
	~"dm_ty≥s.h
"

39 
	~<diskmodñ/dm_ty≥s.h
>

42 
	~<libddbg/libddbg.h
>

46 #ifde‡
WIN32


47 
	#INLINE


	)

49 
	#INLINE
 
ölöe


	)

54 #ifde‡
_DISKMODEL_FREEBSD


55 
	#_KERNEL


	)

56 
	~<sys/ty≥s.h
>

57 
	~<sys/mÆloc.h
>

58 
	#mÆloc
(
x
Ë
	`mÆloc
((x), 
M_DEVBUF
, 
M_WAITOK
)

	)

60 
	~<°dlib.h
>

63 
	~<°rög.h
>

65 
uöt32_t
 
sqπ32
(uint32_t);

66 
uöt64_t
 
sqπ64
(uint64_t);

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/dm_types.h

32 #i‚de‡
_DM_TYPES_H


33 
	#_DM_TYPES_H


	)

35 #ifde‡
__˝lu•lus


41 #ifde‡
_DISKMODEL_FREEBSD


42 
	~<sys/ty≥s.h
>

44 #ifde‡
WIN32


45 
__öt64
 
	töt64_t
;

46 
	t__öt64
 
	tuöt64_t
;

47 
	t__öt32
 
	tuöt32_t
;

48 
	t__öt16
 
	tuöt16_t
;

50 
	~<öây≥s.h
>

56 
uöt32_t
 
	tdm_™gÀ_t
;

59 
	#DM_ANGLE_DENOM
 ((
dm_™gÀ_t
)-1)

	)

62 
	#DM_ANGLE_EXP
 32

	)

64 
	#DM_TIME_EXP
 40

	)

65 
	#DM_TIME_PSEC
 ((
dm_time_t
)1)

66 
	#DM_TIME_NSEC
 (1000 * 
DM_TIME_PSEC
)

67 
	#DM_TIME_USEC
 (1000 * 
DM_TIME_NSEC
)

68 
	#DM_TIME_MSEC
 (1000 * 
DM_TIME_USEC
)

69 
	#DM_TIME_SEC
 (1000 * 
DM_TIME_MSEC
)

	)

72 
öt64_t
 
	tdm_time_t
;

74 
uöt64_t
 
	tdm_pbn_t
;

77 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/marshal.h

33 #i‚de‡
_DM_MARSHAL_H


34 
	#_DM_MARSHAL_H


	)

36 
	sdm_m¨shÆ_hdr
 {

37 
	mÀn
;

38 
	mty≥
;

41 *
dm_unm¨shÆ_disk
(
dm_m¨shÆ_hdr
 *,

43 *
∑ª¡
);

49 *(*
	tdm_unm¨shÆ_t
)(
	tdm_m¨shÆ_hdr
 *,

50 **
	tªsu…
,

51 *
	t∑ª¡
);

53 
	sdm_m¨shÆ_moduÀ
 {

54 
dm_unm¨shÆ_t
 
	munm¨shÆ
;

55 **
	m‚_èbÀ
;

56 
	m‚_èbÀ_Àn
;

59 
dm_m¨shÆ_moduÀ
 
dm_disk_m¨shÆ_mod
;

60 
dm_m¨shÆ_moduÀ
 
dm_œyout_g1_m¨shÆ_mod
;

61 
dm_m¨shÆ_moduÀ
 
dm_mech_g1_m¨shÆ_mod
;

63 
dm_m¨shÆ_moduÀ
 *
dm_m¨shÆ_mods
[];

65 
	gm¨shÆed_‚
;

67 
dm_disk_if
 * 
dm_unm¨shÆ
(
dm_m¨shÆ_hdr
 *
h
, 
bufÊí
);

68 
dm_m¨shÆ_hdr
 * 
dm_m¨shÆ
(
dm_disk_if
 *
d
);

69 
m¨shÆ_‚
(*
‚
, 
typ
, 
m¨shÆed_‚
 *
ªsu…
);

70 *
unm¨shÆ_‚
(*
buff
, 
typ
);

71 
m¨shÆ_‚s
(**
‚s
, 
‚s_Àn
, *
b
, 
typ
);

72 
unm¨shÆ_‚s
(**
‚s
, 
‚s_Àn
, *
b
, 
typ
);

75 
	mDM_DISK_TYP
,

76 
	mDM_LAYOUT_G1_TYP
,

77 
	mDM_MECH_G1_TYP
,

78 } 
	tdm_m¨shÆ_ty≥_t
;

80 
	#DM_MARSHAL_MOD_MAX
 3

	)

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_disk_param.h

2 #i‚de‡
_DM_DISK_PARAM_H


3 
	#_DM_DISK_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_disk_if
 *
dm_disk_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
DM_DISK_BLOCK_COUNT
,

16 
DM_DISK_NUMBER_OF_DATA_SURFACES
,

17 
DM_DISK_NUMBER_OF_CYLINDERS
,

18 
DM_DISK_MECHANICAL_MODEL
,

19 
DM_DISK_LAYOUT_MODEL


20 } 
	tdm_disk_∑øm_t
;

22 
	#DM_DISK_MAX_PARAM
 
DM_DISK_LAYOUT_MODEL


	)

23 * 
DM_DISK_lﬂdîs
[];

24 
Õ_∑ømdï_t
 
DM_DISK_dïs
[];

27 
Õ_v¨•ec
 
	gdm_disk_∑øms
 [] = {

28 {"Block cou¡", 
I
, 1 },

29 {"Numbî o‡d©®surÁ˚s", 
I
, 1 },

30 {"Numbî o‡cylödîs", 
I
, 1 },

31 {"Mech™iˇ»Modñ", 
BLOCK
, 0 },

32 {"LayouàModñ", 
BLOCK
, 1 },

35 
	#DM_DISK_MAX
 5

	)

36 
Õ_mod
 
	gdm_disk_mod
 = { "dm_disk", 
dm_disk_∑øms
, 
DM_DISK_MAX
, (
Õ_modlﬂdî_t
)
dm_disk_lﬂd∑øms
, 0, 0, 
DM_DISK_lﬂdîs
, 
DM_DISK_dïs
 };

39 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_layout_g1_param.h

2 #i‚de‡
_DM_LAYOUT_G1_PARAM_H


3 
	#_DM_LAYOUT_G1_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_œyout_if
 *
dm_œyout_g1_lﬂd∑øms
(
Õ_block
 *
b
, 
dm_disk_if
 *
d
);

15 
DM_LAYOUT_G1_LBN_TO_PBN_MAPPING_SCHEME
,

16 
DM_LAYOUT_G1_SPARING_SCHEME_USED
,

17 
DM_LAYOUT_G1_RANGESIZE_FOR_SPARING
,

18 
DM_LAYOUT_G1_SKEW_UNITS
,

19 
DM_LAYOUT_G1_ZONES


20 } 
	tdm_œyout_g1_∑øm_t
;

22 
	#DM_LAYOUT_G1_MAX_PARAM
 
DM_LAYOUT_G1_ZONES


	)

23 * 
DM_LAYOUT_G1_lﬂdîs
[];

24 
Õ_∑ømdï_t
 
DM_LAYOUT_G1_dïs
[];

27 
Õ_v¨•ec
 
	gdm_œyout_g1_∑øms
 [] = {

28 {"LBN-to-PBN m≠pög scheme", 
I
, 1 },

29 {"S∑rög schemêu£d", 
I
, 1 },

30 {"R™gesizêf‹ s∑rög", 
I
, 1 },

31 {"Skew unôs", 
S
, 0 },

32 {"Z⁄es", 
LIST
, 1 },

35 
	#DM_LAYOUT_G1_MAX
 5

	)

36 
Õ_mod
 
	gdm_œyout_g1_mod
 = { "dm_œyout_g1", 
dm_œyout_g1_∑øms
, 
DM_LAYOUT_G1_MAX
, (
Õ_modlﬂdî_t
)
dm_œyout_g1_lﬂd∑øms
, 0, 0, 
DM_LAYOUT_G1_lﬂdîs
, 
DM_LAYOUT_G1_dïs
 };

39 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_layout_g1_zone_param.h

2 #i‚de‡
_DM_LAYOUT_G1_ZONE_PARAM_H


3 
	#_DM_LAYOUT_G1_ZONE_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_œyout_g1_z⁄e_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DM_LAYOUT_G1_ZONE_FIRST_CYLINDER_NUMBER
,

16 
DM_LAYOUT_G1_ZONE_LAST_CYLINDER_NUMBER
,

17 
DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK
,

18 
DM_LAYOUT_G1_ZONE_OFFSET_OF_FIRST_BLOCK
,

19 
DM_LAYOUT_G1_ZONE_SKEW_UNITS
,

20 
DM_LAYOUT_G1_ZONE_EMPTY_SPACE_AT_ZONE_FRONT
,

21 
DM_LAYOUT_G1_ZONE_SKEW_FOR_TRACK_SWITCH
,

22 
DM_LAYOUT_G1_ZONE_SKEW_FOR_CYLINDER_SWITCH
,

23 
DM_LAYOUT_G1_ZONE_NUMBER_OF_SPARES
,

24 
DM_LAYOUT_G1_ZONE_SLIPS
,

25 
DM_LAYOUT_G1_ZONE_DEFECTS


26 } 
	tdm_œyout_g1_z⁄e_∑øm_t
;

28 
	#DM_LAYOUT_G1_ZONE_MAX_PARAM
 
DM_LAYOUT_G1_ZONE_DEFECTS


	)

29 * 
DM_LAYOUT_G1_ZONE_lﬂdîs
[];

30 
Õ_∑ømdï_t
 
DM_LAYOUT_G1_ZONE_dïs
[];

33 
Õ_v¨•ec
 
	gdm_œyout_g1_z⁄e_∑øms
 [] = {

34 {"Fú° cylödîÇumbî", 
I
, 1 },

35 {"La° cylödîÇumbî", 
I
, 1 },

36 {"Block†≥∏åack", 
I
, 1 },

37 {"Off£ào‡fú° block", 
D
, 1 },

38 {"Skew unôs", 
S
, 0 },

39 {"Em±y s∑˚áàz⁄ê‰⁄t", 
I
, 1 },

40 {"Skew f‹Åøck swôch", 
D
, 0 },

41 {"Skew f‹ cylödî swôch", 
D
, 0 },

42 {"Numbî o‡•¨es", 
I
, 1 },

43 {"¶ùs", 
LIST
, 1 },

44 {"de„˘s", 
LIST
, 1 },

47 
	#DM_LAYOUT_G1_ZONE_MAX
 11

	)

48 
Õ_mod
 
	gdm_œyout_g1_z⁄e_mod
 = { "dm_œyout_g1_z⁄e", 
dm_œyout_g1_z⁄e_∑øms
, 
DM_LAYOUT_G1_ZONE_MAX
, (
Õ_modlﬂdî_t
)
dm_œyout_g1_z⁄e_lﬂd∑øms
, 0, 0, 
DM_LAYOUT_G1_ZONE_lﬂdîs
, 
DM_LAYOUT_G1_ZONE_dïs
 };

51 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_layout_g2_param.h

2 #i‚de‡
_DM_LAYOUT_G2_PARAM_H


3 
	#_DM_LAYOUT_G2_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_œyout_if
 *
dm_œyout_g2_lﬂd∑øms
(
Õ_block
 *, 
dm_disk_if
 *
∑ª¡
);

15 
DM_LAYOUT_G2_LAYOUT_MAP_FILE
,

16 
DM_LAYOUT_G2_ZONES


17 } 
	tdm_œyout_g2_∑øm_t
;

19 
	#DM_LAYOUT_G2_MAX_PARAM
 
DM_LAYOUT_G2_ZONES


	)

20 * 
DM_LAYOUT_G2_lﬂdîs
[];

21 
Õ_∑ømdï_t
 
DM_LAYOUT_G2_dïs
[];

24 
Õ_v¨•ec
 
	gdm_œyout_g2_∑øms
 [] = {

25 {"LayouàM≠ Fûe", 
S
, 1 },

26 {"Z⁄es", 
LIST
, 1 },

29 
	#DM_LAYOUT_G2_MAX
 2

	)

30 
Õ_mod
 
	gdm_œyout_g2_mod
 = { "dm_œyout_g2", 
dm_œyout_g2_∑øms
, 
DM_LAYOUT_G2_MAX
, (
Õ_modlﬂdî_t
)
dm_œyout_g2_lﬂd∑øms
, 0, 0, 
DM_LAYOUT_G2_lﬂdîs
, 
DM_LAYOUT_G2_dïs
 };

33 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_layout_g2_zone_param.h

2 #i‚de‡
_DM_LAYOUT_G2_ZONE_PARAM_H


3 
	#_DM_LAYOUT_G2_ZONE_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_œyout_g2_z⁄e_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DM_LAYOUT_G2_ZONE_FIRST_CYLINDER_NUMBER
,

16 
DM_LAYOUT_G2_ZONE_LAST_CYLINDER_NUMBER
,

17 
DM_LAYOUT_G2_ZONE_FIRST_LBN
,

18 
DM_LAYOUT_G2_ZONE_LAST_LBN
,

19 
DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK
,

20 
DM_LAYOUT_G2_ZONE_ZONE_SKEW
,

21 
DM_LAYOUT_G2_ZONE_SKEW_UNITS
,

22 
DM_LAYOUT_G2_ZONE_SKEW_FOR_TRACK_SWITCH
,

23 
DM_LAYOUT_G2_ZONE_SKEW_FOR_CYLINDER_SWITCH


24 } 
	tdm_œyout_g2_z⁄e_∑øm_t
;

26 
	#DM_LAYOUT_G2_ZONE_MAX_PARAM
 
DM_LAYOUT_G2_ZONE_SKEW_FOR_CYLINDER_SWITCH


	)

27 * 
DM_LAYOUT_G2_ZONE_lﬂdîs
[];

28 
Õ_∑ømdï_t
 
DM_LAYOUT_G2_ZONE_dïs
[];

31 
Õ_v¨•ec
 
	gdm_œyout_g2_z⁄e_∑øms
 [] = {

32 {"Fú° cylödîÇumbî", 
I
, 1 },

33 {"La° cylödîÇumbî", 
I
, 1 },

34 {"Fú° LBN", 
I
, 1 },

35 {"La° LBN", 
I
, 1 },

36 {"Block†≥∏åack", 
I
, 1 },

37 {"Z⁄êSkew", 
D
, 0 },

38 {"Skew unôs", 
S
, 0 },

39 {"Skew f‹Åøck swôch", 
D
, 0 },

40 {"Skew f‹ cylödî swôch", 
D
, 0 },

43 
	#DM_LAYOUT_G2_ZONE_MAX
 9

	)

44 
Õ_mod
 
	gdm_œyout_g2_z⁄e_mod
 = { "dm_œyout_g2_z⁄e", 
dm_œyout_g2_z⁄e_∑øms
, 
DM_LAYOUT_G2_ZONE_MAX
, (
Õ_modlﬂdî_t
)
dm_œyout_g2_z⁄e_lﬂd∑øms
, 0, 0, 
DM_LAYOUT_G2_ZONE_lﬂdîs
, 
DM_LAYOUT_G2_ZONE_dïs
 };

47 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_layout_g4_param.h

2 #i‚de‡
_DM_LAYOUT_G4_PARAM_H


3 
	#_DM_LAYOUT_G4_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_œyout_if
 *
dm_œyout_g4_lﬂd∑øms
(
Õ_block
 *, 
dm_disk_if
 *);

15 
DM_LAYOUT_G4_TP
,

16 
DM_LAYOUT_G4_IDX
,

17 
DM_LAYOUT_G4_SLIPS
,

18 
DM_LAYOUT_G4_REMAPS


19 } 
	tdm_œyout_g4_∑øm_t
;

21 
	#DM_LAYOUT_G4_MAX_PARAM
 
DM_LAYOUT_G4_REMAPS


	)

22 * 
DM_LAYOUT_G4_lﬂdîs
[];

23 
Õ_∑ømdï_t
 
DM_LAYOUT_G4_dïs
[];

26 
Õ_v¨•ec
 
	gdm_œyout_g4_∑øms
 [] = {

27 {"TP", 
LIST
, 1 },

28 {"IDX", 
LIST
, 1 },

29 {"Slùs", 
LIST
, 1 },

30 {"Rem≠s", 
LIST
, 1 },

33 
	#DM_LAYOUT_G4_MAX
 4

	)

34 
Õ_mod
 
	gdm_œyout_g4_mod
 = { "dm_œyout_g4", 
dm_œyout_g4_∑øms
, 
DM_LAYOUT_G4_MAX
, (
Õ_modlﬂdî_t
)
dm_œyout_g4_lﬂd∑øms
, 0, 0, 
DM_LAYOUT_G4_lﬂdîs
, 
DM_LAYOUT_G4_dïs
 };

37 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_mech_g1_param.h

2 #i‚de‡
_DM_MECH_G1_PARAM_H


3 
	#_DM_MECH_G1_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_mech_if
 *
dm_mech_g1_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
DM_MECH_G1_ACCESS_TIME_TYPE
,

16 
DM_MECH_G1_CONSTANT_ACCESS_TIME
,

17 
DM_MECH_G1_SEEK_TYPE
,

18 
DM_MECH_G1_AVERAGE_SEEK_TIME
,

19 
DM_MECH_G1_CONSTANT_SEEK_TIME
,

20 
DM_MECH_G1_SINGLE_CYLINDER_SEEK_TIME
,

21 
DM_MECH_G1_FULL_STROBE_SEEK_TIME
,

22 
DM_MECH_G1_FULL_SEEK_CURVE
,

23 
DM_MECH_G1_ADD_WRITE_SETTLING_DELAY
,

24 
DM_MECH_G1_HEAD_SWITCH_TIME
,

25 
DM_MECH_G1_ROTATION_SPEED_
,

26 
DM_MECH_G1_PERCENT_ERROR_IN_RPMS
,

27 
DM_MECH_G1_FIRST_TEN_SEEK_TIMES
,

28 
DM_MECH_G1_HPL_SEEK_EQUATION_VALUES


29 } 
	tdm_mech_g1_∑øm_t
;

31 
	#DM_MECH_G1_MAX_PARAM
 
DM_MECH_G1_HPL_SEEK_EQUATION_VALUES


	)

32 * 
DM_MECH_G1_lﬂdîs
[];

33 
Õ_∑ømdï_t
 
DM_MECH_G1_dïs
[];

36 
Õ_v¨•ec
 
	gdm_mech_g1_∑øms
 [] = {

37 {"Ac˚s†timêty≥", 
S
, 1 },

38 {"C⁄°™àac˚s†time", 
D
, 0 },

39 {"SìkÅy≥", 
S
, 1 },

40 {"Avîagê£ekÅime", 
D
, 0 },

41 {"C⁄°™à£ekÅime", 
D
, 0 },

42 {"SögÀ cylödî sìkÅime", 
D
, 0 },

43 {"FuŒ såobê£ekÅime", 
D
, 0 },

44 {"FuŒ sìk curve", 
S
, 0 },

45 {"Add. wrôê£âlög dñay", 
D
, 1 },

46 {"Hód swôchÅime", 
D
, 1 },

47 {"RŸ©i⁄ s≥ed (öÑpms)", 
I
, 1 },

48 {"Pî˚¡Éº‹ i¿Ωms", 
D
, 1 },

49 {"Fú°Åí sìkÅimes", 
LIST
, 0 },

50 {"HPL sìkÉqu©i⁄ vÆues", 
LIST
, 0 },

53 
	#DM_MECH_G1_MAX
 14

	)

54 
Õ_mod
 
	gdm_mech_g1_mod
 = { "dm_mech_g1", 
dm_mech_g1_∑øms
, 
DM_MECH_G1_MAX
, (
Õ_modlﬂdî_t
)
dm_mech_g1_lﬂd∑øms
, 0, 0, 
DM_MECH_G1_lﬂdîs
, 
DM_MECH_G1_dïs
 };

57 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/modules.h

2 #i‚de‡
_DM_MODULES_H


3 
	#_DM_MODULES_H


	)

6 
	~"dm_disk_∑øm.h
"

7 
	~"dm_œyout_g1_∑øm.h
"

8 
	~"dm_œyout_g1_z⁄e_∑øm.h
"

9 
	~"dm_œyout_g2_∑øm.h
"

10 
	~"dm_œyout_g2_z⁄e_∑øm.h
"

11 
	~"dm_œyout_g4_∑øm.h
"

12 
	~"dm_mech_g1_∑øm.h
"

15 
Õ_mod
 *
	gdm_mods
[] = {

16 &
dm_disk_mod
 ,

17 &
dm_œyout_g1_mod
 ,

18 &
dm_œyout_g1_z⁄e_mod
 ,

19 &
dm_œyout_g2_mod
 ,

20 &
dm_œyout_g2_z⁄e_mod
 ,

21 &
dm_œyout_g4_mod
 ,

22 &
dm_mech_g1_mod


26 
	mDM_MOD_DISK
,

27 
	mDM_MOD_LAYOUT_G1
,

28 
	mDM_MOD_LAYOUT_G1_ZONE
,

29 
	mDM_MOD_LAYOUT_G2
,

30 
	mDM_MOD_LAYOUT_G2_ZONE
,

31 
	mDM_MOD_LAYOUT_G4
,

32 
	mDM_MOD_MECH_G1


33 } 
	tdm_mod_t
;

35 
	#DM_MAX_MODULE
 6

	)

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g1.c

33 
	~"œyout_g1.h
"

34 
	~"m¨shÆ.h
"

36 
	#max
(
x
,
y
Ë(((xË> (y)Ë? (xË: (y))

	)

109 #ifde‡
WIN32


110 
__ölöe
 
	gdm_™gÀ_t


112 
ölöe
 
	gdm_™gÀ_t


114 
	$addmu…
(
dm_™gÀ_t
 
°¨t
, 
mu…
, dm_™gÀ_à
q
, dm_™gÀ_à
x
)

117 
dm_™gÀ_t
 
ªsu…
 = 
°¨t
;

118 
tmp
 = ()
°¨t
 + 
mu…
 * ()
q
;

119 
max
 = ()1 << 32;

133  
ªsu…
 + 
mu…
 * 
q
 + (
tmp
 / 
max
Ë* 
x
;

134 
	}
}

137 
dm_œyout_g1_b™d
 *

138 
	$föd_b™d_lbn
(
dm_œyout_g1
 *
l
, 
lbn
)

140 
dm_œyout_g1_b™d
 *
b
 = &
l
->
b™ds
[0];

141 
b™d°¨t
 = 0;

142 
b™dno
 = 0;

144 (
lbn
 >
b
->
blksöb™d
) || (lbn < 0)) {

145 
b™d°¨t
 +
b
->
blksöb™d
;

146 
lbn
 -
b
->
blksöb™d
;

147 
b™dno
++;

148 
b
 = &
l
->
b™ds
[
b™dno
];

149 
	`ddbg_as£π
(
b™dno
 < 
l
->
b™ds_Àn
);

150 
	`ddbg_as£π
(
lbn
 >= 0);

153  
b
;

154 
	}
}

157 
	$g1_°_lbn
(
dm_disk_if
 *
d
, 
lbn
) {

158 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

159 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_lbn
(
l
, 
lbn
);

160  
b
->
blk•îåack
;

161 
	}
}

164 
dm_œyout_g1_b™d
 *

165 
	$föd_b™d_pbn
(
dm_œyout_g1
 *
l
, 
dm_pbn
 *
p
)

167 
c
;

168 
c
 = 0; c < 
l
->
b™ds_Àn
; c++) {

169 if((
p
->
cyl
 >
l
->
b™ds
[
c
].
°¨tcyl
) &&

170 (
p
->
cyl
 <
l
->
b™ds
[
c
].
ídcyl
))

172  &
l
->
b™ds
[
c
];

176 
	`ddbg_as£π2
(0, "bandÇot found!");

178 
	}
}

182 
	$g1_°_pbn
(
dm_disk_if
 *
d
, 
dm_pbn
 *
p
) {

183 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

184 
dm_pbn
 
p2
 = *
p
;

185 
dm_œyout_g1_b™d
 *
b
;

187 !(
b
 = 
	`föd_b™d_pbn
(
l
, &
p2
)Ë&&Ö2.
cyl
 >= 0) {Ö2.cyl--; }

188 
	`ddbg_as£π
(
b
);

191  
b
->
blk•îåack
;

192 
	}
}

197 
	$g1_sur‚o_⁄_cyl
(
dm_œyout_g1
 *
d
,

198 
dm_œyout_g1_b™d
 *
b
,

199 
dm_pbn
 *
p
)

202 
d
->
m≠pög
) {

203 
LAYOUT_CYLSWITCHONSURF1
:

204 if((
p
->
cyl
 - 
b
->
°¨tcyl
) % 2) {

205  (
d
->
disk
->
dm_surÁ˚s
 - 
p
->
hód
 - 1);

209 
LAYOUT_CYLSWITCHONSURF2
:

210 if(
p
->
cyl
 % 2) {

211  (
d
->
disk
->
dm_surÁ˚s
 - 
p
->
hód
 - 1);

217  
p
->
hód
;

218 
	}
}

221 
dm_™gÀ_t


222 
	$g1_m≠_pbn_skew
(
dm_disk_if
 *
d
,

223 
dm_pbn
 *
p
)

225 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

226 
dm_pbn
 
pbn
 = *
p
;

227 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

228 
åackswôches
;

230 
dm_™gÀ_t
 
ªsu…
 = 
b
->
fú°blk™gÀ
;

232 
¶ùoffs
 = 0;

236 
l
->
m≠pög
) {

237 
LAYOUT_NORMAL
:

238 
LAYOUT_CYLSWITCHONSURF1
:

239 
LAYOUT_CYLSWITCHONSURF2
:

243 
cy o
 = 
p
->
cyl
 - 
b
->
°¨tcyl
;

244 
pbn
.
cyl
 -
b
->
°¨tcyl
;

245 
pbn
.
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
, 
b
, 
p
);

247 
åackswôches
 = 
pbn
.
hód
 + (
d
->
dm_surÁ˚s
 - 1Ë*Öbn.
cyl
;

249 
ªsu…
 = 
	`addmu…
‘esu…, 
åackswôches
, 
b
->
åackskew
, b->
åk•a˚
);

250 
ªsu…
 = 
	`addmu…
‘esu…, 
pbn
.
cyl
, 
b
->
cylskew
, b->
åk•a˚
);

255 i‡((
	`is£˘≥rcyl
(
l
))

256 || (
l
->
•¨escheme
 =
SECTPERTRACK_SPARING
)) {

258 
åacks
 = 
cy o
 * 
d
->
dm_surÁ˚s
;

259 
cutoff
;

260 
i
;

262 i‡(
l
->
•¨escheme
 =
SECTPERTRACK_SPARING
) {

263 
åacks
 +
p
->
hód
;

268 
cutoff
 = 
åacks
 * 
b
->
blk•îåack
;

269 
i
 = 0; i < 
b
->
num¶ùs
; i++) {

270 i‡(
b
->
¶ù
[
i
] < 
cutoff
) {

271 
¶ùoffs
++;

275 
ªsu…
 = 
	`addmu…
‘esu…, 
¶ùoffs
, 
b
->
£˘‹_width
, b->
åk•a˚
);

282 
	`ddbg_as£π
(0);

285 
ªsu…
 = 
	`addmu…
‘esu…, 
pbn
.
£˘‹
, 
b
->
£˘‹_width
, b->
åk•a˚
);

287  
ªsu…
;

288 
	}
}

291 
dm_™gÀ_t


292 
	$g1_gë_åack_0l
(
dm_disk_if
 *
d
,

293 
dm_mech_°©e
 *
åack
)

296 
dm_pbn
 
pbn
;

302 
pbn
.
hód
 = 
åack
->head;

303 
pbn
.
cyl
 = 
åack
->cyl;

304 
pbn
.
£˘‹
 = 0;

306  
d
->
œyout
->
	`dm_pbn_skew
(d, &
pbn
);

307 
	}
}

313 
	$g1_c⁄vît_±ﬂ
(
dm_disk_if
 *
d
,

314 
dm_pbn
 *
p
,

315 
dm_™gÀ_t
 *
™gÀ
,

316 
dm_™gÀ_t
 *
width
)

318 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

319 
dm_pbn
 
pbn
 = *
p
;

320 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

322 
dm_™gÀ_t
 
ªsu…
 = 
b
->
fú°blk™gÀ
;

324 
¶ùoffs
 = 0;

326 
p
 = &
pbn
;

328 
l
->
m≠pög
) {

329 
LAYOUT_NORMAL
:

330 
LAYOUT_CYLSWITCHONSURF1
:

331 
LAYOUT_CYLSWITCHONSURF2
:

332 
p
->
cyl
 -
b
->
°¨tcyl
;

337 i‡((
	`is£˘≥rcyl
(
l
))

338 || (
l
->
•¨escheme
 =
SECTPERTRACK_SPARING
)) {

340 
åacks
 = 
p
->
cyl
 * 
d
->
dm_surÁ˚s
;

341 
cutoff
;

342 
i
;

344 i‡(
l
->
•¨escheme
 =
SECTPERTRACK_SPARING
) {

345 
åacks
 +
p
->
hód
;

347 
cutoff
 = 
åacks
 * 
b
->
blk•îåack
;

348 
i
 = 0; i < 
b
->
num¶ùs
; i++) {

349 i‡(
b
->
¶ù
[
i
] < 
cutoff
) {

350 
¶ùoffs
++;

354 
ªsu…
 = 
	`addmu…
‘esu…, 
¶ùoffs
, 
b
->
£˘‹_width
, b->
åk•a˚
);

359 
	`ddbg_as£π
(0);

362 
ªsu…
 = 
	`addmu…
‘esu…, 
pbn
.
£˘‹
, 
b
->
£˘‹_width
, b->
åk•a˚
);

365 if(
™gÀ
Ë*™gÀ = 
ªsu…
;

366 
	`ddbg_as£π2
(
width
 == 0, "unimplemented");

367 
	}
}

369 
dm_±ﬁ_ªsu…_t


370 
	$g1_c⁄vît_©›
(
dm_disk_if
 *
d
,

371 
dm_mech_°©e
 *
a
,

372 
dm_pbn
 *
ªsu…
)

375 
dm_pbn
 
åack
;

376 
dm_œyout_g1_b™d
 *
b
;

377 
dm_™gÀ_t
 
™gÀ
;

379 
¶ùoffs
 = 0;

380 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

383 
åack
.
cyl
 = 
a
->cyl;

384 
åack
.
hód
 = 
a
->head;

386 
b
 = 
	`föd_b™d_pbn
(
l
, &
åack
);

388 
™gÀ
 = 
a
->
thëa
 - 
b
->
fú°blk™gÀ
;

390 
l
->
m≠pög
) {

391 
LAYOUT_NORMAL
:

392 
LAYOUT_CYLSWITCHONSURF1
:

393 
LAYOUT_CYLSWITCHONSURF2
:

398 i‡((
	`is£˘≥rcyl
(
l
))

399 || (
l
->
•¨escheme
 =
SECTPERTRACK_SPARING
)) {

401 
åacks
 = 
åack
.
cyl
 * 
d
->
dm_surÁ˚s
;

402 
cutoff
;

403 
i
;

405 i‡(
l
->
•¨escheme
 =
SECTPERTRACK_SPARING
) {

406 
åacks
 -
åack
.
hód
;

409 
cutoff
 = 
åacks
 * 
b
->
blk•îåack
;

410 
i
 = 0; i < 
b
->
num¶ùs
; i++) {

411 i‡(
b
->
¶ù
[
i
] < 
cutoff
) {

412 
¶ùoffs
++;

417 
™gÀ
 -
	`addmu…
(0, 
¶ùoffs
, 
b
->
£˘‹_width
, b->
åk•a˚
);

422 
	`ddbg_as£π
(0);

425 
ªsu…
->
cyl
 = 
a
->cyl;

426 
ªsu…
->
hód
 = 
a
->head;

428 
ªsu…
->
£˘‹
 = (
™gÀ
 / (
b
->
£˘‹_width
)Ë% b->
blk•îåack
;

431 if((
b
->
åackskew
 % b->
£˘‹_width
)

432 || (
b
->
cylskew
 % b->
£˘‹_width
)) {

433 if((
™gÀ
 % 
b
->
£˘‹_width
) > 0) {

434 
ªsu…
->
£˘‹
 = (‘esu…->£˘‹+1Ë% 
b
->
blk•îåack
);

439  
DM_OK
;

440 
	}
}

444 
dm_±ﬁ_ªsu…_t


445 
	$g1_±ﬁ_0t
(
dm_disk_if
 *
d
,

446 
dm_pbn
 *
p
,

447 *
ªm≠£˘‹
)

449 
dm_™gÀ_t
 
zîﬁ
;

452 
dm_mech_°©e
 
a
;

453 
dm_pbn
 
p2
;

455 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

456 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

458 
a
.
thëa
 = 
p
->
£˘‹
 * 
b
->
£˘‹_width
 + b->
fú°blk™gÀ
;

459 
zîﬁ
 = 
d
->
œyout
->
	`dm_gë_åack_zîﬁ
(d, (
dm_mech_°©e
 *)
p
);

461 if(
zîﬁ
 > 
a
.
thëa
) {

464 
a
.
thëa
 -
zîﬁ
;

466 
a
.
hód
 = 
p
->head;

467 
a
.
cyl
 = 
p
->cyl;

469 
d
->
œyout
->
	`dm_c⁄vît_©›
(d, &
a
, &
p2
);

471  
d
->
œyout
->
	`dm_å™¶©e_±ﬁ
(d, &
p2
, 
ªm≠£˘‹
);

472 
	}
}

482 
dm_±ﬁ_ªsu…_t


483 
	$g1_±ﬁ_no•¨ög
(
dm_disk_if
 *
d
,

484 
dm_pbn
 *
p
,

485 *
ªm≠£˘‹
)

488 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

489 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

490 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

491 
dm_pbn
 
pbn
 = *
p
;

493 
p
 = &
pbn
;

496 
	`ddbg_as£π
(
b
);

497 
	`ddbg_as£π
(
p
->
cyl
 >= 0);

498 
	`ddbg_as£π
(
p
->
cyl
 >
b
->
°¨tcyl
);

499 
	`ddbg_as£π
(
p
->
cyl
 < 
d
->
dm_cyls
);

500 
	`ddbg_as£π
(
p
->
hód
 >= 0);

501 
	`ddbg_as£π
(
p
->
hód
 < 
d
->
dm_surÁ˚s
);

502 
	`ddbg_as£π
(
p
->
£˘‹
 >= 0);

503 
	`ddbg_as£π
(
p
->
£˘‹
 < 
b
->
blk•îåack
);

506 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
, 
b
,Ö);

508 
lbn
 +(((
p
->
cyl
 - 
b
->
°¨tcyl
Ë* 
d
->
dm_surÁ˚s
Ë+Ö->
hód
Ë* b->
blk•îåack
;

509 
lbn
 +
p
->
£˘‹
 - 
b
->
dód•a˚
;

511 if(
lbn
 < 0) {

512  
DM_SLIPPED
;

515  
lbn
;

517 
	}
}

521 
dm_±ﬁ_ªsu…_t


522 
	$g1_±ﬁ_£˘≥πøck•¨e
(
dm_disk_if
 *
d
,

523 
dm_pbn
 *
p
,

524 *
ªm≠£˘‹
)

526 
i
;

527 
lbn•îcyl
;

528 
fú°blk⁄cyl
;

529 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

530 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

531 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

532 
dm_pbn
 
pbn
 = *
p
;

533 
p
 = &
pbn
;

535 
	`ddbg_as£π
(
b
);

536 
	`ddbg_as£π
(
p
->
cyl
 >= 0);

537 
	`ddbg_as£π
(
p
->
cyl
 >
b
->
°¨tcyl
);

538 
	`ddbg_as£π
(
p
->
cyl
 < 
d
->
dm_cyls
);

539 
	`ddbg_as£π
(
p
->
hód
 >= 0);

540 
	`ddbg_as£π
(
p
->
hód
 < 
d
->
dm_surÁ˚s
);

541 
	`ddbg_as£π
(
p
->
£˘‹
 >= 0);

542 
	`ddbg_as£π
(
p
->
£˘‹
 < 
b
->
blk•îåack
);

545 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
, 
b
,Ö);

546 
fú°blk⁄cyl
 = (
p
->
cyl
 - 
b
->
°¨tcyl
Ë* 
d
->
dm_surÁ˚s
 * b->
blk•îåack
;

547 
p
->
£˘‹
 +
fú°blk⁄cyl
 + (p->
hód
 * 
b
->
blk•îåack
);

548 
i
=(
b
->
numde„˘s
-1); i>=0; i--) {

549 i‡(
p
->
£˘‹
 =
b
->
de„˘
[
i
]) {

550  
DM_REMAPPED
;

552 if(
p
->
£˘‹
 =
b
->
ªm≠
[
i
]) {

553 if(
ªm≠£˘‹
) *remapsector = 1;

554 
p
->
£˘‹
 = 
b
->
de„˘
[
i
];

558 
i
 = (
b
->
num¶ùs
-1); i >= 0; i--) {

559 i‡(
p
->
£˘‹
 =
b
->
¶ù
[
i
]) {

560  
DM_SLIPPED
;

562 i‡((
p
->
£˘‹
 > 
b
->
¶ù
[
i
])

563 && ((
b
->
¶ù
[
i
] / (b->
blk•îåack
 * 
d
->
dm_surÁ˚s
)Ë=(
p
->
cyl
 - b->
°¨tcyl
))

564 && ((
b
->
¶ù
[
i
] % (b->
blk•îåack
 * 
d
->
dm_surÁ˚s
)Ë=
p
->
hód
))

566 
p
->
£˘‹
--;

570 if((
p
->
£˘‹
 % 
b
->
blk•îåack
Ë>(b->blk•îåack - b->
•¨e˙t
)) {

572  
DM_SLIPPED
;

576 
p
->
cyl
 =Ö->
£˘‹
 / (
b
->
blk•îåack
 * 
d
->
dm_surÁ˚s
);

577 
p
->
hód
 =Ö->
£˘‹
 % (
b
->
blk•îåack
 * 
d
->
dm_surÁ˚s
);

578 
p
->
hód
 =Ö->hód / 
b
->
blk•îåack
;

579 
p
->
£˘‹
 =Ö->£˘‹ % 
b
->
blk•îåack
;

581 
lbn•îcyl
 = (
b
->
blk•îåack
 - b->
•¨e˙t
Ë* 
d
->
dm_surÁ˚s
;

582 
lbn
 +
p
->
cyl
 * 
lbn•îcyl
;

583 
lbn
 +
p
->
hód
 * (
b
->
blk•îåack
 - b->
•¨e˙t
);

584 
lbn
 +
p
->
£˘‹
 - 
b
->
dód•a˚
;

587 if(
lbn
 < 0) {

588  
DM_SLIPPED
;

591  
lbn
;

593 
	}
}

597 
dm_±ﬁ_ªsu…_t


598 
	$g1_±ﬁ_£˘≥rcyl•¨e
(
dm_disk_if
 *
d
,

599 
dm_pbn
 *
p
,

600 *
ªm≠£˘‹
)

602 
i
;

603 
lbn•îcyl
;

604 
blk•îcyl
;

605 
fú°blk⁄cyl
;

607 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

608 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

609 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

610 
dm_pbn
 
pbn
 = *
p
;

611 
p
 = &
pbn
;

625 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
, 
b
,Ö);

626 
blk•îcyl
 = 
b
->
blk•îåack
 * 
d
->
dm_surÁ˚s
;

627 
lbn•îcyl
 = 
blk•îcyl
 - 
b
->
•¨e˙t
;

628 
fú°blk⁄cyl
 = (
p
->
cyl
 - 
b
->
°¨tcyl
Ë* 
blk•îcyl
;

629 
p
->
£˘‹
 +
fú°blk⁄cyl
 + (p->
hód
 * 
b
->
blk•îåack
);

631 
i
 = (
b
->
numde„˘s
 - 1); i >= 0; i--) {

632 i‡(
p
->
£˘‹
 =
b
->
de„˘
[
i
]) {

633  
DM_REMAPPED
;

635 i‡(
p
->
£˘‹
 =
b
->
ªm≠
[
i
]) {

636 if(
ªm≠£˘‹
) *remapsector = 1;

637 
p
->
£˘‹
 = 
b
->
de„˘
[
i
];

642 
i
 = (
b
->
num¶ùs
 - 1); i >= 0; i--) {

643 i‡(
p
->
£˘‹
 =
b
->
¶ù
[
i
]) {

644  
DM_SLIPPED
;

646 i‡(
p
->
£˘‹
 > 
b
->
¶ù
[
i
]) {

647 i‡((
b
->
¶ù
[
i
] / 
blk•îcyl
Ë=(
p
->
cyl
 - b->
°¨tcyl
)) {

648 
p
->
£˘‹
--;

649 } i‡(
	`is¶ùt€nd
(
l
)) {

650 
lbn
--;

656 i‡(((!
	`is•¨ót‰⁄t
(
l
)) &&

657 ((
p
->
£˘‹
 % 
blk•îcyl
Ë>
lbn•îcyl
))

659 ((
	`is•¨ót‰⁄t
(
l
)) &&

660 ((
p
->
£˘‹
 % 
blk•îcyl
Ë< 
b
->
•¨e˙t
)))

662  
DM_SLIPPED
;

666 
p
->
cyl
 =Ö->
£˘‹
 / 
blk•îcyl
;

667 
p
->
hód
 =Ö->
£˘‹
 % 
blk•îcyl
;

668 
p
->
hód
 =Ö->hód / 
b
->
blk•îåack
;

669 
p
->
£˘‹
 =Ö->£˘‹ % 
b
->
blk•îåack
;

671 
lbn
 +
p
->
cyl
 * 
lbn•îcyl
;

672 
lbn
 +
p
->
hód
 * 
b
->
blk•îåack
;

673 
lbn
 +
p
->
£˘‹
 - 
b
->
dód•a˚
;

674 
lbn
 -(
	`is•¨ót‰⁄t
(
l
)Ë? 
b
->
•¨e˙t
 : 0;

677 if(
lbn
 < 0) {

678  
DM_SLIPPED
;

681  
lbn
;

683 
	}
}

686 
dm_±ﬁ_ªsu…_t


687 
	$g1_±ﬁ_£˘≥º™ge•¨e
(
dm_disk_if
 *
d
,

688 
dm_pbn
 *
p
,

689 *
ªm≠£˘‹
)

691 
i
;

692 
lbn•îønge
;

693 
blk•îønge
;

694 
blk•îcyl
;

695 
fú°blk⁄cyl
;

696 
øngío
;

698 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

699 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

700 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

702 
dm_pbn
 
pbn
 = *
p
;

703 
p
 = &
pbn
;

706 
	`ddbg_as£π
(
b
);

707 
	`ddbg_as£π
(
p
->
cyl
 >= 0);

708 
	`ddbg_as£π
(
p
->
cyl
 >
b
->
°¨tcyl
);

709 
	`ddbg_as£π
(
p
->
cyl
 < 
d
->
dm_cyls
);

710 
	`ddbg_as£π
(
p
->
hód
 >= 0);

711 
	`ddbg_as£π
(
p
->
hód
 < 
d
->
dm_surÁ˚s
);

712 
	`ddbg_as£π
(
p
->
£˘‹
 >= 0);

713 
	`ddbg_as£π
(
p
->
£˘‹
 < 
b
->
blk•îåack
);

716 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
, 
b
,Ö);

717 
blk•îcyl
 = 
b
->
blk•îåack
 * 
d
->
dm_surÁ˚s
;

718 
blk•îønge
 = 
blk•îcyl
 * 
l
->
øngesize
;

719 
lbn•îønge
 = 
blk•îønge
 - 
b
->
•¨e˙t
;

720 
øngío
 = (
p
->
cyl
 - 
b
->
°¨tcyl
Ë/ 
l
->
øngesize
;

722 
fú°blk⁄cyl
 = (
p
->
cyl
 - 
b
->
°¨tcyl
Ë* 
blk•îcyl
;

723 
p
->
£˘‹
 +
fú°blk⁄cyl
 + (p->
hód
 * 
b
->
blk•îåack
);

725 
i
=(
b
->
numde„˘s
-1); i>=0; i--) {

726 i‡(
p
->
£˘‹
 =
b
->
de„˘
[
i
]) {

727  
DM_REMAPPED
;

729 i‡(
p
->
£˘‹
 =
b
->
ªm≠
[
i
]) {

730 if(
ªm≠£˘‹
) *remapsector = 1;

731 
p
->
£˘‹
 = 
b
->
de„˘
[
i
];

736 
i
=(
b
->
num¶ùs
-1); i>=0; i--) {

737 i‡(
p
->
£˘‹
 =
b
->
¶ù
[
i
]) {

738  
DM_SLIPPED
;

740 i‡(
p
->
£˘‹
 > 
b
->
¶ù
[
i
]) {

741 i‡((
b
->
¶ù
[
i
] / 
blk•îønge
Ë=
øngío
) {

742 
p
->
£˘‹
--;

747 
p
->
£˘‹
 =Ö->£˘‹ % 
blk•îønge
;

750 i‡(
p
->
£˘‹
 >
lbn•îønge
) {

751  
DM_SLIPPED
;

754 
lbn
 +
øngío
 * 
lbn•îønge
;

755 
lbn
 +
p
->
£˘‹
 - 
b
->
dód•a˚
;

757 if(
lbn
 < 0) {

758  
DM_SLIPPED
;

761  
lbn
;

763 
	}
}

766 
dm_±ﬁ_ªsu…_t


767 
	$g1_±ﬁ_£˘≥rz⁄e•¨e
(
dm_disk_if
 *
d
,

768 
dm_pbn
 *
p
,

769 *
ªm≠£˘‹
)

771 
i
;

772 
blk•îcyl
;

773 
fú°blk⁄cyl
;

775 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

776 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

777 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

779 
dm_pbn
 
pbn
 = *
p
;

780 
p
 = &
pbn
;

783 
	`ddbg_as£π
(
b
);

784 
	`ddbg_as£π
(
p
->
cyl
 >= 0);

785 
	`ddbg_as£π
(
p
->
cyl
 >
b
->
°¨tcyl
);

786 
	`ddbg_as£π
(
p
->
cyl
 < 
d
->
dm_cyls
);

787 
	`ddbg_as£π
(
p
->
hód
 >= 0);

788 
	`ddbg_as£π
(
p
->
hód
 < 
d
->
dm_surÁ˚s
);

789 
	`ddbg_as£π
(
p
->
£˘‹
 >= 0);

790 
	`ddbg_as£π
(
p
->
£˘‹
 < 
b
->
blk•îåack
);

798 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
, 
b
,Ö);

799 
blk•îcyl
 = 
b
->
blk•îåack
 * 
d
->
dm_surÁ˚s
;

800 
fú°blk⁄cyl
 = (
p
->
cyl
 - 
b
->
°¨tcyl
Ë* 
blk•îcyl
;

801 
p
->
£˘‹
 +
fú°blk⁄cyl
 + (p->
hód
 * 
b
->
blk•îåack
);

803 
i
 = (
b
->
numde„˘s
 - 1); i >= 0; i--) {

804 i‡(
p
->
£˘‹
 =
b
->
de„˘
[
i
]) {

805  
DM_REMAPPED
;

807 i‡(
p
->
£˘‹
 =
b
->
ªm≠
[
i
]) {

808 if(
ªm≠£˘‹
) *remapsector = 1;

809 
p
->
£˘‹
 = 
b
->
de„˘
[
i
];

814 
i
=(
b
->
num¶ùs
-1); i>=0; i--) {

815 i‡(
p
->
£˘‹
 =
b
->
¶ù
[
i
]) {

816  
DM_SLIPPED
;

818 i‡(
p
->
£˘‹
 > 
b
->
¶ù
[
i
]) {

819 
p
->
£˘‹
--;

824 i‡(
p
->
£˘‹
 >
b
->
blksöb™d
) {

825  
DM_SLIPPED
;

828 
lbn
 +
p
->
£˘‹
 - 
b
->
dód•a˚
;

830 if(
lbn
 < 0) {

831  
DM_SLIPPED
;

834  
lbn
;

836 
	}
}

839 
dm_±ﬁ_ªsu…_t


840 
	$g1_±ﬁ_åack•¨e
(
dm_disk_if
 *
d
,

841 
dm_pbn
 *
p
,

842 *
ªm≠£˘‹
)

844 
i
;

845 
åackno
;

846 
œ°åack
;

848 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

849 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

850 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

852 
dm_pbn
 
pbn
 = *
p
;

853 
p
 = &
pbn
;

855 
	`ddbg_as£π
(
b
);

856 
	`ddbg_as£π
(
p
->
cyl
 >= 0);

857 
	`ddbg_as£π
(
p
->
cyl
 >
b
->
°¨tcyl
);

858 
	`ddbg_as£π
(
p
->
cyl
 < 
d
->
dm_cyls
);

859 
	`ddbg_as£π
(
p
->
hód
 >= 0);

860 
	`ddbg_as£π
(
p
->
hód
 < 
d
->
dm_surÁ˚s
);

861 
	`ddbg_as£π
(
p
->
£˘‹
 >= 0);

862 
	`ddbg_as£π
(
p
->
£˘‹
 < 
b
->
blk•îåack
);

865 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
 (
l
, 
b
,Ö);

866 
åackno
 = (
p
->
cyl
 - 
b
->
°¨tcyl
Ë* 
d
->
dm_surÁ˚s
 +Ö->
hód
;

867 
i
=(
b
->
numde„˘s
-1); i>=0; i--) {

868 i‡(
åackno
 =
b
->
de„˘
[
i
]) {

869  
DM_REMAPPED
;

871 i‡(
åackno
 =
b
->
ªm≠
[
i
]) {

872 
åackno
 = 
b
->
de„˘
[
i
];

876 
i
=(
b
->
num¶ùs
-1); i>=0; i--) {

877 i‡(
åackno
 =
b
->
¶ù
[
i
]) {

878  
DM_SLIPPED
;

880 i‡(
åackno
 > 
b
->
¶ù
[
i
]) {

881 
åackno
--;

884 
œ°åack
 = (
b
->
blksöb™d
 + b->
dód•a˚
Ë/ b->
blk•îåack
;

885 i‡(
åackno
 > 
œ°åack
) {

886  
DM_SLIPPED
;

888 
lbn
 +
p
->
£˘‹
 + (
åackno
 * 
b
->
blk•îåack
Ë- b->
dód•a˚
;

890 if(
lbn
 < 0) {

891  
DM_SLIPPED
;

894  
lbn
;

896 
	}
}

924 
dm_±ﬁ_ªsu…_t


925 
	$g1_åack_bound¨õs_no•¨ög
(
dm_disk_if
 *
d
,

926 
dm_pbn
 *
p
,

927 *
fú°_lbn
,

928 *
œ°_lbn
,

929 *
ªm≠£˘‹
)

932 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

933 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

934 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

935 
ãmp_lbn
 = 
lbn
;

939 
dm_pbn
 
pbn
 = *
p
;

940 
p
 = &
pbn
;

944 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
, 
b
,Ö);

945 
lbn
 +((((
p
->
cyl
 - 
b
->
°¨tcyl
Ë* 
d
->
dm_surÁ˚s
Ë+Ö->
hód
) *

946 
b
->
blk•îåack
Ë- b->
dód•a˚
;

948 if(
fú°_lbn
) {

949 *
fú°_lbn
 =

950 ((
lbn
 + 
b
->
blk•îåack
Ë<
ãmp_lbn
)

951 ? 
DM_SLIPPED


952 : 
	`max
(
lbn
, 
ãmp_lbn
);

955 if(
œ°_lbn
) {

956 
lbn
 +(
b
->
blk•îåack
 - 1);

957 *
œ°_lbn
 = (
lbn
 <
ãmp_lbn
Ë? 
DM_SLIPPED
 :Übn;

960  
DM_OK
;

961 
	}
}

963 
dm_±ﬁ_ªsu…_t


964 
	$g1_åack_bound¨õs_£˘≥πøck•¨e
(
dm_disk_if
 *
d
,

965 
dm_pbn
 *
p
,

966 *
fú°_lbn
,

967 *
œ°_lbn
,

968 *
ªm≠£˘‹
)

972 
i
;

975 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

976 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

977 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

978 
ãmp_lbn
 = 
lbn
;

980 
lbn•îåack
 = 
b
->
blk•îåack
 - b->
•¨e˙t
;

982 
dm_pbn
 
pbn
 = *
p
;

983 
p
 = &
pbn
;

986 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
, 
b
,Ö);

987 
lbn
 +((((
p
->
cyl
 - 
b
->
°¨tcyl
Ë* 
d
->
dm_surÁ˚s
Ë+Ö->
hód
)

988 * 
lbn•îåack
Ë- 
b
->
dód•a˚
;

990 i‡(
fú°_lbn
) {

991 *
fú°_lbn
 = ((
lbn
 + 
lbn•îåack
Ë<
ãmp_lbn
)

992 ? 
DM_SLIPPED


993 : 
	`max
(
ãmp_lbn
, 
lbn
);

996 i‡(
œ°_lbn
) {

997 
lbn
 +(
lbn•îåack
 - 1);

998 *
œ°_lbn
 = (
lbn
 <
ãmp_lbn
Ë? 
DM_SLIPPED
 :Übn;

1001 
p
->
£˘‹
 = ((’->
cyl
 - 
b
->
°¨tcyl
Ë* 
d
->
dm_surÁ˚s
)

1002 + 
p
->
hód
Ë* 
b
->
blk•îåack
;

1004 
i
 = 0; i < 
b
->
numde„˘s
; i++) {

1005 i‡((
p
->
£˘‹
 <
b
->
de„˘
[
i
])

1006 && ((
p
->
£˘‹
 + 
b
->
blk•îåack
Ë> b->
de„˘
[
i
])) {

1007 if(
ªm≠£˘‹
) *remapsector = 1;

1010  
DM_OK
;

1011 
	}
}

1014 
dm_±ﬁ_ªsu…_t


1015 
	$g1_åack_bound¨õs_£˘≥rcyl•¨e
(
dm_disk_if
 *
d
,

1016 
dm_pbn
 *
p
,

1017 *
fú°_lbn
,

1018 *
œ°_lbn
,

1019 *
ªm≠£˘‹
)

1023 
i
;

1024 
blkno
 = 0;

1025 
lb«dd
;

1027 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1028 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

1029 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

1030 
ãmp_lbn
 = 
lbn
;

1034 
dm_pbn
 
pbn
 = *
p
;

1035 
p
 = &
pbn
;

1038 i‡(
fú°_lbn
) {

1039 
lb«dd
 = 0;

1041 
blkno
 = 0; blknÿ< 
b
->
blk•îåack
; blkno++) {

1042 
ªm≠£˘‹2
 = 0;

1043 
p
->
£˘‹
 = 
blkno
;

1044 *
fú°_lbn
 = 
	`g1_±ﬁ_£˘≥rcyl•¨e
(
d
, 
p
, &
ªm≠£˘‹2
);

1046 i‡((*
fú°_lbn
Ë=
DM_REMAPPED
) {

1047 
lb«dd
++;

1050 i‡(
ªm≠£˘‹2
) {

1051 *
fú°_lbn
 = 
DM_SLIPPED
;

1053 i‡((*
fú°_lbn
) >= 0) {

1054 *
fú°_lbn
 = 
	`max
(((*fú°_lbnË- 
lb«dd
), 
ãmp_lbn
);

1058 i‡(
p
->
£˘‹
 =
b
->
blk•îåack
) {

1059 *
fú°_lbn
 = 
DM_SLIPPED
;

1062 i‡(
œ°_lbn
) {

1065 
lb«dd
 = 0;

1067 
p
->
£˘‹
 = (
b
->
blk•îåack
-1);Ö->sector >= 0;Ö->sector--) {

1068 
ªm≠£˘‹2
 = 0;

1069 *
œ°_lbn
 = 
	`g1_±ﬁ_£˘≥rcyl•¨e
(
d
, 
p
, &
ªm≠£˘‹2
);

1070 i‡((*
œ°_lbn
Ë=
DM_REMAPPED
) {

1071 
lb«dd
++;

1074 i‡(
ªm≠£˘‹2
) {

1075 *
œ°_lbn
 = 
DM_SLIPPED
;

1078 i‡((*
œ°_lbn
) >= 0) {

1079 *
œ°_lbn
 = (*œ°_lbnË+ 
lb«dd
;

1083 i‡(
p
->
£˘‹
 =
DM_SLIPPED
) {

1084 *
œ°_lbn
 = 
DM_SLIPPED
;

1087 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
, 
b
,Ö);

1088 
p
->
£˘‹
 = ((’->
cyl
 - 
b
->
°¨tcyl
Ë* 
d
->
dm_surÁ˚s
Ë+Ö->
hód
Ë* b->
blk•îåack
;

1089 
i
 = 0; i < 
b
->
numde„˘s
; i++) {

1090 i‡((
blkno
 <
b
->
de„˘
[
i
]) &&

1091 ((
blkno
 + 
b
->
blk•îåack
Ë> b->
de„˘
[
i
])) {

1093 if(
ªm≠£˘‹
) *remapsector = 1;

1097  
DM_OK
;

1098 
	}
}

1101 
dm_±ﬁ_ªsu…_t


1102 
	$g1_åack_bound¨õs_£˘≥º™ge•¨e
(
dm_disk_if
 *
d
,

1103 
dm_pbn
 *
p
,

1104 *
fú°_lbn
,

1105 *
œ°_lbn
,

1106 *
ªm≠£˘‹
)

1110 
i
;

1111 
blkno
;

1112 
lb«dd
;

1115 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1116 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

1117 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

1118 
ãmp_lbn
 = 
lbn
;

1122 
dm_pbn
 
pbn
 = *
p
;

1123 
p
 = &
pbn
;

1125 i‡(
fú°_lbn
) {

1126 
lb«dd
 = 0;

1128 
blkno
 = 0; blknÿ< 
b
->
blk•îåack
; blkno++) {

1129 
ªm≠£˘‹2
 = 0;

1130 
p
->
£˘‹
 = 
blkno
;

1131 *
fú°_lbn
 = 
	`g1_±ﬁ_£˘≥º™ge•¨e
(
d
,
p
,&
ªm≠£˘‹2
);

1132 i‡((*
fú°_lbn
Ë=
DM_REMAPPED
) {

1133 
lb«dd
++;

1136 i‡(
ªm≠£˘‹2
) {

1137 *
fú°_lbn
 = 
DM_SLIPPED
;

1139 i‡((*
fú°_lbn
) >= 0) {

1140 *
fú°_lbn
 = 
	`max
(((*fú°_lbnË- 
lb«dd
), 
ãmp_lbn
);

1144 i‡(
blkno
 =
b
->
blk•îåack
) {

1145 *
fú°_lbn
 = 
DM_SLIPPED
;

1148 i‡(
œ°_lbn
) {

1151 
lb«dd
 = 0;

1153 
p
->
£˘‹
 = (
b
->
blk•îåack
-1);Ö->sector >= 0;Ö->sector--) {

1154 
ªm≠£˘‹2
 = 0;

1155 *
œ°_lbn
 = 
	`g1_±ﬁ_£˘≥º™ge•¨e
(
d
,
p
,&
ªm≠£˘‹2
);

1157 i‡((*
œ°_lbn
Ë=
DM_REMAPPED
) {

1158 
lb«dd
++;

1160 i‡(
ªm≠£˘‹2
) {

1161 *
œ°_lbn
 = 
DM_SLIPPED
;

1163 i‡((*
œ°_lbn
) >= 0) {

1164 *
œ°_lbn
 = (*œ°_lbnË+ 
lb«dd
;

1168 i‡(
blkno
 =
DM_SLIPPED
) {

1169 *
œ°_lbn
 = 
DM_SLIPPED
;

1172 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
, 
b
,Ö);

1173 
p
->
£˘‹
 = ((’->
cyl
 - 
b
->
°¨tcyl
Ë* 
d
->
dm_surÁ˚s
Ë+Ö->
hód
Ë* b->
blk•îåack
;

1174 
i
 = 0; i < 
b
->
numde„˘s
; i++) {

1175 i‡((
p
->
£˘‹
 <
b
->
de„˘
[
i
]Ë&& (’->£˘‹ + b->
blk•îåack
) > b->defect[i])) {

1176 if(
ªm≠£˘‹
) *remapsector = 1;

1179  
DM_OK
;

1180 
	}
}

1184 
dm_±ﬁ_ªsu…_t


1185 
	$g1_åack_bound¨õs_£˘≥rz⁄e•¨e
(
dm_disk_if
 *
d
,

1186 
dm_pbn
 *
p
,

1187 *
fú°_lbn
,

1188 *
œ°_lbn
,

1189 *
ªm≠£˘‹
)

1192 
i
;

1194 
lb«dd
;

1196 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1197 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

1198 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

1199 
ãmp_lbn
 = 
lbn
;

1203 
dm_pbn
 
pbn
 = *
p
;

1204 
p
 = &
pbn
;

1207 i‡(
fú°_lbn
) {

1208 
lb«dd
 = 0;

1210 
p
->
£˘‹
 = 0;Ö->£˘‹ < 
b
->
blk•îåack
;Ö->sector++) {

1211 
ªm≠£˘‹2
 = 0;

1212 *
fú°_lbn
 = 
	`g1_±ﬁ_£˘≥rz⁄e•¨e
(
d
, 
p
, &
ªm≠£˘‹2
);

1213 i‡((*
fú°_lbn
Ë=
DM_REMAPPED
) {

1214 
lb«dd
++;

1216 i‡(
ªm≠£˘‹2
) {

1217 *
fú°_lbn
 = 
DM_SLIPPED
;

1219 i‡((*
fú°_lbn
) >= 0) {

1220 *
fú°_lbn
 = 
	`max
(((*fú°_lbnË- 
lb«dd
), 
ãmp_lbn
);

1225 if(
p
->
£˘‹
 =
b
->
blk•îåack
) {

1226 *
fú°_lbn
 = 
DM_SLIPPED
;

1231 i‡(
œ°_lbn
) {

1234 
lb«dd
 = 0;

1236 
p
->
£˘‹
 = (
b
->
blk•îåack
 - 1);Ö->sector >= 0;Ö->sector--)

1239 
ªm≠£˘‹2
 = 0;

1240 *
œ°_lbn
 = 
	`g1_±ﬁ_£˘≥rz⁄e•¨e
(
d
,
p
,&
ªm≠£˘‹2
);

1241 i‡((*
œ°_lbn
Ë=
DM_REMAPPED
) {

1242 
lb«dd
++;

1245 i‡(
ªm≠£˘‹2
) {

1246 *
œ°_lbn
 = 
DM_SLIPPED
;

1248 i‡((*
œ°_lbn
) >= 0) {

1249 *
œ°_lbn
 = (*œ°_lbnË+ 
lb«dd
;

1260 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
,
b
,p);

1261 
p
->
£˘‹
 = ((’->
cyl
 - 
b
->
°¨tcyl
Ë* 
d
->
dm_surÁ˚s
Ë+Ö->
hód
Ë* b->
blk•îåack
;

1262 
i
 = 0; i < 
b
->
numde„˘s
; i++) {

1263 i‡((
p
->
£˘‹
 <
b
->
de„˘
[
i
]) &&

1264 ((
p
->
£˘‹
 + 
b
->
blk•îåack
Ë> b->
de„˘
[
i
]))

1266 if(
ªm≠£˘‹
) *remapsector = 1;

1269  
DM_OK
;

1270 
	}
}

1273 
dm_±ﬁ_ªsu…_t


1274 
	$g1_åack_bound¨õs_åack•¨e
(
dm_disk_if
 *
d
,

1275 
dm_pbn
 *
p
,

1276 *
fú°_lbn
,

1277 *
œ°_lbn
,

1278 *
ªm≠£˘‹
)

1280 
i
;

1281 
åackno
;

1282 
œ°åack
;

1285 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1286 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
p
);

1287 
lbn
 = 
l
->
b™d_blknos
[
b
->
num
];

1291 
dm_pbn
 
pbn
 = *
p
;

1292 
p
 = &
pbn
;

1295 
p
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
,
b
,p);

1296 
åackno
 = ((
p
->
cyl
 - 
b
->
°¨tcyl
Ë* 
d
->
dm_surÁ˚s
Ë+Ö->
hód
;

1298 
i
 = (
b
->
numde„˘s
 - 1); i >= 0; i--) {

1299 if(
åackno
 =
b
->
de„˘
[
i
]) {

1300 
lbn
 = 
DM_REMAPPED
;

1302 if(
åackno
 =
b
->
ªm≠
[
i
]) {

1303 
åackno
 = 
b
->
de„˘
[
i
];

1308 
i
 = (
b
->
num¶ùs
-1); i >= 0; i--) {

1309 if(
åackno
 =
b
->
¶ù
[
i
]) {

1310 
lbn
 = 
DM_SLIPPED
;

1312 if(
åackno
 > 
b
->
¶ù
[
i
]) {

1313 
åackno
--;

1317 
œ°åack
 = (
b
->
blksöb™d
 + b->
dód•a˚
Ë/ b->
blk•îåack
;

1319 if(
åackno
 > 
œ°åack
) {

1320 
lbn
 = 
DM_SLIPPED
;

1323 
p
->
£˘‹
 = 
lbn
 + (
åackno
 * 
b
->
blk•îåack
Ë- b->
dód•a˚
;

1327 if(
fú°_lbn
) {

1328 if(
lbn
 < 0) {

1329 *
fú°_lbn
 = 
lbn
;

1332 *
fú°_lbn
 = ((
p
->
£˘‹
 + 
b
->
blk•îåack
Ë<
lbn
)

1333 ? 
DM_SLIPPED


1334 : 
	`max
(
p
->
£˘‹
, 
lbn
);

1338 if(
œ°_lbn
) {

1339 
p
->
£˘‹
 +(
b
->
blk•îåack
 - 1);

1340 if(
lbn
 < 0) {

1341 *
œ°_lbn
 = 
lbn
;

1344 *
œ°_lbn
 = (
p
->
£˘‹
 <
lbn
)

1345 ? 
DM_SLIPPED


1346 : 
p
->
£˘‹
;

1352  
DM_OK
;

1353 
	}
}

1357 
dm_±ﬁ_ªsu…_t


1358 
	$g1_…›_0t
(
dm_disk_if
 *
d
,

1359 
lbn
,

1360 
dm_œyout_m≠ty≥
 
m≠ty≥
,

1361 
dm_pbn
 *
ªsu…
,

1362 *
ªm≠£˘‹
)

1365 
dm_™gÀ_t
 
a
;

1367 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1368 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_lbn
(
l
, 
lbn
);

1370 
d
->
œyout
->
	`dm_å™¶©e_…›
(d,
lbn
,
m≠ty≥
,
ªsu…
,
ªm≠£˘‹
);

1371 
a
 = 
d
->
œyout
->
	`dm_pbn_skew
(d,
ªsu…
);

1373 
ªsu…
->
£˘‹
 = (
a
 / 
b
->
£˘‹_width
Ë% b->
blk•îåack
;

1374 if((
a
 % 
b
->
£˘‹_width
) > 0) {

1375 
ªsu…
->
£˘‹
 = (ªsu…->£˘‹ + 1Ë% 
b
->
blk•îåack
;

1377  
DM_OK
;

1378 
	}
}

1397 
dm_±ﬁ_ªsu…_t


1398 
	$g1_…›_no•¨ög
(
dm_disk_if
 *
d
,

1399 
lbn
,

1400 
dm_œyout_m≠ty≥
 
m≠ty≥
,

1401 
dm_pbn
 *
ªsu…
,

1402 *
ªm≠£˘‹
)

1404 
blk•îåack
;

1405 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1406 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_lbn
(
l
, 
lbn
);

1407 
dm_pbn
 
pbn
 = *
ªsu…
;

1408 
ªsu…
 = &
pbn
;

1410 
lbn
 -
l
->
b™d_blknos
[
b
->
num
];

1411 
lbn
 +
b
->
dód•a˚
;

1413 
blk•îåack
 = 
b
->blkspertrack;

1414 
ªsu…
->
cyl
 = 
lbn
 / (
blk•îåack
 * 
d
->
dm_surÁ˚s
Ë+ 
b
->
°¨tcyl
;

1416 
ªsu…
->
cyl
 = (
lbn
 / 
blk•îåack
Ë% 
d
->
dm_surÁ˚s
;

1417 
ªsu…
->
cyl
 = 
	`g1_sur‚o_⁄_cyl
(
l
,
b
,result);

1418 
ªsu…
->
£˘‹
 = 
lbn
 % 
blk•îåack
;

1420  
DM_OK
;

1421 
	}
}

1424 
dm_±ﬁ_ªsu…_t


1425 
	$g1_…›_£˘≥πøck•¨e
(
dm_disk_if
 *
d
,

1426 
lbn
,

1427 
dm_œyout_m≠ty≥
 
m≠ty≥
,

1428 
dm_pbn
 *
ªsu…
,

1429 *
ªm≠£˘‹
)

1431 
i
, 
åackno
;

1432 
fú°blk⁄åack
 = -1;

1435 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1436 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_lbn
(
l
, 
lbn
);

1438 
blk•îåack
 = 
b
->blkspertrack;

1439 
lbn•îåack
 = 
blk•îåack
 - 
b
->
•¨e˙t
;

1441 
lbn
 -
l
->
b™d_blknos
[
b
->
num
];

1442 
lbn
 +
b
->
dód•a˚
;

1444 
åackno
 = 
lbn
 / 
lbn•îåack
;

1449 
lbn
 %
lbn•îåack
;

1450 i‡((
m≠ty≥
 =
MAP_ADDSLIPS
Ë|| (m≠ty≥ =
MAP_FULL
)) {

1451 
fú°blk⁄åack
 = 
blk•îåack
 * 
åackno
;

1452 
i
=0; i<
b
->
num¶ùs
; i++) {

1453 i‡((
b
->
¶ù
[
i
] >
fú°blk⁄åack
) &&

1454 ((
b
->
¶ù
[
i
] - 
fú°blk⁄åack
Ë<
lbn
))

1456 
lbn
++;

1460 if(
m≠ty≥
 =
MAP_FULL
) {

1461 
i
 = 0; i < 
b
->
numde„˘s
; i++) {

1462 if(
b
->
de„˘
[
i
] =(
fú°blk⁄åack
 + 
lbn
)) {

1463 if(
ªm≠£˘‹
) *remapsector = 1;

1464 
åackno
 = 
b
->
ªm≠
[
i
] / 
blk•îåack
;

1465 
fú°blk⁄åack
 = 
blk•îåack
 * 
åackno
;

1466 
lbn
 = 
b
->
ªm≠
[
i
] % 
blk•îåack
;

1471 
ªsu…
->
cyl
 = 
åackno
/
d
->
dm_surÁ˚s
 + 
b
->
°¨tcyl
;

1473 
ªsu…
->
hód
 = 
åackno
 % 
d
->
dm_surÁ˚s
;

1474 
ªsu…
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
,
b
,result);

1477 if(
lbn
 >
blk•îåack
) {

1481 
	`ddbg_as£π
(0);

1484 
ªsu…
->
£˘‹
 = 
lbn
;

1487  
DM_OK
;

1488 
	}
}

1491 
dm_±ﬁ_ªsu…_t


1492 
	$g1_…›_£˘≥rcyl•¨e
(
dm_disk_if
 *
d
,

1493 
lbn
,

1494 
dm_œyout_m≠ty≥
 
m≠ty≥
,

1495 
dm_pbn
 *
ªsu…
,

1496 *
ªm≠£˘‹
)

1499 
i
;

1500 
blk•îåack
;

1501 
blk•îcyl
;

1502 
lbn•îcyl
;

1503 
fú°blk⁄cyl
 = 0;

1504 
cyl
;

1505 
¶ùs
 = 0;

1508 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1509 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_lbn
(
l
, 
lbn
);

1511 
lbn
 -
l
->
b™d_blknos
[
b
->
num
];

1512 
lbn
 +
b
->
dód•a˚
;

1514 
blk•îåack
 = 
b
->blkspertrack;

1515 
blk•îcyl
 = 
blk•îåack
 * 
d
->
dm_surÁ˚s
;

1516 
lbn•îcyl
 = 
blk•îcyl
 - 
b
->
•¨e˙t
;

1518 
cyl
 = 
lbn
 / 
lbn•îcyl
;

1519 
lbn
 =Üb¿% 
lbn•îcyl
;

1521 i‡((
m≠ty≥
 =
MAP_ADDSLIPS
Ë|| (m≠ty≥ =
MAP_FULL
)) {

1522 
fú°blk⁄cyl
 = 
cyl
 * 
blk•îåack
 * 
d
->
dm_surÁ˚s
;

1523 
i
=0; i<
b
->
num¶ùs
; i++) {

1524 i‡(((
	`is¶ùt€nd
(
l
)) &&

1525 ((
b
->
¶ù
[
i
]/
blk•îcyl
Ë< 
cyl
)) ||

1526 ((
b
->
¶ù
[
i
] >
fú°blk⁄cyl
) &&

1527 ((
b
->
¶ù
[
i
] - 
fú°blk⁄cyl
Ë<(
lbn
+
¶ùs
))))

1529 
¶ùs
++;

1533 
lbn
 +
¶ùs
;

1534 i‡(
m≠ty≥
 =
MAP_FULL
) {

1535 
i
=0; i<
b
->
numde„˘s
; i++) {

1536 i‡((
b
->
de„˘
[
i
] =(
fú°blk⁄cyl
 + 
lbn
)) &&

1537 (
b
->
ªm≠
[
i
] !b->
de„˘
[i]))

1539 if(
ªm≠£˘‹
) *remapsector = 1;

1540 
lbn
 = 
b
->
ªm≠
[
i
];

1541 
cyl
 = 
lbn
 / 
blk•îcyl
;

1542 
lbn
 =Üb¿% 
blk•îcyl
;

1543 
g1_…›_£˘≥rcyl•¨e_d⁄e
;

1548 
cyl
 +
lbn
 / 
lbn•îcyl
;

1549 
lbn
 =Üb¿% 
lbn•îcyl
;

1551 
g1_…›_£˘≥rcyl•¨e_d⁄e
:

1553 
ªsu…
->
cyl
 = cy»+ 
b
->
°¨tcyl
;

1554 
ªsu…
->
hód
 = 
lbn
 / 
blk•îåack
;

1555 
ªsu…
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
,
b
,result);

1556 
ªsu…
->
£˘‹
 = 
lbn
 % 
blk•îåack
;

1558  
DM_OK
;

1559 
	}
}

1564 
dm_±ﬁ_ªsu…_t


1565 
	$g1_…›_£˘≥º™ge•¨e
(
dm_disk_if
 *
d
,

1566 
lbn
,

1567 
dm_œyout_m≠ty≥
 
m≠ty≥
,

1568 
dm_pbn
 *
ªsu…
,

1569 *
ªm≠£˘‹
)

1571 
i
;

1572 
blk•îønge
;

1573 
blk•îcyl
;

1574 
lbn•îønge
;

1575 
fú°blköønge
 = 0;

1576 
øngío
;

1577 
¶ùs
 = 0;

1580 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1581 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_lbn
(
l
, 
lbn
);

1583 
lbn
 -
l
->
b™d_blknos
[
b
->
num
];

1584 
lbn
 +
b
->
dód•a˚
;

1586 
blk•îcyl
 = 
b
->
blk•îåack
 * 
d
->
dm_surÁ˚s
;

1587 
blk•îønge
 = 
blk•îcyl
 * 
l
->
øngesize
;

1588 
lbn•îønge
 = 
blk•îønge
 - 
b
->
•¨e˙t
;

1589 
øngío
 = 
lbn
 / 
lbn•îønge
;

1591 
lbn
 =Üb¿% 
lbn•îønge
;

1593 i‡((
m≠ty≥
 =
MAP_ADDSLIPS
Ë|| (m≠ty≥ =
MAP_FULL
)) {

1594 
fú°blköønge
 = 
øngío
 * 
blk•îønge
;

1595 
i
=0; i<
b
->
num¶ùs
; i++) {

1596 i‡((
b
->
¶ù
[
i
] >
fú°blköønge
) &&

1597 ((
b
->
¶ù
[
i
] - 
fú°blköønge
Ë<(
lbn
+
¶ùs
))) {

1598 
¶ùs
++;

1602 
lbn
 +
¶ùs
;

1603 i‡(
m≠ty≥
 =
MAP_FULL
) {

1604 
i
=0; i<
b
->
numde„˘s
; i++) {

1605 i‡((
b
->
de„˘
[
i
] =(
fú°blköønge
 + 
lbn
)) &&

1606 (
b
->
ªm≠
[
i
] !b->
de„˘
[i])) {

1608 if(
ªm≠£˘‹
) *remapsector = 1;

1609 
lbn
 = 
b
->
ªm≠
[
i
];

1610 
lbn
 =Üb¿% 
blk•îønge
;

1617 
ªsu…
->
cyl
 = 
b
->
°¨tcyl
 +

1618 (
øngío
 * 
l
->
øngesize
Ë+ (
lbn
 / 
blk•îcyl
);

1620 
ªsu…
->
hód
 = (
lbn
 % 
blk•îcyl
Ë/ 
b
->
blk•îåack
;

1621 
ªsu…
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
,
b
,result);

1622 
ªsu…
->
£˘‹
 = 
lbn
 % 
b
->
blk•îåack
;

1624  
DM_OK
;

1625 
	}
}

1628 
dm_±ﬁ_ªsu…_t


1629 
	$g1_…›_£˘≥rz⁄e•¨e
(
dm_disk_if
 *
d
,

1630 
lbn
,

1631 
dm_œyout_m≠ty≥
 
m≠ty≥
,

1632 
dm_pbn
 *
ªsu…
,

1633 *
ªm≠£˘‹
)

1635 
i
;

1636 
blk•îcyl
;

1637 
¶ùs
 = 0;

1639 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1640 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_lbn
(
l
, 
lbn
);

1641 
lbn
 -
l
->
b™d_blknos
[
b
->
num
];

1642 
lbn
 +
b
->
dód•a˚
;

1644 i‡((
m≠ty≥
 =
MAP_ADDSLIPS
Ë|| (m≠ty≥ =
MAP_FULL
)) {

1645 
i
=0; i<
b
->
num¶ùs
; i++) {

1646 i‡(
b
->
¶ù
[
i
] <(
lbn
+
¶ùs
)) {

1647 
¶ùs
++;

1651 
lbn
 +
¶ùs
;

1653 i‡(
m≠ty≥
 =
MAP_FULL
) {

1654 
i
=0; i<
b
->
numde„˘s
; i++) {

1655 i‡((
b
->
de„˘
[
i
] =
lbn
) &&

1656 (
b
->
ªm≠
[
i
] !b->
de„˘
[i])) {

1658 if(
ªm≠£˘‹
) *remapsector = 1;

1659 
lbn
 = 
b
->
ªm≠
[
i
];

1665 
blk•îcyl
 = 
b
->
blk•îåack
 * 
d
->
dm_surÁ˚s
;

1667 
ªsu…
->
cyl
 = 
b
->
°¨tcyl
 + 
lbn
 / 
blk•îcyl
;

1668 
ªsu…
->
hód
 = (
lbn
 % 
blk•îcyl
Ë/ 
b
->
blk•îåack
;

1669 
ªsu…
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
,
b
,result);

1670 
ªsu…
->
£˘‹
 = 
lbn
 % 
b
->
blk•îåack
;

1672  
DM_OK
;

1673 
	}
}

1687 
dm_±ﬁ_ªsu…_t


1688 
	$g1_…›_åack•¨e
(
dm_disk_if
 *
d
,

1689 
lbn
,

1690 
dm_œyout_m≠ty≥
 
m≠ty≥
,

1691 
dm_pbn
 *
ªsu…
,

1692 *
ªm≠£˘‹
)

1695 
i
;

1696 
blk•îåack
;

1697 
åackno
;

1700 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1701 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_lbn
(
l
, 
lbn
);

1702 
lbn
 -
l
->
b™d_blknos
[
b
->
num
];

1703 
lbn
 +
b
->
dód•a˚
;

1705 
blk•îåack
 = 
b
->blkspertrack;

1706 
åackno
 = 
lbn
/
blk•îåack
;

1707 i‡((
m≠ty≥
 =
MAP_ADDSLIPS
Ë|| (m≠ty≥ =
MAP_FULL
)) {

1708 
i
=0; i<
b
->
num¶ùs
; i++) {

1709 i‡(
b
->
¶ù
[
i
] <
åackno
) {

1710 
åackno
++;

1714 i‡(
m≠ty≥
 =
MAP_FULL
) {

1715 
i
=0; i<
b
->
numde„˘s
; i++) {

1716 i‡(
b
->
de„˘
[
i
] =
åackno
) {

1717 
åackno
 = 
b
->
ªm≠
[
i
];

1723 
ªsu…
->
cyl
 = (
åackno
/
d
->
dm_surÁ˚s
Ë+ 
b
->
°¨tcyl
;

1724 
ªsu…
->
hód
 = 
åackno
 % 
d
->
dm_surÁ˚s
;

1725 
ªsu…
->
hód
 = 
	`g1_sur‚o_⁄_cyl
(
l
,
b
,result);

1726 
ªsu…
->
£˘‹
 = 
lbn
 % 
blk•îåack
;

1728  
DM_OK
;

1729 
	}
}

1732 
dm_±ﬁ_ªsu…_t


1733 
	$g1_£ek_di°™˚
(
dm_disk_if
 *
d
,

1734 
°¨t_lbn
,

1735 
íd_lbn
)

1737 
dm_pbn
 
p1
, 
p2
;

1738 
rv
;

1740 
rv
 = 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
°¨t_lbn
, 
MAP_NONE
, &
p1
, 0);

1741 if(
rv
 !
DM_OK
) {

1742  
rv
;

1745 
rv
 = 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
íd_lbn
, 
MAP_NONE
, &
p2
, 0);

1746 if(
rv
 !
DM_OK
) {

1747  
rv
;

1751  
	`abs
(
p2
.
cyl
 - 
p1
.cyl);

1752 
	}
}

1755 
dm_™gÀ_t


1756 
	$g1_gë_£˘‹_width
(
dm_disk_if
 *
d
,

1757 
dm_pbn
 *
åack
,

1758 
num
)

1760 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1761 
dm_œyout_g1_b™d
 *
b
 = 
	`föd_b™d_pbn
(
l
, 
åack
);

1763 
dm_™gÀ_t
 
ªsu…
;

1765 if(
num
 > 
b
->
blk•îåack
) {

1769 
ªsu…
 = 
b
->
£˘‹_width
;

1770 
ªsu…
 *
num
;

1771  
ªsu…
;

1772 
	}
}

1774 
dm_™gÀ_t


1775 
	$g1_lbn_off£t
(
dm_disk_if
 *
d
, 
lbn1
, 
lbn2
)

1777 
dm_pbn
 
pbn1
, 
pbn2
;

1778 
dm_™gÀ_t
 
a1
, 
a2
;

1784 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
lbn1
, 
MAP_FULL
, &
pbn1
, 0);

1785 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
lbn2
, 
MAP_FULL
, &
pbn2
, 0);

1787 
a1
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
pbn1
);

1788 
a2
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
pbn2
);

1790  
a2
 - 
a1
;

1791 
	}
}

1796 
	$œyout_g1_m¨shÆed_Àn
(
dm_disk_if
 *
d
) {

1797 
c
;

1798 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1799 
ªsu…
 = (
dm_m¨shÆ_hdr
Ë+ (
dm_œyout_g1
);

1802 
ªsu…
 +
l
->
b™ds_Àn
 * ();

1805 
ªsu…
 +
l
->
b™ds_Àn
 * (
dm_œyout_g1_b™d
);

1806 
c
 = 0; c < 
l
->
b™ds_Àn
; c++) {

1807 
dm_œyout_g1_b™d
 *
b
 = &
l
->
b™ds
[
c
];

1808 
ªsu…
 +
b
->
num¶ùs
 * ();

1810 
ªsu…
 +
b
->
numde„˘s
 * 2 * ();

1813  
ªsu…
;

1814 
	}
}

1817 
	$œyout_g1_m¨shÆ
(
dm_disk_if
 *
d
, *
buff
) {

1818 
c
;

1819 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1820 *
±r
 = 
buff
;

1821 
dm_m¨shÆ_hdr
 *
hdr
 = (dm_m¨shÆ_hd∏*)
buff
;

1822 
hdr
->
ty≥
 = 
DM_LAYOUT_G1_TYP
;

1823 
hdr
->
Àn
 = 
	`œyout_g1_m¨shÆed_Àn
(
d
);

1825 
±r
 +(
dm_m¨shÆ_hdr
);

1826 
	`mem˝y
(
±r
, 
d
->
œyout
, (
dm_œyout_g1
));

1829 
	`m¨shÆ_‚s
((**)&
l
->
hdr
,

1830 (
l
->
hdr
) / (*),

1831 
±r
,

1832 
DM_LAYOUT_G1_TYP
);

1834 
±r
 +(
dm_œyout_g1
);

1838 
c
 = 0; c < 
l
->
b™ds_Àn
; c++) {

1839 
dm_œyout_g1_b™d
 *
b
 = &
l
->
b™ds
[
c
];

1840 
	`mem˝y
(
±r
, 
b
, (
dm_œyout_g1_b™d
));

1841 
±r
 +(
dm_œyout_g1_b™d
);

1844 
	`mem˝y
(
±r
, 
b
->
¶ù
, b->
num¶ùs
 * ());

1845 
±r
 +
b
->
num¶ùs
 * ();

1848 
	`mem˝y
(
±r
, 
b
->
de„˘
, b->
numde„˘s
 * ());

1849 
±r
 +
b
->
numde„˘s
 * ();

1852 
	`mem˝y
(
±r
, 
b
->
ªm≠
, b->
numde„˘s
 * ());

1853 
±r
 +
b
->
numde„˘s
 * ();

1857 
	`mem˝y
(
±r
, 
l
->
b™d_blknos
,Ü->
b™ds_Àn
 * ());

1858 
±r
 +
l
->
b™ds_Àn
 * ();

1860  
±r
;

1861 
	}
}

1864 
	$œyout_g1_unm¨shÆ
(
dm_m¨shÆ_hdr
 *
hdr
,

1865 **
ªsu…
,

1866 *
∑ª¡
)

1868 
c
;

1869 
dm_œyout_g1
 *
l
 = 
	`mÆloc
((dm_layout_g1));

1870 *
±r
 = (*)
hdr
;

1872 
	`ddbg_as£π
(
hdr
->
ty≥
 =
DM_LAYOUT_G1_TYP
);

1874 
±r
 +(
dm_m¨shÆ_hdr
);

1876 
	`mem˝y
(
l
, 
±r
, (
dm_œyout_g1
));

1877 
	`unm¨shÆ_‚s
((**)&
l
->
hdr
,

1878 (
l
->
hdr
) / (*),

1879 
±r
,

1880 
DM_LAYOUT_G1_TYP
);

1882 
±r
 +(
dm_œyout_g1
);

1884 
l
->
b™ds
 = 
	`mÆloc
÷->
b™ds_Àn
 * (
dm_œyout_g1_b™d
));

1887 
c
 = 0; c < 
l
->
b™ds_Àn
; c++) {

1888 
dm_œyout_g1_b™d
 *
b
 = &
l
->
b™ds
[
c
];

1889 
	`mem˝y
(
b
, 
±r
, (
dm_œyout_g1_b™d
));

1890 
±r
 +(
dm_œyout_g1_b™d
);

1893 if(
b
->
num¶ùs
 != 0) {

1894 
b
->
¶ù
 = 
	`mÆloc
(b->
num¶ùs
 * ());

1895 
	`mem˝y
(
b
->
¶ù
, 
±r
, b->
num¶ùs
 * ());

1896 
±r
 +
b
->
num¶ùs
 * ();

1900 if(
b
->
numde„˘s
 != 0) {

1901 
b
->
de„˘
 = 
	`mÆloc
(b->
numde„˘s
 * ());

1902 
	`mem˝y
(
b
->
de„˘
, 
±r
, b->
numde„˘s
 * ());

1903 
±r
 +
b
->
numde„˘s
 * ();

1906 
b
->
ªm≠
 = 
	`mÆloc
(b->
numde„˘s
 * ());

1907 
	`mem˝y
(
b
->
ªm≠
, 
±r
, b->
numde„˘s
 * ());

1908 
±r
 +
b
->
numde„˘s
 * ();

1913 
l
->
b™d_blknos
 = 
	`mÆloc
÷->
b™ds_Àn
 * ());

1914 
	`mem˝y
(
l
->
b™d_blknos
, 
±r
,Ü->
b™ds_Àn
 * ());

1915 
±r
 +
l
->
b™ds_Àn
 * ();

1918 
l
->
disk
 = 
∑ª¡
;

1920 *
ªsu…
 = 
l
;

1921  
±r
;

1922 
	}
}

1927 
	$g1_gë_numz⁄es
(
dm_disk_if
 *
d
)

1929 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1930  
l
->
b™ds_Àn
;

1931 
	}
}

1937 
	$g1_gë_z⁄e
(
dm_disk_if
 *
d
,

1938 
n
,

1939 
dm_œyout_z⁄e
 *
ªsu…
)

1941 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

1942 
dm_œyout_g1_b™d
 *
z
;

1945 if(
z
 == 0) {  -1; }

1946 if(
n
 < 0 ||Ç >
l
->
b™ds_Àn
) {  -1; }

1948 
z
 = &
l
->
b™ds
[
n
];

1950 
ªsu…
->
•t
 = 
z
->
blk•îåack
;

1951 
ªsu…
->
lbn_low
 = 
l
->
b™d_blknos
[
n
];

1952 
ªsu…
->
lbn_high
 = 
l
->
b™d_blknos
[
n
] + 
z
->
blksöb™d
 - 1;

1954 
ªsu…
->
cyl_low
 = 
z
->
°¨tcyl
;

1955 
ªsu…
->
cyl_high
 = 
z
->
ídcyl
;

1958 
	}
}

1962 *
	gœyout_g1_‚s
[] = {

1963 
g1_…›_no•¨ög
,

1964 
g1_…›_£˘≥πøck•¨e
,

1965 
g1_…›_£˘≥rcyl•¨e
,

1966 
g1_…›_£˘≥º™ge•¨e
,

1967 
g1_…›_£˘≥rz⁄e•¨e
,

1968 
g1_…›_åack•¨e
,

1970 
g1_…›_0t
,

1972 
g1_±ﬁ_no•¨ög
,

1973 
g1_±ﬁ_£˘≥πøck•¨e
,

1974 
g1_±ﬁ_£˘≥rcyl•¨e
,

1975 
g1_±ﬁ_£˘≥º™ge•¨e
,

1976 
g1_±ﬁ_£˘≥rz⁄e•¨e
,

1977 
g1_±ﬁ_åack•¨e
,

1979 
g1_±ﬁ_0t
,

1981 
g1_°_lbn
,

1982 
g1_°_pbn
,

1984 
g1_åack_bound¨õs_no•¨ög
,

1985 
g1_åack_bound¨õs_£˘≥πøck•¨e
,

1986 
g1_åack_bound¨õs_£˘≥rcyl•¨e
,

1987 
g1_åack_bound¨õs_£˘≥º™ge•¨e
,

1988 
g1_åack_bound¨õs_£˘≥rz⁄e•¨e
,

1989 
g1_åack_bound¨õs_åack•¨e
,

1991 
g1_£ek_di°™˚
,

1992 
g1_m≠_pbn_skew
,

1993 
g1_gë_åack_0l
,

1994 
g1_c⁄vît_±ﬂ
,

1995 
g1_c⁄vît_©›
,

1996 
g1_gë_£˘‹_width
,

1997 
œyout_g1_m¨shÆed_Àn
,

1998 
œyout_g1_m¨shÆ
,

1999 
g1_lbn_off£t
,

2000 
g1_gë_numz⁄es
,

2001 
g1_gë_z⁄e


2004 
dm_m¨shÆ_moduÀ
 
	gdm_œyout_g1_m¨shÆ_mod
 =

2006 
œyout_g1_unm¨shÆ
,

2007 
œyout_g1_‚s
,

2008 (
œyout_g1_‚s
) / (*)

2014 
dm_œyout_if
 
	gg1_œyout_no•¨ög
 = {

2015 
g1_…›_no•¨ög
,

2016 
g1_…›_0t
,

2017 
g1_±ﬁ_no•¨ög
,

2018 
g1_±ﬁ_0t
,

2019 
g1_°_lbn
,

2020 
g1_°_pbn
,

2021 
g1_åack_bound¨õs_no•¨ög
,

2022 
g1_£ek_di°™˚
,

2023 
g1_m≠_pbn_skew
,

2024 
g1_gë_åack_0l
,

2025 
g1_c⁄vît_±ﬂ
,

2026 
g1_c⁄vît_©›
,

2027 
g1_gë_£˘‹_width
,

2028 
g1_lbn_off£t
,

2029 
œyout_g1_m¨shÆed_Àn
,

2030 
œyout_g1_m¨shÆ
,

2031 
g1_gë_numz⁄es
,

2032 
g1_gë_z⁄e


2035 
dm_œyout_if
 
	gg1_œyout_åack•¨ög
 = {

2036 
g1_…›_åack•¨e
,

2037 
g1_…›_0t
,

2038 
g1_±ﬁ_åack•¨e
,

2039 
g1_±ﬁ_0t
,

2040 
g1_°_lbn
,

2041 
g1_°_pbn
,

2042 
g1_åack_bound¨õs_åack•¨e
,

2043 
g1_£ek_di°™˚
,

2044 
g1_m≠_pbn_skew
,

2045 
g1_gë_åack_0l
,

2046 
g1_c⁄vît_±ﬂ
,

2047 
g1_c⁄vît_©›
,

2048 
g1_gë_£˘‹_width
,

2049 
g1_lbn_off£t
,

2050 
œyout_g1_m¨shÆed_Àn
,

2051 
œyout_g1_m¨shÆ
,

2052 
g1_gë_numz⁄es
,

2053 
g1_gë_z⁄e


2056 
dm_œyout_if
 
	gg1_œyout_£˘≥πøck•¨e
 = {

2057 
g1_…›_£˘≥πøck•¨e
,

2058 
g1_…›_0t
,

2059 
g1_±ﬁ_£˘≥πøck•¨e
,

2060 
g1_±ﬁ_0t
,

2061 
g1_°_lbn
,

2062 
g1_°_pbn
,

2063 
g1_åack_bound¨õs_£˘≥πøck•¨e
,

2064 
g1_£ek_di°™˚
,

2065 
g1_m≠_pbn_skew
,

2066 
g1_gë_åack_0l
,

2067 
g1_c⁄vît_±ﬂ
,

2068 
g1_c⁄vît_©›
,

2069 
g1_gë_£˘‹_width
,

2070 
g1_lbn_off£t
,

2071 
œyout_g1_m¨shÆed_Àn
,

2072 
œyout_g1_m¨shÆ
,

2073 
g1_gë_numz⁄es
,

2074 
g1_gë_z⁄e


2077 
dm_œyout_if
 
	gg1_œyout_£˘≥rcyl•¨e
 = {

2078 
g1_…›_£˘≥rcyl•¨e
,

2079 
g1_…›_0t
,

2080 
g1_±ﬁ_£˘≥rcyl•¨e
,

2081 
g1_±ﬁ_0t
,

2082 
g1_°_lbn
,

2083 
g1_°_pbn
,

2084 
g1_åack_bound¨õs_£˘≥rcyl•¨e
,

2085 
g1_£ek_di°™˚
,

2086 
g1_m≠_pbn_skew
,

2087 
g1_gë_åack_0l
,

2088 
g1_c⁄vît_±ﬂ
,

2089 
g1_c⁄vît_©›
,

2090 
g1_gë_£˘‹_width
,

2091 
g1_lbn_off£t
,

2092 
œyout_g1_m¨shÆed_Àn
,

2093 
œyout_g1_m¨shÆ
,

2094 
g1_gë_numz⁄es
,

2095 
g1_gë_z⁄e


2098 
dm_œyout_if
 
	gg1_œyout_£˘≥º™ge•¨e
 = {

2099 
g1_…›_£˘≥º™ge•¨e
,

2100 
g1_…›_0t
,

2101 
g1_±ﬁ_£˘≥º™ge•¨e
,

2102 
g1_±ﬁ_0t
,

2103 
g1_°_lbn
,

2104 
g1_°_pbn
,

2105 
g1_åack_bound¨õs_£˘≥º™ge•¨e
,

2106 
g1_£ek_di°™˚
,

2107 
g1_m≠_pbn_skew
,

2108 
g1_gë_åack_0l
,

2109 
g1_c⁄vît_±ﬂ
,

2110 
g1_c⁄vît_©›
,

2111 
g1_gë_£˘‹_width
,

2112 
g1_lbn_off£t
,

2113 
œyout_g1_m¨shÆed_Àn
,

2114 
œyout_g1_m¨shÆ
,

2115 
g1_gë_numz⁄es
,

2116 
g1_gë_z⁄e


2119 
dm_œyout_if
 
	gg1_œyout_£˘≥rz⁄e•¨e
 = {

2120 
g1_…›_£˘≥rz⁄e•¨e
,

2121 
g1_…›_0t
,

2122 
g1_±ﬁ_£˘≥rz⁄e•¨e
,

2123 
g1_±ﬁ_0t
,

2124 
g1_°_lbn
,

2125 
g1_°_pbn
,

2126 
g1_åack_bound¨õs_£˘≥rz⁄e•¨e
,

2127 
g1_£ek_di°™˚
,

2128 
g1_m≠_pbn_skew
,

2129 
g1_gë_åack_0l
,

2130 
g1_c⁄vît_±ﬂ
,

2131 
g1_c⁄vît_©›
,

2132 
g1_gë_£˘‹_width
,

2133 
g1_lbn_off£t
,

2134 
œyout_g1_m¨shÆed_Àn
,

2135 
œyout_g1_m¨shÆ
,

2136 
g1_gë_numz⁄es
,

2137 
g1_gë_z⁄e


2146 
	$b™dc›y
(
dm_œyout_g1_b™d
 **
de°b™ds
,

2147 
dm_œyout_g1_b™d
 *
§cb™ds
,

2148 
numb™ds
)

2150 
i
;

2151 *
de°b™ds
 = 
	`mÆloc
(
numb™ds
 * (
dm_œyout_g1_b™d
));

2152 
	`mem˝y
(*
de°b™ds
,
§cb™ds
,(
dm_œyout_g1_b™d
));

2154 
i
=0; i<
numb™ds
; i++) {

2155 (*
de°b™ds
)[
i
].
¶ù
 = 
	`mÆloc
 (
§cb™ds
[i].
num¶ùs
 * ());

2156 (*
de°b™ds
)[
i
].
de„˘
 = 
	`mÆloc
 (
§cb™ds
[i].
numde„˘s
 * ());

2157 (*
de°b™ds
)[
i
].
ªm≠
 = 
	`mÆloc
 (
§cb™ds
[i].
numde„˘s
 * ());

2159 
	`mem˝y
((*
de°b™ds
)[
i
].
¶ù
,

2160 
§cb™ds
[
i
].
¶ù
,

2161 
§cb™ds
[
i
].
num¶ùs
 * ());

2162 
	`mem˝y
((*
de°b™ds
)[
i
].
de„˘
,

2163 
§cb™ds
[
i
].
de„˘
,

2164 
§cb™ds
[
i
].
numde„˘s
 * ());

2165 
	`mem˝y
((*
de°b™ds
)[
i
].
ªm≠
,

2166 
§cb™ds
[
i
].
ªm≠
,

2167 
§cb™ds
[
i
].
numde„˘s
 * ());

2169 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g1.h

99 #i‚de‡
_DM_LAYOUT_G1_H


100 
	#_DM_LAYOUT_G1_H


	)

101 
	~"dm.h
"

106 
	mNO_SPARING
 = 0,

107 
	mTRACK_SPARING
 = 1,

108 
	mSECTPERCYL_SPARING
 = 2,

109 
	mSECTPERTRACK_SPARING
 = 3,

110 
	mSECTPERCYL_SPARING_SLIPTOEND
 = 4,

111 
	mSECTPERCYL_SPARING_ATFRONT
 = 5,

112 
	mSECTPERCYL_SPARING_ATFRONT_SLIPTOEND
 = 6,

113 
	mSECTATEND_SPARING
 = 7,

114 
	mSECTPERRANGE_SPARING
 = 8,

115 
	mSECTSPERZONE_SPARING
 = 9,

116 
	mSECTSPERZONE_SPARING_SLIPTOEND
 = 10

117 } 
	tdm_œyout_g1_•¨e_t
;

118 
	#MAXSPARESCHEME
 
SECTSPERZONE_SPARING_SLIPTOEND


	)

122 
	mLAYOUT_NORMAL
 = 0,

123 
	mLAYOUT_CYLSWITCHONSURF1
 = 1,

127 
	mLAYOUT_CYLSWITCHONSURF2
 = 2

130 } 
	tdm_œyout_g1_m≠_t
;

132 
	#LAYOUT_MAX
 
LAYOUT_CYLSWITCHONSURF2


	)

137 
	#is•¨ót‰⁄t
(
l
) \

138 (((
l
)->
•¨escheme
 =
SECTPERCYL_SPARING_ATFRONT
) || \

139 ((
l
)->
•¨escheme
 =
SECTPERCYL_SPARING_ATFRONT_SLIPTOEND
))

	)

141 
	#is¶ùt€nd
(
l
) \

142 (((
l
)->
•¨escheme
 =
SECTPERCYL_SPARING_SLIPTOEND
) || \

143 ((
l
)->
•¨escheme
 =
SECTPERCYL_SPARING_ATFRONT_SLIPTOEND
) || \

144 ((
l
)->
•¨escheme
 =
SECTATEND_SPARING
))

	)

146 
	#is£˘≥rcyl
(
l
) \

147 (((
l
)->
•¨escheme
 =
SECTPERCYL_SPARING
) || \

148 ((
l
)->
•¨escheme
 =
SECTPERCYL_SPARING_SLIPTOEND
) || \

149 ((
l
)->
•¨escheme
 =
SECTPERCYL_SPARING_ATFRONT
) || \

150 ((
l
)->
•¨escheme
 =
SECTPERCYL_SPARING_ATFRONT_SLIPTOEND
))

	)

154 
	gdm_œyout_g1_b™d
;

157 
	sdm_œyout_g1
 {

158 
dm_œyout_if
 
	mhdr
;

159 
dm_disk_if
 *
	mdisk
;

161 
dm_œyout_g1_•¨e_t
 
	m•¨escheme
;

162 
	møngesize
;

163 
dm_œyout_g1_m≠_t
 
	mm≠pög
;

166 
dm_œyout_g1_b™d
 *
	mb™ds
;

167 
	mb™ds_Àn
;

168 *
	mb™d_blknos
;

169 
dm_skew_unô_t
 
	mskew_unôs
;

174 
	sdm_œyout_g1_b™d
 {

175 
	m°¨tcyl
;

176 
	mídcyl
;

177 
	mblk•îåack
;

178 
	mdód•a˚
;

180 
dm_™gÀ_t
 
	mfú°blk™gÀ
;

181 
dm_™gÀ_t
 
	mcylskew
;

182 
dm_™gÀ_t
 
	måackskew
;

184 
	mblksöb™d
;

185 
	m•¨e˙t
;

186 
	mnum¶ùs
;

187 
	mnumde„˘s
;

188 *
	m¶ù
;

189 *
	mde„˘
;

190 *
	mªm≠
;

191 
	mnum
;

194 
dm_™gÀ_t
 
	m£˘‹_width
;

199 
dm_™gÀ_t
 
	måk•a˚
;

202 
dm_skew_unô_t
 
	mskew_unôs
;

207 
dm_œyout_if
 
g1_œyout_no•¨ög
;

208 
dm_œyout_if
 
g1_œyout_åack•¨ög
;

209 
dm_œyout_if
 
g1_œyout_£˘≥πøck•¨e
;

210 
dm_œyout_if
 
g1_œyout_£˘≥rcyl•¨e
;

211 
dm_œyout_if
 
g1_œyout_£˘≥º™ge•¨e
;

212 
dm_œyout_if
 
g1_œyout_£˘≥rz⁄e•¨e
;

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g1_load.c

101 
	~<°dlib.h
>

102 
	~<°rög.h
>

104 
	~<lib∑øm/lib∑øm.h
>

105 
	~<lib∑øm/bôve˘‹.h
>

107 
	~"dm.h
"

108 
	~"œyout_g1.h
"

110 
	~"moduÀs/moduÀs.h
"

111 
	~"moduÀs/dm_œyout_g1_∑øm.h
"

112 
	~"moduÀs/dm_œyout_g1_z⁄e_∑øm.h
"

115 
checknumblocks
(
dm_œyout_g1
 *
d
);

116 
£tup_b™d_blknos
(
dm_œyout_g1
 *);

117 
öôülize_b™ds
(
dm_disk_if
 *
d
);

118 
disk_lﬂd_z⁄es
(
Õ_li°
 *
l
,

119 
dm_œyout_g1
 *
œyout
);

121 
dm_œyout_g1_öôülize
(
dm_disk_if
 *
d
);

124 
dm_œyout_g1_compuã_blksöb™d
(
dm_disk_if
 *
d
,

125 
dm_œyout_g1_b™d
 *
b
);

128 
dm_œyout_if
 *

129 
	$dm_œyout_g1_lﬂd∑øms
(
Õ_block
 *
b
, 
dm_disk_if
 *
d
)

131 
dm_œyout_g1
 *
ªsu…
 = 
	`mÆloc
((*result));

132 
	`mem£t
(
ªsu…
, 0, (*result));

136 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
dm_œyout_g1_mod
);

138 
ªsu…
->
disk
 = 
d
;

139 
ªsu…
->
disk
->
œyout
 = (
dm_œyout_if
 *)result;

149 
ªsu…
->
m≠pög
) {

150 
LAYOUT_NORMAL
:

151 
LAYOUT_CYLSWITCHONSURF1
:

152 
LAYOUT_CYLSWITCHONSURF2
:

153 if(
ªsu…
->
•¨escheme
 =
NO_SPARING
) {

154 
ªsu…
->
hdr
 = 
g1_œyout_no•¨ög
;

156 i‡(
ªsu…
->
•¨escheme
 =
TRACK_SPARING
) {

157 
ªsu…
->
hdr
 = 
g1_œyout_åack•¨ög
;

159 i‡(
ªsu…
->
•¨escheme
 =
SECTPERTRACK_SPARING
) {

161 
ªsu…
->
hdr
 = 
g1_œyout_£˘≥πøck•¨e
;

164 i‡((
	`is£˘≥rcyl
(
ªsu…
)) ||

165 (
ªsu…
->
•¨escheme
 =
SECTATEND_SPARING
))

167 
ªsu…
->
hdr
 = 
g1_œyout_£˘≥rcyl•¨e
;

169 i‡((
ªsu…
->
•¨escheme
 =
SECTSPERZONE_SPARING
) ||

170 (
ªsu…
->
•¨escheme
 =
SECTSPERZONE_SPARING_SLIPTOEND
))

172 
ªsu…
->
hdr
 = 
g1_œyout_£˘≥rz⁄e•¨e
;

174 i‡(
ªsu…
->
•¨escheme
 =
SECTPERRANGE_SPARING
) {

175 
ªsu…
->
hdr
 = 
g1_œyout_£˘≥º™ge•¨e
;

178 
	`ddbg_as£π2
(0, "Unknown sparing scheme");

183 
	`ddbg_as£π2
(0, "UnknownÜbn<->pbn scheme");

188 
	`öôülize_b™ds
(
ªsu…
->
disk
);

189 
	`dm_œyout_g1_öôülize
(
d
);

190 
	`checknumblocks
(
ªsu…
);

191 
	`£tup_b™d_blknos
(
ªsu…
);

193  (
dm_œyout_if
 *)
ªsu…
;

194 
	}
}

197 
	$checknumblocks
(
dm_œyout_g1
 *
d
) {

198 
numblocks
 = 0;

199 
i
;

201 
FILE
 *
ouçutfûe
 = 
°dîr
;

203 
i
 = 0; i < 
d
->
b™ds_Àn
; i++) {

204 
numblocks
 +
d
->
b™ds
[
i
].
blksöb™d
;

206 i‡(
numblocks
 !
d
->
disk
->
dm_£˘‹s
) {

211 
d
->
disk
->
dm_£˘‹s
 = 
numblocks
;

212 
	}
}

227 
	$£tup_b™d_blknos
(
dm_œyout_g1
 *
d
) {

228 
c
;

230 
d
->
b™d_blknos
[0] = 0;

231 
c
 = 1; c < 
d
->
b™ds_Àn
; c++) {

232 
d
->
b™d_blknos
[
c
] = d->band_blknos[c - 1] +

233 
d
->
b™ds
[
c
-1].
blksöb™d
;

235 
	}
}

238 
	$öôülize_b™ds
(
dm_disk_if
 *
d
) {

239 
j
;

240 
tm±ime
, 
rŸblks
;

241 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

246 
j
 = 0; j < 
l
->
b™ds_Àn
; j++) {

247 
≥riod
;

251 
dm_mech_°©e
 
s1
 = {0,0,0}, 
s2
 = {1,0,0};

252 
dm_time_t
 
t1
 = 
d
->
mech
->
	`dm_£ek_time
(d, &
s1
, &
s2
, 0);

253 
dm_time_t
 
t2
 = 
d
->
mech
->
	`dm_£ek_time
(d, &
s1
, &
s2
, 1);

255 
tm±ime
 = 
t1
 > 
t2
 ?Å1 :Å2;

257 
≥riod
 = 
	`dm_time_ôod
(
d
->
mech
->
	`dm_≥riod
(d));

258 
rŸblks
 = (()
l
->
b™ds
[
j
].
blk•îåack
Ë/ 
≥riod
;

261 i‡(
l
->
b™ds
[
j
].
åackskew
 == -1.0) {

262 
	`ddbg_as£π2
(0, "unimplemented");

263 
l
->
b™ds
[
j
].
åackskew
 = 
tm±ime
;

265 i‡(
l
->
b™ds
[
j
].
åackskew
 == -2.0) {

266 
	`ddbg_as£π2
(0, "unimplemented");

267 
tm±ime
 = (Ë((Ë—m±imê* 
rŸblks
 + 0.999999999));

268 
l
->
b™ds
[
j
].
åackskew
 = 
tm±ime
 / 
rŸblks
;

271 
l
->
b™ds
[
j
].
åackskew
 =Ü->bands[j].trackskew;

280 
tm±ime
 = 0;

282 i‡(
l
->
b™ds
[
j
].
cylskew
 == -1.0) {

283 
	`ddbg_as£π2
(0, "unimplemented");

284 
l
->
b™ds
[
j
].
cylskew
 = 
tm±ime
;

286 i‡(
l
->
b™ds
[
j
].
cylskew
 == -2.0) {

287 
	`ddbg_as£π2
(0, "unimplemented");

288 
tm±ime
 = (Ë((Ë—m±imê* 
rŸblks
 + 0.99999999));

289 
l
->
b™ds
[
j
].
cylskew
 = 
tm±ime
 / 
rŸblks
;

292 
l
->
b™ds
[
j
].
cylskew
 =Ü->bands[j].cylskew;

295 
	}
}

300 
	$dm_œyout_g1_z⁄e_lﬂd∑øms
(
Õ_block
 *
b
Ë{ 
	`ddbg_as£π
(0);  0; 
	}
}

302 
gë¶ùs
(
dm_œyout_g1_b™d
 *
z
, 
Õ_li°
 *
l
);

303 
gëde„˘s
(
dm_œyout_g1_b™d
 *
z
, 
Õ_li°
 *
l
);

306 
	$disk_lﬂd_z⁄es
(
Õ_li°
 *
l°
,

307 
dm_œyout_g1
 *
œyout
)

309 
d
;

310 
dm_œyout_g1_b™d
 *
ªsu…
 = 0;

313 
œyout
->
b™ds_Àn
 = 0;

314 
d
 = 0; d < 
l°
->
vÆues_Àn
; d++) {

315 if(
l°
->
vÆues
[
d
]Ë
œyout
->
b™ds_Àn
++;

318 
œyout
->
b™ds
 = 
	`mÆloc
÷ayout->
b™ds_Àn
 * (
dm_œyout_g1_b™d
));

319 
œyout
->
b™d_blknos
 = 
	`mÆloc
÷ayout->
b™ds_Àn
 * ());

320 
	`bzîo
(
œyout
->
b™ds
,Üayout->
b™ds_Àn
 * (
dm_œyout_g1_b™d
));

322 
ªsu…
 = 
œyout
->
b™ds
;

324 
d
 = 0; d < 
œyout
->
b™ds_Àn
; d++) {

325 
max
 = ()1 << 32;

327 
œyout
->
b™ds
[
d
].
skew_unôs
 =Üayout->skew_units;

329 if(!
l°
->
vÆues
[
d
]) ;

330 if(
l°
->
vÆues
[
d
]->
t
 !
BLOCK
) {

331 
	`Ârötf
(
°dîr
, "Bad band/zone def.\n");

338 
	`Õ_lﬂd∑øms
(
ªsu…
, 
l°
->
vÆues
[
d
]->
v
.
b
, &
dm_œyout_g1_z⁄e_mod
);

346 
ªsu…
->
åk•a˚
 = 
max
 %Ñesu…->
blk•îåack
;

348 
ªsu…
++;

349 
œyout
->
b™ds
[
d
].
num
 = d;

355 
	}
}

359 
	$gë¶ùs
(
dm_œyout_g1_b™d
 *
z
,

360 
Õ_li°
 *
b
)

362 
c
; *
i
;

363 
z
->
num¶ùs
 = 0;

365 if(
z
->
¶ù
) {

366 
	`Ârötf
(
°dîr
, "***Érror:ÅriedÅo declare zone slips multipleÅimes.\n");

371 
c
 = 0; c < 
b
->
vÆues_Àn
; c++) {

372 if(
b
->
vÆues
[
c
]) {

373 i‡(
b
->
vÆues
[
c
]->
t
 !
I
) {

374 
	`Ârötf
(
°dîr
, "***Érror: Zone slips must be INTs.\n");

377 i‡(
b
->
vÆues
[
c
]->
v
.
i
 < 0) {

378 
	`Ârötf
(
°dîr
, "***Érror: Zone slips must beÇonnegative.\n");

382 
z
->
num¶ùs
++;

386 
i
 = 
z
->
¶ù
 = 
	`mÆloc
(z->
num¶ùs
 * ());

387 
c
 = 0; c < 
z
->
num¶ùs
; c++) {

388 *
i
 = 
b
->
vÆues
[
c
]->
v
.i; i++;

391 
	}
}

394 
	$gëde„˘s
(
dm_œyout_g1_b™d
 *
z
,

395 
Õ_li°
 *
b
)

397 
c
; *
i
, *
j
;

399 if(
z
->
de„˘
 || z->
ªm≠
) {

400 
	`Ârötf
(
°dîr
, "***Érror:ÅriedÅo declare zone defects multipleÅimes.\n");

404 
z
->
numde„˘s
 = 0;

405 
c
 = 0; c < 
b
->
vÆues_Àn
; c++) {

406 if(
b
->
vÆues
[
c
]) {

407 i‡(
b
->
vÆues
[
c
]->
t
 !
I
) {

408 
	`Ârötf
(
°dîr
, "***Érror: Zone defects must be INTs.\n");

411 i‡(
b
->
vÆues
[
c
]->
v
.
i
 < 0) {

412 
	`Ârötf
(
°dîr
, "***Érror: Zone defects must beÇonnegative.\n");

416 
z
->
numde„˘s
++;

420 if(
z
->
numde„˘s
 % 2) {

421 
	`Ârötf
(
°dîr
, "***Érror: Must haveánÉvenÇumber of defectárgs.\n");

424 
z
->
numde„˘s
 >>= 1;

427 
i
 = 
z
->
de„˘
 = 
	`mÆloc
(z->
numde„˘s
 * ());

428 
j
 = 
z
->
ªm≠
 = 
	`mÆloc
(z->
numde„˘s
 * ());

430 
c
 = 0; c < 
z
->
numde„˘s
; c++) {

431 *
i
 = 
b
->
vÆues
[
c
*2]->
v
.i; i++;

432 *
j
 = 
b
->
vÆues
[
c
*2 + 1]->
v
.
i
; j++;

436 
	}
}

443 
	$dm_œyout_g1_öôülize
(
dm_disk_if
 *
d
)

445 
i
;

446 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

448 
	`ddbg_as£π
((
l
->
m≠pög
 >0Ë&& (l->m≠pög <
LAYOUT_MAX
));

450 
i
 = 0; i < 
l
->
b™ds_Àn
; i++) {

451 
dm_œyout_g1_b™d
 *
b
 = &
l
->
b™ds
[
i
];

454 
	`ddbg_as£π3
((
l
->
•¨escheme
 !
TRACK_SPARING
)

455 || ((
b
->
num¶ùs
 + b->
numde„˘s
Ë<b->
•¨e˙t
),

457 
b
->
•¨e˙t
,

458 
b
->
numde„˘s
,

459 
b
->
num¶ùs
));

461 
b
->
blksöb™d
 = 
	`dm_œyout_g1_compuã_blksöb™d
(
d
, b);

463 
	}
}

469 
	$dm_œyout_g1_compuã_blksöb™d
(
dm_disk_if
 *
d
,

470 
dm_œyout_g1_b™d
 *
b
)

473 
dm_œyout_g1
 *
l
 = (dm_œyout_g1 *)
d
->
œyout
;

474 
blksöb™d
;

476 
cyl˙t
 = 
b
->
ídcyl
 - b->
°¨tcyl
 + 1;

479 
blksöb™d
 = 
cyl˙t
 * 
b
->
blk•îåack
 * 
d
->
dm_surÁ˚s
;

480 
blksöb™d
 -
b
->
dód•a˚
;

482 
l
->
•¨escheme
) {

483 
TRACK_SPARING
:

484 
blksöb™d
 -
b
->
•¨e˙t
 * b->
blk•îåack
;

486 
SECTPERTRACK_SPARING
:

487 
blksöb™d
 -
b
->
•¨e˙t
 * 
cyl˙t
 * 
d
->
dm_surÁ˚s
;

489 
SECTATEND_SPARING
:

490 
blksöb™d
 -
b
->
num¶ùs
;

492 
SECTSPERZONE_SPARING
:

493 
blksöb™d
 -
b
->
•¨e˙t
;

495 
SECTSPERZONE_SPARING_SLIPTOEND
:

496 
blksöb™d
 -
b
->
•¨e˙t
 + b->
num¶ùs
;

500 i‡((
	`is£˘≥rcyl
(
l
)Ë&& (!(
	`is¶ùt€nd
(l)))) {

501 
blksöb™d
 -
b
->
•¨e˙t
 * 
cyl˙t
;

503 i‡((
	`is£˘≥rcyl
(
l
)Ë&& (
	`is¶ùt€nd
(l))) {

504 
blksöb™d
 -(
b
->
•¨e˙t
 * 
cyl˙t
Ë+ b->
num¶ùs
;

506 i‡(
l
->
•¨escheme
 =
SECTPERRANGE_SPARING
) {

507 
blksöb™d
 -
b
->
•¨e˙t
 * (
cyl˙t
 / 
l
->
øngesize
);

510 
	`ddbg_as£π3
(0, ("Unknow¿•¨ög schemê%d", 
l
->
•¨escheme
));

515  
blksöb™d
;

516 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g2.c

30 
	~"œyout_g2.h
"

32 
	~<°dlib.h
>

35 
	#mö
(
x
,
y
Ë(xË< (yË? (xË: (y)

	)

38 
dm_œyout_g2_z⁄e
 *

39 
	$föd_z⁄e_lbn
(
dm_disk_if
 *
d
,

40 
lbn
)

42 
c
;

43 
dm_œyout_g2
 *
l
 = (dm_œyout_g2 *)
d
->
œyout
;

44 
c
 = 0; c < 
l
->
z⁄es_Àn
; c++) {

45 if((
l
->
z⁄es
[
c
].
lb∆ow
 <
lbn
)

46 && (
lbn
 <
l
->
z⁄es
[
c
].
lbnhigh
))

48  &
l
->
z⁄es
[
c
];

51 
	`ddbg_as£π
(0);

54 
	}
}

57 
dm_œyout_g2_z⁄e
 *

58 
	$föd_z⁄e_pbn
(
dm_disk_if
 *
d
,

59 
dm_pbn
 *
p
)

61 
c
;

62 
dm_œyout_g2
 *
l
 = (dm_œyout_g2 *)
d
->
œyout
;

63 
c
 = 0; c < 
l
->
z⁄es_Àn
; c++) {

64 if((
l
->
z⁄es
[
c
].
cyŒow
 <
p
->
cyl
)

65 && (
p
->
cyl
 <
l
->
z⁄es
[
c
].
cylhigh
))

67  &
l
->
z⁄es
[
c
];

70 
	`ddbg_as£π
(0);

73 
	}
}

78 
	$g2_nodecmp
(c⁄° *
p1
, c⁄° *
p2
)

80 
dm_œyout_g2_node
 *
n1
 = (dm_œyout_g2_nodê*)
p1
;

81 
dm_œyout_g2_node
 *
n2
 = (dm_œyout_g2_nodê*)
p2
;

83 if(
n1
->
lbn
 >(
n2
->lb¿+Ç2->
Àn
)) {

86 if(
n2
->
lbn
 >(
n1
->lb¿+Ç1->
Àn
)) {

90 
	}
}

93 
dm_±ﬁ_ªsu…_t


94 
	$…›
(
dm_disk_if
 *
d
,

95 
lbn
,

96 
dm_œyout_m≠ty≥
 
mt
,

97 
dm_pbn
 *
ªsu…
,

98 *
ªm≠£˘‹
)

100 
dm_œyout_g2_node
 
keynode
, *
∫
;

101 
dm_œyout_g2_z⁄e
 *
z
 = 
	`föd_z⁄e_lbn
(
d
,
lbn
);

102 
dm_œyout_g2
 *
l
 = (dm_œyout_g2 *)
d
->
œyout
;

104 
	`mem£t
(&
keynode
, 0, (keynode));

105 
keynode
.
lbn
 =Übn;

106 
keynode
.
Àn
 = 1;

108 
∫
 = 
	`b£¨ch
(&
keynode
,

109 
l
->
…›_m≠
,

110 
l
->
…›_m≠_Àn
,

111 (
dm_œyout_g2_node
),

112 
g2_nodecmp
);

114 if(!
∫
) {

115  
DM_NX
;

118 *
ªsu…
 = 
∫
->
loc
;

119 
ªsu…
->
£˘‹
 +(
lbn
 - 
∫
->lbn);

120  
DM_OK
;

122 
	}
}

125 
dm_±ﬁ_ªsu…_t


126 
	$…›_0t
(
dm_disk_if
 *
d
,

127 
lbn
,

128 
dm_œyout_m≠ty≥
 
mt
,

129 
dm_pbn
 *
ªsu…
,

130 *
ªm≠£˘‹
)

132 
	`ddbg_as£π
(0);

134 
	}
}

137 
dm_±ﬁ_ªsu…_t


138 
	$±ﬁ
(
dm_disk_if
 *
d
,

139 
dm_pbn
 *
p
,

140 *
ªm≠£˘‹
)

142 
i
;

143 
dm_œyout_g2_node
 *
cuº
;

145 
dm_œyout_g2_surf
 *
åack
;

146 
dm_œyout_g2
 *
l
 = (dm_œyout_g2 *)
d
->
œyout
;

148 
	`ddbg_as£π
(
p
->
cyl
 < 
d
->
dm_cyls
);

149 
	`ddbg_as£π
(
p
->
hód
 < 
d
->
dm_surÁ˚s
);

151 
cuº
 = &
l
->
±ﬁ_m≠
[
p
->
cyl
].
surÁ˚s
[p->
hód
].
exã¡s
[0];

152 
i
 = 0;

153 
i
 < 
l
->
±ﬁ_m≠
[
p
->
cyl
].
surÁ˚s
[p->
hód
].
exã¡s_Àn
;

154 
i
++, 
cuº
++)

156 if((
cuº
->
loc
.
cyl
 =
p
->cyl)

157 && (
cuº
->
loc
.
hód
 =
p
->head)

158 && (
p
->
£˘‹
 >
cuº
->
loc
.sector)

159 && (
p
->
£˘‹
 < (
cuº
->
loc
.£˘‹ + cuº->
Àn
)))

162  
cuº
->
lbn
 + (
p
->
£˘‹
 - cuº->
loc
.sector);

166  
DM_NX
;

167 
	}
}

169 
dm_±ﬁ_ªsu…_t


170 
	$±ﬁ_0t
(
dm_disk_if
 *
d
,

171 
dm_pbn
 *
p
,

172 *
ªm≠£˘‹
)

174 
	`ddbg_as£π
(0);

176 
	}
}

182 
	$åkcmp
(c⁄° *
±r1
, c⁄° *
±r2
)

184 c⁄° 
dm_pbn
 *
p1
 = 
±r1
;

185 c⁄° 
dm_pbn
 *
p2
 = 
±r2
;

187 if(
p1
->
cyl
 < 
p2
->cyl)  -1;

188 if(
p2
->
cyl
 < 
p1
->cyl)  1;

190 if(
p1
->
hód
 < 
p2
->head)  -1;

191 if(
p2
->
hód
 < 
p1
->head)  1;

194 
	}
}

197 
dm_±ﬁ_ªsu…_t


198 
	$g2_de„˘_cou¡
(
dm_disk_if
 *
d
,

199 
dm_pbn
 *
åack
,

200 *
ªsu…
)

202 
dm_œyout_g2
 *
l
 = (dm_œyout_g2 *)
d
->
œyout
;

203 
dm_pbn
 *
p
, *
p1
, *
p2
;

205 if(!
l
->
de„˘s_Àn
) {

206 *
ªsu…
 = 0;

207 
out
;

210 
p
 = 
	`b£¨ch
(
åack
,

211 
l
->
de„˘s
,

212 
l
->
de„˘s_Àn
,

213 (
dm_pbn
),

214 
åkcmp
);

216 if(!
p
) {

217 *
ªsu…
 = 0;

220 
p1
 = 
p2
 = 
p
;

222 !
	`åkcmp
(
p1
, 
p
))Ö1--;

223 !
	`åkcmp
(
p2
, 
p
))Ö2++;

225 *
ªsu…
 = 
p2
 - 
p1
 - 1;

228 
out
:

230  
DM_OK
;

231 
	}
}

235 
	$°_lbn
(
dm_disk_if
 *
d
,

236 
lbn
)

238 
dm_œyout_g2_z⁄e
 *
z
 = 
	`föd_z⁄e_lbn
(
d
, 
lbn
);

239  
z
->
°
;

240 
	}
}

243 
	$°_pbn
(
dm_disk_if
 *
d
,

244 
dm_pbn
 *
p
)

246 
dm_pbn
 
p2
 = *
p
;

247 
dm_œyout_g2_z⁄e
 *
z
;

250 !(
z
 = 
	`föd_z⁄e_pbn
(
d
, &
p2
)Ë&&Ö2.
cyl
 >= 0) {Ö2.cyl--; }

251 
	`ddbg_as£π
(
z
);

253  
z
->
°
;

254 
	}
}

258 
	$åack_bound¨õs
(
dm_disk_if
 *
d
,

259 
dm_pbn
 *
p
,

260 *
l1
,

261 *
l2
,

262 *
ªm≠£˘‹
)

264 
dm_pbn
 
p1
, 
p2
;

265 
dm_œyout_g2_z⁄e
 *
z
 = 
	`föd_z⁄e_pbn
(
d
, 
p
);

267 
p1
 = *
p
;

268 
p2
 = *
p
;

270 
p1
.
£˘‹
 = 0;

271 
p2
.
£˘‹
 = 
z
->
°
;

273 if(
l1
) {

275 *
l1
 = 
d
->
œyout
->
	`dm_å™¶©e_±ﬁ
(d, &
p1
, 
ªm≠£˘‹
);

276 
p1
.
£˘‹
++;

277 } (*
l1
 =
DM_NX
Ë&& (
p1
.
£˘‹
 < 
z
->
°
));

280 if(
l2
) {

282 
p2
.
£˘‹
--;

283 *
l2
 = 
d
->
œyout
->
	`dm_å™¶©e_±ﬁ
(d, &
p2
, 
ªm≠£˘‹
);

284 } (*
l2
 =
DM_NX
Ë&& 
p2
.
£˘‹
);

286 
	}
}

288 
dm_™gÀ_t


289 
	$£˘‹_width
(
dm_disk_if
 *
d
,

290 
dm_pbn
 *
åack
,

291 
num
)

293 
dm_œyout_g2_z⁄e
 *
z
 = 
	`föd_z⁄e_pbn
(
d
, 
åack
);

294  
z
->
£˘‹_width
 * 
num
;

295 
	}
}

299 
dm_™gÀ_t


300 
	$pbn_skew_√w
(
dm_disk_if
 *
d
,

301 
dm_pbn
 *
p
)

303 
i
;

304 
œ°hód
, 
œ°cyl
;

306 
dm_œyout_g2
 *
l
 = (dm_œyout_g2 *)
d
->
œyout
;

307 
dm_œyout_g2_z⁄e
 *
z
 = 
	`föd_z⁄e_pbn
(
d
, 
p
);

308 
Êt›_ext
 = 
l
->
±ﬁ_m≠
[
p
->
cyl
].
fú°_…›_exã¡
;

310 
dm_™gÀ_t
 
ªsu…
 = 
l
->
±ﬁ_m≠
[
p
->
cyl
].
skew
;

313 
œ°cyl
 = 
l
->
…›_m≠
[
Êt›_ext
].
loc
.
cyl
;

314 
œ°hód
 = 
l
->
…›_m≠
[
Êt›_ext
].
loc
.
hód
;

316 
i
 = 
Êt›_ext
; i < 
l
->
…›_m≠_Àn
; i++) {

317 if(
l
->
…›_m≠
[
i
].
loc
.
cyl
 !
œ°cyl
) {

318 
ªsu…
 +
z
->
csskew
;

319 
œ°cyl
 = 
l
->
…›_m≠
[
i
].
loc
.
cyl
;

321 if(
l
->
…›_m≠
[
i
].
loc
.
hód
 !
œ°hód
) {

322 
ªsu…
 +
z
->
hsskew
;

323 
œ°hód
 = 
l
->
…›_m≠
[
i
].
loc
.
hód
;

326 if((
l
->
…›_m≠
[
i
].
loc
.
cyl
 =
p
->cyl)

327 && (
l
->
…›_m≠
[
i
].
loc
.
hód
 =
p
->hód)Ë
d⁄e
;

329 
	`ddbg_as£π
(0);

331 
d⁄e
:

333 
ªsu…
 +
p
->
£˘‹
 * 
z
->
£˘‹_width
;

335  
ªsu…
;

336 
	}
}

339 
dm_™gÀ_t


340 
	$pbn_skew
(
dm_disk_if
 *
d
,

341 
dm_pbn
 *
p
)

343 
i
;

344 
œ°cyl
, 
œ°hód
;

345 
dm_™gÀ_t
 
ªsu…
 = 0;

346 
dm_œyout_g2
 *
l
 = (dm_œyout_g2 *)
d
->
œyout
;

347 
dm_œyout_g2_z⁄e
 *
z
 = 
	`föd_z⁄e_pbn
(
d
, 
p
);

353 
i
 = 0; i < 
l
->
…›_m≠_Àn
; i++) {

354 if(
l
->
…›_m≠
[
i
].
loc
.
cyl
 =
z
->
cyŒow
) ;

357 if((
l
->
…›_m≠
[
i
].
loc
.
cyl
 =
p
->cyl)

358 && (
l
->
…›_m≠
[
i
].
loc
.
hód
 =
p
->hód)Ë
d⁄e
;

360 
œ°cyl
 = 
l
->
…›_m≠
[
i
].
loc
.
cyl
;

361 
œ°hód
 = 
l
->
…›_m≠
[
i
].
loc
.
hód
;

365  ; 
i
 < 
l
->
…›_m≠_Àn
; i++) {

366 if(
l
->
…›_m≠
[
i
].
loc
.
cyl
 !
œ°cyl
Ë
ªsu…
 +
z
->
csskew
;

367 if(
l
->
…›_m≠
[
i
].
loc
.
hód
 !
œ°hód
Ë
ªsu…
 +
z
->
hsskew
;

368 if((
l
->
…›_m≠
[
i
].
loc
.
cyl
 =
p
->cyl)

369 && (
l
->
…›_m≠
[
i
].
loc
.
hód
 =
p
->hód)Ë
d⁄e
;

371 
	`ddbg_as£π
(0);

372 
d⁄e
:

373 
ªsu…
 +
p
->
£˘‹
 * 
z
->
£˘‹_width
;

375  
ªsu…
;

376 
	}
}

379 
	$±ﬂ
(
dm_disk_if
 *
d
,

380 
dm_pbn
 *
p
,

381 
dm_™gÀ_t
 *
°¨t
,

382 
dm_™gÀ_t
 *
width
)

384 
dm_œyout_g2_z⁄e
 *
z
 = 
	`föd_z⁄e_pbn
(
d
, 
p
);

386 if(
°¨t
)

387 *
°¨t
 = 
z
->
£˘‹_width
 * 
p
->
£˘‹
;

389 if(
width
)

390 *
°¨t
 = 
z
->
£˘‹_width
;

391 
	}
}

394 
dm_±ﬁ_ªsu…_t


395 
	$©›
(
dm_disk_if
 *
d
,

396 
dm_mech_°©e
 *
a
,

397 
dm_pbn
 *
ªsu…
)

399 
dm_pbn
 
pbn
;

400 
dm_œyout_g2_z⁄e
 *
z
;

401 
ªsu…
->
hód
 = 
a
->head;

402 
ªsu…
->
cyl
 = 
a
->cyl;

404 
pbn
.
hód
 = 
a
->head;

405 
pbn
.
cyl
 = 
a
->cyl;

407 
z
 = 
	`föd_z⁄e_pbn
(
d
, &
pbn
);

409 
ªsu…
->
£˘‹
 = (
a
->
thëa
 / 
z
->
£˘‹_width
Ë% z->
°
;

411  
DM_OK
;

412 
	}
}

415 
dm_±ﬁ_ªsu…_t


416 
	$g2_£ek_di°™˚
(
dm_disk_if
 *
d
,

417 
°¨t_lbn
,

418 
íd_lbn
)

420 
dm_pbn
 
p1
, 
p2
;

421 
rv
;

423 
rv
 = 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
°¨t_lbn
, 
MAP_NONE
, &
p1
, 0);

424 if(
rv
 !
DM_OK
) {

425  
rv
;

428 
rv
 = 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
íd_lbn
, 
MAP_NONE
, &
p2
, 0);

429 if(
rv
 !
DM_OK
) {

430  
rv
;

434  
	`abs
(
p2
.
cyl
 - 
p1
.cyl);

435 
	}
}

440 
	$g2_gë_numz⁄es
(
dm_disk_if
 *
d
)

442 
dm_œyout_g2
 *
l
 = (dm_œyout_g2 *)
d
->
œyout
;

443  
l
->
z⁄es_Àn
;

444 
	}
}

450 
	$g2_gë_z⁄e
(
dm_disk_if
 *
d
, 
n
, 
dm_œyout_z⁄e
 *
ªsu…
)

452 
dm_œyout_g2
 *
l
 = (dm_œyout_g2 *)
d
->
œyout
;

453 
dm_œyout_g2_z⁄e
 *
z
;

455 if(
ªsu…
 == 0) {  -1; }

456 if(
n
 < 0 ||Ç >
l
->
z⁄es_Àn
) {  -1; }

458 
z
 = &
l
->
z⁄es
[
n
];

460 
ªsu…
->
•t
 = 
z
->
°
;

462 
ªsu…
->
lbn_low
 = 
z
->
lb∆ow
;

463 
ªsu…
->
lbn_high
 = 
z
->
lbnhigh
;

465 
ªsu…
->
cyl_low
 = 
z
->
cyŒow
;

466 
ªsu…
->
cyl_high
 = 
z
->
cylhigh
;

470 
	}
}

473 
dm_œyout_if
 
	gœyout_g2
 = {

474 
…›
,

475 
…›_0t
,

476 
±ﬁ
,

477 
±ﬁ_0t
,

478 
°_lbn
,

479 
°_pbn
,

480 
åack_bound¨õs
,

481 
g2_£ek_di°™˚
,

482 
pbn_skew_√w
,

484 
±ﬂ
,

485 
©›
,

486 
£˘‹_width
,

490 
g2_gë_numz⁄es
,

491 
g2_gë_z⁄e
,

492 
g2_de„˘_cou¡


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g2.h

30 #i‚de‡
_DM_LAYOUT_G2_H


31 
	#_DM_LAYOUT_G2_H


	)

33 
	~"dm.h
"

35 
	sdm_œyout_g2
 {

36 
dm_œyout_if
 
	mhdr
;

38 
dm_œyout_g2_node
 *
	m…›_m≠
;

39 
dm_œyout_g2_cyl
 *
	m±ﬁ_m≠
;

40 
	m…›_m≠_Àn
;

42 
dm_œyout_g2_z⁄e
 *
	mz⁄es
;

43 
	mz⁄es_Àn
;

45 *
	mm≠fûe
;

46 
dm_skew_unô_t
 
	mskew_unôs
;

51 
dm_pbn
 *
	mde„˘s
;

52 
	mde„˘s_Àn
;

56 
	sdm_œyout_g2_node
 {

57 
	mlbn
;

60 
dm_pbn
 
	mloc
;

61 
	mÀn
;

64 
	sdm_œyout_g2_cyl
 {

65 
dm_œyout_g2_surf
 *
	msurÁ˚s
;

66 
	msurÁ˚s_Àn
;

67 
dm_™gÀ_t
 
	mskew
;

68 
	mfú°_…›_exã¡
;

71 
	sdm_œyout_g2_surf
 {

72 
	mlb∆ow
;

73 
	mlbnhigh
;

75 
dm_œyout_g2_node
 *
	mexã¡s
;

76 
	mexã¡s_Àn
;

80 
	sdm_œyout_g2_z⁄e
 {

81 
	m°
;

82 
	mcyŒow
;

83 
	mcylhigh
;

85 
	mlb∆ow
;

86 
	mlbnhigh
;

88 
dm_™gÀ_t
 
	mcsskew
;

89 
dm_™gÀ_t
 
	mhsskew
;

90 
dm_™gÀ_t
 
	mzskew
;

92 
dm_™gÀ_t
 
	m£˘‹_width
;

94 
dm_skew_unô_t
 
	mskew_unôs
;

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g2_load.c

30 
	~<lib∑øm/lib∑øm.h
>

31 
	~<lib∑øm/bôve˘‹.h
>

33 
	~<°rög.h
>

34 
	~<°dio.h
>

35 
	~<°dlib.h
>

37 
	~"œyout_g2.h
"

39 
	~"moduÀs/dm_œyout_g2_∑øm.h
"

42 
dm_œyout_if
 
œyout_g2
;

43 íum { 
	mREVOLUTIONS
, 
	mSECTORS
, 
	mNONE
 } 
	tskew_unô_t
;

44 
	~"moduÀs/dm_œyout_g2_z⁄e_∑øm.h
"

46 
	gde„˘s_Àn
 = 0;

47 
dm_pbn
 *
	gde„˘s
;

51 
g2_lﬂd_z⁄es
(
dm_œyout_g2
 *
l
,

52 
Õ_li°
 *
zl
);

56 
	$åackcmp
(c⁄° *
p1
,

57 c⁄° *
p2
)

59 
dm_œyout_g2_node
 *
n1
 = (dm_œyout_g2_nodê*)
p1
;

60 
dm_œyout_g2_node
 *
n2
 = (dm_œyout_g2_nodê*)
p2
;

62 if(
n1
->
loc
.
cyl
 < 
n2
->loc.cyl) {

65 if(
n1
->
loc
.
cyl
 > 
n2
->loc.cyl) {

69 if(
n1
->
loc
.
hód
 < 
n2
->loc.head) {

72 if(
n1
->
loc
.
hód
 > 
n2
->loc.head) {

76 if(
n1
->
loc
.
£˘‹
 < 
n2
->loc.sector) {

79 if(
n1
->
loc
.
£˘‹
 > 
n2
->loc.sector) {

85 
	}
}

87 
	$œyout_g2_lﬂdm≠
(
dm_œyout_g2
 *
l
)

89 
FILE
 *
fd
;

90 
junk
[1024];

91 
cou¡°r
[16];

92 *
m≠fûe
;

94 
exã¡guess
;

95 
exã¡s_˘
 = 0;

97 
dm_pbn
 
pbn
;

98 
lbn
,
c
,
h
,
s
,
cou¡
;

99 
œ°c
, 
œ°h
;

100 
cyls
, 
hóds
;

101 
i
, 
j
;

103 **
åack_ext_cou¡s
;

105 
dm_œyout_g2_node
 *
cuº
;

106 
dm_œyout_g2_node
 *
åack_exã¡s
;

108 
dm_pbn
 *
cuºde„˘
;

110 
m≠fûe
 = 
	`Õ_£¨ch_∑th
(
Õ_cwd
, 
l
->mapfile);

112 
fd
 = 
	`f›í
(
m≠fûe
, "r");

113 
	`ddbg_as£π3
(
fd
 !0, ("ÁûedÅÿ›íÜayouàm≠pög†fûê%s", 
l
->
m≠fûe
));

116 
	`fgës
(
junk
, (junk), 
fd
);

117 
	`fgës
(
junk
, (junk), 
fd
);

119 if(
	`fsˇnf
(
fd
, "%d cylödîs, %*dÑŸ, %d hóds\n", &
cyls
, &
hóds
) != 2) {

120 
	`ddbg_as£π2
(0, "***Érror:Üayout_g2_loadmap:Çeed <cyls> ... <heads>\n");

126 
exã¡guess
 = 
cyls
 * 
hóds
 * 2;

127 
exã¡guess
 +=Éxtentguess/4;

128 
l
->
…›_m≠
 = 
	`ˇŒoc
(
exã¡guess
, (
dm_œyout_g2_node
));

129 
cuº
 = &
l
->
…›_m≠
[0];

131 
l
->
±ﬁ_m≠
 = 
	`ˇŒoc
(
cyls
, (
dm_œyout_g2_cyl
));

133 
i
 = 0; i < 
cyls
; i++) {

134 
l
->
±ﬁ_m≠
[
i
].
surÁ˚s
 = 
	`ˇŒoc
(
hóds
, (
dm_œyout_g2_surf
));

137 
åack_ext_cou¡s
 = 
	`ˇŒoc
(
cyls
, (*));

138 
i
 = 0; i < 
cyls
; i++) {

139 
åack_ext_cou¡s
[
i
] = 
	`ˇŒoc
(
hóds
, ());

142 
cuº
 = &
l
->
…›_m≠
[0];

144 
	`fsˇnf
(
fd
, "lbn %d --> cyl %d, head %d, sect %d, %s %d\n",

145 &
cuº
->
lbn
,

146 &
cuº
->
loc
.
cyl
,

147 &
cuº
->
loc
.
hód
,

148 &
cuº
->
loc
.
£˘‹
,

149 
cou¡°r
,

150 &
cuº
->
Àn
) == 6)

152 if(!
	`°rcmp
(
cou¡°r
, "seqcnt")) {

153 
cuº
->
Àn
++;

156 
åack_ext_cou¡s
[
cuº
->
loc
.
cyl
][cuº->loc.
hód
]++;

157 
cuº
++;

158 
exã¡s_˘
++;

159 
l
->
…›_m≠_Àn
++;

163 
åack_exã¡s
 = 
	`ˇŒoc
(
exã¡s_˘
, (
dm_œyout_g2_node
));

164 
	`mem˝y
(
åack_exã¡s
, 
l
->
…›_m≠
, 
exã¡s_˘
 * (
dm_œyout_g2_node
));

166 
	`qs‹t
(
åack_exã¡s
, 
exã¡s_˘
, (
dm_œyout_g2_node
),

167 
åackcmp
);

170 
cuº
 = &
åack_exã¡s
[0];

171 
i
 = 0; i < 
cyls
; i++) {

172 
j
 = 0; j < 
hóds
; j++) {

173 
k
;

174 
exã¡s_Àn
 = 
åack_ext_cou¡s
[
i
][
j
];

176 
l
->
±ﬁ_m≠
[
i
].
surÁ˚s
[
j
].
exã¡s
 = 
	`ˇŒoc
(
exã¡s_Àn
, (
dm_œyout_g2_node
));

177 
l
->
±ﬁ_m≠
[
i
].
surÁ˚s
[
j
].
exã¡s_Àn
 =Éxtents_len;

179 
k
 = 0; k < 
exã¡s_Àn
; k++) {

180 
l
->
±ﬁ_m≠
[
i
].
surÁ˚s
[
j
].
exã¡s
[
k
] = *
cuº
;

181 
cuº
++;

188 
	`‰ì
(
åack_exã¡s
);

195 
de„˘s
 = 
	`ˇŒoc
(
exã¡s_˘
 >> 3, (
dm_pbn
));

196 
cuºde„˘
 = &
de„˘s
[0];

197 
	`fsˇnf
(
fd
, "Defectát cyl %d, head %d, sect %d\n",

198 &
cuºde„˘
->
cyl
,

199 &
cuºde„˘
->
hód
,

200 &
cuºde„˘
->
£˘‹
) == 3)

202 
cuºde„˘
++;

203 
de„˘s_Àn
++;

209 
	`f˛o£
(
fd
);

211 
	}
}

215 
	$¥ecompuã_skews
(
dm_disk_if
 *
d
)

217 
i
 = 0;

218 
dm_œyout_g2
 *
l
 = (dm_œyout_g2 *)
d
->
œyout
;

219 
dm_œyout_g2_z⁄e
 *
z
 = &
l
->
z⁄es
[0];

221 
i
 = 0; i < 
d
->
dm_cyls
; i++) {

222 
l
->
±ﬁ_m≠
[
i
].
fú°_…›_exã¡
 = -1;

225 
l
->
±ﬁ_m≠
[0].
fú°_…›_exã¡
 = 0;

227 
i
 = 0 ; i < 
l
->
…›_m≠_Àn
; i++) {

228 
cuºcyl
 = 
l
->
…›_m≠
[
i
].
loc
.
cyl
;

230 if(
l
->
±ﬁ_m≠
[
cuºcyl
].
fú°_…›_exã¡
 == -1) {

231 
l
->
±ﬁ_m≠
[
cuºcyl
].
fú°_…›_exã¡
 = 
i
;

233 if(
z
->
cylhigh
 < 
cuºcyl
) {

234 
z
++;

238 if(
cuºcyl
 =
z
->
cyŒow
) {

239 
l
->
±ﬁ_m≠
[
cuºcyl
].
skew
 = 
z
->
zskew
;

242 
l
->
±ﬁ_m≠
[
cuºcyl
 + 1].
skew
 =Ü->ptol_map[currcyl].skew;

246 if(
l
->
…›_m≠
[
i
+1].
loc
.
cyl
 !=Ü->ltop_map[i].loc.cyl) {

247 
l
->
±ﬁ_m≠
[
cuºcyl
+1].
skew
 +
z
->
csskew
;

249 if(
l
->
…›_m≠
[
i
+1].
loc
.
hód
 !=Ü->ltop_map[i].loc.head) {

250 
l
->
±ﬁ_m≠
[
cuºcyl
+1].
skew
 +
z
->
hsskew
;

255 
	}
}

279 
	$pbncmp
(c⁄° *
±r1
, c⁄° *
±r2
)

281 c⁄° 
dm_pbn
 *
p1
 = 
±r1
;

282 c⁄° 
dm_pbn
 *
p2
 = 
±r2
;

284 if(
p1
->
cyl
 < 
p2
->cyl)  -1;

285 if(
p2
->
cyl
 < 
p1
->cyl)  1;

287 if(
p1
->
hód
 < 
p2
->head)  -1;

288 if(
p2
->
hód
 < 
p1
->head)  1;

290 if(
p1
->
£˘‹
 < 
p2
->sector)  -1;

291 if(
p2
->
£˘‹
 < 
p1
->sector)  1;

293 
	}
}

297 
	$g2_föish_de„˘s
(
dm_œyout_g2
 *
l
)

299 
l
->
de„˘s
 = defects;

301 
	`qs‹t
(
l
->
de„˘s
, 
de„˘s_Àn
, (
dm_pbn
), 
pbncmp
);

303 
l
->
de„˘s_Àn
 = defects_len;

305 
de„˘s
 = 0;

306 
de„˘s_Àn
 = 0;

307 
	}
}

309 
dm_œyout_if
 *

310 
	$dm_œyout_g2_lﬂd∑øms
(
Õ_block
 *
b
, 
dm_disk_if
 *
∑ª¡
) {

311 
i
;

312 
rv
;

314 
dm_œyout_g2
 *
ªsu…
 = 
	`mÆloc
((dm_layout_g2));

315 
	`mem£t
(
ªsu…
, 0, (
dm_œyout_g2
));

318 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
dm_œyout_g2_mod
);

320 
rv
 = 
	`œyout_g2_lﬂdm≠
(
ªsu…
);

321 
	`ddbg_as£π
(
rv
 == 0);

322 
	`‰ì
(
ªsu…
->
m≠fûe
);

323 
ªsu…
->
m≠fûe
 = 0;

327 
ªsu…
->
hdr
 = 
œyout_g2
;

329 
∑ª¡
->
œyout
 = (
dm_œyout_if
 *)
ªsu…
;

332 
	`¥ecompuã_skews
(
∑ª¡
);

335 
	`g2_föish_de„˘s
(
ªsu…
);

337  (
dm_œyout_if
 *)
ªsu…
;

338 
	}
}

343 
	$g2_lﬂd_z⁄e
(
dm_œyout_g2_z⁄e
 *
ªsu…
,

344 
Õ_block
 *
b
)

348 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
dm_œyout_g2_z⁄e_mod
);

351 
	}
}

354 
	$g2_lﬂd_z⁄es
(
dm_œyout_g2
 *
l
,

355 
Õ_li°
 *
zl
)

357 
i
;

358 
z
 = 0;

360 
l
->
z⁄es_Àn
 = 0;

362 
i
 = 0; i < 
zl
->
vÆues_Àn
; i++) {

363 if(
zl
->
vÆues
[
i
] != 0) {

364 
l
->
z⁄es_Àn
++;

368 
l
->
z⁄es
 = 
	`mÆloc
÷->
z⁄es_Àn
 * (
dm_œyout_g2_z⁄e
));

369 
	`mem£t
(
l
->
z⁄es
, 0,Ü->
z⁄es_Àn
 * (
dm_œyout_g2_z⁄e
));

371 
i
 = 0; i < 
zl
->
vÆues_Àn
; i++) {

372 if(!
zl
->
vÆues
[
i
]) ;

374 
	`g2_lﬂd_z⁄e
(&
l
->
z⁄es
[
z
], 
zl
->
vÆues
[
i
]->
v
.
b
);

375 
z
++;

378 
	}
}

382 
	$dm_œyout_g2_z⁄e_lﬂd∑øms
(
Õ_block
 *
b
)

384 
	`ddbg_as£π
(0);

386  
DM_OK
;

387 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g4.c

30 
	~"dm.h
"

32 
	~"œyout_g4.h
"

33 
	~"œyout_g4_¥iv©e.h
"

35 #ifde‡
_WIN32


36 
	#ölöe
 
__ölöe


	)

37 
	#__ölöe__
 
__ölöe


	)

40 
ölöe
 
	$mö
(
x
, 
y
) {

41  
x
 < 
y
 ? x : y;

42 
	}
}

63 
	$¶ùcou¡_bös
(
dm_œyout_g4
 *
l
,

64 
lbn
,

65 
low
,

66 
high
)

68 
	`ddbg_as£π
(
low
 <
high
);

69 
	`ddbg_as£π
(0 <
low
);

70 
	`ddbg_as£π
(
high
 <
l
->
¶ùs_Àn
);

72 if(
high
 =
low
+1 || high ==Üow) {

73  
low
;

76 
mid±
 = 
low
 + ((
high
 -Üow) / 2);

77 if(
l
->
¶ùs
[
mid±
].
off
 > 
lbn
) {

78 
high
 = 
mid±
;

81 
low
 = 
mid±
;

83  
	`¶ùcou¡_bös
(
l
,
lbn
,
low
,
high
);

85 
	}
}

88 
	$¶ùcou¡
(
dm_œyout_g4
 *
l
,

89 
lbn
)

91 
i
;

92 
˘
;

93 
l2
 = 
lbn
;

96 
i
 = 
	`¶ùcou¡_bös
(
l
, 
lbn
, 0,Ü->
¶ùs_Àn
);

97 
	`ddbg_as£π
(0 <
i
);

98 
	`ddbg_as£π
(
i
 < 
l
->
¶ùs_Àn
);

100 
˘
 = 
l
->
¶ùs
[
i
].
cou¡
;

102 
i
 < 
l
->
¶ùs_Àn
 &&Ü->
¶ùs
[i].
off
 <
l2
) {

103 
˘
 = 
l
->
¶ùs
[
i
].
cou¡
;

104 
l2
 = 
lbn
 + 
˘
;

105 
i
++;

108  
˘
;

109 
	}
}

112 
	$¶ùcou¡_ªv
(
dm_œyout_g4
 *
l
,

113 
lbn
,

114 *
¶ù_Àn
)

116 
i
 = 0;

119 
i
 = 
	`¶ùcou¡_bös
(
l
, 
lbn
, 0,Ü->
¶ùs_Àn
);

120 
	`ddbg_as£π
(0 <
i
);

121 
	`ddbg_as£π
(
i
 < 
l
->
¶ùs_Àn
);

123 if(
l
->
¶ùs
[
i
].
off
 <
lbn


124 && (
i
 > 0

125 && 
lbn
 < 
l
->
¶ùs
[
i
].
off


126 + (
l
->
¶ùs
[
i
].
cou¡
 -Ü->slips[i-1].count)))

128 if(
¶ù_Àn
) {

129 
	`ddbg_as£π
(0);

135  
l
->
¶ùs
[
i
].
cou¡
;

137 
	}
}

140 
ªm≠
 *

141 
	$ªm≠_lbn
(
dm_œyout_g4
 *
l
,

142 
lbn
)

144 
i
;

145 
ªm≠
 *
r
, *
ªsu…
 = 0;

147 
i
 = 0, 
r
 = &
l
->
ªm≠s
[i]; i <Ü->
ªm≠s_Àn
; i++,Ñ++) {

148 if(
r
->
off
 <
lbn
 &&Üb¿< (r->of‡+Ñ->
cou¡
)) {

149 
ªsu…
 = 
r
;

154  
ªsu…
;

155 
	}
}

158 
ªm≠
 *

159 
	$ªm≠_pbn
(
dm_œyout_g4
 *
l
,

160 
dm_pbn
 *
p
)

162 
i
;

163 
ªm≠
 *
r
, *
ªsu…
 = 0;

164 
i
 = 0, 
r
 = &
l
->
ªm≠s
[i]; i <Ü->
ªm≠s_Àn
; i++,Ñ++) {

165 if(
r
->
de°
.
cyl
 =
p
->cyl

166 && 
r
->
de°
.
hód
 =
p
->head

167 && 
r
->
de°
.
£˘‹
 <
p
->sector

168 && 
p
->
£˘‹
 < (
r
->
de°
.£˘‹ +Ñ->
cou¡
))

170 
ªsu…
 = 
r
;

175  
ªsu…
;

176 
	}
}

184 
	$g4_∑th_≠≥nd
(
g4_∑th
 *
p
,

185 
g4_node
 
n
,

186 
g4_node_t
 
t
,

187 
i
,

188 
quŸ
,

189 
ªsid
)

192 
g4_∑th_node
 *
µ
 = &
p
->
∑th
[p->
Àngth
];

194 
µ
->
n
 =Ç;

195 
µ
->
ty≥
 = 
t
;

196 
µ
->
i
 = i;

198 
µ
->
quŸ
 = quot;

199 
µ
->
ªsid
 =Ñesid;

201 ++
p
->
Àngth
;

202 
	}
}

207 
g4_∑th
 *

208 
	$g4_r
(
dm_œyout_g4
 *
l
,

209 
g4_node
 *
n
,

210 
g4_node_t
 
t
,

211 *
lbn
,

212 
max
,

213 
dm_pbn
 *
p
,

214 
g4_∑th
 *
acc
)

216 
i
;

217 
g4_node
 *
¬
;

218 
g4_node_t
 
â
;

220 
quŸ
 = 0;

221 
ªsid
 = 1;

223 
	`ddbg_as£π
(
lbn
 || 
p
);

225 
t
) {

226 
TRACK
:

227 if(
lbn
) {

228 if(
n
->
t
->
low
 <*
lbn
 && *lb¿<n->t->
high
) {

231 
ªsid
 = *
lbn
 - 
n
->
t
->
low
;

233 
¬
 = 0;

234 
out
;

237 
out_îr
;

241 if(
n
->
t
->
low
 <
p
->
£˘‹
 &&Ö->£˘‹ <n->t->
high
) {

242 if(
p
->
£˘‹
 > 
max
) {

243 
out_îr
;

247 
ªsid
 = 
p
->
£˘‹
 - 
n
->
t
->
low
;

249 
¬
 = 0;

250 
out
;

253 
out_îr
;

258 
IDX
:

260 
idx_ít
 *
e
;

261 
i
 = 0, 
e
 = &
n
->i->
íts
[0]; i <Ç->i->
íts_Àn
; i++,É++)

263 if(
lbn
) {

264 if(
e
->
lbn
 <*lb¿&& *lb¿< (e->lb¿+É->
ru∆í
)) {

265 *
lbn
 -
e
->lbn;

267 
quŸ
 = *
lbn
 / 
e
->
Àn
;

269 
quŸ
 = 
e
->
cyÃu∆í
 < 0 ? -quot : quot;

270 
ªsid
 = *
lbn
 % 
e
->
Àn
;

272 
¬
 = &
e
->
chûd
;

273 
â
 = 
e
->
chûdty≥
;

275 *
lbn
 = 
ªsid
;

276 
out
;

280 
low
 = 
e
->
cyÃu∆í
 > 0 ?É->
cyl
 :É->cyl +É->cylrunlen + 1;

281 
high
 = 
e
->
cyÃu∆í
 < 0 ?É->
cyl
 :É->cyl +É->cylrunlen - 1;

282 if(
low
 <
p
->
cyl
 &&Ö->cy»<
high


283 && (
e
->
chûdty≥
 !
TRACK
 || 
p
->
hód
 ==É->head))

286 
p
->
cyl
 -
e
->cyl;

288 
quŸ
 = 
p
->
cyl
 / 
e
->
cyŒí
;

289 
ªsid
 = 
p
->
cyl
 % 
e
->
cyŒí
;

291 
max
 = 
	`mö
(max, 
e
->
lbn
 +É->
ru∆í
 - 1);

292 
max
 -
e
->
lbn
;

295 
quŸ
 = 
p
->
cyl
 / 
e
->
cyŒí
;

297 
quŸ
 = 
e
->
cyÃu∆í
 < 0 ? -quot : quot;

298 
max
 = 
	`mö
(max, (
quŸ
+1Ë* 
e
->
Àn
 - 1);

299 
max
 -
quŸ
 * 
e
->
Àn
;

301 
ªsid
 = 
p
->
cyl
 % 
e
->
cyŒí
;

303 
p
->
cyl
 = 
ªsid
;

305 
¬
 = &
e
->
chûd
;

306 
â
 = 
e
->
chûdty≥
;

307 
out
;

311 
out_îr
;

314 
	`ddbg_as£π
(0);

318 
out
:

319 
	`g4_∑th_≠≥nd
(
acc
, *
n
, 
t
, 
i
, 
quŸ
, 
ªsid
);

320 if(
¬
) {

321  
	`g4_r
(
l
, 
¬
, 
â
, 
lbn
, 
max
, 
p
, 
acc
);

324  
acc
;

327 
out_îr
:

328 
	`‰ì
(
acc
);

330 
	}
}

332 
g4_∑th
 *

333 
	$g4_ªcur£
(
dm_œyout_g4
 *
l
, *
lbn
, 
dm_pbn
 *
p
)

335 
lbnc›y
;

336 
dm_pbn
 
pbnc›y
;

337 
g4_∑th
 *
acc
 = 
	`ˇŒoc
(1, (*acc));

338 
g4_node
 
n
;

339 
max
;

341 if(
lbn
) {

342 
lbnc›y
 = *
lbn
;

343 
lbn
 = &
lbnc›y
;

346 if(
p
) {

347 
pbnc›y
 = *
p
;

348 
p
 = &
pbnc›y
;

351 
n
.
i
 = 
l
->
roŸ
;

352 
	`g4_∑th_≠≥nd
(
acc
, 
n
, 
IDX
,

357 
max
 = 
l
->
∑ª¡
->
dm_£˘‹s
-1;

358 
max
 +
	`¶ùcou¡_ªv
(
l
, max, 0);

359  
	`g4_r
(
l
, &
n
, 
IDX
, 
lbn
, 
max
, 
p
, 
acc
);

360 
	}
}

363 
dm_±ﬁ_ªsu…_t


364 
	$…›
(
dm_disk_if
 *
d
,

365 
lbn
,

366 
dm_œyout_m≠ty≥
 
junk
,

367 
dm_pbn
 *
ªsu…
,

368 *
ªm≠£˘‹
)

370 
dm_œyout_g4
 *
l
 = (dm_œyout_g4 *)
d
->
œyout
;

371 
ªm≠
 *
r
;

373 if(
lbn
 < 0 || 
d
->
dm_£˘‹s
 <=Übn) {

374  
DM_NX
;

377 if((
r
 = 
	`ªm≠_lbn
(
l
, 
lbn
))) {

378 *
ªsu…
 = 
r
->
de°
;

379 
ªsu…
->
£˘‹
 +(
lbn
 - 
r
->
off
);

380  
DM_OK
;

385 
i
;

386 
g4_∑th
 *
p
;

387 
g4_∑th_node
 *
n
;

390 
lbn
 +
	`¶ùcou¡
(
l
,Übn);

392 
p
 = 
	`g4_ªcur£
(
l
, &
lbn
, 0);

393 if(!
p
) {

394  
DM_NX
;

397 
i
 = 0; i < 
p
->
Àngth
; ++i) {

398 
n
 = &
p
->
∑th
[
i
];

399 
n
->
ty≥
) {

400 
TRACK
:

401 
ªsu…
->
£˘‹
 = 
n
->n.
t
->
low
 + 
lbn
;

404 
IDX
:

406 
idx_ít
 *
e
 = &
n
->n.
i
->
íts
[n->i];

407 
lbn
 -
e
->lbn;

409 if(
i
 > 0) {

410 
ªsu…
->
cyl
 +
e
->cy»+ (
n
->
quŸ
 *É->
cyŒí
);

413 
ªsu…
->
cyl
 = 
e
->cy»+ (
n
->
quŸ
 *É->
cyŒí
);

416 if(
e
->
chûdty≥
 =
TRACK
) {

417 
ªsu…
->
hód
 = 
e
->head;

420 
lbn
 = 
n
->
ªsid
;

423 : 
	`ddbg_as£π
(0); ;

426 
	`‰ì
(
p
);

429  
DM_OK
;

430 
	}
}

433 
dm_±ﬁ_ªsu…_t


434 
	$±ﬁ
(
dm_disk_if
 *
d
,

435 
dm_pbn
 *
pbn
,

436 *
ªm≠£˘‹
)

438 
ªsu…
 = 0;

439 
dm_pbn
 
pbnc›y
 = *
pbn
;

440 
ªm≠
 *
r
;

442 
dm_œyout_g4
 *
l
 = (dm_œyout_g4 *)
d
->
œyout
;

444 
pbn
 = &
pbnc›y
;

446 if((
r
 = 
	`ªm≠_pbn
(
l
, 
pbn
))) {

447  
r
->
off
 + 
pbn
->
£˘‹
 -Ñ->
de°
.sector;

450 
rv
 = 0;

451 
i
;

452 
g4_∑th
 *
∑th
;

453 
g4_∑th_node
 *
n
;

455 
∑th
 = 
	`g4_ªcur£
(
l
, 0, 
pbn
);

457 if(!
∑th
) {

458  
DM_NX
;

461 
i
 = 0; i < 
∑th
->
Àngth
; ++i) {

462 
n
 = &
∑th
->∑th[
i
];

463 
n
->
ty≥
) {

464 
TRACK
:

465 
ªsu…
 +(
pbn
->
£˘‹
 - 
n
->n.
t
->
low
);

467 
IDX
:

469 
idx_ít
 *
e
 = &
n
->n.
i
->
íts
[n->i];

471 
pbn
->
cyl
 -
e
->cyl;

473 if(
i
 > 0) {

474 
ªsu…
 +
e
->
lbn
 + (
n
->
quŸ
 *É->
Àn
);

477 
ªsu…
 = 
e
->
lbn
 + (
n
->
quŸ
 *É->
Àn
);

480 
pbn
->
cyl
 = 
n
->
ªsid
;

484 : 
	`ddbg_as£π
(0); ;

490 
rv
 = 
	`¶ùcou¡_ªv
(
l
, 
ªsu…
, 
NULL
);

491 if(
rv
 == -1) {

492 
ªsu…
 = 
DM_NX
;

495 
ªsu…
 -
rv
;

498 
	`‰ì
(
∑th
);

501  
ªsu…
;

502 
	}
}

506 
	$g4_•t
(
dm_œyout_g4
 *
l
,

507 *
lbn
,

508 
dm_pbn
 *
pbn
)

510 
g4_∑th
 *
p
;

511 
g4_∑th_node
 *
n
;

512 
rv
;

514 
p
 = 
	`g4_ªcur£
(
l
, 
lbn
, 
pbn
);

516 if(
p
) {

517 
n
 = &
p
->
∑th
[p->
Àngth
 - 1];

518 
	`ddbg_as£π
(
n
->
ty≥
 =
TRACK
);

519 
rv
 = 
n
->n.
t
->
•t
;

520 
	`‰ì
(
p
);

523 
rv
 = -1;

526  
rv
;

527 
	}
}

530 
	$g4_•t_lbn
(
dm_disk_if
 *
d
,

531 
lbn
)

533 
ªsu…
;

534 
dm_œyout_g4
 *
l
 = (dm_œyout_g4 *)
d
->
œyout
;

535 
ªm≠
 *
r
;

537 
lbn
 +
	`¶ùcou¡
(
l
,lbn);

538 
r
 = 
	`ªm≠_lbn
(
l
, 
lbn
);

540 if(
r
) {

541  
r
->
•t
;

544  
	`g4_•t
(
l
, &
lbn
, 0);

546 
	}
}

550 
	$g4_•t_pbn
(
dm_disk_if
 *
d
,

551 
dm_pbn
 *
p
)

553 
ªsu…
;

554 
dm_œyout_g4
 *
l
 = (dm_œyout_g4 *)
d
->
œyout
;

555 
ªm≠
 *
r
;

556 if((
r
 = 
	`ªm≠_pbn
(
l
, 
p
))) {

557  
r
->
•t
;

560  
	`g4_•t
(
l
, 0, 
p
);

562 
	}
}

569 
dm_±ﬁ_ªsu…_t


570 
	$g4_åack_bound
(
dm_disk_if
 *
d
,

571 
dm_pbn
 *
pbn
,

572 *
l0
,

573 *
 
,

574 *
ªm≠£˘‹
)

576 
lbn
;

577 
ªm≠
 *
r
;

578 
dm_pbn
 
pi
;

579 
dm_œyout_g4
 *
l
 = (dm_œyout_g4 *)
d
->
œyout
;

581 
•t
 = 
	`g4_•t_pbn
(
d
, 
pbn
);

584 
lbn
 = 
	`±ﬁ
(
d
, 
pbn
, 0);

589 if(
l0
) {

590 
pi
 = *
pbn
;

591 
pi
.
£˘‹
 = 0;

593 (*
l0
 = 
	`±ﬁ
(
d
, &
pi
, 0)) < 0) {

594 
pi
.
£˘‹
++;

597 
	`ddbg_as£π
(*
l0
 < 
d
->
dm_£˘‹s
);

600 if(
 
) {

601 
pi
 = *
pbn
;

602 
pi
.
£˘‹
 = 
•t
-1;

604 (*
 
 = 
	`±ﬁ
(
d
, &
pi
, 0)) < 0) {

605 
pi
.
£˘‹
--;

606 
	`ddbg_as£π
(
pi
.
£˘‹
 >= 0);

609 
	`ddbg_as£π
(*
 
 < 
d
->
dm_£˘‹s
);

612 i‡(
l0
 && 
 
) {

613 
	`ddbg_as£π
(*
l0
 <*
 
);

617 if(
lbn
 < 0) {

618  
lbn
;

621  
DM_OK
;

622 
	}
}

625 
dm_™gÀ_t


626 
	$g4_£˘‹_width
(
dm_disk_if
 *
d
,

627 
dm_pbn
 *
åack
,

628 
num
)

630 
dm_œyout_g4
 *
l
 = (dm_œyout_g4 *)
d
->
œyout
;

632 
dm_™gÀ_t
 
ªsu…
;

633 
ªm≠
 *
r
;

635 if((
r
 = 
	`ªm≠_pbn
(
l
, 
åack
))) {

636 
ªsu…
 = 
r
->
sw
;

639 
g4_∑th
 *
p
;

640 
g4_∑th_node
 *
n
;

641 
p
 = 
	`g4_ªcur£
(
l
, 0, 
åack
);

643 if(!
p
) {

645 
ªsu…
 = 0;

648 
n
 = &
p
->
∑th
[p->
Àngth
 - 1];

649 
	`ddbg_as£π
(
n
->
ty≥
 =
TRACK
);

650 
ªsu…
 = 
n
->n.
t
->
sw
;

651 
	`‰ì
(
p
);

655  
ªsu…
;

656 
	}
}

660 
dm_™gÀ_t


661 
	$g4_skew
(
dm_disk_if
 *
d
,

662 
dm_pbn
 *
pbn
)

664 
dm_œyout_g4
 *
l
 = (dm_œyout_g4 *)
d
->
œyout
;

665 
g4_∑th
 *
p
;

666 
g4_∑th_node
 *
n
;

667 
i
;

668 
dm_™gÀ_t
 
ªsu…
;

670 
p
 = 
	`g4_ªcur£
(
l
, 0, 
pbn
);

671 if(!
p
) {

676 
i
 = 0; i < 
p
->
Àngth
; ++i) {

677 
n
 = &
p
->
∑th
[
i
];

678 
n
->
ty≥
) {

679 
TRACK
:

680 
ªsu…
 +
n
->
ªsid
 *Ç->n.
t
->
sw
;

683 
IDX
:

685 
idx_ít
 *
e
 = &
n
->n.
i
->
íts
[n->i];

687 if(
i
 > 0) {

688 
ªsu…
 +
e
->
off
;

691 
ªsu…
 = 
e
->
off
;

694 
ªsu…
 +
n
->
quŸ
 * 
e
->
Æí
;

698 : 
	`ddbg_as£π
(0); ;

702 
	`‰ì
(
p
);

703  
ªsu…
;

704 
	}
}

711 
dm_±ﬁ_ªsu…_t


712 
	$g4_©›
(
dm_disk_if
 *
d
,

713 
dm_mech_°©e
 *
m
,

714 
dm_pbn
 *
p
)

717 
dm_™gÀ_t
 
sw
;

718 
p
->
cyl
 = 
m
->cyl;

719 
p
->
hód
 = 
m
->head;

720 
p
->
£˘‹
 = 0;

722 
sw
 = 
	`g4_£˘‹_width
(
d
, 
p
, 1);

723 
p
->
£˘‹
 = 
m
->
thëa
 / 
sw
;

726  
d
->
œyout
->
	`dm_å™¶©e_±ﬁ
(d, 
p
, 0);

727 
	}
}

729 
dm_±ﬁ_ªsu…_t


730 
	$g4_de„˘_cou¡
(
dm_disk_if
 *
d
,

731 
dm_pbn
 *
åack
,

732 *
ªsu…
)

735 *
ªsu…
 = 0;

737 
	}
}

745 
	$g4_gë_numz⁄es
(
dm_disk_if
 *
d
)

747 
dm_œyout_g4
 *
l
 = (dm_œyout_g4 *)
d
->
œyout
;

748  
l
->
roŸ
->
íts_Àn
;

749 
	}
}

753 
	$g4_gë_z⁄e
(
dm_disk_if
 *
d
, 
n
, 
dm_œyout_z⁄e
 *
z
)

755 
dm_œyout_g4
 *
l
 = (dm_œyout_g4 *)
d
->
œyout
;

756 
idx_ít
 *
e
;

759 if(
n
 >
l
->
roŸ
->
íts_Àn
) {

763 
e
 = &
l
->
roŸ
->
íts
[
n
];

765 
z
->
•t
 = 
	`g4_•t_lbn
(
d
, 
e
->
lbn
);

766 
z
->
lbn_low
 = 
e
->
lbn
;

767 
z
->
lbn_high
 = 
	`mö
(
d
->
dm_£˘‹s
, 
e
->
lbn
 +É->
ru∆í
);

768 
z
->
cyl_low
 = 
e
->
cyl
;

769 
z
->
cyl_high
 = 
	`mö
(
d
->
dm_cyls
, 
e
->
cyl
 +É->
cyÃu∆í
);

773 
	}
}

776 
dm_œyout_if
 
	gœyout_g4
 = {

777 #ifde‡
WIN32


778 
…›
,

779 
±ﬁ
,

780 
g4_•t_lbn
,

781 
g4_•t_pbn
,

782 
g4_åack_bound
,

783 
g4_skew
,

784 
g4_©›
,

785 
g4_£˘‹_width
,

786 
g4_de„˘_cou¡
,

787 
g4_gë_numz⁄es
,

788 
g4_gë_z⁄e


790 .
dm_å™¶©e_…›
 = 
…›
,

791 .
	gdm_å™¶©e_±ﬁ
 = 
±ﬁ
,

793 .
	gdm_gë_£˘‹s_lbn
 = 
g4_•t_lbn
,

794 .
	gdm_gë_£˘‹s_pbn
 = 
g4_•t_pbn
,

796 .
	gdm_gë_åack_bound¨õs
 = 
g4_åack_bound
,

798 .
	gdm_pbn_skew
 = 
g4_skew
,

800 .
	gdm_c⁄vît_©›
 = 
g4_©›
,

801 .
	gdm_gë_£˘‹_width
 = 
g4_£˘‹_width
,

803 .
	gdm_de„˘_cou¡
 = 
g4_de„˘_cou¡
,

804 .
	gdm_gë_numz⁄es
 = 
g4_gë_numz⁄es
,

805 .
	gdm_gë_z⁄e
 = 
g4_gë_z⁄e


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g4.h

30 #i‚de‡
_DM_LAYOUT_G4_H


31 
	#_DM_LAYOUT_G4_H


	)

33 
	~"dm.h
"

35 
	g∑t
;

36 
	gª˘
;

38 
	s¶ù
 {

39 
	moff
;

40 
	mcou¡
;

48 
	sªm≠
 {

49 
	moff
;

50 
	mcou¡
;

51 
dm_pbn
 
	mde°
;

54 
	m•t
;

55 
dm_™gÀ_t
 
	msw
;

58 
	gåack
;

59 
	gidx
;

61 íum { 
	mIDX
, 
	mTRACK
 } 
	tg4_node_t
;

62 
	ug4_node
 { 
åack
 *
	mt
; 
idx
 *
	mi
; *
	mx
; };

64 
	såack
 {

65 
	mlow
;

66 
	mhigh
;

68 
	m•t
;

69 
dm_™gÀ_t
 
	msw
;

73 
	sidx_ít
 {

77 
	mlbn
;

78 
	mcyl
;

82 
dm_™gÀ_t
 
	moff
;

89 
	mÀn
;

90 
	mcyŒí
;

91 
dm_™gÀ_t
 
	mÆí
;

96 
	mru∆í
;

97 
	mcyÃu∆í
;

100 
g4_node_t
 
	mchûdty≥
;

101 
g4_node
 
	mchûd
;

102 
	mhód
;

106 
	sidx
 {

109 
idx_ít
 *
	míts
;

110 
	míts_Àn
;

113 
	sdm_œyout_g4
 {

114 
dm_œyout_if
 
	mhdr
;

116 
dm_disk_if
 *
	m∑ª¡
;

118 
åack
 *
	måack
;

119 
	måack_Àn
;

121 
idx
 *
	midx
;

122 
	midx_Àn
;

128 
idx
 *
	mroŸ
;

130 
¶ù
 *
	m¶ùs
;

131 
	m¶ùs_Àn
;

133 
ªm≠
 *
	mªm≠s
;

134 
	mªm≠s_Àn
;

139 
dm_œyout_if
 
œyout_g4
;

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g4_load.c

30 
	~"œyout_g4.h
"

31 
	~"œyout_g4_¥iv©e.h
"

33 
	~<lib∑øm/lib∑øm.h
>

34 
	~<libddbg/libddbg.h
>

35 
	~<°dlib.h
>

37 
	~"moduÀs/dm_œyout_g4_∑øm.h
"

41 
	$aoff£t
(*
ba£
, *
p
, 
s
) {

42 #ifde‡
WIN32


43  ((*)
p
 - (*)
ba£
Ë/ 
s
;

45  (
p
 - 
ba£
Ë/ 
s
;

47 
	}
}

49 
Õ_li°
 *

50 
	$m¨shÆ_g4_ªm≠s
(
ªm≠
 *
ªm≠s
, 
n
) {

51 
Õ_li°
 *
l
 = 
	`Õ_√w_li°
();

52 
i
;

54 
l
->
löñí
 = 6;

56 
i
 = 0; i < 
n
; i++) {

57 
Õ_vÆue
 *
v
;

58 
ªm≠
 *
ri
 = &
ªm≠s
[
i
];

60 
v
 = 
	`Õ_√w_ötv
(
ri
->
off
);

61 
	`Õ_li°_add
(
l
,
v
);

62 
v
 = 
	`Õ_√w_ötv
(
ri
->
cou¡
);

63 
	`Õ_li°_add
(
l
,
v
);

64 
v
 = 
	`Õ_√w_ötv
(
ri
->
de°
.
cyl
);

65 
	`Õ_li°_add
(
l
,
v
);

66 
v
 = 
	`Õ_√w_ötv
(
ri
->
de°
.
hód
);

67 
	`Õ_li°_add
(
l
,
v
);

68 
v
 = 
	`Õ_√w_ötv
(
ri
->
de°
.
£˘‹
);

69 
	`Õ_li°_add
(
l
,
v
);

70 
v
 = 
	`Õ_√w_ötv
(
ri
->
•t
);

71 
	`Õ_li°_add
(
l
,
v
);

75  
l
;

76 
	}
}

78 
Õ_li°
 *

79 
	$m¨shÆ_g4_¶ù
(
¶ù
 *
¶ùs
, 
n
) {

80 
Õ_li°
 *
l
 = 
	`Õ_√w_li°
();

81 
i
 = 0;

83 
l
->
löñí
 = 2;

85 if(
¶ùs
[0].
off
 =0 && slùs[0].
cou¡
 == 0) {

86 
i
 = 1;

89  ; 
i
 < 
n
; i++) {

90 
Õ_vÆue
 *
v
;

91 
v
 = 
	`Õ_√w_ötv
(
¶ùs
[
i
].
off
);

92 
	`Õ_li°_add
(
l
,
v
);

93 
v
 = 
	`Õ_√w_ötv
(
¶ùs
[
i
].
cou¡
 - slips[i-1].count);

94 
	`Õ_li°_add
(
l
,
v
);

97  
l
;

98 
	}
}

100 
Õ_li°
 *

101 
	$m¨shÆ_g4_ç
(
åack
 *
t
, 
Àn
) {

102 
Õ_li°
 *
l
 = 
	`Õ_√w_li°
();

103 
i
;

105 
l
->
löñí
 = 3;

107 
i
 = 0; i < 
Àn
; i++) {

108 
Õ_vÆue
 *
v
;

110 
v
 = 
	`Õ_√w_ötv
(
t
[
i
].
low
);

111 
	`Õ_li°_add
(
l
, 
v
);

112 
v
 = 
	`Õ_√w_ötv
(
t
[
i
].
high
);

113 
	`Õ_li°_add
(
l
, 
v
);

114 
v
 = 
	`Õ_√w_ötv
(
t
[
i
].
•t
);

115 
	`Õ_li°_add
(
l
, 
v
);

119  
l
;

120 
	}
}

122 
Õ_li°
 *

123 
	$m¨shÆ_g4_idx_ít
(
idx_ít
 *
e
,

124 
idx
 *idx,

125 
åack
 *track,

126 
Õ_li°
 *
l
)

128 
i
;

129 
Õ_vÆue
 *
v
;

130 *
˘°r
;

131 
coff£t
;

133 
	`¥ötf
("%s(Ëlb¿%dáÀ¿%‡of‡%f\n", 
__func__
, 
e
->
lbn
,

134 
	`dm_™gÀ_ôod
(
e
->
Æí
), dm_™gÀ_ôod”->
off
));

136 
v
 = 
	`Õ_√w_ötv
(
e
->
lbn
);

137 
	`Õ_li°_add
(
l
, 
v
);

138 
v
 = 
	`Õ_√w_ötv
(
e
->
cyl
);

139 
	`Õ_li°_add
(
l
, 
v
);

140 
v
 = 
	`Õ_√w_doubÀv
(
	`dm_™gÀ_ôod
(
e
->
off
));

141 
	`Õ_li°_add
(
l
, 
v
);

143 
v
 = 
	`Õ_√w_ötv
(
e
->
Àn
);

144 
	`Õ_li°_add
(
l
, 
v
);

145 
v
 = 
	`Õ_√w_ötv
(
e
->
cyŒí
);

146 
	`Õ_li°_add
(
l
, 
v
);

147 
v
 = 
	`Õ_√w_doubÀv
(
	`dm_™gÀ_ôod
(
e
->
Æí
));

148 
	`Õ_li°_add
(
l
, 
v
);

150 
v
 = 
	`Õ_√w_ötv
(
e
->
ru∆í
);

151 
	`Õ_li°_add
(
l
, 
v
);

152 
v
 = 
	`Õ_√w_ötv
(
e
->
cyÃu∆í
);

153 
	`Õ_li°_add
(
l
, 
v
);

155 
e
->
chûdty≥
) {

156 
IDX
:

157 
˘°r
 = "IDX";

158 
coff£t
 = 
	`aoff£t
(
idx
, 
e
->
chûd
.
i
, (*e->child.i));

160 
TRACK
:

161 
˘°r
 = "TRACK";

162 
coff£t
 = 
	`aoff£t
(
åack
, 
e
->
chûd
.
t
, (*e->child.t));

164 : 
	`ddbg_as£π
(0); ;

167 
v
 = 
	`Õ_√w_°rögv
(
˘°r
);

168 
	`Õ_li°_add
(
l
, 
v
);

170 
v
 = 
	`Õ_√w_ötv
(
coff£t
);

171 
	`Õ_li°_add
(
l
, 
v
);

173 if(
e
->
chûdty≥
 =
TRACK
) {

174 
v
 = 
	`Õ_√w_ötv
(
e
->
hód
);

175 
	`Õ_li°_add
(
l
, 
v
);

178  
l
;

179 
	}
}

181 
Õ_li°
 *

182 
	$m¨shÆ_g4_idx
(
idx
 *idx, 
n
, idx *
idxí
, 
åack
 *track) {

183 
i
, 
j
;

184 
Õ_li°
 *
l
 = 
	`Õ_√w_li°
();

186 
l
->
löñí
 = 1;

188 
i
 = 0; i < 
n
; i++) {

189 
idx
 *
ii
 = &idx[
i
];

190 
Õ_li°
 *
À¡
 = 
	`Õ_√w_li°
();

191 
Õ_vÆue
 *
vÀ¡
 = 
	`Õ_√w_li°v
(
À¡
);

195 if(
idx
[
i
].
íts
[0].
chûdty≥
 =
TRACK
) {

196 
À¡
->
löñí
 = 11;

199 
À¡
->
löñí
 = 10;

202 
j
 = 0; j < 
ii
->
íts_Àn
; j++) {

203 
	`m¨shÆ_g4_idx_ít
(&
ii
->
íts
[
j
], 
idxí
, 
åack
, 
À¡
);

206 
	`Õ_li°_add
(
l
, 
vÀ¡
);

210  
l
;

211 
	}
}

213 
Õ_block
 *

214 
	$m¨shÆ_œyout_g4
(
dm_œyout_g4
 *
lö
) {

216 
Õ_block
 *
b
 = 
	`Õ_√w_block
();

217 
Õ_li°
 *
l
;

218 
Õ_vÆue
 *
v
;

219 
Õ_∑øm
 *
p
;

221 
b
->
sour˚_fûe
 = 0;

222 
b
->
«me
 = 0;

223 
	`Õ_lookup_ty≥
("dm_œyout_g4", &
b
->
ty≥
);

225 
l
 = 
	`m¨shÆ_g4_ç
(
lö
->
åack
,Üö->
åack_Àn
);

226 
v
 = 
	`Õ_√w_li°v
(
l
);

227 
p
 = 
	`Õ_√w_∑øm
("TP", 0, 
v
);

228 
	`Õ_add_∑øm
(&
b
->
∑øms
, &b->
∑øms_Àn
, 
p
);

230 
l
 = 
	`m¨shÆ_g4_idx
(
lö
->
idx
,Üö->
idx_Àn
,Üö->idx,Üö->
åack
);

231 
v
 = 
	`Õ_√w_li°v
(
l
);

232 
p
 = 
	`Õ_√w_∑øm
("IDX", 0, 
v
);

233 
	`Õ_add_∑øm
(&
b
->
∑øms
, &b->
∑øms_Àn
, 
p
);

235 
l
 = 
	`m¨shÆ_g4_¶ù
(
lö
->
¶ùs
,Üö->
¶ùs_Àn
);

236 
v
 = 
	`Õ_√w_li°v
(
l
);

237 
p
 = 
	`Õ_√w_∑øm
("Slùs", 0, 
v
);

238 
	`Õ_add_∑øm
(&
b
->
∑øms
, &b->
∑øms_Àn
, 
p
);

240 
l
 = 
	`m¨shÆ_g4_ªm≠s
(
lö
->
ªm≠s
,Üö->
ªm≠s_Àn
);

241 
v
 = 
	`Õ_√w_li°v
(
l
);

242 
p
 = 
	`Õ_√w_∑øm
("Rem≠s", 0, 
v
);

243 
	`Õ_add_∑øm
(&
b
->
∑øms
, &b->
∑øms_Àn
, 
p
);

245  
b
;

246 
	}
}

259 
	$do_±ﬁ_m≠
(
ª˘
 *
r
, 
surfs
)

261 
i
;

262 
acc
 = 0;

263 
cyls
 = 
r
->
íts
[0].
cyl
;

264 
ª˘_ít
 *
ri
;

265 **
ªsu…
;

267 
i
 = 0; i < 
r
->
íts_Àn
; i++) {

268 if(
r
->
íts
[
i
].
cyl
 > 
cyls
) {

269 
cyls
 = 
r
->
íts
[
i
].
cyl
;

273 
cyls
 = cyl†- 
r
->
íts
[0].
cyl
 + 1;

275 
ªsu…
 = 
	`ˇŒoc
((
cyls
 + 1Ë* 
surfs
 , ());

276 
i
 = 0; i < 
cyls
; i++) {

277 
ªsu…
[
i
] = &ªsu…[(i+1Ë* 
surfs
];

280 
i
 = 0, 
ri
 = &
r
->
íts
[0]; i <Ñ->
íts_Àn
; i++,Ñi++) {

281 
ªsu…
[
ri
->
cyl
][ri->
surf
] = 
acc
;

282 
acc
 +
ri
->
Àn
;

285  
ªsu…
;

286 
	}
}

290 
	#TP_FIELDS
 3

	)

292 
	$g4_lﬂd_ç
(
dm_œyout_g4
 *
r
,

293 
Õ_li°
 *
l
)

295 
i
;

297 
	`ddbg_as£π
(
r
->
åack_Àn
 == 0);

299 
r
->
åack_Àn
 = 
l
->
vÆues_p›
 / 
TP_FIELDS
;

301 
r
->
åack
 = 
	`ˇŒoc
‘->
åack_Àn
, (*r->track));

303 
i
 = 0; i < 
r
->
åack_Àn
; i++) {

304 
r
->
åack
[
i
].
low
 = 
l
->
vÆues
[
TP_FIELDS
*i]->
v
.i;

305 
r
->
åack
[
i
].
high
 = 
l
->
vÆues
[
TP_FIELDS
*i+1]->
v
.i;

306 
r
->
åack
[
i
].
•t
 = 
l
->
vÆues
[
TP_FIELDS
*i+2]->
v
.i;

307 
r
->
åack
[
i
].
sw
 = 
	`dm_™gÀ_dtoi
(1.0 /Ñ->åack[i].
•t
);

311 
	}
}

315 
	#IDX_FIELDS
 10

	)

317 
	$g4_lﬂd_idx
(
dm_œyout_g4
 *
r
,

318 
Õ_li°
 *
l
)

321 
i
, 
j
;

323 
loff
 = 0;

325 
r
->
idx_Àn
 = 
l
->
vÆues_p›
;

327 
r
->
idx
 = 
	`ˇŒoc
‘->
idx_Àn
, (*r->idx));

329 
i
 = 0; i < 
r
->
idx_Àn
; i++) {

330 
ªÆÀn
 = 0;

331 
idx
 *
›i
 = &
r
->idx[
i
];

332 
Õ_li°
 *
li
 = 
l
->
vÆues
[
i
]->
v
.l;

333 
idx_ít
 *
ítj
;

335 
loff
 = 0;

339 
›i
->
íts_Àn
 = 
li
->
vÆues_p›
 / 
IDX_FIELDS
;

340 
›i
->
íts
 = 
	`ˇŒoc
(›i->
íts_Àn
, (*opi->ents));

342 
j
 = 0, 
ítj
 = 
›i
->
íts
;

343 
j
 < 
›i
->
íts_Àn
 && 
loff
 < 
li
->
vÆues_p›
;

344 
j
++, 
ítj
++)

346 
off
;

348 
ítj
->
lbn
 = 
li
->
vÆues
[
loff
++]->
v
.
i
;

349 
ítj
->
cyl
 = 
li
->
vÆues
[
loff
++]->
v
.
i
;

350 
ítj
->
off
 = 
	`dm_™gÀ_dtoi
(
li
->
vÆues
[
loff
++]->
v
.
d
);

352 
ítj
->
Àn
 = 
li
->
vÆues
[
loff
++]->
v
.
i
;

353 
ítj
->
cyŒí
 = 
li
->
vÆues
[
loff
++]->
v
.
i
;

354 
ítj
->
Æí
 = 
	`dm_™gÀ_dtoi
(
li
->
vÆues
[
loff
++]->
v
.
d
);

356 
ítj
->
ru∆í
 = 
li
->
vÆues
[
loff
++]->
v
.
i
;

357 
ítj
->
cyÃu∆í
 = 
li
->
vÆues
[
loff
++]->
v
.
i
;

359 if(!
	`°rcmp
(
li
->
vÆues
[
loff
]->
v
.
s
, "TRACK")) {

360 
loff
++;

361 
ítj
->
chûdty≥
 = 
TRACK
;

362 
off
 = 
li
->
vÆues
[
loff
++]->
v
.
i
;

363 
	`ddbg_as£π
(
off
 < 
r
->
åack_Àn
);

364 
ítj
->
chûd
.
t
 = &
r
->
åack
[
off
];

365 
ítj
->
hód
 = 
li
->
vÆues
[
loff
++]->
v
.
i
;

367 if(!
	`°rcmp
(
li
->
vÆues
[
loff
]->
v
.
s
, "IDX")) {

368 
loff
++;

369 
ítj
->
chûdty≥
 = 
IDX
;

371 
off
 = 
li
->
vÆues
[
loff
++]->
v
.
i
;

372 
	`ddbg_as£π
(
off
 < 
r
->
idx_Àn
);

373 
ítj
->
chûd
.
i
 = &
r
->
idx
[
off
];

376 
	`ddbg_as£π
(0);

379 
ªÆÀn
++;

382 
›i
->
íts_Àn
 = 
ªÆÀn
;

388 
	}
}

390 
	#SLIP_FIELDS
 2

	)

392 
	$g4_lﬂd_¶ùs
(
dm_œyout_g4
 *
r
,

393 
Õ_li°
 *
l
)

395 
i
;

396 
tŸ
 = 0;

397 
r
->
¶ùs_Àn
 = 
l
->
vÆues_p›
 / 
SLIP_FIELDS
;

398 
r
->
¶ùs_Àn
;

401 
r
->
¶ùs
 = 
	`ˇŒoc
‘->
¶ùs_Àn
+1, (*r->slips));

403 
i
 = 0; i < 
r
->
¶ùs_Àn
; i++) {

404 
r
->
¶ùs
[
i
].
off
 = 
l
->
vÆues
[
SLIP_FIELDS
 * i]->
v
.i;

405 
tŸ
 +
l
->
vÆues
[
SLIP_FIELDS
 * 
i
 + 1]->
v
.i;

406 
r
->
¶ùs
[
i
].
cou¡
 = 
tŸ
;

410 if(
r
->
¶ùs
[0].
off
 > 0) {

411 
	`memmove
(
r
->
¶ùs
 + 1,Ñ->¶ùs,Ñ->
¶ùs_Àn
 * (*r->slips));

412 
r
->
¶ùs
[0].
off
 = 0;

413 
r
->
¶ùs
[0].
cou¡
 = 0;

414 
r
->
¶ùs_Àn
++;

418 
	}
}

420 
	#REMAP_FIELDS
 6

	)

422 
	$g4_lﬂd_ªm≠s
(
dm_œyout_g4
 *
r
,

423 
Õ_li°
 *
l
)

425 
i
;

426 
r
->
ªm≠s_Àn
 = 
l
->
vÆues_p›
 / 
REMAP_FIELDS
;

428 
r
->
ªm≠s
 = 
	`ˇŒoc
‘->
ªm≠s_Àn
, (*r->remaps));

430 
i
 = 0; i < 
r
->
ªm≠s_Àn
; i++) {

431 
r
->
ªm≠s
[
i
].
off
 = 
l
->
vÆues
[
REMAP_FIELDS
 * i]->
v
.i;

432 
r
->
ªm≠s
[
i
].
cou¡
 = 
l
->
vÆues
[
REMAP_FIELDS
 * i + 1]->
v
.i;

433 
r
->
ªm≠s
[
i
].
de°
.
cyl
 = 
l
->
vÆues
[
REMAP_FIELDS
 * i + 2]->
v
.i;

434 
r
->
ªm≠s
[
i
].
de°
.
hód
 = 
l
->
vÆues
[
REMAP_FIELDS
 * i + 3]->
v
.i;

435 
r
->
ªm≠s
[
i
].
de°
.
£˘‹
 = 
l
->
vÆues
[
REMAP_FIELDS
 * i + 4]->
v
.i;

436 
r
->
ªm≠s
[
i
].
•t
 = 
l
->
vÆues
[
REMAP_FIELDS
 * i + 5]->
v
.i;

441 
	}
}

445 
dm_œyout_if
 *

446 
	$dm_œyout_g4_lﬂd∑øms
(
Õ_block
 *
b
,

447 
dm_disk_if
 *
∑ª¡
)

449 
i
;

450 
dm_œyout_g4
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

452 
ªsu…
->
hdr
 = 
œyout_g4
;

453 
ªsu…
->
∑ª¡
 =Öarent;

455 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
dm_œyout_g4_mod
);

458 
ªsu…
->
roŸ
 = &ªsu…->
idx
[ªsu…->
idx_Àn
 - 1];

461 
∑ª¡
->
œyout
 = (
dm_œyout_if
 *)
ªsu…
;

463  (
dm_œyout_if
 *)
ªsu…
;

464 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g4_private.h

30 
	#G4_ALLOC_PATH
 16

	)

32 
	sg4_∑th_node
 {

33 
g4_node_t
 
	mty≥
;

34 
	mi
;

35 
g4_node
 
	mn
;

39 
	mquŸ
;

40 
	mªsid
;

43 
	sg4_∑th
 {

44 
g4_∑th_node
 
	m∑th
[
G4_ALLOC_PATH
];

45 
	mÀngth
;

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g4_tools/g4_skews.c

44 
	~<libddbg/libddbg.h
>

45 
	~<lib∑øm/lib∑øm.h
>

47 
	~<disksim_öãrÁ˚.h
>

48 
	~"../œyout_g4.h
"

50 
	~<°dio.h
>

51 
	~<°dlib.h
>

52 
	~<m©h.h
>

53 
	~<°rög.h
>

54 
	~<uni°d.h
>

55 
	~<gë›t.h
>

57 
	#MAX_OUT
 4

	)

59 
	sds°uff
 {

60 
disksim_öãrÁ˚
 *
	miÁ˚
;

61 
	mnow
;

62 
	m√xt
;

65 
	mcom∂
[
MAX_OUT
];

66 
	mcom∂_√xt
;

69 
	såa˚
 {

70 
FILE
 *
	mÂ
;

74 *
	gnoˇche_ovî
[] = {

84 
	#FP
 40

	)

86 íum { 
	mGENTRACE
, 
	mCALIB
 } 
	gmode
 = 
CALIB
;

89 
	$scheduÀ_ˇŒback
(
disksim_öãrÁ˚_ˇŒback_t
 
‚
,

90 
t
,

91 *
˘x
) {

92 
ds°uff
 *
ds
 = (ds°uf‡*)
˘x
;

93 
ds
->
√xt
 = 
t
;

94 
	}
}

97 
	$descheduÀ_ˇŒback
(
t
, *
˘x
) {

98 
ds°uff
 *
ds
 = (ds°uf‡*)
˘x
;

99 
ds
->
√xt
 = -1;

100 
	}
}

103 
	$cb
(
t
, 
disksim_ªque°
 *
r
, *
˘x
) {

105 
ds°uff
 *
ds
 = (ds°uf‡*)
˘x
;

110 
ds
->
com∂
[ds->
com∂_√xt
++] = 
t
;

111 
	}
}

117 
	$time_£c⁄d_ªque°
(
l1
, 
l2
, 
ds°uff
 *
ds
, 
åa˚
 *
t
,

118 
dm_disk_if
 *
d
) {

119 
disksim_ªque°
 *
r1
, *
r2
;

121 
	`ddbg_as£π
(
l1
 < 
d
->
dm_£˘‹s
);

122 
	`ddbg_as£π
(
l2
 < 
d
->
dm_£˘‹s
);

124 if(
mode
 =
GENTRACE
) {

125 
	`Ârötf
(
t
->
Â
, "%‡0 %d 1 1\n", 
ds
->
now
, 
l1
);

126 
	`Ârötf
(
t
->
Â
, "%‡0 %d 1 1\n", 
ds
->
now
 + 0.1, 
l2
);

127 
ds
->
now
 += 20.0;

129 
r1
 = 
	`ˇŒoc
(1, (*r1));

130 
r2
 = 
	`ˇŒoc
(1, (*r2));

132 
r1
->
blkno
 = 
l1
;

133 
r1
->
byãcou¡
 = 512;

134 
r1
->
Êags
 |
DISKSIM_READ
;

135 
r1
->
°¨t
 = 
ds
->
now
;

138 
r2
->
blkno
 = 
l2
;

139 
r2
->
byãcou¡
 = 512;

140 
r2
->
Êags
 |
DISKSIM_READ
;

141 
r2
->
°¨t
 = 
ds
->
now
 + 0.001;

144 
	`disksim_öãrÁ˚_ªque°_¨rive
(
ds
->
iÁ˚
, ds->
now
, 
r1
);

145 
	`disksim_öãrÁ˚_ªque°_¨rive
(
ds
->
iÁ˚
, ds->
now
, 
r2
);

150 
ds
->
now
 = ds->
√xt
;

151 
ds
->
√xt
 = -1;

152 
	`disksim_öãrÁ˚_öã∫Æ_evít
(
ds
->
iÁ˚
, ds->
now
, 0);

153 } 
ds
->
√xt
 != -1);

156 
ds
->
now
 += 1.0;

158 
	`‰ì
(
r1
);

159 
	`‰ì
(
r2
);

163 
ds
->
com∂_√xt
 = 0;

166  
ds
->
com∂
[1] - ds->compl[0];

167 
	}
}

170 
åa˚
 *

171 
	$£tup_åa˚
(*
«me
) {

172 
åa˚
 *
t
 = 
	`ˇŒoc
(1, (*t));

174 if(
mode
 =
GENTRACE
) {

175 
t
->
Â
 = 
	`f›í
(
«me
, "w");

177 
t
->
Â
 = 
	`f›í
(
«me
, "r");

180  
t
;

181 
	}
}

186 
	$åa˚_gë_√xt
(
åa˚
 *
t
, *
lbn
, *
ªsu…
) {

187 
rv
;

189 
rv
 = 
	`fsˇnf
(
t
->
Â
, "%*†%*†%d %*d %l‡%*f", 
lbn
, 
ªsu…
) == 2;

190 *
ªsu…
 /= 1000.0;

192  
rv
;

193 
	}
}

197 
	$gë_åa˚time
(
åa˚
 *
t
, 
lbn1
, 
lbn2
) {

198 
ªsu…
, 
t1
;

199 
l1
, 
l2
;

202 
	`ddbg_as£π
(
	`åa˚_gë_√xt
(
t
, &
l1
, &
t1
));

203 } 
l1
 !
lbn1
);

204 
	`ddbg_as£π
(
	`åa˚_gë_√xt
(
t
, &
l2
, &
ªsu…
));

206 
	`ddbg_as£π
(
l1
 =
lbn1
);

207 
	`ddbg_as£π
(
l2
 =
lbn2
);

208  
ªsu…
;

209 
	}
}

217 
	$adju°_lbns
(
dm_disk_if
 *
d
, *
l1
, *
l2
) {

218 
dm_pbn
 
pbn
;

219 
l0
, 
 
;

221 if(
l1
) {

222 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, *
l1
, 
MAP_FULL
, &
pbn
, 0);

223 
d
->
œyout
->
	`dm_gë_åack_bound¨õs
(d, &
pbn
, &
l0
, &
 
, 0);

224 *
l1
 = 
 
;

227 if(
l2
) {

228 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, *
l2
, 
MAP_FULL
, &
pbn
, 0);

229 
d
->
œyout
->
	`dm_gë_åack_bound¨õs
(d, &
pbn
, &
l0
, &
 
, 0);

230 *
l2
 = 
l0
;

234 
	}
}

239 
	$món
(*
x
, 
n
) {

240 
i
;

241 
sum
 = 0.0;

242 
món
;

243 
i
 = 0; i < 
n
; i++) {

244 
sum
 +
x
[
i
];

247 
món
 = 
sum
 / 
n
;

248  
món
;

249 
	}
}

253 
	$ss
(*
x
, 
n
) {

254 
i
;

255 
sum
 = 0.0;

256 
ªs
;

257 
i
 = 0; i < 
n
; i++) {

258 
sum
 +(
x
[
i
] * x[i]);

260 
ªs
 = 
sum
 - 
n
 * 
	`món
(
x
,n) * mean(x,n);

261  
ªs
;

262 
	}
}

265 
	$ssxy
(*
x
, *
y
, 
n
) {

266 
i
;

267 
sum
 = 0.0;

268 
ªs
;

269 
i
 = 0; i < 
n
; i++) {

270 
sum
 +(
x
[
i
] * 
y
[i]);

272 
ªs
 = 
sum
 - (
n
 * 
	`món
(
x
,nË* món(
y
,n));

273  
ªs
;

274 
	}
}

277 
	$v¨i
(*
x
, 
n
) {

278 
ªs
 = 
	`ss
(
x
,
n
) /Ç;

279  
ªs
;

280 
	}
}

282 
	$cov¨
(*
x
, *
y
, 
n
) {

283 
ªs
 = 
	`ssxy
(
x
,
y
,
n
) /Ç;

284  
ªs
;

285 
	}
}

291 
	$löªg
(*
x
, *
y
, 
n
, *
a
, *
b
) {

292 
r
;

293 *
b
 = 
	`ssxy
(
x
,
y
,
n
Ë/ 
	`ss
(x,n);

294 *
a
 = 
	`món
(
y
,
n
Ë- *
b
 * món(
x
,n);

296 
r
 = 
	`sqπ
(
	`ssxy
(
x
,
y
,
n
Ë* ssxy(x,y,nË/ (
	`ss
(x,n) * ss(y,n)));

298  
r
;

299 
	}
}

308 
	$föd_¶›e
(*
d1
, *
d2
, 
n
, *
Ø
,

309 
≥riod
) {

310 
i
;

311 
a
,
b
,
r
;

312 
yi
;

313 *
îr
 = 
	`ˇŒoc
(
n
, (*err));

314 *
x
 = 
	`ˇŒoc
(
n
, (*x));

315 
fô_îr
, 
tŸ_îr
;

316 
v¨
;

317 
thªsh
 = 
≥riod
 / 2.0;

319 
add˘
 = 0;

320 
n2
 = 0;

322 if(
n
 == 1) {

323 *
Ø
 = 
d1
[0] - 
d2
[0];

327 if(
n
 == 2) {

328 *
Ø
 = 0.0;

329  
d1
[1] - 
d2
[1];

332 
i
 = 1; i < 
n
; i++) {

333 
yi
 = 
d1
[
i
] - 
d2
[i];

335 if(-
thªsh
 <
yi
 && yi <=Åhresh) {

337 
îr
[
n2
] = 
yi
;

338 
x
[
n2
] = 
i
;

339 
n2
++;

343 
r
 = 
	`löªg
(
x
, 
îr
, 
n2
, &
a
, &
b
);

345 
i
 = 0; i < 
n2
; i++) {

346 
	`¥ötf
("%3d\t%f\n", ()
x
[
i
], 
îr
[i]);

349 
v¨
 = 
	`v¨i
(
îr
,
n
);

351 
	`¥ötf
("%s(Ë®%f, b = %f,Ñ = %f, v¨ = %f\n", 
__func__
, 
a
, 
b
, 
r
, 
v¨
);

353 *
Ø
 = 
a
;

355 
	`‰ì
(
îr
);

356 
	`‰ì
(
x
);

358  
b
;

359 
	}
}

362 
	$fix_™gÀ
(
a
) {

363 if(
a
 < 0) {

364  
a
 - ()a + 1;

366  
a
 - ()a;

368 
	}
}

375 
	$mósuª_⁄e_skew
(
dm_disk_if
 *
d
,

376 
ds°uff
 *
ds
,

377 
åa˚
 *trace,

378 
l0
,

379 
li
) {

380 
t
, 
â
, 
a
 = 0.0;

381 
≥riod
 = 
	`dm_time_ôod
(
d
->
mech
->
	`dm_≥riod
(d));

383 
	`adju°_lbns
(
d
, &
l0
, &
li
);

385 
t
 = 
	`time_£c⁄d_ªque°
(
l0
, 
li
, 
ds
, 
åa˚
, 
d
);

386 if(
mode
 =
CALIB
) {

387 
â
 = 
	`gë_åa˚time
(
åa˚
, 
l0
, 
li
);

388 
a
 = 
	`fix_™gÀ
(-(
t
 - 
â
Ë/ 
≥riod
);

391  
a
;

392 
	}
}

401 
	$do_idx_ít
(
dm_disk_if
 *
d
,

402 
dm_œyout_g4
 *
l
,

403 
idx_ít
 *
e
,

404 
idx
 *
∑ª¡
,

405 
idx_ít
 *
∑ª¡_e
,

406 
∑ª¡_off
,

407 
ds°uff
 *
ds
,

408 
åa˚
 *
t
,

409 
lbn
) {

410 
i
;

411 
l0
;

412 
di°
;

414 
yi
;

416 *
times
;

417 *
åa˚times
;

420 
off0time
, 
Àn0time
;

421 
off0lbn
[2], 
Àn0lbn
[2];

425 
aoff
 = 
	`dm_™gÀ_ôod
(
e
->
off
);

426 
Æí
 = 
	`dm_™gÀ_ôod
(
e
->alen);

428 
≥riod
 = 
	`dm_time_ôod
(
d
->
mech
->
	`dm_≥riod
(d));

431 
quŸ
 = 
e
->
ru∆í
 /É->
Àn
;

435 
times
 = 
	`ˇŒoc
(
quŸ
, ());

437 
åa˚times
 = 
	`ˇŒoc
(
quŸ
, ());

439 *
li
 = 
	`ˇŒoc
(
quŸ
, (*li));

441 
	`¥ötf
("%s()Übn %dÉ->lbn %dálen %f off %f quot %d\n",

442 
__func__
, 
lbn
, 
e
->lbn, 
Æí
, 
aoff
, 
quŸ
);

444 if(
e
->
Æí
 !0 ||É->
off
 != 0) {

445 
	`¥ötf
("%s(ËÆªady d⁄e,áµ¨íéy\n", 
__func__
);

450 if(
e
->
lbn
 != 0) {

451 
aoff
 = 
	`mósuª_⁄e_skew
(
d
, 
ds
, 
t
, 
lbn
,Üb¿+ 
e
->lbn);

452 
e
->
off
 = 
	`dm_™gÀ_dtoi
(
aoff
);

456 if(
lbn
 + 
e
->lb¿+É->
Àn
 >
d
->
dm_£˘‹s
) {

457 
e
->
Æí
 = 
	`dm_™gÀ_dtoi
(0.0);

463 
Æí
 = 
	`mósuª_⁄e_skew
(
d
, 
ds
, 
t
, 
lbn
 + 
e
->lbn,

464 
lbn
 + 
e
->lb¿+É->
Àn
);

465 
e
->
Æí
 = 
	`dm_™gÀ_dtoi
(alen);

467 
	`¥ötf
("fú° of‡%‡À¿%f\n", 
aoff
, 
Æí
);

474 
i
 = 1; i < 
quŸ
; i++) {

475 
l0
 = 
lbn
;

476 
li
[
i
] = 
l0
 + 
e
->
lbn
 +É->
Àn
 * i;

478 
	`adju°_lbns
(
d
, &
l0
, &
li
[
i
]);

480 if(
mode
 =
CALIB
) {

481 
åa˚times
[
i
] = 
	`gë_åa˚time
(
t
, 
l0
, 
li
[i]);

483 
	`¥ötf
("%d (%d,%dËåa˚ %‡¥ed %f\n", 
i
,

484 
l0
, 
li
[
i
],

485 
åa˚times
[
i
], 
times
[i]);

488 
	`time_£c⁄d_ªque°
(
l0
, 
li
[
i
], 
ds
, 
t
, 
d
);

492 if(
mode
 =
GENTRACE
) {

498 
di°
 = 2; di° < 
quŸ
 ; ) {

500 
a
, 
b
;

501 
i
 = 1; i < 
di°
; i++) {

502 
times
[
i
] = 
	`time_£c⁄d_ªque°
(
l0
, 
li
[i], 
ds
, 
t
, 
d
);

503 
	`¥ötf
("%d (%d,%dËåa˚ %‡¥ed %f\n", 
i
,

504 
l0
, 
li
[
i
],

505 
åa˚times
[
i
], 
times
[i]);

512 
b
 = 
	`föd_¶›e
(
times
, 
åa˚times
, 
di°
, &
a
, 
≥riod
);

515 
Æí
 = 
	`fix_™gÀ
◊À¿- 
b
 / 
≥riod
);

516 
e
->
Æí
 = 
	`dm_™gÀ_dtoi
(alen);

520 if(
e
->
lbn
 >Übn) {

521 
	`¥ötf
("fixáof‡(%d, %d)\n", 
lbn
, 
e
->lbn);

522 
aoff
 = 
	`fix_™gÀ
◊of‡- 
a
 / 
≥riod
);

523 
e
->
off
 = 
	`dm_™gÀ_dtoi
(
aoff
);

526 
	`¥ötf
("Æí -> %f, of‡-> %‡(di° %d)\n", 
Æí
, 
aoff
, 
di°
);

528 if(
di°
 =
quŸ
) {

530 } if(
di°
 * 2 >
quŸ
) {

531 
di°
 = 
quŸ
;

533 
di°
 *= 2;

537 
	`‰ì
(
li
);

538 
	`‰ì
(
åa˚times
);

539 
	`‰ì
(
times
);

541 
	}
}

551 
	$do_idx
(
dm_disk_if
 *
d
,

552 
idx_ít
 *
õ
,

553 
idx
 *idx,

554 
dm_œyout_g4
 *
l
,

555 
ds°uff
 *
ds
,

556 
åa˚
 *
t
,

557 
lbn
) {

558 
i
;

559 
idx_ít
 *
e
;

561 
	`Ârötf
(
°dîr
, "%s÷b¿%d)\n", 
__func__
, 
lbn
);

563 
i
 = 0, 
e
 = &
idx
->
íts
[0]; i < idx->
íts_Àn
; i++,É++) {

566 
	`do_idx_ít
(
d
, 
l
, &
idx
->
íts
[
i
], idx, 
õ
, i, 
ds
, 
t
, 
lbn
);

569 if(
e
->
chûdty≥
 =
IDX
) {

570 
	`do_idx
(
d
, 
e
,É->
chûd
.
i
, 
l
, 
ds
, 
t
, 
lbn
 +É->lbn);

574 
i
 = 0, 
e
 = &
idx
->
íts
[0]; i < idx->
íts_Àn
; i++,É++) {

575 
	`¥ötf
("%s(Ëof‡%‡Æí %f\n", 
__func__
,

576 
	`dm_™gÀ_ôod
(
idx
->
íts
[
i
].
off
),

577 
	`dm_™gÀ_ôod
(
idx
->
íts
[
i
].
Æí
));

581 
	}
}

584 
	$maö
(
¨gc
, **
¨gv
) {

585 
c
;

586 
›ti⁄
 
›ts
[] = {

594 
	e›â
 {

595 
PARV
 = 0,

596 
OUTV
 = 1,

597 
MODEL
 = 2,

598 
MODE
 = 3,

599 
TRACE
 = 4

602 
dm_disk_if
 *
d
;

603 
dm_œyout_g4
 *
l
;

605 
åa˚
 *
t
;

606 
ds°uff
 *
ds
 = 
	`ˇŒoc
(1, (*ds));

608 
Õ_block
 *
unm
;

610 
	`£éöebuf
(
°dout
);

611 
FILE
 *
outfûe
;

612 
›töd
;

614 *
∑rv
 = 0;

615 *
outv
 = 0;

616 *
modñ
 = 0;

617 *
åa˚
 = 0;

619 (
c
 = 
	`gë›t_l⁄g
(
¨gc
, 
¨gv
, "q", 
›ts
, &
›töd
)) != -1) {

620 
c
) {

624 
›töd
) {

625 
PARV
:

626 
∑rv
 = 
	`°rdup
(
›èrg
);

628 
OUTV
:

629 
outv
 = 
	`°rdup
(
›èrg
);

631 
MODEL
:

632 
modñ
 = 
	`°rdup
(
›èrg
);

634 
MODE
:

635 if(!
	`°rcmp
(
›èrg
, "calib")) {

636 
mode
 = 
CALIB
;

638 if(!
	`°rcmp
(
›èrg
, "gentrace")) {

639 
mode
 = 
GENTRACE
;

642 
	`Ârötf
(
°dîr
, "*** bad modê%s\n", 
›èrg
);

643 
	`exô
(1);

647 
TRACE
:

648 
åa˚
 = 
	`°rdup
(
›èrg
);

652 
	`ddbg_as£π
(0);

657 
	`ddbg_as£π
(0);

662 
t
 = 
	`£tup_åa˚
(
åa˚
);

663 if(
mode
 =
CALIB
) {

664 
outfûe
 = 
	`f›í
(
modñ
, "w");

665 
	`ddbg_as£π
(
outfûe
);

668 
ds
->
iÁ˚
 = 
	`disksim_öãrÁ˚_öôülize
(
∑rv
,

669 
outv
,

670 
cb
,

671 
scheduÀ_ˇŒback
,

672 
descheduÀ_ˇŒback
,

673 
ds
,

675 
noˇche_ovî
);

677 
d
 = 
	`disksim_gëdiskmodñ
(
ds
->
iÁ˚
, 0);

678 
l
 = (
dm_œyout_g4
 *)
d
->
œyout
;

680 
	`do_idx
(
d
, 0, 
l
->
roŸ
,Ü, 
ds
, 
t
, 0);

682 
Õ_block
* 
	`m¨shÆ_œyout_g4
(
dm_œyout_g4
 *);

684 if(
mode
 =
CALIB
) {

685 
unm
 = 
	`m¨shÆ_œyout_g4
(
l
);

686 
	`u≈¨£_block
(
unm
, 
outfûe
);

687 
	`f˛o£
(
outfûe
);

690 
	`‰ì
(
ds
);

692 
	`f˛o£
(
t
->
Â
);

693 
	`‰ì
(
t
);

696 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/marshal.c

33 
	~"dm.h
"

34 
	~"m¨shÆ.h
"

37 
dm_disk_if
 *

38 
	$dm_unm¨shÆ
(
dm_m¨shÆ_hdr
 *
h
, 
bufÊí
) {

40 
dm_disk_if
 *
ªsu…
;

43 if(
bufÊí
 < (
dm_m¨shÆ_hdr
))  0;

44 if(
h
->
Àn
 < 
bufÊí
)  0;

46 if(
h
->
ty≥
 !
DM_DISK_TYP
)  0;

48 
dm_m¨shÆ_mods
[
DM_DISK_TYP
]->
	`unm¨shÆ
(
h
, (**)&
ªsu…
, 0);

49  
ªsu…
;

50 
	}
}

54 
	$dm_unm¨shÆ_disk
(
dm_m¨shÆ_hdr
 *
h
,

55 **
ªsu…
,

56 *
∑ª¡
)

58 *
±r
 = (*)
h
;

59 
dm_m¨shÆ_hdr
 *
hdπmp
;

60 
dm_disk_if
 *
d
 = 
	`mÆloc
((*d));

62 
±r
 +(
dm_m¨shÆ_hdr
);

64 
	`mem˝y
((*)
d
, 
±r
, (
dm_disk_if
));

65 
±r
 +(
dm_disk_if
);

67 
hdπmp
 = (
dm_m¨shÆ_hdr
 *)
±r
;

69 
hdπmp
->
ty≥
) {

70 
DM_LAYOUT_G1_TYP
:

71 
±r
 = 
dm_m¨shÆ_mods
[
DM_LAYOUT_G1_TYP
]->
	`unm¨shÆ
((*)ptr,

72 (**)&
d
->
œyout
,

73 
d
);

77 
	`ddbg_as£π
(0);

81 
±r
 = 
dm_m¨shÆ_mods
[
DM_MECH_G1_TYP
]->
	`unm¨shÆ
((*)ptr,

82 (**)&
d
->
mech
,

83 
d
);

85 *
ªsu…
 = 
d
;

86  
±r
;

87 
	}
}

90 
dm_m¨shÆ_hdr
 *

91 
	$dm_m¨shÆ
(
dm_disk_if
 *
d
) {

92 
dm_m¨shÆ_hdr
 *
ªsu…
 = 0;

93 *
±r
 = 0;

94 
Æloc_size
 = 0;

97 
Æloc_size
 = (
dm_disk_if
);

98 
Æloc_size
 +(
dm_m¨shÆ_hdr
);

100 
Æloc_size
 +
d
->
œyout
->
	`dm_m¨shÆed_Àn
(d);

101 
Æloc_size
 +(
dm_m¨shÆ_hdr
);

103 
Æloc_size
 +
d
->
mech
->
	`dm_m¨shÆed_Àn
(d);

104 
Æloc_size
 +(
dm_m¨shÆ_hdr
);

106 
ªsu…
 = 
	`mÆloc
(
Æloc_size
);

108 
ªsu…
->
ty≥
 = 
DM_DISK_TYP
;

109 
ªsu…
->
Àn
 = 
Æloc_size
;

111 
±r
 = (*)
ªsu…
 + (
dm_m¨shÆ_hdr
);

112 
	`mem˝y
(
±r
, (*)
d
, (
dm_disk_if
));

114 
±r
 +(
dm_disk_if
);

115 
±r
 = 
d
->
œyout
->
	`dm_m¨shÆ
(d,Ötr);

116 
d
->
mech
->
	`dm_m¨shÆ
(d, 
±r
);

120  
ªsu…
;

121 
	}
}

123 
dm_m¨shÆ_moduÀ
 
	gdm_disk_m¨shÆ_mod
 =

124 { 
dm_unm¨shÆ_disk
, 0, 0 };

126 
dm_m¨shÆ_moduÀ
 *
	gdm_m¨shÆ_mods
[] = {

127 &
dm_disk_m¨shÆ_mod
,

128 &
dm_œyout_g1_m¨shÆ_mod
,

129 &
dm_mech_g1_m¨shÆ_mod
,

137 
	sm¨shÆed_‚
 {

138 
uöt16_t
 
	mtyp
;

139 
uöt16_t
 
	mcode
;

142 
	$m¨shÆ_‚
(*
‚
, 
typ
, 
m¨shÆed_‚
 *
ªsu…
) {

143 
c
;

145 
ªsu…
->
typ
 =Åyp;

147 
c
 = 0; c < 
dm_m¨shÆ_mods
[
typ
]->
‚_èbÀ_Àn
; c++) {

148 if(
dm_m¨shÆ_mods
[
typ
]->
‚_èbÀ
[
c
] =
‚
) {

149 
ªsu…
->
code
 = 
c
;

154 
	`ddbg_as£π
(0);

155 
	}
}

157 *
	$unm¨shÆ_‚
(*
buff
, 
typ
) {

158 
m¨shÆed_‚
 *
dmf
 = (m¨shÆed_‚ *)
buff
;

159  
dm_m¨shÆ_mods
[
typ
]->
‚_èbÀ
[
dmf
->
code
];

160 
	}
}

167 
	$m¨shÆ_‚s
(**
‚s
, 
‚s_Àn
, *
b
, 
typ
) {

168 *
buff
 = (*)
b
;

169 
c
;

171 
c
 = 0; c < 
‚s_Àn
; c++) {

172 
	`m¨shÆ_‚
(
‚s
[
c
], 
typ
, (
m¨shÆed_‚
 *)
buff
);

173 
buff
++;

175 
	}
}

179 
	$unm¨shÆ_‚s
(**
‚s
, 
‚s_Àn
, *
b
, 
typ
) {

180 *
buff
 = (*)
b
;

181 
c
;

183 
c
 = 0; c < 
‚s_Àn
; c++) {

184 
‚s
[
c
] = 
	`unm¨shÆ_‚
(
buff
, 
typ
);

185 
buff
++;

187 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/marshal.h

33 #i‚de‡
_DM_MARSHAL_H


34 
	#_DM_MARSHAL_H


	)

36 
	sdm_m¨shÆ_hdr
 {

37 
	mÀn
;

38 
	mty≥
;

41 *
dm_unm¨shÆ_disk
(
dm_m¨shÆ_hdr
 *,

43 *
∑ª¡
);

49 *(*
	tdm_unm¨shÆ_t
)(
	tdm_m¨shÆ_hdr
 *,

50 **
	tªsu…
,

51 *
	t∑ª¡
);

53 
	sdm_m¨shÆ_moduÀ
 {

54 
dm_unm¨shÆ_t
 
	munm¨shÆ
;

55 **
	m‚_èbÀ
;

56 
	m‚_èbÀ_Àn
;

59 
dm_m¨shÆ_moduÀ
 
dm_disk_m¨shÆ_mod
;

60 
dm_m¨shÆ_moduÀ
 
dm_œyout_g1_m¨shÆ_mod
;

61 
dm_m¨shÆ_moduÀ
 
dm_mech_g1_m¨shÆ_mod
;

63 
dm_m¨shÆ_moduÀ
 *
dm_m¨shÆ_mods
[];

65 
	gm¨shÆed_‚
;

67 
dm_disk_if
 * 
dm_unm¨shÆ
(
dm_m¨shÆ_hdr
 *
h
, 
bufÊí
);

68 
dm_m¨shÆ_hdr
 * 
dm_m¨shÆ
(
dm_disk_if
 *
d
);

69 
m¨shÆ_‚
(*
‚
, 
typ
, 
m¨shÆed_‚
 *
ªsu…
);

70 *
unm¨shÆ_‚
(*
buff
, 
typ
);

71 
m¨shÆ_‚s
(**
‚s
, 
‚s_Àn
, *
b
, 
typ
);

72 
unm¨shÆ_‚s
(**
‚s
, 
‚s_Àn
, *
b
, 
typ
);

75 
	mDM_DISK_TYP
,

76 
	mDM_LAYOUT_G1_TYP
,

77 
	mDM_MECH_G1_TYP
,

78 } 
	tdm_m¨shÆ_ty≥_t
;

80 
	#DM_MARSHAL_MOD_MAX
 3

	)

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/mech_g1.c

102 
	~"dm_c⁄fig.h
"

103 
	~"dm.h
"

104 
	~"m¨shÆ.h
"

105 
	~"mech_g1.h
"

106 
	~"mech_g1_¥iv©e.h
"

112 
dm_time_t


113 
	$dm_£ek_time_g1
(
dm_disk_if
 *
d
,

114 
dm_mech_°©e
 *
°¨t_åack
,

115 
dm_mech_°©e
 *
íd_åack
,

116 
rw
)

118 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

119 
dm_time_t
 
£ektime
, 
h°
, 
ªsu…
 = 0;

121 
£ektime
 = 
m
->
	`£ek‚
(
d
,
°¨t_åack
,
íd_åack
,
rw
);

125 
h°
 = 
m
->
hdr
.
	`dm_hódswôch_time
(
d
,
°¨t_åack
->
hód
,
íd_åack
->head);

127 
ªsu…
 = 
h°
 > 
£ektime
 ? hst : seektime;

129 if((
ªsu…
 !0Ë&& (
rw
 == 0)) {

130 
ªsu…
 +
m
->
£ekwrôedñè
;

133  
ªsu…
;

134 
	}
}

139 
dm_time_t


140 
	$dm_pos_time_g1
(
dm_disk_if
 *
d
,

141 
dm_mech_°©e
 *
öôül
,

142 
dm_pbn
 *
°¨t
,

143 
Àn
,

144 
rw
,

145 
immed
,

146 
dm_mech_ac˘imes
 *
bªakdown
)

148 
dm_™gÀ_t
 
£ekrŸ©e
;

149 
dm_mech_°©e
 
íd_åack
, 
°©e
 = *
öôül
;

150 
dm_time_t
 
£ektime
 = 0;

151 
dm_time_t
 
ªsu…
 = 0;

152 
dm_time_t
 
œãncy
 = 0;

155 
íd_åack
.
hód
 = 
°¨t
->hód;Énd_åack.
cyl
 = start->cyl;

156 
£ektime
 = 
d
->
mech
->
	`dm_£ek_time
(d, &
°©e
, &
íd_åack
, 
rw
);

158 
°©e
.
hód
 = 
°¨t
->head;

159 
°©e
.
cyl
 = 
°¨t
->cyl;

163 
£ekrŸ©e
 = 
d
->
mech
->
	`dm_rŸ©e
(d, &
£ektime
);

164 
°©e
.
thëa
 +
£ekrŸ©e
;

167 
œãncy
 = 
d
->
mech
->
	`dm_œãncy
(d,

168 &
°©e
,

169 
°¨t
->
£˘‹
,

170 
Àn
,

171 
immed
,

174 
ªsu…
 = 
£ektime
 + 
œãncy
;

176 if(
bªakdown
) {

177 
bªakdown
->
£ektime
 = seektime;

178 
bªakdown
->
öôül_œãncy
 = 
œãncy
;

179 
bªakdown
->
öôül_x„r
 = 0;

180 
bªakdown
->
addl_œãncy
 = 0;

181 
bªakdown
->
addl_x„r
 = 0;

184  
ªsu…
;

185 
	}
}

189 
dm_time_t


190 
	$dm_ac˘ime_åack
(
dm_disk_if
 *
d
,

191 
dm_mech_°©e
 *
i°©e
,

192 
dm_pbn
 *
°¨t
,

193 
Àn
,

194 
rw
,

195 
immed
,

196 
dm_mech_°©e
 *
ªsu…_°©e
,

197 
dm_mech_ac˘imes
 *
bªakdown
)

200 
dm_mech_°©e
 
ãmp
;

202 
dm_mech_°©e
 
°©e
 = *
i°©e
;

203 
dm_time_t
 
£ektime
, 
œãncy
, 
x„πime
, 
öôx„r
;

204 
dm_time_t
 
addtﬁ©ícy
 = 0, 
ªsu…
 = 0, *
©Õ
;

207 
ãmp
.
cyl
 = 
°¨t
->cyl;Åemp.
hód
 = start->head;

208 
£ektime
 = 
d
->
mech
->
	`dm_£ek_time
(d, &
°©e
, &
ãmp
, 
rw
);

211 
°©e
.
hód
 = 
°¨t
->head;

212 
°©e
.
cyl
 = 
°¨t
->cyl;

215 
ãmp
.
thëa
 = 
d
->
mech
->
	`dm_rŸ©e
(d, &
£ektime
);

216 
°©e
.
thëa
 +
ãmp
.theta;

219 
©Õ
 = 
immed
 ? &
addtﬁ©ícy
 : 0;

220 
œãncy
 = 
d
->
mech
->
	`dm_œãncy
(d,

221 &
°©e
,

222 
°¨t
->
£˘‹
,

223 
Àn
,

224 
immed
,

225 
©Õ
);

228 
œãncy
 +
immed
 ? *
©Õ
 : 0;

231 
x„πime
 = 
d
->
mech
->
	`dm_x„πime
(d, &
°©e
, 
Àn
);

233 
ªsu…
 = 
£ektime
 + 
œãncy
 + 
x„πime
;

235 if(
ªsu…_°©e
) {

236 
ªsu…_°©e
->
hód
 = 
°¨t
->head;

237 
ªsu…_°©e
->
cyl
 = 
°¨t
->cyl;

238 
ªsu…_°©e
->
thëa
 = 
i°©e
->theta;

239 
ªsu…_°©e
->
thëa
 +
d
->
mech
->
	`dm_rŸ©e
(d, &
ªsu…
);

244 if(
immed
) {

245 
fú°£˘
 = 
d
->
mech
->
	`dm_ac˚ss_block
(d,

246 &
°©e
,

247 
°¨t
->
£˘‹
,

248 
Àn
,

249 
immed
);

251 
öôx„r
 = 
d
->
mech
->
	`dm_x„πime
(d, &
°©e
, 
Àn
 - 
fú°£˘
 + 1);

254 
öôx„r
 = 
x„πime
;

257 if(
bªakdown
) {

258 
bªakdown
->
£ektime
 = seektime;

259 
bªakdown
->
öôül_œãncy
 = 
œãncy
 - 
addtﬁ©ícy
;

260 
bªakdown
->
öôül_x„r
 = 
öôx„r
;

261 
bªakdown
->
addl_œãncy
 = 
addtﬁ©ícy
;

262 
bªakdown
->
addl_x„r
 = 
x„πime
 - 
öôx„r
;

266  
ªsu…
;

267 
	}
}

277 
dm_time_t


278 
	$dm_ac˘ime_g1
(
dm_disk_if
 *
d
,

279 
dm_mech_°©e
 *
i°©e
,

280 
dm_pbn
 *
°¨t
,

281 
Àn
,

282 
rw
,

283 
immed
,

284 
dm_mech_°©e
 *
ªsu…_°©e
,

285 
dm_mech_ac˘imes
 *
bªakdown
)

287 
dm_pbn
 
pbn
 = *
°¨t
;

288 
lbnhigh
;

290 
l
;

291 
œ°lbn
;

293 
dm_mech_°©e
 
s
 = *
i°©e
;

294 
dm_mech_°©e
 
s2
;

296 
dm_time_t
 
ªsu…
 = 0;

298 if(
bªakdown
) {

299 
bªakdown
->
£ektime
 = 0;

300 
bªakdown
->
öôül_œãncy
 = 0;

301 
bªakdown
->
öôül_x„r
 = 0;

302 
bªakdown
->
addl_œãncy
 = 0;

303 
bªakdown
->
addl_x„r
 = 0;

307 
l
 = 
d
->
œyout
->
	`dm_å™¶©e_±ﬁ
(d, &
pbn
, 0);

309 
œ°lbn
 = 
l
+
Àn
-1;

312 
dm_mech_ac˘imes
 
ibªak
;

316 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
l
, 
MAP_FULL
, &
pbn
, 0);

317 
d
->
œyout
->
	`dm_gë_åack_bound¨õs
(d,

318 &
pbn
,

320 &
lbnhigh
,

323 
	`ddbg_as£π
((
lbnhigh
 !
DM_SLIPPED
Ë&& (lbnhigh !
DM_REMAPPED
));

325 if(
lbnhigh
 > 
œ°lbn
) {Übnhigh =Üastlbn; }

332 
ªsu…
 +
	`dm_ac˘ime_åack
(
d
,

333 &
s
,

334 &
pbn
,

335 
lbnhigh
 - 
l
 + 1,

336 
rw
,

337 
immed
,

338 &
s2
,

339 &
ibªak
);

341 
s
 = 
s2
;

343 
l
 = 
lbnhigh
 + 1;

345 if(
bªakdown
) {

346 if((
pbn
.
cyl
 =
°¨t
->cyl)

347 && (
pbn
.
hód
 =
°¨t
->head)

348 && (
pbn
.
£˘‹
 =
°¨t
->sector))

350 
bªakdown
->
£ektime
 = 
ibªak
.seektime;

351 
bªakdown
->
öôül_œãncy
 = 
ibªak
.initial_latency;

352 
bªakdown
->
öôül_x„r
 = 
ibªak
.initial_xfer;

353 if(
lbnhigh
 =
œ°lbn
) {

355 
bªakdown
->
addl_œãncy
 = 
ibªak
.addl_latency;

356 
bªakdown
->
addl_x„r
 = 
ibªak
.addl_xfer;

359 
bªakdown
->
öôül_x„r
 +
ibªak
.
addl_œãncy
;

360 
bªakdown
->
öôül_x„r
 +
ibªak
.
addl_x„r
;

372 } 
œ°lbn
 > 
lbnhigh
);

374  
ªsu…
;

375 
	}
}

380 
dm_time_t


381 
	$dm_œãncy_g1
(
dm_disk_if
 *
d
,

382 
dm_mech_°©e
 *
begö
,

383 
°¨t_£˘
,

384 
Àn
,

385 
immed
,

386 
dm_time_t
 *
addtﬁ©ícy
)

388 
dm_pbn
 
tmµbn
;

389 
£˘‹s
;

391 
dm_™gÀ_t
 
°¨t
, 
íd
;

392 
dm_™gÀ_t
 
thëa
 = 
begö
->theta;

393 
dm_time_t
 
ªsu…
;

396 
tmµbn
.
hód
 = 
begö
->head;

397 
tmµbn
.
cyl
 = 
begö
->cyl;

398 
tmµbn
.
£˘‹
 = 0;

399 
£˘‹s
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_pbn
(d, &
tmµbn
);

401 
	`ddbg_as£π
(
Àn
 <
£˘‹s
);

403 
tmµbn
.
hód
 = 
begö
->head;

404 
tmµbn
.
cyl
 = 
begö
->cyl;

405 
tmµbn
.
£˘‹
 = 
°¨t_£˘
;

406 
°¨t
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
tmµbn
);

411 if(!
immed
) {

417 
ªsu…
 = 
d
->
mech
->
	`dm_rŸtime
(d, 
thëa
, 
°¨t
);

419 if(
addtﬁ©ícy
) {

420 *
addtﬁ©ícy
 = 0;

422  
ªsu…
;

425 
dm_™gÀ_t
 
exåa
 = 0;

426 
tmµbn
.
£˘‹
 = (
°¨t_£˘
 + 
Àn
 - 1);

428 if(
tmµbn
.
£˘‹
 >
£˘‹s
) {

429 
tmµbn
.
£˘‹
 = 
£˘‹s
 - 1;

433 
íd
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
tmµbn
);

437 if(((
thëa
 <
°¨t
Ë&& (°¨à< 
íd
))

438 || ( (
íd
 < 
thëa
Ë&& (thë®<
°¨t
) )

439 || ( (
°¨t
 < 
íd
Ë&& (íd <
thëa
))

440 || (
tmµbn
.
£˘‹
 =
°¨t_£˘
))

443 
exåa
 = 0;

447 
tmµbn
.
hód
 = 
begö
->head;

448 
tmµbn
.
cyl
 = 
begö
->cyl;

449 
tmµbn
.
£˘‹
 = 
d
->
mech
->
	`dm_ac˚ss_block
(d, 
begö
, 
°¨t_£˘
, 
Àn
, 
immed
);

450 
°¨t
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
tmµbn
);

452 if(
Àn
 !
£˘‹s
) {

453 
exåa£˘‹s
 = 
£˘‹s
 - 
Àn
;

454 
dm_pbn
 
tmµbn2
;

456 
tmµbn2
.
hód
 = 
begö
->head;

457 
tmµbn2
.
cyl
 = 
begö
->cyl;

458 
tmµbn2
.
£˘‹
 = 
exåa£˘‹s
;

460 
exåa
 = 
d
->
œyout
->
	`dm_gë_£˘‹_width
(d, &
tmµbn2
, 
exåa£˘‹s
);

461 
	`ddbg_as£π
(
exåa
 != 0);

464 
exåa
 = 0;

468 
ªsu…
 = 
d
->
mech
->
	`dm_rŸtime
(d, 
thëa
, 
°¨t
);

470 if(
addtﬁ©ícy
 && 
exåa
) {

471 *
addtﬁ©ícy
 = 
d
->
mech
->
	`dm_rŸtime
(d, 0, 
exåa
);

474  
ªsu…
;

479 
	}
}

481 
dm_time_t


482 
	$dm_œãncy_£q_g1
(
dm_disk_if
 *
d
,

483 
dm_mech_°©e
 *
begö
,

484 
°¨t_£˘
,

485 
Àn
,

486 
immed
,

487 
dm_time_t
 *
addtﬁ©ícy
)

489 
	`ddbg_as£π
(0);

491 
	}
}

497 
	$g1_ac˚ss_block
(
dm_disk_if
 *
d
,

498 
dm_mech_°©e
 *
öôül
,

499 
°¨t_£˘
,

500 
Àn
,

501 
immed
)

503 
£˘‹s
;

504 
dm_±ﬁ_ªsu…_t
 
rv
;

505 
dm_™gÀ_t
 
°¨t
, 
íd
, 
skew
;

506 
dm_pbn
 
tmµbn
;

507 
dm_™gÀ_t
 
thëa
 = 
öôül
->theta;

510 
tmµbn
.
cyl
 = 
öôül
->cyl;

511 
tmµbn
.
hód
 = 
öôül
->head;

512 
tmµbn
.
£˘‹
 = 
°¨t_£˘
;

513 
£˘‹s
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_pbn
(d, &
tmµbn
);

516 
	`ddbg_as£π
(
Àn
 <
£˘‹s
);

518 
skew
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
tmµbn
);

519 
°¨t
 = 
skew
;

521 if(!
immed
) {

522  
°¨t_£˘
;

526 
tmµbn
.
£˘‹
 = (
°¨t_£˘
 + 
Àn
 - 1);

528 if(
tmµbn
.
£˘‹
 >
£˘‹s
) {

529 
tmµbn
.
£˘‹
 = 
£˘‹s
 - 1;

533 
íd
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
tmµbn
);

536 if(((
thëa
 <
°¨t
Ë&& (°¨à< 
íd
))

537 || ( (
íd
 < 
thëa
Ë&& (thë®<
°¨t
) )

538 || ( (
°¨t
 < 
íd
Ë&& (íd <
thëa
))

539 || (
tmµbn
.
£˘‹
 =
°¨t_£˘
))

541 
	`ddbg_as£π
(
°¨t_£˘
 < 
£˘‹s
);

542  
°¨t_£˘
;

547 
dm_™gÀ_t
 
åack_skew
;

548 
dm_pbn
 
åack_ídpbn
;

549 
dm_mech_°©e
 
skewed
;

550 
dm_pbn
 
ªsu…_pbn
;

551 
dm_™gÀ_t
 
£˘Width
 =

552 
d
->
œyout
->
	`dm_gë_£˘‹_width
(d, &
tmµbn
, 1);

554 if(
£˘Width
 == 0) {

555 
out_nx
;

558 
åack_ídpbn
.
cyl
 = 
öôül
->cyl;

559 
åack_ídpbn
.
hód
 = 
öôül
->head;

561 
åack_ídpbn
.
£˘‹
 = 0;

562 
åack_skew
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
åack_ídpbn
);

564 
skewed
.
cyl
 = 
öôül
->cyl;

565 
skewed
.
hód
 = 
öôül
->head;

566 
skewed
.
thëa
 =Åhë®- 
åack_skew
;

568 if((
skewed
.
thëa
 % 
£˘Width
) != 0) {

569 
skewed
.
thëa
 +(
£˘Width
 - (skewed.theta % sectWidth));

573 
rv
 = 
d
->
œyout
->
	`dm_c⁄vît_©›
(d, &
skewed
, &
ªsu…_pbn
);

574 if(
rv
 < 0) {

575 
out_nx
;

578 
	`ddbg_as£π
(
ªsu…_pbn
.
£˘‹
 < 
£˘‹s
);

579  
ªsu…_pbn
.
£˘‹
;

584 
out_nx
:

585  
°¨t_£˘
;

587 
	}
}

589 
dm_time_t


590 
	$dm_œãncy_g1_avîage
(
dm_disk_if
 *
d
,

591 
dm_mech_°©e
 *
begö
,

592 
°¨t
,

593 
Àn
,

594 
immed
)

596 
dm_time_t
 
ªsu…
;

597 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

598 
ªsu…
 = 
m
->
rŸ©ëime
 >> 1;

599  
ªsu…
;

600 
	}
}

607 
dm_time_t


608 
	$dm_rŸtime_g1_avîage
(
dm_disk_if
 *
d
,

609 
dm_™gÀ_t
 
junk1
,

610 
dm_™gÀ_t
 
junk2
)

612 
dm_time_t
 
ªsu…
;

613 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

614 
ªsu…
 = 
m
->
rŸ©ëime
 >> 1;

615  
ªsu…
;

616 
	}
}

618 
dm_time_t


619 
	$dm_rŸtime_g1
(
dm_disk_if
 *
d
,

620 
dm_™gÀ_t
 
begö
,

621 
dm_™gÀ_t
 
íd
)

623 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

624 
dm_™gÀ_t
 
diff
;

625 if(
íd
 =
begö
) {

628 if(
íd
 > 
begö
) {

629 
diff
 = 
íd
 - 
begö
;

633 
diff
 = -(
begö
 - 
íd
);

641  (((()
diff
 << 20Ë>> 
DM_ANGLE_EXP
Ë* 
m
->
rŸ©ëime
) >> 20;

642 
	}
}

647 
dm_time_t


648 
	$dm_x„πime_g1
(
dm_disk_if
 *
d
,

649 
dm_mech_°©e
 *
åack
,

650 
Àn
)

652 
dm_pbn
 
pbn
;

654 
dm_™gÀ_t
 
thëa
;

657 
pbn
.
hód
 = 
åack
->head;

658 
pbn
.
cyl
 = 
åack
->cyl;

659 
pbn
.
£˘‹
 = 
Àn
 - 1;

670 
dm_pbn
 
tmµbn
;

671 
tmµbn
.
hód
 = 
åack
->head;

672 
tmµbn
.
cyl
 = 
åack
->cyl;

673 
tmµbn
.
£˘‹
 = 0;

674 
thëa
 = 
d
->
œyout
->
	`dm_gë_£˘‹_width
(d, &
tmµbn
, 
Àn
);

677  
d
->
mech
->
	`dm_rŸtime
(d, 0, 
thëa
);

678 
	}
}

682 
dm_time_t


683 
	$dm_hódswôch_time_g1
(
dm_disk_if
 *
d
,

684 
h1
,

685 
h2
)

687 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

688 if(
h1
 !
h2
) {

689  
m
->
hódswôch
;

694 
	}
}

699 
dm_™gÀ_t


700 
	$dm_rŸ©e_g1
(
dm_disk_if
 *
d
,

701 
dm_time_t
 *
time
)

703 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

704 if(*
time
 == 0) {

710 
uöt64_t
 
ªsu…2
;

720 
ªsu…2
 = ((*
time
 << (64 - 
DM_TIME_EXP
))

721 / 
m
->
rŸ©ëime
)

722 << (
DM_TIME_EXP
 - 
DM_ANGLE_EXP
);

725  
ªsu…2
;

727 
	}
}

733 
	$dm_¥ogªss_g1
(
dm_disk_if
 *
d
,

734 
dm_pbn
 *
cur_°©e
,

735 
dm_time_t
 
time
,

736 
dm_pbn
 *
ªsu…_°©e
)

738 
	`ddbg_as£π2
(0, "unimplemented");

739 
	}
}

741 
dm_time_t


742 
	$dm_≥riod_g1
(
dm_disk_if
 *
d
) {

743 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

744  
m
->
rŸ©ëime
;

745 
	}
}

750 
	$mech_g1_m¨shÆed_Àn
(
dm_disk_if
 *
d
) {

751 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

752 
ªsu…
 = (
dm_mech_g1
);

753 
ªsu…
 +(
dm_m¨shÆ_hdr
);

754 
ªsu…
 +
m
->
x£ek˙t
 * ((Ë+ (
dm_time_t
));

755  
ªsu…
;

756 
	}
}

760 
	$dm_mech_g1_£t_≥riod
(
dm_disk_if
 *
d
) {

762 
	}
}

766 *
mech_g1_m¨shÆ
(
dm_disk_if
 *
d
, *
b
);

768 *
	gmech_g1_‚s
[] = {

769 
dm_£ek_time_g1
,

770 
g1_ac˚ss_block
,

771 
dm_œãncy_g1
,

772 
dm_pos_time_g1
,

773 
dm_ac˘ime_g1
,

774 
dm_rŸtime_g1
,

775 
dm_x„πime_g1
,

776 
dm_hódswôch_time_g1
,

777 
dm_rŸ©e_g1
,

778 
dm_≥riod_g1
,

780 
dm_mech_g1_£t_≥riod
,

782 
mech_g1_m¨shÆed_Àn
,

783 
mech_g1_m¨shÆ
,

785 
dm_mech_g1_£ek_c⁄°
,

786 
dm_mech_g1_£ek_3±_löe
,

787 
dm_mech_g1_£ek_3±_curve
,

788 
dm_mech_g1_£ek_h∂
,

789 
dm_mech_g1_£ek_1°10_∂us_h∂
,

790 
dm_mech_g1_£ek_exåa˘ed
,

792 
dm_œãncy_£q_g1


797 
	$mech_g1_m¨shÆ
(
dm_disk_if
 *
d
, *
b
) {

798 **
‚s
;

799 
i
, 
‚s_Àn
, 
£ek‚s_Àn
;

800 *
±r
 = 
b
;

802 
dm_m¨shÆ_hdr
 *
h
 = (dm_m¨shÆ_hd∏*)
b
;

803 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

818 
h
->
ty≥
 = 
DM_MECH_G1_TYP
;

819 
h
->
Àn
 = 
	`mech_g1_m¨shÆed_Àn
(
d
);

820 
±r
 +(*
h
);

823 
	`mem˝y
(
±r
, (*)
m
, (
dm_mech_g1
));

824 
	`m¨shÆ_‚s
((**)&
m
->
hdr
,

825 (
dm_mech_if
) / (*),

826 
±r
,

827 
DM_MECH_G1_TYP
);

830 *
£ek‚off£t
 = (*)
±r
 + (
dm_mech_if
);

832 
	`m¨shÆ_‚
((*)
m
->
£ek‚
, 
DM_MECH_G1_TYP
,

833 (
m¨shÆed_‚
 *)
£ek‚off£t
);

836 
±r
 +(
dm_mech_g1
) + (*);

837 if(
m
->
x£ek˙t
 != 0) {

838 
di°size
 = 
m
->
x£ek˙t
 * ();

839 
timesize
 = 
m
->
x£ek˙t
 * (
dm_time_t
);

841 
	`mem˝y
(
±r
, (*)
m
->
x£ekdi°s
, 
di°size
);

842 
±r
 +
di°size
;

843 
	`mem˝y
(
±r
, (*)
m
->
x£ektimes
, 
timesize
);

844 
±r
 +
timesize
;

847  (*)
±r
;

848 
	}
}

851 
	$mech_g1_unm¨shÆ
(
dm_m¨shÆ_hdr
 *
h
,

852 **
ªsu…
,

853 *
∑ª¡
)

855 *
±r
 = (*)
h
;

856 
dm_mech_g1
 *
m
 = 
	`mÆloc
((dm_mech_g1));

858 
±r
 +(*
h
);

859 
	`mem˝y
((*)
m
, 
±r
, (
dm_mech_g1
));

860 
	`unm¨shÆ_‚s
((**)&
m
->
hdr
,

861 (
dm_mech_if
) / (*),

862 
±r
,

863 
DM_MECH_G1_TYP
);

866 *
£ek‚off£t
 = (*)
±r
 + (
dm_mech_if
);

867 
m
->
£ek‚
 = 
	`unm¨shÆ_‚
(
£ek‚off£t
,

868 
DM_MECH_G1_TYP
);

870 
±r
 +(
dm_mech_g1
) + (*);

872 if(
m
->
x£ek˙t
 != 0) {

873 
di°size
 = 
m
->
x£ek˙t
 * ();

874 
timesize
 = 
m
->
x£ek˙t
 * (
dm_time_t
);

876 
m
->
x£ekdi°s
 = 
	`mÆloc
(
di°size
);

877 
m
->
x£ektimes
 = 
	`mÆloc
(
timesize
);

878 
	`mem˝y
((*)
m
->
x£ekdi°s
, 
±r
, 
di°size
);

879 
±r
 +
di°size
;

880 
	`mem˝y
((*)
m
->
x£ektimes
, 
±r
, 
timesize
);

881 
±r
 +
timesize
;

885 
m
->
disk
 = 
∑ª¡
;

887 *
ªsu…
 = 
m
;

888  
±r
;

889 
	}
}

892 
dm_m¨shÆ_moduÀ
 
	gdm_mech_g1_m¨shÆ_mod
 =

893 { 
mech_g1_unm¨shÆ
,

894 
mech_g1_‚s
,

895 (
mech_g1_‚s
) / (*)

901 
dm_mech_if
 
	gdm_mech_g1
 = {

902 
dm_£ek_time_g1
,

903 
g1_ac˚ss_block
,

904 
dm_œãncy_g1
,

905 
dm_œãncy_£q_g1
,

906 
dm_pos_time_g1
,

907 
dm_ac˘ime_g1
,

908 
dm_rŸtime_g1
,

910 
dm_x„πime_g1
,

911 
dm_hódswôch_time_g1
,

912 
dm_rŸ©e_g1
,

914 
dm_≥riod_g1
,

916 
dm_mech_g1_£t_≥riod
,

918 
mech_g1_m¨shÆed_Àn
,

919 
mech_g1_m¨shÆ


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/mech_g1.h

98 #i‚de‡
_DM_MECH_H


99 
	#_DM_MECH_H


	)

101 
	~"dm.h
"

105 
	mSEEK_CONST
,

106 
	mSEEK_3PT_LINE
,

107 
	mSEEK_3PT_CURVE
,

108 
	mSEEK_HPL
,

109 
	mSEEK_1ST10_PLUS_HPL
,

110 
	mSEEK_EXTRACTED


111 } 
	tdisk_£ek_t
;

113 
	#DM_MECH_G1_MAX_SEEK
 
SEEK_EXTRACTED


	)

118 
	mAVGROTATE
 = -1,

119 
	mSKEWED_FOR_TRACK_SWITCH
 = -2,

120 
	mNON_SKEWED
 = -3

121 } 
	tdisk_œãncy_t
;

124 
	$dm_time_t
(*
	tdm_mech_g1_£ek‚
)(
	tdm_disk_if
 *
	td
,

125 
	tdm_mech_°©e
 *
	tbegö
,

126 
	tdm_mech_°©e
 *
	tíd
,

127 
	trw
);

129 
	sdm_mech_g1
 {

130 
dm_mech_if
 
hdr
;

133 
dm_mech_g1_£ek‚
 
£ek‚
;

135 
dm_disk_if
 *
disk
;

143 
dm_time_t
 
ac˘ime
;

145 
disk_£ek_t
 
£ekty≥
;

147 
dm_time_t
 
£ektime
;

150 
dm_time_t
 
£ek⁄e
;

153 
dm_time_t
 
£ekavg
;

156 
dm_time_t
 
£ekfuŒ
;

159 
dm_time_t
 
£ekwrôedñè
;

161 
hp£ek_v1
;

162 
dm_time_t
 
hp£ek
[6];

163 
dm_time_t
 
fú°10£eks
[10];

166 
x£ek˙t
;

167 *
x£ekdi°s
;

168 
dm_time_t
 *
x£ektimes
;

171 
dm_time_t
 
hódswôch
;

177 
disk_œãncy_t
 
œãncy
;

178 
dm_time_t
 
rŸ©ëime
;

180 
uöt64_t
 
Ωmîr
;

181 
uöt64_t
 
Ωm
;

185 
immedªad
;

186 
immedwrôe
;

187 
immed
;

191 
dm_time_t
 
blkå™°ime
;

199 
dm_mech_if
 
dm_mech_g1
;

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/mech_g1_load.c

102 
	~"moduÀs/moduÀs.h
"

106 
	~<î∫o.h
>

107 
	~<°dio.h
>

109 
	~<lib∑øm/lib∑øm.h
>

110 
	~<lib∑øm/bôve˘‹.h
>

111 
	~"mech_g1.h
"

112 
	~"mech_g1_¥iv©e.h
"

118 
dm_mech_g1_ªad_exåa˘ed_£ek_curve
(*
fûíame
,

119 *
˙çå
,

120 **
di°•å
,

121 
dm_time_t
 **
time•å
);

123 
do_1°10_£eks
(
dm_mech_g1
 *
ªsu…
, 
Õ_li°
 *
l
);

124 
do_h∂_£ek
(
dm_mech_g1
 *
ªsu…
, 
Õ_li°
 *
l
);

128 
dm_mech_if
 *

129 
	$dm_mech_g1_lﬂd∑øms
(
Õ_block
 *
b
, *
junk
) {

131 
dm_mech_g1
 *
ªsu…
 = 
	`mÆloc
((*result));

132 
ªsu…
->
hdr
 = 
dm_mech_g1
;

134 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
dm_mech_g1_mod
);

137 
ªsu…
->
rŸ©ëime
 = 
	`dm_time_dtoi
(1000.0 / ((Ïesu…->
Ωm
 / 60.0));

139  (
dm_mech_if
 *)
ªsu…
;

140 
	}
}

144 
	$dm_mech_g1_ªad_exåa˘ed_£ek_curve
 (*
fûíame
,

145 *
˙çå
,

146 **
di°•å
,

147 
dm_time_t
 **
time•å
)

149 
rv
, 
m©
;

150 
löeÊag
 = 1;

151 
cou¡
 = 0, 
buÊí
 = 128;

152 *
di°s
;

153 
dm_time_t
 *
times
;

154 
FILE
 *
£ekfûe
;

155 
löebuf
[1024];

157 *
∑th«me
 = 
	`Õ_£¨ch_∑th
(
Õ_cwd
, 
fûíame
);

159 if(
∑th«me
) {

160 
£ekfûe
 = 
	`f›í
(
∑th«me
, "r");

163 
	`ddbg_as£π2
(0, "Seek fileÇot found inÖath!");

166 
	`ddbg_as£π3
(
£ekfûe
 != 0, ("fopen seekfile (%s) failed: %s",

167 
fûíame
,

168 
	`°ªº‹
(
î∫o
)));

171 
rv
 = (
	`fgës
(
löebuf
, ÷öebuf), 
£ekfûe
) != 0);

173 
m©
 = 
	`ssˇnf
(
löebuf
, "Sìk di°™˚†mósuªd: %d\n", &
cou¡
);

174 if(
m©
 == 1) {

175 
buÊí
 = 
cou¡
;

176 
löeÊag
 = 0;

179 
di°s
 = 
	`ˇŒoc
(
buÊí
, (*dists));

180 
times
 = 
	`ˇŒoc
(
buÊí
, (*times));

184 
time
, 
°dev
;

185 
di°
;

187 if(!
löeÊag
) {

188 
rv
 = (
	`fgës
(
löebuf
, ÷öebuf), 
£ekfûe
) != 0);

191 
löeÊag
 = 0;

193 if(
rv
) {

194 
m©
 = 
	`ssˇnf
(
löebuf
, "%d, %lf, %lf\n", &
di°
, &
time
, &
°dev
);

196 if(
m©
 == 2 || mat == 3) {

197 if(
cou¡
 >
buÊí
-1) {

198 
buÊí
 *= 2;

199 
di°s
 = 
	`ªÆloc
(di°s, 
buÊí
 * (*dists));

200 
times
 = 
	`ªÆloc
—imes, 
buÊí
 * (*times));

203 
di°s
[
cou¡
] = 
di°
;

204 
times
[
cou¡
] = 
	`dm_time_dtoi
(
time
);

205 
cou¡
++;

208 
	`Ârötf
(
°dîr
, "*** bogusÜine in seek curve (%s:%d): %s\n",

209 
__FILE__
, 
__LINE__
, 
löebuf
);

212 } 
rv
);

214 
	`f˛o£
(
£ekfûe
);

215 *
˙çå
 = 
cou¡
;

216 *
di°•å
 = 
di°s
;

217 *
time•å
 = 
times
;

218 
	}
}

222 
	$do_1°10_£eks
(
dm_mech_g1
 *
ªsu…
,

223 
Õ_li°
 *
l
)

225 if(
ªsu…
->
£ektime
 !
SEEK_1ST10_PLUS_HPL
) {

226 
	`Ârötf
(
°dîr
, "*** warning: ignoring First 10 seeksÖarameter for seek function otherÅhan First 10Ölus hpl.\n");

230 if(
l
->
vÆues_Àn
 < 10) {

231 
	`Ârötf
(
°dîr
, "***Éº‹: W™à10 fú° sìkÅime†(gŸ %d)\n", 
l
->
vÆues_Àn
);

235 
e
;

236 
e
 = 0;É < 10;É++) {

237 if(
l
->
vÆues
[
e
]->
t
 !
D
) {

238 
	`Ârötf
(
°dîr
, "***Érror: First 10 seeks must be floats.\n");

240 } if(
l
->
vÆues
[
e
]->
v
.
d
 < 0.0) {

241 
	`Ârötf
(
°dîr
, "***Érror: First 10 seeks must beÇonnegative.\n");

244 
ªsu…
->
fú°10£eks
[
e
] = 
	`dm_time_dtoi
(
l
->
vÆues
[e]->
v
.
d
);

249 
	}
}

251 
	$do_h∂_£ek
(
dm_mech_g1
 *
ªsu…
, 
Õ_li°
 *
l
) {

253 if((
ªsu…
->
£ektime
 !
SEEK_HPL
)

254 && (
ªsu…
->
£ektime
 !
SEEK_1ST10_PLUS_HPL
))

256 
	`Ârötf
(
°dîr
,

261 if(
l
->
vÆues_Àn
 < 6) {

262 
	`Ârötf
(
°dîr
, "***Éº‹: W™à6 HPL sìkÉqu©i⁄Ö¨amëî†(gŸ %d)\n", 
l
->
vÆues_Àn
);

266 
e
;

269 if(
l
->
vÆues
[0]->
t
 !
I
) {

270 
	`Ârötf
(
°dîr
, "***Érror: HPL v1 is in cylinders.\n");

273 if(
l
->
vÆues
[0]->
v
.
i
 < 0) {

274 
	`Ârötf
(
°dîr
, "***Érror: HPL v1 must beÇonnegative.\n");

277 
ªsu…
->
hp£ek_v1
 = 
l
->
vÆues
[0]->
v
.
i
;

279 
e
 = 1;É < 6;É++) {

280 if(
l
->
vÆues
[
e
]->
t
 !
D
) {

281 
	`Ârötf
(
°dîr
, "***Érror: HPL seekÉqn. values v2..v6 must be floats.\n");

284 if((
l
->
vÆues
[
e
]->
v
.
d
 < 0.0) && (e != 5)) {

285 
	`Ârötf
(
°dîr
, "***Érror: HPL seekÉqn. values v2..v5 must beÇonnegative.\n");

289 if((
l
->
vÆues
[
e
]->
v
.
d
 == -1.0) && (e == 5)) {

290 
ªsu…
->
hp£ek
[
e
] = -1;

293 
ªsu…
->
hp£ek
[
e
] = 
	`dm_time_dtoi
(
l
->
vÆues
[e]->
v
.
d
);

298 if(
ªsu…
->
hp£ek
[5] != -1) {

299 
ªsu…
->
£ek⁄e
 =Ñesu…->
hp£ek
[5];

303 
	}
}

309 
	$dm_mech_g1_£ek_öô
(
dm_disk_if
 *
d
) {

310 
tmpfuŒ
, 
tm∑vg
, 
tm±ime
;

311 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

313 
FILE
 *
ouçutfûe
 = 
°dîr
;

315 
	`ddbg_as£π2
(0, "This is deprecatedánd/or hasn't beenÖorted.\n");

319 i‡((
m
->
£ekty≥
 =
SEEK_3PT_CURVE
) &&

320 (
m
->
£ekavg
 > m->
£ek⁄e
))

322 
	`Ârötf
 (
ouçutfûe
, "seekone %lld, seekavg %lld, seekfull %lld\n",

323 
m
->
£ek⁄e
, m->
£ekavg
, m->
£ekfuŒ
);

325 
tmpfuŒ
 = 
m
->
£ekfuŒ
;

326 
tm∑vg
 = 
m
->
£ekavg
;

327 
tm±ime
 = (Ë-10.0 * 
m
->
£ek⁄e
;

328 
tm±ime
 +(Ë15.0 * 
m
->
£ekavg
;

329 
tm±ime
 +(Ë-5.0 * 
m
->
£ekfuŒ
;

333 
m
->
£ekavg
 *= () -15.0;

334 
m
->
£ekavg
 +(Ë7.0 * m->
£ek⁄e
;

335 
m
->
£ekavg
 +(Ë8.0 * m->
£ekfuŒ
;

336 
m
->
£ekavg
 = m->seekavg /

337 (Ë(3 * 
d
->
dm_cyls
);

339 
m
->
£ekfuŒ
 = 
tm±ime
;

349 i‡((
m
->
£ekavg
 < 0.0Ë|| (m->
£ekfuŒ
 < 0.0)) {

350 
m
->
£ekty≥
 = 
SEEK_3PT_CURVE
;

351 
m
->
£ekfuŒ
 = 
tmpfuŒ
;

352 
m
->
£ekavg
 = 
tm∑vg
;

355 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/mech_g1_private.h

32 #i‚de‡
_DM_MECH_G1_PRIVATE_H


33 
	#_DM_MECH_G1_PRIVATE_H


	)

36 
dm_time_t


37 
dm_mech_g1_£ek_c⁄°
(
dm_disk_if
 *
d
,

38 
dm_mech_°©e
 *
begö
,

39 
dm_mech_°©e
 *
íd
,

40 
rw
);

42 
dm_time_t


43 
dm_mech_g1_£ek_3±_curve
(
dm_disk_if
 *
d
,

44 
dm_mech_°©e
 *
begö
,

45 
dm_mech_°©e
 *
íd
,

46 
rw
);

48 
dm_time_t


49 
dm_mech_g1_£ek_3±_löe
(
dm_disk_if
 *
d
,

50 
dm_mech_°©e
 *
begö
,

51 
dm_mech_°©e
 *
íd
,

52 
rw
);

54 
dm_time_t


55 
dm_mech_g1_£ek_h∂
(
dm_disk_if
 *
d
,

56 
dm_mech_°©e
 *
begö
,

57 
dm_mech_°©e
 *
íd
,

58 
rw
);

60 
dm_time_t


61 
dm_mech_g1_£ek_1°10_∂us_h∂
(
dm_disk_if
 *
d
,

62 
dm_mech_°©e
 *
begö
,

63 
dm_mech_°©e
 *
íd
,

64 
rw
);

66 
dm_time_t


67 
dm_mech_g1_£ek_exåa˘ed
(
dm_disk_if
 *
d
,

68 
dm_mech_°©e
 *
begö
,

69 
dm_mech_°©e
 *
íd
,

70 
rw
);

73 
dm_mech_g1_£ek‚
 
dm_mech_g1_£ek‚s
[];

75 
	#DM_MECH_G1_SEEKFNS_LEN
 6

	)

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/mech_g1_seektime.c

101 
	~"mech_g1.h
"

102 
	~"mech_g1_¥iv©e.h
"

106 
dm_time_t


107 
	$dm_mech_g1_£ek_c⁄°
(
dm_disk_if
 *
d
,

108 
dm_mech_°©e
 *
begö
,

109 
dm_mech_°©e
 *
íd
,

110 
rw
)

112 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

113 
	`ddbg_as£π
(
m
->
£ekty≥
 =
SEEK_CONST
);

114  
m
->
£ektime
;

115 
	}
}

118 
dm_time_t


119 
	$dm_mech_g1_£ek_3±_curve
(
dm_disk_if
 *
d
,

120 
dm_mech_°©e
 *
begö
,

121 
dm_mech_°©e
 *
íd
,

122 
rw
)

125 
dm_time_t
 
ªsu…
;

126 
cyls
;

127 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

129 
cyls
 = 
	`abs
(
íd
->
cyl
 - 
begö
->cyl);

130 i‡(
cyls
 == 0) {

131 
ªsu…
 = 0;

134 
ªsu…
 = 
m
->
£ek⁄e
;

135 
ªsu…
 +
m
->
£ekavg
 * (
cyls
 - 1);

136 
ªsu…
 +
m
->
£ekfuŒ
 * 
	`sqπ32
(
cyls
 - 1);

139  
ªsu…
;

140 
	}
}

143 
dm_time_t


144 
	$dm_mech_g1_£ek_3±_löe
(
dm_disk_if
 *
d
,

145 
dm_mech_°©e
 *
begö
,

146 
dm_mech_°©e
 *
íd
,

147 
rw
)

149 
mu…
;

150 
numcyls
;

151 
cyls
;

152 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

153 
dm_time_t
 
ªsu…
;

155 
cyls
 = 
	`abs
(
íd
->
cyl
 - 
begö
->cyl);

156 
numcyls
 = 
cyls
;

158 if(
cyls
 == 1) {

159 
ªsu…
 = 
m
->
£ek⁄e
;

161 if(
cyls
 == 0) {

162 
ªsu…
 = 0;

164 if(
cyls
 <(
numcyls
 / 3)) {

166 
mu…
 = (3*(
cyls
-1Ë/ 
numcyls
);

167 
ªsu…
 = 
m
->
£ek⁄e
;

168 
ªsu…
 +
mu…
 * (
m
->
£ekavg
 -Ñesult);

172 
mu…
 = ((3*
cyls
 - 
numcyls
) / (2*numcyls));

173 
ªsu…
 = 
m
->
£ekavg
;

174 
ªsu…
 +
mu…
 * (
m
->
£ekfuŒ
 -Ñesult);

177  
ªsu…
;

178 
	}
}

182 #i‚de‡
_DISKMODEL_FREEBSD


192 
dm_time_t


193 
	$dm_mech_g1_£ek_h∂
(
dm_disk_if
 *
d
,

194 
dm_mech_°©e
 *
begö
,

195 
dm_mech_°©e
 *
íd
,

196 
rw
)

198 
dm_time_t
 *
hp£ek
;

199 
di°
;

200 
dm_time_t
 
ªsu…
;

201 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

204 
hp£ek
 = 
m
->hpseek;

205 
di°
 = 
	`abs
(
íd
->
cyl
 - 
begö
->cyl);

207 i‡(
di°
 == 0) {

208 
ªsu…
 = 0.0;

210 if((
di°
 =1Ë&& (
hp£ek
[5] != -1)) {

211 
ªsu…
 = 
m
->
£ek⁄e
;

213 if(
di°
 < 
hp£ek
[0]) {

215 
ªsu…
 = ((
	`sqπ64
((
uöt64_t
)
di°
 << 32Ë* 
hp£ek
[2]) >> 16) + hpseek[1];

218 
ªsu…
 = (
hp£ek
[4] * (Ë
di°
) + hpseek[3];

221  
ªsu…
;

222 
	}
}

230 
dm_time_t


231 
	$dm_mech_g1_£ek_1°10_∂us_h∂
(
dm_disk_if
 *
d
,

232 
dm_mech_°©e
 *
begö
,

233 
dm_mech_°©e
 *
íd
,

234 
rw
)

237 
dm_time_t
 *
hp£ek
;

238 
dm_time_t
 
ªsu…
;

239 
di°
 = 
	`abs
(
íd
->
cyl
 - 
begö
->cyl);

241 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

243 
hp£ek
 = 
m
->hpseek;

245 if(
di°
 == 0) {

246 
ªsu…
 = 0;

248 i‡(
di°
 <= 10) {

249 
ªsu…
 = 
m
->
fú°10£eks
[(
di°
 - 1)];

251 i‡(
di°
 < 
m
->
hp£ek_v1
) {

253 
ªsu…
 = ((
	`sqπ64
((
uöt64_t
)
di°
 << 32Ë* 
hp£ek
[2]) >> 16) + hpseek[1];

256 
ªsu…
 = (
hp£ek
[4] * 
di°
) + hpseek[3];

259 if(
begö
->
hód
 !
íd
->head) {

260 
hódsw
;

261 
hódsw
 = 
d
->
mech
->
	`dm_hódswôch_time
(d, 
begö
->
hód
, 
íd
->head);

262 if(
hódsw
 > 
ªsu…
) {

263 
ªsu…
 = 
hódsw
;

268  
ªsu…
;

269 
	}
}

273 
dm_time_t


274 
	$dm_mech_g1_£ek_h∂
(
dm_disk_if
 *
d
,

275 
dm_mech_°©e
 *
begö
,

276 
dm_mech_°©e
 *
íd
,

277 
rw
)

279 
	`ddbg_as£π2
(0, "seek_hpl currently unavailable for kernel");

281 
	}
}

283 
dm_time_t


284 
	$dm_mech_g1_£ek_1°10_∂us_h∂
(
dm_disk_if
 *
d
,

285 
dm_mech_°©e
 *
begö
,

286 
dm_mech_°©e
 *
íd
,

287 
rw
)

290 
	`ddbg_as£π2
(0, "seek_1st10_plus_hpl currently unavailable for kernel");

292 
	}
}

296 
dm_time_t


297 
	$dm_mech_g1_£ek_exåa˘ed
(
dm_disk_if
 *
d
,

298 
dm_mech_°©e
 *
begö
,

299 
dm_mech_°©e
 *
íd
,

300 
rw
)

303 
dm_time_t
 
ªsu…
 = 0;

304 
i
;

305 
di°
 = 
	`abs
(
íd
->
cyl
 - 
begö
->cyl);

306 
dm_mech_g1
 *
m
 = (dm_mech_g1 *)
d
->
mech
;

308 
dm_time_t
 
t1
,
t2
;

309 
d1
, 
d2
;

311 if(
di°
) {

317 
i
 = 0; i < 
m
->
x£ek˙t
; i++) {

318 if(
di°
 =
m
->
x£ekdi°s
[
i
]) {

319 
ªsu…
 = 
m
->
x£ektimes
[
i
];

324 i‡(
di°
 <
m
->
x£ekdi°s
[
i
]

325 || (
i
 =
m
->
x£ek˙t
-1))

327 
t1
 = 
m
->
x£ektimes
[
i
-1];

328 
t2
 = 
m
->
x£ektimes
[
i
];

329 
d1
 = 
m
->
x£ekdi°s
[
i
-1];

330 
d2
 = 
m
->
x£ekdi°s
[
i
];

343 
ªsu…
 = 
m
->
x£ektimes
[(
i
-1)];

346 if(
t1
 > 
t2
) {

348 
ªsu…
 -(
di°
 - 
d1
Ë* (
t1
 - 
t2
Ë/ (
d2
 - d1);

352 
ªsu…
 +(
di°
 - 
d1
Ë* (
t2
 - 
t1
Ë/ (
d2
 - d1);

359  
ªsu…
;

360 
	}
}

364 
dm_mech_g1_£ek‚
 
	gdm_mech_g1_£ek‚s
[] = {

365 
dm_mech_g1_£ek_c⁄°
,

366 
dm_mech_g1_£ek_3±_löe
,

367 
dm_mech_g1_£ek_3±_curve
,

368 
dm_mech_g1_£ek_h∂
,

369 
dm_mech_g1_£ek_1°10_∂us_h∂
,

370 
dm_mech_g1_£ek_exåa˘ed


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_disk_param.c

1 
	~"dm_disk_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../dm.h
"

5 
	$DM_DISK_BLOCK_COUNT_dïíd
(*
bv
)

8 
	}
}

11 
	$DM_DISK_BLOCK_COUNT_lﬂdî
(
dm_disk_if
 * 
ªsu…
, 
i
)

13 i‡(!(
i
 >= 0)) {

16 
ªsu…
->
dm_£˘‹s
 = 
i
;

18 
	}
}

21 
	$DM_DISK_NUMBER_OF_DATA_SURFACES_dïíd
(*
bv
)

24 
	}
}

27 
	$DM_DISK_NUMBER_OF_DATA_SURFACES_lﬂdî
(
dm_disk_if
 * 
ªsu…
, 
i
)

29 i‡(!(
i
 > 0)) {

32 
ªsu…
->
dm_surÁ˚s
 = 
i
;

34 
	}
}

37 
	$DM_DISK_NUMBER_OF_CYLINDERS_dïíd
(*
bv
)

40 
	}
}

43 
	$DM_DISK_NUMBER_OF_CYLINDERS_lﬂdî
(
dm_disk_if
 * 
ªsu…
, 
i
)

45 i‡(!(
i
 > 0)) {

48 
ªsu…
->
dm_cyls
 = 
i
;

50 
	}
}

53 
	$DM_DISK_MECHANICAL_MODEL_dïíd
(*
bv
)

56 
	}
}

59 
	$DM_DISK_MECHANICAL_MODEL_lﬂdî
(
dm_disk_if
 * 
ªsu…
, 
Õ_block
 * 
blk
)

61 i‡(!(
ªsu…
->
mech
 = ((
dm_mech_lﬂdî_t
Ë
blk
->
lﬂdî
) (blk,Ñesult))) {

64 
	}
}

67 
	$DM_DISK_LAYOUT_MODEL_dïíd
(*
bv
)

70 
	}
}

73 
	$DM_DISK_LAYOUT_MODEL_lﬂdî
(
dm_disk_if
 * 
ªsu…
, 
Õ_block
 * 
blk
)

75 i‡(!(
ªsu…
->
œyout
 = ((
dm_œyout_lﬂdî_t
Ë
blk
->
lﬂdî
) (blk,Ñesult))) {

78 
	}
}

80 *
	gDM_DISK_lﬂdîs
[] = {

81 (*Ë
DM_DISK_BLOCK_COUNT_lﬂdî
,

82 (*Ë
DM_DISK_NUMBER_OF_DATA_SURFACES_lﬂdî
,

83 (*Ë
DM_DISK_NUMBER_OF_CYLINDERS_lﬂdî
,

84 (*Ë
DM_DISK_MECHANICAL_MODEL_lﬂdî
,

85 (*Ë
DM_DISK_LAYOUT_MODEL_lﬂdî


88 
Õ_∑ømdï_t
 
	gDM_DISK_dïs
[] = {

89 
DM_DISK_BLOCK_COUNT_dïíd
,

90 
DM_DISK_NUMBER_OF_DATA_SURFACES_dïíd
,

91 
DM_DISK_NUMBER_OF_CYLINDERS_dïíd
,

92 
DM_DISK_MECHANICAL_MODEL_dïíd
,

93 
DM_DISK_LAYOUT_MODEL_dïíd


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_disk_param.h

2 #i‚de‡
_DM_DISK_PARAM_H


3 
	#_DM_DISK_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_disk_if
 *
dm_disk_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
DM_DISK_BLOCK_COUNT
,

16 
DM_DISK_NUMBER_OF_DATA_SURFACES
,

17 
DM_DISK_NUMBER_OF_CYLINDERS
,

18 
DM_DISK_MECHANICAL_MODEL
,

19 
DM_DISK_LAYOUT_MODEL


20 } 
	tdm_disk_∑øm_t
;

22 
	#DM_DISK_MAX_PARAM
 
DM_DISK_LAYOUT_MODEL


	)

23 * 
DM_DISK_lﬂdîs
[];

24 
Õ_∑ømdï_t
 
DM_DISK_dïs
[];

27 
Õ_v¨•ec
 
	gdm_disk_∑øms
 [] = {

28 {"Block cou¡", 
I
, 1 },

29 {"Numbî o‡d©®surÁ˚s", 
I
, 1 },

30 {"Numbî o‡cylödîs", 
I
, 1 },

31 {"Mech™iˇ»Modñ", 
BLOCK
, 0 },

32 {"LayouàModñ", 
BLOCK
, 1 },

35 
	#DM_DISK_MAX
 5

	)

36 
Õ_mod
 
	gdm_disk_mod
 = { "dm_disk", 
dm_disk_∑øms
, 
DM_DISK_MAX
, (
Õ_modlﬂdî_t
)
dm_disk_lﬂd∑øms
, 0, 0, 
DM_DISK_lﬂdîs
, 
DM_DISK_dïs
 };

39 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g1_param.c

1 
	~"dm_œyout_g1_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../œyout_g1.h
"

5 
	$DM_LAYOUT_G1_LBN_TO_PBN_MAPPING_SCHEME_dïíd
(*
bv
)

8 
	}
}

11 
	$DM_LAYOUT_G1_LBN_TO_PBN_MAPPING_SCHEME_lﬂdî
(
dm_œyout_g1
 * 
ªsu…
, 
i
)

13 i‡(!(
	`RANGE
(
i
, 0, 
LAYOUT_MAX
))) {

16 
ªsu…
->
m≠pög
 = 
i
;

18 
	}
}

21 
	$DM_LAYOUT_G1_SPARING_SCHEME_USED_dïíd
(*
bv
)

24 
	}
}

27 
	$DM_LAYOUT_G1_SPARING_SCHEME_USED_lﬂdî
(
dm_œyout_g1
 * 
ªsu…
, 
i
)

29 i‡(!(
	`RANGE
(
i
, 
NO_SPARING
, 
MAXSPARESCHEME
))) {

32 
ªsu…
->
•¨escheme
 = 
i
;

34 
	}
}

37 
	$DM_LAYOUT_G1_RANGESIZE_FOR_SPARING_dïíd
(*
bv
)

40 
	}
}

43 
	$DM_LAYOUT_G1_RANGESIZE_FOR_SPARING_lﬂdî
(
dm_œyout_g1
 * 
ªsu…
, 
i
)

45 i‡(!(
i
 > 0)) {

48 
ªsu…
->
øngesize
 = 
i
;

50 
	}
}

53 
	$DM_LAYOUT_G1_SKEW_UNITS_dïíd
(*
bv
)

56 
	}
}

59 
	$DM_LAYOUT_G1_SKEW_UNITS_lﬂdî
(
dm_œyout_g1
 * 
ªsu…
, *
s
)

61 i‡(!
	`°rcmp
(
s
, "revolutions")) {

62 
ªsu…
->
skew_unôs
 = 
DM_SU_REVOLUTIONS
;

63 } i‡(!
	`°rcmp
(
s
, "sectors")) {

64 
ªsu…
->
skew_unôs
 = 
DM_SU_SECTORS
;

66 
	`ddbg_as£π
(0);

69 
	}
}

72 
	$DM_LAYOUT_G1_ZONES_dïíd
(*
bv
)

75 
	}
}

78 
	$DM_LAYOUT_G1_ZONES_lﬂdî
(
dm_œyout_g1
 * 
ªsu…
, 
Õ_li°
 * 
l
)

80 i‡(!(
	`disk_lﬂd_z⁄es
(
l
, 
ªsu…
))) {

83 
	}
}

85 *
	gDM_LAYOUT_G1_lﬂdîs
[] = {

86 (*Ë
DM_LAYOUT_G1_LBN_TO_PBN_MAPPING_SCHEME_lﬂdî
,

87 (*Ë
DM_LAYOUT_G1_SPARING_SCHEME_USED_lﬂdî
,

88 (*Ë
DM_LAYOUT_G1_RANGESIZE_FOR_SPARING_lﬂdî
,

89 (*Ë
DM_LAYOUT_G1_SKEW_UNITS_lﬂdî
,

90 (*Ë
DM_LAYOUT_G1_ZONES_lﬂdî


93 
Õ_∑ømdï_t
 
	gDM_LAYOUT_G1_dïs
[] = {

94 
DM_LAYOUT_G1_LBN_TO_PBN_MAPPING_SCHEME_dïíd
,

95 
DM_LAYOUT_G1_SPARING_SCHEME_USED_dïíd
,

96 
DM_LAYOUT_G1_RANGESIZE_FOR_SPARING_dïíd
,

97 
DM_LAYOUT_G1_SKEW_UNITS_dïíd
,

98 
DM_LAYOUT_G1_ZONES_dïíd


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g1_param.h

2 #i‚de‡
_DM_LAYOUT_G1_PARAM_H


3 
	#_DM_LAYOUT_G1_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_œyout_if
 *
dm_œyout_g1_lﬂd∑øms
(
Õ_block
 *
b
, 
dm_disk_if
 *
d
);

15 
DM_LAYOUT_G1_LBN_TO_PBN_MAPPING_SCHEME
,

16 
DM_LAYOUT_G1_SPARING_SCHEME_USED
,

17 
DM_LAYOUT_G1_RANGESIZE_FOR_SPARING
,

18 
DM_LAYOUT_G1_SKEW_UNITS
,

19 
DM_LAYOUT_G1_ZONES


20 } 
	tdm_œyout_g1_∑øm_t
;

22 
	#DM_LAYOUT_G1_MAX_PARAM
 
DM_LAYOUT_G1_ZONES


	)

23 * 
DM_LAYOUT_G1_lﬂdîs
[];

24 
Õ_∑ømdï_t
 
DM_LAYOUT_G1_dïs
[];

27 
Õ_v¨•ec
 
	gdm_œyout_g1_∑øms
 [] = {

28 {"LBN-to-PBN m≠pög scheme", 
I
, 1 },

29 {"S∑rög schemêu£d", 
I
, 1 },

30 {"R™gesizêf‹ s∑rög", 
I
, 1 },

31 {"Skew unôs", 
S
, 0 },

32 {"Z⁄es", 
LIST
, 1 },

35 
	#DM_LAYOUT_G1_MAX
 5

	)

36 
Õ_mod
 
	gdm_œyout_g1_mod
 = { "dm_œyout_g1", 
dm_œyout_g1_∑øms
, 
DM_LAYOUT_G1_MAX
, (
Õ_modlﬂdî_t
)
dm_œyout_g1_lﬂd∑øms
, 0, 0, 
DM_LAYOUT_G1_lﬂdîs
, 
DM_LAYOUT_G1_dïs
 };

39 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g1_zone_param.c

1 
	~"dm_œyout_g1_z⁄e_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../œyout_g1.h
"

5 
	$DM_LAYOUT_G1_ZONE_FIRST_CYLINDER_NUMBER_dïíd
(*
bv
)

8 
	}
}

11 
	$DM_LAYOUT_G1_ZONE_FIRST_CYLINDER_NUMBER_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, 
i
)

13 i‡(!(
i
 >= 0)) {

16 
ªsu…
->
°¨tcyl
 = 
i
;

18 
	}
}

21 
	$DM_LAYOUT_G1_ZONE_LAST_CYLINDER_NUMBER_dïíd
(*
bv
)

24 
	}
}

27 
	$DM_LAYOUT_G1_ZONE_LAST_CYLINDER_NUMBER_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, 
i
)

29 i‡(!(
i
 >= 0)) {

32 
ªsu…
->
ídcyl
 = 
i
;

34 
	}
}

37 
	$DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK_dïíd
(*
bv
)

40 
	}
}

43 
	$DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, 
i
)

45 i‡(!(
i
 > 0)) {

48 
ªsu…
->
blk•îåack
 = 
i
;

49 
ªsu…
->
£˘‹_width
 = ((Ë1 << 32Ë/Ñesu…->
blk•îåack
;

51 
	}
}

54 
	$DM_LAYOUT_G1_ZONE_OFFSET_OF_FIRST_BLOCK_dïíd
(*
bv
)

56 i‡(!
	`BIT_TEST
(
bv
, 
DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK
)) {

57  
DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK
;

60 
	}
}

63 
	$DM_LAYOUT_G1_ZONE_OFFSET_OF_FIRST_BLOCK_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, 
d
)

66 
ªsu…
->
skew_unôs
) {

67 
DM_SU_REVOLUTIONS
:

68 
ªsu…
->
fú°blk™gÀ
 = 
	`dm_™gÀ_dtoi
(
d
);

70 
DM_SU_SECTORS
:

72 
ªsu…
->
fú°blk™gÀ
 = (Ë
d
 *ªsu…->
£˘‹_width
;

77 
	}
}

80 
	$DM_LAYOUT_G1_ZONE_SKEW_UNITS_dïíd
(*
bv
)

83 
	}
}

86 
	$DM_LAYOUT_G1_ZONE_SKEW_UNITS_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, *
s
)

88 i‡(!
	`°rcmp
(
s
, "revolutions")) {

89 
ªsu…
->
skew_unôs
 = 
DM_SU_REVOLUTIONS
;

90 } i‡(!
	`°rcmp
(
s
, "sectors")) {

91 
ªsu…
->
skew_unôs
 = 
DM_SU_SECTORS
;

93 
	`ddbg_as£π
(0);

96 
	}
}

99 
	$DM_LAYOUT_G1_ZONE_EMPTY_SPACE_AT_ZONE_FRONT_dïíd
(*
bv
)

102 
	}
}

105 
	$DM_LAYOUT_G1_ZONE_EMPTY_SPACE_AT_ZONE_FRONT_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, 
i
)

107 
ªsu…
->
dód•a˚
 = 
i
;

109 
	}
}

112 
	$DM_LAYOUT_G1_ZONE_SKEW_FOR_TRACK_SWITCH_dïíd
(*
bv
)

114 i‡(!
	`BIT_TEST
(
bv
, 
DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK
)) {

115  
DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK
;

118 
	}
}

121 
	$DM_LAYOUT_G1_ZONE_SKEW_FOR_TRACK_SWITCH_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, 
d
)

124 
ªsu…
->
skew_unôs
) {

125 
DM_SU_REVOLUTIONS
:

126 
ªsu…
->
åackskew
 = 
	`dm_™gÀ_dtoi
(
d
);

128 
DM_SU_SECTORS
:

130 
ªsu…
->
åackskew
 = (Ë
d
 *ªsu…->
£˘‹_width
;

135 
	}
}

138 
	$DM_LAYOUT_G1_ZONE_SKEW_FOR_CYLINDER_SWITCH_dïíd
(*
bv
)

140 i‡(!
	`BIT_TEST
(
bv
, 
DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK
)) {

141  
DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK
;

144 
	}
}

147 
	$DM_LAYOUT_G1_ZONE_SKEW_FOR_CYLINDER_SWITCH_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, 
d
)

150 
ªsu…
->
skew_unôs
) {

151 
DM_SU_REVOLUTIONS
:

152 
ªsu…
->
cylskew
 = 
	`dm_™gÀ_dtoi
(
d
);

154 
DM_SU_SECTORS
:

156 
ªsu…
->
cylskew
 = (Ë
d
 *ªsu…->
£˘‹_width
;

161 
	}
}

164 
	$DM_LAYOUT_G1_ZONE_NUMBER_OF_SPARES_dïíd
(*
bv
)

167 
	}
}

170 
	$DM_LAYOUT_G1_ZONE_NUMBER_OF_SPARES_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, 
i
)

172 
ªsu…
->
•¨e˙t
 = 
i
;

174 
	}
}

177 
	$DM_LAYOUT_G1_ZONE_SLIPS_dïíd
(*
bv
)

180 
	}
}

183 
	$DM_LAYOUT_G1_ZONE_SLIPS_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, 
Õ_li°
 * 
l
)

185 i‡(!(!
	`gë¶ùs
(
ªsu…
, 
l
))) {

188 
	}
}

191 
	$DM_LAYOUT_G1_ZONE_DEFECTS_dïíd
(*
bv
)

194 
	}
}

197 
	$DM_LAYOUT_G1_ZONE_DEFECTS_lﬂdî
(
dm_œyout_g1_b™d
 * 
ªsu…
, 
Õ_li°
 * 
l
)

199 i‡(!(!
	`gëde„˘s
(
ªsu…
, 
l
))) {

202 
	}
}

204 *
	gDM_LAYOUT_G1_ZONE_lﬂdîs
[] = {

205 (*Ë
DM_LAYOUT_G1_ZONE_FIRST_CYLINDER_NUMBER_lﬂdî
,

206 (*Ë
DM_LAYOUT_G1_ZONE_LAST_CYLINDER_NUMBER_lﬂdî
,

207 (*Ë
DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK_lﬂdî
,

208 (*Ë
DM_LAYOUT_G1_ZONE_OFFSET_OF_FIRST_BLOCK_lﬂdî
,

209 (*Ë
DM_LAYOUT_G1_ZONE_SKEW_UNITS_lﬂdî
,

210 (*Ë
DM_LAYOUT_G1_ZONE_EMPTY_SPACE_AT_ZONE_FRONT_lﬂdî
,

211 (*Ë
DM_LAYOUT_G1_ZONE_SKEW_FOR_TRACK_SWITCH_lﬂdî
,

212 (*Ë
DM_LAYOUT_G1_ZONE_SKEW_FOR_CYLINDER_SWITCH_lﬂdî
,

213 (*Ë
DM_LAYOUT_G1_ZONE_NUMBER_OF_SPARES_lﬂdî
,

214 (*Ë
DM_LAYOUT_G1_ZONE_SLIPS_lﬂdî
,

215 (*Ë
DM_LAYOUT_G1_ZONE_DEFECTS_lﬂdî


218 
Õ_∑ømdï_t
 
	gDM_LAYOUT_G1_ZONE_dïs
[] = {

219 
DM_LAYOUT_G1_ZONE_FIRST_CYLINDER_NUMBER_dïíd
,

220 
DM_LAYOUT_G1_ZONE_LAST_CYLINDER_NUMBER_dïíd
,

221 
DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK_dïíd
,

222 
DM_LAYOUT_G1_ZONE_OFFSET_OF_FIRST_BLOCK_dïíd
,

223 
DM_LAYOUT_G1_ZONE_SKEW_UNITS_dïíd
,

224 
DM_LAYOUT_G1_ZONE_EMPTY_SPACE_AT_ZONE_FRONT_dïíd
,

225 
DM_LAYOUT_G1_ZONE_SKEW_FOR_TRACK_SWITCH_dïíd
,

226 
DM_LAYOUT_G1_ZONE_SKEW_FOR_CYLINDER_SWITCH_dïíd
,

227 
DM_LAYOUT_G1_ZONE_NUMBER_OF_SPARES_dïíd
,

228 
DM_LAYOUT_G1_ZONE_SLIPS_dïíd
,

229 
DM_LAYOUT_G1_ZONE_DEFECTS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g1_zone_param.h

2 #i‚de‡
_DM_LAYOUT_G1_ZONE_PARAM_H


3 
	#_DM_LAYOUT_G1_ZONE_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_œyout_g1_z⁄e_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DM_LAYOUT_G1_ZONE_FIRST_CYLINDER_NUMBER
,

16 
DM_LAYOUT_G1_ZONE_LAST_CYLINDER_NUMBER
,

17 
DM_LAYOUT_G1_ZONE_BLOCKS_PER_TRACK
,

18 
DM_LAYOUT_G1_ZONE_OFFSET_OF_FIRST_BLOCK
,

19 
DM_LAYOUT_G1_ZONE_SKEW_UNITS
,

20 
DM_LAYOUT_G1_ZONE_EMPTY_SPACE_AT_ZONE_FRONT
,

21 
DM_LAYOUT_G1_ZONE_SKEW_FOR_TRACK_SWITCH
,

22 
DM_LAYOUT_G1_ZONE_SKEW_FOR_CYLINDER_SWITCH
,

23 
DM_LAYOUT_G1_ZONE_NUMBER_OF_SPARES
,

24 
DM_LAYOUT_G1_ZONE_SLIPS
,

25 
DM_LAYOUT_G1_ZONE_DEFECTS


26 } 
	tdm_œyout_g1_z⁄e_∑øm_t
;

28 
	#DM_LAYOUT_G1_ZONE_MAX_PARAM
 
DM_LAYOUT_G1_ZONE_DEFECTS


	)

29 * 
DM_LAYOUT_G1_ZONE_lﬂdîs
[];

30 
Õ_∑ømdï_t
 
DM_LAYOUT_G1_ZONE_dïs
[];

33 
Õ_v¨•ec
 
	gdm_œyout_g1_z⁄e_∑øms
 [] = {

34 {"Fú° cylödîÇumbî", 
I
, 1 },

35 {"La° cylödîÇumbî", 
I
, 1 },

36 {"Block†≥∏åack", 
I
, 1 },

37 {"Off£ào‡fú° block", 
D
, 1 },

38 {"Skew unôs", 
S
, 0 },

39 {"Em±y s∑˚áàz⁄ê‰⁄t", 
I
, 1 },

40 {"Skew f‹Åøck swôch", 
D
, 0 },

41 {"Skew f‹ cylödî swôch", 
D
, 0 },

42 {"Numbî o‡•¨es", 
I
, 1 },

43 {"¶ùs", 
LIST
, 1 },

44 {"de„˘s", 
LIST
, 1 },

47 
	#DM_LAYOUT_G1_ZONE_MAX
 11

	)

48 
Õ_mod
 
	gdm_œyout_g1_z⁄e_mod
 = { "dm_œyout_g1_z⁄e", 
dm_œyout_g1_z⁄e_∑øms
, 
DM_LAYOUT_G1_ZONE_MAX
, (
Õ_modlﬂdî_t
)
dm_œyout_g1_z⁄e_lﬂd∑øms
, 0, 0, 
DM_LAYOUT_G1_ZONE_lﬂdîs
, 
DM_LAYOUT_G1_ZONE_dïs
 };

51 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g2_param.c

1 
	~"dm_œyout_g2_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../œyout_g2.h
"

5 
	$DM_LAYOUT_G2_LAYOUT_MAP_FILE_dïíd
(*
bv
)

8 
	}
}

11 
	$DM_LAYOUT_G2_LAYOUT_MAP_FILE_lﬂdî
(
dm_œyout_g2
 * 
ªsu…
, *
s
)

13 
ªsu…
->
m≠fûe
 = 
	`°rdup
(
s
);

15 
	}
}

18 
	$DM_LAYOUT_G2_ZONES_dïíd
(*
bv
)

21 
	}
}

24 
	$DM_LAYOUT_G2_ZONES_lﬂdî
(
dm_œyout_g2
 * 
ªsu…
, 
Õ_li°
 * 
l
)

26 
	`g2_lﬂd_z⁄es
(
ªsu…
, 
l
);

28 
	}
}

30 *
	gDM_LAYOUT_G2_lﬂdîs
[] = {

31 (*Ë
DM_LAYOUT_G2_LAYOUT_MAP_FILE_lﬂdî
,

32 (*Ë
DM_LAYOUT_G2_ZONES_lﬂdî


35 
Õ_∑ømdï_t
 
	gDM_LAYOUT_G2_dïs
[] = {

36 
DM_LAYOUT_G2_LAYOUT_MAP_FILE_dïíd
,

37 
DM_LAYOUT_G2_ZONES_dïíd


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g2_param.h

2 #i‚de‡
_DM_LAYOUT_G2_PARAM_H


3 
	#_DM_LAYOUT_G2_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_œyout_if
 *
dm_œyout_g2_lﬂd∑øms
(
Õ_block
 *, 
dm_disk_if
 *
∑ª¡
);

15 
DM_LAYOUT_G2_LAYOUT_MAP_FILE
,

16 
DM_LAYOUT_G2_ZONES


17 } 
	tdm_œyout_g2_∑øm_t
;

19 
	#DM_LAYOUT_G2_MAX_PARAM
 
DM_LAYOUT_G2_ZONES


	)

20 * 
DM_LAYOUT_G2_lﬂdîs
[];

21 
Õ_∑ømdï_t
 
DM_LAYOUT_G2_dïs
[];

24 
Õ_v¨•ec
 
	gdm_œyout_g2_∑øms
 [] = {

25 {"LayouàM≠ Fûe", 
S
, 1 },

26 {"Z⁄es", 
LIST
, 1 },

29 
	#DM_LAYOUT_G2_MAX
 2

	)

30 
Õ_mod
 
	gdm_œyout_g2_mod
 = { "dm_œyout_g2", 
dm_œyout_g2_∑øms
, 
DM_LAYOUT_G2_MAX
, (
Õ_modlﬂdî_t
)
dm_œyout_g2_lﬂd∑øms
, 0, 0, 
DM_LAYOUT_G2_lﬂdîs
, 
DM_LAYOUT_G2_dïs
 };

33 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g2_zone_param.c

1 
	~"dm_œyout_g2_z⁄e_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../œyout_g2.h
"

5 
	$DM_LAYOUT_G2_ZONE_FIRST_CYLINDER_NUMBER_dïíd
(*
bv
)

8 
	}
}

11 
	$DM_LAYOUT_G2_ZONE_FIRST_CYLINDER_NUMBER_lﬂdî
(
dm_œyout_g2_z⁄e
 * 
ªsu…
, 
i
)

13 i‡(!(
i
 >= 0)) {

16 
ªsu…
->
cyŒow
 = 
i
;

18 
	}
}

21 
	$DM_LAYOUT_G2_ZONE_LAST_CYLINDER_NUMBER_dïíd
(*
bv
)

24 
	}
}

27 
	$DM_LAYOUT_G2_ZONE_LAST_CYLINDER_NUMBER_lﬂdî
(
dm_œyout_g2_z⁄e
 * 
ªsu…
, 
i
)

29 i‡(!(
i
 >= 0)) {

32 
ªsu…
->
cylhigh
 = 
i
;

34 
	}
}

37 
	$DM_LAYOUT_G2_ZONE_FIRST_LBN_dïíd
(*
bv
)

40 
	}
}

43 
	$DM_LAYOUT_G2_ZONE_FIRST_LBN_lﬂdî
(
dm_œyout_g2_z⁄e
 * 
ªsu…
, 
i
)

45 i‡(!(
i
 >= 0)) {

48 
ªsu…
->
lb∆ow
 = 
i
;

50 
	}
}

53 
	$DM_LAYOUT_G2_ZONE_LAST_LBN_dïíd
(*
bv
)

56 
	}
}

59 
	$DM_LAYOUT_G2_ZONE_LAST_LBN_lﬂdî
(
dm_œyout_g2_z⁄e
 * 
ªsu…
, 
i
)

61 i‡(!(
i
 >= 0)) {

64 
ªsu…
->
lbnhigh
 = 
i
;

66 
	}
}

69 
	$DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK_dïíd
(*
bv
)

72 
	}
}

75 
	$DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK_lﬂdî
(
dm_œyout_g2_z⁄e
 * 
ªsu…
, 
i
)

77 i‡(!(
i
 > 0)) {

80 
ªsu…
->
°
 = 
i
;

81 
ªsu…
->
£˘‹_width
 = (
dm_™gÀ_t
Ë(((Ë1 << 32Ë/Ñesu…->
°
);

83 
	}
}

86 
	$DM_LAYOUT_G2_ZONE_ZONE_SKEW_dïíd
(*
bv
)

88 i‡(!
	`BIT_TEST
(
bv
, 
DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK
)) {

89  
DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK
;

92 
	}
}

95 
	$DM_LAYOUT_G2_ZONE_ZONE_SKEW_lﬂdî
(
dm_œyout_g2_z⁄e
 * 
ªsu…
, 
d
)

98 
ªsu…
->
skew_unôs
) {

99 
DM_SU_REVOLUTIONS
:

100 
ªsu…
->
zskew
 = 
	`dm_™gÀ_dtoi
(
d
);

102 
DM_SU_SECTORS
:

104 
ªsu…
->
zskew
 = (Ë
d
 *ªsu…->
£˘‹_width
;

109 
	}
}

112 
	$DM_LAYOUT_G2_ZONE_SKEW_UNITS_dïíd
(*
bv
)

115 
	}
}

118 
	$DM_LAYOUT_G2_ZONE_SKEW_UNITS_lﬂdî
(
dm_œyout_g2_z⁄e
 * 
ªsu…
, *
s
)

120 i‡(!
	`°rcmp
(
s
, "revolutions")) {

121 
ªsu…
->
skew_unôs
 = 
DM_SU_REVOLUTIONS
;

122 } i‡(!
	`°rcmp
(
s
, "sectors")) {

123 
ªsu…
->
skew_unôs
 = 
DM_SU_SECTORS
;

125 
	`ddbg_as£π
(0);

128 
	}
}

131 
	$DM_LAYOUT_G2_ZONE_SKEW_FOR_TRACK_SWITCH_dïíd
(*
bv
)

133 i‡(!
	`BIT_TEST
(
bv
, 
DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK
)) {

134  
DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK
;

137 
	}
}

140 
	$DM_LAYOUT_G2_ZONE_SKEW_FOR_TRACK_SWITCH_lﬂdî
(
dm_œyout_g2_z⁄e
 * 
ªsu…
, 
d
)

143 
ªsu…
->
skew_unôs
) {

144 
DM_SU_REVOLUTIONS
:

145 
ªsu…
->
hsskew
 = 
	`dm_™gÀ_dtoi
(
d
);

147 
DM_SU_SECTORS
:

149 
ªsu…
->
hsskew
 = (Ë
d
 *ªsu…->
£˘‹_width
;

154 
	}
}

157 
	$DM_LAYOUT_G2_ZONE_SKEW_FOR_CYLINDER_SWITCH_dïíd
(*
bv
)

159 i‡(!
	`BIT_TEST
(
bv
, 
DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK
)) {

160  
DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK
;

163 
	}
}

166 
	$DM_LAYOUT_G2_ZONE_SKEW_FOR_CYLINDER_SWITCH_lﬂdî
(
dm_œyout_g2_z⁄e
 * 
ªsu…
, 
d
)

169 
ªsu…
->
skew_unôs
) {

170 
DM_SU_REVOLUTIONS
:

171 
ªsu…
->
csskew
 = 
	`dm_™gÀ_dtoi
(
d
);

173 
DM_SU_SECTORS
:

175 
ªsu…
->
csskew
 = (Ë
d
 *ªsu…->
£˘‹_width
;

180 
	}
}

182 *
	gDM_LAYOUT_G2_ZONE_lﬂdîs
[] = {

183 (*Ë
DM_LAYOUT_G2_ZONE_FIRST_CYLINDER_NUMBER_lﬂdî
,

184 (*Ë
DM_LAYOUT_G2_ZONE_LAST_CYLINDER_NUMBER_lﬂdî
,

185 (*Ë
DM_LAYOUT_G2_ZONE_FIRST_LBN_lﬂdî
,

186 (*Ë
DM_LAYOUT_G2_ZONE_LAST_LBN_lﬂdî
,

187 (*Ë
DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK_lﬂdî
,

188 (*Ë
DM_LAYOUT_G2_ZONE_ZONE_SKEW_lﬂdî
,

189 (*Ë
DM_LAYOUT_G2_ZONE_SKEW_UNITS_lﬂdî
,

190 (*Ë
DM_LAYOUT_G2_ZONE_SKEW_FOR_TRACK_SWITCH_lﬂdî
,

191 (*Ë
DM_LAYOUT_G2_ZONE_SKEW_FOR_CYLINDER_SWITCH_lﬂdî


194 
Õ_∑ømdï_t
 
	gDM_LAYOUT_G2_ZONE_dïs
[] = {

195 
DM_LAYOUT_G2_ZONE_FIRST_CYLINDER_NUMBER_dïíd
,

196 
DM_LAYOUT_G2_ZONE_LAST_CYLINDER_NUMBER_dïíd
,

197 
DM_LAYOUT_G2_ZONE_FIRST_LBN_dïíd
,

198 
DM_LAYOUT_G2_ZONE_LAST_LBN_dïíd
,

199 
DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK_dïíd
,

200 
DM_LAYOUT_G2_ZONE_ZONE_SKEW_dïíd
,

201 
DM_LAYOUT_G2_ZONE_SKEW_UNITS_dïíd
,

202 
DM_LAYOUT_G2_ZONE_SKEW_FOR_TRACK_SWITCH_dïíd
,

203 
DM_LAYOUT_G2_ZONE_SKEW_FOR_CYLINDER_SWITCH_dïíd


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g2_zone_param.h

2 #i‚de‡
_DM_LAYOUT_G2_ZONE_PARAM_H


3 
	#_DM_LAYOUT_G2_ZONE_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_œyout_g2_z⁄e_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DM_LAYOUT_G2_ZONE_FIRST_CYLINDER_NUMBER
,

16 
DM_LAYOUT_G2_ZONE_LAST_CYLINDER_NUMBER
,

17 
DM_LAYOUT_G2_ZONE_FIRST_LBN
,

18 
DM_LAYOUT_G2_ZONE_LAST_LBN
,

19 
DM_LAYOUT_G2_ZONE_BLOCKS_PER_TRACK
,

20 
DM_LAYOUT_G2_ZONE_ZONE_SKEW
,

21 
DM_LAYOUT_G2_ZONE_SKEW_UNITS
,

22 
DM_LAYOUT_G2_ZONE_SKEW_FOR_TRACK_SWITCH
,

23 
DM_LAYOUT_G2_ZONE_SKEW_FOR_CYLINDER_SWITCH


24 } 
	tdm_œyout_g2_z⁄e_∑øm_t
;

26 
	#DM_LAYOUT_G2_ZONE_MAX_PARAM
 
DM_LAYOUT_G2_ZONE_SKEW_FOR_CYLINDER_SWITCH


	)

27 * 
DM_LAYOUT_G2_ZONE_lﬂdîs
[];

28 
Õ_∑ømdï_t
 
DM_LAYOUT_G2_ZONE_dïs
[];

31 
Õ_v¨•ec
 
	gdm_œyout_g2_z⁄e_∑øms
 [] = {

32 {"Fú° cylödîÇumbî", 
I
, 1 },

33 {"La° cylödîÇumbî", 
I
, 1 },

34 {"Fú° LBN", 
I
, 1 },

35 {"La° LBN", 
I
, 1 },

36 {"Block†≥∏åack", 
I
, 1 },

37 {"Z⁄êSkew", 
D
, 0 },

38 {"Skew unôs", 
S
, 0 },

39 {"Skew f‹Åøck swôch", 
D
, 0 },

40 {"Skew f‹ cylödî swôch", 
D
, 0 },

43 
	#DM_LAYOUT_G2_ZONE_MAX
 9

	)

44 
Õ_mod
 
	gdm_œyout_g2_z⁄e_mod
 = { "dm_œyout_g2_z⁄e", 
dm_œyout_g2_z⁄e_∑øms
, 
DM_LAYOUT_G2_ZONE_MAX
, (
Õ_modlﬂdî_t
)
dm_œyout_g2_z⁄e_lﬂd∑øms
, 0, 0, 
DM_LAYOUT_G2_ZONE_lﬂdîs
, 
DM_LAYOUT_G2_ZONE_dïs
 };

47 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g4_param.c

1 
	~"dm_œyout_g4_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../œyout_g4.h
"

5 
	$DM_LAYOUT_G4_TP_dïíd
(*
bv
)

8 
	}
}

11 
	$DM_LAYOUT_G4_TP_lﬂdî
(
dm_œyout_g4
 * 
ªsu…
, 
Õ_li°
 * 
l
)

13 
	`g4_lﬂd_ç
(
ªsu…
, 
l
);

15 
	}
}

18 
	$DM_LAYOUT_G4_IDX_dïíd
(*
bv
)

20 i‡(!
	`BIT_TEST
(
bv
, 
DM_LAYOUT_G4_TP
)) {

21  
DM_LAYOUT_G4_TP
;

24 
	}
}

27 
	$DM_LAYOUT_G4_IDX_lﬂdî
(
dm_œyout_g4
 * 
ªsu…
, 
Õ_li°
 * 
l
)

29 
	`g4_lﬂd_idx
(
ªsu…
, 
l
);

31 
	}
}

34 
	$DM_LAYOUT_G4_SLIPS_dïíd
(*
bv
)

37 
	}
}

40 
	$DM_LAYOUT_G4_SLIPS_lﬂdî
(
dm_œyout_g4
 * 
ªsu…
, 
Õ_li°
 * 
l
)

42 
	`g4_lﬂd_¶ùs
(
ªsu…
, 
l
);

44 
	}
}

47 
	$DM_LAYOUT_G4_REMAPS_dïíd
(*
bv
)

50 
	}
}

53 
	$DM_LAYOUT_G4_REMAPS_lﬂdî
(
dm_œyout_g4
 * 
ªsu…
, 
Õ_li°
 * 
l
)

55 
	`g4_lﬂd_ªm≠s
(
ªsu…
, 
l
);

57 
	}
}

59 *
	gDM_LAYOUT_G4_lﬂdîs
[] = {

60 (*Ë
DM_LAYOUT_G4_TP_lﬂdî
,

61 (*Ë
DM_LAYOUT_G4_IDX_lﬂdî
,

62 (*Ë
DM_LAYOUT_G4_SLIPS_lﬂdî
,

63 (*Ë
DM_LAYOUT_G4_REMAPS_lﬂdî


66 
Õ_∑ømdï_t
 
	gDM_LAYOUT_G4_dïs
[] = {

67 
DM_LAYOUT_G4_TP_dïíd
,

68 
DM_LAYOUT_G4_IDX_dïíd
,

69 
DM_LAYOUT_G4_SLIPS_dïíd
,

70 
DM_LAYOUT_G4_REMAPS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g4_param.h

2 #i‚de‡
_DM_LAYOUT_G4_PARAM_H


3 
	#_DM_LAYOUT_G4_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_œyout_if
 *
dm_œyout_g4_lﬂd∑øms
(
Õ_block
 *, 
dm_disk_if
 *);

15 
DM_LAYOUT_G4_TP
,

16 
DM_LAYOUT_G4_IDX
,

17 
DM_LAYOUT_G4_SLIPS
,

18 
DM_LAYOUT_G4_REMAPS


19 } 
	tdm_œyout_g4_∑øm_t
;

21 
	#DM_LAYOUT_G4_MAX_PARAM
 
DM_LAYOUT_G4_REMAPS


	)

22 * 
DM_LAYOUT_G4_lﬂdîs
[];

23 
Õ_∑ømdï_t
 
DM_LAYOUT_G4_dïs
[];

26 
Õ_v¨•ec
 
	gdm_œyout_g4_∑øms
 [] = {

27 {"TP", 
LIST
, 1 },

28 {"IDX", 
LIST
, 1 },

29 {"Slùs", 
LIST
, 1 },

30 {"Rem≠s", 
LIST
, 1 },

33 
	#DM_LAYOUT_G4_MAX
 4

	)

34 
Õ_mod
 
	gdm_œyout_g4_mod
 = { "dm_œyout_g4", 
dm_œyout_g4_∑øms
, 
DM_LAYOUT_G4_MAX
, (
Õ_modlﬂdî_t
)
dm_œyout_g4_lﬂd∑øms
, 0, 0, 
DM_LAYOUT_G4_lﬂdîs
, 
DM_LAYOUT_G4_dïs
 };

37 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_mech_g1_param.c

1 
	~"dm_mech_g1_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../mech_g1.h
"

4 
	~"../mech_g1_¥iv©e.h
"

6 
	$DM_MECH_G1_ACCESS_TIME_TYPE_dïíd
(*
bv
)

9 
	}
}

12 
	$DM_MECH_G1_ACCESS_TIME_TYPE_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, *
s
)

14 i‡(!
	`°rcmp
(
s
, "constant")) {

15 } i‡(!
	`°rcmp
(
s
, "averageRotation")) {

16 
ªsu…
->
ac˘ime
 = 
AVGROTATE
;

17 } i‡(!
	`°rcmp
(
s
, "trackSwitchPlusRotation")) {

18 
ªsu…
->
ac˘ime
 = 
SKEWED_FOR_TRACK_SWITCH
;

20 
	`Ârötf
(
°dîr
, "***Éº‹: Unknow¿ac˚s†timêty≥: %s\n", 
s
);

21 
	`ddbg_as£π
(0);

24 
	}
}

27 
	$DM_MECH_G1_CONSTANT_ACCESS_TIME_dïíd
(*
bv
)

30 
	}
}

33 
	$DM_MECH_G1_CONSTANT_ACCESS_TIME_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
d
)

35 i‡(!(
d
 >= 0.0)) {

38 
ªsu…
->
ac˘ime
 = 
d
;

40 
	}
}

43 
	$DM_MECH_G1_SEEK_TYPE_dïíd
(*
bv
)

46 
	}
}

49 
	$DM_MECH_G1_SEEK_TYPE_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, *
s
)

51 i‡(!
	`°rcmp
(
s
, "constant")) {

52 
ªsu…
->
£ektime
 = 
SEEK_CONST
;

53 } i‡(!
	`°rcmp
(
s
, "linear")) {

54 
ªsu…
->
£ektime
 = 
SEEK_3PT_LINE
;

55 } i‡(!
	`°rcmp
(
s
, "curve")) {

56 
ªsu…
->
£ektime
 = 
SEEK_3PT_CURVE
;

57 } i‡(!
	`°rcmp
(
s
, "hpl")) {

58 
ªsu…
->
£ektime
 = 
SEEK_HPL
;

59 } i‡(!
	`°rcmp
(
s
, "hplplus10")) {

60 
ªsu…
->
£ektime
 = 
SEEK_1ST10_PLUS_HPL
;

61 } i‡(!
	`°rcmp
(
s
, "extracted")) {

62 
ªsu…
->
£ektime
 = 
SEEK_EXTRACTED
;

64 
	`Ârötf
(
°dîr
, "***Éº‹: Unknow¿£ekÅy≥: %s\n", 
s
);

65 
	`ddbg_as£π
(0);

67 
ªsu…
->
£ek‚
 = 
dm_mech_g1_£ek‚s
[ªsu…->
£ektime
];

69 
	}
}

72 
	$DM_MECH_G1_AVERAGE_SEEK_TIME_dïíd
(*
bv
)

75 
	}
}

78 
	$DM_MECH_G1_AVERAGE_SEEK_TIME_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
d
)

80 i‡(!(
d
 >= 0.0)) {

83 
ªsu…
->
£ekavg
 = 
d
;

85 
	}
}

88 
	$DM_MECH_G1_CONSTANT_SEEK_TIME_dïíd
(*
bv
)

91 
	}
}

94 
	$DM_MECH_G1_CONSTANT_SEEK_TIME_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
d
)

96 i‡(!(
d
 >= 0.0)) {

99 
ªsu…
->
£ektime
 = 
d
;

101 
	}
}

104 
	$DM_MECH_G1_SINGLE_CYLINDER_SEEK_TIME_dïíd
(*
bv
)

107 
	}
}

110 
	$DM_MECH_G1_SINGLE_CYLINDER_SEEK_TIME_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
d
)

112 i‡(!(
d
 >= 0.0)) {

115 
ªsu…
->
£ek⁄e
 = 
d
;

117 
	}
}

120 
	$DM_MECH_G1_FULL_STROBE_SEEK_TIME_dïíd
(*
bv
)

123 
	}
}

126 
	$DM_MECH_G1_FULL_STROBE_SEEK_TIME_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
d
)

128 i‡(!(
d
 >= 0.0)) {

131 
ªsu…
->
£ekfuŒ
 = 
d
;

133 
	}
}

136 
	$DM_MECH_G1_FULL_SEEK_CURVE_dïíd
(*
bv
)

138 i‡(!
	`BIT_TEST
(
bv
, 
DM_MECH_G1_SEEK_TYPE
)) {

139  
DM_MECH_G1_SEEK_TYPE
;

142 
	}
}

145 
	$DM_MECH_G1_FULL_SEEK_CURVE_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, *
s
)

147 
ªsu…
->
£ektime
 = 
SEEK_EXTRACTED
;

148 
	`dm_mech_g1_ªad_exåa˘ed_£ek_curve
(
s
,

149 &
ªsu…
->
x£ek˙t
,

150 &
ªsu…
->
x£ekdi°s
,

151 &
ªsu…
->
x£ektimes
);

154 
	}
}

157 
	$DM_MECH_G1_ADD_WRITE_SETTLING_DELAY_dïíd
(*
bv
)

160 
	}
}

163 
	$DM_MECH_G1_ADD_WRITE_SETTLING_DELAY_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
d
)

165 
ªsu…
->
£ekwrôedñè
 = 
	`dm_time_dtoi
(
d
);

167 
	}
}

170 
	$DM_MECH_G1_HEAD_SWITCH_TIME_dïíd
(*
bv
)

173 
	}
}

176 
	$DM_MECH_G1_HEAD_SWITCH_TIME_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
d
)

178 i‡(!(
d
 >= 0.0)) {

181 
ªsu…
->
hódswôch
 = 
	`dm_time_dtoi
(
d
);

183 
	}
}

186 
	$DM_MECH_G1_ROTATION_SPEED__dïíd
(*
bv
)

189 
	}
}

192 
	$DM_MECH_G1_ROTATION_SPEED__lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
i
)

194 i‡(!(
i
 > 0)) {

197 
ªsu…
->
Ωm
 = 
i
;

199 
	}
}

202 
	$DM_MECH_G1_PERCENT_ERROR_IN_RPMS_dïíd
(*
bv
)

205 
	}
}

208 
	$DM_MECH_G1_PERCENT_ERROR_IN_RPMS_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
d
)

210 i‡(!(
	`RANGE
(
d
, 0.0, 100.0))) {

213 
ªsu…
->
Ωmîr
 = 
d
;

215 
	}
}

218 
	$DM_MECH_G1_FIRST_TEN_SEEK_TIMES_dïíd
(*
bv
)

220 i‡(!
	`BIT_TEST
(
bv
, 
DM_MECH_G1_SEEK_TYPE
)) {

221  
DM_MECH_G1_SEEK_TYPE
;

224 
	}
}

227 
	$DM_MECH_G1_FIRST_TEN_SEEK_TIMES_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
Õ_li°
 * 
l
)

229 i‡(!(!
	`do_1°10_£eks
(
ªsu…
, 
l
))) {

232 
	}
}

235 
	$DM_MECH_G1_HPL_SEEK_EQUATION_VALUES_dïíd
(*
bv
)

237 i‡(!
	`BIT_TEST
(
bv
, 
DM_MECH_G1_SEEK_TYPE
)) {

238  
DM_MECH_G1_SEEK_TYPE
;

241 
	}
}

244 
	$DM_MECH_G1_HPL_SEEK_EQUATION_VALUES_lﬂdî
(
dm_mech_g1
 * 
ªsu…
, 
Õ_li°
 * 
l
)

246 i‡(!(!
	`do_h∂_£ek
(
ªsu…
, 
l
))) {

249 
	}
}

251 *
	gDM_MECH_G1_lﬂdîs
[] = {

252 (*Ë
DM_MECH_G1_ACCESS_TIME_TYPE_lﬂdî
,

253 (*Ë
DM_MECH_G1_CONSTANT_ACCESS_TIME_lﬂdî
,

254 (*Ë
DM_MECH_G1_SEEK_TYPE_lﬂdî
,

255 (*Ë
DM_MECH_G1_AVERAGE_SEEK_TIME_lﬂdî
,

256 (*Ë
DM_MECH_G1_CONSTANT_SEEK_TIME_lﬂdî
,

257 (*Ë
DM_MECH_G1_SINGLE_CYLINDER_SEEK_TIME_lﬂdî
,

258 (*Ë
DM_MECH_G1_FULL_STROBE_SEEK_TIME_lﬂdî
,

259 (*Ë
DM_MECH_G1_FULL_SEEK_CURVE_lﬂdî
,

260 (*Ë
DM_MECH_G1_ADD_WRITE_SETTLING_DELAY_lﬂdî
,

261 (*Ë
DM_MECH_G1_HEAD_SWITCH_TIME_lﬂdî
,

262 (*Ë
DM_MECH_G1_ROTATION_SPEED__lﬂdî
,

263 (*Ë
DM_MECH_G1_PERCENT_ERROR_IN_RPMS_lﬂdî
,

264 (*Ë
DM_MECH_G1_FIRST_TEN_SEEK_TIMES_lﬂdî
,

265 (*Ë
DM_MECH_G1_HPL_SEEK_EQUATION_VALUES_lﬂdî


268 
Õ_∑ømdï_t
 
	gDM_MECH_G1_dïs
[] = {

269 
DM_MECH_G1_ACCESS_TIME_TYPE_dïíd
,

270 
DM_MECH_G1_CONSTANT_ACCESS_TIME_dïíd
,

271 
DM_MECH_G1_SEEK_TYPE_dïíd
,

272 
DM_MECH_G1_AVERAGE_SEEK_TIME_dïíd
,

273 
DM_MECH_G1_CONSTANT_SEEK_TIME_dïíd
,

274 
DM_MECH_G1_SINGLE_CYLINDER_SEEK_TIME_dïíd
,

275 
DM_MECH_G1_FULL_STROBE_SEEK_TIME_dïíd
,

276 
DM_MECH_G1_FULL_SEEK_CURVE_dïíd
,

277 
DM_MECH_G1_ADD_WRITE_SETTLING_DELAY_dïíd
,

278 
DM_MECH_G1_HEAD_SWITCH_TIME_dïíd
,

279 
DM_MECH_G1_ROTATION_SPEED__dïíd
,

280 
DM_MECH_G1_PERCENT_ERROR_IN_RPMS_dïíd
,

281 
DM_MECH_G1_FIRST_TEN_SEEK_TIMES_dïíd
,

282 
DM_MECH_G1_HPL_SEEK_EQUATION_VALUES_dïíd


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_mech_g1_param.h

2 #i‚de‡
_DM_MECH_G1_PARAM_H


3 
	#_DM_MECH_G1_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
dm_mech_if
 *
dm_mech_g1_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
DM_MECH_G1_ACCESS_TIME_TYPE
,

16 
DM_MECH_G1_CONSTANT_ACCESS_TIME
,

17 
DM_MECH_G1_SEEK_TYPE
,

18 
DM_MECH_G1_AVERAGE_SEEK_TIME
,

19 
DM_MECH_G1_CONSTANT_SEEK_TIME
,

20 
DM_MECH_G1_SINGLE_CYLINDER_SEEK_TIME
,

21 
DM_MECH_G1_FULL_STROBE_SEEK_TIME
,

22 
DM_MECH_G1_FULL_SEEK_CURVE
,

23 
DM_MECH_G1_ADD_WRITE_SETTLING_DELAY
,

24 
DM_MECH_G1_HEAD_SWITCH_TIME
,

25 
DM_MECH_G1_ROTATION_SPEED_
,

26 
DM_MECH_G1_PERCENT_ERROR_IN_RPMS
,

27 
DM_MECH_G1_FIRST_TEN_SEEK_TIMES
,

28 
DM_MECH_G1_HPL_SEEK_EQUATION_VALUES


29 } 
	tdm_mech_g1_∑øm_t
;

31 
	#DM_MECH_G1_MAX_PARAM
 
DM_MECH_G1_HPL_SEEK_EQUATION_VALUES


	)

32 * 
DM_MECH_G1_lﬂdîs
[];

33 
Õ_∑ømdï_t
 
DM_MECH_G1_dïs
[];

36 
Õ_v¨•ec
 
	gdm_mech_g1_∑øms
 [] = {

37 {"Ac˚s†timêty≥", 
S
, 1 },

38 {"C⁄°™àac˚s†time", 
D
, 0 },

39 {"SìkÅy≥", 
S
, 1 },

40 {"Avîagê£ekÅime", 
D
, 0 },

41 {"C⁄°™à£ekÅime", 
D
, 0 },

42 {"SögÀ cylödî sìkÅime", 
D
, 0 },

43 {"FuŒ såobê£ekÅime", 
D
, 0 },

44 {"FuŒ sìk curve", 
S
, 0 },

45 {"Add. wrôê£âlög dñay", 
D
, 1 },

46 {"Hód swôchÅime", 
D
, 1 },

47 {"RŸ©i⁄ s≥ed (öÑpms)", 
I
, 1 },

48 {"Pî˚¡Éº‹ i¿Ωms", 
D
, 1 },

49 {"Fú°Åí sìkÅimes", 
LIST
, 0 },

50 {"HPL sìkÉqu©i⁄ vÆues", 
LIST
, 0 },

53 
	#DM_MECH_G1_MAX
 14

	)

54 
Õ_mod
 
	gdm_mech_g1_mod
 = { "dm_mech_g1", 
dm_mech_g1_∑øms
, 
DM_MECH_G1_MAX
, (
Õ_modlﬂdî_t
)
dm_mech_g1_lﬂd∑øms
, 0, 0, 
DM_MECH_G1_lﬂdîs
, 
DM_MECH_G1_dïs
 };

57 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/modules.h

2 #i‚de‡
_DM_MODULES_H


3 
	#_DM_MODULES_H


	)

6 
	~"dm_disk_∑øm.h
"

7 
	~"dm_œyout_g1_∑øm.h
"

8 
	~"dm_œyout_g1_z⁄e_∑øm.h
"

9 
	~"dm_œyout_g2_∑øm.h
"

10 
	~"dm_œyout_g2_z⁄e_∑øm.h
"

11 
	~"dm_œyout_g4_∑øm.h
"

12 
	~"dm_mech_g1_∑øm.h
"

15 
Õ_mod
 *
	gdm_mods
[] = {

16 &
dm_disk_mod
 ,

17 &
dm_œyout_g1_mod
 ,

18 &
dm_œyout_g1_z⁄e_mod
 ,

19 &
dm_œyout_g2_mod
 ,

20 &
dm_œyout_g2_z⁄e_mod
 ,

21 &
dm_œyout_g4_mod
 ,

22 &
dm_mech_g1_mod


26 
	mDM_MOD_DISK
,

27 
	mDM_MOD_LAYOUT_G1
,

28 
	mDM_MOD_LAYOUT_G1_ZONE
,

29 
	mDM_MOD_LAYOUT_G2
,

30 
	mDM_MOD_LAYOUT_G2_ZONE
,

31 
	mDM_MOD_LAYOUT_G4
,

32 
	mDM_MOD_MECH_G1


33 } 
	tdm_mod_t
;

35 
	#DM_MAX_MODULE
 6

	)

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/pbn.c

33 
	~"dm.h
"

38 
	$dm_to_pbn
(
dm_pbn_t
 
i
, 
dm_pbn
 *
ªsu…
)

40 
ªsu…
->
£˘‹
 = 0xfffffff‡& 
i
;

41 
ªsu…
->
hód
 = (
i
 >> 32) & 0xff;

42 
ªsu…
->
cyl
 = (
i
 >> 40) & 0xffffff;

44 
	}
}

47 
	$dm_‰om_pbn
(
dm_pbn
 *
p
, 
dm_pbn_t
 *
ªsu…
)

49 *
ªsu…
 = 
p
->
£˘‹
;

50 *
ªsu…
 |((
dm_pbn_t
)(
p
->
hód
 & 0xff) << 32);

51 *
ªsu…
 |((
dm_pbn_t
)(
p
->
cyl
 & 0xffffff) << 40);

53 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/sqrt.c

32 
	~"dm_c⁄fig.h
"

37 
uöt32_t
 
	$sqπ32
(
uöt32_t
 
x
) {

38 
c
;

39 
uöt32_t
 
ﬁd
 = 0, 
ªsu…
 = 32767;

41 if(
x
 == 0)  0;

42 if(
x
 == 1)  1;

44 
c
 = 0; c <= 16; c++) {

45 
uöt32_t
 
xsq
 = 
ªsu…
 *Ñesult;

46 if((
xsq
 <
x
 )

47 && (((
ªsu…
 + 1Ë* (ªsu… + 1)Ë> 
x
))

49  
ªsu…
;

52 
ﬁd
 = 
ªsu…
;

53 if(
xsq
 > 
x
) {

54 
ªsu…
 -(1 << (15 - 
c
));

57 
ªsu…
 +‘esu… =65535 ? 0 : (1 << (15 - 
c
)));

62  
ªsu…
;

63 
	}
}

65 
uöt64_t
 
	$sqπ64
(
uöt64_t
 
x
) {

66 
c
;

67 
uöt64_t
 
ﬁd
 = 0, 
ªsu…
 = 2147483647;

69 if(
x
 == 0)  0;

70 if(
x
 == 1)  1;

72 
c
 = 0; c <= 32; c++) {

73 
uöt64_t
 
xsq
 = 
ªsu…
 *Ñesult;

74 if((
xsq
 <
x
 )

75 && (((
ªsu…
 + 1Ë* (ªsu… + 1)Ë> 
x
))

77  
ªsu…
;

80 
ﬁd
 = 
ªsu…
;

81 if(
xsq
 > 
x
) {

82 
ªsu…
 -((
uöt64_t
)1 << (31 - 
c
));

85 
ªsu…
 +‘esu… =2147483647 ? 0 : ((
uöt64_t
)1 << (31 - 
c
)));

89  
ªsu…
;

90 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/driver.c

30 
	~<diskmodñ/dm.h
>

31 
	~<diskmodñ/moduÀs/moduÀs.h
>

33 
	~<lib∑øm/lib∑øm.h
>

34 
	~<libddbg/libddbg.h
>

36 
	~<°dio.h
>

37 
	~<°dlib.h
>

39 
	~<sys/time.h
>

40 
	~<time.h
>

43 
doTe°s
(
dm_disk_if
 *, , **);

44 
ã°sUßge
();

45 
mö¨gs
;

48 
	stimögbuckë
 {

49 
	mtŸ
;

50 
	mn
;

51 
	m°¨t
;

52 *
	m«me
;

55 
	#MAXBUCKETS
 10

	)

56 
timögbuckë
 
	gbuckës
[
MAXBUCKETS
];

57 
	gbuckës_Àn
 = 0;

59 
	$addBuckë
(*
«me
) {

60 
timögbuckë
 *
b
;

61 
	`ddbg_as£π
(
buckës_Àn
+1 < 
MAXBUCKETS
);

62 
b
 = &
buckës
[
buckës_Àn
];

63 
b
->
«me
 =Çame;

64 
b
->
tŸ
 = 0.0;

65 
b
->
n
 = 0;

67 
buckës_Àn
++;

68 
	}
}

70 
	$tv2d
(
timevÆ
 *
tv
) {

71 
ªsu…
 = 
tv
->
tv_u£c
;

72 
ªsu…
 +
tv
->
tv_£c
 * 1000000;

73  
ªsu…
;

74 
	}
}

76 
	$now
() {

77 
timevÆ
 
tv
;

78 
	`gëtimeofday
(&
tv
, 0);

79  
	`tv2d
(&
tv
);

80 
	}
}

83 
	$°¨tClock
(
b
) {

84 
buckës
[
b
].
°¨t
 = 
	`now
();

85 
	}
}

87 
	$°›Clock
(
b
) {

88 
buckës
[
b
].
tŸ
 +
	`now
(Ë- buckës[b].
°¨t
;

89 
buckës
[
b
].
n
++;

90 
	}
}

92 
	$¥ötTimes
() {

93 
i
;

94 
i
 = 0; i < 
buckës_Àn
; i++) {

95 
timögbuckë
 *
b
 = &
buckës
[
i
];

96 
	`¥ötf
("%s:Ç %d mó¿%f\n", 
b
->
«me
, b->
n
, b->
tŸ
 / b->n);

98 
	}
}

100 
	$maö
(
¨gc
, **
¨gv
)

102 
c
;

103 
bad˘
;

104 
FILE
 *
modñfûe
;

105 
dm_disk_if
 *
disk
;

106 *
modñ«me
;

108 
	`ddbg_as£π_£tfûe
(
°dîr
);

110 if(
¨gc
 < (
mö¨gs
+2)) {

111 
	`ã°sUßge
();

112 
	`exô
(1);

115 
modñfûe
 = 
	`f›í
(
¨gv
[1], "r");

116 if(!
modñfûe
) {

117 
	`Ârötf
(
°dîr
, "***Éº‹: faûedÅÿ›í \"%s\"\n", 
¨gv
[1]);

120 
c
 = 0; c <
DM_MAX_MODULE
; c++) {

121 
Õ_mod
 *
mod
;

123 if(
c
 =
DM_MOD_DISK
) {

124 
mod
 = 
dm_mods
[
c
];

127 
mod
 = 
dm_mods
[
c
];

130 
	`Õ_ªgi°î_moduÀ
(
mod
);

133 
	`Õ_öô_ty≥tbl
();

134 
	`Õ_lﬂdfûe
(
modñfûe
, 0, 0, 
¨gv
[1], 0, 0);

135 
	`f˛o£
(
modñfûe
);

137 
modñ«me
 = 
¨gc
 >3 ? 
¨gv
[2] : 0;

139 
disk
 = (
dm_disk_if
 *)
	`Õ_ö°™tüã
("foo", 
modñ«me
);

142 
	`¥ötf
("*** %†°¨tög\n", 
¨gv
[0]);

144 
bad˘
 = 
	`doTe°s
(
disk
, 
¨gc
, 
¨gv
);

146 
	`¥ötf
("*** %†föished: %d bad\n", 
¨gv
[0], 
bad˘
);

149 
	`¥ötTimes
();

151 
	`exô
(0);

154 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_bogon.c

31 
	~"ã°.h
"

33 
	$ã°sUßge
() {

34 
	`Ârötf
(
°dîr
, "usage:Üayout_bogon <model>\n");

35 
	}
}

42 
	$œyout_bog⁄
(
dm_disk_if
 *
d
) {

43 
lbn
 = 0;

44 
i
, 
rv
;

45 
dm_pbn
 
p
, 
p2
;

46 
l0
, 
 
;

47 
bad
 = 0;

50 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
lbn
, 
MAP_FULL
, &
p
, 0);

51 
d
->
œyout
->
	`dm_gë_åack_bound¨õs
(d, &
p
, &
l0
, &
 
, 0);

52 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
 
, 
MAP_FULL
, &
p
, 0);

53 
p2
 = 
p
;

54 
i
 = 0; i < 1; i++) {

55 
p2
.
£˘‹
++;

56 
rv
 = 
d
->
œyout
->
	`dm_å™¶©e_±ﬁ
(d, &
p2
, 0);

57 if(
rv
 >= 0) {

58 
	`¥ötf
("(%d,%d,%d) -> %d !!! max (%d,%d,%d)\n",

59 
p2
.
cyl
,Ö2.
hód
,Ö2.
£˘‹
, 
rv
,

60 
p
.
cyl
,Ö.
hód
,Ö.
£˘‹
);

61 
bad
++;

65 
lbn
 = 
 
 + 1;

66 } 
lbn
 < 
d
->
dm_£˘‹s
);

68  
bad
;

69 
	}
}

71 
	gmö¨gs
 = 0;

73 
	$doTe°s
(
dm_disk_if
 *
d
, 
¨gc
, **
¨gv
)

75  
	`œyout_bog⁄
(
d
);

76 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_raw.c

31 
	~"ã°.h
"

36 
	gmö¨gs
 = 1;

38 
	$ã°sUßge
() {

39 
	`Ârötf
(
°dîr
, "usage:Üayout_raw <model> <rawÜayout file>\n");

40 
	}
}

43 
	$gë_√xt_löe
(
FILE
 *
Â
,

44 *
lbn
,

45 
dm_pbn
 *
p
,

46 *
cou¡
)

48 
sˇn˘
;

49 
˙t°r
[32];

50 if((
sˇn˘
 = 
	`fsˇnf
(
Â
, "lbn %d --> cyl %d, head %d, sect %d, %s %d\n",

51 
lbn
, &
p
->
cyl
, &p->
hód
, &p->
£˘‹
, 
˙t°r
, 
cou¡
) == 6))

53 if(!
	`°rcmp
(
˙t°r
, "seqcnt")) {

54 (*
cou¡
)++;

60 
	`¥ötf
("wr⁄g %d\n", 
sˇn˘
);

63 
	}
}

66 
	$øw_œyout_ã°
(
dm_disk_if
 *
d
,

67 
FILE
 *
Â
)

69 
i
;

70 
lbn
;

71 
junk
[1024];

72 
dm_pbn
 
p
;

73 
cou¡
;

75 
dm_pbn
 
p2
;

76 
îr‹s
 = 0;

79 
	`fgës
(
junk
, (junk), 
Â
);

80 
	`fgës
(
junk
, (junk), 
Â
);

81 
	`fgës
(
junk
, (junk), 
Â
);

85 
	`gë_√xt_löe
(
Â
, &
lbn
, &
p
, &
cou¡
))

87 
i
 = 0; i < 
cou¡
; i++) {

88 
dm_±ﬁ_ªsu…_t
 
rc
 =

89 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
lbn
+
i
, 
MAP_FULL
, &
p2
, 0);

91 if((
p
.
cyl
 !
p2
.cyl)

92 || (
p
.
hód
 !
p2
.head)

93 || ((
p
.
£˘‹
 + 
i
Ë!
p2
.sector))

95 
	`¥ötf
("***Üayout_raw: %d -> (%d,%d,%d) <> (%d,%d,%d)\n",

96 
lbn
+
i
,

97 
p
.
cyl
,Ö.
hód
,Ö.
£˘‹
+
i
,

98 
p2
.
cyl
,Ö2.
hód
,Ö2.
£˘‹
);

100 
	`fÊush
(
°dout
);

101 
îr‹s
++;

106  
îr‹s
;

107 
	}
}

116 
	$doTe°s
(
dm_disk_if
 *
d
,

117 
¨gc
,

118 **
¨gv
)

120 
cou¡
 = 0;

121 
FILE
 *
Â
 = 
	`f›í
(
¨gv
[3], "r");

122 
	`ddbg_as£π
(
Â
 != 0);

124 
cou¡
 = 
	`øw_œyout_ã°
(
d
, 
Â
);

126 
	`f˛o£
(
Â
);

127  
cou¡
;

128 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_simple.c

31 
	~"ã°.h
"

34 
	$ã°sUßge
() {

35 
	`Ârötf
(
°dîr
, "usage:Üayout_simple <model>\n");

36 
	}
}

41 
	$œyout_ã°_sim∂e
(
dm_disk_if
 *
d
) {

42 
i
, 
lbn
, 
cou¡
 = 0, 
ru∆bn
 = 0;

43 
dm_pbn
 
pbn
, 
åkpbn
 = {0,0,0};

44 
bad
 = 0;

46 
i
 = 0; i < 
d
->
dm_£˘‹s
; i++) {

47 
lbn2
;

48 
dm_™gÀ_t
 
skew
, 
zîﬁ
;

49 
dm_mech_°©e
 
åack
;

50 
dm_±ﬁ_ªsu…_t
 
rc
;

52 
	`°¨tClock
(0);

53 
rc
 = 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
i
, 
MAP_FULL
, &
pbn
, 0);

54 
	`°›Clock
(0);

55 if(
rc
 =
DM_NX
) {

56 
	`¥ötf
("*** %†%d -> NX\n", 
__func__
, 
i
);

57 
bad
++;

61 
	`°¨tClock
(1);

62 
lbn2
 = 
d
->
œyout
->
	`dm_å™¶©e_±ﬁ
(d, &
pbn
, 0);

63 
	`°›Clock
(1);

64 if(
lbn2
 =
DM_NX
) {

65 
	`¥ötf
("***Üayout_test_simple %d -> (%d,%d,%d) -> NX\n",

66 
i
, 
pbn
.
cyl
,Öbn.
hód
,Öbn.
£˘‹
);

67 
bad
++;

71 if(
i
 !
lbn2
) {

72 
	`¥ötf
("***Üayout_test_simple: %8d -> (%8d, %3d, %4d) -> %8d\n",

73 
i
, 
pbn
.
cyl
,Öbn.
hód
,Öbn.
£˘‹
, 
lbn2
);

74 
bad
++;

79 if((
lbn2
 > 0)

80 && (
åkpbn
.
hód
 =
pbn
.head)

81 && (
åkpbn
.
cyl
 =
pbn
.cyl)

82 && ((
åkpbn
.
£˘‹
+
cou¡
Ë=
pbn
.sector)) { count++; }

85 
ru∆bn
 = 
i
;

86 
åkpbn
 = 
pbn
;

87 
cou¡
 = 1;

91 
	`fÊush
(
°dout
);

95  
bad
;

96 
	}
}

98 
	gmö¨gs
 = 0;

100 
	$doTe°s
(
dm_disk_if
 *
d
, 
¨gc
, **
¨gv
)

102 
	`addBuckë
("ltop()");

103 
	`addBuckë
("ptol()");

106  
	`œyout_ã°_sim∂e
(
d
);

107 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_simple_0t.c

31 
	~"ã°.h
"

33 
	$ã°sUßge
() {

34 
	`Ârötf
(
°dîr
, "usage:Üayout_simple_0t <model>\n");

35 
	}
}

38 
	$œyout_ã°_sim∂e_0t
(
dm_disk_if
 *
d
)

40 
bad
 = 0;

41 
lbn1
, 
lbn2
, 
rc
;

42 
dm_pbn
 
pbn
;

44 
lbn1
 = 0;Übn1 < 
d
->
dm_£˘‹s
;Übn1++) {

45 
rc
 = 
d
->
œyout
->
	`dm_å™¶©e_…›_0t
(d, 
lbn1
, 
MAP_FULL
, &
pbn
, 0);

46 if(
rc
 =
DM_NX
) {

47 
bad
++;

51 
lbn2
 = 
d
->
œyout
->
	`dm_å™¶©e_±ﬁ_0t
(d, &
pbn
, 0);

52 if(
lbn2
 < 0) {

53 
bad
++;

56 if(
lbn2
 !
lbn1
) {

57 
	`¥ötf
("*** %d -> (%d,%d,%d) -> %d\n",

58 
lbn1
, 
pbn
.
cyl
,Öbn.
hód
,Öbn.
£˘‹
, 
lbn2
);

59 
bad
++;

65  
bad
;

66 
	}
}

68 
	gmö¨gs
 = 0;

70 
	$doTe°s
(
dm_disk_if
 *
d
, 
¨gc
, **
¨gv
)

72  
	`œyout_ã°_sim∂e_0t
(
d
);

73 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_skew.c

31 
	~"ã°.h
"

33 
	$ã°sUßge
() {

34 
	`Ârötf
(
°dîr
, "usage:Üayout_simple <model>\n");

35 
	}
}

40 
	$œyout_ã°_sim∂e
(
dm_disk_if
 *
d
) {

41 
cou¡
 = 0, 
ru∆bn
 = 0, 
lbn
 = 0;

42 
dm_pbn
 
pbn
, 
åkpbn
 = {0,0,0};

43 
bad
 = 0;

46 
dm_™gÀ_t
 
skew
;

47 
dm_mech_°©e
 
åack
;

48 
dm_±ﬁ_ªsu…_t
 
rc
;

50 
rc
 = 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
lbn
, 
MAP_FULL
, &
pbn
, 0);

52 if(
rc
 =
DM_NX
) {

53 
bad
++;

57 
skew
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
pbn
);

60 
	`¥ötf
("%d -> (%d,%d,%d) @ %f\n",

61 
lbn
, 
pbn
.
cyl
,Öbn.
hód
,Öbn.
£˘‹
, 
	`dm_™gÀ_ôod
(
skew
));

63 
d
->
œyout
->
	`dm_gë_åack_bound¨õs
(d, &
pbn
, 0, &
lbn
, 0);

64 
lbn
++;

67 
	`fÊush
(
°dout
);

68 } 
lbn
 < 
d
->
dm_£˘‹s
);

71  
bad
;

72 
	}
}

74 
	gmö¨gs
 = 0;

76 
	$doTe°s
(
dm_disk_if
 *
d
, 
¨gc
, **
¨gv
)

78  
	`œyout_ã°_sim∂e
(
d
);

79 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_torture.c

30 
	~"ã°.h
"

32 
	$ã°sUßge
() {

33 
	`Ârötf
(
°dîr
, "usage:Üayout_simple <model>\n");

34 
	}
}

39 
	$œyout_t‹tuª
(
dm_disk_if
 *
d
) {

40 
lbn
, 
lbn2
;

41 
dm_pbn
 
pbn
, 
pbn2
, 
pbn3
, 
pbn4
;

42 
rv
;

43 
bad
 = 0;

46 
lbn
 = 
	`ønd
();

47 
rv
 = 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
lbn
, 
MAP_FULL
, &
pbn
, 0);

48 if(
rv
 =
DM_OK
) {

49 
rv
 = 
d
->
œyout
->
	`dm_å™¶©e_±ﬁ
(d, &
pbn
, 0);

52 
pbn
.
cyl
 = 
	`ønd
();

53 
pbn
.
hód
 = 
	`ønd
();

54 
pbn
.
£˘‹
 = 
	`ønd
();

56 
pbn2
 = 
pbn
;

57 
pbn3
 = 
pbn
;

58 
pbn4
 = 
pbn
;

60 
rv
 = 
d
->
œyout
->
	`dm_å™¶©e_±ﬁ
(d, &
pbn
, 0);

62 
rv
 = 
d
->
œyout
->
	`dm_gë_åack_bound¨õs
(d, &
pbn2
, &
lbn
, &
lbn2
, 0);

64 
rv
 = 
d
->
œyout
->
	`dm_pbn_skew
(d, &
pbn3
);

66 
rv
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_pbn
(d, &
pbn4
);

69 
	`fÊush
(
°dout
);

73  
bad
;

74 
	}
}

76 
	gmö¨gs
 = 0;

78 
	$doTe°s
(
dm_disk_if
 *
d
, 
¨gc
, **
¨gv
)

80  
	`œyout_t‹tuª
(
d
);

81 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_track.c

31 
	~"ã°.h
"

34 
	$ã°sUßge
() {

35 
	`Ârötf
(
°dîr
, "usage:Üayout_track <model> <raw_layout_file>\n");

36 
	}
}

38 
	$œyout_ã°_åackbound
(
dm_disk_if
 *
d
) {

39 
c
;

40 
bad˘
 = 0;

41 
bad
 = 0;

42 
œ°bad
 = 0;

43 
œ°lbn
;

45 
	`£éöebuf
(
°dout
);

47 
c
 = 0; c < 
d
->
dm_£˘‹s
; ) {

48 
l1
 = 0, 
l2
 = 0;

49 
dm_pbn
 
pbn
;

50 
•é
, 
•ç
;

51 
ªm≠£˘‹
 = 0;

53 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
c
, 
MAP_FULL
, &
pbn
, 0);

55 
•é
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_lbn
(d, 
c
);

56 
•ç
 = 
d
->
œyout
->
	`dm_gë_£˘‹s_pbn
(d, &
pbn
);

58 if(
•é
 !
•ç
) {

59 
	`¥ötf
("•à÷bnË%d !%d (pbn)\n", 
•é
, 
•ç
);

60 
bad
 = 1;

63 
d
->
œyout
->
	`dm_gë_åack_bound¨õs
(d, &
pbn
, &
l1
, &
l2
, 0);

67 if(
l1
 >
d
->
dm_£˘‹s
) {

68 
	`¥ötf
("l1Öa°Énd o‡disk! (%d >%d)\n", 
l1
, 
d
->
dm_£˘‹s
);

71 if(
l2
 >
d
->
dm_£˘‹s
) {

72 
	`¥ötf
("l2Öa°Énd o‡disk! (%d >%d)\n", 
l2
, 
d
->
dm_£˘‹s
);

77 if(
l1
 >
l2
) {

78 
	`¥ötf
("ã°_åackbound: %d >%d\n", 
l1
, 
l2
);

79 
bad
 = 1;

82 if(
l2
 - 
l1
 + 1 > 
•é
) {

83 
	`¥ötf
("%d > %d (phy†•t)\n", 
l2
 - 
l1
 + 1, 
•é
);

84 
bad
 = 1;

87 if(!((
l1
 <
c
Ë&& (¯<
l2
))) {

88 
	`¥ötf
("test_trackbound: %d (%d,%d,%d) -> (%d, %d) \n",

89 
c
, 
pbn
.
cyl
,Öbn.
hód
,Öbn.
£˘‹
,

90 
l1
, 
l2
);

91 
bad
 = 1;

95 if(!
œ°bad
 && (
c
>0Ë&& (
l1
 !(
œ°lbn
+1)Ë&& (œ°lb¿!
l2
))

97 
	`¥ötf
("ã°_åackbound (%d): (%d,%dË<> %d+1\n", 
c
, 
l1
, 
l2
, 
œ°lbn
);

98 
bad
 = 1;

101 
œ°lbn
 = 
l2
;

102 if(
bad
) {

103 
	`¥ötf
("bad %d\n", 
c
);

104 
bad˘
++;

107 if(
bad
) {

108 
c
++;

111 
c
 = 
l2
 + 1;

114 
œ°bad
 = 
bad
;

115 
bad
 = 0;

117  
bad˘
;

118 
	}
}

121 
	gmö¨gs
 = 0;

123 
	$doTe°s
(
dm_disk_if
 *
d
, 
¨gc
, **
¨gv
)

125  
	`œyout_ã°_åackbound
(
d
);

126 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/mech_seek.c

30 
	~"ã°.h
"

32 
	$ã°sUßge
() {

33 
	`Ârötf
(
°dîr
, "usage:Üayout_simple <model>\n");

34 
	}
}

38 
	$mech_ã°_£ek
(
dm_disk_if
 *
d
) {

39 
i
, 
lbn
, 
cou¡
 = 0, 
ru∆bn
 = 0;

40 
dm_pbn
 
pbn
, 
åkpbn
 = {0,0,0};

41 
bad
 = 0;

43 
i
 = 0; i < 
d
->
dm_cyls
; i++) {

44 
dm_mech_°©e
 
°¨t
 = {.
cyl
 = 0 };

45 
dm_mech_°©e
 
íd
;

46 
dm_time_t
 
°
;

48 
íd
.
cyl
 = 
i
;

50 
	`°¨tClock
(0);

51 
°
 = 
d
->
mech
->
	`dm_£ek_time
(d, &
°¨t
, &
íd
, 0);

52 
	`°›Clock
(0);

54 
	`¥ötf
("%d -> %f\n", 
i
, 
	`dm_time_ôod
(
°
));

59  
bad
;

60 
	}
}

62 
	gmö¨gs
 = 0;

64 
	$doTe°s
(
dm_disk_if
 *
d
, 
¨gc
, **
¨gv
)

66 
	`addBuckë
("dm_seek_time()");

67  
	`mech_ã°_£ek
(
d
);

68 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/template.c

30 
	~<diskmodñ/dm.h
>

31 
	~<diskmodñ/moduÀs/moduÀs.h
>

33 
	~<lib∑øm/lib∑øm.h
>

34 
	~<libddbg/libddbg.h
>

36 
	~<°dio.h
>

40 
doTe°s
(
dm_disk_if
 *, , **);

41 
ã°sUßge
();

42 
mö¨gs
;

45 
	$maö
(
¨gc
, **
¨gv
)

47 
c
;

48 
FILE
 *
modñfûe
;

49 
dm_disk_if
 *
disk
;

50 *
modñ«me
;

52 
	`ddbg_as£π_£tfûe
(
°dîr
);

54 if(
¨gc
 < 
mö¨gs
) {

55 
	`ußge
();

56 
	`exô
(1);

59 
modñfûe
 = 
	`f›í
(
¨gv
[1], "r");

60 if(!
modñfûe
) {

61 
	`Ârötf
(
°dîr
, "***Éº‹: faûedÅÿ›í \"%s\"\n", 
¨gv
[1]);

64 
c
 = 0; c <
DM_MAX_MODULE
; c++) {

65 
Õ_mod
 *
mod
;

67 if(
c
 =
DM_MOD_DISK
) {

68 
mod
 = 
dm_mods
[
c
];

71 
mod
 = 
dm_mods
[
c
];

74 
	`Õ_ªgi°î_moduÀ
(
mod
);

77 
	`Õ_öô_ty≥tbl
();

78 
	`Õ_lﬂdfûe
(
modñfûe
, 0, 0, 
¨gv
[1], 0, 0);

79 
	`f˛o£
(
modñfûe
);

81 
modñ«me
 = 
¨gc
 >3 ? 
¨gv
[2] : 0;

83 
disk
 = 
	`Õ_ö°™tüã
("foo", 
modñ«me
);

84 
	`¥ötf
("*** gŸá dm_disk wôh %d se˘‹s!\n", 
disk
->
dm_£˘‹s
);

87 
	`doTe°s
(
disk
, 
¨gc
, 
¨gv
);

91 
	`exô
(0);

94 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/test.h

30 
	~<°dio.h
>

31 
	~<diskmodñ/dm.h
>

32 
	~<libddbg/libddbg.h
>

	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_bus_param.h

2 #i‚de‡
_DISKSIM_BUS_PARAM_H


3 
	#_DISKSIM_BUS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
bus
 *
disksim_bus_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
DISKSIM_BUS_TYPE
,

16 
DISKSIM_BUS_ARBITRATION_TYPE
,

17 
DISKSIM_BUS_ARBITRATION_TIME
,

18 
DISKSIM_BUS_READ_BLOCK_TRANSFER_TIME
,

19 
DISKSIM_BUS_WRITE_BLOCK_TRANSFER_TIME
,

20 
DISKSIM_BUS_PRINT_STATS


21 } 
	tdisksim_bus_∑øm_t
;

23 
	#DISKSIM_BUS_MAX_PARAM
 
DISKSIM_BUS_PRINT_STATS


	)

24 * 
DISKSIM_BUS_lﬂdîs
[];

25 
Õ_∑ømdï_t
 
DISKSIM_BUS_dïs
[];

28 
Õ_v¨•ec
 
	gdisksim_bus_∑øms
 [] = {

29 {"ty≥", 
I
, 1 },

30 {"Arbôøti⁄Åy≥", 
I
, 1 },

31 {"Arbôøti⁄Åime", 
D
, 1 },

32 {"Ród blockÅøns„∏time", 
D
, 1 },

33 {"WrôêblockÅøns„∏time", 
D
, 1 },

34 {"Pröà°©s", 
I
, 1 },

37 
	#DISKSIM_BUS_MAX
 6

	)

38 
Õ_mod
 
	gdisksim_bus_mod
 = { "disksim_bus", 
disksim_bus_∑øms
, 
DISKSIM_BUS_MAX
, (
Õ_modlﬂdî_t
)
disksim_bus_lﬂd∑øms
, 0, 0, 
DISKSIM_BUS_lﬂdîs
, 
DISKSIM_BUS_dïs
 };

41 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_bus_stats_param.h

2 #i‚de‡
_DISKSIM_BUS_STATS_PARAM_H


3 
	#_DISKSIM_BUS_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_bus_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_BUS_STATS_PRINT_BUS_IDLE_STATS
,

16 
DISKSIM_BUS_STATS_PRINT_BUS_ARBWAIT_STATS


17 } 
	tdisksim_bus_°©s_∑øm_t
;

19 
	#DISKSIM_BUS_STATS_MAX_PARAM
 
DISKSIM_BUS_STATS_PRINT_BUS_ARBWAIT_STATS


	)

20 * 
DISKSIM_BUS_STATS_lﬂdîs
[];

21 
Õ_∑ømdï_t
 
DISKSIM_BUS_STATS_dïs
[];

24 
Õ_v¨•ec
 
	gdisksim_bus_°©s_∑øms
 [] = {

25 {"Pröàbu†idÀ sèts", 
I
, 1 },

26 {"Pröàbu†¨bwaô sèts", 
I
, 1 },

29 
	#DISKSIM_BUS_STATS_MAX
 2

	)

30 
Õ_mod
 
	gdisksim_bus_°©s_mod
 = { "disksim_bus_°©s", 
disksim_bus_°©s_∑øms
, 
DISKSIM_BUS_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_bus_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_BUS_STATS_lﬂdîs
, 
DISKSIM_BUS_STATS_dïs
 };

33 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_cachedev_param.h

2 #i‚de‡
_DISKSIM_CACHEDEV_PARAM_H


3 
	#_DISKSIM_CACHEDEV_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
ˇche_if
 *
disksim_ˇchedev_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_CACHEDEV_CACHE_SIZE
,

16 
DISKSIM_CACHEDEV_MAX_REQUEST_SIZE
,

17 
DISKSIM_CACHEDEV_WRITE_SCHEME
,

18 
DISKSIM_CACHEDEV_FLUSH_POLICY
,

19 
DISKSIM_CACHEDEV_FLUSH_PERIOD
,

20 
DISKSIM_CACHEDEV_FLUSH_IDLE_DELAY
,

21 
DISKSIM_CACHEDEV_CACHE_DEVICE
,

22 
DISKSIM_CACHEDEV_CACHED_DEVICE


23 } 
	tdisksim_ˇchedev_∑øm_t
;

25 
	#DISKSIM_CACHEDEV_MAX_PARAM
 
DISKSIM_CACHEDEV_CACHED_DEVICE


	)

26 * 
DISKSIM_CACHEDEV_lﬂdîs
[];

27 
Õ_∑ømdï_t
 
DISKSIM_CACHEDEV_dïs
[];

30 
Õ_v¨•ec
 
	gdisksim_ˇchedev_∑øms
 [] = {

31 {"Cachêsize", 
I
, 1 },

32 {"MaxÑeque° size", 
I
, 1 },

33 {"Wrôêscheme", 
I
, 1 },

34 {"FlushÖﬁicy", 
I
, 1 },

35 {"FlushÖîiod", 
D
, 1 },

36 {"Flush idÀ dñay", 
D
, 1 },

37 {"Cachêdevi˚", 
S
, 1 },

38 {"Cached devi˚", 
S
, 1 },

41 
	#DISKSIM_CACHEDEV_MAX
 8

	)

42 
Õ_mod
 
	gdisksim_ˇchedev_mod
 = { "disksim_ˇchedev", 
disksim_ˇchedev_∑øms
, 
DISKSIM_CACHEDEV_MAX
, (
Õ_modlﬂdî_t
)
disksim_ˇchedev_lﬂd∑øms
, 0, 0, 
DISKSIM_CACHEDEV_lﬂdîs
, 
DISKSIM_CACHEDEV_dïs
 };

45 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_cachemem_param.h

2 #i‚de‡
_DISKSIM_CACHEMEM_PARAM_H


3 
	#_DISKSIM_CACHEMEM_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
ˇche_if
 *
disksim_ˇchemem_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_CACHEMEM_CACHE_SIZE
,

16 
DISKSIM_CACHEMEM_SLRU_SEGMENTS
,

17 
DISKSIM_CACHEMEM_LINE_SIZE
,

18 
DISKSIM_CACHEMEM_BIT_GRANULARITY
,

19 
DISKSIM_CACHEMEM_LOCK_GRANULARITY
,

20 
DISKSIM_CACHEMEM_SHARED_READ_LOCKS
,

21 
DISKSIM_CACHEMEM_MAX_REQUEST_SIZE
,

22 
DISKSIM_CACHEMEM_REPLACEMENT_POLICY
,

23 
DISKSIM_CACHEMEM_ALLOCATION_POLICY
,

24 
DISKSIM_CACHEMEM_WRITE_SCHEME
,

25 
DISKSIM_CACHEMEM_FLUSH_POLICY
,

26 
DISKSIM_CACHEMEM_FLUSH_PERIOD
,

27 
DISKSIM_CACHEMEM_FLUSH_IDLE_DELAY
,

28 
DISKSIM_CACHEMEM_FLUSH_MAX_LINE_CLUSTER
,

29 
DISKSIM_CACHEMEM_READ_PREFETCH_TYPE
,

30 
DISKSIM_CACHEMEM_WRITE_PREFETCH_TYPE
,

31 
DISKSIM_CACHEMEM_LINE_BY_LINE_FETCHES
,

32 
DISKSIM_CACHEMEM_MAX_GATHER


33 } 
	tdisksim_ˇchemem_∑øm_t
;

35 
	#DISKSIM_CACHEMEM_MAX_PARAM
 
DISKSIM_CACHEMEM_MAX_GATHER


	)

36 * 
DISKSIM_CACHEMEM_lﬂdîs
[];

37 
Õ_∑ømdï_t
 
DISKSIM_CACHEMEM_dïs
[];

40 
Õ_v¨•ec
 
	gdisksim_ˇchemem_∑øms
 [] = {

41 {"Cachêsize", 
I
, 1 },

42 {"SLRU segmíts", 
LIST
, 0 },

43 {"Löêsize", 
I
, 1 },

44 {"Bô gønuœrôy", 
I
, 1 },

45 {"Lock gønuœrôy", 
I
, 1 },

46 {"Sh¨edÑódÜocks", 
I
, 1 },

47 {"MaxÑeque° size", 
I
, 1 },

48 {"Rïœ˚míàpﬁicy", 
I
, 1 },

49 {"AŒoˇti⁄Öﬁicy", 
I
, 1 },

50 {"Wrôêscheme", 
I
, 1 },

51 {"FlushÖﬁicy", 
I
, 1 },

52 {"FlushÖîiod", 
D
, 1 },

53 {"Flush idÀ dñay", 
D
, 1 },

54 {"Flush maxÜöê˛u°î", 
I
, 1 },

55 {"RódÖª„tchÅy≥", 
I
, 1 },

56 {"Wrôê¥e„tchÅy≥", 
I
, 1 },

57 {"Löe-by-löê„tches", 
I
, 1 },

58 {"Max g©hî", 
I
, 1 },

61 
	#DISKSIM_CACHEMEM_MAX
 18

	)

62 
Õ_mod
 
	gdisksim_ˇchemem_mod
 = { "disksim_ˇchemem", 
disksim_ˇchemem_∑øms
, 
DISKSIM_CACHEMEM_MAX
, (
Õ_modlﬂdî_t
)
disksim_ˇchemem_lﬂd∑øms
, 0, 0, 
DISKSIM_CACHEMEM_lﬂdîs
, 
DISKSIM_CACHEMEM_dïs
 };

65 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_ctlr_param.h

2 #i‚de‡
_DISKSIM_CTLR_PARAM_H


3 
	#_DISKSIM_CTLR_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
c⁄åﬁÀr
 *
disksim_˘Ã_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_CTLR_TYPE
,

16 
DISKSIM_CTLR_SCALE_FOR_DELAYS
,

17 
DISKSIM_CTLR_BULK_SECTOR_TRANSFER_TIME
,

18 
DISKSIM_CTLR_MAXIMUM_QUEUE_LENGTH
,

19 
DISKSIM_CTLR_PRINT_STATS
,

20 
DISKSIM_CTLR_SCHEDULER
,

21 
DISKSIM_CTLR_CACHE
,

22 
DISKSIM_CTLR_MAX_PER_DISK_PENDING_COUNT


23 } 
	tdisksim_˘Ã_∑øm_t
;

25 
	#DISKSIM_CTLR_MAX_PARAM
 
DISKSIM_CTLR_MAX_PER_DISK_PENDING_COUNT


	)

26 * 
DISKSIM_CTLR_lﬂdîs
[];

27 
Õ_∑ømdï_t
 
DISKSIM_CTLR_dïs
[];

30 
Õ_v¨•ec
 
	gdisksim_˘Ã_∑øms
 [] = {

31 {"ty≥", 
I
, 1 },

32 {"SˇÀ f‹ dñays", 
D
, 1 },

33 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

34 {"Maximum queuêÀngth", 
I
, 1 },

35 {"Pröà°©s", 
I
, 1 },

36 {"ScheduÀr", 
BLOCK
, 0 },

37 {"Cache", 
BLOCK
, 0 },

38 {"MaxÖî-diskÖídög cou¡", 
I
, 0 },

41 
	#DISKSIM_CTLR_MAX
 8

	)

42 
Õ_mod
 
	gdisksim_˘Ã_mod
 = { "disksim_˘Ã", 
disksim_˘Ã_∑øms
, 
DISKSIM_CTLR_MAX
, (
Õ_modlﬂdî_t
)
disksim_˘Ã_lﬂd∑øms
, 0, 0, 
DISKSIM_CTLR_lﬂdîs
, 
DISKSIM_CTLR_dïs
 };

45 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_ctlr_stats_param.h

2 #i‚de‡
_DISKSIM_CTLR_STATS_PARAM_H


3 
	#_DISKSIM_CTLR_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_˘Ã_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CACHE_STATS
,

16 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_SIZE_STATS
,

17 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_LOCALITY_STATS
,

18 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_BLOCKING_STATS
,

19 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTERFERENCE_STATS
,

20 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_QUEUE_STATS
,

21 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CRIT_STATS
,

22 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_IDLE_STATS
,

23 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTARR_STATS
,

24 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STREAK_STATS
,

25 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STAMP_STATS
,

26 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_PER_DEVICE_STATS


27 } 
	tdisksim_˘Ã_°©s_∑øm_t
;

29 
	#DISKSIM_CTLR_STATS_MAX_PARAM
 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_PER_DEVICE_STATS


	)

30 * 
DISKSIM_CTLR_STATS_lﬂdîs
[];

31 
Õ_∑ømdï_t
 
DISKSIM_CTLR_STATS_dïs
[];

34 
Õ_v¨•ec
 
	gdisksim_˘Ã_°©s_∑øms
 [] = {

35 {"Pröàc⁄åﬁÀ∏ˇchê°©s", 
I
, 1 },

36 {"Pröàc⁄åﬁÀ∏sizê°©s", 
I
, 1 },

37 {"Pröàc⁄åﬁÀ∏loˇlôy sèts", 
I
, 1 },

38 {"Pröàc⁄åﬁÀ∏blockög sèts", 
I
, 1 },

39 {"Pröàc⁄åﬁÀ∏öãr„ªn˚ sèts", 
I
, 1 },

40 {"Pröàc⁄åﬁÀ∏queuê°©s", 
I
, 1 },

41 {"Pröàc⁄åﬁÀ∏¸ô sèts", 
I
, 1 },

42 {"Pröàc⁄åﬁÀ∏idÀ sèts", 
I
, 1 },

43 {"Pröàc⁄åﬁÀ∏öèº sèts", 
I
, 1 },

44 {"Pröàc⁄åﬁÀ∏°ªak sèts", 
I
, 1 },

45 {"Pröàc⁄åﬁÀ∏°am∞°©s", 
I
, 1 },

46 {"Pröàc⁄åﬁÀ∏≥r-devi˚ sèts", 
I
, 1 },

49 
	#DISKSIM_CTLR_STATS_MAX
 12

	)

50 
Õ_mod
 
	gdisksim_˘Ã_°©s_mod
 = { "disksim_˘Ã_°©s", 
disksim_˘Ã_°©s_∑øms
, 
DISKSIM_CTLR_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_˘Ã_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_CTLR_STATS_lﬂdîs
, 
DISKSIM_CTLR_STATS_dïs
 };

53 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_device_param.h

2 #i‚de‡
_DISKSIM_DEVICE_PARAM_H


3 
	#_DISKSIM_DEVICE_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_devi˚_lﬂd∑øms
();

14 
	#DISKSIM_DEVICE_MAX_PARAM


	)

15 * 
DISKSIM_DEVICE_lﬂdîs
[];

16 
Õ_∑ømdï_t
 
DISKSIM_DEVICE_dïs
[];

19 
Õ_v¨•ec
 
	gdisksim_devi˚_∑øms
 [] = {

22 
	#DISKSIM_DEVICE_MAX
 0

	)

23 
Õ_mod
 
	gdisksim_devi˚_mod
 = { "disksim_devi˚", 
disksim_devi˚_∑øms
, 
DISKSIM_DEVICE_MAX
, (
Õ_modlﬂdî_t
)
disksim_devi˚_lﬂd∑øms
, 0, 0, 
DISKSIM_DEVICE_lﬂdîs
, 
DISKSIM_DEVICE_dïs
 };

26 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_device_stats_param.h

2 #i‚de‡
_DISKSIM_DEVICE_STATS_PARAM_H


3 
	#_DISKSIM_DEVICE_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_devi˚_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_QUEUE_STATS
,

16 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_CRIT_STATS
,

17 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_IDLE_STATS
,

18 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTARR_STATS
,

19 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_SIZE_STATS
,

20 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_SEEK_STATS
,

21 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_LATENCY_STATS
,

22 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_XFER_STATS
,

23 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_ACCTIME_STATS
,

24 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTERFERE_STATS
,

25 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_BUFFER_STATS


26 } 
	tdisksim_devi˚_°©s_∑øm_t
;

28 
	#DISKSIM_DEVICE_STATS_MAX_PARAM
 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_BUFFER_STATS


	)

29 * 
DISKSIM_DEVICE_STATS_lﬂdîs
[];

30 
Õ_∑ømdï_t
 
DISKSIM_DEVICE_STATS_dïs
[];

33 
Õ_v¨•ec
 
	gdisksim_devi˚_°©s_∑øms
 [] = {

34 {"Pröàdevi˚ queuê°©s", 
I
, 1 },

35 {"Pröàdevi˚ crô sèts", 
I
, 1 },

36 {"Pröàdevi˚ idÀ sèts", 
I
, 1 },

37 {"Pröàdevi˚ i¡¨∏°©s", 
I
, 1 },

38 {"Pröàdevi˚ sizê°©s", 
I
, 1 },

39 {"Pröàdevi˚ sìk sèts", 
I
, 1 },

40 {"Pröàdevi˚Ü©ícy sèts", 
I
, 1 },

41 {"Pröàdevi˚ x„∏°©s", 
I
, 1 },

42 {"Pröàdevi˚ác˘imê°©s", 
I
, 1 },

43 {"Pröàdevi˚ i¡î„ª sèts", 
I
, 1 },

44 {"Pröàdevi˚ buf„∏°©s", 
I
, 1 },

47 
	#DISKSIM_DEVICE_STATS_MAX
 11

	)

48 
Õ_mod
 
	gdisksim_devi˚_°©s_mod
 = { "disksim_devi˚_°©s", 
disksim_devi˚_°©s_∑øms
, 
DISKSIM_DEVICE_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_devi˚_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_DEVICE_STATS_lﬂdîs
, 
DISKSIM_DEVICE_STATS_dïs
 };

51 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_disk_param.h

2 #i‚de‡
_DISKSIM_DISK_PARAM_H


3 
	#_DISKSIM_DISK_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disk
 *
disksim_disk_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
DISKSIM_DISK_MODEL
,

16 
DISKSIM_DISK_SCHEDULER
,

17 
DISKSIM_DISK_MAX_QUEUE_LENGTH
,

18 
DISKSIM_DISK_BULK_SECTOR_TRANSFER_TIME
,

19 
DISKSIM_DISK_SEGMENT_SIZE_
,

20 
DISKSIM_DISK_NUMBER_OF_BUFFER_SEGMENTS
,

21 
DISKSIM_DISK_PRINT_STATS
,

22 
DISKSIM_DISK_PER_REQUEST_OVERHEAD_TIME
,

23 
DISKSIM_DISK_TIME_SCALE_FOR_OVERHEADS
,

24 
DISKSIM_DISK_HOLD_BUS_ENTIRE_READ_XFER
,

25 
DISKSIM_DISK_HOLD_BUS_ENTIRE_WRITE_XFER
,

26 
DISKSIM_DISK_ALLOW_ALMOST_READ_HITS
,

27 
DISKSIM_DISK_ALLOW_SNEAKY_FULL_READ_HITS
,

28 
DISKSIM_DISK_ALLOW_SNEAKY_PARTIAL_READ_HITS
,

29 
DISKSIM_DISK_ALLOW_SNEAKY_INTERMEDIATE_READ_HITS
,

30 
DISKSIM_DISK_ALLOW_READ_HITS_ON_WRITE_DATA
,

31 
DISKSIM_DISK_ALLOW_WRITE_PREBUFFERING
,

32 
DISKSIM_DISK_PRESEEKING_LEVEL
,

33 
DISKSIM_DISK_NEVER_DISCONNECT
,

34 
DISKSIM_DISK_AVG_SECTORS_PER_CYLINDER
,

35 
DISKSIM_DISK_MAXIMUM_NUMBER_OF_WRITE_SEGMENTS
,

36 
DISKSIM_DISK_USE_SEPARATE_WRITE_SEGMENT
,

37 
DISKSIM_DISK_LOW__WATER_MARK
,

38 
DISKSIM_DISK_HIGH__WATER_MARK
,

39 
DISKSIM_DISK_SET_WATERMARK_BY_REQSIZE
,

40 
DISKSIM_DISK_CALC_SECTOR_BY_SECTOR
,

41 
DISKSIM_DISK_ENABLE_CACHING_IN_BUFFER
,

42 
DISKSIM_DISK_BUFFER_CONTINUOUS_READ
,

43 
DISKSIM_DISK_MINIMUM_READ_AHEAD_
,

44 
DISKSIM_DISK_MAXIMUM_READ_AHEAD_
,

45 
DISKSIM_DISK_READ_AHEAD_OVER_REQUESTED
,

46 
DISKSIM_DISK_READ_AHEAD_ON_IDLE_HIT
,

47 
DISKSIM_DISK_READ_ANY_FREE_BLOCKS
,

48 
DISKSIM_DISK_FAST_WRITE_LEVEL
,

49 
DISKSIM_DISK_COMBINE_SEQ_WRITES
,

50 
DISKSIM_DISK_STOP_PREFETCH_IN_SECTOR
,

51 
DISKSIM_DISK_DISCONNECT_WRITE_IF_SEEK
,

52 
DISKSIM_DISK_WRITE_HIT_STOP_PREFETCH
,

53 
DISKSIM_DISK_READ_DIRECTLY_TO_BUFFER
,

54 
DISKSIM_DISK_IMMED_TRANSFER_PARTIAL_HIT
,

55 
DISKSIM_DISK_READ_HIT_OVER_AFTER_READ
,

56 
DISKSIM_DISK_READ_HIT_OVER_AFTER_WRITE
,

57 
DISKSIM_DISK_READ_MISS_OVER_AFTER_READ
,

58 
DISKSIM_DISK_READ_MISS_OVER_AFTER_WRITE
,

59 
DISKSIM_DISK_WRITE_HIT_OVER_AFTER_READ
,

60 
DISKSIM_DISK_WRITE_HIT_OVER_AFTER_WRITE
,

61 
DISKSIM_DISK_WRITE_MISS_OVER_AFTER_READ
,

62 
DISKSIM_DISK_WRITE_MISS_OVER_AFTER_WRITE
,

63 
DISKSIM_DISK_READ_COMPLETION_OVERHEAD
,

64 
DISKSIM_DISK_WRITE_COMPLETION_OVERHEAD
,

65 
DISKSIM_DISK_DATA_PREPARATION_OVERHEAD
,

66 
DISKSIM_DISK_FIRST_RESELECT_OVERHEAD
,

67 
DISKSIM_DISK_OTHER_RESELECT_OVERHEAD
,

68 
DISKSIM_DISK_READ_DISCONNECT_AFTERREAD
,

69 
DISKSIM_DISK_READ_DISCONNECT_AFTERWRITE
,

70 
DISKSIM_DISK_WRITE_DISCONNECT_OVERHEAD
,

71 
DISKSIM_DISK_EXTRA_WRITE_DISCONNECT
,

72 
DISKSIM_DISK_EXTRADISC_COMMAND_OVERHEAD
,

73 
DISKSIM_DISK_EXTRADISC_DISCONNECT_OVERHEAD
,

74 
DISKSIM_DISK_EXTRADISC_INTER_DISCONNECT_DELAY
,

75 
DISKSIM_DISK_EXTRADISC_2ND_DISCONNECT_OVERHEAD
,

76 
DISKSIM_DISK_EXTRADISC_SEEK_DELTA
,

77 
DISKSIM_DISK_MINIMUM_SEEK_DELAY
,

78 
DISKSIM_DISK_IMMEDIATE_BUFFER_READ
,

79 
DISKSIM_DISK_IMMEDIATE_BUFFER_WRITE


80 } 
	tdisksim_disk_∑øm_t
;

82 
	#DISKSIM_DISK_MAX_PARAM
 
DISKSIM_DISK_IMMEDIATE_BUFFER_WRITE


	)

83 * 
DISKSIM_DISK_lﬂdîs
[];

84 
Õ_∑ømdï_t
 
DISKSIM_DISK_dïs
[];

87 
Õ_v¨•ec
 
	gdisksim_disk_∑øms
 [] = {

88 {"Modñ", 
BLOCK
, 1 },

89 {"ScheduÀr", 
BLOCK
, 1 },

90 {"Max queuêÀngth", 
I
, 1 },

91 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

92 {"Segmíàsizê(ö blks)", 
I
, 1 },

93 {"Numbî o‡buf„∏£gmíts", 
I
, 1 },

94 {"Pröà°©s", 
I
, 1 },

95 {"Pî-ªque° ovîhódÅime", 
D
, 1 },

96 {"TimêsˇÀ f‹ ovîhóds", 
D
, 1 },

97 {"Hﬁd bu†ítúêªad x„r", 
I
, 1 },

98 {"Hﬁd bu†ítúêwrôêx„r", 
I
, 1 },

99 {"AŒowálmo°Ñód hôs", 
I
, 1 },

100 {"AŒow s√aky fuŒÑód hôs", 
I
, 1 },

101 {"AŒow s√akyÖ¨tü»ªad hôs", 
I
, 1 },

102 {"AŒow s√aky i¡îmedüãÑód hôs", 
I
, 1 },

103 {"AŒowÑód hô†⁄ wrôêd©a", 
I
, 1 },

104 {"AŒow wrôê¥ebuf„rög", 
I
, 1 },

105 {"Pª£ekögÜevñ", 
I
, 1 },

106 {"Nevî disc⁄√˘", 
I
, 1 },

107 {"Avg se˘‹†≥∏cylödî", 
I
, 1 },

108 {"MaximumÇumbî o‡wrôê£gmíts", 
I
, 1 },

109 {"U£ sï¨©êwrôê£gmít", 
I
, 1 },

110 {"Low (wrôeËw©î m¨k", 
D
, 1 },

111 {"High (ªadËw©î m¨k", 
D
, 1 },

112 {"Së w©îm¨k byÑeqsize", 
I
, 1 },

113 {"CÆ¯£˘‹ by se˘‹", 
I
, 1 },

114 {"E«bÀ cachög i¿buf„r", 
I
, 1 },

115 {"Buf„∏c⁄töuou†ªad", 
I
, 1 },

116 {"MöimumÑód-ahód (blks)", 
I
, 1 },

117 {"MaximumÑód-ahód (blks)", 
I
, 1 },

118 {"Ród-ahód ovîÑeque°ed", 
I
, 1 },

119 {"Ród-ahód o¿idÀ hô", 
I
, 1 },

120 {"Ródány fªêblocks", 
I
, 1 },

121 {"Fa° wrôêÀvñ", 
I
, 1 },

122 {"Comböê£q wrôes", 
I
, 1 },

123 {"St›Öª„tch i¿£˘‹", 
I
, 1 },

124 {"Disc⁄√˘ wrôêi‡£ek", 
I
, 1 },

125 {"Wrôêhô st›Öª„tch", 
I
, 1 },

126 {"Ród dúe˘lyÅÿbuf„r", 
I
, 1 },

127 {"ImmedÅøns„∏∑πü»hô", 
I
, 1 },

128 {"Ród hô ovî.á·îÑód", 
D
, 1 },

129 {"Ród hô ovî.á·î wrôe", 
D
, 1 },

130 {"Ród mis†ovî.á·îÑód", 
D
, 1 },

131 {"Ród mis†ovî.á·î wrôe", 
D
, 1 },

132 {"Wrôêhô ovî.á·îÑód", 
D
, 1 },

133 {"Wrôêhô ovî.á·î wrôe", 
D
, 1 },

134 {"Wrôêmis†ovî.á·îÑód", 
D
, 1 },

135 {"Wrôêmis†ovî.á·î wrôe", 
D
, 1 },

136 {"Ród com∂ëi⁄ ovîhód", 
D
, 1 },

137 {"Wrôêcom∂ëi⁄ ovîhód", 
D
, 1 },

138 {"D©®¥ï¨©i⁄ ovîhód", 
D
, 1 },

139 {"Fú°Ñe£À˘ ovîhód", 
D
, 1 },

140 {"OthîÑe£À˘ ovîhód", 
D
, 1 },

141 {"Ród disc⁄√˘á·îªad", 
D
, 1 },

142 {"Ród disc⁄√˘á·îwrôe", 
D
, 1 },

143 {"Wrôêdisc⁄√˘ ovîhód", 
D
, 1 },

144 {"Exå®wrôêdisc⁄√˘", 
I
, 1 },

145 {"Exåadis¯comm™d ovîhód", 
D
, 1 },

146 {"Exåadis¯disc⁄√˘ ovîhód", 
D
, 1 },

147 {"Exåadis¯öãr-disc⁄√˘ dñay", 
D
, 1 },

148 {"Exåadis¯2nd disc⁄√˘ ovîhód", 
D
, 1 },

149 {"Exåadis¯£ek dñè", 
D
, 1 },

150 {"Möimum sìk dñay", 
D
, 1 },

151 {"Immedüã buf„∏ªad", 
I
, 1 },

152 {"Immedüã buf„∏wrôe", 
I
, 1 },

155 
	#DISKSIM_DISK_MAX
 65

	)

156 
Õ_mod
 
	gdisksim_disk_mod
 = { "disksim_disk", 
disksim_disk_∑øms
, 
DISKSIM_DISK_MAX
, (
Õ_modlﬂdî_t
)
disksim_disk_lﬂd∑øms
, 0, 0, 
DISKSIM_DISK_lﬂdîs
, 
DISKSIM_DISK_dïs
 };

159 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_fcl_param.h

2 #i‚de‡
_DISKSIM_FCL_PARAM_H


3 
	#_DISKSIM_FCL_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_f˛_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
DISKSIM_FCL_PAGE_SIZE
,

16 
DISKSIM_FCL_MAX_PAGES
,

17 
DISKSIM_FCL_BYPASS_CACHE
,

18 
DISKSIM_FCL_IDLE_DETECT_TIME


19 } 
	tdisksim_f˛_∑øm_t
;

21 
	#DISKSIM_FCL_MAX_PARAM
 
DISKSIM_FCL_IDLE_DETECT_TIME


	)

22 * 
DISKSIM_FCL_lﬂdîs
[];

23 
Õ_∑ømdï_t
 
DISKSIM_FCL_dïs
[];

26 
Õ_v¨•ec
 
	gdisksim_f˛_∑øms
 [] = {

27 {"PagêSize", 
I
, 1 },

28 {"Max Pages", 
I
, 1 },

29 {"By∑s†Cache", 
I
, 1 },

30 {"IdÀ Dëe˘ Time", 
D
, 1 },

33 
	#DISKSIM_FCL_MAX
 4

	)

34 
Õ_mod
 
	gdisksim_f˛_mod
 = { "disksim_f˛", 
disksim_f˛_∑øms
, 
DISKSIM_FCL_MAX
, (
Õ_modlﬂdî_t
)
disksim_f˛_lﬂd∑øms
, 0, 0, 
DISKSIM_FCL_lﬂdîs
, 
DISKSIM_FCL_dïs
 };

37 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_global_param.h

2 #i‚de‡
_DISKSIM_GLOBAL_PARAM_H


3 
	#_DISKSIM_GLOBAL_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_globÆ_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_GLOBAL_INIT_SEED
,

16 
DISKSIM_GLOBAL_INIT_SEED_WITH_TIME
,

17 
DISKSIM_GLOBAL_REAL_SEED
,

18 
DISKSIM_GLOBAL_REAL_SEED_WITH_TIME
,

19 
DISKSIM_GLOBAL_STATISTIC_WARM_UP_TIME
,

20 
DISKSIM_GLOBAL_STATISTIC_WARM_UP_IOS
,

21 
DISKSIM_GLOBAL_STAT_DEFINITION_FILE
,

22 
DISKSIM_GLOBAL_OUTPUT_FILE_FOR_TRACE_OF_IO_REQUESTS_SIMULATED
,

23 
DISKSIM_GLOBAL_DETAILED_EXECUTION_TRACE


24 } 
	tdisksim_globÆ_∑øm_t
;

26 
	#DISKSIM_GLOBAL_MAX_PARAM
 
DISKSIM_GLOBAL_DETAILED_EXECUTION_TRACE


	)

27 * 
DISKSIM_GLOBAL_lﬂdîs
[];

28 
Õ_∑ømdï_t
 
DISKSIM_GLOBAL_dïs
[];

31 
Õ_v¨•ec
 
	gdisksim_globÆ_∑øms
 [] = {

32 {"Inô Sìd", 
I
, 0 },

33 {"Inô Sìd wôhÅime", 
I
, 0 },

34 {"Ró»Sìd", 
I
, 0 },

35 {"Ró»Sìd wôhÅime", 
I
, 0 },

36 {"Sèti°i¯w¨m-u∞time", 
D
, 0 },

37 {"Sèti°i¯w¨m-u∞IOs", 
I
, 0 },

38 {"Sèàdeföôi⁄ fûe", 
S
, 1 },

39 {"Ouçuàfûêf‹Åø˚ o‡I/OÑeque°†simuœãd", 
S
, 0 },

40 {"DëaûedÉxecuti⁄Åø˚", 
S
, 0 },

43 
	#DISKSIM_GLOBAL_MAX
 9

	)

44 
Õ_mod
 
	gdisksim_globÆ_mod
 = { "disksim_globÆ", 
disksim_globÆ_∑øms
, 
DISKSIM_GLOBAL_MAX
, (
Õ_modlﬂdî_t
)
disksim_globÆ_lﬂd∑øms
, 0, 0, 
DISKSIM_GLOBAL_lﬂdîs
, 
DISKSIM_GLOBAL_dïs
 };

47 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_iodriver_param.h

2 #i‚de‡
_DISKSIM_IODRIVER_PARAM_H


3 
	#_DISKSIM_IODRIVER_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
iodrivî
 *
disksim_iodrivî_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_IODRIVER_TYPE
,

16 
DISKSIM_IODRIVER_CONSTANT_ACCESS_TIME
,

17 
DISKSIM_IODRIVER_USE_QUEUEING_IN_SUBSYSTEM
,

18 
DISKSIM_IODRIVER_SCHEDULER


19 } 
	tdisksim_iodrivî_∑øm_t
;

21 
	#DISKSIM_IODRIVER_MAX_PARAM
 
DISKSIM_IODRIVER_SCHEDULER


	)

22 * 
DISKSIM_IODRIVER_lﬂdîs
[];

23 
Õ_∑ømdï_t
 
DISKSIM_IODRIVER_dïs
[];

26 
Õ_v¨•ec
 
	gdisksim_iodrivî_∑øms
 [] = {

27 {"ty≥", 
I
, 1 },

28 {"C⁄°™àac˚s†time", 
D
, 1 },

29 {"U£ queueög i¿subsy°em", 
I
, 1 },

30 {"ScheduÀr", 
BLOCK
, 1 },

33 
	#DISKSIM_IODRIVER_MAX
 4

	)

34 
Õ_mod
 
	gdisksim_iodrivî_mod
 = { "disksim_iodrivî", 
disksim_iodrivî_∑øms
, 
DISKSIM_IODRIVER_MAX
, (
Õ_modlﬂdî_t
)
disksim_iodrivî_lﬂd∑øms
, 0, 0, 
DISKSIM_IODRIVER_lﬂdîs
, 
DISKSIM_IODRIVER_dïs
 };

37 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_iodriver_stats_param.h

2 #i‚de‡
_DISKSIM_IODRIVER_STATS_PARAM_H


3 
	#_DISKSIM_IODRIVER_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_iodrivî_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_SIZE_STATS
,

16 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_LOCALITY_STATS
,

17 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_BLOCKING_STATS
,

18 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTERFERENCE_STATS
,

19 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_QUEUE_STATS
,

20 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_CRIT_STATS
,

21 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_IDLE_STATS
,

22 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTARR_STATS
,

23 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STREAK_STATS
,

24 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STAMP_STATS
,

25 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_PER_DEVICE_STATS


26 } 
	tdisksim_iodrivî_°©s_∑øm_t
;

28 
	#DISKSIM_IODRIVER_STATS_MAX_PARAM
 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_PER_DEVICE_STATS


	)

29 * 
DISKSIM_IODRIVER_STATS_lﬂdîs
[];

30 
Õ_∑ømdï_t
 
DISKSIM_IODRIVER_STATS_dïs
[];

33 
Õ_v¨•ec
 
	gdisksim_iodrivî_°©s_∑øms
 [] = {

34 {"Pröàdrivî sizê°©s", 
I
, 1 },

35 {"PröàdrivîÜoˇlôy sèts", 
I
, 1 },

36 {"Pröàdrivî blockög sèts", 
I
, 1 },

37 {"Pröàdrivî i¡î„ªn˚ sèts", 
I
, 1 },

38 {"Pröàdrivî queuê°©s", 
I
, 1 },

39 {"Pröàdrivî crô sèts", 
I
, 1 },

40 {"Pröàdrivî idÀ sèts", 
I
, 1 },

41 {"Pröàdrivî i¡¨∏°©s", 
I
, 1 },

42 {"Pröàdrivî såók sèts", 
I
, 1 },

43 {"Pröàdrivî sèm∞°©s", 
I
, 1 },

44 {"PröàdrivîÖî-devi˚ sèts", 
I
, 1 },

47 
	#DISKSIM_IODRIVER_STATS_MAX
 11

	)

48 
Õ_mod
 
	gdisksim_iodrivî_°©s_mod
 = { "disksim_iodrivî_°©s", 
disksim_iodrivî_°©s_∑øms
, 
DISKSIM_IODRIVER_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_iodrivî_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_IODRIVER_STATS_lﬂdîs
, 
DISKSIM_IODRIVER_STATS_dïs
 };

51 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_iomap_param.h

2 #i‚de‡
_DISKSIM_IOMAP_PARAM_H


3 
	#_DISKSIM_IOMAP_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_iom≠_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_IOMAP_TRACEDEV
,

16 
DISKSIM_IOMAP_SIMDEV
,

17 
DISKSIM_IOMAP_LOCSCALE
,

18 
DISKSIM_IOMAP_SIZESCALE
,

19 
DISKSIM_IOMAP_OFFSET


20 } 
	tdisksim_iom≠_∑øm_t
;

22 
	#DISKSIM_IOMAP_MAX_PARAM
 
DISKSIM_IOMAP_OFFSET


	)

23 * 
DISKSIM_IOMAP_lﬂdîs
[];

24 
Õ_∑ømdï_t
 
DISKSIM_IOMAP_dïs
[];

27 
Õ_v¨•ec
 
	gdisksim_iom≠_∑øms
 [] = {

28 {"åa˚dev", 
I
, 1 },

29 {"simdev", 
S
, 1 },

30 {"locSˇÀ", 
I
, 1 },

31 {"sizeSˇÀ", 
I
, 1 },

32 {"off£t", 
I
, 0 },

35 
	#DISKSIM_IOMAP_MAX
 5

	)

36 
Õ_mod
 
	gdisksim_iom≠_mod
 = { "disksim_iom≠", 
disksim_iom≠_∑øms
, 
DISKSIM_IOMAP_MAX
, (
Õ_modlﬂdî_t
)
disksim_iom≠_lﬂd∑øms
, 0, 0, 
DISKSIM_IOMAP_lﬂdîs
, 
DISKSIM_IOMAP_dïs
 };

39 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_ioqueue_param.h

2 #i‚de‡
_DISKSIM_IOQUEUE_PARAM_H


3 
	#_DISKSIM_IOQUEUE_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
ioq
 *
disksim_ioqueue_lﬂd∑øms
(
Õ_block
 *
b
, 
¥ötqueue°©s
, 
¥öt¸ô°©s
, 
¥ötidÀ°©s
, 
¥ötöèº°©s
, 
¥ötsize°©s
);

15 
DISKSIM_IOQUEUE_SCHEDULING_POLICY
,

16 
DISKSIM_IOQUEUE_CYLINDER_MAPPING_STRATEGY
,

17 
DISKSIM_IOQUEUE_WRITE_INITIATION_DELAY
,

18 
DISKSIM_IOQUEUE_READ_INITIATION_DELAY
,

19 
DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_SCHEME
,

20 
DISKSIM_IOQUEUE_MAXIMUM_CONCAT_SIZE
,

21 
DISKSIM_IOQUEUE_OVERLAPPING_REQUEST_SCHEME
,

22 
DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_DIFF_MAXIMUM
,

23 
DISKSIM_IOQUEUE_SCHEDULING_TIMEOUT_SCHEME
,

24 
DISKSIM_IOQUEUE_TIMEOUT_TIMEWEIGHT
,

25 
DISKSIM_IOQUEUE_TIMEOUT_SCHEDULING
,

26 
DISKSIM_IOQUEUE_SCHEDULING_PRIORITY_SCHEME
,

27 
DISKSIM_IOQUEUE_PRIORITY_SCHEDULING


28 } 
	tdisksim_ioqueue_∑øm_t
;

30 
	#DISKSIM_IOQUEUE_MAX_PARAM
 
DISKSIM_IOQUEUE_PRIORITY_SCHEDULING


	)

31 * 
DISKSIM_IOQUEUE_lﬂdîs
[];

32 
Õ_∑ømdï_t
 
DISKSIM_IOQUEUE_dïs
[];

35 
Õ_v¨•ec
 
	gdisksim_ioqueue_∑øms
 [] = {

36 {"SchedulögÖﬁicy", 
I
, 1 },

37 {"Cylödî m≠pög så©egy", 
I
, 1 },

38 {"Wrôêöôüti⁄ dñay", 
D
, 1 },

39 {"Ród inôüti⁄ dñay", 
D
, 1 },

40 {"Sequítü»°ªam scheme", 
I
, 1 },

41 {"Maximum c⁄ˇàsize", 
I
, 1 },

42 {"OvîœµögÑeque° scheme", 
I
, 1 },

43 {"Sequítü»°ªam dif‡maximum", 
I
, 1 },

44 {"SchedulögÅimeouàscheme", 
I
, 1 },

45 {"Timeouàtime/weight", 
I
, 1 },

46 {"Timeouàschedulög", 
I
, 1 },

47 {"SchedulögÖri‹ôy scheme", 
I
, 1 },

48 {"Pri‹ôy schedulög", 
I
, 1 },

51 
	#DISKSIM_IOQUEUE_MAX
 13

	)

52 
Õ_mod
 
	gdisksim_ioqueue_mod
 = { "disksim_ioqueue", 
disksim_ioqueue_∑øms
, 
DISKSIM_IOQUEUE_MAX
, (
Õ_modlﬂdî_t
)
disksim_ioqueue_lﬂd∑øms
, 0, 0, 
DISKSIM_IOQUEUE_lﬂdîs
, 
DISKSIM_IOQUEUE_dïs
 };

55 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_iosim_param.h

2 #i‚de‡
_DISKSIM_IOSIM_PARAM_H


3 
	#_DISKSIM_IOSIM_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_iosim_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_IOSIM_IO_TRACE_TIME_SCALE
,

16 
DISKSIM_IOSIM_IO_MAPPINGS


17 } 
	tdisksim_iosim_∑øm_t
;

19 
	#DISKSIM_IOSIM_MAX_PARAM
 
DISKSIM_IOSIM_IO_MAPPINGS


	)

20 * 
DISKSIM_IOSIM_lﬂdîs
[];

21 
Õ_∑ømdï_t
 
DISKSIM_IOSIM_dïs
[];

24 
Õ_v¨•ec
 
	gdisksim_iosim_∑øms
 [] = {

25 {"I/O Tø˚ TimêSˇÀ", 
D
, 0 },

26 {"I/O M≠pögs", 
LIST
, 0 },

29 
	#DISKSIM_IOSIM_MAX
 2

	)

30 
Õ_mod
 
	gdisksim_iosim_mod
 = { "disksim_iosim", 
disksim_iosim_∑øms
, 
DISKSIM_IOSIM_MAX
, (
Õ_modlﬂdî_t
)
disksim_iosim_lﬂd∑øms
, 0, 0, 
DISKSIM_IOSIM_lﬂdîs
, 
DISKSIM_IOSIM_dïs
 };

33 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_logorg_param.h

2 #i‚de‡
_DISKSIM_LOGORG_PARAM_H


3 
	#_DISKSIM_LOGORG_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
log‹g
 *
disksim_log‹g_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_LOGORG_ADDRESSING_MODE
,

16 
DISKSIM_LOGORG_DISTRIBUTION_SCHEME
,

17 
DISKSIM_LOGORG_REDUNDANCY_SCHEME
,

18 
DISKSIM_LOGORG_COMPONENTS
,

19 
DISKSIM_LOGORG_DEVICES
,

20 
DISKSIM_LOGORG_STRIPE_UNIT
,

21 
DISKSIM_LOGORG_SYNCH_WRITES_FOR_SAFETY
,

22 
DISKSIM_LOGORG_NUMBER_OF_COPIES
,

23 
DISKSIM_LOGORG_COPY_CHOICE_ON_READ
,

24 
DISKSIM_LOGORG_RMW_VS_RECONSTRUCT
,

25 
DISKSIM_LOGORG_PARITY_STRIPE_UNIT
,

26 
DISKSIM_LOGORG_PARITY_ROTATION_TYPE
,

27 
DISKSIM_LOGORG_TIME_STAMP_INTERVAL
,

28 
DISKSIM_LOGORG_TIME_STAMP_START_TIME
,

29 
DISKSIM_LOGORG_TIME_STAMP_STOP_TIME
,

30 
DISKSIM_LOGORG_TIME_STAMP_FILE_NAME


31 } 
	tdisksim_log‹g_∑øm_t
;

33 
	#DISKSIM_LOGORG_MAX_PARAM
 
DISKSIM_LOGORG_TIME_STAMP_FILE_NAME


	)

34 * 
DISKSIM_LOGORG_lﬂdîs
[];

35 
Õ_∑ømdï_t
 
DISKSIM_LOGORG_dïs
[];

38 
Õ_v¨•ec
 
	gdisksim_log‹g_∑øms
 [] = {

39 {"Addªssög mode", 
S
, 1 },

40 {"Di°ributi⁄ scheme", 
S
, 1 },

41 {"Redund™cy scheme", 
S
, 1 },

42 {"Comp⁄íts", 
S
, 0 },

43 {"devi˚s", 
LIST
, 1 },

44 {"Såùêunô", 
I
, 1 },

45 {"Synch wrôe†f‹ sa„ty", 
I
, 1 },

46 {"Numbî o‡c›õs", 
I
, 1 },

47 {"C›y choi˚ o¿ªad", 
I
, 1 },

48 {"RMW vs.Ñec⁄°ru˘", 
D
, 1 },

49 {"P¨ôy såùêunô", 
I
, 1 },

50 {"P¨ôyÑŸ©i⁄Åy≥", 
I
, 1 },

51 {"Timê°am∞öãrvÆ", 
D
, 0 },

52 {"Timê°am∞°¨àtime", 
D
, 0 },

53 {"Timê°am∞°›Åime", 
D
, 0 },

54 {"Timê°am∞fûê«me", 
S
, 0 },

57 
	#DISKSIM_LOGORG_MAX
 16

	)

58 
Õ_mod
 
	gdisksim_log‹g_mod
 = { "disksim_log‹g", 
disksim_log‹g_∑øms
, 
DISKSIM_LOGORG_MAX
, (
Õ_modlﬂdî_t
)
disksim_log‹g_lﬂd∑øms
, 0, 0, 
DISKSIM_LOGORG_lﬂdîs
, 
DISKSIM_LOGORG_dïs
 };

61 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_pf_param.h

2 #i‚de‡
_DISKSIM_PF_PARAM_H


3 
	#_DISKSIM_PF_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_pf_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_PF_NUMBER_OF_PROCESSORS
,

16 
DISKSIM_PF_PROCESS_FLOW_TIME_SCALE


17 } 
	tdisksim_pf_∑øm_t
;

19 
	#DISKSIM_PF_MAX_PARAM
 
DISKSIM_PF_PROCESS_FLOW_TIME_SCALE


	)

20 * 
DISKSIM_PF_lﬂdîs
[];

21 
Õ_∑ømdï_t
 
DISKSIM_PF_dïs
[];

24 
Õ_v¨•ec
 
	gdisksim_pf_∑øms
 [] = {

25 {"Numbî o‡¥o˚ss‹s", 
I
, 1 },

26 {"Pro˚ss-Flow TimêSˇÀ", 
D
, 1 },

29 
	#DISKSIM_PF_MAX
 2

	)

30 
Õ_mod
 
	gdisksim_pf_mod
 = { "disksim_pf", 
disksim_pf_∑øms
, 
DISKSIM_PF_MAX
, (
Õ_modlﬂdî_t
)
disksim_pf_lﬂd∑øms
, 0, 0, 
DISKSIM_PF_lﬂdîs
, 
DISKSIM_PF_dïs
 };

33 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_pf_stats_param.h

2 #i‚de‡
_DISKSIM_PF_STATS_PARAM_H


3 
	#_DISKSIM_PF_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_pf_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_PF_STATS_PRINT_PER_PROCESS_STATS
,

16 
DISKSIM_PF_STATS_PRINT_PER_CPU_STATS
,

17 
DISKSIM_PF_STATS_PRINT_ALL_INTERRUPT_STATS
,

18 
DISKSIM_PF_STATS_PRINT_SLEEP_STATS


19 } 
	tdisksim_pf_°©s_∑øm_t
;

21 
	#DISKSIM_PF_STATS_MAX_PARAM
 
DISKSIM_PF_STATS_PRINT_SLEEP_STATS


	)

22 * 
DISKSIM_PF_STATS_lﬂdîs
[];

23 
Õ_∑ømdï_t
 
DISKSIM_PF_STATS_dïs
[];

26 
Õ_v¨•ec
 
	gdisksim_pf_°©s_∑øms
 [] = {

27 {"Pröà≥r-¥o˚s†°©s", 
I
, 1 },

28 {"Pröà≥r-CPU sèts", 
I
, 1 },

29 {"PröàÆ»öãºu± sèts", 
I
, 1 },

30 {"Pröà¶ì∞°©s", 
I
, 1 },

33 
	#DISKSIM_PF_STATS_MAX
 4

	)

34 
Õ_mod
 
	gdisksim_pf_°©s_mod
 = { "disksim_pf_°©s", 
disksim_pf_°©s_∑øms
, 
DISKSIM_PF_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_pf_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_PF_STATS_lﬂdîs
, 
DISKSIM_PF_STATS_dïs
 };

37 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_simpledisk_param.h

2 #i‚de‡
_DISKSIM_SIMPLEDISK_PARAM_H


3 
	#_DISKSIM_SIMPLEDISK_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
sim∂edisk
 *
disksim_sim∂edisk_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_SIMPLEDISK_SCHEDULER
,

16 
DISKSIM_SIMPLEDISK_MAX_QUEUE_LENGTH
,

17 
DISKSIM_SIMPLEDISK_BLOCK_COUNT
,

18 
DISKSIM_SIMPLEDISK_BUS_TRANSACTION_LATENCY
,

19 
DISKSIM_SIMPLEDISK_BULK_SECTOR_TRANSFER_TIME
,

20 
DISKSIM_SIMPLEDISK_NEVER_DISCONNECT
,

21 
DISKSIM_SIMPLEDISK_PRINT_STATS
,

22 
DISKSIM_SIMPLEDISK_COMMAND_OVERHEAD
,

23 
DISKSIM_SIMPLEDISK_CONSTANT_ACCESS_TIME
,

24 
DISKSIM_SIMPLEDISK_ACCESS_TIME


25 } 
	tdisksim_sim∂edisk_∑øm_t
;

27 
	#DISKSIM_SIMPLEDISK_MAX_PARAM
 
DISKSIM_SIMPLEDISK_ACCESS_TIME


	)

28 * 
DISKSIM_SIMPLEDISK_lﬂdîs
[];

29 
Õ_∑ømdï_t
 
DISKSIM_SIMPLEDISK_dïs
[];

32 
Õ_v¨•ec
 
	gdisksim_sim∂edisk_∑øms
 [] = {

33 {"ScheduÀr", 
BLOCK
, 1 },

34 {"Max queuêÀngth", 
I
, 1 },

35 {"Block cou¡", 
I
, 1 },

36 {"Bu†å™ß˘i⁄Ü©ícy", 
D
, 0 },

37 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

38 {"Nevî disc⁄√˘", 
I
, 1 },

39 {"Pröà°©s", 
I
, 1 },

40 {"Comm™d ovîhód", 
D
, 1 },

41 {"C⁄°™àac˚s†time", 
D
, 0 },

42 {"Ac˚s†time", 
D
, 1 },

45 
	#DISKSIM_SIMPLEDISK_MAX
 10

	)

46 
Õ_mod
 
	gdisksim_sim∂edisk_mod
 = { "disksim_sim∂edisk", 
disksim_sim∂edisk_∑øms
, 
DISKSIM_SIMPLEDISK_MAX
, (
Õ_modlﬂdî_t
)
disksim_sim∂edisk_lﬂd∑øms
, 0, 0, 
DISKSIM_SIMPLEDISK_lﬂdîs
, 
DISKSIM_SIMPLEDISK_dïs
 };

49 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_stats_param.h

2 #i‚de‡
_DISKSIM_STATS_PARAM_H


3 
	#_DISKSIM_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_STATS_IODRIVER_STATS
,

16 
DISKSIM_STATS_BUS_STATS
,

17 
DISKSIM_STATS_CTLR_STATS
,

18 
DISKSIM_STATS_DEVICE_STATS
,

19 
DISKSIM_STATS_PROCESS_FLOW_STATS


20 } 
	tdisksim_°©s_∑øm_t
;

22 
	#DISKSIM_STATS_MAX_PARAM
 
DISKSIM_STATS_PROCESS_FLOW_STATS


	)

23 * 
DISKSIM_STATS_lﬂdîs
[];

24 
Õ_∑ømdï_t
 
DISKSIM_STATS_dïs
[];

27 
Õ_v¨•ec
 
	gdisksim_°©s_∑øms
 [] = {

28 {"iodrivî sèts", 
BLOCK
, 1 },

29 {"bu†°©s", 
BLOCK
, 1 },

30 {"˘Ã sèts", 
BLOCK
, 1 },

31 {"devi˚ sèts", 
BLOCK
, 1 },

32 {"¥o˚s†Êow sèts", 
BLOCK
, 1 },

35 
	#DISKSIM_STATS_MAX
 5

	)

36 
Õ_mod
 
	gdisksim_°©s_mod
 = { "disksim_°©s", 
disksim_°©s_∑øms
, 
DISKSIM_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_STATS_lﬂdîs
, 
DISKSIM_STATS_dïs
 };

39 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_syncset_param.h

2 #i‚de‡
_DISKSIM_SYNCSET_PARAM_H


3 
	#_DISKSIM_SYNCSET_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_sync£t_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_SYNCSET_TYPE
,

16 
DISKSIM_SYNCSET_DEVICES


17 } 
	tdisksim_sync£t_∑øm_t
;

19 
	#DISKSIM_SYNCSET_MAX_PARAM
 
DISKSIM_SYNCSET_DEVICES


	)

20 * 
DISKSIM_SYNCSET_lﬂdîs
[];

21 
Õ_∑ømdï_t
 
DISKSIM_SYNCSET_dïs
[];

24 
Õ_v¨•ec
 
	gdisksim_sync£t_∑øms
 [] = {

25 {"ty≥", 
S
, 1 },

26 {"devi˚s", 
LIST
, 1 },

29 
	#DISKSIM_SYNCSET_MAX
 2

	)

30 
Õ_mod
 
	gdisksim_sync£t_mod
 = { "disksim_sync£t", 
disksim_sync£t_∑øms
, 
DISKSIM_SYNCSET_MAX
, (
Õ_modlﬂdî_t
)
disksim_sync£t_lﬂd∑øms
, 0, 0, 
DISKSIM_SYNCSET_lﬂdîs
, 
DISKSIM_SYNCSET_dïs
 };

33 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_synthgen_param.h

2 #i‚de‡
_DISKSIM_SYNTHGEN_PARAM_H


3 
	#_DISKSIM_SYNTHGEN_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_sy¡hgí_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_SYNTHGEN_STORAGE_CAPACITY_PER_DEVICE
,

16 
DISKSIM_SYNTHGEN_DEVICES
,

17 
DISKSIM_SYNTHGEN_BLOCKING_FACTOR
,

18 
DISKSIM_SYNTHGEN_PROBABILITY_OF_SEQUENTIAL_ACCESS
,

19 
DISKSIM_SYNTHGEN_PROBABILITY_OF_LOCAL_ACCESS
,

20 
DISKSIM_SYNTHGEN_PROBABILITY_OF_READ_ACCESS
,

21 
DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_CRITICAL_REQUEST
,

22 
DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_LIMITED_REQUEST
,

23 
DISKSIM_SYNTHGEN_TIME_LIMITED_THINK_TIMES
,

24 
DISKSIM_SYNTHGEN_GENERAL_INTER_ARRIVAL_TIMES
,

25 
DISKSIM_SYNTHGEN_SEQUENTIAL_INTER_ARRIVAL_TIMES
,

26 
DISKSIM_SYNTHGEN_LOCAL_INTER_ARRIVAL_TIMES
,

27 
DISKSIM_SYNTHGEN_LOCAL_DISTANCES
,

28 
DISKSIM_SYNTHGEN_SIZES


29 } 
	tdisksim_sy¡hgí_∑øm_t
;

31 
	#DISKSIM_SYNTHGEN_MAX_PARAM
 
DISKSIM_SYNTHGEN_SIZES


	)

32 * 
DISKSIM_SYNTHGEN_lﬂdîs
[];

33 
Õ_∑ømdï_t
 
DISKSIM_SYNTHGEN_dïs
[];

36 
Õ_v¨•ec
 
	gdisksim_sy¡hgí_∑øms
 [] = {

37 {"St‹agêˇ∑côyÖî devi˚", 
I
, 1 },

38 {"devi˚s", 
LIST
, 1 },

39 {"Blockög fa˘‹", 
I
, 1 },

40 {"Probabûôy o‡£quítü»ac˚ss", 
D
, 1 },

41 {"Probabûôy o‡loˇ»ac˚ss", 
D
, 1 },

42 {"Probabûôy o‡ªadác˚ss", 
D
, 1 },

43 {"Probabûôy o‡time-¸ôiˇ»ªque°", 
D
, 1 },

44 {"Probabûôy o‡time-limôedÑeque°", 
D
, 1 },

45 {"Time-limôedÅhökÅimes", 
LIST
, 1 },

46 {"GíîÆ i¡î-¨rivÆÅimes", 
LIST
, 1 },

47 {"Sequítü»öãr-¨rivÆÅimes", 
LIST
, 1 },

48 {"Loˇ»öãr-¨rivÆÅimes", 
LIST
, 1 },

49 {"Loˇ»di°™˚s", 
LIST
, 1 },

50 {"Sizes", 
LIST
, 1 },

53 
	#DISKSIM_SYNTHGEN_MAX
 14

	)

54 
Õ_mod
 
	gdisksim_sy¡hgí_mod
 = { "disksim_sy¡hgí", 
disksim_sy¡hgí_∑øms
, 
DISKSIM_SYNTHGEN_MAX
, (
Õ_modlﬂdî_t
)
disksim_sy¡hgí_lﬂd∑øms
, 0, 0, 
DISKSIM_SYNTHGEN_lﬂdîs
, 
DISKSIM_SYNTHGEN_dïs
 };

57 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_synthio_param.h

2 #i‚de‡
_DISKSIM_SYNTHIO_PARAM_H


3 
	#_DISKSIM_SYNTHIO_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_sy¡hio_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_SYNTHIO_NUMBER_OF_IO_REQUESTS_TO_GENERATE
,

16 
DISKSIM_SYNTHIO_MAXIMUM_TIME_OF_TRACE_GENERATED
,

17 
DISKSIM_SYNTHIO_SYSTEM_CALLRETURN_WITH_EACH_REQUEST
,

18 
DISKSIM_SYNTHIO_THINK_TIME_FROM_CALL_TO_REQUEST
,

19 
DISKSIM_SYNTHIO_THINK_TIME_FROM_REQUEST_TO_RETURN
,

20 
DISKSIM_SYNTHIO_GENERATORS


21 } 
	tdisksim_sy¡hio_∑øm_t
;

23 
	#DISKSIM_SYNTHIO_MAX_PARAM
 
DISKSIM_SYNTHIO_GENERATORS


	)

24 * 
DISKSIM_SYNTHIO_lﬂdîs
[];

25 
Õ_∑ømdï_t
 
DISKSIM_SYNTHIO_dïs
[];

28 
Õ_v¨•ec
 
	gdisksim_sy¡hio_∑øms
 [] = {

29 {"Numbî o‡I/OÑeque°†tÿgíî©e", 
I
, 1 },

30 {"MaximumÅimêo‡åa˚ gíî©ed", 
D
, 1 },

31 {"Sy°em cÆl/ªtu∫ wôhÉachÑeque°", 
I
, 1 },

32 {"ThökÅimê‰om cÆ»tÿªque°", 
D
, 1 },

33 {"ThökÅimê‰omÑeque°Åÿªtu∫", 
D
, 1 },

34 {"Gíî©‹s", 
LIST
, 1 },

37 
	#DISKSIM_SYNTHIO_MAX
 6

	)

38 
Õ_mod
 
	gdisksim_sy¡hio_mod
 = { "disksim_sy¡hio", 
disksim_sy¡hio_∑øms
, 
DISKSIM_SYNTHIO_MAX
, (
Õ_modlﬂdî_t
)
disksim_sy¡hio_lﬂd∑øms
, 0, 0, 
DISKSIM_SYNTHIO_lﬂdîs
, 
DISKSIM_SYNTHIO_dïs
 };

41 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/modules.h

2 #i‚de‡
_DISKSIM_MODULES_H


3 
	#_DISKSIM_MODULES_H


	)

6 
	~"disksim_bus_∑øm.h
"

7 
	~"disksim_bus_°©s_∑øm.h
"

8 
	~"disksim_ˇchedev_∑øm.h
"

9 
	~"disksim_ˇchemem_∑øm.h
"

10 
	~"disksim_˘Ã_∑øm.h
"

11 
	~"disksim_˘Ã_°©s_∑øm.h
"

12 
	~"disksim_devi˚_∑øm.h
"

13 
	~"disksim_devi˚_°©s_∑øm.h
"

14 
	~"disksim_disk_∑øm.h
"

15 
	~"disksim_f˛_∑øm.h
"

16 
	~"disksim_globÆ_∑øm.h
"

17 
	~"disksim_iodrivî_∑øm.h
"

18 
	~"disksim_iodrivî_°©s_∑øm.h
"

19 
	~"disksim_iom≠_∑øm.h
"

20 
	~"disksim_ioqueue_∑øm.h
"

21 
	~"disksim_iosim_∑øm.h
"

22 
	~"disksim_log‹g_∑øm.h
"

23 
	~"disksim_pf_∑øm.h
"

24 
	~"disksim_pf_°©s_∑øm.h
"

25 
	~"disksim_sim∂edisk_∑øm.h
"

26 
	~"disksim_°©s_∑øm.h
"

27 
	~"disksim_sync£t_∑øm.h
"

28 
	~"disksim_sy¡hgí_∑øm.h
"

29 
	~"disksim_sy¡hio_∑øm.h
"

32 
Õ_mod
 *
	gdisksim_mods
[] = {

33 &
disksim_bus_mod
 ,

34 &
disksim_bus_°©s_mod
 ,

35 &
disksim_ˇchedev_mod
 ,

36 &
disksim_ˇchemem_mod
 ,

37 &
disksim_˘Ã_mod
 ,

38 &
disksim_˘Ã_°©s_mod
 ,

39 &
disksim_devi˚_mod
 ,

40 &
disksim_devi˚_°©s_mod
 ,

41 &
disksim_disk_mod
 ,

42 &
disksim_f˛_mod
 ,

43 &
disksim_globÆ_mod
 ,

44 &
disksim_iodrivî_mod
 ,

45 &
disksim_iodrivî_°©s_mod
 ,

46 &
disksim_iom≠_mod
 ,

47 &
disksim_ioqueue_mod
 ,

48 &
disksim_iosim_mod
 ,

49 &
disksim_log‹g_mod
 ,

50 &
disksim_pf_mod
 ,

51 &
disksim_pf_°©s_mod
 ,

52 &
disksim_sim∂edisk_mod
 ,

53 &
disksim_°©s_mod
 ,

54 &
disksim_sync£t_mod
 ,

55 &
disksim_sy¡hgí_mod
 ,

56 &
disksim_sy¡hio_mod


60 
	mDISKSIM_MOD_BUS
,

61 
	mDISKSIM_MOD_BUS_STATS
,

62 
	mDISKSIM_MOD_CACHEDEV
,

63 
	mDISKSIM_MOD_CACHEMEM
,

64 
	mDISKSIM_MOD_CTLR
,

65 
	mDISKSIM_MOD_CTLR_STATS
,

66 
	mDISKSIM_MOD_DEVICE
,

67 
	mDISKSIM_MOD_DEVICE_STATS
,

68 
	mDISKSIM_MOD_DISK
,

69 
	mDISKSIM_MOD_FCL
,

70 
	mDISKSIM_MOD_GLOBAL
,

71 
	mDISKSIM_MOD_IODRIVER
,

72 
	mDISKSIM_MOD_IODRIVER_STATS
,

73 
	mDISKSIM_MOD_IOMAP
,

74 
	mDISKSIM_MOD_IOQUEUE
,

75 
	mDISKSIM_MOD_IOSIM
,

76 
	mDISKSIM_MOD_LOGORG
,

77 
	mDISKSIM_MOD_PF
,

78 
	mDISKSIM_MOD_PF_STATS
,

79 
	mDISKSIM_MOD_SIMPLEDISK
,

80 
	mDISKSIM_MOD_STATS
,

81 
	mDISKSIM_MOD_SYNCSET
,

82 
	mDISKSIM_MOD_SYNTHGEN
,

83 
	mDISKSIM_MOD_SYNTHIO


84 } 
	tdisksim_mod_t
;

86 
	#DISKSIM_MAX_MODULE
 23

	)

	@/Users/ysoh/disksim-4.0-fcl/include/disksim_interface.h

32 #i‚de‡
_DISKSIM_INTERFACE_H


33 
	#_DISKSIM_INTERFACE_H


	)

35 #ifde‡
__˝lu•lus


41 
	~"disksim_ªqÊags.h
"

44 
	sdisksim_ªque°
 {

45 
Êags
;

46 
devno
;

47 
blkno
;

48 
byãcou¡
;

49 
°¨t
;

50 
b©chno
;

51 
b©ch_com∂ëe
;

52 *
ªq˘x
;

55 
disksim_öãrÁ˚
;

58 (*
disksim_öãrÁ˚_com∂ëe_t
)(
	ttime
,

59 
	tdisksim_ªque°
 *,

60 *
	t˘x
);

63 (*
disksim_öãrÁ˚_ˇŒback_t
)(
	tdisksim_öãrÁ˚
 *,

64 
	tt
,

65 *
	t˘x
);

70 (*
disksim_öãrÁ˚_sched_t
)(
	tdisksim_öãrÁ˚_ˇŒback_t
 
	t‚
,

72 *
	t˘x
);

75 (*
disksim_öãrÁ˚_desched_t
)(
	tt
, *
	t˘x
);

82 
disksim_öãrÁ˚
 *

83 
disksim_öãrÁ˚_öôülize
 (c⁄° *
pfûe
,

84 c⁄° *
ofûe
,

85 
disksim_öãrÁ˚_com∂ëe_t
,

86 
disksim_öãrÁ˚_sched_t
,

87 
disksim_öãrÁ˚_desched_t
,

88 *
˘x
,

89 
¨gc
,

90 **
¨gv
);

94 
disksim_öãrÁ˚_shutdown
 (
disksim_öãrÁ˚
 *,

95 
syssimtime
);

97 
disksim_öãrÁ˚_dump_°©s
 (
disksim_öãrÁ˚
 *,

98 
syssimtime
);

103 
disksim_öãrÁ˚_öã∫Æ_evít
 (
disksim_öãrÁ˚
 *,

104 
t
,

105 *
junk
);

109 
disksim_öãrÁ˚_ªque°_¨rive
 (
disksim_öãrÁ˚
 *,

110 
syssimtime
,

111 
disksim_ªque°
 *
ªque°desc
);

114 
disksim_‰ì_disksim
(
disksim_öãrÁ˚
 *
d
);

118 
disksim_time_to_m£c
();

119 
disksim_time_‰om_m£c
();

122 
dm_disk_if
 *

123 
disksim_gëdiskmodñ
(
disksim_öãrÁ˚
 *, );

125 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/libddbg/ddbg_assert.c

33 
	~<°d¨g.h
>

34 
	~"libddbg.h
"

36 #i‚de‡
_LIBDDBG_FREEBSD


38 
	~<sig«l.h
>

39 
	~<°dio.h
>

41 
	$Áû
() {

42 
	`øi£
(
SIGABRT
);

43 
	}
}

46 
FILE
 *
	gddbg_fûe
 = 0;

47 
ddbg_as£π_h™dÀr
 
	gddbg_h™dÀr
 = (ddbg_as£π_h™dÀr)
Áû
;

49 
	$ddbg_as£π_£tfûe
(
FILE
 *
f
) {

50 
ddbg_fûe
 = 
f
;

51 
	}
}

53 
	$ddbg_as£π_¥ötmsg
(c⁄° *
fmt
, ...) {

54 
va_li°
 
≠
;

55 if(
ddbg_fûe
) {

56 
	`va_°¨t
(
≠
, 
fmt
);

57 
	`vÂrötf
(
ddbg_fûe
, 
fmt
, 
≠
);

59 
	}
}

64 
	~<sy¶og.h
>

66 
	$ddbg_kîn_log
(*
fûe
,

67 
löe
,

68 c⁄° *
c⁄d
,

69 c⁄° *
func
,

70 c⁄° *
fmt
, ...)

72 
buff
[1024];

73 
va_li°
 
≠
;

75 
	`va_°¨t
(
≠
, 
fmt
);

76 
	`v¢¥ötf
(
buff
, 1024, 
fmt
, 
≠
);

77 
	`va_íd
(
≠
);

79 
	`log
(
LOG_ALERT
, 
buff
);

80 
	}
}

82 
	$ddbg_as£π_¥ötmsg
(c⁄° *
fmt
, ...)

84 
buff
[1024];

85 
va_li°
 
≠
;

87 
	`va_°¨t
(
≠
, 
fmt
);

88 
	`v¢¥ötf
(
buff
, 1024, 
fmt
, 
≠
);

89 
	`va_íd
(
≠
);

91 
	`log
(
LOG_ALERT
, 
buff
);

92 
	}
}

95 
ddbg_as£π_h™dÀr
 
	gddbg_h™dÀr
 = (ddbg_as£π_h™dÀr)
ddbg_kîn_log
;

100 
	$ddbg_as£π_£th™dÀr
(
ddbg_as£π_h™dÀr
 
h
) {

101 
ddbg_h™dÀr
 = 
h
;

102 
	}
}

105 
	$ddbg_as£π_msg
(*
fûe
,

106 
löe
,

107 c⁄° *
c⁄d
,

108 c⁄° *
func
,

109 c⁄° *
fmt
, ...)

111 
va_li°
 
≠
;

113 #i‚de‡
_LIBDDBG_FREEBSD


114 if(
ddbg_fûe
) {

115 
	`Ârötf
(
ddbg_fûe
, "***ás£πi⁄ faûed: i¿%s(Ë(%s:%d): %s: ", 
func
, 
fûe
, 
löe
, 
c⁄d
);

120 
	`ddbg_as£π_¥ötmsg
(
fmt
, 
≠
);

125 
	}
}

128 
	$ddbg_as£π_Áû
(*
fûe
,

129 
löe
,

130 c⁄° *
c⁄d
,

131 c⁄° *
func
,

132 c⁄° *
fmt
, ...)

134 
va_li°
 
≠
;

136 #i‚de‡
_LIBDDBG_FREEBSD


137 if(
ddbg_fûe
) {

138 
	`Ârötf
(
ddbg_fûe
, "\n");

139 
	`fÊush
(
ddbg_fûe
);

143 if(
ddbg_h™dÀr
) {

144 
	`va_°¨t
(
≠
, 
fmt
);

145 
	`ddbg_h™dÀr
(
fûe
,
löe
,
c⁄d
,
func
,
fmt
,
≠
);

147 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/libddbg/ddbg_trace.c

63 
	~<°d¨g.h
>

64 
	~<°dlib.h
>

65 
	~<°rög.h
>

68 
	~"libddbg.h
"

69 
	~<bôve˘‹.h
>

71 
	sddbg_˛ass
 {

72 *
	m«me
;

73 
BITVECTOR
(
ö°™˚s
, 
DDBG_MAX_INSTANCE
);

76 
ddbg_˛ass
 *
	gddbg_˛as£s
 = 0;

77 
	gddbg_˛as£s_Àn
 = 0;

78 
	gddbg_˛ass_max
 = 0;

79 
FILE
 *
	gddbg_åa˚fûe
 = 0;

83 
	$ddbg_ªgi°î
(*
˛as¢ame
) {

85 if(
ddbg_˛ass_max
 < 
ddbg_˛as£s_Àn
) {

86 
found
;

89 
ddbg_˛as£s_Àn
 *= 2;

90 
ddbg_˛as£s_Àn
++;

91 
ddbg_˛as£s
 = 
	`ªÆloc
(ddbg_˛as£s, 
ddbg_˛as£s_Àn
 * (
ddbg_˛ass
));

93 
found
:

94 
ddbg_˛as£s
[
ddbg_˛ass_max
].
«me
 = 
	`°rdup
(
˛as¢ame
);

95 
	`bô_zîo
(
ddbg_˛as£s
[
ddbg_˛ass_max
].
ö°™˚s
, 
DDBG_MAX_INSTANCE
);

96 
ddbg_˛ass_max
++;

98  
ddbg_˛ass_max
 - 1;

99 
	}
}

103 
	$ddbg_íabÀ
(
˛ass
, 
ö°™˚
) {

104 
	`ddbg_as£π
(
˛ass
 < 
ddbg_˛ass_max
);

105 
	`ddbg_as£π
((
ö°™˚
 < 
DDBG_MAX_INSTANCE
) || (instance == -1));

106 if(
ö°™˚
 != -1) {

107 
	`BIT_SET
(
ddbg_˛as£s
[
˛ass
].
ö°™˚s
, 
ö°™˚
);

110 
	`bô_£èŒ
(
ddbg_˛as£s
[
˛ass
].
ö°™˚s
, 
DDBG_MAX_INSTANCE
);

112 
	}
}

116 
	$ddbg_dißbÀ
(
˛ass
, 
ö°™˚
) {

117 
	`ddbg_as£π
(
˛ass
 < 
ddbg_˛ass_max
);

118 
	`ddbg_as£π
((
ö°™˚
 < 
DDBG_MAX_INSTANCE
) || (instance == -1));

119 if(
ö°™˚
 != -1) {

120 
	`BIT_RESET
(
ddbg_˛as£s
[
˛ass
].
ö°™˚s
, 
ö°™˚
);

123 
	`bô_zîo
(
ddbg_˛as£s
[
˛ass
].
ö°™˚s
, 
DDBG_MAX_INSTANCE
);

125 
	}
}

129 
	$ddbg_åa˚
(
˛ass
, 
ö°™˚
, *
fmt
, ...)

131 
	`ddbg_as£π
(
˛ass
 < 
ddbg_˛ass_max
);

132 
	`ddbg_as£π
(
ö°™˚
 < 
DDBG_MAX_INSTANCE
);

134 #i‚de‡
_LIBDDBG_FREEBSD


136 if(
	`BIT_TEST
(
ddbg_˛as£s
[
˛ass
].
ö°™˚s
, 
ö°™˚
Ë&& 
ddbg_åa˚fûe
) {

137 
va_li°
 
≠
;

139 
	`Ârötf
(
ddbg_åa˚fûe
, "(%s,%d): ", 
ddbg_˛as£s
[
˛ass
].
«me
, 
ö°™˚
);

141 
	`va_°¨t
(
≠
, 
fmt
);

142 
	`vÂrötf
(
ddbg_åa˚fûe
, 
fmt
, 
≠
);

144 
	`Ârötf
(
ddbg_åa˚fûe
, "\n");

147 
	}
}

152 
	$ddbg_£tfûe
(
FILE
 *
f
) {

153 
ddbg_åa˚fûe
 = 
f
;

154 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/libddbg/include/libddbg/libddbg.h

33 #i‚de‡
_LIBTRACE_LIBTRACE_H


34 
	#_LIBTRACE_LIBTRACE_H


	)

36 #ifde‡
__˝lu•lus


40 
	~<°dio.h
>

43 
ddbg_£tup
(
FILE
 *);

47 
ddbg_ªgi°î
(*
˛as¢ame
);

51 
ddbg_íabÀ
(
d˛ass
, 
ö°™˚
);

55 
ddbg_dißbÀ
(
d˛ass
, 
ö°™˚
);

57 
ddbg_åa˚
(
d˛ass
, 
ö°™˚
, *
fmt
, ...);

61 
ddbg_£tfûe
(
FILE
 *);

63 
	#DDBG_MAX_INSTANCE
 256

	)

77 
ddbg_as£π_£tfûe
(
FILE
 *);

79 (*
ddbg_as£π_h™dÀr
)(*
	tfûe
,

80 
	tlöe
,

81 c⁄° *
	tc⁄d
,

82 c⁄° *
	tfunc
,

83 c⁄° *
	tfmt
, ...);

85 
ddbg_as£π_£th™dÀr
(
ddbg_as£π_h™dÀr
);

86 
ddbg_as£π_msg
(*
fûe
,

87 
löe
,

88 c⁄° *
c⁄d
,

89 c⁄° *
func
,

90 c⁄° *
fmt
, ...);

92 
ddbg_as£π_Áû
(*
fûe
,

93 
löe
,

94 c⁄° *
c⁄d
,

95 c⁄° *
func
,

96 c⁄° *
fmt
, ...);

100 
ddbg_as£π_¥ötmsg
(c⁄° *
fmt
, ...);

106 #ifde‡
__GNUC__


108 #i‡
__GNUC__
 > 2 || (__GNUC__ == 2 \

109 && 
__GNUC_MINOR__
 >(
deföed
 
__˝lu•lus
 ? 6 : 4))

110 
	#__func__
 
__PRETTY_FUNCTION__


	)

112 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

117 
	#__func__
 ((c⁄° *)0)

	)

123 #i‚de‡
_DDBG_DISABLE_ASSERTIONS


124 
	#ddbg_as£π
(
c⁄d
Ëdÿ{ 
_…as£π_c⁄d
 = ()(cond); \

125 if(!
_…as£π_c⁄d
) { \

126 
	`ddbg_as£π_msg
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, ""); \

127 
	`ddbg_as£π_Áû
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, ""); \

128 } } 0)

	)

130 
	#ddbg_as£π
(
c⁄d
)

	)

134 #i‚de‡
_DDBG_DISABLE_ASSERTIONS


135 
	#ddbg_as£π2
(
c⁄d
,
fmt
Ëdÿ{ 
_…as£π_c⁄d
 = ()(cond); \

136 if(!
_…as£π_c⁄d
) { \

137 
	`ddbg_as£π_msg
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, 
fmt
); \

138 
	`ddbg_as£π_Áû
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, 
fmt
); \

139 } } 0)

	)

141 
	#ddbg_as£π2
(
x
,
y
)

	)

149 #i‚de‡
_DDBG_DISABLE_ASSERTIONS


150 
	#ddbg_as£π3
(
c⁄d
,
msg
Ëdÿ{ 
_…as£π_c⁄d
 = ()(cond);\

151 if(!
_…as£π_c⁄d
) { \

152 
	`ddbg_as£π_msg
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, ""); \

153 
ddbg_as£π_¥ötmsg
 
msg
; \

154 
	`ddbg_as£π_Áû
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, ""); \

155 } } 0)

	)

157 
	#ddbg_as£π3
(
x
,
y
)

	)

163 #i‡
__STDC_VERSION__
 >= 199901L

166 
	#ddbg_as£π4
(
c⁄d
,
fmt
,...Ë((c⁄dË? 0 : 
	`ddbg_as£π_msg
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, fmt, 
__VA_ARGS__
))

	)

171 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/libddbg/libddbg.h

33 #i‚de‡
_LIBTRACE_LIBTRACE_H


34 
	#_LIBTRACE_LIBTRACE_H


	)

36 #ifde‡
__˝lu•lus


40 
	~<°dio.h
>

43 
ddbg_£tup
(
FILE
 *);

47 
ddbg_ªgi°î
(*
˛as¢ame
);

51 
ddbg_íabÀ
(
d˛ass
, 
ö°™˚
);

55 
ddbg_dißbÀ
(
d˛ass
, 
ö°™˚
);

57 
ddbg_åa˚
(
d˛ass
, 
ö°™˚
, *
fmt
, ...);

61 
ddbg_£tfûe
(
FILE
 *);

63 
	#DDBG_MAX_INSTANCE
 256

	)

77 
ddbg_as£π_£tfûe
(
FILE
 *);

79 (*
ddbg_as£π_h™dÀr
)(*
	tfûe
,

80 
	tlöe
,

81 c⁄° *
	tc⁄d
,

82 c⁄° *
	tfunc
,

83 c⁄° *
	tfmt
, ...);

85 
ddbg_as£π_£th™dÀr
(
ddbg_as£π_h™dÀr
);

86 
ddbg_as£π_msg
(*
fûe
,

87 
löe
,

88 c⁄° *
c⁄d
,

89 c⁄° *
func
,

90 c⁄° *
fmt
, ...);

92 
ddbg_as£π_Áû
(*
fûe
,

93 
löe
,

94 c⁄° *
c⁄d
,

95 c⁄° *
func
,

96 c⁄° *
fmt
, ...);

100 
ddbg_as£π_¥ötmsg
(c⁄° *
fmt
, ...);

106 #ifde‡
__GNUC__


108 #i‡
__GNUC__
 > 2 || (__GNUC__ == 2 \

109 && 
__GNUC_MINOR__
 >(
deföed
 
__˝lu•lus
 ? 6 : 4))

110 
	#__func__
 
__PRETTY_FUNCTION__


	)

112 #i‡
deföed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

117 
	#__func__
 ((c⁄° *)0)

	)

123 #i‚de‡
_DDBG_DISABLE_ASSERTIONS


124 
	#ddbg_as£π
(
c⁄d
Ëdÿ{ 
_…as£π_c⁄d
 = ()(cond); \

125 if(!
_…as£π_c⁄d
) { \

126 
	`ddbg_as£π_msg
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, ""); \

127 
	`ddbg_as£π_Áû
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, ""); \

128 } } 0)

	)

130 
	#ddbg_as£π
(
c⁄d
)

	)

134 #i‚de‡
_DDBG_DISABLE_ASSERTIONS


135 
	#ddbg_as£π2
(
c⁄d
,
fmt
Ëdÿ{ 
_…as£π_c⁄d
 = ()(cond); \

136 if(!
_…as£π_c⁄d
) { \

137 
	`ddbg_as£π_msg
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, 
fmt
); \

138 
	`ddbg_as£π_Áû
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, 
fmt
); \

139 } } 0)

	)

141 
	#ddbg_as£π2
(
x
,
y
)

	)

149 #i‚de‡
_DDBG_DISABLE_ASSERTIONS


150 
	#ddbg_as£π3
(
c⁄d
,
msg
Ëdÿ{ 
_…as£π_c⁄d
 = ()(cond);\

151 if(!
_…as£π_c⁄d
) { \

152 
	`ddbg_as£π_msg
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, ""); \

153 
ddbg_as£π_¥ötmsg
 
msg
; \

154 
	`ddbg_as£π_Áû
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, ""); \

155 } } 0)

	)

157 
	#ddbg_as£π3
(
x
,
y
)

	)

163 #i‡
__STDC_VERSION__
 >= 199901L

166 
	#ddbg_as£π4
(
c⁄d
,
fmt
,...Ë((c⁄dË? 0 : 
	`ddbg_as£π_msg
(
__FILE__
, 
__LINE__
, #c⁄d, 
__func__
, fmt, 
__VA_ARGS__
))

	)

171 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/libddbg/test.c

63 
	~<°dio.h
>

65 
	~"libåa˚.h
"

67 
	$maö
() {

68 
foo
, 
b¨
, 
baz
;

70 
	`…_as£π_£tfûe
(
°dout
);

74 
	`…_as£π3
(1 == 0, ("***Érror: diskmodel::mech_g1::seek_extracted "

78 
	`…_as£π3
(1 == 2, ("cake,"

81 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/libparam/bitvector.h

34 #i‚de‡
_BITVECTOR_H


35 
	#_BITVECTOR_H


	)

37 
	~<°rög.h
>

41 
	#BVSIZE
(
x
Ë((x/8Ë+ 1)

	)

42 
	#BITVECTOR
(
y
,
x
Ëy[
	`BVSIZE
(x)]

	)

46 
	#BIT_TEST
(
x
,
y
Ë(x[y / 8] & (1 << (y % 8)))

	)

49 
	#BIT_SET
(
x
,
y
Ëx[y / 8] |(1 << (y % 8))

	)

52 
	#BIT_RESET
(
x
,
y
Ëx[y / 8] &~(1 << (y % 8))

	)

	@/Users/ysoh/disksim-4.0-fcl/libparam/include/libparam/bitvector.h

34 #i‚de‡
_BITVECTOR_H


35 
	#_BITVECTOR_H


	)

37 
	~<°rög.h
>

41 
	#BVSIZE
(
x
Ë((x/8Ë+ 1)

	)

42 
	#BITVECTOR
(
y
,
x
Ëy[
	`BVSIZE
(x)]

	)

46 
	#BIT_TEST
(
x
,
y
Ë(x[y / 8] & (1 << (y % 8)))

	)

49 
	#BIT_SET
(
x
,
y
Ëx[y / 8] |(1 << (y % 8))

	)

52 
	#BIT_RESET
(
x
,
y
Ëx[y / 8] &~(1 << (y % 8))

	)

	@/Users/ysoh/disksim-4.0-fcl/libparam/include/libparam/libparam.h

33 #i‚de‡
_LIBPARAM_LIBPARAM_H


34 
	#_LIBPARAM_LIBPARAM_H


	)

37 #ifde‡
__˝lu•lus


42 
	~<°dio.h
>

45 
Õ_block
;

47 
	#MAX_PARAM_LEN
 1024

	)

49 
	sÕ_v¨•ec
 {

50 *
«me
;

51 
ty≥
;

52 
ªq
;

59 
BLOCK
 = -1,

60 
S
 = -2,

61 
I
 = -3,

62 
D
 = -4,

63 
LIST
 = -5,

64 
TOPOSPEC
 = -6

65 } 
	tÕ_ty≥_t
;

67 *
Õ_buûtö_«mes
[];

73 
	gÕ_vÆue
;

74 
	gÕ_li°
;

76 
Õ_li°
 *
Õ_li°_add
(Õ_li° *
l
,

77 
Õ_vÆue
 *
v
);

80 
	sÕ_li°
 {

81 *
	gsour˚_fûe
;

82 
Õ_vÆue
 **
	gvÆues
;

84 
	gvÆues_Àn
;

87 
	gvÆues_p›
;

92 
	glöñí
;

95 
	sÕ_t›o•ec
 {

96 *
	gsour˚_fûe
;

97 *
	gty≥
;

98 *
	g«me
;

99 
Õ_li°
 *
	gl
;

102 
	sÕ_vÆue
 {

103 *
	gsour˚_fûe
;

105 *
	gs
;

106 
	gi
;

107 
	gd
;

108 
Õ_block
 *
	gb
;

109 
Õ_li°
 *
	gl
;

110 °ru˘ { 
Õ_t›o•ec
 *
	gl
; 
	gÀn
; } 
	gt
;

111 } 
	gv
;

113 
Õ_ty≥_t
 
	gt
;

117 
Õ_vÆue
 *
Õ_√w_ötv
();

118 
Õ_vÆue
 *
Õ_√w_doubÀv
();

119 
Õ_vÆue
 *
Õ_√w_°rögv
(*);

120 
Õ_vÆue
 *
Õ_√w_li°v
(
Õ_li°
 *);

121 
Õ_vÆue
 *
Õ_√w_blockv
(
Õ_block
 *);

124 
Õ_li°
 *
Õ_√w_li°
();

125 
Õ_block
 *
Õ_√w_block
();

129 
	sÕ_∑øm
 {

130 *
	gsour˚_fûe
;

131 *
	g«me
;

132 
Õ_vÆue
 *
	gv
;

135 
Õ_∑øm
 *
Õ_√w_∑øm
(*
«me
, *
sour˚
, 
Õ_vÆue
 *);

136 
Õ_li°
 *
Õ_√w_öéi°
(*
l
, 
Àn
);

139 
	sÕ_subty≥
 {

140 *
	gsu≥r
;

141 *
	gsub
;

142 
Õ_block
 *
	g•ec
;

146 
	sÕ_ö°
 {

147 *
	gsour˚_fûe
;

148 
Õ_li°
 *
	gl
;

149 *
	g«me
;

154 
	sÕ_ét
 {

155 *
	gsour˚_fûe
;

157 
	gTLT_BLOCK
,

158 
	gTLT_TOPO
,

159 
	gTLT_INST


160 } 
	gwh©
;

163 
Õ_ö°
 *
	gö°
;

164 
Õ_block
 *
	gblock
;

165 
Õ_t›o•ec
 *
	gt›o
;

166 } 
	gô
;

171 *(*
	tÕ_modlﬂdî_t
)(
	tÕ_block
 *, );

173 (*
	gÕ_∑ømlﬂdî_öt
)(*, );

174 (*
	gÕ_∑ømlﬂdî_doubÀ
)(*, );

175 (*
	gÕ_∑ømlﬂdî_°rög
)(*, *);

176 (*
	gÕ_∑ømlﬂdî_block
)(*, 
	tÕ_block
 *);

177 (*
	gÕ_∑ømlﬂdî_li°
)(*, 
	tÕ_li°
 *);

189 (*
	gÕ_∑ømdï_t
)(*);

193 
Õ_subty≥
 **
Õ_ty≥tbl
;

194 
Õ_ty≥tbl_Àn
;

196 
Õ_ét
 **
Õ_éts
;

197 
Õ_éts_Àn
;

199 
Õ_ét
 *
Õ_√w_é_t›o
(
Õ_t›o•ec
 *, *);

200 
Õ_ét
 *
Õ_√w_é_ö°
(
Õ_ö°
 *, *);

201 
Õ_ét
 *
Õ_√w_é_block
(
Õ_block
 *, *);

203 
Õ_add_ét
(
Õ_ét
 *);

205 
Õ_öô_ty≥tbl
();

207 
Õ_ªÀa£_ty≥tbl
();

209 
Õ_add_ty≥
(*
√wt
, *
∑ª¡
);

210 *
Õ_lookup_ty≥
(*
«me
, *);

211 *
Õ_lookup_ba£_ty≥
(*
«me
, *
n
);

214 
	#PTYPE
(
x
Ë((x)->
v
->
t
)

	)

215 
	#IVAL
(
x
Ë((x)->
v
->v.
i
)

	)

216 
	#DVAL
(
x
Ë((x)->
v
->v.
d
)

	)

217 
	#SVAL
(
x
Ë((x)->
v
->v.
s
)

	)

218 
	#BVAL
(
x
Ë((x)->
v
->v.
b
)

	)

219 
	#LVAL
(
x
Ë((x)->
v
->v.
l
)

	)

222 
	#BTYPE
(
x
Ë((x)->
ty≥
)

	)

227 
	#RANGE
(
x
,
y
,
z
Ë(((xË>(y)Ë&& ((xË<(z)))

	)

228 
	#BADVALMSG
(
N
Ë
	`Ârötf
(
°dîr
, "***Éº‹: Bad vÆuêf‹ %s\n", N);

	)

231 
lﬂd_block
(
Õ_block
 *);

232 
lﬂd_t›o
(
Õ_t›o•ec
 *
t
, );

235 (*
	gÕ_t›ﬁﬂdî_t
)(
	tÕ_t›o•ec
 *
	tt
, );

236 
Õ_ªgi°î_t›ﬁﬂdî
(
Õ_t›ﬁﬂdî_t
);

239 
	sÕ_block_vÆ
 {

240 
Õ_∑øm
 **
	g∑øms
;

241 
	g∑øms_Àn
;

245 
	sÕ_block
 {

246 *
	gsour˚_fûe
;

247 *
	g«me
;

248 
	gty≥
;

249 
Õ_modlﬂdî_t
 
	glﬂdî
;

251 
Õ_∑øm
 **
	g∑øms
;

253 
	g∑øms_Àn
;

259 
push_fûe
(
FILE
 *
f
);

260 
disksim_∑ømwøp
();

262 
	sÕ_öput_fûe
 {

263 
yy_buf„r_°©e
 *
	gb
;

264 
	glöío
;

265 *
	gfûíame
;

268 
Õ_öput_fûe
 
öput_fûes
[];

270 
t›_fûe
;

271 
FILE
 *
lib∑ømö
;

273 *
Õ_fûíame
;

274 *
Õ_cwd
;

276 
	#LP_MAX_SP
 128

	)

277 **
Õ_£¨ch∑th
;

278 
Õ_£¨ch∑th_Àn
;

279 
Õ_löío
;

283 
Õ_ovîride_ö°
(
Õ_block
 *
b
,

284 *
˙ame
,

285 
Õ_modlﬂdî_t
 
lﬂdî
,

286 **
ovîrides
,

287 
ovîrides_Àn
);

290 (*
	gÕ_lﬂd_ˇŒback
)(*, *);

293 
	sÕ_mod
 {

295 *
	g«me
;

298 
Õ_v¨•ec
 *
	gmodv¨s
;

299 
	gmodv¨s_Àn
;

302 
Õ_modlﬂdî_t
 
	g‚
;

309 
Õ_lﬂd_ˇŒback
 
	gˇŒback
;

310 *
	g˘x
;

314 **
	g∑øm_lﬂdîs
;

315 
Õ_∑ømdï_t
 *
	g∑øm_dïs
;

318 
Õ_mod
 **
Õ_moduÀs
;

323 
Õ_ªgi°î_moduÀ
(
Õ_mod
 *);

331 **
Õ_ovîrides
;

332 
Õ_ovîrides_Àn
;

335 
u≈¨£_∑øm
(
Õ_∑øm
 *
p
, 
FILE
 *
outfûe
);

336 
u≈¨£_li°
(
Õ_li°
 *
l
, 
FILE
 *
outfûe
);

337 
u≈¨£_block
(
Õ_block
 *
b
, 
FILE
 *
outfûe
);

338 
u≈¨£_vÆue
(
Õ_vÆue
 *
v
, 
FILE
 *
outfûe
);

339 
u≈¨£_t›o•ec
(
Õ_t›o•ec
 *
t
, 
FILE
 *
outfûe
);

340 
u≈¨£_ty≥
(, 
FILE
 *);

341 
Õ_u≈¨£_éts
(
Õ_ét
 **, , 
FILE
 *, *);

346 
Õ_block
 *
Õ_lookup_•ec
(*
«me
);

349 
Õ_£tup_subty≥
(
Õ_block
 *
∑ª¡
,

350 
Õ_block
 *
chûd
);

352 
Õ_add_∑øm
(
Õ_∑øm
 ***
b
, *
∂í
,

353 
Õ_∑øm
 *
p
);

357 
Õ_∑øm_«me
(, *);

358 
Õ_mod_«me
(*);

364 
Õ_lﬂdfûe
(
FILE
 *
ö
, 
Õ_ét
 ***, *, *, **, );

367 
Õ_de°roy
(
Õ_ét
 **
±
, 
Àn
);

369 *
Õ_ö°™tüã
(*
èrg
, *
«me
);

373 
Õ_lﬂd∑øms
(*
ô
, 
Õ_block
 *
b
, 
Õ_mod
 *
m
);

376 
	#LP_PATH_MAX
 1024

	)

380 *
Õ_£¨ch_∑th
(*
cwd
, *
«me
);

382 
Õ_ö°_li°
(
Õ_ö°
 *
i
);

384 
dumb_•lô
(*
s
, **
t
, *
i
);

387 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/libparam/lex.libparam.c

4 
	#YY_INT_ALIGNED
 

	)

8 
	#yy_¸óã_buf„r
 
lib∑øm_¸óã_buf„r


	)

9 
	#yy_dñëe_buf„r
 
lib∑øm_dñëe_buf„r


	)

10 
	#yy_Êex_debug
 
lib∑øm_Êex_debug


	)

11 
	#yy_öô_buf„r
 
lib∑øm_öô_buf„r


	)

12 
	#yy_Êush_buf„r
 
lib∑øm_Êush_buf„r


	)

13 
	#yy_lﬂd_buf„r_°©e
 
lib∑øm_lﬂd_buf„r_°©e


	)

14 
	#yy_swôch_to_buf„r
 
lib∑øm_swôch_to_buf„r


	)

15 
	#yyö
 
lib∑ømö


	)

16 
	#yyÀng
 
lib∑ømÀng


	)

17 
	#yyÀx
 
lib∑ømÀx


	)

18 
	#yylöío
 
lib∑ømlöío


	)

19 
	#yyout
 
lib∑ømout


	)

20 
	#yyª°¨t
 
lib∑ømª°¨t


	)

21 
	#yyãxt
 
lib∑ømãxt


	)

22 
	#yywøp
 
lib∑ømwøp


	)

23 
	#yyÆloc
 
lib∑ømÆloc


	)

24 
	#yyªÆloc
 
lib∑ømªÆloc


	)

25 
	#yy‰ì
 
lib∑øm‰ì


	)

27 
	#FLEX_SCANNER


	)

28 
	#YY_FLEX_MAJOR_VERSION
 2

	)

29 
	#YY_FLEX_MINOR_VERSION
 5

	)

30 
	#YY_FLEX_SUBMINOR_VERSION
 35

	)

31 #i‡
YY_FLEX_SUBMINOR_VERSION
 > 0

32 
	#FLEX_BETA


	)

38 
	~<°dio.h
>

39 
	~<°rög.h
>

40 
	~<î∫o.h
>

41 
	~<°dlib.h
>

47 #i‚de‡
FLEXINT_H


48 
	#FLEXINT_H


	)

52 #i‡
deföed
 (
__STDC_VERSION__
) && __STDC_VERSION__ >= 199901L

57 #i‚de‡
__STDC_LIMIT_MACROS


58 
	#__STDC_LIMIT_MACROS
 1

	)

61 
	~<öây≥s.h
>

62 
öt8_t
 
	tÊex_öt8_t
;

63 
uöt8_t
 
	tÊex_uöt8_t
;

64 
öt16_t
 
	tÊex_öt16_t
;

65 
uöt16_t
 
	tÊex_uöt16_t
;

66 
öt32_t
 
	tÊex_öt32_t
;

67 
uöt32_t
 
	tÊex_uöt32_t
;

69 sig√d 
	tÊex_öt8_t
;

70 
	tÊex_öt16_t
;

71 
	tÊex_öt32_t
;

72 
	tÊex_uöt8_t
;

73 
	tÊex_uöt16_t
;

74 
	tÊex_uöt32_t
;

78 #i‚de‡
INT8_MIN


79 
	#INT8_MIN
 (-128)

	)

81 #i‚de‡
INT16_MIN


82 
	#INT16_MIN
 (-32767-1)

	)

84 #i‚de‡
INT32_MIN


85 
	#INT32_MIN
 (-2147483647-1)

	)

87 #i‚de‡
INT8_MAX


88 
	#INT8_MAX
 (127)

	)

90 #i‚de‡
INT16_MAX


91 
	#INT16_MAX
 (32767)

	)

93 #i‚de‡
INT32_MAX


94 
	#INT32_MAX
 (2147483647)

	)

96 #i‚de‡
UINT8_MAX


97 
	#UINT8_MAX
 (255U)

	)

99 #i‚de‡
UINT16_MAX


100 
	#UINT16_MAX
 (65535U)

	)

102 #i‚de‡
UINT32_MAX


103 
	#UINT32_MAX
 (4294967295U)

	)

108 #ifde‡
__˝lu•lus


111 
	#YY_USE_CONST


	)

116 #i‡
deföed
 (
__STDC__
)

118 
	#YY_USE_CONST


	)

123 #ifde‡
YY_USE_CONST


124 
	#yyc⁄°
 c⁄°

	)

126 
	#yyc⁄°


	)

130 
	#YY_NULL
 0

	)

137 
	#YY_SC_TO_UI
(
c
Ë((Ë(Ëc)

	)

143 
	#BEGIN
 (
yy_°¨t
Ë1 + 2 *

	)

149 
	#YY_START
 (((
yy_°¨t
Ë- 1Ë/ 2)

	)

150 
	#YYSTATE
 
YY_START


	)

153 
	#YY_STATE_EOF
(
°©e
Ë(
YY_END_OF_BUFFER
 + sèã + 1)

	)

156 
	#YY_NEW_FILE
 
	`lib∑ømª°¨t
(
lib∑ømö
 )

	)

158 
	#YY_END_OF_BUFFER_CHAR
 0

	)

161 #i‚de‡
YY_BUF_SIZE


162 
	#YY_BUF_SIZE
 16384

	)

167 
	#YY_STATE_BUF_SIZE
 ((
YY_BUF_SIZE
 + 2Ë* (
yy_°©e_ty≥
))

	)

169 #i‚de‡
YY_TYPEDEF_YY_BUFFER_STATE


170 
	#YY_TYPEDEF_YY_BUFFER_STATE


	)

171 
yy_buf„r_°©e
 *
	tYY_BUFFER_STATE
;

174 #i‚de‡
YY_TYPEDEF_YY_SIZE_T


175 
	#YY_TYPEDEF_YY_SIZE_T


	)

176 
size_t
 
	tyy_size_t
;

179 
yy_size_t
 
lib∑ømÀng
;

181 
FILE
 *
lib∑ømö
, *
lib∑ømout
;

183 
	#EOB_ACT_CONTINUE_SCAN
 0

	)

184 
	#EOB_ACT_END_OF_FILE
 1

	)

185 
	#EOB_ACT_LAST_MATCH
 2

	)

194 
	#YY_LESS_LINENO
(
n
) \

196 
yy_size_t
 
yyl
;\

197  
yyl
 = 
n
; yy»< 
lib∑ømÀng
; ++yyl )\

198 i‡–
lib∑ømãxt
[
yyl
] == '\n' )\

199 --
lib∑ømlöío
;\

200 }0)

	)

203 
	#yyÀss
(
n
) \

207 
yyÀss_ma¸o_¨g
 = (
n
); \

208 
	`YY_LESS_LINENO
(
yyÀss_ma¸o_¨g
);\

209 *
yy_˝
 = (
yy_hﬁd_ch¨
); \

210 
YY_RESTORE_YY_MORE_OFFSET
 \

211 (
yy_c_buf_p
Ë
yy_˝
 = 
yy_bp
 + 
yyÀss_ma¸o_¨g
 - 
YY_MORE_ADJ
; \

212 
YY_DO_BEFORE_ACTION
; \

214  0 )

	)

216 
	#u≈ut
(
c
Ë
	`yyu≈ut
–c, (
yyãxt_±r
Ë)

	)

218 #i‚de‡
YY_STRUCT_YY_BUFFER_STATE


219 
	#YY_STRUCT_YY_BUFFER_STATE


	)

220 
	syy_buf„r_°©e


222 
FILE
 *
	myy_öput_fûe
;

224 *
	myy_ch_buf
;

225 *
	myy_buf_pos
;

230 
yy_size_t
 
	myy_buf_size
;

235 
yy_size_t
 
	myy_n_ch¨s
;

241 
	myy_is_our_buf„r
;

248 
	myy_is_öãø˘ive
;

254 
	myy_©_bﬁ
;

256 
	myy_bs_löío
;

257 
	myy_bs_cﬁumn
;

262 
	myy_fûl_buf„r
;

264 
	myy_buf„r_°©us
;

266 
	#YY_BUFFER_NEW
 0

	)

267 
	#YY_BUFFER_NORMAL
 1

	)

278 
	#YY_BUFFER_EOF_PENDING
 2

	)

284 
size_t
 
	gyy_buf„r_°ack_t›
 = 0;

285 
size_t
 
	gyy_buf„r_°ack_max
 = 0;

286 
YY_BUFFER_STATE
 * 
	gyy_buf„r_°ack
 = 0;

294 
	#YY_CURRENT_BUFFER
 ( (
yy_buf„r_°ack
) \

295 ? (
yy_buf„r_°ack
)[(
yy_buf„r_°ack_t›
)] \

296 : 
NULL
)

	)

301 
	#YY_CURRENT_BUFFER_LVALUE
 (
yy_buf„r_°ack
)[(
yy_buf„r_°ack_t›
)]

	)

304 
	gyy_hﬁd_ch¨
;

305 
yy_size_t
 
	gyy_n_ch¨s
;

306 
yy_size_t
 
	glib∑ømÀng
;

309 *
	gyy_c_buf_p
 = (*) 0;

310 
	gyy_öô
 = 0;

311 
	gyy_°¨t
 = 0;

316 
	gyy_did_buf„r_swôch_⁄_eof
;

318 
lib∑ømª°¨t
 (
FILE
 *
öput_fûe
 );

319 
lib∑øm_swôch_to_buf„r
 (
YY_BUFFER_STATE
 
√w_buf„r
 );

320 
YY_BUFFER_STATE
 
lib∑øm_¸óã_buf„r
 (
FILE
 *
fûe
,
size
 );

321 
lib∑øm_dñëe_buf„r
 (
YY_BUFFER_STATE
 
b
 );

322 
lib∑øm_Êush_buf„r
 (
YY_BUFFER_STATE
 
b
 );

323 
lib∑ømpush_buf„r_°©e
 (
YY_BUFFER_STATE
 
√w_buf„r
 );

324 
lib∑ømp›_buf„r_°©e
 ();

326 
lib∑ømísuª_buf„r_°ack
 ();

327 
lib∑øm_lﬂd_buf„r_°©e
 ();

328 
lib∑øm_öô_buf„r
 (
YY_BUFFER_STATE
 
b
,
FILE
 *
fûe
 );

330 
	#YY_FLUSH_BUFFER
 
	`lib∑øm_Êush_buf„r
(
YY_CURRENT_BUFFER
 )

	)

332 
YY_BUFFER_STATE
 
lib∑øm_sˇn_buf„r
 (*
ba£
,
yy_size_t
 
size
 );

333 
YY_BUFFER_STATE
 
lib∑øm_sˇn_°rög
 (
yyc⁄°
 *
yy_°r
 );

334 
YY_BUFFER_STATE
 
lib∑øm_sˇn_byãs
 (
yyc⁄°
 *
byãs
,
yy_size_t
 
Àn
 );

336 *
lib∑ømÆloc
 (
yy_size_t
 );

337 *
lib∑ømªÆloc
 (*,
yy_size_t
 );

338 
lib∑øm‰ì
 (* );

340 
	#yy_√w_buf„r
 
lib∑øm_¸óã_buf„r


	)

342 
	#yy_£t_öãø˘ive
(
is_öãø˘ive
) \

344 i‡–! 
YY_CURRENT_BUFFER
 ){ \

345 
	`lib∑ømísuª_buf„r_°ack
 (); \

346 
YY_CURRENT_BUFFER_LVALUE
 = \

347 
	`lib∑øm_¸óã_buf„r
(
lib∑ømö
,
YY_BUF_SIZE
 ); \

349 
YY_CURRENT_BUFFER_LVALUE
->
yy_is_öãø˘ive
 = 
is_öãø˘ive
; \

350 }

	)

352 
	#yy_£t_bﬁ
(
©_bﬁ
) \

354 i‡–! 
YY_CURRENT_BUFFER
 ){\

355 
	`lib∑ømísuª_buf„r_°ack
 (); \

356 
YY_CURRENT_BUFFER_LVALUE
 = \

357 
	`lib∑øm_¸óã_buf„r
(
lib∑ømö
,
YY_BUF_SIZE
 ); \

359 
YY_CURRENT_BUFFER_LVALUE
->
yy_©_bﬁ
 = 
©_bﬁ
; \

360 }

	)

362 
	#YY_AT_BOL
(Ë(
YY_CURRENT_BUFFER_LVALUE
->
yy_©_bﬁ
)

	)

366 
	#lib∑ømwøp
(
n
Ë1

	)

367 
	#YY_SKIP_YYWRAP


	)

369 
	tYY_CHAR
;

371 
FILE
 *
	glib∑ømö
 = (FILE *Ë0, *
	glib∑ømout
 = (FILE *) 0;

373 
	tyy_°©e_ty≥
;

375 
lib∑ømlöío
;

377 
	glib∑ømlöío
 = 1;

379 *
lib∑ømãxt
;

380 
	#yyãxt_±r
 
lib∑ømãxt


	)

382 
yy_°©e_ty≥
 
yy_gë_¥evious_°©e
 ();

383 
yy_°©e_ty≥
 
yy_åy_NUL_å™s
 (yy_°©e_ty≥ 
cuºít_°©e
 );

384 
yy_gë_√xt_buf„r
 ();

385 
yy_Áèl_îr‹
 (
yyc⁄°
 
msg
[] );

390 
	#YY_DO_BEFORE_ACTION
 \

391 (
yyãxt_±r
Ë
yy_bp
; \

392 
lib∑ømÀng
 = (
size_t
Ë(
yy_˝
 - 
yy_bp
); \

393 (
yy_hﬁd_ch¨
Ë*
yy_˝
; \

394 *
yy_˝
 = '\0'; \

395 (
yy_c_buf_p
Ë
yy_˝
;

	)

397 
	#YY_NUM_RULES
 23

	)

398 
	#YY_END_OF_BUFFER
 24

	)

401 
	syy_å™s_öfo


403 
Êex_öt32_t
 
	myy_vîify
;

404 
Êex_öt32_t
 
	myy_nxt
;

406 
yyc⁄°
 
Êex_öt16_t
 
	gyy_ac˚±
[69] =

417 
yyc⁄°
 
Êex_öt32_t
 
	gyy_ec
[256] =

449 
yyc⁄°
 
Êex_öt32_t
 
	gyy_mëa
[37] =

457 
yyc⁄°
 
Êex_öt16_t
 
	gyy_ba£
[74] =

469 
yyc⁄°
 
Êex_öt16_t
 
	gyy_def
[74] =

481 
yyc⁄°
 
Êex_öt16_t
 
	gyy_nxt
[233] =

511 
yyc⁄°
 
Êex_öt16_t
 
	gyy_chk
[233] =

542 
yyc⁄°
 
Êex_öt32_t
 
	gyy_ruÀ_ˇn_m©ch_eﬁ
[24] =

547 
yy_°©e_ty≥
 
	gyy_œ°_ac˚±ög_°©e
;

548 *
	gyy_œ°_ac˚±ög_˝os
;

550 
lib∑øm_Êex_debug
;

551 
	glib∑øm_Êex_debug
 = 0;

556 
	#REJECT
 
ªje˘_u£d_but_nŸ_dëe˘ed


	)

557 
	#yym‹e
(Ë
yym‹e_u£d_but_nŸ_dëe˘ed


	)

558 
	#YY_MORE_ADJ
 0

	)

559 
	#YY_RESTORE_YY_MORE_OFFSET


	)

560 *
	glib∑ømãxt
;

592 
	~<°rög.h
>

593 #i‚de‡
WIN32


594 
	~<libgí.h
>

596 
	~<libddbg/libddbg.h
>

597 
	~<î∫o.h
>

599 
	~"lib∑øm.h
"

600 
	~"lib∑øm.èb.h
"

602 #ifde‡
WIN32


603 
°πod
();

606 
	#MAX_INPUT_FILES
 32

	)

607 
	gt›_fûe
 = 0;

608 
Õ_öput_fûe
 
	göput_fûes
[
MAX_INPUT_FILES
];

609 
	gÕ_löío
 = 0;

614 *
	g∑ths
[
MAX_INPUT_FILES
];

615 
	gt›_∑th
 = 0;

616 *
	gÕ_cwd
;

617 *
	gÕ_fûíame
;

620 
	#INITIAL
 0

	)

621 
	#§c
 1

	)

623 #i‚de‡
YY_NO_UNISTD_H


628 
	~<uni°d.h
>

631 #i‚de‡
YY_EXTRA_TYPE


632 
	#YY_EXTRA_TYPE
 *

	)

635 
yy_öô_globÆs
 ();

640 
lib∑ømÀx_de°roy
 ();

642 
lib∑ømgë_debug
 ();

644 
lib∑øm£t_debug
 (
debug_Êag
 );

646 
YY_EXTRA_TYPE
 
lib∑ømgë_exåa
 ();

648 
lib∑øm£t_exåa
 (
YY_EXTRA_TYPE
 
u£r_deföed
 );

650 
FILE
 *
lib∑ømgë_ö
 ();

652 
lib∑øm£t_ö
 (
FILE
 * 
ö_°r
 );

654 
FILE
 *
lib∑ømgë_out
 ();

656 
lib∑øm£t_out
 (
FILE
 * 
out_°r
 );

658 
yy_size_t
 
lib∑ømgë_Àng
 ();

660 *
lib∑ømgë_ãxt
 ();

662 
lib∑ømgë_löío
 ();

664 
lib∑øm£t_löío
 (
löe_numbî
 );

670 #i‚de‡
YY_SKIP_YYWRAP


671 #ifde‡
__˝lu•lus


672 "C" 
lib∑ømwøp
 ();

674 
lib∑ømwøp
 ();

678 
yyu≈ut
 (
c
,*
buf_±r
 );

680 #i‚de‡
yyãxt_±r


681 
yy_Êex_°∫˝y
 (*,
yyc⁄°
 *,);

684 #ifde‡
YY_NEED_STRLEN


685 
yy_Êex_°æí
 (
yyc⁄°
 * );

688 #i‚de‡
YY_NO_INPUT


690 #ifde‡
__˝lu•lus


691 
yyöput
 ();

693 
öput
 ();

699 #i‚de‡
YY_READ_BUF_SIZE


700 
	#YY_READ_BUF_SIZE
 8192

	)

704 #i‚de‡
ECHO


708 
	#ECHO
 
	`fwrôe
–
lib∑ømãxt
, 
lib∑ømÀng
, 1, 
lib∑ømout
 )

	)

714 #i‚de‡
YY_INPUT


715 
	#YY_INPUT
(
buf
,
ªsu…
,
max_size
) \

716 i‡–
YY_CURRENT_BUFFER_LVALUE
->
yy_is_öãø˘ive
 ) \

718 
c
 = '*'; \

719 
yy_size_t
 
n
; \

720  
n
 = 0;Ç < 
max_size
 && \

721 (
c
 = 
	`gëc
–
lib∑ømö
 )Ë!
EOF
 && c !'\n'; ++
n
 ) \

722 
buf
[
n
] = (Ë
c
; \

723 i‡–
c
 == '\n' ) \

724 
buf
[
n
++] = (Ë
c
; \

725 i‡–
c
 =
EOF
 && 
	`„º‹
–
lib∑ømö
 ) ) \

726 
	`YY_FATAL_ERROR
( "input in flex scanner failed" ); \

727 
ªsu…
 = 
n
; \

731 
î∫o
=0; \

732  (
ªsu…
 = 
	`‰ód
(
buf
, 1, 
max_size
, 
lib∑ømö
))==0 && 
	`„º‹
(libparamin)) \

734 if–
î∫o
 !
EINTR
) \

736 
	`YY_FATAL_ERROR
( "input in flex scanner failed" ); \

739 
î∫o
=0; \

740 
	`˛óªº
(
lib∑ømö
); \

744 

	)

751 #i‚de‡
yyãrmö©e


752 
	#yyãrmö©e
(Ë 
YY_NULL


	)

756 #i‚de‡
YY_START_STACK_INCR


757 
	#YY_START_STACK_INCR
 25

	)

761 #i‚de‡
YY_FATAL_ERROR


762 
	#YY_FATAL_ERROR
(
msg
Ë
	`yy_Áèl_îr‹
–msg )

	)

770 #i‚de‡
YY_DECL


771 
	#YY_DECL_IS_OURS
 1

	)

773 
lib∑ømÀx
 ();

775 
	#YY_DECL
 
	`lib∑ømÀx
 ()

	)

781 #i‚de‡
YY_USER_ACTION


782 
	#YY_USER_ACTION


	)

786 #i‚de‡
YY_BREAK


787 
	#YY_BREAK
 ;

	)

790 
	#YY_RULE_SETUP
 \

791 
YY_USER_ACTION


	)

795 
	gYY_DECL


797 
yy_°©e_ty≥
 
	gyy_cuºít_°©e
;

798 *
	gyy_˝
, *
	gyy_bp
;

799 
	gyy_a˘
;

806 i‡–!(
	gyy_öô
) )

808 (
	gyy_öô
) = 1;

810 #ifde‡
YY_USER_INIT


811 
	gYY_USER_INIT
;

814 i‡–! (
	gyy_°¨t
) )

815 (
	gyy_°¨t
) = 1;

817 i‡–! 
	glib∑ømö
 )

818 
	glib∑ømö
 = 
°dö
;

820 i‡–! 
	glib∑ømout
 )

821 
	glib∑ømout
 = 
°dout
;

823 i‡–! 
	gYY_CURRENT_BUFFER
 ) {

824 
lib∑ømísuª_buf„r_°ack
 ();

825 
	gYY_CURRENT_BUFFER_LVALUE
 =

826 
lib∑øm_¸óã_buf„r
(
lib∑ømö
,
YY_BUF_SIZE
 );

829 
lib∑øm_lﬂd_buf„r_°©e
( );

834 
	gyy_˝
 = (
yy_c_buf_p
);

837 *
	gyy_˝
 = (
yy_hﬁd_ch¨
);

842 
	gyy_bp
 = 
yy_˝
;

844 
	gyy_cuºít_°©e
 = (
yy_°¨t
);

845 
	gyy_m©ch
:

848 
YY_CHAR
 
yy_c
 = 
yy_ec
[
YY_SC_TO_UI
(*
yy_˝
)];

849 i‡–
	gyy_ac˚±
[
yy_cuºít_°©e
] )

851 (
	gyy_œ°_ac˚±ög_°©e
Ë
yy_cuºít_°©e
;

852 (
	gyy_œ°_ac˚±ög_˝os
Ë
yy_˝
;

854  
	gyy_chk
[
yy_ba£
[
yy_cuºít_°©e
] + 
	gyy_c
] != yy_current_state )

856 
yy_cuºít_°©e
 = (Ë
yy_def
[yy_current_state];

857 i‡–
	gyy_cuºít_°©e
 >= 69 )

858 
yy_c
 = 
yy_mëa
[() yy_c];

860 
	gyy_cuºít_°©e
 = 
yy_nxt
[
yy_ba£
[
yy_cuºít_°©e
] + (Ë
yy_c
];

861 ++
	gyy_˝
;

863  
	gyy_ba£
[
yy_cuºít_°©e
] != 196 );

865 
	gyy_föd_a˘i⁄
:

866 
yy_a˘
 = 
yy_ac˚±
[
yy_cuºít_°©e
];

867 i‡–
	gyy_a˘
 == 0 )

869 
yy_˝
 = (
yy_œ°_ac˚±ög_˝os
);

870 
	gyy_cuºít_°©e
 = (
yy_œ°_ac˚±ög_°©e
);

871 
	gyy_a˘
 = 
yy_ac˚±
[
yy_cuºít_°©e
];

874 
	gYY_DO_BEFORE_ACTION
;

876 i‡–
	gyy_a˘
 !
YY_END_OF_BUFFER
 && 
yy_ruÀ_ˇn_m©ch_eﬁ
[
yy_a˘
] )

878 
yy_size_t
 
yyl
;

879  
	gyyl
 = 0; yy»< 
	glib∑ømÀng
; ++yyl )

880 i‡–
	glib∑ømãxt
[
yyl
] == '\n' )

882 
lib∑ømlöío
++;

886 
	gdo_a˘i⁄
:

888  
yy_a˘
 )

892 *
yy_˝
 = (
yy_hﬁd_ch¨
);

893 
	gyy_˝
 = (
yy_œ°_ac˚±ög_˝os
);

894 
	gyy_cuºít_°©e
 = (
yy_œ°_ac˚±ög_°©e
);

895 
	gyy_föd_a˘i⁄
;

898 
YY_RULE_SETUP


901 
YY_BREAK


904 
YY_RULE_SETUP


906 { 
Õ_löío
++; };

907 
YY_BREAK


909 
YY_RULE_SETUP


911 {  
SEMI
; };

912 
YY_BREAK


914 
YY_RULE_SETUP


916 {  
LBRAK
; };

917 
YY_BREAK


919 
YY_RULE_SETUP


921 {  
RBRAK
; };

922 
YY_BREAK


924 
YY_RULE_SETUP


926 {  
COMMA
; };

927 
YY_BREAK


929 
YY_RULE_SETUP


931 {  
EQUAL
; };

932 
YY_BREAK


934 
YY_RULE_SETUP


936 {  
LBRACE
; };

937 
YY_BREAK


939 
YY_RULE_SETUP


941 {  
RBRACE
; };

942 
YY_BREAK


944 
YY_RULE_SETUP


947 
YY_BREAK


949 
YY_RULE_SETUP


951 {  
QU
; }

952 
YY_BREAK


954 
YY_RULE_SETUP


956 {  
COLON
; }

957 
YY_BREAK


959 
YY_RULE_SETUP


961 {  
DOTDOT
; }

962 
YY_BREAK


964 
YY_RULE_SETUP


966 
BEGIN
(
§c
);

967 
YY_BREAK


969 
YY_RULE_SETUP


971 {  
TOPOLOGY
; }

972 
YY_BREAK


974 
YY_RULE_SETUP


976 {  
INSTANTIATE
; }

977 
YY_BREAK


979 
YY_RULE_SETUP


981 {  
AS
; }

982 
YY_BREAK


984 
YY_RULE_SETUP


987 
lib∑ømlvÆ
.
i
 = 
©oi
(
lib∑ømãxt
);  
	gDECINT
;

989 
YY_BREAK


991 
YY_RULE_SETUP


994 
lib∑ømlvÆ
.
i
 = 
°πﬁ
(
lib∑ømãxt
, 0, 16);  
	gHEXINT
;

996 
YY_BREAK


998 
YY_RULE_SETUP


1001 
lib∑ømlvÆ
.
d
 = 
°πod
(
lib∑ømãxt
, 0);

1002  
	gFLOAT
;

1004 
YY_BREAK


1006 
YY_RULE_SETUP


1010 
lib∑ømlvÆ
.
s
 = 
°rdup
(
lib∑ømãxt
);  
	gSTRING
;

1012 
YY_BREAK


1014 
YY_RULE_SETUP


1017 *
dúc
, *
	gba£c
;

1018 *
	gdú
, *
	gba£
;

1023 
	göput_fûes
[
t›_fûe
].
	gb
 = 
YY_CURRENT_BUFFER
;

1024 
	göput_fûes
[
t›_fûe
].
	glöío
 = 
Õ_löío
;

1025 
	göput_fûes
[
t›_fûe
].
	gfûíame
 = 
Õ_fûíame
;

1026 
	gt›_fûe
++;

1028 
	gÕ_fûíame
 = 
°rdup
(
lib∑ømãxt
);

1030 
	gdúc
 = 
°rdup
(
Õ_fûíame
);

1031 
	gba£c
 = 
°rdup
(
Õ_fûíame
);

1032 
	gdú
 = 
dú«me
(
dúc
);

1033 
	gba£
 = 
ba£«me
(
ba£c
);

1035 
	g∑ths
[
t›_∑th
++] = 
Õ_cwd
;

1037 #ifde‡
WIN32


1039 i‡(!
°rcmp
(
dú
, ""))

1040 
°r˝y
(
dú
, ".");

1042 i‡(!
°rcmp
(
Õ_cwd
,"")) {

1043 
	gÕ_cwd
 = ".";

1044 
	g∑ths
[
t›_∑th
-1] = 
Õ_cwd
;

1054 if(
°rcmp
(
dú
, ".")) {

1056 if(
	gdú
[0] == '/') {

1057 
Õ_cwd
 = 
dú
;

1061 *
	g√w_cwd
 = 
ˇŒoc
(
LP_PATH_MAX
, ());

1062 
¢¥ötf
(
√w_cwd
, 
LP_PATH_MAX
, "%s/%s", 
Õ_cwd
, 
dú
);

1063 
	gÕ_cwd
 = 
√w_cwd
;

1074 
	gÕ_fûíame
 = 
ˇŒoc
(
LP_PATH_MAX
, ());

1076 *
	g∑th
 = 
Õ_£¨ch_∑th
(
Õ_cwd
, 
lib∑ømãxt
);

1077 if(
	g∑th
) {

1078 *
	g∑thtmp
 = 
°rdup
(
∑th
);

1079 
	gÕ_cwd
 = 
°rdup
(
dú«me
(
∑thtmp
));

1080 
‰ì
(
∑thtmp
);

1082 
	gÕ_fûíame
 = 
∑th
;

1084 
	glib∑ømö
 = 
f›í
(
Õ_fûíame
, "r");

1085 
ddbg_as£π3
(
lib∑ømö
 !0, ("Couldn'à›í %†: %s", 
Õ_fûíame
, 
°ªº‹
(
î∫o
)));

1086 
	gc⁄t
;

1089 
Ârötf
(
°dîr
, "gŸÿFAIL %†%s", 
Õ_cwd
, 
lib∑ømãxt
);

1090 
	gÁû
;

1095 
	gÁû
:

1096 
Ârötf
(
°dîr
, "***Éº‹: couldn'à›í %†: %s\n", 
lib∑ømãxt
, 
°ªº‹
(
î∫o
));

1097 
yyãrmö©e
();

1099 
	gc⁄t
:

1100 
ddbg_as£π
(
lib∑ømö
 != 0);

1101 
lib∑øm_swôch_to_buf„r
(
lib∑øm_¸óã_buf„r
(
lib∑ømö
,
YY_BUF_SIZE
));

1102 
	gÕ_löío
 = 0;

1104 
BEGIN
(
INITIAL
);

1106 
YY_BREAK


1107 
YY_STATE_EOF
(
INITIAL
):

1108 
YY_STATE_EOF
(
§c
):

1114 if(--
t›_fûe
 < 0Ë{ 
yyãrmö©e
(); }

1116 
	gt›_∑th
--;

1117 
	gÕ_cwd
 = 
∑ths
[
t›_∑th
];

1119 
f˛o£
(
lib∑ømö
);

1120 
lib∑øm_dñëe_buf„r
(
YY_CURRENT_BUFFER
);

1121 
lib∑øm_swôch_to_buf„r
(
öput_fûes
[
t›_fûe
].
b
);

1123 
	gÕ_löío
 = 
öput_fûes
[
t›_fûe
].
löío
;

1126 
	gÕ_fûíame
 = 
öput_fûes
[
t›_fûe
].
fûíame
;

1129 
YY_BREAK


1131 
YY_RULE_SETUP


1133 
ECHO
;

1134 
	gYY_BREAK


1137 
	gYY_END_OF_BUFFER
:

1140 
yy_amou¡_of_m©ched_ãxt
 = (Ë(
yy_˝
 - (
yyãxt_±r
)) - 1;

1143 *
	gyy_˝
 = (
yy_hﬁd_ch¨
);

1144 
YY_RESTORE_YY_MORE_OFFSET


1146 i‡–
	gYY_CURRENT_BUFFER_LVALUE
->
	gyy_buf„r_°©us
 =
YY_BUFFER_NEW
 )

1157 (
yy_n_ch¨s
Ë
YY_CURRENT_BUFFER_LVALUE
->yy_n_chars;

1158 
	gYY_CURRENT_BUFFER_LVALUE
->
	gyy_öput_fûe
 = 
lib∑ømö
;

1159 
	gYY_CURRENT_BUFFER_LVALUE
->
	gyy_buf„r_°©us
 = 
YY_BUFFER_NORMAL
;

1169 i‡–(
	gyy_c_buf_p
Ë<&
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
[(
yy_n_ch¨s
)] )

1171 
yy_°©e_ty≥
 
yy_√xt_°©e
;

1173 (
	gyy_c_buf_p
Ë(
yyãxt_±r
Ë+ 
yy_amou¡_of_m©ched_ãxt
;

1175 
	gyy_cuºít_°©e
 = 
yy_gë_¥evious_°©e
( );

1186 
	gyy_√xt_°©e
 = 
yy_åy_NUL_å™s
–
yy_cuºít_°©e
 );

1188 
	gyy_bp
 = (
yyãxt_±r
Ë+ 
YY_MORE_ADJ
;

1190 i‡–
	gyy_√xt_°©e
 )

1193 
	gyy_˝
 = ++(
yy_c_buf_p
);

1194 
	gyy_cuºít_°©e
 = 
yy_√xt_°©e
;

1195 
	gyy_m©ch
;

1200 
	gyy_˝
 = (
yy_c_buf_p
);

1201 
	gyy_föd_a˘i⁄
;

1205  
yy_gë_√xt_buf„r
( ) )

1207 
	gEOB_ACT_END_OF_FILE
:

1209 (
yy_did_buf„r_swôch_⁄_eof
) = 0;

1211 i‡–
lib∑ømwøp
( ) )

1222 (
	gyy_c_buf_p
Ë(
yyãxt_±r
Ë+ 
YY_MORE_ADJ
;

1224 
	gyy_a˘
 = 
YY_STATE_EOF
(
YY_START
);

1225 
	gdo_a˘i⁄
;

1230 i‡–! (
	gyy_did_buf„r_swôch_⁄_eof
) )

1231 
	gYY_NEW_FILE
;

1236 
	gEOB_ACT_CONTINUE_SCAN
:

1237 (
yy_c_buf_p
) =

1238 (
yyãxt_±r
Ë+ 
yy_amou¡_of_m©ched_ãxt
;

1240 
	gyy_cuºít_°©e
 = 
yy_gë_¥evious_°©e
( );

1242 
	gyy_˝
 = (
yy_c_buf_p
);

1243 
	gyy_bp
 = (
yyãxt_±r
Ë+ 
YY_MORE_ADJ
;

1244 
	gyy_m©ch
;

1246 
	gEOB_ACT_LAST_MATCH
:

1247 (
yy_c_buf_p
) =

1248 &
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
[(
yy_n_ch¨s
)];

1250 
	gyy_cuºít_°©e
 = 
yy_gë_¥evious_°©e
( );

1252 
	gyy_˝
 = (
yy_c_buf_p
);

1253 
	gyy_bp
 = (
yyãxt_±r
Ë+ 
YY_MORE_ADJ
;

1254 
	gyy_föd_a˘i⁄
;

1260 
YY_FATAL_ERROR
(

1273 
	$yy_gë_√xt_buf„r
 ()

1275 *
de°
 = 
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
;

1276 *
sour˚
 = (
yyãxt_±r
);

1277 
numbî_to_move
, 
i
;

1278 
ªt_vÆ
;

1280 i‡–(
yy_c_buf_p
Ë> &
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
[(
yy_n_ch¨s
) + 1] )

1281 
	`YY_FATAL_ERROR
(

1284 i‡–
YY_CURRENT_BUFFER_LVALUE
->
yy_fûl_buf„r
 == 0 )

1286 i‡–(
yy_c_buf_p
Ë- (
yyãxt_±r
Ë- 
YY_MORE_ADJ
 == 1 )

1291  
EOB_ACT_END_OF_FILE
;

1299  
EOB_ACT_LAST_MATCH
;

1306 
numbî_to_move
 = (Ë((
yy_c_buf_p
Ë- (
yyãxt_±r
)) - 1;

1308  
i
 = 0; i < 
numbî_to_move
; ++i )

1309 *(
de°
++Ë*(
sour˚
++);

1311 i‡–
YY_CURRENT_BUFFER_LVALUE
->
yy_buf„r_°©us
 =
YY_BUFFER_EOF_PENDING
 )

1315 
YY_CURRENT_BUFFER_LVALUE
->
yy_n_ch¨s
 = (yy_n_chars) = 0;

1319 
yy_size_t
 
num_to_ªad
 =

1320 
YY_CURRENT_BUFFER_LVALUE
->
yy_buf_size
 - 
numbî_to_move
 - 1;

1322  
num_to_ªad
 <= 0 )

1326 
YY_BUFFER_STATE
 
b
 = 
YY_CURRENT_BUFFER
;

1328 
yy_c_buf_p_off£t
 =

1329 (Ë((
yy_c_buf_p
Ë- 
b
->
yy_ch_buf
);

1331 i‡–
b
->
yy_is_our_buf„r
 )

1333 
yy_size_t
 
√w_size
 = 
b
->
yy_buf_size
 * 2;

1335 i‡–
√w_size
 <= 0 )

1336 
b
->
yy_buf_size
 += b->yy_buf_size / 8;

1338 
b
->
yy_buf_size
 *= 2;

1340 
b
->
yy_ch_buf
 = (*)

1342 
	`lib∑ømªÆloc
((*Ë
b
->
yy_ch_buf
,b->
yy_buf_size
 + 2 );

1346 
b
->
yy_ch_buf
 = 0;

1348 i‡–! 
b
->
yy_ch_buf
 )

1349 
	`YY_FATAL_ERROR
(

1352 (
yy_c_buf_p
Ë&
b
->
yy_ch_buf
[
yy_c_buf_p_off£t
];

1354 
num_to_ªad
 = 
YY_CURRENT_BUFFER_LVALUE
->
yy_buf_size
 -

1355 
numbî_to_move
 - 1;

1359 i‡–
num_to_ªad
 > 
YY_READ_BUF_SIZE
 )

1360 
num_to_ªad
 = 
YY_READ_BUF_SIZE
;

1363 
	`YY_INPUT
–(&
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
[
numbî_to_move
]),

1364 (
yy_n_ch¨s
), 
num_to_ªad
 );

1366 
YY_CURRENT_BUFFER_LVALUE
->
yy_n_ch¨s
 = (yy_n_chars);

1369 i‡–(
yy_n_ch¨s
) == 0 )

1371 i‡–
numbî_to_move
 =
YY_MORE_ADJ
 )

1373 
ªt_vÆ
 = 
EOB_ACT_END_OF_FILE
;

1374 
	`lib∑ømª°¨t
(
lib∑ømö
 );

1379 
ªt_vÆ
 = 
EOB_ACT_LAST_MATCH
;

1380 
YY_CURRENT_BUFFER_LVALUE
->
yy_buf„r_°©us
 =

1381 
YY_BUFFER_EOF_PENDING
;

1386 
ªt_vÆ
 = 
EOB_ACT_CONTINUE_SCAN
;

1388 i‡((
yy_size_t
Ë((
yy_n_ch¨s
Ë+ 
numbî_to_move
Ë> 
YY_CURRENT_BUFFER_LVALUE
->
yy_buf_size
) {

1390 
yy_size_t
 
√w_size
 = (
yy_n_ch¨s
Ë+ 
numbî_to_move
 + ((yy_n_chars) >> 1);

1391 
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
 = (*Ë
	`lib∑ømªÆloc
((*ËYY_CURRENT_BUFFER_LVALUE->yy_ch_buf,
√w_size
 );

1392 i‡–! 
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
 )

1393 
	`YY_FATAL_ERROR
( "out of dynamic memory in yy_get_next_buffer()" );

1396 (
yy_n_ch¨s
Ë+
numbî_to_move
;

1397 
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
[(
yy_n_ch¨s
)] = 
YY_END_OF_BUFFER_CHAR
;

1398 
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
[(
yy_n_ch¨s
Ë+ 1] = 
YY_END_OF_BUFFER_CHAR
;

1400 (
yyãxt_±r
Ë&
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
[0];

1402  
ªt_vÆ
;

1403 
	}
}

1407 
yy_°©e_ty≥
 
	$yy_gë_¥evious_°©e
 ()

1409 
yy_°©e_ty≥
 
yy_cuºít_°©e
;

1410 *
yy_˝
;

1412 
yy_cuºít_°©e
 = (
yy_°¨t
);

1414  
yy_˝
 = (
yyãxt_±r
Ë+ 
YY_MORE_ADJ
; yy_˝ < (
yy_c_buf_p
); ++yy_cp )

1416 
YY_CHAR
 
yy_c
 = (*
yy_˝
 ? 
yy_ec
[
	`YY_SC_TO_UI
(*yy_cp)] : 1);

1417 i‡–
yy_ac˚±
[
yy_cuºít_°©e
] )

1419 (
yy_œ°_ac˚±ög_°©e
Ë
yy_cuºít_°©e
;

1420 (
yy_œ°_ac˚±ög_˝os
Ë
yy_˝
;

1422  
yy_chk
[
yy_ba£
[
yy_cuºít_°©e
] + 
yy_c
] != yy_current_state )

1424 
yy_cuºít_°©e
 = (Ë
yy_def
[yy_current_state];

1425 i‡–
yy_cuºít_°©e
 >= 69 )

1426 
yy_c
 = 
yy_mëa
[() yy_c];

1428 
yy_cuºít_°©e
 = 
yy_nxt
[
yy_ba£
[yy_cuºít_°©e] + (Ë
yy_c
];

1431  
yy_cuºít_°©e
;

1432 
	}
}

1439 
yy_°©e_ty≥
 
	$yy_åy_NUL_å™s
 (
yy_°©e_ty≥
 
yy_cuºít_°©e
 )

1441 
yy_is_jam
;

1442 *
yy_˝
 = (
yy_c_buf_p
);

1444 
YY_CHAR
 
yy_c
 = 1;

1445 i‡–
yy_ac˚±
[
yy_cuºít_°©e
] )

1447 (
yy_œ°_ac˚±ög_°©e
Ë
yy_cuºít_°©e
;

1448 (
yy_œ°_ac˚±ög_˝os
Ë
yy_˝
;

1450  
yy_chk
[
yy_ba£
[
yy_cuºít_°©e
] + 
yy_c
] != yy_current_state )

1452 
yy_cuºít_°©e
 = (Ë
yy_def
[yy_current_state];

1453 i‡–
yy_cuºít_°©e
 >= 69 )

1454 
yy_c
 = 
yy_mëa
[() yy_c];

1456 
yy_cuºít_°©e
 = 
yy_nxt
[
yy_ba£
[yy_cuºít_°©e] + (Ë
yy_c
];

1457 
yy_is_jam
 = (
yy_cuºít_°©e
 == 68);

1459  
yy_is_jam
 ? 0 : 
yy_cuºít_°©e
;

1460 
	}
}

1462 
	$yyu≈ut
 (
c
, * 
yy_bp
 )

1464 *
yy_˝
;

1466 
yy_˝
 = (
yy_c_buf_p
);

1469 *
yy_˝
 = (
yy_hﬁd_ch¨
);

1471 i‡–
yy_˝
 < 
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
 + 2 )

1474 
yy_size_t
 
numbî_to_move
 = (
yy_n_ch¨s
) + 2;

1475 *
de°
 = &
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
[

1476 
YY_CURRENT_BUFFER_LVALUE
->
yy_buf_size
 + 2];

1477 *
sour˚
 =

1478 &
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
[
numbî_to_move
];

1480  
sour˚
 > 
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
 )

1481 *--
de°
 = *--
sour˚
;

1483 
yy_˝
 +(Ë(
de°
 - 
sour˚
);

1484 
yy_bp
 +(Ë(
de°
 - 
sour˚
);

1485 
YY_CURRENT_BUFFER_LVALUE
->
yy_n_ch¨s
 =

1486 (
yy_n_ch¨s
Ë
YY_CURRENT_BUFFER_LVALUE
->
yy_buf_size
;

1488 i‡–
yy_˝
 < 
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
 + 2 )

1489 
	`YY_FATAL_ERROR
( "flex scannerÖush-back overflow" );

1492 *--
yy_˝
 = (Ë
c
;

1494 i‡–
c
 == '\n' ){

1495 --
lib∑ømlöío
;

1498 (
yyãxt_±r
Ë
yy_bp
;

1499 (
yy_hﬁd_ch¨
Ë*
yy_˝
;

1500 (
yy_c_buf_p
Ë
yy_˝
;

1501 
	}
}

1503 #i‚de‡
YY_NO_INPUT


1504 #ifde‡
__˝lu•lus


1505 
	$yyöput
 ()

1507 
	$öput
 ()

1511 
c
;

1513 *(
yy_c_buf_p
Ë(
yy_hﬁd_ch¨
);

1515 i‡–*(
yy_c_buf_p
Ë=
YY_END_OF_BUFFER_CHAR
 )

1521 i‡–(
yy_c_buf_p
Ë< &
YY_CURRENT_BUFFER_LVALUE
->
yy_ch_buf
[(
yy_n_ch¨s
)] )

1523 *(
yy_c_buf_p
) = '\0';

1527 
yy_size_t
 
off£t
 = (
yy_c_buf_p
Ë- (
yyãxt_±r
);

1528 ++(
yy_c_buf_p
);

1530  
	`yy_gë_√xt_buf„r
( ) )

1532 
EOB_ACT_LAST_MATCH
:

1544 
	`lib∑ømª°¨t
(
lib∑ømö
 );

1548 
EOB_ACT_END_OF_FILE
:

1550 i‡–
	`lib∑ømwøp
( ) )

1553 i‡–! (
yy_did_buf„r_swôch_⁄_eof
) )

1554 
YY_NEW_FILE
;

1555 #ifde‡
__˝lu•lus


1556  
	`yyöput
();

1558  
	`öput
();

1562 
EOB_ACT_CONTINUE_SCAN
:

1563 (
yy_c_buf_p
Ë(
yyãxt_±r
Ë+ 
off£t
;

1569 
c
 = *(*Ë(
yy_c_buf_p
);

1570 *(
yy_c_buf_p
) = '\0';

1571 (
yy_hﬁd_ch¨
Ë*++(
yy_c_buf_p
);

1573 i‡–
c
 == '\n' )

1575 
lib∑ømlöío
++;

1578  
c
;

1579 
	}
}

1587 
	$lib∑ømª°¨t
 (
FILE
 * 
öput_fûe
 )

1590 i‡–! 
YY_CURRENT_BUFFER
 ){

1591 
	`lib∑ømísuª_buf„r_°ack
 ();

1592 
YY_CURRENT_BUFFER_LVALUE
 =

1593 
	`lib∑øm_¸óã_buf„r
(
lib∑ømö
,
YY_BUF_SIZE
 );

1596 
	`lib∑øm_öô_buf„r
(
YY_CURRENT_BUFFER
,
öput_fûe
 );

1597 
	`lib∑øm_lﬂd_buf„r_°©e
( );

1598 
	}
}

1604 
	$lib∑øm_swôch_to_buf„r
 (
YY_BUFFER_STATE
 
√w_buf„r
 )

1612 
	`lib∑ømísuª_buf„r_°ack
 ();

1613 i‡–
YY_CURRENT_BUFFER
 =
√w_buf„r
 )

1616 i‡–
YY_CURRENT_BUFFER
 )

1619 *(
yy_c_buf_p
Ë(
yy_hﬁd_ch¨
);

1620 
YY_CURRENT_BUFFER_LVALUE
->
yy_buf_pos
 = (
yy_c_buf_p
);

1621 
YY_CURRENT_BUFFER_LVALUE
->
yy_n_ch¨s
 = (yy_n_chars);

1624 
YY_CURRENT_BUFFER_LVALUE
 = 
√w_buf„r
;

1625 
	`lib∑øm_lﬂd_buf„r_°©e
( );

1632 (
yy_did_buf„r_swôch_⁄_eof
) = 1;

1633 
	}
}

1635 
	$lib∑øm_lﬂd_buf„r_°©e
 ()

1637 (
yy_n_ch¨s
Ë
YY_CURRENT_BUFFER_LVALUE
->yy_n_chars;

1638 (
yyãxt_±r
Ë(
yy_c_buf_p
Ë
YY_CURRENT_BUFFER_LVALUE
->
yy_buf_pos
;

1639 
lib∑ømö
 = 
YY_CURRENT_BUFFER_LVALUE
->
yy_öput_fûe
;

1640 (
yy_hﬁd_ch¨
Ë*(
yy_c_buf_p
);

1641 
	}
}

1649 
YY_BUFFER_STATE
 
	$lib∑øm_¸óã_buf„r
 (
FILE
 * 
fûe
, 
size
 )

1651 
YY_BUFFER_STATE
 
b
;

1653 
b
 = (
YY_BUFFER_STATE
Ë
	`lib∑ømÆloc
(–
yy_buf„r_°©e
 ) );

1654 i‡–! 
b
 )

1655 
	`YY_FATAL_ERROR
( "out of dynamic memory inÜibparam_create_buffer()" );

1657 
b
->
yy_buf_size
 = 
size
;

1662 
b
->
yy_ch_buf
 = (*Ë
	`lib∑ømÆloc
(b->
yy_buf_size
 + 2 );

1663 i‡–! 
b
->
yy_ch_buf
 )

1664 
	`YY_FATAL_ERROR
( "out of dynamic memory inÜibparam_create_buffer()" );

1666 
b
->
yy_is_our_buf„r
 = 1;

1668 
	`lib∑øm_öô_buf„r
(
b
,
fûe
 );

1670  
b
;

1671 
	}
}

1677 
	$lib∑øm_dñëe_buf„r
 (
YY_BUFFER_STATE
 
b
 )

1680 i‡–! 
b
 )

1683 i‡–
b
 =
YY_CURRENT_BUFFER
 )

1684 
YY_CURRENT_BUFFER_LVALUE
 = (
YY_BUFFER_STATE
) 0;

1686 i‡–
b
->
yy_is_our_buf„r
 )

1687 
	`lib∑øm‰ì
((*Ë
b
->
yy_ch_buf
 );

1689 
	`lib∑øm‰ì
((*Ë
b
 );

1690 
	}
}

1692 #i‚de‡
__˝lu•lus


1693 
ißây
 ();

1700 
	$lib∑øm_öô_buf„r
 (
YY_BUFFER_STATE
 
b
, 
FILE
 * 
fûe
 )

1703 
€ºno
 = 
î∫o
;

1705 
	`lib∑øm_Êush_buf„r
(
b
 );

1707 
b
->
yy_öput_fûe
 = 
fûe
;

1708 
b
->
yy_fûl_buf„r
 = 1;

1714 i‡(
b
 !
YY_CURRENT_BUFFER
){

1715 
b
->
yy_bs_löío
 = 1;

1716 
b
->
yy_bs_cﬁumn
 = 0;

1719 
b
->
yy_is_öãø˘ive
 = 
fûe
 ? (
	`ißây
–
	`fûío
(file) ) > 0) : 0;

1721 
î∫o
 = 
€ºno
;

1722 
	}
}

1728 
	$lib∑øm_Êush_buf„r
 (
YY_BUFFER_STATE
 
b
 )

1730 i‡–! 
b
 )

1733 
b
->
yy_n_ch¨s
 = 0;

1739 
b
->
yy_ch_buf
[0] = 
YY_END_OF_BUFFER_CHAR
;

1740 
b
->
yy_ch_buf
[1] = 
YY_END_OF_BUFFER_CHAR
;

1742 
b
->
yy_buf_pos
 = &b->
yy_ch_buf
[0];

1744 
b
->
yy_©_bﬁ
 = 1;

1745 
b
->
yy_buf„r_°©us
 = 
YY_BUFFER_NEW
;

1747 i‡–
b
 =
YY_CURRENT_BUFFER
 )

1748 
	`lib∑øm_lﬂd_buf„r_°©e
( );

1749 
	}
}

1757 
	$lib∑ømpush_buf„r_°©e
 (
YY_BUFFER_STATE
 
√w_buf„r
 )

1759 i‡(
√w_buf„r
 =
NULL
)

1762 
	`lib∑ømísuª_buf„r_°ack
();

1765 i‡–
YY_CURRENT_BUFFER
 )

1768 *(
yy_c_buf_p
Ë(
yy_hﬁd_ch¨
);

1769 
YY_CURRENT_BUFFER_LVALUE
->
yy_buf_pos
 = (
yy_c_buf_p
);

1770 
YY_CURRENT_BUFFER_LVALUE
->
yy_n_ch¨s
 = (yy_n_chars);

1774 i‡(
YY_CURRENT_BUFFER
)

1775 (
yy_buf„r_°ack_t›
)++;

1776 
YY_CURRENT_BUFFER_LVALUE
 = 
√w_buf„r
;

1779 
	`lib∑øm_lﬂd_buf„r_°©e
( );

1780 (
yy_did_buf„r_swôch_⁄_eof
) = 1;

1781 
	}
}

1787 
	$lib∑ømp›_buf„r_°©e
 ()

1789 i‡(!
YY_CURRENT_BUFFER
)

1792 
	`lib∑øm_dñëe_buf„r
(
YY_CURRENT_BUFFER
 );

1793 
YY_CURRENT_BUFFER_LVALUE
 = 
NULL
;

1794 i‡((
yy_buf„r_°ack_t›
) > 0)

1795 --(
yy_buf„r_°ack_t›
);

1797 i‡(
YY_CURRENT_BUFFER
) {

1798 
	`lib∑øm_lﬂd_buf„r_°©e
( );

1799 (
yy_did_buf„r_swôch_⁄_eof
) = 1;

1801 
	}
}

1806 
	$lib∑ømísuª_buf„r_°ack
 ()

1808 
yy_size_t
 
num_to_Æloc
;

1810 i‡(!(
yy_buf„r_°ack
)) {

1816 
num_to_Æloc
 = 1;

1817 (
yy_buf„r_°ack
Ë(
yy_buf„r_°©e
**)
lib∑ømÆloc


1818 (
num_to_Æloc
 * (
yy_buf„r_°©e
*)

1820 i‡–! (
yy_buf„r_°ack
) )

1821 
	`YY_FATAL_ERROR
( "out of dynamic memory inÜibparamensure_buffer_stack()" );

1823 
	`mem£t
((
yy_buf„r_°ack
), 0, 
num_to_Æloc
 * (
yy_buf„r_°©e
*));

1825 (
yy_buf„r_°ack_max
Ë
num_to_Æloc
;

1826 (
yy_buf„r_°ack_t›
) = 0;

1830 i‡((
yy_buf„r_°ack_t›
Ë>((
yy_buf„r_°ack_max
)) - 1){

1833 
grow_size
 = 8 ;

1835 
num_to_Æloc
 = (
yy_buf„r_°ack_max
Ë+ 
grow_size
;

1836 (
yy_buf„r_°ack
Ë(
yy_buf„r_°©e
**)
lib∑ømªÆloc


1837 ((
yy_buf„r_°ack
),

1838 
num_to_Æloc
 * (
yy_buf„r_°©e
*)

1840 i‡–! (
yy_buf„r_°ack
) )

1841 
	`YY_FATAL_ERROR
( "out of dynamic memory inÜibparamensure_buffer_stack()" );

1844 
	`mem£t
((
yy_buf„r_°ack
Ë+ (
yy_buf„r_°ack_max
), 0, 
grow_size
 * (
yy_buf„r_°©e
*));

1845 (
yy_buf„r_°ack_max
Ë
num_to_Æloc
;

1847 
	}
}

1855 
YY_BUFFER_STATE
 
	$lib∑øm_sˇn_buf„r
 (* 
ba£
, 
yy_size_t
 
size
 )

1857 
YY_BUFFER_STATE
 
b
;

1859 i‡–
size
 < 2 ||

1860 
ba£
[
size
-2] !
YY_END_OF_BUFFER_CHAR
 ||

1861 
ba£
[
size
-1] !
YY_END_OF_BUFFER_CHAR
 )

1865 
b
 = (
YY_BUFFER_STATE
Ë
	`lib∑ømÆloc
(–
yy_buf„r_°©e
 ) );

1866 i‡–! 
b
 )

1867 
	`YY_FATAL_ERROR
( "out of dynamic memory inÜibparam_scan_buffer()" );

1869 
b
->
yy_buf_size
 = 
size
 - 2;

1870 
b
->
yy_buf_pos
 = b->
yy_ch_buf
 = 
ba£
;

1871 
b
->
yy_is_our_buf„r
 = 0;

1872 
b
->
yy_öput_fûe
 = 0;

1873 
b
->
yy_n_ch¨s
 = b->
yy_buf_size
;

1874 
b
->
yy_is_öãø˘ive
 = 0;

1875 
b
->
yy_©_bﬁ
 = 1;

1876 
b
->
yy_fûl_buf„r
 = 0;

1877 
b
->
yy_buf„r_°©us
 = 
YY_BUFFER_NEW
;

1879 
	`lib∑øm_swôch_to_buf„r
(
b
 );

1881  
b
;

1882 
	}
}

1892 
YY_BUFFER_STATE
 
	$lib∑øm_sˇn_°rög
 (
yyc⁄°
 * 
yy°r
 )

1895  
	`lib∑øm_sˇn_byãs
(
yy°r
,
	`°æí
(yystr) );

1896 
	}
}

1905 
YY_BUFFER_STATE
 
	$lib∑øm_sˇn_byãs
 (
yyc⁄°
 * 
yybyãs
, 
yy_size_t
 
_yybyãs_Àn
 )

1907 
YY_BUFFER_STATE
 
b
;

1908 *
buf
;

1909 
yy_size_t
 
n
, 
i
;

1912 
n
 = 
_yybyãs_Àn
 + 2;

1913 
buf
 = (*Ë
	`lib∑ømÆloc
(
n
 );

1914 i‡–! 
buf
 )

1915 
	`YY_FATAL_ERROR
( "out of dynamic memory inÜibparam_scan_bytes()" );

1917  
i
 = 0; i < 
_yybyãs_Àn
; ++i )

1918 
buf
[
i
] = 
yybyãs
[i];

1920 
buf
[
_yybyãs_Àn
] = buf[_yybyãs_Àn+1] = 
YY_END_OF_BUFFER_CHAR
;

1922 
b
 = 
	`lib∑øm_sˇn_buf„r
(
buf
,
n
 );

1923 i‡–! 
b
 )

1924 
	`YY_FATAL_ERROR
( "bad buffer inÜibparam_scan_bytes()" );

1929 
b
->
yy_is_our_buf„r
 = 1;

1931  
b
;

1932 
	}
}

1934 #i‚de‡
YY_EXIT_FAILURE


1935 
	#YY_EXIT_FAILURE
 2

	)

1938 
	$yy_Áèl_îr‹
 (
yyc⁄°
 * 
msg
 )

1940 (Ë
	`Ârötf
–
°dîr
, "%s\n", 
msg
 );

1941 
	`exô
–
YY_EXIT_FAILURE
 );

1942 
	}
}

1946 #unde‡
yyÀss


1947 
	#yyÀss
(
n
) \

1951 
yyÀss_ma¸o_¨g
 = (
n
); \

1952 
	`YY_LESS_LINENO
(
yyÀss_ma¸o_¨g
);\

1953 
lib∑ømãxt
[
lib∑ømÀng
] = (
yy_hﬁd_ch¨
); \

1954 (
yy_c_buf_p
Ë
lib∑ømãxt
 + 
yyÀss_ma¸o_¨g
; \

1955 (
yy_hﬁd_ch¨
Ë*(
yy_c_buf_p
); \

1956 *(
yy_c_buf_p
) = '\0'; \

1957 
lib∑ømÀng
 = 
yyÀss_ma¸o_¨g
; \

1959  0 )

	)

1966 
	$lib∑ømgë_löío
 ()

1969  
lib∑ømlöío
;

1970 
	}
}

1975 
FILE
 *
	$lib∑ømgë_ö
 ()

1977  
lib∑ømö
;

1978 
	}
}

1983 
FILE
 *
	$lib∑ømgë_out
 ()

1985  
lib∑ømout
;

1986 
	}
}

1991 
yy_size_t
 
	$lib∑ømgë_Àng
 ()

1993  
lib∑ømÀng
;

1994 
	}
}

2000 *
	$lib∑ømgë_ãxt
 ()

2002  
lib∑ømãxt
;

2003 
	}
}

2009 
	$lib∑øm£t_löío
 (
löe_numbî
 )

2012 
lib∑ømlöío
 = 
löe_numbî
;

2013 
	}
}

2021 
	$lib∑øm£t_ö
 (
FILE
 * 
ö_°r
 )

2023 
lib∑ømö
 = 
ö_°r
 ;

2024 
	}
}

2026 
	$lib∑øm£t_out
 (
FILE
 * 
out_°r
 )

2028 
lib∑ømout
 = 
out_°r
 ;

2029 
	}
}

2031 
	$lib∑ømgë_debug
 ()

2033  
lib∑øm_Êex_debug
;

2034 
	}
}

2036 
	$lib∑øm£t_debug
 (
bdebug
 )

2038 
lib∑øm_Êex_debug
 = 
bdebug
 ;

2039 
	}
}

2041 
	$yy_öô_globÆs
 ()

2048 
lib∑ømlöío
 = 1;

2050 (
yy_buf„r_°ack
) = 0;

2051 (
yy_buf„r_°ack_t›
) = 0;

2052 (
yy_buf„r_°ack_max
) = 0;

2053 (
yy_c_buf_p
) = (*) 0;

2054 (
yy_öô
) = 0;

2055 (
yy_°¨t
) = 0;

2058 #ifde‡
YY_STDINIT


2059 
lib∑ømö
 = 
°dö
;

2060 
lib∑ømout
 = 
°dout
;

2062 
lib∑ømö
 = (
FILE
 *) 0;

2063 
lib∑ømout
 = (
FILE
 *) 0;

2070 
	}
}

2073 
	$lib∑ømÀx_de°roy
 ()

2077 
YY_CURRENT_BUFFER
){

2078 
	`lib∑øm_dñëe_buf„r
(
YY_CURRENT_BUFFER
 );

2079 
YY_CURRENT_BUFFER_LVALUE
 = 
NULL
;

2080 
	`lib∑ømp›_buf„r_°©e
();

2084 
	`lib∑øm‰ì
((
yy_buf„r_°ack
) );

2085 (
yy_buf„r_°ack
Ë
NULL
;

2089 
	`yy_öô_globÆs
( );

2092 
	}
}

2098 #i‚de‡
yyãxt_±r


2099 
	$yy_Êex_°∫˝y
 (* 
s1
, 
yyc⁄°
 * 
s2
, 
n
 )

2101 
i
;

2102  
i
 = 0; i < 
n
; ++i )

2103 
s1
[
i
] = 
s2
[i];

2104 
	}
}

2107 #ifde‡
YY_NEED_STRLEN


2108 
	$yy_Êex_°æí
 (
yyc⁄°
 * 
s
 )

2110 
n
;

2111  
n
 = 0; 
s
[n]; ++n )

2114  
n
;

2115 
	}
}

2118 *
	$lib∑ømÆloc
 (
yy_size_t
 
size
 )

2120  (*Ë
	`mÆloc
–
size
 );

2121 
	}
}

2123 *
	$lib∑ømªÆloc
 (* 
±r
, 
yy_size_t
 
size
 )

2132  (*Ë
	`ªÆloc
–(*Ë
±r
, 
size
 );

2133 
	}
}

2135 
	$lib∑øm‰ì
 (* 
±r
 )

2137 
	`‰ì
–(*Ë
±r
 );

2138 
	}
}

2140 
	#YYTABLES_NAME
 "yyèbÀs"

	)

	@/Users/ysoh/disksim-4.0-fcl/libparam/libparam.h

33 #i‚de‡
_LIBPARAM_LIBPARAM_H


34 
	#_LIBPARAM_LIBPARAM_H


	)

37 #ifde‡
__˝lu•lus


42 
	~<°dio.h
>

45 
Õ_block
;

47 
	#MAX_PARAM_LEN
 1024

	)

49 
	sÕ_v¨•ec
 {

50 *
«me
;

51 
ty≥
;

52 
ªq
;

59 
BLOCK
 = -1,

60 
S
 = -2,

61 
I
 = -3,

62 
D
 = -4,

63 
LIST
 = -5,

64 
TOPOSPEC
 = -6

65 } 
	tÕ_ty≥_t
;

67 *
Õ_buûtö_«mes
[];

73 
	gÕ_vÆue
;

74 
	gÕ_li°
;

76 
Õ_li°
 *
Õ_li°_add
(Õ_li° *
l
,

77 
Õ_vÆue
 *
v
);

80 
	sÕ_li°
 {

81 *
	gsour˚_fûe
;

82 
Õ_vÆue
 **
	gvÆues
;

84 
	gvÆues_Àn
;

87 
	gvÆues_p›
;

92 
	glöñí
;

95 
	sÕ_t›o•ec
 {

96 *
	gsour˚_fûe
;

97 *
	gty≥
;

98 *
	g«me
;

99 
Õ_li°
 *
	gl
;

102 
	sÕ_vÆue
 {

103 *
	gsour˚_fûe
;

105 *
	gs
;

106 
	gi
;

107 
	gd
;

108 
Õ_block
 *
	gb
;

109 
Õ_li°
 *
	gl
;

110 °ru˘ { 
Õ_t›o•ec
 *
	gl
; 
	gÀn
; } 
	gt
;

111 } 
	gv
;

113 
Õ_ty≥_t
 
	gt
;

117 
Õ_vÆue
 *
Õ_√w_ötv
();

118 
Õ_vÆue
 *
Õ_√w_doubÀv
();

119 
Õ_vÆue
 *
Õ_√w_°rögv
(*);

120 
Õ_vÆue
 *
Õ_√w_li°v
(
Õ_li°
 *);

121 
Õ_vÆue
 *
Õ_√w_blockv
(
Õ_block
 *);

124 
Õ_li°
 *
Õ_√w_li°
();

125 
Õ_block
 *
Õ_√w_block
();

129 
	sÕ_∑øm
 {

130 *
	gsour˚_fûe
;

131 *
	g«me
;

132 
Õ_vÆue
 *
	gv
;

135 
Õ_∑øm
 *
Õ_√w_∑øm
(*
«me
, *
sour˚
, 
Õ_vÆue
 *);

136 
Õ_li°
 *
Õ_√w_öéi°
(*
l
, 
Àn
);

139 
	sÕ_subty≥
 {

140 *
	gsu≥r
;

141 *
	gsub
;

142 
Õ_block
 *
	g•ec
;

146 
	sÕ_ö°
 {

147 *
	gsour˚_fûe
;

148 
Õ_li°
 *
	gl
;

149 *
	g«me
;

154 
	sÕ_ét
 {

155 *
	gsour˚_fûe
;

157 
	gTLT_BLOCK
,

158 
	gTLT_TOPO
,

159 
	gTLT_INST


160 } 
	gwh©
;

163 
Õ_ö°
 *
	gö°
;

164 
Õ_block
 *
	gblock
;

165 
Õ_t›o•ec
 *
	gt›o
;

166 } 
	gô
;

171 *(*
	tÕ_modlﬂdî_t
)(
	tÕ_block
 *, );

173 (*
	gÕ_∑ømlﬂdî_öt
)(*, );

174 (*
	gÕ_∑ømlﬂdî_doubÀ
)(*, );

175 (*
	gÕ_∑ømlﬂdî_°rög
)(*, *);

176 (*
	gÕ_∑ømlﬂdî_block
)(*, 
	tÕ_block
 *);

177 (*
	gÕ_∑ømlﬂdî_li°
)(*, 
	tÕ_li°
 *);

189 (*
	gÕ_∑ømdï_t
)(*);

193 
Õ_subty≥
 **
Õ_ty≥tbl
;

194 
Õ_ty≥tbl_Àn
;

196 
Õ_ét
 **
Õ_éts
;

197 
Õ_éts_Àn
;

199 
Õ_ét
 *
Õ_√w_é_t›o
(
Õ_t›o•ec
 *, *);

200 
Õ_ét
 *
Õ_√w_é_ö°
(
Õ_ö°
 *, *);

201 
Õ_ét
 *
Õ_√w_é_block
(
Õ_block
 *, *);

203 
Õ_add_ét
(
Õ_ét
 *);

205 
Õ_öô_ty≥tbl
();

207 
Õ_ªÀa£_ty≥tbl
();

209 
Õ_add_ty≥
(*
√wt
, *
∑ª¡
);

210 *
Õ_lookup_ty≥
(*
«me
, *);

211 *
Õ_lookup_ba£_ty≥
(*
«me
, *
n
);

214 
	#PTYPE
(
x
Ë((x)->
v
->
t
)

	)

215 
	#IVAL
(
x
Ë((x)->
v
->v.
i
)

	)

216 
	#DVAL
(
x
Ë((x)->
v
->v.
d
)

	)

217 
	#SVAL
(
x
Ë((x)->
v
->v.
s
)

	)

218 
	#BVAL
(
x
Ë((x)->
v
->v.
b
)

	)

219 
	#LVAL
(
x
Ë((x)->
v
->v.
l
)

	)

222 
	#BTYPE
(
x
Ë((x)->
ty≥
)

	)

227 
	#RANGE
(
x
,
y
,
z
Ë(((xË>(y)Ë&& ((xË<(z)))

	)

228 
	#BADVALMSG
(
N
Ë
	`Ârötf
(
°dîr
, "***Éº‹: Bad vÆuêf‹ %s\n", N);

	)

231 
lﬂd_block
(
Õ_block
 *);

232 
lﬂd_t›o
(
Õ_t›o•ec
 *
t
, );

235 (*
	gÕ_t›ﬁﬂdî_t
)(
	tÕ_t›o•ec
 *
	tt
, );

236 
Õ_ªgi°î_t›ﬁﬂdî
(
Õ_t›ﬁﬂdî_t
);

239 
	sÕ_block_vÆ
 {

240 
Õ_∑øm
 **
	g∑øms
;

241 
	g∑øms_Àn
;

245 
	sÕ_block
 {

246 *
	gsour˚_fûe
;

247 *
	g«me
;

248 
	gty≥
;

249 
Õ_modlﬂdî_t
 
	glﬂdî
;

251 
Õ_∑øm
 **
	g∑øms
;

253 
	g∑øms_Àn
;

259 
push_fûe
(
FILE
 *
f
);

260 
disksim_∑ømwøp
();

262 
	sÕ_öput_fûe
 {

263 
yy_buf„r_°©e
 *
	gb
;

264 
	glöío
;

265 *
	gfûíame
;

268 
Õ_öput_fûe
 
öput_fûes
[];

270 
t›_fûe
;

271 
FILE
 *
lib∑ømö
;

273 *
Õ_fûíame
;

274 *
Õ_cwd
;

276 
	#LP_MAX_SP
 128

	)

277 **
Õ_£¨ch∑th
;

278 
Õ_£¨ch∑th_Àn
;

279 
Õ_löío
;

283 
Õ_ovîride_ö°
(
Õ_block
 *
b
,

284 *
˙ame
,

285 
Õ_modlﬂdî_t
 
lﬂdî
,

286 **
ovîrides
,

287 
ovîrides_Àn
);

290 (*
	gÕ_lﬂd_ˇŒback
)(*, *);

293 
	sÕ_mod
 {

295 *
	g«me
;

298 
Õ_v¨•ec
 *
	gmodv¨s
;

299 
	gmodv¨s_Àn
;

302 
Õ_modlﬂdî_t
 
	g‚
;

309 
Õ_lﬂd_ˇŒback
 
	gˇŒback
;

310 *
	g˘x
;

314 **
	g∑øm_lﬂdîs
;

315 
Õ_∑ømdï_t
 *
	g∑øm_dïs
;

318 
Õ_mod
 **
Õ_moduÀs
;

323 
Õ_ªgi°î_moduÀ
(
Õ_mod
 *);

331 **
Õ_ovîrides
;

332 
Õ_ovîrides_Àn
;

335 
u≈¨£_∑øm
(
Õ_∑øm
 *
p
, 
FILE
 *
outfûe
);

336 
u≈¨£_li°
(
Õ_li°
 *
l
, 
FILE
 *
outfûe
);

337 
u≈¨£_block
(
Õ_block
 *
b
, 
FILE
 *
outfûe
);

338 
u≈¨£_vÆue
(
Õ_vÆue
 *
v
, 
FILE
 *
outfûe
);

339 
u≈¨£_t›o•ec
(
Õ_t›o•ec
 *
t
, 
FILE
 *
outfûe
);

340 
u≈¨£_ty≥
(, 
FILE
 *);

341 
Õ_u≈¨£_éts
(
Õ_ét
 **, , 
FILE
 *, *);

346 
Õ_block
 *
Õ_lookup_•ec
(*
«me
);

349 
Õ_£tup_subty≥
(
Õ_block
 *
∑ª¡
,

350 
Õ_block
 *
chûd
);

352 
Õ_add_∑øm
(
Õ_∑øm
 ***
b
, *
∂í
,

353 
Õ_∑øm
 *
p
);

357 
Õ_∑øm_«me
(, *);

358 
Õ_mod_«me
(*);

364 
Õ_lﬂdfûe
(
FILE
 *
ö
, 
Õ_ét
 ***, *, *, **, );

367 
Õ_de°roy
(
Õ_ét
 **
±
, 
Àn
);

369 *
Õ_ö°™tüã
(*
èrg
, *
«me
);

373 
Õ_lﬂd∑øms
(*
ô
, 
Õ_block
 *
b
, 
Õ_mod
 *
m
);

376 
	#LP_PATH_MAX
 1024

	)

380 *
Õ_£¨ch_∑th
(*
cwd
, *
«me
);

382 
Õ_ö°_li°
(
Õ_ö°
 *
i
);

384 
dumb_•lô
(*
s
, **
t
, *
i
);

387 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/libparam/libparam.tab.c

44 
	#YYBISON
 1

	)

47 
	#YYBISON_VERSION
 "2.5"

	)

50 
	#YYSKELETON_NAME
 "yacc.c"

	)

53 
	#YYPURE
 0

	)

56 
	#YYPUSH
 0

	)

59 
	#YYPULL
 1

	)

62 
	#YYLSP_NEEDED
 0

	)

65 
	#yy∑r£
 
lib∑øm∑r£


	)

66 
	#yyÀx
 
lib∑ømÀx


	)

67 
	#yyîr‹
 
lib∑ømîr‹


	)

68 
	#yylvÆ
 
lib∑ømlvÆ


	)

69 
	#yych¨
 
lib∑ømch¨


	)

70 
	#yydebug
 
lib∑ømdebug


	)

71 
	#yy√ºs
 
lib∑øm√ºs


	)

79 
	~<°dlib.h
>

80 
	~<°dio.h
>

81 
	~<°rög.h
>

82 
	~<libddbg/libddbg.h
>

83 
	~"lib∑øm.h
"

85 
	#YYERROR_VERBOSE


	)

87 
	$yyîr‹
 (*
s
) {

88 
	`Ârötf
(
°dîr
, "***Éº‹: o¿löê%d o‡%s: ", 
Õ_löío
, 
Õ_fûíame
);

89 
	`Ârötf
(
°dîr
, "%s\n", 
s
);

90 
	}
}

98 #i‚de‡
YYDEBUG


99 
	#YYDEBUG
 0

	)

103 #ifde‡
YYERROR_VERBOSE


104 #unde‡
YYERROR_VERBOSE


105 
	#YYERROR_VERBOSE
 1

	)

107 
	#YYERROR_VERBOSE
 0

	)

111 #i‚de‡
YYTOKEN_TABLE


112 
	#YYTOKEN_TABLE
 0

	)

117 #i‚de‡
YYTOKENTYPE


118 
	#YYTOKENTYPE


	)

121 
	eyytokíty≥
 {

122 
	mLBRACE
 = 258,

123 
	mRBRACE
 = 259,

124 
	mSEMI
 = 260,

125 
	mEQUAL
 = 261,

126 
	mTRUE
 = 262,

127 
	mFALSE
 = 263,

128 
	mDECINT
 = 264,

129 
	mHEXINT
 = 265,

130 
	mFLOAT
 = 266,

131 
	mSTRING
 = 267,

132 
	mLBRAK
 = 268,

133 
	mRBRAK
 = 269,

134 
	mCOMMA
 = 270,

135 
	mQU
 = 271,

136 
	mCOLON
 = 272,

137 
	mNEWLINE
 = 273,

138 
	mSOURCE
 = 274,

139 
	mDOTDOT
 = 275,

140 
	mAS
 = 276,

141 
	mINSTANTIATE
 = 277,

142 
	mTOPOLOGY
 = 278

148 #i‡! 
deföed
 
YYSTYPE
 && ! deföed 
YYSTYPE_IS_DECLARED


149 
	uYYSTYPE


155 
	md
;

156 
	mi
;

157 *
	ms
;

159 
Õ_block
 *
	mb
;

160 °ru˘ { 
Õ_block
 **
	mb
; 
	mbÀn
; } 
	mblocks
;

162 
Õ_∑øm
 *
	mp
;

163 °ru˘ { 
Õ_∑øm
 **
	mp
; 
	m∂í
; } 
	m∑øms
;

165 
Õ_li°
 *
	ml
;

167 
Õ_vÆue
 *
	mv
;

169 °ru˘ { 
Õ_t›o•ec
 *
	ml
; 
	mÀn
; } 
	mt›o
;

170 
Õ_ö°
 *
	mö°
;

176 } 
	tYYSTYPE
;

177 
	#YYSTYPE_IS_TRIVIAL
 1

	)

178 
	#yy°y≥
 
YYSTYPE


	)

179 
	#YYSTYPE_IS_DECLARED
 1

	)

193 #ifde‡
YYTYPE_UINT8


194 
YYTYPE_UINT8
 
	tyyty≥_uöt8
;

196 
	tyyty≥_uöt8
;

199 #ifde‡
YYTYPE_INT8


200 
YYTYPE_INT8
 
	tyyty≥_öt8
;

201 #ñi‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

202 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

203 sig√d 
	tyyty≥_öt8
;

205 
	tyyty≥_öt8
;

208 #ifde‡
YYTYPE_UINT16


209 
YYTYPE_UINT16
 
	tyyty≥_uöt16
;

211 
	tyyty≥_uöt16
;

214 #ifde‡
YYTYPE_INT16


215 
YYTYPE_INT16
 
	tyyty≥_öt16
;

217 
	tyyty≥_öt16
;

220 #i‚de‡
YYSIZE_T


221 #ifde‡
__SIZE_TYPE__


222 
	#YYSIZE_T
 
__SIZE_TYPE__


	)

223 #ñi‡
deföed
 
size_t


224 
	#YYSIZE_T
 
size_t


	)

225 #ñi‡! 
deföed
 
YYSIZE_T
 && (deföed 
__STDC__
 || deföed 
__C99__FUNC__
 \

226 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

227 
	~<°ddef.h
>

228 
	#YYSIZE_T
 
size_t


	)

230 
	#YYSIZE_T
 

	)

234 
	#YYSIZE_MAXIMUM
 ((
YYSIZE_T
Ë-1)

	)

236 #i‚de‡
YY_


237 #i‡
deföed
 
YYENABLE_NLS
 && YYENABLE_NLS

238 #i‡
ENABLE_NLS


239 
	~<liböé.h
>

240 
	#YY_
(
msgid
Ë
	`dgëãxt
 ("bis⁄-ru¡ime", msgid)

	)

243 #i‚de‡
YY_


244 
	#YY_
(
msgid
Ë
	)
msgid

249 #i‡! 
deföed
 
löt
 || deföed 
__GNUC__


250 
	#YYUSE
(
e
Ë((Ë”))

	)

252 
	#YYUSE
(
e
Ë

	)

256 #i‚de‡
löt


257 
	#YYID
(
n
Ë“)

	)

259 #i‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

260 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

262 
	$YYID
 (
yyi
)

265 
	$YYID
 (
yyi
)

266 
yyi
;

269  
yyi
;

270 
	}
}

273 #i‡! 
deföed
 
yyovîÊow
 || 
YYERROR_VERBOSE


277 #ifde‡
YYSTACK_USE_ALLOCA


278 #i‡
YYSTACK_USE_ALLOCA


279 #ifde‡
__GNUC__


280 
	#YYSTACK_ALLOC
 
__buûtö_Æloˇ


	)

281 #ñi‡
deföed
 
__BUILTIN_VA_ARG_INCR


282 
	~<Æloˇ.h
>

283 #ñi‡
deföed
 
_AIX


284 
	#YYSTACK_ALLOC
 
__Æloˇ


	)

285 #ñi‡
deföed
 
_MSC_VER


286 
	~<mÆloc.h
>

287 
	#Æloˇ
 
_Æloˇ


	)

289 
	#YYSTACK_ALLOC
 
Æloˇ


	)

290 #i‡! 
deföed
 
_ALLOCA_H
 && ! deföed 
EXIT_SUCCESS
 && (deföed 
__STDC__
 || deföed 
__C99__FUNC__
 \

291 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

292 
	~<°dlib.h
>

293 #i‚de‡
EXIT_SUCCESS


294 
	#EXIT_SUCCESS
 0

	)

301 #ifde‡
YYSTACK_ALLOC


303 
	#YYSTACK_FREE
(
På
Ëdÿ{ ; } 
	`YYID
 (0))

	)

304 #i‚de‡
YYSTACK_ALLOC_MAXIMUM


309 
	#YYSTACK_ALLOC_MAXIMUM
 4032

	)

312 
	#YYSTACK_ALLOC
 
YYMALLOC


	)

313 
	#YYSTACK_FREE
 
YYFREE


	)

314 #i‚de‡
YYSTACK_ALLOC_MAXIMUM


315 
	#YYSTACK_ALLOC_MAXIMUM
 
YYSIZE_MAXIMUM


	)

317 #i‡(
deföed
 
__˝lu•lus
 && ! deföed 
EXIT_SUCCESS
 \

318 && ! ((
deföed
 
	gYYMALLOC
 || deföed 
	gmÆloc
) \

319 && (
deföed
 
	gYYFREE
 || deföed 
	g‰ì
)))

320 
	~<°dlib.h
>

321 #i‚de‡
EXIT_SUCCESS


322 
	#EXIT_SUCCESS
 0

	)

325 #i‚de‡
YYMALLOC


326 
	#YYMALLOC
 
mÆloc


	)

327 #i‡! 
deföed
 
mÆloc
 && ! deföed 
EXIT_SUCCESS
 && (deföed 
__STDC__
 || deföed 
__C99__FUNC__
 \

328 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

329 *
mÆloc
 (
YYSIZE_T
);

332 #i‚de‡
YYFREE


333 
	#YYFREE
 
‰ì


	)

334 #i‡! 
deföed
 
‰ì
 && ! deföed 
EXIT_SUCCESS
 && (deföed 
__STDC__
 || deföed 
__C99__FUNC__
 \

335 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

336 
‰ì
 (*);

343 #i‡(! 
deföed
 
yyovîÊow
 \

344 && (! 
deföed
 
	g__˝lu•lus
 \

345 || (
deföed
 
	gYYSTYPE_IS_TRIVIAL
 && YYSTYPE_IS_TRIVIAL)))

348 
	uyyÆloc


350 
yyty≥_öt16
 
	myyss_Æloc
;

351 
YYSTYPE
 
	myyvs_Æloc
;

355 
	#YYSTACK_GAP_MAXIMUM
 ( (
yyÆloc
Ë- 1)

	)

359 
	#YYSTACK_BYTES
(
N
) \

360 ((
N
Ë* ( (
yyty≥_öt16
Ë+  (
YYSTYPE
)) \

361 + 
YYSTACK_GAP_MAXIMUM
)

	)

363 
	#YYCOPY_NEEDED
 1

	)

370 
	#YYSTACK_RELOCATE
(
Sèck_Æloc
, 
Sèck
) \

373 
YYSIZE_T
 
yy√wbyãs
; \

374 
	`YYCOPY
 (&
yy±r
->
Sèck_Æloc
, 
Sèck
, 
yysize
); \

375 
Sèck
 = &
yy±r
->
Sèck_Æloc
; \

376 
yy√wbyãs
 = 
yy°acksize
 *  (*
Sèck
Ë+ 
YYSTACK_GAP_MAXIMUM
; \

377 
yy±r
 +
yy√wbyãs
 /  (*yyptr); \

379 
	`YYID
 (0))

	)

383 #i‡
deföed
 
YYCOPY_NEEDED
 && YYCOPY_NEEDED

386 #i‚de‡
YYCOPY


387 #i‡
deföed
 
__GNUC__
 && 1 < __GNUC__

388 
	#YYCOPY
(
To
, 
From
, 
Cou¡
) \

389 
	`__buûtö_mem˝y
 (
To
, 
From
, (
Cou¡
Ë*  (*(From)))

	)

391 
	#YYCOPY
(
To
, 
From
, 
Cou¡
) \

394 
YYSIZE_T
 
yyi
; \

395 
yyi
 = 0; yyò< (
Cou¡
); yyi++) \

396 (
To
)[
yyi
] = (
From
)[yyi]; \

398 
	`YYID
 (0))

	)

404 
	#YYFINAL
 2

	)

406 
	#YYLAST
 63

	)

409 
	#YYNTOKENS
 24

	)

411 
	#YYNNTS
 13

	)

413 
	#YYNRULES
 32

	)

415 
	#YYNSTATES
 58

	)

418 
	#YYUNDEFTOK
 2

	)

419 
	#YYMAXUTOK
 278

	)

421 
	#YYTRANSLATE
(
YYX
) \

422 ((Ë(
YYX
Ë<
YYMAXUTOK
 ? 
yyå™¶©e
[YYX] : 
YYUNDEFTOK
)

	)

425 c⁄° 
yyty≥_uöt8
 
	gyyå™¶©e
[] =

457 #i‡
YYDEBUG


460 c⁄° 
yyty≥_uöt8
 
	gyy¥hs
[] =

469 c⁄° 
yyty≥_öt8
 
	gyyrhs
[] =

484 c⁄° 
yyty≥_uöt16
 
	gyyæöe
[] =

493 #i‡
YYDEBUG
 || 
YYERROR_VERBOSE
 || 
YYTOKEN_TABLE


496 c⁄° *c⁄° 
	gyyäame
[] =

507 #ifde‡
YYPRINT


510 c⁄° 
yyty≥_uöt16
 
	gyytoknum
[] =

519 c⁄° 
yyty≥_uöt8
 
	gyyr1
[] =

528 c⁄° 
yyty≥_uöt8
 
	gyyr2
[] =

539 c⁄° 
yyty≥_uöt8
 
	gyydeÁ˘
[] =

550 c⁄° 
yyty≥_öt8
 
	gyydefgŸo
[] =

558 
	#YYPACT_NINF
 -35

	)

559 c⁄° 
yyty≥_öt8
 
	gyy∑˘
[] =

570 c⁄° 
yyty≥_öt8
 
	gyypgŸo
[] =

579 
	#YYTABLE_NINF
 -1

	)

580 c⁄° 
yyty≥_uöt8
 
	gyyèbÀ
[] =

591 
	#yy∑˘_vÆue_is_deÁu…
(
yy°©e
) \

592 ((
yy°©e
Ë=(-35))

	)

594 
	#yyèbÀ_vÆue_is_îr‹
(
yyèbÀ_vÆue
) \

595 
	`YYID
 (0)

	)

597 c⁄° 
yyty≥_uöt8
 
	gyycheck
[] =

610 c⁄° 
yyty≥_uöt8
 
	gyy°os
[] =

620 
	#yyîrok
 (
yyîr°©us
 = 0)

	)

621 
	#yy˛órö
 (
yych¨
 = 
YYEMPTY
)

	)

622 
	#YYEMPTY
 (-2)

	)

623 
	#YYEOF
 0

	)

625 
	#YYACCEPT
 
yyac˚±œb


	)

626 
	#YYABORT
 
yyab‹éab


	)

627 
	#YYERROR
 
yyîr‹œb


	)

637 
	#YYFAIL
 
yyîæab


	)

638 #i‡
deföed
 
YYFAIL


645 
	#YYRECOVERING
(Ë(!!
yyîr°©us
)

	)

647 
	#YYBACKUP
(
Tokí
, 
VÆue
) \

649 i‡(
yych¨
 =
YYEMPTY
 && 
yyÀn
 == 1) \

651 
yych¨
 = (
Tokí
); \

652 
yylvÆ
 = (
VÆue
); \

653 
	`YYPOPSTACK
 (1); \

654 
yybackup
; \

658 
	`yyîr‹
 (
	`YY_
("syntaxÉrror: cannot back up")); \

659 
YYERROR
; \

661 
	`YYID
 (0))

	)

664 
	#YYTERROR
 1

	)

665 
	#YYERRCODE
 256

	)

672 
	#YYRHSLOC
(
Rhs
, 
K
Ë((Rhs)[K])

	)

673 #i‚de‡
YYLLOC_DEFAULT


674 
	#YYLLOC_DEFAULT
(
Cuºít
, 
Rhs
, 
N
) \

676 i‡(
	`YYID
 (
N
)) \

678 (
Cuºít
).
fú°_löe
 = 
	`YYRHSLOC
 (
Rhs
, 1).first_line; \

679 (
Cuºít
).
fú°_cﬁumn
 = 
	`YYRHSLOC
 (
Rhs
, 1).first_column; \

680 (
Cuºít
).
œ°_löe
 = 
	`YYRHSLOC
 (
Rhs
, 
N
).last_line; \

681 (
Cuºít
).
œ°_cﬁumn
 = 
	`YYRHSLOC
 (
Rhs
, 
N
).last_column; \

685 (
Cuºít
).
fú°_löe
 = (Cuºít).
œ°_löe
 = \

686 
	`YYRHSLOC
 (
Rhs
, 0).
œ°_löe
; \

687 (
Cuºít
).
fú°_cﬁumn
 = (Cuºít).
œ°_cﬁumn
 = \

688 
	`YYRHSLOC
 (
Rhs
, 0).
œ°_cﬁumn
; \

690 
	`YYID
 (0))

	)

696 #i‚de‡
YY_LOCATION_PRINT


697 
	#YY_LOCATION_PRINT
(
Fûe
, 
Loc
Ë((Ë0)

	)

703 #ifde‡
YYLEX_PARAM


704 
	#YYLEX
 
	`yyÀx
 (
YYLEX_PARAM
)

	)

706 
	#YYLEX
 
	`yyÀx
 ()

	)

710 #i‡
YYDEBUG


712 #i‚de‡
YYFPRINTF


713 
	~<°dio.h
>

714 
	#YYFPRINTF
 
Ârötf


	)

717 
	#YYDPRINTF
(
Args
) \

719 i‡(
yydebug
) \

720 
YYFPRINTF
 
Args
; \

721 } 
	`YYID
 (0))

	)

723 
	#YY_SYMBOL_PRINT
(
TôÀ
, 
Ty≥
, 
VÆue
, 
Loˇti⁄
) \

725 i‡(
yydebug
) \

727 
	`YYFPRINTF
 (
°dîr
, "%†", 
TôÀ
); \

728 
	`yy_symbﬁ_¥öt
 (
°dîr
, \

729 
Ty≥
, 
VÆue
); \

730 
	`YYFPRINTF
 (
°dîr
, "\n"); \

732 } 
	`YYID
 (0))

	)

740 #i‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

741 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

743 
	$yy_symbﬁ_vÆue_¥öt
 (
FILE
 *
yyouçut
, 
yyty≥
, 
YYSTYPE
 c⁄° * c⁄° 
yyvÆuï
)

746 
	$yy_symbﬁ_vÆue_¥öt
 (
yyouçut
, 
yyty≥
, 
yyvÆuï
)

747 
FILE
 *
yyouçut
;

748 
yyty≥
;

749 
YYSTYPE
 c⁄° * c⁄° 
yyvÆuï
;

752 i‡(!
yyvÆuï
)

754 #ifde‡
YYPRINT


755 i‡(
yyty≥
 < 
YYNTOKENS
)

756 
	`YYPRINT
 (
yyouçut
, 
yytoknum
[
yyty≥
], *
yyvÆuï
);

758 
	`YYUSE
 (
yyouçut
);

760 
yyty≥
)

765 
	}
}

772 #i‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

773 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

775 
	$yy_symbﬁ_¥öt
 (
FILE
 *
yyouçut
, 
yyty≥
, 
YYSTYPE
 c⁄° * c⁄° 
yyvÆuï
)

778 
	$yy_symbﬁ_¥öt
 (
yyouçut
, 
yyty≥
, 
yyvÆuï
)

779 
FILE
 *
yyouçut
;

780 
yyty≥
;

781 
YYSTYPE
 c⁄° * c⁄° 
yyvÆuï
;

784 i‡(
yyty≥
 < 
YYNTOKENS
)

785 
	`YYFPRINTF
 (
yyouçut
, "tokí %†(", 
yyäame
[
yyty≥
]);

787 
	`YYFPRINTF
 (
yyouçut
, "¡îm %†(", 
yyäame
[
yyty≥
]);

789 
	`yy_symbﬁ_vÆue_¥öt
 (
yyouçut
, 
yyty≥
, 
yyvÆuï
);

790 
	`YYFPRINTF
 (
yyouçut
, ")");

791 
	}
}

798 #i‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

799 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

801 
	$yy_°ack_¥öt
 (
yyty≥_öt16
 *
yybŸtom
, yyty≥_öt16 *
yyt›
)

804 
	$yy_°ack_¥öt
 (
yybŸtom
, 
yyt›
)

805 
yyty≥_öt16
 *
yybŸtom
;

806 
yyty≥_öt16
 *
yyt›
;

809 
	`YYFPRINTF
 (
°dîr
, "StackÇow");

810 ; 
yybŸtom
 <
yyt›
; yybottom++)

812 
yybŸ
 = *
yybŸtom
;

813 
	`YYFPRINTF
 (
°dîr
, " %d", 
yybŸ
);

815 
	`YYFPRINTF
 (
°dîr
, "\n");

816 
	}
}

818 
	#YY_STACK_PRINT
(
BŸtom
, 
T›
) \

820 i‡(
yydebug
) \

821 
	`yy_°ack_¥öt
 ((
BŸtom
), (
T›
)); \

822 } 
	`YYID
 (0))

	)

829 #i‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

830 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

832 
	$yy_ªdu˚_¥öt
 (
YYSTYPE
 *
yyv•
, 
yyruÀ
)

835 
	$yy_ªdu˚_¥öt
 (
yyv•
, 
yyruÀ
)

836 
YYSTYPE
 *
yyv•
;

837 
yyruÀ
;

840 
yyƒhs
 = 
yyr2
[
yyruÀ
];

841 
yyi
;

842 
yy o
 = 
yyæöe
[
yyruÀ
];

843 
	`YYFPRINTF
 (
°dîr
, "Reducing stack byÑule %d (line %lu):\n",

844 
yyruÀ
 - 1, 
yy o
);

846 
yyi
 = 0; yyò< 
yyƒhs
; yyi++)

848 
	`YYFPRINTF
 (
°dîr
, " $%d = ", 
yyi
 + 1);

849 
	`yy_symbﬁ_¥öt
 (
°dîr
, 
yyrhs
[
yy¥hs
[
yyruÀ
] + 
yyi
],

850 &(
yyv•
[(
yyi
 + 1Ë- (
yyƒhs
)])

852 
	`YYFPRINTF
 (
°dîr
, "\n");

854 
	}
}

856 
	#YY_REDUCE_PRINT
(
RuÀ
) \

858 i‡(
yydebug
) \

859 
	`yy_ªdu˚_¥öt
 (
yyv•
, 
RuÀ
); \

860 } 
	`YYID
 (0))

	)

864 
	gyydebug
;

866 
	#YYDPRINTF
(
Args
)

	)

867 
	#YY_SYMBOL_PRINT
(
TôÀ
, 
Ty≥
, 
VÆue
, 
Loˇti⁄
)

	)

868 
	#YY_STACK_PRINT
(
BŸtom
, 
T›
)

	)

869 
	#YY_REDUCE_PRINT
(
RuÀ
)

	)

874 #i‚def 
YYINITDEPTH


875 
	#YYINITDEPTH
 200

	)

885 #i‚de‡
YYMAXDEPTH


886 
	#YYMAXDEPTH
 10000

	)

890 #i‡
YYERROR_VERBOSE


892 #i‚de‡
yy°æí


893 #i‡
deföed
 
__GLIBC__
 && deföed 
_STRING_H


894 
	#yy°æí
 
°æí


	)

897 #i‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

898 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

899 
YYSIZE_T


900 
	$yy°æí
 (c⁄° *
yy°r
)

902 
YYSIZE_T


903 
	$yy°æí
 (
yy°r
)

904 c⁄° *
yy°r
;

907 
YYSIZE_T
 
yyÀn
;

908 
yyÀn
 = 0; 
yy°r
[yylen]; yylen++)

910  
yyÀn
;

911 
	}
}

915 #i‚de‡
yy°p˝y


916 #i‡
deföed
 
__GLIBC__
 && deföed 
_STRING_H
 && deföed 
_GNU_SOURCE


917 
	#yy°p˝y
 
°p˝y


	)

921 #i‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

922 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

924 
	$yy°p˝y
 (*
yyde°
, c⁄° *
yy§c
)

927 
	$yy°p˝y
 (
yyde°
, 
yy§c
)

928 *
yyde°
;

929 c⁄° *
yy§c
;

932 *
yyd
 = 
yyde°
;

933 c⁄° *
yys
 = 
yy§c
;

935 (*
yyd
++ = *
yys
++) != '\0')

938  
yyd
 - 1;

939 
	}
}

943 #i‚de‡
yyäamîr


951 
YYSIZE_T


952 
	$yyäamîr
 (*
yyªs
, c⁄° *
yy°r
)

954 i‡(*
yy°r
 == '"')

956 
YYSIZE_T
 
yyn
 = 0;

957 c⁄° *
yyp
 = 
yy°r
;

960 *++
yyp
)

964 
do_nŸ_°rù_quŸes
;

967 i‡(*++
yyp
 != '\\')

968 
do_nŸ_°rù_quŸes
;

971 i‡(
yyªs
)

972 
yyªs
[
yyn
] = *
yyp
;

973 
yyn
++;

977 i‡(
yyªs
)

978 
yyªs
[
yyn
] = '\0';

979  
yyn
;

981 
do_nŸ_°rù_quŸes
: ;

984 i‡(! 
yyªs
)

985  
	`yy°æí
 (
yy°r
);

987  
	`yy°p˝y
 (
yyªs
, 
yy°r
) - yyres;

988 
	}
}

1000 
	$yysy¡ax_îr‹
 (
YYSIZE_T
 *
yymsg_Æloc
, **
yymsg
,

1001 
yyty≥_öt16
 *
yys•
, 
yytokí
)

1003 
YYSIZE_T
 
yysize0
 = 
	`yyäamîr
 (0, 
yyäame
[
yytokí
]);

1004 
YYSIZE_T
 
yysize
 = 
yysize0
;

1005 
YYSIZE_T
 
yysize1
;

1006 íum { 
YYERROR_VERBOSE_ARGS_MAXIMUM
 = 5 };

1008 c⁄° *
yyf‹m©
 = 0;

1010 c⁄° *
yy¨g
[
YYERROR_VERBOSE_ARGS_MAXIMUM
];

1013 
yycou¡
 = 0;

1042 i‡(
yytokí
 !
YYEMPTY
)

1044 
yyn
 = 
yy∑˘
[*
yys•
];

1045 
yy¨g
[
yycou¡
++] = 
yyäame
[
yytokí
];

1046 i‡(!
	`yy∑˘_vÆue_is_deÁu…
 (
yyn
))

1051 
yyxbegö
 = 
yyn
 < 0 ? -yyn : 0;

1053 
yychecklim
 = 
YYLAST
 - 
yyn
 + 1;

1054 
yyxíd
 = 
yychecklim
 < 
YYNTOKENS
 ? yychecklim : YYNTOKENS;

1055 
yyx
;

1057 
yyx
 = 
yyxbegö
; yyx < 
yyxíd
; ++yyx)

1058 i‡(
yycheck
[
yyx
 + 
yyn
] =yyx && yyx !
YYTERROR


1059 && !
	`yyèbÀ_vÆue_is_îr‹
 (
yyèbÀ
[
yyx
 + 
yyn
]))

1061 i‡(
yycou¡
 =
YYERROR_VERBOSE_ARGS_MAXIMUM
)

1063 
yycou¡
 = 1;

1064 
yysize
 = 
yysize0
;

1067 
yy¨g
[
yycou¡
++] = 
yyäame
[
yyx
];

1068 
yysize1
 = 
yysize
 + 
	`yyäamîr
 (0, 
yyäame
[
yyx
]);

1069 i‡(! (
yysize
 <
yysize1


1070 && 
yysize1
 <
YYSTACK_ALLOC_MAXIMUM
))

1072 
yysize
 = 
yysize1
;

1077 
yycou¡
)

1079 
	#YYCASE_
(
N
, 
S
) \

1080 
N
: \

1081 
yyf‹m©
 = 
S
; \

1082 

	)

1083 
	`YYCASE_
(0, 
	`YY_
("syntaxÉrror"));

1084 
	`YYCASE_
(1, 
	`YY_
("syntaxÉrror, unexpected %s"));

1085 
	`YYCASE_
(2, 
	`YY_
("syntaxÉrror, unexpected %s,Éxpecting %s"));

1086 
	`YYCASE_
(3, 
	`YY_
("syntaxÉrror, unexpected %s,Éxpecting %s or %s"));

1087 
	`YYCASE_
(4, 
	`YY_
("syntaxÉrror, unexpected %s,Éxpecting %s or %s or %s"));

1088 
	`YYCASE_
(5, 
	`YY_
("syntaxÉrror, unexpected %s,Éxpecting %s or %s or %s or %s"));

1089 #unde‡
YYCASE_


1092 
yysize1
 = 
yysize
 + 
	`yy°æí
 (
yyf‹m©
);

1093 i‡(! (
yysize
 <
yysize1
 && yysize1 <
YYSTACK_ALLOC_MAXIMUM
))

1095 
yysize
 = 
yysize1
;

1097 i‡(*
yymsg_Æloc
 < 
yysize
)

1099 *
yymsg_Æloc
 = 2 * 
yysize
;

1100 i‡(! (
yysize
 <*
yymsg_Æloc


1101 && *
yymsg_Æloc
 <
YYSTACK_ALLOC_MAXIMUM
))

1102 *
yymsg_Æloc
 = 
YYSTACK_ALLOC_MAXIMUM
;

1110 *
yyp
 = *
yymsg
;

1111 
yyi
 = 0;

1112 (*
yyp
 = *
yyf‹m©
) != '\0')

1113 i‡(*
yyp
 ='%' && 
yyf‹m©
[1] ='s' && 
yyi
 < 
yycou¡
)

1115 
yyp
 +
	`yyäamîr
 (yyp, 
yy¨g
[
yyi
++]);

1116 
yyf‹m©
 += 2;

1120 
yyp
++;

1121 
yyf‹m©
++;

1125 
	}
}

1133 #i‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

1134 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

1136 
	$yyde°ru˘
 (c⁄° *
yymsg
, 
yyty≥
, 
YYSTYPE
 *
yyvÆuï
)

1139 
	$yyde°ru˘
 (
yymsg
, 
yyty≥
, 
yyvÆuï
)

1140 c⁄° *
yymsg
;

1141 
yyty≥
;

1142 
YYSTYPE
 *
yyvÆuï
;

1145 
	`YYUSE
 (
yyvÆuï
);

1147 i‡(!
yymsg
)

1148 
yymsg
 = "Deleting";

1149 
	`YY_SYMBOL_PRINT
 (
yymsg
, 
yyty≥
, 
yyvÆuï
, 
yyloˇti⁄p
);

1151 
yyty≥
)

1157 
	}
}

1161 #ifde‡
YYPARSE_PARAM


1162 #i‡
deföed
 
__STDC__
 || deföed 
__˝lu•lus


1163 
yy∑r£
 (*
YYPARSE_PARAM
);

1165 
yy∑r£
 ();

1168 #i‡
deföed
 
__STDC__
 || deföed 
__˝lu•lus


1169 
yy∑r£
 ();

1171 
yy∑r£
 ();

1177 
	gyych¨
;

1180 
YYSTYPE
 
	gyylvÆ
;

1183 
	gyy√ºs
;

1190 #ifde‡
YYPARSE_PARAM


1191 #i‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

1192 || 
deföed
 
	g__˝lu•lus
 || deföed 
	g_MSC_VER
)

1194 
	$yy∑r£
 (*
YYPARSE_PARAM
)

1197 
	$yy∑r£
 (
YYPARSE_PARAM
)

1198 *
YYPARSE_PARAM
;

1201 #i‡(
deföed
 
__STDC__
 || deföed 
__C99__FUNC__
 \

1202 || 
deföed
 
__˝lu•lus
 || deföed 
_MSC_VER
)

1204 
	$yy∑r£
 ()

1207 
	$yy∑r£
 ()

1212 
yy°©e
;

1214 
yyîr°©us
;

1224 
yyty≥_öt16
 
yysß
[
YYINITDEPTH
];

1225 
yyty≥_öt16
 *
yyss
;

1226 
yyty≥_öt16
 *
yys•
;

1229 
YYSTYPE
 
yyvß
[
YYINITDEPTH
];

1230 
YYSTYPE
 *
yyvs
;

1231 
YYSTYPE
 *
yyv•
;

1233 
YYSIZE_T
 
yy°acksize
;

1235 
yyn
;

1236 
yyªsu…
;

1238 
yytokí
;

1241 
YYSTYPE
 
yyvÆ
;

1243 #i‡
YYERROR_VERBOSE


1245 
yymsgbuf
[128];

1246 *
yymsg
 = 
yymsgbuf
;

1247 
YYSIZE_T
 
yymsg_Æloc
 =  
yymsgbuf
;

1250 
	#YYPOPSTACK
(
N
Ë(
yyv•
 -(N), 
yys•
 -(N))

	)

1254 
yyÀn
 = 0;

1256 
yytokí
 = 0;

1257 
yyss
 = 
yysß
;

1258 
yyvs
 = 
yyvß
;

1259 
yy°acksize
 = 
YYINITDEPTH
;

1261 
	`YYDPRINTF
 ((
°dîr
, "StartingÖarse\n"));

1263 
yy°©e
 = 0;

1264 
yyîr°©us
 = 0;

1265 
yy√ºs
 = 0;

1266 
yych¨
 = 
YYEMPTY
;

1272 
yys•
 = 
yyss
;

1273 
yyv•
 = 
yyvs
;

1275 
yy£t°©e
;

1280 
yy√w°©e
:

1283 
yys•
++;

1285 
yy£t°©e
:

1286 *
yys•
 = 
yy°©e
;

1288 i‡(
yyss
 + 
yy°acksize
 - 1 <
yys•
)

1291 
YYSIZE_T
 
yysize
 = 
yys•
 - 
yyss
 + 1;

1293 #ifde‡
yyovîÊow


1298 
YYSTYPE
 *
yyvs1
 = 
yyvs
;

1299 
yyty≥_öt16
 *
yyss1
 = 
yyss
;

1305 
	`yyovîÊow
 (
	`YY_
("memoryÉxhausted"),

1306 &
yyss1
, 
yysize
 *  (*
yys•
),

1307 &
yyvs1
, 
yysize
 *  (*
yyv•
),

1308 &
yy°acksize
);

1310 
yyss
 = 
yyss1
;

1311 
yyvs
 = 
yyvs1
;

1314 #i‚de‡
YYSTACK_RELOCATE


1315 
yyexhau°edœb
;

1318 i‡(
YYMAXDEPTH
 <
yy°acksize
)

1319 
yyexhau°edœb
;

1320 
yy°acksize
 *= 2;

1321 i‡(
YYMAXDEPTH
 < 
yy°acksize
)

1322 
yy°acksize
 = 
YYMAXDEPTH
;

1325 
yyty≥_öt16
 *
yyss1
 = 
yyss
;

1326 
yyÆloc
 *
yy±r
 =

1327 (
yyÆloc
 *Ë
	`YYSTACK_ALLOC
 (
	`YYSTACK_BYTES
 (
yy°acksize
));

1328 i‡(! 
yy±r
)

1329 
yyexhau°edœb
;

1330 
	`YYSTACK_RELOCATE
 (
yyss_Æloc
, 
yyss
);

1331 
	`YYSTACK_RELOCATE
 (
yyvs_Æloc
, 
yyvs
);

1332 #unde‡
YYSTACK_RELOCATE


1333 i‡(
yyss1
 !
yysß
)

1334 
	`YYSTACK_FREE
 (
yyss1
);

1339 
yys•
 = 
yyss
 + 
yysize
 - 1;

1340 
yyv•
 = 
yyvs
 + 
yysize
 - 1;

1342 
	`YYDPRINTF
 ((
°dîr
, "Stack size increasedÅo %lu\n",

1343 (Ë
yy°acksize
));

1345 i‡(
yyss
 + 
yy°acksize
 - 1 <
yys•
)

1346 
YYABORT
;

1349 
	`YYDPRINTF
 ((
°dîr
, "E¡îög sèã %d\n", 
yy°©e
));

1351 i‡(
yy°©e
 =
YYFINAL
)

1352 
YYACCEPT
;

1354 
yybackup
;

1359 
yybackup
:

1365 
yyn
 = 
yy∑˘
[
yy°©e
];

1366 i‡(
	`yy∑˘_vÆue_is_deÁu…
 (
yyn
))

1367 
yydeÁu…
;

1372 i‡(
yych¨
 =
YYEMPTY
)

1374 
	`YYDPRINTF
 ((
°dîr
, "ReadingáÅoken: "));

1375 
yych¨
 = 
YYLEX
;

1378 i‡(
yych¨
 <
YYEOF
)

1380 
yych¨
 = 
yytokí
 = 
YYEOF
;

1381 
	`YYDPRINTF
 ((
°dîr
, "NowátÉnd of input.\n"));

1385 
yytokí
 = 
	`YYTRANSLATE
 (
yych¨
);

1386 
	`YY_SYMBOL_PRINT
 ("Nexàtokí is", 
yytokí
, &
yylvÆ
, &
yyŒoc
);

1391 
yyn
 +
yytokí
;

1392 i‡(
yyn
 < 0 || 
YYLAST
 < yy¿|| 
yycheck
[yyn] !
yytokí
)

1393 
yydeÁu…
;

1394 
yyn
 = 
yyèbÀ
[yyn];

1395 i‡(
yyn
 <= 0)

1397 i‡(
	`yyèbÀ_vÆue_is_îr‹
 (
yyn
))

1398 
yyîæab
;

1399 
yyn
 = -yyn;

1400 
yyªdu˚
;

1405 i‡(
yyîr°©us
)

1406 
yyîr°©us
--;

1409 
	`YY_SYMBOL_PRINT
 ("Shi·ög", 
yytokí
, &
yylvÆ
, &
yyŒoc
);

1412 
yych¨
 = 
YYEMPTY
;

1414 
yy°©e
 = 
yyn
;

1415 *++
yyv•
 = 
yylvÆ
;

1417 
yy√w°©e
;

1423 
yydeÁu…
:

1424 
yyn
 = 
yydeÁ˘
[
yy°©e
];

1425 i‡(
yyn
 == 0)

1426 
yyîæab
;

1427 
yyªdu˚
;

1433 
yyªdu˚
:

1435 
yyÀn
 = 
yyr2
[
yyn
];

1445 
yyvÆ
 = 
yyv•
[1-
yyÀn
];

1448 
	`YY_REDUCE_PRINT
 (
yyn
);

1449 
yyn
)

1465 
	`Õ_√w_é_t›o
((
yyv•
[(3Ë- (3)].
t›o
).
l
, 
Õ_fûíame
);

1466 
	`lﬂd_t›o
((
yyv•
[(3Ë- (3)].
t›o
).
l
, (yyv•[(3Ë- (3)].t›o).
Àn
);

1476 
	`Õ_√w_é_block
((
yyv•
[(2Ë- (2)].
b
), 
Õ_fûíame
);

1477 
	`lﬂd_block
((
yyv•
[(2Ë- (2)].
b
));

1486 
	`Õ_√w_é_ö°
((
yyv•
[(2Ë- (2)].
ö°
), 
Õ_fûíame
);

1487 
	`Õ_ö°_li°
((
yyv•
[(2Ë- (2)].
ö°
));

1496 (
yyvÆ
.
ö°
Ë
	`mÆloc
((
Õ_ö°
));

1497 (
yyvÆ
.
ö°
)->
sour˚_fûe
 = 
Õ_fûíame
;

1498 (
yyvÆ
.
ö°
)->
l
 = (
yyv•
[(2) - (4)].l);

1499 (
yyvÆ
.
ö°
)->
«me
 = (
yyv•
[(4Ë- (4)].
s
);

1510 (
yyvÆ
.
t›o
).
l
 = 
	`mÆloc
((
Õ_t›o•ec
));

1511 (
yyvÆ
.
t›o
).
l
->
sour˚_fûe
 = 
Õ_fûíame
;

1512 (
yyvÆ
.
t›o
).
Àn
 = 1;

1513 (
yyvÆ
.
t›o
).
l
[0].
ty≥
 = (
yyv•
[(1Ë- (3)].
s
);

1514 (
yyvÆ
.
t›o
).
l
[0].
«me
 = (
yyv•
[(2Ë- (3)].
s
);

1515 (
yyvÆ
.
t›o
).
l
[0].»(
yyv•
[(3) - (3)].l);

1524 
Õ_block
 *
∑ª¡
;

1528 (
yyvÆ
.
b
Ë
	`mÆloc
((
Õ_block
));

1529 
	`bzîo
((
yyvÆ
.
b
), (
Õ_block
));

1530 (
yyvÆ
.
b
)->
sour˚_fûe
 = 
Õ_fûíame
;

1532 (
yyvÆ
.
b
)->
ty≥
 = 
	`Õ_mod_«me
(
	`Õ_lookup_ba£_ty≥
((
yyv•
[(1Ë- (5)].
s
),0));

1533 if((
yyvÆ
.
b
)->
ty≥
 == -1) {

1534 
	`Ârötf
(
°dîr
, "***Éº‹: Unknow¿blockÅy≥: %s\n", (
yyv•
[(1Ë- (5)].
s
));

1535 
YYABORT
;

1538 if(
	`Õ_lookup_ty≥
((
yyv•
[(2Ë- (5)].
s
),0)) {

1539 
	`Ârötf
(
°dîr
, "*** w¨nög: ign‹ögÑedeföôi⁄ o‡%s\n", (
yyv•
[(2Ë- (5)].
s
));

1542 
∑ª¡
 = 
	`Õ_lookup_•ec
((
yyv•
[(1Ë- (5)].
s
));

1544 (
yyvÆ
.
b
)->
«me
 = (
yyv•
[(2Ë- (5)].
s
);

1545 (
yyvÆ
.
b
)->
∑øms
 = (
yyv•
[(4Ë- (5)].∑øms).
p
;

1546 (
yyvÆ
.
b
)->
∑øms_Àn
 = (
yyv•
[(4Ë- (5)].
∑øms
).
∂í
;

1547 if(
	`Õ_add_ty≥
((
yyv•
[(2Ë- (5)].
s
), (yyvsp[(1) - (5)].s))) {

1548 
	`Ârötf
(
°dîr
, "***Éº‹: couldn'àaddÅy≥ %s::%s\n", (
yyv•
[(1Ë- (5)].
s
), (yyvsp[(2) - (5)].s));

1551 if(
∑ª¡
Ë
	`Õ_£tup_subty≥
’¨ít, (
yyvÆ
.
b
));

1554 
	`‰ì
((
yyv•
[(1Ë- (5)].
s
));

1563 (
yyvÆ
.
b
Ë
	`mÆloc
((
Õ_block
));

1564 
	`bzîo
((
yyvÆ
.
b
), (
Õ_block
));

1565 (
yyvÆ
.
b
)->
sour˚_fûe
 = 
Õ_fûíame
;

1566 (
yyvÆ
.
b
)->
«me
 = 0;

1567 (
yyvÆ
.
b
)->
∑øms
 = (
yyv•
[(3Ë- (4)].∑øms).
p
;

1568 (
yyvÆ
.
b
)->
∑øms_Àn
 = (
yyv•
[(3Ë- (4)].
∑øms
).
∂í
;

1569 (
yyvÆ
.
b
)->
ty≥
 = 
	`Õ_mod_«me
((
yyv•
[(1Ë- (4)].
s
));

1571 if((
yyvÆ
.
b
)->
ty≥
 == -1) {

1572 
	`Ârötf
(
°dîr
, "***Éº‹:Çÿsuch moduÀ %s\n", (
yyv•
[(1Ë- (4)].
s
));

1573 
YYABORT
;

1576 (
yyvÆ
.
b
)->
lﬂdî
 = 
Õ_moduÀs
[(yyvÆ.b)->
ty≥
]->
‚
;

1578 
	`‰ì
((
yyv•
[(1Ë- (4)].
s
));

1586 { (
yyvÆ
.
∑øms
).
p
 = 0; (yyvÆ.∑øms).
∂í
 = 0; }

1595 (
yyvÆ
.
∑øms
).
p
 = 
	`mÆloc
(8 * (*));

1596 
	`bzîo
((
yyvÆ
.
∑øms
).
p
, 8*(*));

1597 (
yyvÆ
.
∑øms
).
∂í
 = 8;

1598 (
yyvÆ
.
∑øms
).
p
[0] = (
yyv•
[(1) - (1)].p);

1608 
c
; 
Õ_∑øm
 *
tmp
;

1612 (
yyvÆ
.
∑øms
).
p
 = 
	`mÆloc
((
yyv•
[(1Ë- (3)].
l
)->
vÆues_Àn
 * (*));

1613 (
yyvÆ
.
∑øms
).
∂í
 = (
yyv•
[(1Ë- (3)].
l
)->
vÆues_Àn
;

1614 
	`bzîo
((
yyvÆ
.
∑øms
).
p
, (
yyv•
[(1Ë- (3)].
l
)->
vÆues_Àn
 * ((*)));

1616 
c
 = 0; c < (
yyv•
[(1Ë- (3)].
l
)->
vÆues_Àn
; c++) {

1617 if(!(
yyv•
[(1Ë- (3)].
l
)->
vÆues
[
c
]) ;

1618 
	`ddbg_as£π
((
yyv•
[(1Ë- (3)].
l
)->
vÆues
[
c
]->
t
 =
S
);

1619 
tmp
 = 
	`mÆloc
((
Õ_∑øm
));

1620 
tmp
->
«me
 = (
yyv•
[(1Ë- (3)].
l
)->
vÆues
[
c
]->
v
.
s
;

1621 
tmp
->
v
 = (
yyv•
[(3) - (3)].v);

1622 if(
	`Õ_add_∑øm
(&((
yyvÆ
.
∑øms
).
p
), &((yyvÆ.∑øms).
∂í
), 
tmp
)Ë
YYABORT
;

1633 
c
; 
Õ_∑øm
 *
tmp
;

1635 
c
 = 0; c < (
yyv•
[(3Ë- (5)].
l
)->
vÆues_Àn
; c++) {

1636 if(!(
yyv•
[(3Ë- (5)].
l
)->
vÆues
[
c
]) ;

1637 
	`ddbg_as£π
((
yyv•
[(3Ë- (5)].
l
)->
vÆues
[
c
]->
t
 =
S
);

1638 
tmp
 = 
	`Õ_√w_∑øm
((
yyv•
[(3Ë- (5)].
l
)->
vÆues
[
c
]->
v
.
s
, 0, (yyvsp[(5) - (5)].v));

1642 if(
	`Õ_add_∑øm
(&((
yyv•
[(1Ë- (5)].
∑øms
).
p
), &((yyv•[(1Ë- (5)].∑øms).
∂í
), 
tmp
)Ë
YYABORT
;

1644 (
yyvÆ
.
∑øms
Ë(
yyv•
[(1) - (5)].params);

1655 if(
	`Õ_add_∑øm
(&((
yyv•
[(1Ë- (3)].
∑øms
).
p
), &((yyv•[(1Ë- (3)].∑øms).
∂í
), (yyv•[(3Ë- (3)].p))Ë
YYABORT
;

1657 (
yyvÆ
.
∑øms
Ë(
yyv•
[(1) - (3)].params);

1668 (
yyvÆ
.
p
Ë(
yyv•
[(1) - (3)].p);

1673 (
yyvÆ
.
p
)->
v
 = (
yyv•
[(3) - (3)].v);

1682 (
yyvÆ
.
l
Ë(
yyv•
[(2) - (3)].l);

1691 (
yyvÆ
.
l
Ë
	`Õ_√w_li°
();

1704 (
yyvÆ
.
l
Ë
	`Õ_√w_li°
();

1709 (
yyvÆ
.
l
)->
vÆues_p›
 = 1;

1710 (
yyvÆ
.
l
)->
vÆues
[0] = (
yyv•
[(1Ë- (1)].
v
);

1719 *
s1
, *
s2
;

1720 
ãmp
[1024];

1721 
i1
, 
i2
, 
n
, 
c
;

1722 if(
	`dumb_•lô
((
yyv•
[(1Ë- (3)].
s
), &
s1
, &
i1
Ë|| dumb_•lô((yyv•[(3Ë- (3)].s), &
s2
, &
i2
)) {

1723 
	`Ârötf
(
°dîr
, "***Érror: badÜexÑange\n");

1724 
YYABORT
;

1727 
	`‰ì
((
yyv•
[(1Ë- (3)].
s
));

1728 
	`‰ì
((
yyv•
[(3Ë- (3)].
s
));

1730 if(
	`°rcmp
(
s1
,
s2
)) {

1731 
	`Ârötf
(
°dîr
, "***Érror: badÜexÑange\n");

1732 
YYABORT
;

1734 
n
 = 
i2
 - 
i1
 + 1;

1735 if(
n
 <= 0) {

1736 
	`Ârötf
(
°dîr
, "***Érror: badÜexÑange\n");

1737 
YYABORT
;

1740 (
yyvÆ
.
l
Ë
	`Õ_√w_li°
();

1745 
c
 = 0; c < 
n
; c++) {

1746 
Õ_vÆue
 *
v
;

1747 
	`¢¥ötf
(
ãmp
, 1024, "%s%d", 
s2
, 
c
 + 
i1
);

1750 
v
 = 
	`Õ_√w_°rögv
(
	`°rdup
(
ãmp
));

1752 (
yyvÆ
.
l
Ë
	`Õ_li°_add
((yyvÆ.l), 
v
);

1764 *
s1
, *
s2
;

1765 
ãmp
[1024];

1766 
i1
, 
i2
, 
n
, 
c
;

1767 
Õ_vÆue
 *
tmp
;

1769 if(
	`dumb_•lô
((
yyv•
[(3Ë- (5)].
s
), &
s1
, &
i1
Ë|| dumb_•lô((yyv•[(5Ë- (5)].s), &
s2
, &
i2
)) {

1770 
	`Ârötf
(
°dîr
, "***Érror: badÜexÑange\n");

1771 
YYABORT
;

1774 
	`‰ì
((
yyv•
[(3Ë- (5)].
s
));

1775 
	`‰ì
((
yyv•
[(5Ë- (5)].
s
));

1777 if(
	`°rcmp
(
s1
,
s2
)) {

1778 
	`Ârötf
(
°dîr
, "***Érror: badÜexÑange\n");

1779 
YYABORT
;

1781 
n
 = 
i2
 - 
i1
 + 1;

1782 if(
n
 <= 0) {

1783 
	`Ârötf
(
°dîr
, "***Érror: badÜexÑange\n");

1784 
YYABORT
;

1787 
c
 = 0; c < 
n
; c++) {

1788 
	`¢¥ötf
(
ãmp
, 1024, "%s%d", 
s2
, 
c
 + 
i1
);

1789 
tmp
 = 
	`Õ_√w_°rögv
(
	`°rdup
(
ãmp
));

1793 (
yyvÆ
.
l
Ë
	`Õ_li°_add
((
yyv•
[(1Ë- (5)].l), 
tmp
);

1806 (
yyvÆ
.
l
Ë
	`Õ_li°_add
((
yyv•
[(1Ë- (3)].l), (yyv•[(3Ë- (3)].
v
));

1815 (
yyvÆ
.
v
Ë
	`Õ_√w_ötv
((
yyv•
[(1Ë- (1)].
i
));

1816 (
yyvÆ
.
v
)->
sour˚_fûe
 = 
Õ_fûíame
;

1825 (
yyvÆ
.
v
Ë
	`Õ_√w_doubÀv
((
yyv•
[(1Ë- (1)].
d
));

1826 (
yyvÆ
.
v
)->
sour˚_fûe
 = 
Õ_fûíame
;

1835 (
yyvÆ
.
v
Ë
	`Õ_√w_°rögv
((
yyv•
[(1Ë- (1)].
s
));

1836 (
yyvÆ
.
v
)->
sour˚_fûe
 = 
Õ_fûíame
;

1845 (
yyvÆ
.
v
Ë
	`Õ_√w_li°v
((
yyv•
[(1Ë- (1)].
l
));

1846 (
yyvÆ
.
v
)->
sour˚_fûe
 = 
Õ_fûíame
;

1855 (
yyvÆ
.
v
Ë
	`Õ_√w_blockv
((
yyv•
[(1Ë- (1)].
b
));

1856 (
yyvÆ
.
v
)->
sour˚_fûe
 = 
Õ_fûíame
;

1857 (
yyvÆ
.
v
)->
t
 = 
BLOCK
;

1866 (
yyvÆ
.
v
Ë
	`mÆloc
((
Õ_vÆue
));

1867 (
yyvÆ
.
v
)->
sour˚_fûe
 = 
Õ_fûíame
;

1868 (
yyvÆ
.
v
)->v.
b
 = (
yyv•
[(1) - (1)].b);

1869 (
yyvÆ
.
v
)->
t
 = 
BLOCK
;

1879 (
yyvÆ
.
v
Ë
	`mÆloc
((
Õ_vÆue
));

1880 (
yyvÆ
.
v
)->
sour˚_fûe
 = 
Õ_fûíame
;

1881 (
yyvÆ
.
v
)->v.
t
.
l
 = (
yyv•
[(1Ë- (1)].
t›o
).l;

1882 (
yyvÆ
.
v
)->v.
t
.
Àn
 = (
yyv•
[(1Ë- (1)].
t›o
).len;

1884 (
yyvÆ
.
v
)->
t
 = 
TOPOSPEC
;

1894 (
yyvÆ
.
p
Ë
	`ˇŒoc
(1, (
Õ_∑øm
));

1895 (
yyvÆ
.
p
)->
«me
 = (
yyv•
[(1Ë- (1)].
s
);

1896 (
yyvÆ
.
p
)->
sour˚_fûe
 = 
Õ_fûíame
;

1905 *
tmp
 = 
	`ˇŒoc
(2 * (
	`°æí
((
yyv•
[(1Ë- (2)].
p
)->
«me
Ë+ såÀn((yyv•[(2Ë- (2)].
s
))), (*tmp));

1907 (
yyvÆ
.
p
Ë(
yyv•
[(1) - (2)].p);

1908 
	`°rˇt
(
tmp
, (
yyv•
[(1Ë- (2)].
p
)->
«me
);

1909 
	`°rˇt
(
tmp
, " ");

1910 
	`°rˇt
(
tmp
, (
yyv•
[(2Ë- (2)].
s
));

1912 
	`‰ì
((
yyvÆ
.
p
)->
«me
); fªe((
yyv•
[(2Ë- (2)].
s
));

1914 (
yyvÆ
.
p
)->
«me
 = 
tmp
;

1935 
	`YY_SYMBOL_PRINT
 ("-> $$ =", 
yyr1
[
yyn
], &
yyvÆ
, &
yyloc
);

1937 
	`YYPOPSTACK
 (
yyÀn
);

1938 
yyÀn
 = 0;

1939 
	`YY_STACK_PRINT
 (
yyss
, 
yys•
);

1941 *++
yyv•
 = 
yyvÆ
;

1947 
yyn
 = 
yyr1
[yyn];

1949 
yy°©e
 = 
yypgŸo
[
yyn
 - 
YYNTOKENS
] + *
yys•
;

1950 i‡(0 <
yy°©e
 && yy°©ê<
YYLAST
 && 
yycheck
[yy°©e] =*
yys•
)

1951 
yy°©e
 = 
yyèbÀ
[yystate];

1953 
yy°©e
 = 
yydefgŸo
[
yyn
 - 
YYNTOKENS
];

1955 
yy√w°©e
;

1961 
yyîæab
:

1964 
yytokí
 = 
yych¨
 =
YYEMPTY
 ? YYEMPTY : 
	`YYTRANSLATE
 (yychar);

1967 i‡(!
yyîr°©us
)

1969 ++
yy√ºs
;

1970 #i‡! 
YYERROR_VERBOSE


1971 
	`yyîr‹
 (
	`YY_
("syntaxÉrror"));

1973 
	#YYSYNTAX_ERROR
 
	`yysy¡ax_îr‹
 (&
yymsg_Æloc
, &
yymsg
, \

1974 
yys•
, 
yytokí
)

	)

1976 c⁄° *
yymsgp
 = 
	`YY_
("syntaxÉrror");

1977 
yysy¡ax_îr‹_°©us
;

1978 
yysy¡ax_îr‹_°©us
 = 
YYSYNTAX_ERROR
;

1979 i‡(
yysy¡ax_îr‹_°©us
 == 0)

1980 
yymsgp
 = 
yymsg
;

1981 i‡(
yysy¡ax_îr‹_°©us
 == 1)

1983 i‡(
yymsg
 !
yymsgbuf
)

1984 
	`YYSTACK_FREE
 (
yymsg
);

1985 
yymsg
 = (*Ë
	`YYSTACK_ALLOC
 (
yymsg_Æloc
);

1986 i‡(!
yymsg
)

1988 
yymsg
 = 
yymsgbuf
;

1989 
yymsg_Æloc
 =  
yymsgbuf
;

1990 
yysy¡ax_îr‹_°©us
 = 2;

1994 
yysy¡ax_îr‹_°©us
 = 
YYSYNTAX_ERROR
;

1995 
yymsgp
 = 
yymsg
;

1998 
	`yyîr‹
 (
yymsgp
);

1999 i‡(
yysy¡ax_îr‹_°©us
 == 2)

2000 
yyexhau°edœb
;

2002 #unde‡
YYSYNTAX_ERROR


2008 i‡(
yyîr°©us
 == 3)

2013 i‡(
yych¨
 <
YYEOF
)

2016 i‡(
yych¨
 =
YYEOF
)

2017 
YYABORT
;

2021 
	`yyde°ru˘
 ("Error: discarding",

2022 
yytokí
, &
yylvÆ
);

2023 
yych¨
 = 
YYEMPTY
;

2029 
yyîæab1
;

2035 
yyîr‹œb
:

2041 
yyîr‹œb
;

2045 
	`YYPOPSTACK
 (
yyÀn
);

2046 
yyÀn
 = 0;

2047 
	`YY_STACK_PRINT
 (
yyss
, 
yys•
);

2048 
yy°©e
 = *
yys•
;

2049 
yyîæab1
;

2055 
yyîæab1
:

2056 
yyîr°©us
 = 3;

2060 
yyn
 = 
yy∑˘
[
yy°©e
];

2061 i‡(!
	`yy∑˘_vÆue_is_deÁu…
 (
yyn
))

2063 
yyn
 +
YYTERROR
;

2064 i‡(0 <
yyn
 && yy¿<
YYLAST
 && 
yycheck
[yyn] =
YYTERROR
)

2066 
yyn
 = 
yyèbÀ
[yyn];

2067 i‡(0 < 
yyn
)

2073 i‡(
yys•
 =
yyss
)

2074 
YYABORT
;

2077 
	`yyde°ru˘
 ("Error:Öopping",

2078 
yy°os
[
yy°©e
], 
yyv•
);

2079 
	`YYPOPSTACK
 (1);

2080 
yy°©e
 = *
yys•
;

2081 
	`YY_STACK_PRINT
 (
yyss
, 
yys•
);

2084 *++
yyv•
 = 
yylvÆ
;

2088 
	`YY_SYMBOL_PRINT
 ("Shi·ög", 
yy°os
[
yyn
], 
yyv•
, 
yyl•
);

2090 
yy°©e
 = 
yyn
;

2091 
yy√w°©e
;

2097 
yyac˚±œb
:

2098 
yyªsu…
 = 0;

2099 
yyªtu∫
;

2104 
yyab‹éab
:

2105 
yyªsu…
 = 1;

2106 
yyªtu∫
;

2108 #i‡!
	`deföed
(
yyovîÊow
Ë|| 
YYERROR_VERBOSE


2112 
yyexhau°edœb
:

2113 
	`yyîr‹
 (
	`YY_
("memoryÉxhausted"));

2114 
yyªsu…
 = 2;

2118 
yyªtu∫
:

2119 i‡(
yych¨
 !
YYEMPTY
)

2123 
yytokí
 = 
	`YYTRANSLATE
 (
yych¨
);

2124 
	`yyde°ru˘
 ("Cleanup: discardingÜookahead",

2125 
yytokí
, &
yylvÆ
);

2129 
	`YYPOPSTACK
 (
yyÀn
);

2130 
	`YY_STACK_PRINT
 (
yyss
, 
yys•
);

2131 
yys•
 !
yyss
)

2133 
	`yyde°ru˘
 ("Cleanup:Öopping",

2134 
yy°os
[*
yys•
], 
yyv•
);

2135 
	`YYPOPSTACK
 (1);

2137 #i‚de‡
yyovîÊow


2138 i‡(
yyss
 !
yysß
)

2139 
	`YYSTACK_FREE
 (
yyss
);

2141 #i‡
YYERROR_VERBOSE


2142 i‡(
yymsg
 !
yymsgbuf
)

2143 
	`YYSTACK_FREE
 (
yymsg
);

2146  
	`YYID
 (
yyªsu…
);

2147 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/libparam/libparam.tab.h

35 #i‚de‡
YYTOKENTYPE


36 
	#YYTOKENTYPE


	)

39 
	eyytokíty≥
 {

40 
	mLBRACE
 = 258,

41 
	mRBRACE
 = 259,

42 
	mSEMI
 = 260,

43 
	mEQUAL
 = 261,

44 
	mTRUE
 = 262,

45 
	mFALSE
 = 263,

46 
	mDECINT
 = 264,

47 
	mHEXINT
 = 265,

48 
	mFLOAT
 = 266,

49 
	mSTRING
 = 267,

50 
	mLBRAK
 = 268,

51 
	mRBRAK
 = 269,

52 
	mCOMMA
 = 270,

53 
	mQU
 = 271,

54 
	mCOLON
 = 272,

55 
	mNEWLINE
 = 273,

56 
	mSOURCE
 = 274,

57 
	mDOTDOT
 = 275,

58 
	mAS
 = 276,

59 
	mINSTANTIATE
 = 277,

60 
	mTOPOLOGY
 = 278

66 #i‡! 
deföed
 
YYSTYPE
 && ! deföed 
YYSTYPE_IS_DECLARED


67 
	uYYSTYPE


73 
	md
;

74 
	mi
;

75 *
	ms
;

77 
Õ_block
 *
	mb
;

78 °ru˘ { 
Õ_block
 **
	mb
; 
	mbÀn
; } 
	mblocks
;

80 
Õ_∑øm
 *
	mp
;

81 °ru˘ { 
Õ_∑øm
 **
	mp
; 
	m∂í
; } 
	m∑øms
;

83 
Õ_li°
 *
	ml
;

85 
Õ_vÆue
 *
	mv
;

87 °ru˘ { 
Õ_t›o•ec
 *
	ml
; 
	mÀn
; } 
	mt›o
;

88 
Õ_ö°
 *
	mö°
;

94 } 
	tYYSTYPE
;

95 
	#YYSTYPE_IS_TRIVIAL
 1

	)

96 
	#yy°y≥
 
YYSTYPE


	)

97 
	#YYSTYPE_IS_DECLARED
 1

	)

100 
YYSTYPE
 
lib∑ømlvÆ
;

	@/Users/ysoh/disksim-4.0-fcl/libparam/myutil.c

32 
	~<°dlib.h
>

33 
	~<°dio.h
>

34 
	~<˘y≥.h
>

35 
	~<°dlib.h
>

36 
	~<°rög.h
>

37 
	~<libddbg/libddbg.h
>

39 
	~<sys/ty≥s.h
>

40 
	~<sys/°©.h
>

41 
	~<uni°d.h
>

43 
	~<uni°d.h
>

44 
	~<f˙é.h
>

46 
	~<libgí.h
>

48 
	~"lib∑øm.h
"

49 
	~"bôve˘‹.h
"

51 
Õ_t›ﬁﬂdî_t
 
	gt›ﬁﬂdî
 = 0;

53 
	$Õ_ªgi°î_t›ﬁﬂdî
(
Õ_t›ﬁﬂdî_t
 
l
)

55 
t›ﬁﬂdî
 = 
l
;

56 
	}
}

61 *
	gÕ_buûtö_«mes
[] = {

72 
Õ_subty≥
 **
	gÕ_ty≥tbl
;

73 
	gÕ_ty≥tbl_Àn
;

75 
Õ_ét
 **
	gÕ_éts
;

76 
	gÕ_éts_Àn
;

81 **
	gÕ_£¨ch∑th
 = 0;

82 
	gÕ_£¨ch∑th_Àn
 = 0;

85 
Õ_löío
;

87 
de°roy_block
(
Õ_block
 *
b
);

88 
de°roy_vÆue
(
Õ_vÆue
 *
v
);

89 
de°roy_∑øm
(
Õ_∑øm
 *
p
);

90 
de°roy_li°
(
Õ_li°
 *
l
);

91 
de°roy_t›o•ec
(
Õ_t›o•ec
 *
t
);

93 
dumb_•lô
(*
s
, **
t
, *
i
);

94 
dumb_•lô2
(*
s
, **
s1
, **
s2
);

97 
	gÕ_max_mod
 = 0;

98 
	gÕ_mod_size
 = 0;

99 
Õ_mod
 **
	gÕ_moduÀs
 = 0;

101 **
	govîrides
 = 0;

102 
	govîrides_Àn
 = 0;

104 
	#ouçutfûe
 
°dout


	)

107 
Õ_vÆue
 *
	$Õ_√w_ötv
(
i
)

109 
Õ_vÆue
 *
v
 = 
	`ˇŒoc
(1, (lp_value));

110 
v
->v.
i
 = i;

111 
v
->
t
 = 
I
;

112  
v
;

113 
	}
}

115 
Õ_vÆue
 *
	$Õ_√w_doubÀv
(
d
)

117 
Õ_vÆue
 *
v
 = 
	`ˇŒoc
(1, (lp_value));

118 
v
->v.
d
 = d;

119 
v
->
t
 = 
D
;

120  
v
;

121 
	}
}

123 
Õ_vÆue
 *
	$Õ_√w_°rögv
(*
s
)

125 
Õ_vÆue
 *
v
 = 
	`ˇŒoc
(1, (lp_value));

126 
v
->v.
s
 = s;

127 
v
->
t
 = 
S
;

128  
v
;

129 
	}
}

131 
Õ_vÆue
 *
	$Õ_√w_li°v
(
Õ_li°
 *
l
)

133 
Õ_vÆue
 *
v
 = 
	`ˇŒoc
(1, (lp_value));

134 
v
->v.
l
 =Ü;

135 
v
->
t
 = 
LIST
;

136  
v
;

137 
	}
}

139 
Õ_vÆue
 *
	$Õ_√w_blockv
(
Õ_block
 *
b
)

141 
Õ_vÆue
 *
v
 = 
	`ˇŒoc
(1, (lp_value));

142 
v
->v.
b
 = b;

143 
v
->
t
 = 
b
->
ty≥
;

144  
v
;

145 
	}
}

148 
Õ_∑øm
 *

149 
	$Õ_√w_∑øm
(*
«me
, *
sour˚
, 
Õ_vÆue
 *
v
)

151 
Õ_∑øm
 *
ªsu…
 = 
	`ˇŒoc
(1, (lp_param));

152 
ªsu…
->
sour˚_fûe
 = 
sour˚
;

153 
ªsu…
->
«me
 =Çame;

154 
ªsu…
->
v
 = v;

157  
ªsu…
;

158 
	}
}

160 
Õ_li°
 *

161 
	$Õ_√w_li°
()

163 
Õ_li°
 *
l
 = 
	`ˇŒoc
(1, (lp_list));

164 
l
->
vÆues
 = 
	`ˇŒoc
(8, (
Õ_vÆue
 *));

165 
l
->
vÆues_Àn
 = 8;

166 
l
->
vÆues_p›
 = 0;

167 
l
->
löñí
 = 1;

168  
l
;

169 
	}
}

171 
Õ_block
 *

172 
	$Õ_√w_block
()

174 
Õ_block
 *
b
 = 
	`ˇŒoc
(1, (lp_block));

175 
b
->
∑øms
 = 
	`ˇŒoc
(8, (
Õ_∑øm
 *));

176 
b
->
∑øms_Àn
 = 8;

177  
b
;

178 
	}
}

180 
Õ_li°
 *

181 
	$Õ_√w_öéi°
(*
öèº
, 
Àn
)

183 
i
;

184 
Õ_li°
 *
l
 = 
	`Õ_√w_li°
();

186 
i
 = 0; i < 
Àn
; i++) {

187 
	`Õ_li°_add
(
l
, 
	`Õ_√w_ötv
(
öèº
[
i
]));

189  
l
;

190 
	}
}

194 
	$Õ_ªgi°î_moduÀ
(
Õ_mod
 *
m
) {

195 
c
;

196 
c
 = 0; c < 
Õ_max_mod
; c++) {

197 if(!
	`°rcmp
(
m
->
«me
, 
Õ_moduÀs
[
c
]->name)) {

201 if(
c
 >
Õ_mod_size
) {

202 
Õ_mod_size
 *= 2;Üp_mod_size++;

203 
Õ_moduÀs
 = 
	`ªÆloc
÷p_moduÀs, 
Õ_mod_size
 * (*));

205 if(
c
 > 0)

206 
Õ_moduÀs
[
c
] = 
m
;

208 
Õ_moduÀs
[0] = 
m
;

210 
Õ_max_mod
++;

212  
c
;

213 
	}
}

218 
	$dõ
(*
msg
) {

219 
	`Ârötf
(
°dîr
, "***Éº‹: FATAL: %s\n", 
msg
);

220 
	`exô
(1);

221 
	}
}

223 
	$de°roy_∑øm
(
Õ_∑øm
 *
p
)

225 
	`‰ì
(
p
->
«me
);

226 
	`de°roy_vÆue
(
p
->
v
);

227 
	`‰ì
(
p
);

228 
	}
}

231 
	$de°roy_li°
(
Õ_li°
 *
l
) {

232 
c
;

233 
c
 = 0; c < 
l
->
vÆues_Àn
; c++)

234 if(
l
->
vÆues
[
c
])

235 
	`de°roy_vÆue
(
l
->
vÆues
[
c
]);

237 
	`‰ì
(
l
->
vÆues
);

238 
	`‰ì
(
l
);

239 
	}
}

242 
	$de°roy_vÆue
(
Õ_vÆue
 *
v
) {

243 
d
;

244 
v
->
t
) {

245 
S
:

246 
	`‰ì
(
v
->v.
s
);

249 
LIST
:

250 
	`de°roy_li°
(
v
->v.
l
);

253 
I
:

254 
D
: ;

256 
TOPOSPEC
:

257 
d
 = 0; d < 
v
->v.
t
.
Àn
; d++)

258 
	`de°roy_t›o•ec
(&
v
->v.
t
.
l
[
d
]);

260 
	`‰ì
(
v
->v.
t
.
l
);

264 
	`de°roy_block
(
v
->v.
b
);

267 
	`‰ì
(
v
);

268 
	}
}

271 
	$de°roy_block
(
Õ_block
 *
b
) {

272 
c
;

273 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

274 if(
b
->
∑øms
[
c
]) {

275 
	`de°roy_∑øm
(
b
->
∑øms
[
c
]);

279 
	`‰ì
(
b
->
«me
);

280 
	`‰ì
(
b
->
∑øms
);

281 
	`‰ì
(
b
);

282 
	}
}

284 
	$de°roy_t›o•ec
(
Õ_t›o•ec
 *
t
)

286 
	`‰ì
(
t
->
ty≥
);

287 
	`‰ì
(
t
->
«me
);

288 
	`de°roy_li°
(
t
->
l
);

289 
	}
}

292 
Õ_block
 *
c›y_block
(lp_block *);

293 
Õ_li°
 *
c›y_li°
(lp_list *);

294 
Õ_vÆue
 *
c›y_vÆue
(lp_value *);

295 
Õ_∑øm
 *
c›y_∑øm
(lp_param *);

297 
Õ_block
 *
	$c›y_block
(
Õ_block
 *
b
)

299 
c
;

300 
Õ_block
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

301 
	`mem˝y
(
ªsu…
, 
b
, (
Õ_block
));

302 
ªsu…
->
∑øms
 = 
	`ˇŒoc
(
b
->
∑øms_Àn
, (result->params[0]));

304 if(
b
->
«me
) {

305 
ªsu…
->
«me
 = 
	`°rdup
(
b
->name);

308 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

309 if(
b
->
∑øms
[
c
]) {

310 
ªsu…
->
∑øms
[
c
] = 
	`c›y_∑øm
(
b
->params[c]);

314  
ªsu…
;

315 
	}
}

318 
Õ_li°
 *
	$c›y_li°
(
Õ_li°
 *
l
) {

319 
c
;

320 
Õ_li°
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

321 
	`mem˝y
(
ªsu…
, 
l
, (
Õ_li°
));

322 
ªsu…
->
vÆues
 = 
	`ˇŒoc
(
l
->
vÆues_Àn
, (result->values[0]));

323 
	`mem˝y
(
ªsu…
->
vÆues
, 
l
->vÆues,Ü->
vÆues_Àn
 * (*));

324 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

325 if(
l
->
vÆues
[
c
]) {

326 
ªsu…
->
vÆues
[
c
] = 
	`c›y_vÆue
(
l
->values[c]);

329  
ªsu…
;

330 
	}
}

333 
Õ_vÆue
 *
	$c›y_vÆue
(
Õ_vÆue
 *
v
) {

334 
Õ_vÆue
 *
ªsu…
 = 
	`ˇŒoc
(1, (lp_value));

335 
	`mem˝y
(
ªsu…
, 
v
, (
Õ_vÆue
));

336 
v
->
t
) {

337 
S
:

338 
ªsu…
->
v
.
s
 = 
	`°rdup
(v->v.s);

341 
LIST
:

342 
ªsu…
->
v
.
l
 = 
	`c›y_li°
(v->v.l);

345 
BLOCK
:

346 
ªsu…
->
v
.
b
 = 
	`c›y_block
(v->v.b);

353  
ªsu…
;

354 
	}
}

356 
Õ_∑øm
 *
	$c›y_∑øm
(
Õ_∑øm
 *
p
) {

357 
Õ_∑øm
 *
ªsu…
 = 
	`ˇŒoc
(1, (lp_param));

358 
ªsu…
->
«me
 = 
	`°rdup
(
p
->name);

359 
ªsu…
->
v
 = 
	`c›y_vÆue
(
p
->v);

360  
ªsu…
;

361 
	}
}

364 
	gödít_Àvñ
 = 0;

366 
	$ödít
(
FILE
 *
f
) {

367 *
•a˚
 = 
	`ˇŒoc
(1, 3*
ödít_Àvñ
+1);

368 
	`mem£t
(
•a˚
, ()' ', 3*
ödít_Àvñ
);

369 
•a˚
[3*
ödít_Àvñ
] = 0;

370 
	`Ârötf
(
f
, "%s", 
•a˚
);

371 
	`‰ì
(
•a˚
);

372 
	}
}

374 
	$u≈¨£_sour˚
(*
sour˚
, 
FILE
 *
outfûe
) {

375 
	`Ârötf
(
outfûe
, "sour˚ %s", 
sour˚
);

376 
	}
}

378 
	$u≈¨£_ty≥
(
t
, 
FILE
 *
outfûe
) {

379 if(
t
 < 0) {

380 
	`Ârötf
(
outfûe
, "%s", 
Õ_buûtö_«mes
[
	`abs
(
t
)]);

383 if(
t
 > 
Õ_max_mod
) {

384 
	`Ârötf
(
outfûe
, "<UNKNOWN TYPE>");

387 
	`Ârötf
(
outfûe
, "%s", 
Õ_moduÀs
[
t
]->
«me
);

390 
	}
}

392 
	$u≈¨£_∑øm
(
Õ_∑øm
 *
p
, 
FILE
 *
outfûe
) {

393 
	`Ârötf
(
outfûe
, "%†", 
p
->
«me
);

394 if(
p
->
sour˚_fûe
 &&Ö->
v
->source_file) {

395 if(
	`°rcmp
(
p
->
sour˚_fûe
,Ö->
v
->source_file)) {

396 
	`u≈¨£_sour˚
(
p
->
v
->
sour˚_fûe
, 
outfûe
);

401 
	`u≈¨£_vÆue
(
p
->
v
, 
outfûe
);

402 
	}
}

404 
	$u≈¨£_vÆue
(
Õ_vÆue
 *
v
, 
FILE
 *
outfûe
) {

405 
c
;

406 
v
->
t
) {

407 
I
:

408 
	`Ârötf
(
outfûe
, "%d", 
v
->v.
i
);

410 
D
:

411 if(
v
->v.
d
 == 0.0) {

412 
	`Ârötf
(
outfûe
, "0.0");

415 
	`Ârötf
(
outfûe
, "%f", 
v
->v.
d
);

418 
S
:

419 
	`Ârötf
(
outfûe
, "%s", 
v
->v.
s
);

421 
LIST
:

422 
	`u≈¨£_li°
(
v
->v.
l
, 
outfûe
);

424 
TOPOSPEC
:

425 
c
 = 0; c < 
v
->v.
t
.
Àn
; c++)

426 
	`u≈¨£_t›o•ec
(&
v
->v.
t
.
l
[
c
], 
outfûe
);

429 
BLOCK
:

430 
	`u≈¨£_block
(
v
->v.
b
, 
outfûe
);

433 
	}
}

435 
	$u≈¨£_li°
(
Õ_li°
 *
l
, 
FILE
 *
outfûe
) {

436 
¥öãd
 = 0;

437 
c
;

441 
	`Ârötf
(
outfûe
, "[ ");

442 
ödít_Àvñ
++;

443 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

444 if(!
l
->
vÆues
[
c
])

447 if(
c
) {

448 
	`Ârötf
(
outfûe
, ", ");

449 if(!(
c
 % 
l
->
löñí
)) {

450 
	`Ârötf
(
outfûe
, "\n");

451 
	`ödít
(
outfûe
);

455 
	`Ârötf
(
outfûe
, "\n");

456 
	`ödít
(
outfûe
);

459 
¥öãd
++;

460 
	`u≈¨£_vÆue
(
l
->
vÆues
[
c
], 
outfûe
);

462 
ödít_Àvñ
--;

464 if((
c
 > 0Ë&& 
¥öãd
) {

465 
	`Ârötf
(
outfûe
, "\n");

466 
	`ödít
(
outfûe
);

468 
	`Ârötf
(
outfûe
, "]");

469 
	}
}

472 
	$u≈¨£_block
(
Õ_block
 *
b
, 
FILE
 *
outfûe
) {

473 
c
;

475 if(
b
->
«me
) {

477 
	`Ârötf
(
outfûe
, "%†%†{\n", 
Õ_moduÀs
[
b
->
ty≥
]->
«me
, b->name);

481 
	`Ârötf
(
outfûe
, "%†{\n", 
Õ_moduÀs
[
b
->
ty≥
]->
«me
);

485 
ödít_Àvñ
++;

486 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

487 if(!
b
->
∑øms
[
c
]) ;

489 if(
c
Ë
	`Ârötf
(
outfûe
, ",\n");

491 
	`u≈¨£_∑øm
(
b
->
∑øms
[
c
], 
outfûe
);

493 
ödít_Àvñ
--;

494 
	`Ârötf
(
outfûe
, "\n");

495 
	`ödít
(
outfûe
);

496 
	`Ârötf
(
outfûe
, "}");

497 if(
b
->
«me
) {

498 
	`Ârötf
(
outfûe
, " #Énd o‡%†•ec", 
b
->
«me
);

499 
	`Ârötf
(
outfûe
, "\n\n");

501 
	}
}

503 
	$u≈¨£_t›o•ec
(
Õ_t›o•ec
 *
t
, 
FILE
 *
outfûe
) {

504 
	`Ârötf
(
outfûe
, "%†%†", 
t
->
ty≥
,Å->
«me
);

505 
	`u≈¨£_li°
(
t
->
l
, 
outfûe
);

508 
	}
}

511 
	$u≈¨£_é_t›o•ec
(
Õ_t›o•ec
 *
t
, 
FILE
 *
outfûe
)

513 
	`Ârötf
(
outfûe
, "topospec ");

514 
	`u≈¨£_t›o•ec
(
t
, 
outfûe
);

515 
	`Ârötf
(
outfûe
, "\n\n");

516 
	}
}

518 
	$u≈¨£_ö°
(
Õ_ö°
 *
i
, 
FILE
 *
outfûe
) {

519 
	`Ârötf
(
outfûe
, "instantiate ");

520 
	`u≈¨£_li°
(
i
->
l
, 
outfûe
);

521 
	`Ârötf
(
outfûe
, "á†%s\n\n", 
i
->
«me
);

522 
	}
}

524 
	$u≈¨£_ét
(
Õ_ét
 *
ét
, 
FILE
 *
outfûe
, *
öfûe
) {

526 if(
ét
->
sour˚_fûe
 && 
öfûe
) {

527 if(
	`°rcmp
(
ét
->
sour˚_fûe
, 
öfûe
)) {

528 
	`u≈¨£_sour˚
(
ét
->
sour˚_fûe
, 
outfûe
);

533 
ét
->
wh©
) {

534 
TLT_BLOCK
: 
	`u≈¨£_block
(
ét
->
ô
.
block
, 
outfûe
); ;

535 
TLT_TOPO
: 
	`u≈¨£_é_t›o•ec
(
ét
->
ô
.
t›o
, 
outfûe
); ;

536 
TLT_INST
: 
	`u≈¨£_ö°
(
ét
->
ô
.
ö°
, 
outfûe
); ;

537 : 
	`ddbg_as£π
(0); ;

540 
	}
}

542 
	$Õ_u≈¨£_éts
(
Õ_ét
 **
éts
,

543 
éts_Àn
,

544 
FILE
 *
outfûe
,

545 *
öfûe
)

547 
c
;

548 
c
 = 0; c < 
éts_Àn
; c++) {

549 if(
éts
[
c
] != 0) {

550 
	`u≈¨£_ét
(
éts
[
c
], 
outfûe
, 
öfûe
);

553 
	}
}

558 
	$Õ_ö°_li°
(
Õ_ö°
 *
i
)

560 
c
;

564 
c
 = 0; c < 
i
->
l
->
vÆues_Àn
; c++) {

565 if(!
i
->
l
->
vÆues
[
c
]) ;

567 
	`ddbg_as£π3
(
i
->
l
->
vÆues
[
c
]->
t
 =
S
,

568 ("badÅy≥ f‹ comp⁄íà%s", 
i
->
l
->
vÆues
[
c
]->
v
.
s
));

570 
	`Õ_ö°™tüã
(
i
->
l
->
vÆues
[
c
]->
v
.
s
, i->
«me
);

574 
	}
}

577 *
	$Õ_ö°™tüã
(*
èrg
, *
«me
) {

578 *
«mëmp
;

579 
Õ_block
 *
•ec
;

580 *
obj
;

584 
•ec
 = 
	`Õ_lookup_•ec
(
«me
);

585 
	`ddbg_as£π3
(
•ec
 !0, ("nÿsuchÅy≥ %s.\n", 
«me
));

591 
«mëmp
 = 
•ec
->
«me
;

592 
•ec
->
«me
 = 
èrg
;

596 
obj
 = 
	`Õ_ovîride_ö°
(
•ec
,

597 
èrg
,

598 
Õ_moduÀs
[
•ec
->
ty≥
]->
‚
,

599 
ovîrides
,

600 
ovîrides_Àn
);

603 
•ec
->
«me
 = 
«mëmp
;

606 if(!
obj
) {

610 if(
Õ_moduÀs
[
•ec
->
ty≥
]->
ˇŒback
) {

611 
Õ_moduÀs
[
•ec
->
ty≥
]->
	`ˇŒback
÷p_moduÀs[•ec->ty≥]->
˘x
, 
obj
);

614  
obj
;

615 
	}
}

618 
	$check_ty≥s
(
Õ_block
 *
b
) {

619 
c
 = 0;

624 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

625 if(
b
->
∑øms
[
c
]) {

626 if(
	`Õ_∑øm_«me
(
b
->
ty≥
, b->
∑øms
[
c
]->
«me
) == -1) {

628 
	`Ârötf
(
°dîr
, "*** warning:Öarameter %sÇot valid in context %s\n",

629 
b
->
∑øms
[
c
]->
«me
, 
Õ_moduÀs
[b->
ty≥
]->name);

633 if(
Õ_moduÀs
[
b
->
ty≥
]->
modv¨s
[
	`Õ_∑øm_«me
(b->ty≥, b->
∑øms
[
c
]->
«me
)].type

634 !
	`PTYPE
(
b
->
∑øms
[
c
])) {

637 if((
Õ_moduÀs
[
b
->
ty≥
]->
modv¨s
[
	`Õ_∑øm_«me
(b->ty≥, b->
∑øms
[
c
]->
«me
)].type

638 =
D
)

639 && (
	`PTYPE
(
b
->
∑øms
[
c
]Ë=
I
)) {

640 
b
->
∑øms
[
c
]->
v
->
t
 = 
D
;

641 
	`DVAL
(
b
->
∑øms
[
c
]Ë(Ë
	`IVAL
(b->params[c]);

645 
	`Ârötf
(
°dîr
, "***Érror:ÅypeÉrror: %s::\"%s\" cannotÅakeÅype ",

646 
Õ_moduÀs
[
b
->
ty≥
]->
«me
,

647 
b
->
∑øms
[
c
]->
«me
);

650 
	`Ârötf
(
°dîr
, "\n");

652 
	`dõ
("check_types() failed");

658 if(
	`PTYPE
(
b
->
∑øms
[
c
]Ë>
BLOCK
) {

659 
	`check_ty≥s
(
	`BVAL
(
b
->
∑øms
[
c
]));

661 if(
	`PTYPE
(
b
->
∑øms
[
c
]Ë=
LIST
) {

662 
d
;

663 
Õ_li°
 *
l
 = 
	`LVAL
(
b
->
∑øms
[
c
]);

664 
d
 = 0; d < 
l
->
vÆues_Àn
; d++) {

665 if(
l
->
vÆues
[
d
]) {

666 if(
l
->
vÆues
[
d
]->
t
 >
BLOCK
) {

667 
	`check_ty≥s
(
l
->
vÆues
[
d
]->
v
.
b
);

676 
	}
}

678 
	$lﬂd_block
(
Õ_block
 *
b
) {

679 
n
;

681 
	`Õ_lookup_ty≥
(
b
->
«me
, &
n
);

682 
Õ_ty≥tbl
[
n
]->
•ec
 = 
b
;

683 
	}
}

688 
	$lﬂd_t›o
(
Õ_t›o•ec
 *
t
, 
Àn
)

691 
	`t›ﬁﬂdî
(
t
, 
Àn
);

692 
	}
}

698 
	$¥ötv¨s
() {

699 
c
, 
d
;

700 
c
 = 0; c < 
Õ_max_mod
; c++) {

701 
d
 = 0; d < 
Õ_moduÀs
[
c
]->
modv¨s_Àn
; d++) {

702 
	`¥ötf
("%s::%s\n", 
Õ_moduÀs
[
c
]->
«me
,

703 
Õ_moduÀs
[
c
]->
modv¨s
[
d
].
«me
);

706 
	}
}

710 
	$dummy
 (
Õ_block
 *
b
) {

711 
	`Ârötf
(
°dîr
, "***Érror: %s cannot be declaredátÅop-level.\n",

712 
b
->
«me
);

713 
	`exô
(1);

714 
	}
}

717 
Õ_li°
 *
	$Õ_li°_add
(
Õ_li°
 *
l
,

718 
Õ_vÆue
 *
v
)

720 
c
, 
√wÀn
;

721 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

722 if(!
l
->
vÆues
[
c
]Ë
d⁄e
;

724 
√wÀn
 = 2 * 
c
 * (
Õ_vÆue
 *);

725 
l
->
vÆues
 = 
	`ªÆloc
÷->vÆues, 
√wÀn
);

726 
	`bzîo
(
l
->
vÆues
 + 
c
, 
√wÀn
 / 2);

727 
l
->
vÆues_Àn
 *= 2;

729 
d⁄e
:

730 
l
->
vÆues_p›
++;

731 
l
->
vÆues
[
c
] = 
v
;

733  
l
;

734 
	}
}

743 
	$Õ_∑øm_«me
(
m
, *
n
)

745 
c
 = 0;

746 if(!
	`RANGE
(
m
,0,
Õ_max_mod
))  -1;

747 if(!
n
)  -1;

749 (
c
 < 
Õ_moduÀs
[
m
]->
modv¨s_Àn
)

750 && 
	`°rcmp
(
Õ_moduÀs
[
m
]->
modv¨s
[
c
].
«me
, 
n
)) c++;

752 if(
c
 >
Õ_moduÀs
[
m
]->
modv¨s_Àn
) {

756  
c
;

758 
	}
}

761 
	$Õ_mod_«me
(*
n
) {

762 
c
 = 0;

763 if(!
n
)  -1;

765 (
c
 < 
Õ_max_mod
Ë&& 
	`°rcmp
(
Õ_moduÀs
[c]->
«me
, 
n
)) c++;

767 if(
c
 >
Õ_max_mod
) {

771  
c
;

773 
	}
}

776 *
	$Õ_lookup_ba£_ty≥
(*
«me
, *
n
) {

777 
c
;

778 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++) {

779 if(
Õ_ty≥tbl
[
c
]) {

780 if(!
	`°rcmp
(
«me
, 
Õ_ty≥tbl
[
c
]->
sub
)) {

781 if(
Õ_ty≥tbl
[
c
]->
su≥r
) {

782  
	`Õ_lookup_ba£_ty≥
(
Õ_ty≥tbl
[
c
]->
su≥r
, 
n
);

791 if(
n
Ë*¿
c
;

792  
«me
;

793 
	}
}

795 *
	$Õ_lookup_ty≥
(*
«me
, *
n
) {

796 
c
;

797 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++) {

798 if(
Õ_ty≥tbl
[
c
]) {

799 if(!
	`°rcmp
(
«me
, 
Õ_ty≥tbl
[
c
]->
sub
)) {

800 if(
n
Ë*¿
c
;

801  
Õ_ty≥tbl
[
c
]->
su≥r
;

806 
	}
}

815 
Õ_block
 *
	$Õ_lookup_•ec
(*
«me
) {

816 
c
;

818 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++)

819 if(
Õ_ty≥tbl
[
c
]) {

820 if(!
«me
) {

821 if(
Õ_ty≥tbl
[
c
]->
su≥r
) {

822  
Õ_ty≥tbl
[
c
]->
•ec
;

825 if(!
	`°rcmp
(
«me
, 
Õ_ty≥tbl
[
c
]->
sub
)) {

826  
Õ_ty≥tbl
[
c
]->
•ec
;

831 
	}
}

834 
Õ_ét
 *
	$Õ_√w_é_t›o
(
Õ_t›o•ec
 *
t
, *
sour˚_fûe
)

836 
Õ_ét
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

837 
ªsu…
->
sour˚_fûe
 = source_file;

838 
ªsu…
->
wh©
 = 
TLT_TOPO
;

839 
ªsu…
->
ô
.
t›o
 = 
t
;

840 
	`Õ_add_ét
(
ªsu…
);

841  
ªsu…
;

842 
	}
}

844 
Õ_ét
 *
	$Õ_√w_é_ö°
(
Õ_ö°
 *
i
, *
sour˚_fûe
)

846 
Õ_ét
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

847 
ªsu…
->
sour˚_fûe
 = source_file;

848 
ªsu…
->
wh©
 = 
TLT_INST
;

849 
ªsu…
->
ô
.
ö°
 = 
i
;

850 
	`Õ_add_ét
(
ªsu…
);

851  
ªsu…
;

852 
	}
}

854 
Õ_ét
 *
	$Õ_√w_é_block
(
Õ_block
 *
b
, *
sour˚_fûe
)

856 
Õ_ét
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

857 
ªsu…
->
sour˚_fûe
 = source_file;

858 
ªsu…
->
wh©
 = 
TLT_BLOCK
;

859 
ªsu…
->
ô
.
block
 = 
b
;

860 
	`Õ_add_ét
(
ªsu…
);

861  
ªsu…
;

862 
	}
}

865 
	$Õ_add_ét
(
Õ_ét
 *
ét
) {

866 
c
;

867 
found
 = 0;

869 
c
 = 0; c < 
Õ_éts_Àn
; c++) {

870 if(!
Õ_éts
[
c
]) {

871 
found
 = 
c
; ;

875 if(!
found
) {

876 
√wÀn
 = 
Õ_éts_Àn
 ? 2 *Üp_tlts_len : 2;

877 
zîo˙t
 = 
Õ_éts_Àn
 ?Üp_tlts_len : 2;

879 
√wsize
 = 
√wÀn
 * (
Õ_éts
 *);

880 
zîo˙t
 *(
Õ_éts
 *);

882 
Õ_éts
 = 
	`ªÆloc
÷p_éts, 
√wsize
);

883 
	`mem£t
(
Õ_éts
 + 
Õ_éts_Àn
, 0, 
zîo˙t
);

884 
found
 = 
Õ_éts_Àn
;

885 
Õ_éts_Àn
 = 
√wÀn
;

888 
Õ_éts
[
c
] = 
ét
;

889 
	}
}

892 
	$Õ_add_ty≥
(*
√wt
, *
∑ª¡
) {

893 
c
;

894 
√wÀn
;

895 
Õ_subty≥
 *
°
 = 
	`ˇŒoc
(1, (*st));

896 
°
->
su≥r
 = 
	`°rdup
(
∑ª¡
); st->
sub
 = sådup(
√wt
);

898 if(!
	`Õ_lookup_ty≥
(
√wt
,0)) {

899 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++)

900 if(!
Õ_ty≥tbl
[
c
]) {

901 
d⁄e
;

905 
√wÀn
 = 
Õ_ty≥tbl_Àn
 ? 2 *Üp_typetbl_len : 2;

907 
Õ_ty≥tbl
 = 
	`ªÆloc
÷p_ty≥tbl, 
√wÀn
 * (*));

909 
	`bzîo
(
Õ_ty≥tbl
 + 
c
, c * (*));

910 
Õ_ty≥tbl_Àn
 = 
√wÀn
;

914 
d⁄e
:

915 
Õ_ty≥tbl
[
c
] = 
°
;

917 
	}
}

920 
	$Õ_add_∑øm
(
Õ_∑øm
 ***
b
, *
∂í
,

921 
Õ_∑øm
 *
p
)

923 
c
;

926 
c
 = 0; c < *
∂í
; c++) {

927 if(!(*
b
)[
c
]) ;

928 if(!
	`°rcmp
((*
b
)[
c
]->
«me
, 
p
->name)) {

929 
	`Ârötf
(
°dîr
, "***Éº‹:Ñedeföed %s\n", 
p
->
«me
);

935 
c
 = 0; c < *
∂í
; c++) {

936 if(!(*
b
)[
c
]) {

937 (*
b
)[
c
] = 
p
;

941 if(
c
 =*
∂í
) {

943 
√wÀn
 = 2 * (*
∂í
) + 1;

944 (*
b
Ë
	`ªÆloc
((*b), 
√wÀn
 * (*));

945 
	`bzîo
((*)(*
b
Ë+ *
∂í
, ((*plen) + 1) * (*));

946 (*
b
)[(*
∂í
)] = 
p
;

947 *
∂í
 = 
√wÀn
;

951 
	}
}

955 
	$Õ_£tup_subty≥
(
Õ_block
 *
∑ª¡
,

956 
Õ_block
 *
chûd
)

958 
c
, 
d
;

960 
c
 = 0; c < 
∑ª¡
->
∑øms_Àn
; c++) {

961 
found
 = 0;

962 
d
 = 0; d < 
chûd
->
∑øms_Àn
; d++) {

963 if(!
	`°rcmp
(
chûd
->
∑øms
[
d
]->
«me
, 
∑ª¡
->∑øms[
c
]->name)) {

964 
found
 = 1;

967 if(!
found
) {

968 
	`Õ_add_∑øm
(&
chûd
->
∑øms
, &chûd->
∑øms_Àn
, 
∑ª¡
->∑øms[
c
]);

973 
	}
}

978 
	$Õ_öô_ty≥tbl
() {

979 
c
;

980 
Õ_ty≥tbl
 = 
	`ˇŒoc
(
Õ_max_mod
, (
subty≥
 *));

983 
c
 = 0; c < 
Õ_max_mod
; c++) {

985 
Õ_ty≥tbl
[
c
] = 
	`mÆloc
((
Õ_subty≥
));

986 
	`bzîo
(
Õ_ty≥tbl
[
c
], (
Õ_subty≥
));

987 
Õ_ty≥tbl
[
c
]->
sub
 = 
	`°rdup
(
Õ_moduÀs
[c]->
«me
);

990 
Õ_ty≥tbl_Àn
 = 
Õ_max_mod
;

991 
	}
}

993 
	$Õ_ªÀa£_ty≥tbl
() {

994 
c
;

996 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++) {

997 if(!
Õ_ty≥tbl
[
c
]) ;

999 if(
Õ_ty≥tbl
[
c
]->
•ec
)

1000 
	`de°roy_block
(
Õ_ty≥tbl
[
c
]->
•ec
);

1002 if(
Õ_ty≥tbl
[
c
]->
sub
)

1003 
	`‰ì
(
Õ_ty≥tbl
[
c
]->
sub
);

1005 if(
Õ_ty≥tbl
[
c
]->
su≥r
)

1006 
	`‰ì
(
Õ_ty≥tbl
[
c
]->
su≥r
);

1008 
	`‰ì
(
Õ_ty≥tbl
[
c
]);

1011 
	`‰ì
(
Õ_ty≥tbl
);

1012 
	}
}

1017 
	$dumb_•lô
(*
s
, **
t
, *
i
) {

1018 
c
 = 
	`°æí
(
s
) - 1;

1020 
c
 && 
	`isdigô
(
s
[c])) c--;

1021 if(!
c
)  -1;

1022 
c
++;

1023 (*
i
Ë
	`©oi
(&
s
[
c
]);

1024 *
t
 = 
	`°rdup
(
s
);

1025 (*
t
)[
c
] = 0;

1027 
	}
}

1030 
	$dumb_•lô2
(*
s
, **
s1
, **
s2
) {

1031 
c
 = 0;

1032 (*
s1
Ë
	`°rdup
(
s
);

1033 
s
[
c
] && (s[c] != ':')) c++;

1034 (*
s1
)[
c
] = 0;

1035 if(
s
[
c
]Ë(*
s2
Ë
	`°rdup
(s + c + 1);

1039 
	}
}

1045 
	$∑øm_ovîride
(
Õ_block
 *
b
,

1046 *
≤ame
,

1047 *
pvÆ
)

1049 
c
;

1051 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

1052 if(!
b
->
∑øms
[
c
]) ;

1053 if(!
	`°rcmp
(
b
->
∑øms
[
c
]->
«me
, 
≤ame
)) {

1054 
b
->
∑øms
[
c
]->
v
->
t
) {

1055 
I
:

1056 
b
->
∑øms
[
c
]->
v
->v.
i
 = 
	`©oi
(
pvÆ
);

1058 
D
:

1059 
b
->
∑øms
[
c
]->
v
->v.
d
 = 
	`©of
(
pvÆ
);

1061 
S
:

1062 
	`‰ì
(
b
->
∑øms
[
c
]->
v
->v.
s
);

1063 
b
->
∑øms
[
c
]->
v
->v.
s
 = 
	`°rdup
(
pvÆ
);

1068 
	`ddbg_as£π
(0);

1077 
	}
}

1081 
	$ønge_m©ch
(*
ønge
, *
«me
) {

1082 *
ba£1
, *
ba£2
, *
ba£3
;

1083 
r1
[128], 
r2
[128];

1084 
i1
, 
i2
, 
i3
;

1086 if(!
	`°rcmp
(
ønge
, 
«me
)) {  1; }

1088 if(!
	`°rcmp
(
ønge
, "*"))  1;

1090 if(
	`ssˇnf
(
ønge
, "%†.. %s", 
r1
, 
r2
) != 2) {

1091 *
¥efix
; 
junk
;

1093 
	`dumb_•lô
(
«me
, &
¥efix
, &
junk
);

1098 if((
	`°æí
(
ønge
Ë=–°æí(
¥efix
) + 1)) &&

1099 !
	`°∫cmp
(
ønge
,
¥efix
,
	`°æí
(prefix)) &&

1100 (
ønge
[
	`°æí
(
¥efix
)] == '*'))  1;

1106 
	`dumb_•lô
(
r1
, &
ba£1
, &
i1
);

1107 
	`dumb_•lô
(
r2
, &
ba£2
, &
i2
);

1108 if(
	`°rcmp
(
ba£1
, 
ba£2
Ë|| (
i1
 < 0Ë|| (
i2
 < i1)) {

1109 
	`Ârötf
(
°dîr
, "***Éº‹: badÑ™gê\"%†.. %s\"\n", 
r1
, 
r2
);

1113 
	`dumb_•lô
(
«me
, &
ba£3
, &
i3
);

1114 if(!
	`°rcmp
(
ba£3
, 
ba£2
Ë&& (
i3
 >
i1
Ë&& (i3 <
i2
)) {

1120 
	}
}

1128 *
	$Õ_ovîride_ö°
(
Õ_block
 *
•ec
,

1129 *
˙ame
,

1130 
Õ_modlﬂdî_t
 
lﬂdî
,

1131 **
ovîrides
,

1132 
ovîrides_Àn
)

1134 
c
, 
d
;

1135 
Õ_block
 *
•ec_c›y
;

1136 *
p1
, *
p2
;

1137 *
ªsu…
;

1139 
•ec_c›y
 = 
	`c›y_block
(
•ec
);

1141 
c
 = 0; c < 
ovîrides_Àn
; c += 3) {

1142 if(
	`ønge_m©ch
(
ovîrides
[
c
], 
˙ame
)) {

1148 if(!
	`dumb_•lô2
(
ovîrides
[
c
+1], &
p1
, &
p2
)) {

1150 
d
 = 0; d < 
•ec_c›y
->
∑øms_Àn
; d++) {

1151 if(!
•ec_c›y
->
∑øms
[
d
]) ;

1152 if(!
	`°rcmp
(
p1
, 
•ec_c›y
->
∑øms
[
d
]->
«me
)) {

1153 if(
•ec_c›y
->
∑øms
[
d
]->
v
->
t
 !
BLOCK
) {

1154 
	`Ârötf
(
°dîr
, "***Érror:ÅriedÅoÑecurseÅhroughÇon-blockÖarameter.\n");

1158 
	`∑øm_ovîride
(
•ec_c›y
->
∑øms
[
d
]->
v
->v.
b
, 
p2
,

1159 
ovîrides
[
c
+2]);

1166 
	`∑øm_ovîride
(
•ec_c›y
,

1167 
ovîrides
[
c
+1],

1168 
ovîrides
[
c
+2]);

1176 if(!
	`check_ty≥s
(
•ec_c›y
)) {

1177 
ªsu…
 = 
	`lﬂdî
(
•ec_c›y
, 0);

1182  
ªsu…
;

1183 
	}
}

1185 
lib∑øm∑r£
();

1186 
lib∑ømÀx
();

1188 
	$Õ_lﬂdfûe
(
FILE
 *
ö
,

1189 
Õ_ét
 ***
éts
,

1190 *
éts_Àn
,

1191 *
öfûe
,

1192 **
˛i_ovîrides
,

1193 
˛i_ovîrides_Àn
) {

1195 *
Õ_•
;

1196 *
dúc
;

1197 *
dú
;

1199 
°dout_ßve
;

1200 
devnuŒ
;

1201 
t›_fûe
 = 0;

1202 
Õ_löío
 = 1;

1204 
dúc
 = 
	`°rdup
(
öfûe
);

1205 
dú
 = 
	`dú«me
(
dúc
);

1207 
Õ_fûíame
 = 
öfûe
;

1208 
Õ_cwd
 = 
dú
;

1209 
lib∑ømö
 = 
ö
;

1211 
ovîrides
 = 
˛i_ovîrides
;

1212 
ovîrides_Àn
 = 
˛i_ovîrides_Àn
;

1215 
Õ_•
 = 
	`gëív
("LP_PATH");

1216 if(
Õ_•
) {

1217 *
p
 = 
Õ_•
;

1218 *
cﬁ⁄
;

1220 
Õ_£¨ch∑th
 = 
	`ˇŒoc
(
LP_MAX_SP
, (*));

1222 *
p
) {

1223 
cﬁ⁄
 = 
	`°rchr
(
p
, ':');

1224 if(
cﬁ⁄
) {

1225 *
√xt
;

1227 *
cﬁ⁄
 = 0;

1229 
√xt
 = 
cﬁ⁄
+1;

1230 
Õ_£¨ch∑th
[
Õ_£¨ch∑th_Àn
++] = 
	`°rdup
(
p
);

1232 
p
 = 
√xt
;

1235 
Õ_£¨ch∑th
[
Õ_£¨ch∑th_Àn
++] = 
	`°rdup
(
p
);

1243 
Õ_éts
 = 0;

1244 
Õ_éts_Àn
 = 0;

1246 
	`fÊush
(
°dout
);

1247 
°dout_ßve
 = 
	`dup
(1);

1248 
devnuŒ
 = 
	`›í
("/dev/nuŒ", 
O_RDONLY
);

1249 
	`dup2
(
devnuŒ
, 1);

1251 
	`lib∑øm∑r£
();

1253 
	`fÊush
(
°dout
);

1254 
	`dup2
(
°dout_ßve
, 1);

1256 
	`˛o£
(
devnuŒ
);

1257 
	`˛o£
(
°dout_ßve
);

1260 if(
éts
) {

1261 *
éts
 = 
Õ_éts
;

1263 if(
éts_Àn
) {

1264 *
éts_Àn
 = 
Õ_éts_Àn
;

1268 
	}
}

1272 
	#LP_STACK_MAX
 32

	)

1274 
	$Õ_lﬂd∑øms
(*
ô
, 
Õ_block
 *
b
, 
Õ_mod
 *
m
) {

1275 
c
;

1276 
√eded
 = 0;

1277 
∑øm_°ack
[
LP_STACK_MAX
];

1278 
°ack_±r
 = 0;

1280 *
∑ømvec
 = 
	`ˇŒoc
(
m
->
modv¨s_Àn
, ());

1286 *
tmp
 = 
	`°rdup
(
b
->
sour˚_fûe
);

1287 
Õ_cwd
 = 
	`°rdup
(
	`dú«me
(
tmp
));

1290 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

1291 
≤um
, 
dïs
;

1293 if(!
b
->
∑øms
[
c
]) ;

1295 
TOP
:

1296 
≤um
 = 
	`Õ_∑øm_«me
(
	`Õ_mod_«me
(
m
->
«me
), 
b
->
∑øms
[
c
]->name);

1300 if(
	`BIT_TEST
(
∑ømvec
, 
≤um
)) ;

1303 if(
°ack_±r
 > 0) {

1304 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

1305 if(
	`Õ_∑øm_«me
(
	`Õ_mod_«me
(
m
->
«me
), 
b
->
∑øms
[
c
]->«meË=
√eded
)

1306 
FOUND
;

1312 
FOUND
:

1314 
dïs
 = 
m
->
∑øm_dïs
[
≤um
](
∑ømvec
);

1315 if(
dïs
 > -1) {

1316 
	`ddbg_as£π
(
°ack_±r
 < 
LP_STACK_MAX
);

1317 
∑øm_°ack
[
°ack_±r
++] = 
c
;

1318 
√eded
 = 
dïs
;

1322 
	`PTYPE
(
b
->
∑øms
[
c
])) {

1323 
I
:

1324 ((
Õ_∑ømlﬂdî_öt
)
m
->
∑øm_lﬂdîs
[
≤um
])(
ô
, 
	`IVAL
(
b
->
∑øms
[
c
]));

1326 
D
:

1327 ((
Õ_∑ømlﬂdî_doubÀ
)
m
->
∑øm_lﬂdîs
[
≤um
])(
ô
, 
	`DVAL
(
b
->
∑øms
[
c
]));

1329 
S
:

1330 ((
Õ_∑ømlﬂdî_°rög
)
m
->
∑øm_lﬂdîs
[
≤um
])(
ô
, 
	`SVAL
(
b
->
∑øms
[
c
]));

1332 
LIST
:

1333 ((
Õ_∑ømlﬂdî_li°
)
m
->
∑øm_lﬂdîs
[
≤um
])(
ô
, 
	`LVAL
(
b
->
∑øms
[
c
]));

1336 
BLOCK
:

1338 ((
Õ_∑ømlﬂdî_block
)
m
->
∑øm_lﬂdîs
[
≤um
])(
ô
, 
	`BVAL
(
b
->
∑øms
[
c
]));

1343 
	`BIT_SET
(
∑ømvec
, 
≤um
);

1344 if(
°ack_±r
 > 0) {

1345 
c
 = 
∑øm_°ack
[--
°ack_±r
];

1346 
TOP
;

1350 
c
 = 0; c < 
m
->
modv¨s_Àn
; c++) {

1351 if(
m
->
modv¨s
[
c
].
ªq
 && !
	`BIT_TEST
(
∑ømvec
,c)) {

1352 
	`Ârötf
(
°dîr
, "***Éº‹: i¿%†•e¯-- missögÑequúedÖ¨amëî %s\n", 
m
->
«me
, m->
modv¨s
[
c
].name);

1357 
	`‰ì
(
∑ømvec
);

1360 
	}
}

1364 
	$Õ_£¨ch_∑th
(*
cwd
, *
«me
)

1366 *
ˇnd
 = 
	`ˇŒoc
(
LP_PATH_MAX
, ());

1367 
°©
 
s
;

1368 
i
;

1370 if(
«me
[0] == '/')

1371 if(
	`°©
(
«me
, &
s
))

1372 
Áû
;

1374 
	`¢¥ötf
(
ˇnd
, 
LP_PATH_MAX
, "%s/%s", 
cwd
, 
«me
);

1376 if(!
	`°©
(
ˇnd
, &
s
))

1377 
succ
;

1379 
i
 = 0; i < 
Õ_£¨ch∑th_Àn
; i++) {

1380 
	`¢¥ötf
(
ˇnd
, 
LP_PATH_MAX
,

1381 "%s/%s", 
Õ_£¨ch∑th
[
i
], 
«me
);

1383 if(!
	`°©
(
ˇnd
, &
s
)) {

1384 
succ
;

1388 
Áû
:

1389 
	`‰ì
(
ˇnd
);

1392 
succ
:

1393  
ˇnd
;

1395 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/libparam/util.c

32 
	~<°dlib.h
>

33 
	~<°dio.h
>

34 
	~<˘y≥.h
>

35 
	~<°dlib.h
>

36 
	~<°rög.h
>

37 
	~<libddbg/libddbg.h
>

39 
	~<sys/ty≥s.h
>

40 
	~<sys/°©.h
>

42 #i‚de‡
WIN32


43 
	~<uni°d.h
>

45 
	~<io.h
>

48 
	~<f˙é.h
>

52 
	~"lib∑øm.h
"

53 
	~"bôve˘‹.h
"

55 
Õ_t›ﬁﬂdî_t
 
	gt›ﬁﬂdî
 = 0;

57 
	$Õ_ªgi°î_t›ﬁﬂdî
(
Õ_t›ﬁﬂdî_t
 
l
)

59 
t›ﬁﬂdî
 = 
l
;

60 
	}
}

65 *
	gÕ_buûtö_«mes
[] = {

76 
Õ_subty≥
 **
	gÕ_ty≥tbl
;

77 
	gÕ_ty≥tbl_Àn
;

79 
Õ_ét
 **
	gÕ_éts
;

80 
	gÕ_éts_Àn
;

85 **
	gÕ_£¨ch∑th
 = 0;

86 
	gÕ_£¨ch∑th_Àn
 = 0;

89 
Õ_löío
;

91 
de°roy_block
(
Õ_block
 *
b
);

92 
de°roy_vÆue
(
Õ_vÆue
 *
v
);

93 
de°roy_∑øm
(
Õ_∑øm
 *
p
);

94 
de°roy_li°
(
Õ_li°
 *
l
);

95 
de°roy_t›o•ec
(
Õ_t›o•ec
 *
t
);

97 
dumb_•lô
(*
s
, **
t
, *
i
);

98 
dumb_•lô2
(*
s
, **
s1
, **
s2
);

101 
	gÕ_max_mod
 = 0;

102 
	gÕ_mod_size
 = 0;

103 
Õ_mod
 **
	gÕ_moduÀs
 = 0;

105 **
	govîrides
 = 0;

106 
	govîrides_Àn
 = 0;

108 
	#ouçutfûe
 
°dout


	)

111 
Õ_vÆue
 *
	$Õ_√w_ötv
(
i
)

113 
Õ_vÆue
 *
v
 = 
	`ˇŒoc
(1, (lp_value));

114 
v
->v.
i
 = i;

115 
v
->
t
 = 
I
;

116  
v
;

117 
	}
}

119 
Õ_vÆue
 *
	$Õ_√w_doubÀv
(
d
)

121 
Õ_vÆue
 *
v
 = 
	`ˇŒoc
(1, (lp_value));

122 
v
->v.
d
 = d;

123 
v
->
t
 = 
D
;

124  
v
;

125 
	}
}

127 
Õ_vÆue
 *
	$Õ_√w_°rögv
(*
s
)

129 
Õ_vÆue
 *
v
 = 
	`ˇŒoc
(1, (lp_value));

130 
v
->v.
s
 = s;

131 
v
->
t
 = 
S
;

132  
v
;

133 
	}
}

135 
Õ_vÆue
 *
	$Õ_√w_li°v
(
Õ_li°
 *
l
)

137 
Õ_vÆue
 *
v
 = 
	`ˇŒoc
(1, (lp_value));

138 
v
->v.
l
 =Ü;

139 
v
->
t
 = 
LIST
;

140  
v
;

141 
	}
}

143 
Õ_vÆue
 *
	$Õ_√w_blockv
(
Õ_block
 *
b
)

145 
Õ_vÆue
 *
v
 = 
	`ˇŒoc
(1, (lp_value));

146 
v
->v.
b
 = b;

147 
v
->
t
 = 
b
->
ty≥
;

148  
v
;

149 
	}
}

152 
Õ_∑øm
 *

153 
	$Õ_√w_∑øm
(*
«me
, *
sour˚
, 
Õ_vÆue
 *
v
)

155 
Õ_∑øm
 *
ªsu…
 = 
	`ˇŒoc
(1, (lp_param));

156 
ªsu…
->
sour˚_fûe
 = 
sour˚
;

157 
ªsu…
->
«me
 =Çame;

158 
ªsu…
->
v
 = v;

161  
ªsu…
;

162 
	}
}

164 
Õ_li°
 *

165 
	$Õ_√w_li°
()

167 
Õ_li°
 *
l
 = 
	`ˇŒoc
(1, (lp_list));

168 
l
->
vÆues
 = 
	`ˇŒoc
(8, (
Õ_vÆue
 *));

169 
l
->
vÆues_Àn
 = 8;

170 
l
->
vÆues_p›
 = 0;

171 
l
->
löñí
 = 1;

172  
l
;

173 
	}
}

175 
Õ_block
 *

176 
	$Õ_√w_block
()

178 
Õ_block
 *
b
 = 
	`ˇŒoc
(1, (lp_block));

179 
b
->
∑øms
 = 
	`ˇŒoc
(8, (
Õ_∑øm
 *));

180 
b
->
∑øms_Àn
 = 8;

181  
b
;

182 
	}
}

184 
Õ_li°
 *

185 
	$Õ_√w_öéi°
(*
öèº
, 
Àn
)

187 
i
;

188 
Õ_li°
 *
l
 = 
	`Õ_√w_li°
();

190 
i
 = 0; i < 
Àn
; i++) {

191 
	`Õ_li°_add
(
l
, 
	`Õ_√w_ötv
(
öèº
[
i
]));

193  
l
;

194 
	}
}

198 
	$Õ_ªgi°î_moduÀ
(
Õ_mod
 *
m
) {

199 
c
;

200 
c
 = 0; c < 
Õ_max_mod
; c++) {

201 if(!
	`°rcmp
(
m
->
«me
, 
Õ_moduÀs
[
c
]->name)) {

205 if(
c
 >
Õ_mod_size
) {

206 
Õ_mod_size
 *= 2;Üp_mod_size++;

207 
Õ_moduÀs
 = 
	`ªÆloc
÷p_moduÀs, 
Õ_mod_size
 * (*));

209 if(
c
 > 0)

210 
Õ_moduÀs
[
c
] = 
m
;

212 
Õ_moduÀs
[0] = 
m
;

214 
Õ_max_mod
++;

216  
c
;

217 
	}
}

222 
	$dõ
(*
msg
) {

223 
	`Ârötf
(
°dîr
, "***Éº‹: FATAL: %s\n", 
msg
);

224 
	`exô
(1);

225 
	}
}

227 
	$de°roy_∑øm
(
Õ_∑øm
 *
p
)

229 
	`‰ì
(
p
->
«me
);

230 
	`de°roy_vÆue
(
p
->
v
);

231 
	`‰ì
(
p
);

232 
	}
}

235 
	$de°roy_li°
(
Õ_li°
 *
l
) {

236 
c
;

237 
c
 = 0; c < 
l
->
vÆues_Àn
; c++)

238 if(
l
->
vÆues
[
c
])

239 
	`de°roy_vÆue
(
l
->
vÆues
[
c
]);

241 
	`‰ì
(
l
->
vÆues
);

242 
	`‰ì
(
l
);

243 
	}
}

246 
	$de°roy_vÆue
(
Õ_vÆue
 *
v
) {

247 
d
;

248 
v
->
t
) {

249 
S
:

250 
	`‰ì
(
v
->v.
s
);

253 
LIST
:

254 
	`de°roy_li°
(
v
->v.
l
);

257 
I
:

258 
D
: ;

260 
TOPOSPEC
:

261 
d
 = 0; d < 
v
->v.
t
.
Àn
; d++)

262 
	`de°roy_t›o•ec
(&
v
->v.
t
.
l
[
d
]);

264 
	`‰ì
(
v
->v.
t
.
l
);

268 
	`de°roy_block
(
v
->v.
b
);

271 
	`‰ì
(
v
);

272 
	}
}

275 
	$de°roy_block
(
Õ_block
 *
b
) {

276 
c
;

277 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

278 if(
b
->
∑øms
[
c
]) {

279 
	`de°roy_∑øm
(
b
->
∑øms
[
c
]);

283 
	`‰ì
(
b
->
«me
);

284 
	`‰ì
(
b
->
∑øms
);

285 
	`‰ì
(
b
);

286 
	}
}

288 
	$de°roy_t›o•ec
(
Õ_t›o•ec
 *
t
)

290 
	`‰ì
(
t
->
ty≥
);

291 
	`‰ì
(
t
->
«me
);

292 
	`de°roy_li°
(
t
->
l
);

293 
	}
}

296 
Õ_block
 *
c›y_block
(lp_block *);

297 
Õ_li°
 *
c›y_li°
(lp_list *);

298 
Õ_vÆue
 *
c›y_vÆue
(lp_value *);

299 
Õ_∑øm
 *
c›y_∑øm
(lp_param *);

301 
Õ_block
 *
	$c›y_block
(
Õ_block
 *
b
)

303 
c
;

304 
Õ_block
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

305 
	`mem˝y
(
ªsu…
, 
b
, (
Õ_block
));

306 
ªsu…
->
∑øms
 = 
	`ˇŒoc
(
b
->
∑øms_Àn
, (result->params[0]));

308 if(
b
->
«me
) {

309 
ªsu…
->
«me
 = 
	`°rdup
(
b
->name);

312 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

313 if(
b
->
∑øms
[
c
]) {

314 
ªsu…
->
∑øms
[
c
] = 
	`c›y_∑øm
(
b
->params[c]);

318  
ªsu…
;

319 
	}
}

322 
Õ_li°
 *
	$c›y_li°
(
Õ_li°
 *
l
) {

323 
c
;

324 
Õ_li°
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

325 
	`mem˝y
(
ªsu…
, 
l
, (
Õ_li°
));

326 
ªsu…
->
vÆues
 = 
	`ˇŒoc
(
l
->
vÆues_Àn
, (result->values[0]));

327 
	`mem˝y
(
ªsu…
->
vÆues
, 
l
->vÆues,Ü->
vÆues_Àn
 * (*));

328 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

329 if(
l
->
vÆues
[
c
]) {

330 
ªsu…
->
vÆues
[
c
] = 
	`c›y_vÆue
(
l
->values[c]);

333  
ªsu…
;

334 
	}
}

337 
Õ_vÆue
 *
	$c›y_vÆue
(
Õ_vÆue
 *
v
) {

338 
Õ_vÆue
 *
ªsu…
 = 
	`ˇŒoc
(1, (lp_value));

339 
	`mem˝y
(
ªsu…
, 
v
, (
Õ_vÆue
));

340 
v
->
t
) {

341 
S
:

342 
ªsu…
->
v
.
s
 = 
	`°rdup
(v->v.s);

345 
LIST
:

346 
ªsu…
->
v
.
l
 = 
	`c›y_li°
(v->v.l);

349 
BLOCK
:

350 
ªsu…
->
v
.
b
 = 
	`c›y_block
(v->v.b);

357  
ªsu…
;

358 
	}
}

360 
Õ_∑øm
 *
	$c›y_∑øm
(
Õ_∑øm
 *
p
) {

361 
Õ_∑øm
 *
ªsu…
 = 
	`ˇŒoc
(1, (lp_param));

362 
ªsu…
->
«me
 = 
	`°rdup
(
p
->name);

363 
ªsu…
->
v
 = 
	`c›y_vÆue
(
p
->v);

364  
ªsu…
;

365 
	}
}

368 
	gödít_Àvñ
 = 0;

370 
	$ödít
(
FILE
 *
f
) {

371 *
•a˚
 = 
	`ˇŒoc
(1, 3*
ödít_Àvñ
+1);

372 
	`mem£t
(
•a˚
, ()' ', 3*
ödít_Àvñ
);

373 
•a˚
[3*
ödít_Àvñ
] = 0;

374 
	`Ârötf
(
f
, "%s", 
•a˚
);

375 
	`‰ì
(
•a˚
);

376 
	}
}

378 
	$u≈¨£_sour˚
(*
sour˚
, 
FILE
 *
outfûe
) {

379 
	`Ârötf
(
outfûe
, "sour˚ %s", 
sour˚
);

380 
	}
}

382 
	$u≈¨£_ty≥
(
t
, 
FILE
 *
outfûe
) {

383 if(
t
 < 0) {

384 
	`Ârötf
(
outfûe
, "%s", 
Õ_buûtö_«mes
[
	`abs
(
t
)]);

387 if(
t
 > 
Õ_max_mod
) {

388 
	`Ârötf
(
outfûe
, "<UNKNOWN TYPE>");

391 
	`Ârötf
(
outfûe
, "%s", 
Õ_moduÀs
[
t
]->
«me
);

394 
	}
}

396 
	$u≈¨£_∑øm
(
Õ_∑øm
 *
p
, 
FILE
 *
outfûe
) {

397 
	`Ârötf
(
outfûe
, "%†", 
p
->
«me
);

398 if(
p
->
sour˚_fûe
 &&Ö->
v
->source_file) {

399 if(
	`°rcmp
(
p
->
sour˚_fûe
,Ö->
v
->source_file)) {

400 
	`u≈¨£_sour˚
(
p
->
v
->
sour˚_fûe
, 
outfûe
);

405 
	`u≈¨£_vÆue
(
p
->
v
, 
outfûe
);

406 
	}
}

408 
	$u≈¨£_vÆue
(
Õ_vÆue
 *
v
, 
FILE
 *
outfûe
) {

409 
c
;

410 
v
->
t
) {

411 
I
:

412 
	`Ârötf
(
outfûe
, "%d", 
v
->v.
i
);

414 
D
:

415 if(
v
->v.
d
 == 0.0) {

416 
	`Ârötf
(
outfûe
, "0.0");

419 
	`Ârötf
(
outfûe
, "%f", 
v
->v.
d
);

422 
S
:

423 
	`Ârötf
(
outfûe
, "%s", 
v
->v.
s
);

425 
LIST
:

426 
	`u≈¨£_li°
(
v
->v.
l
, 
outfûe
);

428 
TOPOSPEC
:

429 
c
 = 0; c < 
v
->v.
t
.
Àn
; c++)

430 
	`u≈¨£_t›o•ec
(&
v
->v.
t
.
l
[
c
], 
outfûe
);

433 
BLOCK
:

434 
	`u≈¨£_block
(
v
->v.
b
, 
outfûe
);

437 
	}
}

439 
	$u≈¨£_li°
(
Õ_li°
 *
l
, 
FILE
 *
outfûe
) {

440 
¥öãd
 = 0;

441 
c
;

445 
	`Ârötf
(
outfûe
, "[ ");

446 
ödít_Àvñ
++;

447 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

448 if(!
l
->
vÆues
[
c
])

451 if(
c
) {

452 
	`Ârötf
(
outfûe
, ", ");

453 if(!(
c
 % 
l
->
löñí
)) {

454 
	`Ârötf
(
outfûe
, "\n");

455 
	`ödít
(
outfûe
);

459 
	`Ârötf
(
outfûe
, "\n");

460 
	`ödít
(
outfûe
);

463 
¥öãd
++;

464 
	`u≈¨£_vÆue
(
l
->
vÆues
[
c
], 
outfûe
);

466 
ödít_Àvñ
--;

468 if((
c
 > 0Ë&& 
¥öãd
) {

469 
	`Ârötf
(
outfûe
, "\n");

470 
	`ödít
(
outfûe
);

472 
	`Ârötf
(
outfûe
, "]");

473 
	}
}

476 
	$u≈¨£_block
(
Õ_block
 *
b
, 
FILE
 *
outfûe
) {

477 
c
;

479 if(
b
->
«me
) {

481 
	`Ârötf
(
outfûe
, "%†%†{\n", 
Õ_moduÀs
[
b
->
ty≥
]->
«me
, b->name);

485 
	`Ârötf
(
outfûe
, "%†{\n", 
Õ_moduÀs
[
b
->
ty≥
]->
«me
);

489 
ödít_Àvñ
++;

490 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

491 if(!
b
->
∑øms
[
c
]) ;

493 if(
c
Ë
	`Ârötf
(
outfûe
, ",\n");

495 
	`u≈¨£_∑øm
(
b
->
∑øms
[
c
], 
outfûe
);

497 
ödít_Àvñ
--;

498 
	`Ârötf
(
outfûe
, "\n");

499 
	`ödít
(
outfûe
);

500 
	`Ârötf
(
outfûe
, "}");

501 if(
b
->
«me
) {

502 
	`Ârötf
(
outfûe
, " #Énd o‡%†•ec", 
b
->
«me
);

503 
	`Ârötf
(
outfûe
, "\n\n");

505 
	}
}

507 
	$u≈¨£_t›o•ec
(
Õ_t›o•ec
 *
t
, 
FILE
 *
outfûe
) {

508 
	`Ârötf
(
outfûe
, "%†%†", 
t
->
ty≥
,Å->
«me
);

509 
	`u≈¨£_li°
(
t
->
l
, 
outfûe
);

512 
	}
}

515 
	$u≈¨£_é_t›o•ec
(
Õ_t›o•ec
 *
t
, 
FILE
 *
outfûe
)

517 
	`Ârötf
(
outfûe
, "topospec ");

518 
	`u≈¨£_t›o•ec
(
t
, 
outfûe
);

519 
	`Ârötf
(
outfûe
, "\n\n");

520 
	}
}

522 
	$u≈¨£_ö°
(
Õ_ö°
 *
i
, 
FILE
 *
outfûe
) {

523 
	`Ârötf
(
outfûe
, "instantiate ");

524 
	`u≈¨£_li°
(
i
->
l
, 
outfûe
);

525 
	`Ârötf
(
outfûe
, "á†%s\n\n", 
i
->
«me
);

526 
	}
}

528 
	$u≈¨£_ét
(
Õ_ét
 *
ét
, 
FILE
 *
outfûe
, *
öfûe
) {

530 if(
ét
->
sour˚_fûe
 && 
öfûe
) {

531 if(
	`°rcmp
(
ét
->
sour˚_fûe
, 
öfûe
)) {

532 
	`u≈¨£_sour˚
(
ét
->
sour˚_fûe
, 
outfûe
);

537 
ét
->
wh©
) {

538 
TLT_BLOCK
: 
	`u≈¨£_block
(
ét
->
ô
.
block
, 
outfûe
); ;

539 
TLT_TOPO
: 
	`u≈¨£_é_t›o•ec
(
ét
->
ô
.
t›o
, 
outfûe
); ;

540 
TLT_INST
: 
	`u≈¨£_ö°
(
ét
->
ô
.
ö°
, 
outfûe
); ;

541 : 
	`ddbg_as£π
(0); ;

544 
	}
}

546 
	$Õ_u≈¨£_éts
(
Õ_ét
 **
éts
,

547 
éts_Àn
,

548 
FILE
 *
outfûe
,

549 *
öfûe
)

551 
c
;

552 
c
 = 0; c < 
éts_Àn
; c++) {

553 if(
éts
[
c
] != 0) {

554 
	`u≈¨£_ét
(
éts
[
c
], 
outfûe
, 
öfûe
);

557 
	}
}

562 
	$Õ_ö°_li°
(
Õ_ö°
 *
i
)

564 
c
;

568 
c
 = 0; c < 
i
->
l
->
vÆues_Àn
; c++) {

569 if(!
i
->
l
->
vÆues
[
c
]) ;

571 
	`ddbg_as£π3
(
i
->
l
->
vÆues
[
c
]->
t
 =
S
,

572 ("badÅy≥ f‹ comp⁄íà%s", 
i
->
l
->
vÆues
[
c
]->
v
.
s
));

574 
	`Õ_ö°™tüã
(
i
->
l
->
vÆues
[
c
]->
v
.
s
, i->
«me
);

578 
	}
}

581 *
	$Õ_ö°™tüã
(*
èrg
, *
«me
) {

582 *
«mëmp
;

583 
Õ_block
 *
•ec
;

584 *
obj
;

588 
•ec
 = 
	`Õ_lookup_•ec
(
«me
);

589 
	`ddbg_as£π3
(
•ec
 !0, ("nÿsuchÅy≥ %s.\n", 
«me
));

595 
«mëmp
 = 
•ec
->
«me
;

596 
•ec
->
«me
 = 
èrg
;

600 
obj
 = 
	`Õ_ovîride_ö°
(
•ec
,

601 
èrg
,

602 
Õ_moduÀs
[
•ec
->
ty≥
]->
‚
,

603 
ovîrides
,

604 
ovîrides_Àn
);

607 
•ec
->
«me
 = 
«mëmp
;

610 if(!
obj
) {

614 if(
Õ_moduÀs
[
•ec
->
ty≥
]->
ˇŒback
) {

615 
Õ_moduÀs
[
•ec
->
ty≥
]->
	`ˇŒback
÷p_moduÀs[•ec->ty≥]->
˘x
, 
obj
);

618  
obj
;

619 
	}
}

622 
	$check_ty≥s
(
Õ_block
 *
b
) {

623 
c
 = 0;

628 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

629 if(
b
->
∑øms
[
c
]) {

630 if(
	`Õ_∑øm_«me
(
b
->
ty≥
, b->
∑øms
[
c
]->
«me
) == -1) {

632 
	`Ârötf
(
°dîr
, "*** warning:Öarameter %sÇot valid in context %s\n",

633 
b
->
∑øms
[
c
]->
«me
, 
Õ_moduÀs
[b->
ty≥
]->name);

637 if(
Õ_moduÀs
[
b
->
ty≥
]->
modv¨s
[
	`Õ_∑øm_«me
(b->ty≥, b->
∑øms
[
c
]->
«me
)].type

638 !
	`PTYPE
(
b
->
∑øms
[
c
])) {

641 if((
Õ_moduÀs
[
b
->
ty≥
]->
modv¨s
[
	`Õ_∑øm_«me
(b->ty≥, b->
∑øms
[
c
]->
«me
)].type

642 =
D
)

643 && (
	`PTYPE
(
b
->
∑øms
[
c
]Ë=
I
)) {

644 
b
->
∑øms
[
c
]->
v
->
t
 = 
D
;

645 
	`DVAL
(
b
->
∑øms
[
c
]Ë(Ë
	`IVAL
(b->params[c]);

649 
	`Ârötf
(
°dîr
, "***Érror:ÅypeÉrror: %s::\"%s\" cannotÅakeÅype ",

650 
Õ_moduÀs
[
b
->
ty≥
]->
«me
,

651 
b
->
∑øms
[
c
]->
«me
);

654 
	`Ârötf
(
°dîr
, "\n");

656 
	`dõ
("check_types() failed");

662 if(
	`PTYPE
(
b
->
∑øms
[
c
]Ë>
BLOCK
) {

663 
	`check_ty≥s
(
	`BVAL
(
b
->
∑øms
[
c
]));

665 if(
	`PTYPE
(
b
->
∑øms
[
c
]Ë=
LIST
) {

666 
d
;

667 
Õ_li°
 *
l
 = 
	`LVAL
(
b
->
∑øms
[
c
]);

668 
d
 = 0; d < 
l
->
vÆues_Àn
; d++) {

669 if(
l
->
vÆues
[
d
]) {

670 if(
l
->
vÆues
[
d
]->
t
 >
BLOCK
) {

671 
	`check_ty≥s
(
l
->
vÆues
[
d
]->
v
.
b
);

680 
	}
}

682 
	$lﬂd_block
(
Õ_block
 *
b
) {

683 
n
;

685 
	`Õ_lookup_ty≥
(
b
->
«me
, &
n
);

686 
Õ_ty≥tbl
[
n
]->
•ec
 = 
b
;

687 
	}
}

692 
	$lﬂd_t›o
(
Õ_t›o•ec
 *
t
, 
Àn
)

695 
	`t›ﬁﬂdî
(
t
, 
Àn
);

696 
	}
}

702 
	$¥ötv¨s
() {

703 
c
, 
d
;

704 
c
 = 0; c < 
Õ_max_mod
; c++) {

705 
d
 = 0; d < 
Õ_moduÀs
[
c
]->
modv¨s_Àn
; d++) {

706 
	`¥ötf
("%s::%s\n", 
Õ_moduÀs
[
c
]->
«me
,

707 
Õ_moduÀs
[
c
]->
modv¨s
[
d
].
«me
);

710 
	}
}

714 
	$dummy
 (
Õ_block
 *
b
) {

715 
	`Ârötf
(
°dîr
, "***Érror: %s cannot be declaredátÅop-level.\n",

716 
b
->
«me
);

717 
	`exô
(1);

718 
	}
}

721 
Õ_li°
 *
	$Õ_li°_add
(
Õ_li°
 *
l
,

722 
Õ_vÆue
 *
v
)

724 
c
, 
√wÀn
;

725 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

726 if(!
l
->
vÆues
[
c
]Ë
d⁄e
;

728 
√wÀn
 = 2 * 
c
 * (
Õ_vÆue
 *);

729 
l
->
vÆues
 = 
	`ªÆloc
÷->vÆues, 
√wÀn
);

730 
	`bzîo
(
l
->
vÆues
 + 
c
, 
√wÀn
 / 2);

731 
l
->
vÆues_Àn
 *= 2;

733 
d⁄e
:

734 
l
->
vÆues_p›
++;

735 
l
->
vÆues
[
c
] = 
v
;

737  
l
;

738 
	}
}

747 
	$Õ_∑øm_«me
(
m
, *
n
)

749 
c
 = 0;

750 if(!
	`RANGE
(
m
,0,
Õ_max_mod
))  -1;

751 if(!
n
)  -1;

753 (
c
 < 
Õ_moduÀs
[
m
]->
modv¨s_Àn
)

754 && 
	`°rcmp
(
Õ_moduÀs
[
m
]->
modv¨s
[
c
].
«me
, 
n
)) c++;

756 if(
c
 >
Õ_moduÀs
[
m
]->
modv¨s_Àn
) {

760  
c
;

762 
	}
}

765 
	$Õ_mod_«me
(*
n
) {

766 
c
 = 0;

767 if(!
n
)  -1;

769 (
c
 < 
Õ_max_mod
Ë&& 
	`°rcmp
(
Õ_moduÀs
[c]->
«me
, 
n
)) c++;

771 if(
c
 >
Õ_max_mod
) {

775  
c
;

777 
	}
}

780 *
	$Õ_lookup_ba£_ty≥
(*
«me
, *
n
) {

781 
c
;

782 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++) {

783 if(
Õ_ty≥tbl
[
c
]) {

784 if(!
	`°rcmp
(
«me
, 
Õ_ty≥tbl
[
c
]->
sub
)) {

785 if(
Õ_ty≥tbl
[
c
]->
su≥r
) {

786  
	`Õ_lookup_ba£_ty≥
(
Õ_ty≥tbl
[
c
]->
su≥r
, 
n
);

795 if(
n
Ë*¿
c
;

796  
«me
;

797 
	}
}

799 *
	$Õ_lookup_ty≥
(*
«me
, *
n
) {

800 
c
;

801 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++) {

802 if(
Õ_ty≥tbl
[
c
]) {

803 if(!
	`°rcmp
(
«me
, 
Õ_ty≥tbl
[
c
]->
sub
)) {

804 if(
n
Ë*¿
c
;

805  
Õ_ty≥tbl
[
c
]->
su≥r
;

810 
	}
}

819 
Õ_block
 *
	$Õ_lookup_•ec
(*
«me
) {

820 
c
;

822 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++)

823 if(
Õ_ty≥tbl
[
c
]) {

824 if(!
«me
) {

825 if(
Õ_ty≥tbl
[
c
]->
su≥r
) {

826  
Õ_ty≥tbl
[
c
]->
•ec
;

829 if(!
	`°rcmp
(
«me
, 
Õ_ty≥tbl
[
c
]->
sub
)) {

830  
Õ_ty≥tbl
[
c
]->
•ec
;

835 
	}
}

838 
Õ_ét
 *
	$Õ_√w_é_t›o
(
Õ_t›o•ec
 *
t
, *
sour˚_fûe
)

840 
Õ_ét
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

841 
ªsu…
->
sour˚_fûe
 = source_file;

842 
ªsu…
->
wh©
 = 
TLT_TOPO
;

843 
ªsu…
->
ô
.
t›o
 = 
t
;

844 
	`Õ_add_ét
(
ªsu…
);

845  
ªsu…
;

846 
	}
}

848 
Õ_ét
 *
	$Õ_√w_é_ö°
(
Õ_ö°
 *
i
, *
sour˚_fûe
)

850 
Õ_ét
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

851 
ªsu…
->
sour˚_fûe
 = source_file;

852 
ªsu…
->
wh©
 = 
TLT_INST
;

853 
ªsu…
->
ô
.
ö°
 = 
i
;

854 
	`Õ_add_ét
(
ªsu…
);

855  
ªsu…
;

856 
	}
}

858 
Õ_ét
 *
	$Õ_√w_é_block
(
Õ_block
 *
b
, *
sour˚_fûe
)

860 
Õ_ét
 *
ªsu…
 = 
	`ˇŒoc
(1, (*result));

861 
ªsu…
->
sour˚_fûe
 = source_file;

862 
ªsu…
->
wh©
 = 
TLT_BLOCK
;

863 
ªsu…
->
ô
.
block
 = 
b
;

864 
	`Õ_add_ét
(
ªsu…
);

865  
ªsu…
;

866 
	}
}

869 
	$Õ_add_ét
(
Õ_ét
 *
ét
) {

870 
c
;

871 
found
 = 0;

873 
c
 = 0; c < 
Õ_éts_Àn
; c++) {

874 if(!
Õ_éts
[
c
]) {

875 
found
 = 
c
; ;

879 if(!
found
) {

880 
√wÀn
 = 
Õ_éts_Àn
 ? 2 *Üp_tlts_len : 2;

881 
zîo˙t
 = 
Õ_éts_Àn
 ?Üp_tlts_len : 2;

883 
√wsize
 = 
√wÀn
 * (
Õ_éts
 *);

884 
zîo˙t
 *(
Õ_éts
 *);

886 
Õ_éts
 = 
	`ªÆloc
÷p_éts, 
√wsize
);

887 
	`mem£t
(
Õ_éts
 + 
Õ_éts_Àn
, 0, 
zîo˙t
);

888 
found
 = 
Õ_éts_Àn
;

889 
Õ_éts_Àn
 = 
√wÀn
;

892 
Õ_éts
[
c
] = 
ét
;

893 
	}
}

896 
	$Õ_add_ty≥
(*
√wt
, *
∑ª¡
) {

897 
c
;

898 
√wÀn
;

899 
Õ_subty≥
 *
°
 = 
	`ˇŒoc
(1, (*st));

900 
°
->
su≥r
 = 
	`°rdup
(
∑ª¡
); st->
sub
 = sådup(
√wt
);

902 if(!
	`Õ_lookup_ty≥
(
√wt
,0)) {

903 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++)

904 if(!
Õ_ty≥tbl
[
c
]) {

905 
d⁄e
;

909 
√wÀn
 = 
Õ_ty≥tbl_Àn
 ? 2 *Üp_typetbl_len : 2;

911 
Õ_ty≥tbl
 = 
	`ªÆloc
÷p_ty≥tbl, 
√wÀn
 * (*));

913 
	`bzîo
(
Õ_ty≥tbl
 + 
c
, c * (*));

914 
Õ_ty≥tbl_Àn
 = 
√wÀn
;

918 
d⁄e
:

919 
Õ_ty≥tbl
[
c
] = 
°
;

921 
	}
}

924 
	$Õ_add_∑øm
(
Õ_∑øm
 ***
b
, *
∂í
,

925 
Õ_∑øm
 *
p
)

927 
c
;

930 
c
 = 0; c < *
∂í
; c++) {

931 if(!(*
b
)[
c
]) ;

932 if(!
	`°rcmp
((*
b
)[
c
]->
«me
, 
p
->name)) {

933 
	`Ârötf
(
°dîr
, "***Éº‹:Ñedeföed %s\n", 
p
->
«me
);

939 
c
 = 0; c < *
∂í
; c++) {

940 if(!(*
b
)[
c
]) {

941 (*
b
)[
c
] = 
p
;

945 if(
c
 =*
∂í
) {

947 
√wÀn
 = 2 * (*
∂í
) + 1;

948 (*
b
Ë
	`ªÆloc
((*b), 
√wÀn
 * (*));

949 
	`bzîo
((*)(*
b
Ë+ *
∂í
, ((*plen) + 1) * (*));

950 (*
b
)[(*
∂í
)] = 
p
;

951 *
∂í
 = 
√wÀn
;

955 
	}
}

959 
	$Õ_£tup_subty≥
(
Õ_block
 *
∑ª¡
,

960 
Õ_block
 *
chûd
)

962 
c
, 
d
;

964 
c
 = 0; c < 
∑ª¡
->
∑øms_Àn
; c++) {

965 
found
 = 0;

966 
d
 = 0; d < 
chûd
->
∑øms_Àn
; d++) {

967 if(!
	`°rcmp
(
chûd
->
∑øms
[
d
]->
«me
, 
∑ª¡
->∑øms[
c
]->name)) {

968 
found
 = 1;

971 if(!
found
) {

972 
	`Õ_add_∑øm
(&
chûd
->
∑øms
, &chûd->
∑øms_Àn
, 
∑ª¡
->∑øms[
c
]);

977 
	}
}

982 
	$Õ_öô_ty≥tbl
() {

983 
c
;

984 
Õ_ty≥tbl
 = 
	`ˇŒoc
(
Õ_max_mod
, (
subty≥
 *));

987 
c
 = 0; c < 
Õ_max_mod
; c++) {

989 
Õ_ty≥tbl
[
c
] = 
	`mÆloc
((
Õ_subty≥
));

990 
	`bzîo
(
Õ_ty≥tbl
[
c
], (
Õ_subty≥
));

991 
Õ_ty≥tbl
[
c
]->
sub
 = 
	`°rdup
(
Õ_moduÀs
[c]->
«me
);

994 
Õ_ty≥tbl_Àn
 = 
Õ_max_mod
;

995 
	}
}

997 
	$Õ_ªÀa£_ty≥tbl
() {

998 
c
;

1000 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++) {

1001 if(!
Õ_ty≥tbl
[
c
]) ;

1003 if(
Õ_ty≥tbl
[
c
]->
•ec
)

1004 
	`de°roy_block
(
Õ_ty≥tbl
[
c
]->
•ec
);

1006 if(
Õ_ty≥tbl
[
c
]->
sub
)

1007 
	`‰ì
(
Õ_ty≥tbl
[
c
]->
sub
);

1009 if(
Õ_ty≥tbl
[
c
]->
su≥r
)

1010 
	`‰ì
(
Õ_ty≥tbl
[
c
]->
su≥r
);

1012 
	`‰ì
(
Õ_ty≥tbl
[
c
]);

1015 
	`‰ì
(
Õ_ty≥tbl
);

1016 
	}
}

1021 
	$dumb_•lô
(*
s
, **
t
, *
i
) {

1022 
c
 = 
	`°æí
(
s
) - 1;

1024 
c
 && 
	`isdigô
(
s
[c])) c--;

1025 if(!
c
)  -1;

1026 
c
++;

1027 (*
i
Ë
	`©oi
(&
s
[
c
]);

1028 *
t
 = 
	`°rdup
(
s
);

1029 (*
t
)[
c
] = 0;

1031 
	}
}

1034 
	$dumb_•lô2
(*
s
, **
s1
, **
s2
) {

1035 
c
 = 0;

1036 (*
s1
Ë
	`°rdup
(
s
);

1037 
s
[
c
] && (s[c] != ':')) c++;

1038 (*
s1
)[
c
] = 0;

1039 if(
s
[
c
]Ë(*
s2
Ë
	`°rdup
(s + c + 1);

1043 
	}
}

1049 
	$∑øm_ovîride
(
Õ_block
 *
b
,

1050 *
≤ame
,

1051 *
pvÆ
)

1053 
c
;

1055 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

1056 if(!
b
->
∑øms
[
c
]) ;

1057 if(!
	`°rcmp
(
b
->
∑øms
[
c
]->
«me
, 
≤ame
)) {

1058 
b
->
∑øms
[
c
]->
v
->
t
) {

1059 
I
:

1060 
b
->
∑øms
[
c
]->
v
->v.
i
 = 
	`©oi
(
pvÆ
);

1062 
D
:

1063 
b
->
∑øms
[
c
]->
v
->v.
d
 = 
	`©of
(
pvÆ
);

1065 
S
:

1066 
	`‰ì
(
b
->
∑øms
[
c
]->
v
->v.
s
);

1067 
b
->
∑øms
[
c
]->
v
->v.
s
 = 
	`°rdup
(
pvÆ
);

1072 
	`ddbg_as£π
(0);

1081 
	}
}

1085 
	$ønge_m©ch
(*
ønge
, *
«me
) {

1086 *
ba£1
, *
ba£2
, *
ba£3
;

1087 
r1
[128], 
r2
[128];

1088 
i1
, 
i2
, 
i3
;

1090 if(!
	`°rcmp
(
ønge
, 
«me
)) {  1; }

1092 if(!
	`°rcmp
(
ønge
, "*"))  1;

1094 if(
	`ssˇnf
(
ønge
, "%†.. %s", 
r1
, 
r2
) != 2) {

1095 *
¥efix
; 
junk
;

1097 
	`dumb_•lô
(
«me
, &
¥efix
, &
junk
);

1102 if((
	`°æí
(
ønge
Ë=–°æí(
¥efix
) + 1)) &&

1103 !
	`°∫cmp
(
ønge
,
¥efix
,
	`°æí
(prefix)) &&

1104 (
ønge
[
	`°æí
(
¥efix
)] == '*'))  1;

1110 
	`dumb_•lô
(
r1
, &
ba£1
, &
i1
);

1111 
	`dumb_•lô
(
r2
, &
ba£2
, &
i2
);

1112 if(
	`°rcmp
(
ba£1
, 
ba£2
Ë|| (
i1
 < 0Ë|| (
i2
 < i1)) {

1113 
	`Ârötf
(
°dîr
, "***Éº‹: badÑ™gê\"%†.. %s\"\n", 
r1
, 
r2
);

1117 
	`dumb_•lô
(
«me
, &
ba£3
, &
i3
);

1118 if(!
	`°rcmp
(
ba£3
, 
ba£2
Ë&& (
i3
 >
i1
Ë&& (i3 <
i2
)) {

1124 
	}
}

1132 *
	$Õ_ovîride_ö°
(
Õ_block
 *
•ec
,

1133 *
˙ame
,

1134 
Õ_modlﬂdî_t
 
lﬂdî
,

1135 **
ovîrides
,

1136 
ovîrides_Àn
)

1138 
c
, 
d
;

1139 
Õ_block
 *
•ec_c›y
;

1140 *
p1
, *
p2
;

1141 *
ªsu…
;

1143 
•ec_c›y
 = 
	`c›y_block
(
•ec
);

1145 
c
 = 0; c < 
ovîrides_Àn
; c += 3) {

1146 if(
	`ønge_m©ch
(
ovîrides
[
c
], 
˙ame
)) {

1152 if(!
	`dumb_•lô2
(
ovîrides
[
c
+1], &
p1
, &
p2
)) {

1154 
d
 = 0; d < 
•ec_c›y
->
∑øms_Àn
; d++) {

1155 if(!
•ec_c›y
->
∑øms
[
d
]) ;

1156 if(!
	`°rcmp
(
p1
, 
•ec_c›y
->
∑øms
[
d
]->
«me
)) {

1157 if(
•ec_c›y
->
∑øms
[
d
]->
v
->
t
 !
BLOCK
) {

1158 
	`Ârötf
(
°dîr
, "***Érror:ÅriedÅoÑecurseÅhroughÇon-blockÖarameter.\n");

1162 
	`∑øm_ovîride
(
•ec_c›y
->
∑øms
[
d
]->
v
->v.
b
, 
p2
,

1163 
ovîrides
[
c
+2]);

1170 
	`∑øm_ovîride
(
•ec_c›y
,

1171 
ovîrides
[
c
+1],

1172 
ovîrides
[
c
+2]);

1180 if(!
	`check_ty≥s
(
•ec_c›y
)) {

1181 
ªsu…
 = 
	`lﬂdî
(
•ec_c›y
, 0);

1186  
ªsu…
;

1187 
	}
}

1190 
lib∑øm∑r£
();

1192 
	$Õ_lﬂdfûe
(
FILE
 *
ö
,

1193 
Õ_ét
 ***
éts
,

1194 *
éts_Àn
,

1195 *
öfûe
,

1196 **
˛i_ovîrides
,

1197 
˛i_ovîrides_Àn
) {

1199 *
Õ_•
;

1200 *
dúc
;

1201 *
dú
;

1203 
°dout_ßve
;

1204 
devnuŒ
;

1205 
t›_fûe
 = 0;

1206 
Õ_löío
 = 1;

1208 
dúc
 = 
	`°rdup
(
öfûe
);

1209 
dú
 = 
	`dú«me
(
dúc
);

1211 
Õ_fûíame
 = 
öfûe
;

1212 
Õ_cwd
 = 
dú
;

1213 
lib∑ømö
 = 
ö
;

1215 
ovîrides
 = 
˛i_ovîrides
;

1216 
ovîrides_Àn
 = 
˛i_ovîrides_Àn
;

1219 #ifde‡
WIN32


1220 
Õ_•
 = 
	`°rdup
(
	`gëív
("LP_PATH"));

1222 
Õ_•
 = 
	`gëív
("LP_PATH");

1224 if(
Õ_•
) {

1225 *
p
 = 
Õ_•
;

1226 *
cﬁ⁄
;

1228 
Õ_£¨ch∑th
 = 
	`ˇŒoc
(
LP_MAX_SP
, (*));

1229 #ifde‡
WIN32


1230 
Õ_£¨ch∑th_Àn
 = 0;

1233 *
p
) {

1234 #ifde‡
_WIN32


1235 
cﬁ⁄
 = 
	`°rchr
(
p
,';');

1237 
cﬁ⁄
 = 
	`°rchr
(
p
, ':');

1239 if(
cﬁ⁄
) {

1240 *
√xt
;

1242 *
cﬁ⁄
 = 0;

1244 
√xt
 = 
cﬁ⁄
+1;

1245 
Õ_£¨ch∑th
[
Õ_£¨ch∑th_Àn
++] = 
	`°rdup
(
p
);

1247 
p
 = 
√xt
;

1250 
Õ_£¨ch∑th
[
Õ_£¨ch∑th_Àn
++] = 
	`°rdup
(
p
);

1256 #ifde‡
WIN32


1257 
	`‰ì
(
Õ_•
);

1258 
Õ_•
 = 
NULL
;

1263 
Õ_éts
 = 0;

1264 
Õ_éts_Àn
 = 0;

1266 
	`fÊush
(
°dout
);

1267 
°dout_ßve
 = 
	`dup
(1);

1268 #i‚de‡
WIN32


1269 
devnuŒ
 = 
	`›í
("/dev/nuŒ", 
O_RDONLY
);

1270 
	`dup2
(
devnuŒ
, 1);

1273 
	`lib∑øm∑r£
();

1275 
	`fÊush
(
°dout
);

1277 #i‚de‡
WIN32


1278 
	`dup2
(
°dout_ßve
, 1);

1279 
	`˛o£
(
devnuŒ
);

1280 
	`˛o£
(
°dout_ßve
);

1283 if(
éts
) {

1284 *
éts
 = 
Õ_éts
;

1286 if(
éts_Àn
) {

1287 *
éts_Àn
 = 
Õ_éts_Àn
;

1291 
	}
}

1295 
	#LP_STACK_MAX
 32

	)

1297 
	$Õ_lﬂd∑øms
(*
ô
, 
Õ_block
 *
b
, 
Õ_mod
 *
m
) {

1298 
c
;

1299 
√eded
 = 0;

1300 
∑øm_°ack
[
LP_STACK_MAX
];

1301 
°ack_±r
 = 0;

1303 *
∑ømvec
 = 
	`ˇŒoc
(
m
->
modv¨s_Àn
, ());

1309 *
tmp
 = 
	`°rdup
(
b
->
sour˚_fûe
);

1310 
Õ_cwd
 = 
	`°rdup
(
	`dú«me
(
tmp
));

1313 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

1314 
≤um
, 
dïs
;

1316 if(!
b
->
∑øms
[
c
]) ;

1318 
TOP
:

1319 
≤um
 = 
	`Õ_∑øm_«me
(
	`Õ_mod_«me
(
m
->
«me
), 
b
->
∑øms
[
c
]->name);

1323 if(
	`BIT_TEST
(
∑ømvec
, 
≤um
)) ;

1326 if(
°ack_±r
 > 0) {

1327 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

1328 if(
	`Õ_∑øm_«me
(
	`Õ_mod_«me
(
m
->
«me
), 
b
->
∑øms
[
c
]->«meË=
√eded
)

1329 
FOUND
;

1335 
FOUND
:

1337 
dïs
 = 
m
->
∑øm_dïs
[
≤um
](
∑ømvec
);

1338 if(
dïs
 > -1) {

1339 
	`ddbg_as£π
(
°ack_±r
 < 
LP_STACK_MAX
);

1340 
∑øm_°ack
[
°ack_±r
++] = 
c
;

1341 
√eded
 = 
dïs
;

1345 
	`PTYPE
(
b
->
∑øms
[
c
])) {

1346 
I
:

1347 ((
Õ_∑ømlﬂdî_öt
)
m
->
∑øm_lﬂdîs
[
≤um
])(
ô
, 
	`IVAL
(
b
->
∑øms
[
c
]));

1349 
D
:

1350 ((
Õ_∑ømlﬂdî_doubÀ
)
m
->
∑øm_lﬂdîs
[
≤um
])(
ô
, 
	`DVAL
(
b
->
∑øms
[
c
]));

1352 
S
:

1353 ((
Õ_∑ømlﬂdî_°rög
)
m
->
∑øm_lﬂdîs
[
≤um
])(
ô
, 
	`SVAL
(
b
->
∑øms
[
c
]));

1355 
LIST
:

1356 ((
Õ_∑ømlﬂdî_li°
)
m
->
∑øm_lﬂdîs
[
≤um
])(
ô
, 
	`LVAL
(
b
->
∑øms
[
c
]));

1359 
BLOCK
:

1361 ((
Õ_∑ømlﬂdî_block
)
m
->
∑øm_lﬂdîs
[
≤um
])(
ô
, 
	`BVAL
(
b
->
∑øms
[
c
]));

1366 
	`BIT_SET
(
∑ømvec
, 
≤um
);

1367 if(
°ack_±r
 > 0) {

1368 
c
 = 
∑øm_°ack
[--
°ack_±r
];

1369 
TOP
;

1373 
c
 = 0; c < 
m
->
modv¨s_Àn
; c++) {

1374 if(
m
->
modv¨s
[
c
].
ªq
 && !
	`BIT_TEST
(
∑ømvec
,c)) {

1375 
	`Ârötf
(
°dîr
, "***Éº‹: i¿%†•e¯-- missögÑequúedÖ¨amëî %s\n", 
m
->
«me
, m->
modv¨s
[
c
].name);

1380 
	`‰ì
(
∑ømvec
);

1383 
	}
}

1387 
	$Õ_£¨ch_∑th
(*
cwd
, *
«me
)

1389 *
ˇnd
 = 
	`ˇŒoc
(
LP_PATH_MAX
, ());

1390 #ifde‡
_WIN32


1391 
_°©
 
s
;

1393 
°©
 
s
;

1395 
i
;

1397 #i‚de‡
_WIN32


1398 if(
«me
[0] == '/')

1399 if(
	`°©
(
«me
, &
s
))

1400 
Áû
;

1402 
succ
;

1404 
	`¢¥ötf
(
ˇnd
, 
LP_PATH_MAX
, "%s/%s", 
cwd
, 
«me
);

1407 if(
«me
[0] == '\\')

1408 if(
	`°©
(
«me
, &
s
))

1409 
Áû
;

1411 
succ
;

1413 i‡(
	`°rcmp
(
cwd
, "") == 0)

1414 
cwd
 = ".";

1416 
	`¢¥ötf
(
ˇnd
, 
LP_PATH_MAX
, "%s\\%s", 
cwd
, 
«me
);

1420 *
£p
 = 
ˇnd
;

1421 *
£p
)

1423 i‡(*
£p
 == '/') *sep = '\\';

1424 
£p
++;

1429 if(!
	`°©
(
ˇnd
, &
s
))

1430 
succ
;

1432 
i
 = 0; i < 
Õ_£¨ch∑th_Àn
; i++) {

1433 
	`¢¥ötf
(
ˇnd
, 
LP_PATH_MAX
,

1434 "%s/%s", 
Õ_£¨ch∑th
[
i
], 
«me
);

1436 if(!
	`°©
(
ˇnd
, &
s
)) {

1437 
succ
;

1441 
Áû
:

1442 
	`‰ì
(
ˇnd
);

1445 
succ
:

1446  
ˇnd
;

1448 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/list/hash.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

4 
	~"li°.h
"

6 
	sèsk_t
 {

7 
li°_hód
 
	mli°
;

8 
hli°_node
 
	mhash
;

9 
	mnum
;

12 
	#HASH
 6

	)

13 
	#NUM
 100

	)

15 
èsk_t
 *
	$föd
 (
hli°_hód
 *
hód
, 
num
 ) {

16 
hli°_node
 *
node
;

17 
èsk_t
 *
t
;

19 
	`hli°_f‹_óch
–
node
 , 
hód
) {

20 
t
 = 
	`hli°_íåy
(
node
, 
èsk_t
, 
hash
);

21 i‡–
t
->
num
 ==Çum )

22  
t
;

25  
NULL
;

27 
	}
}

29 
	$maö
 () {

30 
hli°_hód
 
hash_èbÀ
[
HASH
];

31 
	`LIST_HEAD
(
li°
);

32 
èsk_t
 
èsk
[
NUM
], *
t
;

33 
li°_hód
 *
±r
;

34 
i
;

36  
i
 = 0; i < 
HASH
; i ++ ) {

37 
	`INIT_HLIST_HEAD
 ( &
hash_èbÀ
[
i
] );

40 
i
 = 0; i < 
NUM
; i ++ ) {

41 
èsk
[
i
].
num
 = i;

42 
	`li°_add
 ( &
èsk
[
i
].
li°
 , &list);

43 
	`hli°_add_hód
 (&
èsk
[
i
].
hash
, &
hash_èbÀ
[i%
HASH
] );

46 
	`li°_f‹_óch
–
±r
, &
li°
 ) {

47 
t
 = 
	`li°_íåy
 ( 
±r
, 
èsk_t
, 
li°
 );

48 
	`¥ötf
–" blknÿ%d \n", 
t
->
num
 );

53  
i
 = 0; i < 
NUM
; i ++ ) {

54 
èsk_t
 *
t
 = 
	`föd
 ( &
hash_èbÀ
[
i
%
HASH
], i + 100) ;

55 i‡–
t
 )

56 
	`¥ötf
 (" found = %d \n", 
t
->
num
);

58 
	`¥ötf
 ("ÇŸ found = %d \n", 
NULL
 );

62 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/list/list.h

1 
	~"pois⁄.h
"

3 #i‚de‡
_LINUX_LIST_H


4 
	#_LINUX_LIST_H


	)

7 
	sli°_hód
 {

8 
li°_hód
 *
	m√xt
, *
	m¥ev
;

11 
	shli°_hód
 {

12 
hli°_node
 *
	mfú°
;

15 
	shli°_node
 {

16 
hli°_node
 *
	m√xt
, **
	mµªv
;

19 
	#¥e„tch


	)

30 
	#LIST_HEAD_INIT
(
«me
Ë{ &“ame), &“ameË}

	)

32 
	#LIST_HEAD
(
«me
) \

33 
li°_hód
 
«me
 = 
	`LIST_HEAD_INIT
“ame)

	)

35 
ölöe
 
	$INIT_LIST_HEAD
(
li°_hód
 *
li°
)

37 
li°
->
√xt
 =Üist;

38 
li°
->
¥ev
 =Üist;

39 
	}
}

47 #i‚de‡
CONFIG_DEBUG_LIST


48 
ölöe
 
	$__li°_add
(
li°_hód
 *
√w
,

49 
li°_hód
 *
¥ev
,

50 
li°_hód
 *
√xt
)

52 
√xt
->
¥ev
 = 
√w
;

53 
√w
->
√xt
 =Çext;

54 
√w
->
¥ev
 =Örev;

55 
¥ev
->
√xt
 = 
√w
;

56 
	}
}

58 
__li°_add
(
li°_hód
 *
√w
,

59 
li°_hód
 *
¥ev
,

60 
li°_hód
 *
√xt
);

71 
ölöe
 
	$li°_add
(
li°_hód
 *
√w
, li°_hód *
hód
)

73 
	`__li°_add
(
√w
, 
hód
, hód->
√xt
);

74 
	}
}

85 
ölöe
 
	$li°_add_èû
(
li°_hód
 *
√w
, li°_hód *
hód
)

87 
	`__li°_add
(
√w
, 
hód
->
¥ev
, head);

88 
	}
}

97 
ölöe
 
	$__li°_dñ
(
li°_hód
 * 
¥ev
, li°_hód * 
√xt
)

99 
√xt
->
¥ev
 =Örev;

100 
¥ev
->
√xt
 =Çext;

101 
	}
}

109 #i‚de‡
CONFIG_DEBUG_LIST


110 
ölöe
 
	$__li°_dñ_íåy
(
li°_hód
 *
íåy
)

112 
	`__li°_dñ
(
íåy
->
¥ev
,É¡ry->
√xt
);

113 
	}
}

115 
ölöe
 
	$li°_dñ
(
li°_hód
 *
íåy
)

117 
	`__li°_dñ
(
íåy
->
¥ev
,É¡ry->
√xt
);

118 
íåy
->
√xt
 = 
LIST_POISON1
;

119 
íåy
->
¥ev
 = 
LIST_POISON2
;

120 
	}
}

122 
__li°_dñ_íåy
(
li°_hód
 *
íåy
);

123 
li°_dñ
(
li°_hód
 *
íåy
);

133 
ölöe
 
	$li°_ª∂a˚
(
li°_hód
 *
ﬁd
,

134 
li°_hód
 *
√w
)

136 
√w
->
√xt
 = 
ﬁd
->next;

137 
√w
->
√xt
->
¥ev
 =Çew;

138 
√w
->
¥ev
 = 
ﬁd
->prev;

139 
√w
->
¥ev
->
√xt
 =Çew;

140 
	}
}

142 
ölöe
 
	$li°_ª∂a˚_öô
(
li°_hód
 *
ﬁd
,

143 
li°_hód
 *
√w
)

145 
	`li°_ª∂a˚
(
ﬁd
, 
√w
);

146 
	`INIT_LIST_HEAD
(
ﬁd
);

147 
	}
}

153 
ölöe
 
	$li°_dñ_öô
(
li°_hód
 *
íåy
)

155 
	`__li°_dñ_íåy
(
íåy
);

156 
	`INIT_LIST_HEAD
(
íåy
);

157 
	}
}

164 
ölöe
 
	$li°_move
(
li°_hód
 *
li°
, li°_hód *
hód
)

166 
	`__li°_dñ_íåy
(
li°
);

167 
	`li°_add
(
li°
, 
hód
);

168 
	}
}

175 
ölöe
 
	$li°_move_èû
(
li°_hód
 *
li°
,

176 
li°_hód
 *
hód
)

178 
	`__li°_dñ_íåy
(
li°
);

179 
	`li°_add_èû
(
li°
, 
hód
);

180 
	}
}

187 
ölöe
 
	$li°_is_œ°
(c⁄° 
li°_hód
 *
li°
,

188 c⁄° 
li°_hód
 *
hód
)

190  
li°
->
√xt
 =
hód
;

191 
	}
}

197 
ölöe
 
	$li°_em±y
(c⁄° 
li°_hód
 *
hód
)

199  
hód
->
√xt
 == head;

200 
	}
}

215 
ölöe
 
	$li°_em±y_ˇªful
(c⁄° 
li°_hód
 *
hód
)

217 
li°_hód
 *
√xt
 = 
hód
->next;

218  (
√xt
 =
hód
Ë&& (√xà=hód->
¥ev
);

219 
	}
}

225 
ölöe
 
	$li°_rŸ©e_À·
(
li°_hód
 *
hód
)

227 
li°_hód
 *
fú°
;

229 i‡(!
	`li°_em±y
(
hód
)) {

230 
fú°
 = 
hód
->
√xt
;

231 
	`li°_move_èû
(
fú°
, 
hód
);

233 
	}
}

239 
ölöe
 
	$li°_is_söguœr
(c⁄° 
li°_hód
 *
hód
)

241  !
	`li°_em±y
(
hód
Ë&& (hód->
√xt
 =hód->
¥ev
);

242 
	}
}

244 
ölöe
 
	$__li°_cut_posôi⁄
(
li°_hód
 *
li°
,

245 
li°_hód
 *
hód
, li°_hód *
íåy
)

247 
li°_hód
 *
√w_fú°
 = 
íåy
->
√xt
;

248 
li°
->
√xt
 = 
hód
->next;

249 
li°
->
√xt
->
¥ev
 =Üist;

250 
li°
->
¥ev
 = 
íåy
;

251 
íåy
->
√xt
 = 
li°
;

252 
hód
->
√xt
 = 
√w_fú°
;

253 
√w_fú°
->
¥ev
 = 
hód
;

254 
	}
}

270 
ölöe
 
	$li°_cut_posôi⁄
(
li°_hód
 *
li°
,

271 
li°_hód
 *
hód
, li°_hód *
íåy
)

273 i‡(
	`li°_em±y
(
hód
))

275 i‡(
	`li°_is_söguœr
(
hód
) &&

276 (
hód
->
√xt
 !
íåy
 && head !=Éntry))

278 i‡(
íåy
 =
hód
)

279 
	`INIT_LIST_HEAD
(
li°
);

281 
	`__li°_cut_posôi⁄
(
li°
, 
hód
, 
íåy
);

282 
	}
}

284 
ölöe
 
	$__li°_•li˚
(c⁄° 
li°_hód
 *
li°
,

285 
li°_hód
 *
¥ev
,

286 
li°_hód
 *
√xt
)

288 
li°_hód
 *
fú°
 = 
li°
->
√xt
;

289 
li°_hód
 *
œ°
 = 
li°
->
¥ev
;

291 
fú°
->
¥ev
 =Örev;

292 
¥ev
->
√xt
 = 
fú°
;

294 
œ°
->
√xt
 =Çext;

295 
√xt
->
¥ev
 = 
œ°
;

296 
	}
}

303 
ölöe
 
	$li°_•li˚
(c⁄° 
li°_hód
 *
li°
,

304 
li°_hód
 *
hód
)

306 i‡(!
	`li°_em±y
(
li°
))

307 
	`__li°_•li˚
(
li°
, 
hód
, hód->
√xt
);

308 
	}
}

315 
ölöe
 
	$li°_•li˚_èû
(
li°_hód
 *
li°
,

316 
li°_hód
 *
hód
)

318 i‡(!
	`li°_em±y
(
li°
))

319 
	`__li°_•li˚
(
li°
, 
hód
->
¥ev
, head);

320 
	}
}

329 
ölöe
 
	$li°_•li˚_öô
(
li°_hód
 *
li°
,

330 
li°_hód
 *
hód
)

332 i‡(!
	`li°_em±y
(
li°
)) {

333 
	`__li°_•li˚
(
li°
, 
hód
, hód->
√xt
);

334 
	`INIT_LIST_HEAD
(
li°
);

336 
	}
}

346 
ölöe
 
	$li°_•li˚_èû_öô
(
li°_hód
 *
li°
,

347 
li°_hód
 *
hód
)

349 i‡(!
	`li°_em±y
(
li°
)) {

350 
	`__li°_•li˚
(
li°
, 
hód
->
¥ev
, head);

351 
	`INIT_LIST_HEAD
(
li°
);

353 
	}
}

354 
	#c⁄èöî_of
(
±r
, 
ty≥
, 
membî
) \

355 ((
ty≥
 *)((*)(
±r
)-()(&(—y≥ *)0)->
membî
)))

	)

363 
	#li°_íåy
(
±r
, 
ty≥
, 
membî
) \

364 
	`c⁄èöî_of
(
±r
, 
ty≥
, 
membî
)

	)

374 
	#li°_fú°_íåy
(
±r
, 
ty≥
, 
membî
) \

375 
	`li°_íåy
((
±r
)->
√xt
, 
ty≥
, 
membî
)

	)

383 
	#li°_f‹_óch
(
pos
, 
hód
) \

384 
pos
 = (
hód
)->
√xt
; 
	`¥e„tch
(pos->next),Öos != (head); \

385 
pos
 =Öos->
√xt
)

	)

387 
	#li°_f‹_óch
(
pos
, 
hód
) \

388 
pos
 = (
hód
)->
√xt
;Öos != (head); \

389 
pos
 =Öos->
√xt
)

	)

401 
	#__li°_f‹_óch
(
pos
, 
hód
) \

402 
pos
 = (
hód
)->
√xt
;Öo†!(hód);Öo†pos->√xt)

	)

409 
	#li°_f‹_óch_¥ev
(
pos
, 
hód
) \

410 
pos
 = (
hód
)->
¥ev
;Öos != (head); \

411 
pos
 =Öos->
¥ev
)

	)

420 
	#li°_f‹_óch_ß„
(
pos
, 
n
, 
hód
) \

421 
pos
 = (
hód
)->
√xt
, 
n
 =Öos->next;Öos != (head); \

422 
pos
 = 
n
,Ç =Öos->
√xt
)

	)

430 
	#li°_f‹_óch_¥ev_ß„
(
pos
, 
n
, 
hód
) \

431 
pos
 = (
hód
)->
¥ev
, 
n
 =Öos->prev; \

432 
	`¥e„tch
(
pos
->
¥ev
),Öo†!(
hód
); \

433 
pos
 = 
n
,Ç =Öos->
¥ev
)

	)

441 
	#li°_f‹_óch_íåy
(
pos
, 
hód
, 
membî
) \

442 
pos
 = 
	`li°_íåy
((
hód
)->
√xt
, 
	`ty≥of
(*pos), 
membî
); \

443 &
pos
->
membî
 !(
hód
); \

444 
pos
 = 
	`li°_íåy
’os->
membî
.
√xt
, 
	`ty≥of
(*pos), membî))

	)

452 
	#li°_f‹_óch_íåy_ªvî£
(
pos
, 
hód
, 
membî
) \

453 
pos
 = 
	`li°_íåy
((
hód
)->
¥ev
, 
	`ty≥of
(*pos), 
membî
); \

454 
	`¥e„tch
(
pos
->
membî
.
¥ev
), &pos->membî !(
hód
); \

455 
pos
 = 
	`li°_íåy
’os->
membî
.
¥ev
, 
	`ty≥of
(*pos), membî))

	)

465 
	#li°_¥ï¨e_íåy
(
pos
, 
hód
, 
membî
) \

466 ((
pos
Ë? : 
	`li°_íåy
(
hód
, 
	`ty≥of
(*pos), 
membî
))

	)

477 
	#li°_f‹_óch_íåy_c⁄töue
(
pos
, 
hód
, 
membî
) \

478 
pos
 = 
	`li°_íåy
’os->
membî
.
√xt
, 
	`ty≥of
(*pos), member); \

479 
	`¥e„tch
(
pos
->
membî
.
√xt
), &pos->membî !(
hód
); \

480 
pos
 = 
	`li°_íåy
’os->
membî
.
√xt
, 
	`ty≥of
(*pos), membî))

	)

491 
	#li°_f‹_óch_íåy_c⁄töue_ªvî£
(
pos
, 
hód
, 
membî
) \

492 
pos
 = 
	`li°_íåy
’os->
membî
.
¥ev
, 
	`ty≥of
(*pos), member); \

493 
	`¥e„tch
(
pos
->
membî
.
¥ev
), &pos->membî !(
hód
); \

494 
pos
 = 
	`li°_íåy
’os->
membî
.
¥ev
, 
	`ty≥of
(*pos), membî))

	)

504 
	#li°_f‹_óch_íåy_‰om
(
pos
, 
hód
, 
membî
) \

505 ; 
	`¥e„tch
(
pos
->
membî
.
√xt
), &pos->membî !(
hód
); \

506 
pos
 = 
	`li°_íåy
’os->
membî
.
√xt
, 
	`ty≥of
(*pos), membî))

	)

515 
	#li°_f‹_óch_íåy_ß„
(
pos
, 
n
, 
hód
, 
membî
) \

516 
pos
 = 
	`li°_íåy
((
hód
)->
√xt
, 
	`ty≥of
(*pos), 
membî
), \

517 
n
 = 
	`li°_íåy
(
pos
->
membî
.
√xt
, 
	`ty≥of
(*pos), member); \

518 &
pos
->
membî
 !(
hód
); \

519 
pos
 = 
n
,Ç = 
	`li°_íåy
“->
membî
.
√xt
, 
	`ty≥of
(*n), membî))

	)

531 
	#li°_f‹_óch_íåy_ß„_c⁄töue
(
pos
, 
n
, 
hód
, 
membî
) \

532 
pos
 = 
	`li°_íåy
’os->
membî
.
√xt
, 
	`ty≥of
(*pos), member), \

533 
n
 = 
	`li°_íåy
(
pos
->
membî
.
√xt
, 
	`ty≥of
(*pos), member); \

534 &
pos
->
membî
 !(
hód
); \

535 
pos
 = 
n
,Ç = 
	`li°_íåy
“->
membî
.
√xt
, 
	`ty≥of
(*n), membî))

	)

547 
	#li°_f‹_óch_íåy_ß„_‰om
(
pos
, 
n
, 
hód
, 
membî
) \

548 
n
 = 
	`li°_íåy
(
pos
->
membî
.
√xt
, 
	`ty≥of
(*pos), member); \

549 &
pos
->
membî
 !(
hód
); \

550 
pos
 = 
n
,Ç = 
	`li°_íåy
“->
membî
.
√xt
, 
	`ty≥of
(*n), membî))

	)

562 
	#li°_f‹_óch_íåy_ß„_ªvî£
(
pos
, 
n
, 
hód
, 
membî
) \

563 
pos
 = 
	`li°_íåy
((
hód
)->
¥ev
, 
	`ty≥of
(*pos), 
membî
), \

564 
n
 = 
	`li°_íåy
(
pos
->
membî
.
¥ev
, 
	`ty≥of
(*pos), member); \

565 &
pos
->
membî
 !(
hód
); \

566 
pos
 = 
n
,Ç = 
	`li°_íåy
“->
membî
.
¥ev
, 
	`ty≥of
(*n), membî))

	)

580 
	#li°_ß„_ª£t_√xt
(
pos
, 
n
, 
membî
) \

581 
n
 = 
	`li°_íåy
(
pos
->
membî
.
√xt
, 
	`ty≥of
(*pos), membî)

	)

590 
	#HLIST_HEAD_INIT
 { .
fú°
 = 
NULL
 }

	)

591 
	#HLIST_HEAD
(
«me
Ë
hli°_hód
Çamê{ .
fú°
 = 
NULL
 }

	)

592 
	#INIT_HLIST_HEAD
(
±r
Ë(’å)->
fú°
 = 
NULL
)

	)

593 
ölöe
 
	$INIT_HLIST_NODE
(
hli°_node
 *
h
)

595 
h
->
√xt
 = 
NULL
;

596 
h
->
µªv
 = 
NULL
;

597 
	}
}

599 
ölöe
 
	$hli°_unhashed
(c⁄° 
hli°_node
 *
h
)

601  !
h
->
µªv
;

602 
	}
}

604 
ölöe
 
	$hli°_em±y
(c⁄° 
hli°_hód
 *
h
)

606  !
h
->
fú°
;

607 
	}
}

609 
ölöe
 
	$__hli°_dñ
(
hli°_node
 *
n
)

611 
hli°_node
 *
√xt
 = 
n
->next;

612 
hli°_node
 **
µªv
 = 
n
->pprev;

613 *
µªv
 = 
√xt
;

614 i‡(
√xt
)

615 
√xt
->
µªv
 =Öprev;

616 
	}
}

618 
ölöe
 
	$hli°_dñ
(
hli°_node
 *
n
)

620 
	`__hli°_dñ
(
n
);

621 
n
->
√xt
 = 
LIST_POISON1
;

622 
n
->
µªv
 = 
LIST_POISON2
;

623 
	}
}

625 
ölöe
 
	$hli°_dñ_öô
(
hli°_node
 *
n
)

627 i‡(!
	`hli°_unhashed
(
n
)) {

628 
	`__hli°_dñ
(
n
);

629 
	`INIT_HLIST_NODE
(
n
);

631 
	}
}

633 
ölöe
 
	$hli°_add_hód
(
hli°_node
 *
n
, 
hli°_hód
 *
h
)

635 
hli°_node
 *
fú°
 = 
h
->first;

636 
n
->
√xt
 = 
fú°
;

637 i‡(
fú°
)

638 
fú°
->
µªv
 = &
n
->
√xt
;

639 
h
->
fú°
 = 
n
;

640 
n
->
µªv
 = &
h
->
fú°
;

641 
	}
}

644 
ölöe
 
	$hli°_add_bef‹e
(
hli°_node
 *
n
,

645 
hli°_node
 *
√xt
)

647 
n
->
µªv
 = 
√xt
->pprev;

648 
n
->
√xt
 =Çext;

649 
√xt
->
µªv
 = &
n
->next;

650 *(
n
->
µªv
) =Ç;

651 
	}
}

653 
ölöe
 
	$hli°_add_a·î
(
hli°_node
 *
n
,

654 
hli°_node
 *
√xt
)

656 
√xt
->√xà
n
->next;

657 
n
->
√xt
 =Çext;

658 
√xt
->
µªv
 = &
n
->next;

660 if(
√xt
->next)

661 
√xt
->√xt->
µªv
 = &next->next;

662 
	}
}

665 
ölöe
 
	$hli°_add_Áke
(
hli°_node
 *
n
)

667 
n
->
µªv
 = &n->
√xt
;

668 
	}
}

674 
ölöe
 
	$hli°_move_li°
(
hli°_hód
 *
ﬁd
,

675 
hli°_hód
 *
√w
)

677 
√w
->
fú°
 = 
ﬁd
->first;

678 i‡(
√w
->
fú°
)

679 
√w
->
fú°
->
µªv
 = &new->first;

680 
ﬁd
->
fú°
 = 
NULL
;

681 
	}
}

683 
	#hli°_íåy
(
±r
, 
ty≥
, 
membî
Ë
	`c⁄èöî_of
’å,ty≥,membî)

	)

685 
	#hli°_f‹_óch
(
pos
, 
hód
) \

686 
pos
 = (
hód
)->
fú°
;Öo†&& ({ 
	`¥e„tch
’os->
√xt
); 1; }); \

687 
pos
 =Öos->
√xt
)

	)

689 
	#hli°_f‹_óch_ß„
(
pos
, 
n
, 
hód
) \

690 
pos
 = (
hód
)->
fú°
;Öo†&& ({ 
n
 =Öos->
√xt
; 1; }); \

691 
pos
 = 
n
)

	)

700 
	#hli°_f‹_óch_íåy
(
ços
, 
pos
, 
hód
, 
membî
) \

701 
pos
 = (
hód
)->
fú°
; \

702 
pos
 && ({ 
	`¥e„tch
’os->
√xt
); 1;}) && \

703 ({ 
ços
 = 
	`hli°_íåy
(
pos
, 
	`ty≥of
(*ços), 
membî
); 1;}); \

704 
pos
 =Öos->
√xt
)

	)

712 
	#hli°_f‹_óch_íåy_c⁄töue
(
ços
, 
pos
, 
membî
) \

713 
pos
 = (pos)->
√xt
; \

714 
pos
 && ({ 
	`¥e„tch
’os->
√xt
); 1;}) && \

715 ({ 
ços
 = 
	`hli°_íåy
(
pos
, 
	`ty≥of
(*ços), 
membî
); 1;}); \

716 
pos
 =Öos->
√xt
)

	)

724 
	#hli°_f‹_óch_íåy_‰om
(
ços
, 
pos
, 
membî
) \

725 ; 
pos
 && ({ 
	`¥e„tch
’os->
√xt
); 1;}) && \

726 ({ 
ços
 = 
	`hli°_íåy
(
pos
, 
	`ty≥of
(*ços), 
membî
); 1;}); \

727 
pos
 =Öos->
√xt
)

	)

737 
	#hli°_f‹_óch_íåy_ß„
(
ços
, 
pos
, 
n
, 
hód
, 
membî
) \

738 
pos
 = (
hód
)->
fú°
; \

739 
pos
 && ({ 
n
 =Öos->
√xt
; 1; }) && \

740 ({ 
ços
 = 
	`hli°_íåy
(
pos
, 
	`ty≥of
(*ços), 
membî
); 1;}); \

741 
pos
 = 
n
)

	)

	@/Users/ysoh/disksim-4.0-fcl/list/list_sort.c

1 
	~<löux/kî√l.h
>

2 
	~<löux/moduÀ.h
>

3 
	~<löux/li°_s‹t.h
>

4 
	~<löux/¶ab.h
>

5 
	~<löux/li°.h
>

7 
	#MAX_LIST_LENGTH_BITS
 20

	)

14 
li°_hód
 *
mîge
(*
¥iv
,

15 (*
cmp
)(*
¥iv
, 
li°_hód
 *
a
,

16 
li°_hód
 *
b
),

17 
li°_hód
 *
a
, li°_hód *
b
)

19 
li°_hód
 
hód
, *
èû
 = &head;

21 
a
 && 
b
) {

23 i‡((*
cmp
)(
¥iv
, 
a
, 
b
) <= 0) {

24 
èû
->
√xt
 = 
a
;

25 
a
 =á->
√xt
;

27 
èû
->
√xt
 = 
b
;

28 
b
 = b->
√xt
;

30 
èû
 =Åaû->
√xt
;

32 
èû
->
√xt
 = 
a
?:
b
;

33  
hód
.
√xt
;

34 
	}
}

43 
mîge_™d_ª°‹e_back_löks
(*
¥iv
,

44 (*
cmp
)(*
¥iv
, 
li°_hód
 *
a
,

45 
li°_hód
 *
b
),

46 
li°_hód
 *
hód
,

47 
li°_hód
 *
a
, li°_hód *
b
)

49 
li°_hód
 *
èû
 = 
hód
;

51 
a
 && 
b
) {

53 i‡((*
cmp
)(
¥iv
, 
a
, 
b
) <= 0) {

54 
èû
->
√xt
 = 
a
;

55 
a
->
¥ev
 = 
èû
;

56 
a
 =á->
√xt
;

58 
èû
->
√xt
 = 
b
;

59 
b
->
¥ev
 = 
èû
;

60 
b
 = b->
√xt
;

62 
èû
 =Åaû->
√xt
;

64 
èû
->
√xt
 = 
a
 ? : 
b
;

73 (*
cmp
)(
¥iv
, 
èû
->
√xt
,Åail->next);

75 
èû
->
√xt
->
¥ev
 =Åail;

76 
èû
 =Åaû->
√xt
;

77 } 
èû
->
√xt
);

79 
èû
->
√xt
 = 
hód
;

80 
hód
->
¥ev
 = 
èû
;

81 
	}
}

97 
li°_s‹t
(*
¥iv
, 
li°_hód
 *
hód
,

98 (*
cmp
)(*
¥iv
, 
li°_hód
 *
a
,

99 
li°_hód
 *
b
))

101 
li°_hód
 *
∑π
[
MAX_LIST_LENGTH_BITS
+1];

103 
Àv
;

104 
max_Àv
 = 0;

105 
li°_hód
 *
li°
;

107 i‡(
	`li°_em±y
(
hód
))

110 
	`mem£t
(
∑π
, 0, (part));

112 
hód
->
¥ev
->
√xt
 = 
NULL
;

113 
li°
 = 
hód
->
√xt
;

115 
li°
) {

116 
li°_hód
 *
cur
 = 
li°
;

117 
li°
 =Üi°->
√xt
;

118 
cur
->
√xt
 = 
NULL
;

120 
Àv
 = 0; 
∑π
[lev];Üev++) {

121 
cur
 = 
	`mîge
(
¥iv
, 
cmp
, 
∑π
[
Àv
], cur);

122 
∑π
[
Àv
] = 
NULL
;

124 i‡(
Àv
 > 
max_Àv
) {

125 i‡(
	`u∆ikñy
(
Àv
 >
	`ARRAY_SIZE
(
∑π
)-1)) {

126 
	`¥ötk_⁄˚
(
KERN_DEBUG
 "listÖassedÅo"

129 
Àv
--;

131 
max_Àv
 = 
Àv
;

133 
∑π
[
Àv
] = 
cur
;

136 
Àv
 = 0;Üev < 
max_Àv
;Üev++)

137 i‡(
∑π
[
Àv
])

138 
li°
 = 
	`mîge
(
¥iv
, 
cmp
, 
∑π
[
Àv
],Üist);

140 
	`mîge_™d_ª°‹e_back_löks
(
¥iv
, 
cmp
, 
hód
, 
∑π
[
max_Àv
], 
li°
);

141 
	}
}

142 
EXPORT_SYMBOL
(
li°_s‹t
);

144 #ifde‡
CONFIG_TEST_LIST_SORT


146 
	~<löux/øndom.h
>

152 
	#TEST_LIST_LEN
 (512+128+2Ë

	)

154 
	#TEST_POISON1
 0xDEADBEEF

	)

155 
	#TEST_POISON2
 0xA324354C

	)

157 
	sdebug_ñ
 {

158 
	mpois⁄1
;

159 
li°_hód
 
	mli°
;

160 
	mpois⁄2
;

161 
	mvÆue
;

162 
	m£rül
;

166 
debug_ñ
 **
ñts
 
	g__öôd©a
;

168 
__öô
 
	$check
(
debug_ñ
 *
ña
, debug_ñ *
ñb
)

170 i‡(
ña
->
£rül
 >
TEST_LIST_LEN
) {

171 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror: incorrect serial %d\n",

172 
ña
->
£rül
);

173  -
EINVAL
;

175 i‡(
ñb
->
£rül
 >
TEST_LIST_LEN
) {

176 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror: incorrect serial %d\n",

177 
ñb
->
£rül
);

178  -
EINVAL
;

180 i‡(
ñts
[
ña
->
£rül
] !ñ®||É…s[
ñb
->serial] !=Élb) {

181 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror:ÖhantomÉlement\n");

182  -
EINVAL
;

184 i‡(
ña
->
pois⁄1
 !
TEST_POISON1
 ||Éœ->
pois⁄2
 !
TEST_POISON2
) {

185 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror: badÖoison: %#x/%#x\n",

186 
ña
->
pois⁄1
,Éœ->
pois⁄2
);

187  -
EINVAL
;

189 i‡(
ñb
->
pois⁄1
 !
TEST_POISON1
 ||Élb->
pois⁄2
 !
TEST_POISON2
) {

190 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror: badÖoison: %#x/%#x\n",

191 
ñb
->
pois⁄1
,Élb->
pois⁄2
);

192  -
EINVAL
;

195 
	}
}

197 
__öô
 
	$cmp
(*
¥iv
, 
li°_hód
 *
a
, li°_hód *
b
)

199 
debug_ñ
 *
ña
, *
ñb
;

201 
ña
 = 
	`c⁄èöî_of
(
a
, 
debug_ñ
, 
li°
);

202 
ñb
 = 
	`c⁄èöî_of
(
b
, 
debug_ñ
, 
li°
);

204 
	`check
(
ña
, 
ñb
);

205  
ña
->
vÆue
 - 
ñb
->value;

206 
	}
}

208 
__öô
 
	$li°_s‹t_ã°
()

210 
i
, 
cou¡
 = 1, 
îr
 = -
EINVAL
;

211 
debug_ñ
 *
ñ
;

212 
li°_hód
 *
cur
, *
tmp
;

213 
	`LIST_HEAD
(
hód
);

215 
	`¥ötk
(
KERN_DEBUG
 "list_sort_test: startÅestingÜist_sort()\n");

217 
ñts
 = 
	`kmÆloc
((*Ë* 
TEST_LIST_LEN
, 
GFP_KERNEL
);

218 i‡(!
ñts
) {

219 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror: cannotállocate "

221 
exô
;

224 
i
 = 0; i < 
TEST_LIST_LEN
; i++) {

225 
ñ
 = 
	`kmÆloc
((*ñ), 
GFP_KERNEL
);

226 i‡(!
ñ
) {

227 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror: cannot "

229 
exô
;

232 
ñ
->
vÆue
 = 
	`øndom32
(Ë% (
TEST_LIST_LEN
/3);

233 
ñ
->
£rül
 = 
i
;

234 
ñ
->
pois⁄1
 = 
TEST_POISON1
;

235 
ñ
->
pois⁄2
 = 
TEST_POISON2
;

236 
ñts
[
i
] = 
ñ
;

237 
	`li°_add_èû
(&
ñ
->
li°
, &
hód
);

240 
	`li°_s‹t
(
NULL
, &
hód
, 
cmp
);

242 
cur
 = 
hód
.
√xt
; cur->next != &head; cur = cur->next) {

243 
debug_ñ
 *
ñ1
;

244 
cmp_ªsu…
;

246 i‡(
cur
->
√xt
->
¥ev
 != cur) {

247 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror:Üist is "

249 
exô
;

252 
cmp_ªsu…
 = 
	`cmp
(
NULL
, 
cur
, cur->
√xt
);

253 i‡(
cmp_ªsu…
 > 0) {

254 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror:Üist isÇot "

256 
exô
;

259 
ñ
 = 
	`c⁄èöî_of
(
cur
, 
debug_ñ
, 
li°
);

260 
ñ1
 = 
	`c⁄èöî_of
(
cur
->
√xt
, 
debug_ñ
, 
li°
);

261 i‡(
cmp_ªsu…
 =0 && 
ñ
->
£rül
 >
ñ1
->serial) {

262 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror: order of "

264 
exô
;

267 i‡(
	`check
(
ñ
, 
ñ1
)) {

268 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror:Élement check "

270 
exô
;

272 
cou¡
++;

275 i‡(
cou¡
 !
TEST_LIST_LEN
) {

276 
	`¥ötk
(
KERN_ERR
 "list_sort_test:Érror: badÜistÜength %d",

277 
cou¡
);

278 
exô
;

281 
îr
 = 0;

282 
exô
:

283 
	`k‰ì
(
ñts
);

284 
	`li°_f‹_óch_ß„
(
cur
, 
tmp
, &
hód
) {

285 
	`li°_dñ
(
cur
);

286 
	`k‰ì
(
	`c⁄èöî_of
(
cur
, 
debug_ñ
, 
li°
));

288  
îr
;

289 
	}
}

290 
moduÀ_öô
(
li°_s‹t_ã°
);

	@/Users/ysoh/disksim-4.0-fcl/list/list_sort.h

1 #i‚de‡
_LINUX_LIST_SORT_H


2 
	#_LINUX_LIST_SORT_H


	)

4 
	~<löux/ty≥s.h
>

6 
	gli°_hód
;

8 
li°_s‹t
(*
¥iv
, 
li°_hód
 *
hód
,

9 (*
cmp
)(*
¥iv
, 
li°_hód
 *
a
,

10 
li°_hód
 *
b
));

	@/Users/ysoh/disksim-4.0-fcl/list/test_list.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

4 
	~"li°.h
"

7 
	skoﬁ_li°
{

8 
	mto
;

9 
li°_hód
 
	mli°
;

10 
	m‰om
;

13 
	$maö
(
¨gc
, **
¨gv
){

15 
koﬁ_li°
 *
tmp
;

16 
li°_hód
 *
pos
, *
q
;

17 
i
;

19 
koﬁ_li°
 
myli°
;

20 
	`INIT_LIST_HEAD
(&
myli°
.
li°
);

26 
i
=5; i!=0; --i){

27 
tmp
(
koﬁ_li°
 *)
	`mÆloc
((kool_list));

36 
	`¥ötf
("enterÅoánd from:");

37 
	`sˇnf
("%d %d", &
tmp
->
to
, &tmp->
‰om
);

40 
	`li°_add
(&(
tmp
->
li°
), &(
myli°
.list));

45 
	`¥ötf
("\n");

58 
	`¥ötf
("traversingÅheÜist usingÜist_for_each()\n");

59 
	`li°_f‹_óch
(
pos
, &
myli°
.
li°
){

67 
tmp

	`li°_íåy
(
pos
, 
koﬁ_li°
, 
li°
);

76 
	`¥ötf
("to%d from%d\n", 
tmp
->
to
,Åmp->
‰om
);

79 
	`¥ötf
("\n");

87 
	`¥ötf
("traversingÅheÜist usingÜist_for_each_entry()\n");

88 
	`li°_f‹_óch_íåy
(
tmp
, &
myli°
.
li°
,Üist)

89 
	`¥ötf
("to%d from%d\n", 
tmp
->
to
,Åmp->
‰om
);

90 
	`¥ötf
("\n");

98 
	`¥ötf
("deletingÅheÜist usingÜist_for_each_safe()\n");

99 
	`li°_f‹_óch_ß„
(
pos
, 
q
, &
myli°
.
li°
){

100 
tmp

	`li°_íåy
(
pos
, 
koﬁ_li°
, 
li°
);

101 
	`¥ötf
("‰ìög iãmÅo%d from%d\n", 
tmp
->
to
,Åmp->
‰om
);

102 
	`li°_dñ
(
pos
);

103 
	`‰ì
(
tmp
);

107 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/list/types.h

1 #i‚de‡
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty≥s.h
>

6 #i‚de‡
__ASSEMBLY__


7 #ifdef 
__KERNEL__


9 
	#DECLARE_BITMAP
(
«me
,
bôs
) \

10 
«me
[
	`BITS_TO_LONGS
(
bôs
)]

	)

12 #i‚de‡
__EXPORTED_HEADERS__


17 
	~<löux/posix_ty≥s.h
>

19 #ifde‡
__KERNEL__


21 
__u32
 
	t__kî√l_dev_t
;

23 
__kî√l_fd_£t
 
	tfd_£t
;

24 
__kî√l_dev_t
 
	tdev_t
;

25 
__kî√l_öo_t
 
	töo_t
;

26 
__kî√l_mode_t
 
	tmode_t
;

27 
__kî√l_∆ök_t
 
	t∆ök_t
;

28 
__kî√l_off_t
 
	toff_t
;

29 
__kî√l_pid_t
 
	tpid_t
;

30 
__kî√l_daddr_t
 
	tdaddr_t
;

31 
__kî√l_key_t
 
	tkey_t
;

32 
__kî√l_su£c⁄ds_t
 
	tsu£c⁄ds_t
;

33 
__kî√l_timî_t
 
	ttimî_t
;

34 
__kî√l_˛ockid_t
 
	t˛ockid_t
;

35 
__kî√l_mqd_t
 
	tmqd_t
;

37 
_Boﬁ
 
	tboﬁ
;

39 
__kî√l_uid32_t
 
	tuid_t
;

40 
__kî√l_gid32_t
 
	tgid_t
;

41 
__kî√l_uid16_t
 
	tuid16_t
;

42 
__kî√l_gid16_t
 
	tgid16_t
;

44 
	tuöçå_t
;

46 #ifde‡
CONFIG_UID16


48 
__kî√l_ﬁd_uid_t
 
	tﬁd_uid_t
;

49 
__kî√l_ﬁd_gid_t
 
	tﬁd_gid_t
;

52 #i‡
deföed
(
__GNUC__
)

53 
__kî√l_loff_t
 
	tloff_t
;

60 #i‚de‡
_SIZE_T


61 
	#_SIZE_T


	)

62 
__kî√l_size_t
 
	tsize_t
;

65 #i‚de‡
_SSIZE_T


66 
	#_SSIZE_T


	)

67 
__kî√l_ssize_t
 
	tssize_t
;

70 #i‚de‡
_PTRDIFF_T


71 
	#_PTRDIFF_T


	)

72 
__kî√l_±rdiff_t
 
	t±rdiff_t
;

75 #i‚de‡
_TIME_T


76 
	#_TIME_T


	)

77 
__kî√l_time_t
 
	ttime_t
;

80 #i‚de‡
_CLOCK_T


81 
	#_CLOCK_T


	)

82 
__kî√l_˛ock_t
 
	t˛ock_t
;

85 #i‚de‡
_CADDR_T


86 
	#_CADDR_T


	)

87 
__kî√l_ˇddr_t
 
	tˇddr_t
;

91 
	tu_ch¨
;

92 
	tu_sh‹t
;

93 
	tu_öt
;

94 
	tu_l⁄g
;

97 
	tunch¨
;

98 
	tush‹t
;

99 
	tuöt
;

100 
	tul⁄g
;

102 #i‚de‡
__BIT_TYPES_DEFINED__


103 
	#__BIT_TYPES_DEFINED__


	)

105 
__u8
 
	tu_öt8_t
;

106 
__s8
 
	töt8_t
;

107 
__u16
 
	tu_öt16_t
;

108 
__s16
 
	töt16_t
;

109 
__u32
 
	tu_öt32_t
;

110 
__s32
 
	töt32_t
;

114 
__u8
 
	tuöt8_t
;

115 
__u16
 
	tuöt16_t
;

116 
__u32
 
	tuöt32_t
;

118 #i‡
deföed
(
__GNUC__
)

119 
__u64
 
	tuöt64_t
;

120 
__u64
 
	tu_öt64_t
;

121 
__s64
 
	töt64_t
;

125 
	#Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

126 
	#Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

127 
	#Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

137 #ifde‡
CONFIG_LBDAF


138 
u64
 
	t£˘‹_t
;

139 
u64
 
	tblk˙t_t
;

141 
	t£˘‹_t
;

142 
	tblk˙t_t
;

149 #i‚de‡
pgoff_t


150 
	#pgoff_t
 

	)

160 #ifde‡
__CHECKER__


161 
	#__bôwi£__
 
	`__©åibuã__
((
bôwi£
))

	)

163 
	#__bôwi£__


	)

165 #ifde‡
__CHECK_ENDIAN__


166 
	#__bôwi£
 
__bôwi£__


	)

168 
	#__bôwi£


	)

171 
__u16
 
	t__bôwi£
 
	t__À16
;

172 
__u16
 
	t__bôwi£
 
	t__be16
;

173 
__u32
 
	t__bôwi£
 
	t__À32
;

174 
__u32
 
	t__bôwi£
 
	t__be32
;

175 
__u64
 
	t__bôwi£
 
	t__À64
;

176 
__u64
 
	t__bôwi£
 
	t__be64
;

178 
__u16
 
	t__bôwi£
 
	t__sum16
;

179 
__u32
 
	t__bôwi£
 
	t__wsum
;

190 
	#__Æig√d_u64
 
__u64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

191 
	#__Æig√d_be64
 
__be64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

192 
	#__Æig√d_À64
 
__À64
 
	`__©åibuã__
((
	`Æig√d
(8)))

	)

194 #ifde‡
__KERNEL__


195 
	t__bôwi£__
 
	tgÂ_t
;

196 
	t__bôwi£__
 
	tfmode_t
;

198 #ifde‡
CONFIG_PHYS_ADDR_T_64BIT


199 
u64
 
	tphys_addr_t
;

201 
u32
 
	tphys_addr_t
;

204 
phys_addr_t
 
	tªsour˚_size_t
;

207 
	mcou¡î
;

208 } 
	t©omic_t
;

210 #ifde‡
CONFIG_64BIT


212 
	mcou¡î
;

213 } 
	t©omic64_t
;

216 
	sli°_hód
 {

217 
li°_hód
 *
	m√xt
, *
	m¥ev
;

220 
	shli°_hód
 {

221 
hli°_node
 *
	mfú°
;

224 
	shli°_node
 {

225 
hli°_node
 *
	m√xt
, **
	mµªv
;

228 
	su°©
 {

229 
__kî√l_daddr_t
 
	mf_t‰ì
;

230 
__kî√l_öo_t
 
	mf_töode
;

231 
	mf_‚ame
[6];

232 
	mf_Âack
[6];

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_buffer.h

1 #i‚de‡
__MEMS_BUFFER_H_


2 
	#__MEMS_BUFFER_H_


	)

4 
	~"mems_globÆ.h
"

7 
move_£gmít_to_hód
 (
mems_£gmít
 *
tmp£g
,

8 
mems_t
 *
dev
);

11 
mems_buf„r_check
 (
fú°block
,

12 
œ°block
,

13 
mems_t
 *
dev
);

16 
mems_buf„r_ö£π
 (
fú°block
,

17 
œ°block
,

18 
mems_t
 *
dev
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_disksim.h

39 #i‚de‡
MEMS_DISKSIM_H


40 
	#MEMS_DISKSIM_H


	)

42 
mems_evít_¨rive
 (
i‹eq_evít
 *
cuº
);

43 
mems_bus_dñay_com∂ëe
 (
devno
, 
i‹eq_evít
 *
cuº
, 
£¡bu¢o
);

44 
mems_bus_ow√rshù_gø¡
 (
devno
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
);

46 
mems_˛ón°©s
 ();

47 
mems_gë_ac˘ime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
maxtime
);

48 
mems_gë_avg_£˘≥rcyl
 (
devno
);

49 
mems_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
);

50 
mems_gë_bu¢o
 (
i‹eq_evít
 *
cuº
);

51 
mems_gë_dïth
 (
devno
);

52 
mems_gë_öbus
 (
devno
);

53 
mems_gë_m≠pög
 (
m≠ty≥
, 
devno
, 
blkno
, *
cyÕå
, *
surÁ˚±r
, *
blk±r
);

54 
mems_gë_maxout°™dög
 (
devno
);

55 
mems_gë_numbî_of_blocks
 (
devno
);

56 
mems_gë_numcyls
 (
devno
);

57 
mems_gë_£ektime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
);

58 
mems_gë_£rvtime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
);

59 
mems_gë_¶Ÿno
 (
devno
);

60 
mems_öôülize
 ();

61 
mems_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

62 
mems_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
);

63 
mems_¥öt°©s
 ();

64 
mems_ªad_•ecs
 (
FILE
 *
∑rfûe
, 
devno
, 
c›õs
);

65 
mems_ªad_t›röts
 (
FILE
 *
∑rfûe
);

66 
mems_ª£t°©s
 ();

67 
mems_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
);

68 
mems_gë_di°™˚
 (
devno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
);

78 
devi˚_hódî
 
mems_hdr_öôülizî
;

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_global.h

33 #i‚de‡
_MEMS_GLOBAL_H_


34 
	#_MEMS_GLOBAL_H_


	)

36 
	~"disksim_globÆ.h
"

37 
	~"disksim_iosim.h
"

38 
	~"disksim_°©.h
"

40 
	#MEMS_MAXSLEDS
 9

	)

41 
	#MEMS_SEEKCACHE
 2

	)

43 
	#gëmems
(
d
Ë(
disksim
->
memsöfo
->
devi˚s
[d])

	)

45 
	#MEMS_SLED_INACTIVE
 0

	)

46 
	#MEMS_SLED_IDLE
 1

	)

47 
	#MEMS_SLED_ACTIVE
 2

	)

49 
	#MEMS_SEEK_PIECEWISE
 0

	)

50 
	#MEMS_SEEK_HONG
 1

	)

52 
	sco‹d
 {

53 
	mx_pos
;

54 
	my_pos
;

55 
	my_vñ
;

56 } 
	tco‹d_t
;

58 
	stù£˘‹_co‹d_£t
 {

59 
co‹d_t
 
	m£rvo_°¨t
;

60 
co‹d_t
 
	mtù£˘‹_°¨t
;

61 
co‹d_t
 
	mtù£˘‹_íd
;

62 } 
	ttù£˘‹_co‹d_£t_t
;

64 
	stù£t
 {

65 
	mtù_°¨t
;

66 
	mtù_íd
;

67 
	mnum_tùs
;

68 } 
	ttù£t_t
;

72 
	smems_¥e„tch_öfo
 {

73 
	mfú°block
;

74 
	mœ°block
;

76 
	mcom∂ëed_block
;

77 
	m√xt_block_°¨t
;

78 
	m√xt_block_íd
;

83 
	smems_£ekˇche
 {

84 
	mtime
;

85 
co‹d_t
 
	mbegö
;

86 
co‹d_t
 
	míd
;

87 
	mx_£ek_time
;

88 
	my_£ek_time
;

89 
	mtu∫¨ound_time
;

90 
	mtu∫¨ound_numbî
;

94 
	smems_£gmít
 {

95 
	mtime
;

96 
mems_£gmít
 *
	m√xt
;

97 
mems_£gmít
 *
	m¥ev
;

98 
	m°¨tblkno
;

99 
	mídblkno
;

103 
	smems_°©
 {

104 
°©gí
 
	mªque°_íîgy_uj
;

105 
	mtŸÆ_íîgy_j
;

106 
	m£rvicög_íîgy_j
;

107 
	m°¨tup_íîgy_j
;

108 
	midÀ_íîgy_j
;

109 
	möa˘ive_íîgy_j
;

111 
°©gí
 
	m£ek_time
;

112 
°©gí
 
	mx_£ek_time
;

113 
°©gí
 
	my_£ek_time
;

115 
	mnum_öôül_tu∫¨ounds
;

117 
°©gí
 
	mtu∫¨ound_time
;

118 
°©gí
 
	mtu∫¨ound_numbî
;

120 
	mnum_°ªam_tu∫¨ounds
;

122 
°©gí
 
	m°ªam_tu∫¨ound_time
;

123 
°©gí
 
	m°ªam_tu∫¨ound_numbî
;

125 
°©gí
 
	msubåack_ac˚s£s
;

126 
°©gí
 
	mtùs_≥r_ac˚ss
;

128 
	mnum_•öups
;

129 
	mnum_•ödowns
;

130 
°©gí
 
	möa˘ive_time
;

132 
	mnum_buf„r_ac˚s£s
;

133 
	mnum_buf„r_hôs
;

135 
°©gí
 
	m¥e„tched_blocks
;

136 
°©gí
 
	mb©ch_ª•⁄£_time
;

142 
mems
 *
	mdev
;

144 
	ma˘ive
;

145 
	mnumblocks
;

147 
mems_°©
 
	m°©
;

149 
ioq
 *
	mqueue
;

150 
i‹eq_evít
 *
	ma˘ive_ªque°
;

151 
mems_¥e„tch_öfo
 *
	m¥e„tch_öfo
;

152 
	m¥e„tch_dïth
;

154 
	mœ°ªq_com±ime
;

155 
	möa˘ive_dñay_ms
;

156 
	m°¨tup_time_ms
;

157 
	mœ°ªq_lbn
;

159 
co‹d_t
 
	mpos
;

160 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t
;

161 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_up
;

162 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_dn
;

163 
tù£t
 
	mtù£t
;

165 
	mœyout_pﬁicy
;

166 
	mx_Àngth_nm
;

167 
	my_Àngth_nm
;

169 
	mbô_Àngth_nm
;

170 
	mtù_£˘‹_Àngth_bôs
;

171 
	m£rvo_bur°_Àngth_bôs
;

172 
	mtù_£˘‹s_≥r_lbn
;

174 
	mtùs_ußbÀ
;

175 
	mtùs_simu…™eous
;

176 
	mbidúe˘i⁄Æ_ac˚ss
;

177 
	mx_ac˚l_nm_s2
;

178 
	my_ac˚l_nm_s2
;

180 
	my_ac˚ss_•ìd_bô_s
;

181 
	m¶ed_ªs⁄™t_‰eq_hz
;

182 
	mnum_time_c⁄°™ts
;

183 
	m•rög_Á˘‹
;

188 
mems_£ekˇche
 
	m£ekˇche
[
MEMS_SEEKCACHE
];

189 
	m£ekˇche_√xt
;

191 
	ma˘ive_powî_mw
;

192 
	möa˘ive_powî_mw
;

193 
	mtù_powî_mw
;

194 } 
	tmems_¶ed_t
;

197 
	smems
 {

198 
devi˚_hódî
 
	mhdr
;

199 
	mdevno
;

200 
	möôed
;

202 
mems_°©
 
	m°©
;

204 
	movîhód
;

205 
	mblkå™°ime
;

206 
	m¥öt°©s
;

207 
	mmaxqÀn
;

208 
	mnumblocks
;

210 
	mdïth
[
MAXINBUSES
];

211 
	möbu£s
[
MAXINBUSES
];

212 
	m¶Ÿno
[
MAXINBUSES
];

213 
	mnumöbu£s
;

215 
	mbusow√d
;

216 
i‹eq_evít
 *
	mbuswaô
;

217 
ioq
 *
	mqueue
;

218 
i‹eq_evít
 *
	md©ax„r_ªq
;

219 
i‹eq_evít
 *
	md©ax„r_queue
;

221 
mems_¶ed_t
 *
	m¶ed
;

222 
	mnum_¶eds
;

224 
	mnum£gs
;

225 
	m£gsize
;

226 
mems_£gmít
 *
	m£gli°
;

228 
	m£ek_fun˘i⁄
;

230 
	m¥ecompuã_£ek_cou¡
;

231 *
	m¥ecompuã_£ek_di°™˚s
;

232 *
	m¥ecompuã_x_£ek_times
;

233 *
	m¥ecompuã_y_£ek_times
;

235 } 
	tmems_t
;

238 
	smems_öfo
 {

239 
mems_t
 **
	mdevi˚s
;

240 
	mnumdevi˚s
;

241 
	mdevi˚s_Àn
;

244 
	smems_x
 {

245 
	mfú°block
;

246 
	mœ°block
;

248 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_up
;

249 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_dn
;

250 
tù£t_t
 
	mtù£t
;

251 
	mfú°block_cylödî
, 
	mfú°block_surÁ˚
, 
	mfú°block_block
;

253 
tù£˘‹_co‹d_£t_t
 
	mœ°block_up_co‹d_£t
;

254 
tù£˘‹_co‹d_£t_t
 
	mœ°block_dn_co‹d_£t
;

255 
tù£t_t
 
	mœ°block_tù£t
;

256 
	mœ°block_cylödî
, 
	mœ°block_surÁ˚
, 
	mœ°block_block
;

258 
	mcom∂ëed_block_medü
;

259 
	mcom∂ëed_block_bus
;

260 
	m√xt_block_°¨t
;

261 
	m√xt_block_íd
;

263 
	mbus_d⁄e
;

264 
	mmedü_d⁄e
;

266 
mems_x
 *
	m√xt
;

267 
mems_x
 *
	m¥ev
;

268 
i‹eq_evít
 *
	mªque°
;

269 } 
	tmems_exã¡_t
;

272 
	mfú°block
;

273 
	mœ°block
;

275 
	mb©ch_¨rivÆ_time
;

277 
mems_exã¡_t
 *
	mexã¡s
;

278 
	mnum_exã¡s
;

280 
mems_exã¡_t
 *
	mbus_exã¡
;

282 
	mbus_≥ndög
;

283 
	mbus_d⁄e
;

284 
	mmedü_d⁄e
;

286 
	mcom∂ëed_block_medü
;

287 
	mcom∂ëed_block_bus
;

288 
	m√xt_block_°¨t
;

289 
	m√xt_block_íd
;

292 
	mªque°_íîgy_uj
;

293 
	mfú°£ek
;

294 
	msubåack_ac˚ss_num
;

295 
	msubåack_ac˚ss_tùs
;

296 } 
	tmems_ªqöfo_t
;

298 
mems
* 
memsmodñ_mems_lﬂd∑øms
(
Õ_block
* 
b
, * 
num±r
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_internals.h

33 #i‚de‡
_MEMS_INTERNALS_H_


34 
	#_MEMS_INTERNALS_H_


	)

36 
	~"mems_globÆ.h
"

40 
	smems_öã∫Æ_°©i°ics
 {

41 
	mi
;

42 } 
	tmems_öã∫Æ_°©i°ics_t
;

46 
	#X_OFFSET
(
_X_
Ë(()((_X_Ë- (
x_Àngth_nm
 / 2.0)))

	)

47 
	#Y_OFFSET
(
_Y_
Ë(()((_Y_Ë- (
y_Àngth_nm
 / 2.0)))

	)

49 
	#_X_SEEK_
 0

	)

50 
	#_Y_SEEK_
 1

	)

68 
mems_equÆ_co‹ds
(
co‹d_t
 *
⁄e
, co‹d_à*
two
);

83 
mems_equÆ_co‹d_£ts
(
tù£˘‹_co‹d_£t_t
 *
⁄e
,Åù£˘‹_co‹d_£t_à*
two
);

99 
mems_co‹d_t_c›y
(
co‹d_t
 *
sour˚
, co‹d_à*
de°
);

115 
mems_tù£˘‹_co‹d_£t_t_c›y
 (
tù£˘‹_co‹d_£t_t
 *
sour˚
,

116 
tù£˘‹_co‹d_£t_t
 *
de°
);

131 
co‹d_t
 *
mems_gë_cuºít_posôi⁄
(
mems_¶ed_t
 *
¶ed
);

154 
mems_£ek_time
(
mems_¶ed_t
 *
¶ed
,

155 
co‹d_t
 *
begö
, co‹d_à*
íd
,

156 *
ªtu∫_x_£ek_time
, *
ªtu∫_y_£ek_time
,

157 *
ªtu∫_tu∫¨ound_time
, *
ªtu∫_tu∫¨ound_numbî
);

165 
mems_£ek_time_£ekˇche
 (
mems_¶ed_t
 *
¶ed
,

166 
co‹d_t
 *
begö
,

167 
co‹d_t
 *
íd
,

168 *
ªtu∫_x_£ek_time
,

169 *
ªtu∫_y_£ek_time
,

170 *
ªtu∫_tu∫¨ound_time
,

171 *
ªtu∫_tu∫¨ound_numbî
);

175 
mems_föd_¥ecompuãd_£ek_time
(
mems_¶ed_t
 *
¶ed
,

176 
°¨t_off£t_nm
, 
íd_off£t_nm
,

177 
dúe˘i⁄
);

193 
mems_medü_ac˚ss_time
(
mems_¶ed_t
 *
¶ed
,

194 
co‹d_t
 *
°¨t
, co‹d_à*
íd
);

196 
föd_tu∫¨ound_time
(
off£t_nm
, 
vñocôy_nm_s
, 
ba£_ac˚l_nm_s_s
,

197 
•rög_Á˘‹
, 
Àngth_nm
);

213 
mems_commô_move
(
mems_¶ed_t
 *
¶ed
,

214 
co‹d_t
 *
pos
);

216 
mems_¥ecompuã_£ek_curve
(
mems_t
 *
dev
);

218 
mems_föd_¥ecompuãd_£ek_time
(
mems_¶ed_t
 *
¶ed
,

219 
°¨t_off£t_nm
,

220 
íd_off£t_nm
,

221 
dúe˘i⁄
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_mapping.h

33 #i‚de‡
_MEMS_MAPPING_H_


34 
	#_MEMS_MAPPING_H_


	)

36 
	~"mems_globÆ.h
"

37 
	~"mems_öã∫Æs.h
"

41 
	tlbn_t
;

52 
	#MEMS_LAYOUT_SIMPLE
 6

	)

53 
	#MEMS_LAYOUT_STREAMING
 7

	)

79 
mems_lbn_to_posôi⁄
(
lbn_t
 
lbn
,

80 
mems_¶ed_t
 *
¶ed
,

81 
tù£˘‹_co‹d_£t_t
 *
up
,

82 
tù£˘‹_co‹d_£t_t
 *
down
,

83 
tù£t_t
 *
tù£t
,

84 *
cyÕå
, *
surÁ˚±r
, *
blk±r
);

101 
mems_¶ed_t
 *
mems_lbn_to_¶ed
(
mems_t
 *
dev
, 
lbn_t
 
lbn
);

117 
mems_check_numblocks
(
mems_t
 *
dev
);

131 
mems_˚¡îmo°_lbn
 (
mems_¶ed_t
 * 
¶ed
);

145 
mems_gë_numbî_of_cylödîs
 (
mems_t
 *
dev
);

159 
mems_gë_blocks_≥r_cylödî
 (
mems_¶ed_t
 *
¶ed
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_piecewise_seek.h

33 #i‚de‡
_MEMS_PIECEWISE_SEEK_H_


34 
	#_MEMS_PIECEWISE_SEEK_H_


	)

36 
	#_VERBOSE_
 0

	)

38 
	#NUM_CHUNKS
 8

39 
	#SWITCH_POINT
 (2 * 
NUM_CHUNKS
 / 2)

40 

	)

41 
	#MEMS_SWITCH_ITERATIONS
 9

42 
	#MEMS_SHIFT_PERCENTAGE
 0.05

43 

	)

44 
	#INWARD
 1

	)

45 
	#OUTWARD
 2

	)

47 
	#OVERALL_POSITIVE
 1

	)

48 
	#OVERALL_NEGATIVE
 2

	)

51 
föd_di°_nm
(
°¨t_off£t
, 
íd_off£t
);

54 
föd_£ek_time_põ˚wi£
(
°¨t_off£t_nm
, 
íd_off£t_nm
,

55 
•rög_Á˘‹
, 
ac˚Àøti⁄_nm_s_s
,

56 
Àngth_nm
, 
vñocôy_nm_s
);

58 
föd_di°_nm
(
°¨t_off£t
, 
íd_off£t
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/modules/memsmodel_mems_param.h

2 #i‚de‡
_MEMSMODEL_MEMS_PARAM_H


3 
	#_MEMSMODEL_MEMS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
mems
 *
memsmodñ_mems_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
MEMSMODEL_MEMS_SCHEDULER
,

16 
MEMSMODEL_MEMS_POINTS_IN_PRECOMPUTED_SEEK_CURVE
,

17 
MEMSMODEL_MEMS_SEEK_FUNCTION
,

18 
MEMSMODEL_MEMS_MAX_QUEUE_LENGTH
,

19 
MEMSMODEL_MEMS_BULK_SECTOR_TRANSFER_TIME
,

20 
MEMSMODEL_MEMS_SEGMENT_SIZE_
,

21 
MEMSMODEL_MEMS_NUMBER_OF_BUFFER_SEGMENTS
,

22 
MEMSMODEL_MEMS_PRINT_STATS
,

23 
MEMSMODEL_MEMS_COMMAND_OVERHEAD
,

24 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
,

25 
MEMSMODEL_MEMS_LAYOUT_POLICY
,

26 
MEMSMODEL_MEMS_SLED_MOVEMENT_X
,

27 
MEMSMODEL_MEMS_SLED_MOVEMENT_Y
,

28 
MEMSMODEL_MEMS_BIT_CELL_LENGTH
,

29 
MEMSMODEL_MEMS_TIP_SECTOR_LENGTH
,

30 
MEMSMODEL_MEMS_SERVO_BURST_LENGTH
,

31 
MEMSMODEL_MEMS_TIP_SECTORS_PER_LBN
,

32 
MEMSMODEL_MEMS_NUMBER_OF_USABLE_TIPS
,

33 
MEMSMODEL_MEMS_SIMULTANEOUSLY_ACTIVE_TIPS
,

34 
MEMSMODEL_MEMS_BIDIRECTIONAL_ACCESS
,

35 
MEMSMODEL_MEMS_SLED_ACCELERATION_X
,

36 
MEMSMODEL_MEMS_SLED_ACCELERATION_Y
,

37 
MEMSMODEL_MEMS_SLED_ACCESS_SPEED
,

38 
MEMSMODEL_MEMS_SLED_RESONANT_FREQUENCY
,

39 
MEMSMODEL_MEMS_SETTLING_TIME_CONSTANTS
,

40 
MEMSMODEL_MEMS_SPRING_CONSTANT_FACTOR
,

41 
MEMSMODEL_MEMS_PREFETCH_DEPTH
,

42 
MEMSMODEL_MEMS_TIME_BEFORE_SLED_INACTIVE
,

43 
MEMSMODEL_MEMS_STARTUP_DELAY
,

44 
MEMSMODEL_MEMS_SLED_ACTIVE_POWER
,

45 
MEMSMODEL_MEMS_SLED_INACTIVE_POWER
,

46 
MEMSMODEL_MEMS_TIP_ACCESS_POWER


47 } 
	tmemsmodñ_mems_∑øm_t
;

49 
	#MEMSMODEL_MEMS_MAX_PARAM
 
MEMSMODEL_MEMS_TIP_ACCESS_POWER


	)

50 * 
MEMSMODEL_MEMS_lﬂdîs
[];

51 
Õ_∑ømdï_t
 
MEMSMODEL_MEMS_dïs
[];

54 
Õ_v¨•ec
 
	gmemsmodñ_mems_∑øms
 [] = {

55 {"ScheduÀr", 
BLOCK
, 1 },

56 {"Poöt†öÖªcompuãd sìk curve", 
I
, 1 },

57 {"Sìk fun˘i⁄", 
I
, 1 },

58 {"Max queuêÀngth", 
I
, 1 },

59 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

60 {"Segmíàsizê(ö blks)", 
I
, 1 },

61 {"Numbî o‡buf„∏£gmíts", 
I
, 1 },

62 {"Pröà°©s", 
I
, 1 },

63 {"Comm™d ovîhód", 
D
, 1 },

64 {"Numbî o‡¶eds", 
I
, 1 },

65 {"Layouàpﬁicy", 
I
, 1 },

66 {"SÀd movemíàX", 
I
, 1 },

67 {"SÀd movemíàY", 
I
, 1 },

68 {"Bô cñ»Àngth", 
I
, 1 },

69 {"Tù se˘‹Üígth", 
I
, 1 },

70 {"Sîvÿbur°Üígth", 
I
, 1 },

71 {"Tù se˘‹†≥∏lbn", 
I
, 1 },

72 {"Numbî o‡ußbÀÅùs", 
I
, 1 },

73 {"Simu…™eou¶yá˘ivêtùs", 
I
, 1 },

74 {"Bidúe˘i⁄Æác˚ss", 
I
, 1 },

75 {"SÀdác˚Àøti⁄ X", 
D
, 1 },

76 {"SÀdác˚Àøti⁄ Y", 
D
, 1 },

77 {"SÀdác˚s†•ìd", 
I
, 1 },

78 {"SÀdÑes⁄™à‰equícy", 
I
, 1 },

79 {"SëéögÅimêc⁄°™ts", 
D
, 1 },

80 {"S¥ög c⁄°™àÁ˘‹", 
D
, 1 },

81 {"Pª„tch dïth", 
I
, 1 },

82 {"Timêbef‹ê¶ed i«˘ive", 
D
, 1 },

83 {"Sèπu∞dñay", 
D
, 1 },

84 {"SÀdá˘ivêpowî", 
D
, 1 },

85 {"SÀd i«˘ivêpowî", 
D
, 1 },

86 {"Tùác˚s†powî", 
D
, 1 },

89 
	#MEMSMODEL_MEMS_MAX
 32

	)

90 
Õ_mod
 
	gmemsmodñ_mems_mod
 = { "memsmodñ_mems", 
memsmodñ_mems_∑øms
, 
MEMSMODEL_MEMS_MAX
, (
Õ_modlﬂdî_t
)
memsmodñ_mems_lﬂd∑øms
, 0, 0, 
MEMSMODEL_MEMS_lﬂdîs
, 
MEMSMODEL_MEMS_dïs
 };

93 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/modules/modules.h

2 #i‚de‡
_MEMSMODEL_MODULES_H


3 
	#_MEMSMODEL_MODULES_H


	)

6 
	~"memsmodñ_mems_∑øm.h
"

9 
Õ_mod
 *
	gmemsmodñ_mods
[] = {

10 &
memsmodñ_mems_mod


14 
	mMEMSMODEL_MOD_MEMS


15 } 
	tmemsmodñ_mod_t
;

17 
	#MEMSMODEL_MAX_MODULE
 0

	)

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_buffer.c

1 
	~"mems_globÆ.h
"

2 
	~"mems_buf„r.h
"

12 
	$move_£gmít_to_hód
 (
mems_£gmít
 *
tmp£g
,

13 
mems_t
 *
dev
)

15 i‡((
dev
->
num£gs
 > 1Ë&& (
tmp£g
 !dev->
£gli°
))

17 
tmp£g
->
¥ev
->
√xt
 =Åmpseg->next;

18 i‡(
tmp£g
->
√xt
)

20 
tmp£g
->
√xt
->
¥ev
 =Åmpseg->prev;

23 
tmp£g
->
√xt
 = 
dev
->
£gli°
;

24 
dev
->
£gli°
 = 
tmp£g
;

25 
tmp£g
->
√xt
->
¥ev
 =Åmpseg;

26 
tmp£g
->
¥ev
 = 
NULL
;

28 
	}
}

32 
	$mems_buf„r_check
 (
fú°block
,

33 
œ°block
,

34 
mems_t
 *
dev
)

36 
mems_£gmít
 *
£g
;

37 
blk
 = 
fú°block
;

39 i‡(!
dev
->
num£gs
)  0;

41 
dev
->
°©
.
num_buf„r_ac˚s£s
++;

49 
£g
 = 
dev
->
£gli°
;

50 
£g
)

52 i‡((
blk
 >
£g
->
°¨tblkno
 && blk < seg->
ídblkno
))

54 
blk
 = 
£g
->
ídblkno
;

55 
	`move_£gmít_to_hód
(
£g
, 
dev
);

56 i‡(
blk
 >
œ°block
)

58 
dev
->
°©
.
num_buf„r_hôs
++;

62 
£g
 = seg->
√xt
;

66 
	}
}

69 
	$mems_buf„r_ö£π
 (
fú°block
,

70 
œ°block
,

71 
mems_t
 *
dev
)

73 
mems_£gmít
 *
£g
;

74 
blk
 = 
fú°block
;

76 i‡(!
dev
->
num£gs
) ;

78 i‡((
œ°block
 - 
fú°block
 + 1Ë> 
dev
->
£gsize
)

80 
	`¥ötf
("lastblock = %d, firstblock = %d, diff = %d, segsize = %d\n",

81 
œ°block
, 
fú°block
, (œ°block - fú°block + 1), 
dev
->
£gsize
);

83 
	`as£π
((
œ°block
 - 
fú°block
 + 1Ë<
dev
->
£gsize
);

89 
£g
 = 
dev
->
£gli°
; seg; seg = seg->
√xt
)

91 i‡((
fú°block
 >
£g
->
°¨tblkno
) &&

92 (
fú°block
 <(
£g
->
ídblkno
 + 1))) ;

94 i‡(
£g
)

98 i‡((
fú°block
 >
£g
->
°¨tblkno
Ë&& (
œ°block
 <£g->
ídblkno
))

100 
	`move_£gmít_to_hód
(
£g
, 
dev
);

107 i‡((
£g
->
ídblkno
 - seg->
°¨tblkno
 + 1Ë< 
dev
->
£gsize
)

109 
	`move_£gmít_to_hód
(
£g
, 
dev
);

110 
blk
 = 
fú°block
; blk <
œ°block
; blk++)

112 i‡(
£g
->
ídblkno
 < 
blk
)

114 
£g
->
ídblkno
 = 
blk
;

115 i‡((
£g
->
ídblkno
 - seg->
°¨tblkno
 + 1Ë>
dev
->
£gsize
)

119 i‡(
blk
 >
œ°block
) ;

125 
£g
 = 
dev
->
£gli°
;

126 
£g
->
√xt
) seg = seg->next;

127 
	`move_£gmít_to_hód
(
£g
, 
dev
);

128 
£g
->
°¨tblkno
 = 
blk
;

129 
£g
->
ídblkno
 = 
œ°block
;

132 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_buffer.h

1 #i‚de‡
__MEMS_BUFFER_H_


2 
	#__MEMS_BUFFER_H_


	)

4 
	~"mems_globÆ.h
"

7 
move_£gmít_to_hód
 (
mems_£gmít
 *
tmp£g
,

8 
mems_t
 *
dev
);

11 
mems_buf„r_check
 (
fú°block
,

12 
œ°block
,

13 
mems_t
 *
dev
);

16 
mems_buf„r_ö£π
 (
fú°block
,

17 
œ°block
,

18 
mems_t
 *
dev
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_disksim.c

38 
	~<°dio.h
>

39 
	~<°dlib.h
>

40 
	~<°rög.h
>

41 
	~"mems_globÆ.h
"

42 
	~"mems_öã∫Æs.h
"

43 
	~"mems_m≠pög.h
"

44 
	~"disksim_ioqueue.h
"

45 
	~"disksim_bus.h
"

47 
	~"c⁄fig.h
"

49 
	~"moduÀs/moduÀs.h
"

52 *
	g°©desc_ªque°_íîgy_uj
 = "Per-requestÉnergy (uJ)";

53 *
	g°©desc_£ek_time
 = "SeekÅime";

54 *
	g°©desc_x_£ek_time
 = "X SeekÅime";

55 *
	g°©desc_y_£ek_time
 = "Y SeekÅime";

56 *
	g°©desc_tu∫¨ound_time
 = "InitialÅurnaroundÅime";

57 *
	g°©desc_tu∫¨ound_numbî
 = "InitialÅurnaroundÇumber";

58 *
	g°©desc_°ªam_tu∫¨ound_time
 = "StreamingÅurnaroundÅime";

59 *
	g°©desc_°ªam_tu∫¨ound_numbî
 = "StreamingÅurnaroundÇumber";

60 *
	g°©desc_subåack_ac˚s£s
 = "Subtrackáccesses";

61 *
	g°©desc_tùs_≥r_ac˚ss
 = "AverageÅipsÖeráccess";

62 *
	g°©desc_öa˘ive_time
 = "InactiveÅime";

63 *
	g°©desc_¥e„tched_blocks
 = "Prefetched blocks";

65 
devi˚_hódî
 
	gmems_hdr_öôülizî
;

73 
	$mems_gë_bu¢o
 (
i‹eq_evít
 *
cuº
)

75 
mems_t
 *
dev
 = 
	`gëmems
(
cuº
->
devno
);

76 
ötch¨
 
bu¢o
;

77 
dïth
;

79 
bu¢o
.
vÆue
 = 
cuº
->busno;

80 
dïth
 = 
dev
->depth[0];

81  
bu¢o
.
byã
[
dïth
];

82 
	}
}

87 
	$mems_gë_dïth
 (
devno
)

89 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

90  
dev
->
dïth
[0];

91 
	}
}

96 
	$mems_gë_öbus
 (
devno
)

98 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

99  
dev
->
öbu£s
[0];

100 
	}
}

105 
	$mems_gë_¶Ÿno
 (
devno
)

107 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

108  
dev
->
¶Ÿno
[0];

109 
	}
}

114 
	$mems_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
)

116 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

117 
cou¡
;

119 
cou¡
 = 
dev
->
numöbu£s
;

120 
dev
->
numöbu£s
++;

121 i‡((
cou¡
 + 1Ë> 
MAXINBUSES
) {

122 
	`Ârötf
(
°dîr
,"Toÿm™y inbu£†•ecifõd f‹ memsdevi˚ %d--%d\n", 
devno
, 
cou¡
 + 1);

123 
	`exô
(1);

125 
dev
->
öbu£s
[
cou¡
] = 
öbu¢o
;

126 
dev
->
dïth
 [
cou¡
] = depth;

127 
dev
->
¶Ÿno
 [
cou¡
] = slotno;

130 
	}
}

139 
	$mems_gë_avg_£˘≥rcyl
 (
devno
)

141 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

142  
	`mems_gë_blocks_≥r_cylödî
(&
dev
->
¶ed
[0]);

143 
	}
}

148 
	$mems_gë_m≠pög
 (
m≠ty≥
, 
devno
, 
blkno
,

149 *
cyÕå
, *
surÁ˚±r
, *
blk±r
)

151 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

152 
mems_¶ed_t
 *
¶ed
 = 
	`mems_lbn_to_¶ed
(
dev
, 
blkno
);

153 
tù£˘‹_co‹d_£t_t
 
up
, 
dn
;

154 
tù£t_t
 
tù£t
;

156 i‡((
blkno
 < 0Ë|| (blknÿ>
dev
->
numblocks
)) {

157 
	`Ârötf
(
°dîr
, "InvÆid blknÿ© mems_gë_m≠pög (%d)\n", 
blkno
);

158 
	`exô
(1);

161 
	`mems_lbn_to_posôi⁄
(
blkno
, 
¶ed
, &
up
, &
dn
, &
tù£t
, 
cyÕå
, 
surÁ˚±r
, 
blk±r
);

162 
	}
}

167 
	$mems_gë_numcyls
 (
devno
)

169 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

170  
	`mems_gë_numbî_of_cylödîs
(
dev
);

171 
	}
}

175 
	$mems_gë_ac˘ime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
maxtime
)

182 
	`as£π
(
FALSE
);

185 
	}
}

189 
	$mems_gë_£ektime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
)

191 
mems_t
 *
dev
 = 
	`gëmems
(
ªq
->
devno
);

192 
mems_¶ed_t
 *
¶ed
 = 
	`mems_lbn_to_¶ed
(
dev
, 
ªq
->
blkno
);

193 
up_time
;

194 
dn_time
;

195 
tù£˘‹_co‹d_£t_t
 
up
;

196 
tù£˘‹_co‹d_£t_t
 
dn
;

197 
tù£t_t
 
tù£t
;

201 
	`mems_lbn_to_posôi⁄
(
ªq
->
blkno
, 
¶ed
, &
up
, &
dn
, &
tù£t
, 
NULL
, NULL, NULL);

202 
up_time
 = 
	`mems_£ek_time
(
¶ed
, &¶ed->
pos
, &
up
.
£rvo_°¨t
, 
NULL
, NULL, NULL, NULL);

203 
dn_time
 = 
	`mems_£ek_time
(
¶ed
, &¶ed->
pos
, &
dn
.
£rvo_°¨t
, 
NULL
, NULL, NULL, NULL);

204  
	`mö
(
up_time
, 
dn_time
);

205 
	}
}

208 
	$mems_gë_avîage_posôi⁄
 (
tù£˘‹_co‹d_£t_t
 *
up
,

209 
tù£˘‹_co‹d_£t_t
 *
down
,

210 
co‹d_t
 *
avîage
)

212 
	`as£π
(
up
->
£rvo_°¨t
.
x_pos
 =
down
->servo_start.x_pos);

214 
avîage
->
x_pos
 = 
up
->
£rvo_°¨t
.x_pos;

215 
avîage
->
y_pos
 = (
up
->
£rvo_°¨t
.y_po†+ 
down
->servo_start.y_pos) / 2;

216 
avîage
->
y_vñ
 = 0;

217 
	}
}

239 
	$mems_gë_di°™˚
 (
devno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
)

241 
co‹d_t
 *
°¨t_posôi⁄
;

242 
co‹d_t
 *
de°_posôi⁄
;

244 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

245 
mems_¶ed_t
 *
¶ed
 = 
	`mems_lbn_to_¶ed
(
dev
, 
ªq
->
blkno
);

247 
tù£˘‹_co‹d_£t_t
 
up
, 
down
;

248 
tù£t_t
 
tù£t
;

250 
di°™˚1
, 
di°™˚2
;

252 
x1
, 
x2
, 
y1
, 
y2
;

254 #ifde‡
DISTANCE_DEBUG


255 
	`Ârötf
(
ouçutfûe
, "mems_get_distance -- devno = %d,Ñeq->blkno = %d,Éxact = %d, direction = %d\n",

256 
devno
, 
ªq
->
blkno
, 
exa˘
, 
dúe˘i⁄
);

259 i‡(
exa˘
 == -1)

261 
°¨t_posôi⁄
 = 
	`mems_gë_cuºít_posôi⁄
(
¶ed
);

266 
	`mems_lbn_to_posôi⁄
(
exa˘
,

267 
¶ed
,

268 &
up
, &
down
,

269 &
tù£t
,

270 
NULL
, NULL, NULL);

272 
°¨t_posôi⁄
 = (
co‹d_t
 *)
	`mÆloc
((coord_t));

274 
	`mems_gë_avîage_posôi⁄
(&
up
, &
down
, 
°¨t_posôi⁄
);

280 
	`mems_lbn_to_posôi⁄
(
ªq
->
blkno
,

281 
¶ed
,

282 &
up
, &
down
,

283 &
tù£t
,

284 
NULL
, NULL, NULL);

288 
x1
 = 
°¨t_posôi⁄
->
x_pos
;

289 
x2
 = 
up
.
£rvo_°¨t
.
x_pos
;

290 
y1
 = 
°¨t_posôi⁄
->
y_pos
;

291 
y2
 = 
up
.
£rvo_°¨t
.
y_pos
;

293 #ifde‡
DISTANCE_DEBUG


294 
	`Ârötf
(
ouçutfûe
, "mems_get_distance -- UP - x1 = %d, y1 = %d, x2 = %d, y2 = %d\n",

295 
x1
, 
y1
, 
x2
, 
y2
);

298 
di°™˚1
 = ()(
	`sqπ
((
x1
 - 
x2
Ë* (x1 - x2Ë+ (
y1
 - 
y2
) * (y1 - y2)));

300 
x1
 = 
°¨t_posôi⁄
->
x_pos
;

301 
x2
 = 
down
.
£rvo_°¨t
.
x_pos
;

302 
y1
 = 
°¨t_posôi⁄
->
y_pos
;

303 
y2
 = 
down
.
£rvo_°¨t
.
y_pos
;

305 #ifde‡
DISTANCE_DEBUG


306 
	`Ârötf
(
ouçutfûe
, "mems_get_distance -- DOWN - x1 = %d, y1 = %d, x2 = %d, y2 = %d\n",

307 
x1
, 
y1
, 
x2
, 
y2
);

310 
di°™˚2
 = ()(
	`sqπ
((
x1
 - 
x2
Ë* (x1 - x2Ë+ (
y1
 - 
y2
) * (y1 - y2)));

312 i‡(
exa˘
 != -1)

314 
	`‰ì
(
°¨t_posôi⁄
);

317 #ifde‡
DISTANCE_DEBUG


318 
	`Ârötf
(
ouçutfûe
, "mems_get_distance -- distance1 = %d, distance2 = %d\n",

319 
di°™˚1
, 
di°™˚2
);

322 i‡(
di°™˚1
 < 
di°™˚2
)

324 #ifde‡
DISTANCE_DEBUG


325 
	`Ârötf
(
ouçutfûe
, "ªtu∫ög di°™˚1 = %d\n", 
di°™˚1
);

327  (
di°™˚1
);

331 #ifde‡
DISTANCE_DEBUG


332 
	`Ârötf
(
ouçutfûe
, "ªtu∫ög di°™˚2 = %d\n", 
di°™˚2
);

334  (
di°™˚2
);

336 
	}
}

337 #unde‡
DISTANCE_DEBUG


340 
	$mems_gë_£rvtime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
)

343  
	`mems_gë_£ektime
(
devno
, 
ªq
, 
checkˇche
, 
maxtime
);

344 
	}
}

354 
	$mems_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
)

356 
mems_t
 *
dev
 = 
	`gëmems
(
cuº
->
devno
);

357 
tm±ime
;

360 
tm±ime
 = 
	`bus_gë_å™s„r_time
(
	`mems_gë_bu¢o
(
cuº
), 1, (cuº->
Êags
 & 
READ
));

361 i‡(
tm±ime
 < 
dev
->
blkå™°ime
) {

363 
tm±ime
 = 
dev
->
blkå™°ime
;

366  
tm±ime
;

367 
	}
}

372 
	$mems_gë_maxout°™dög
 (
devno
)

374 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

375  
dev
->
maxqÀn
;

376 
	}
}

381 
	$mems_gë_numbî_of_blocks
 (
devno
)

383 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

384 i‡(
dev
->
numblocks
 =0Ë
	`mems_check_numblocks
(dev);

385  
dev
->
numblocks
;

386 
	}
}

394 
	$mems_°©öô
 (
devno
, 
fú°time
)

396 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

397 
j
;

400 i‡(
fú°time
) {

401 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_ªque°_íîgy_uj
,

402 &
dev
->
°©
.
ªque°_íîgy_uj
);

403 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_£ek_time
,

404 &
dev
->
°©
.
£ek_time
);

405 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_x_£ek_time
,

406 &
dev
->
°©
.
x_£ek_time
);

407 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_y_£ek_time
,

408 &
dev
->
°©
.
y_£ek_time
);

409 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_tu∫¨ound_time
,

410 &
dev
->
°©
.
tu∫¨ound_time
);

411 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_tu∫¨ound_numbî
,

412 &
dev
->
°©
.
tu∫¨ound_numbî
);

414 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_°ªam_tu∫¨ound_time
,

415 &
dev
->
°©
.
°ªam_tu∫¨ound_time
);

416 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_°ªam_tu∫¨ound_numbî
,

417 &
dev
->
°©
.
°ªam_tu∫¨ound_numbî
);

419 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_subåack_ac˚s£s
,

420 &
dev
->
°©
.
subåack_ac˚s£s
);

421 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_tùs_≥r_ac˚ss
,

422 &
dev
->
°©
.
tùs_≥r_ac˚ss
);

423 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_öa˘ive_time
,

424 &
dev
->
°©
.
öa˘ive_time
);

425 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_¥e„tched_blocks
,

426 &
dev
->
°©
.
¥e„tched_blocks
);

428 
	`°©_ª£t
 (&
dev
->
°©
.
ªque°_íîgy_uj
);

429 
	`°©_ª£t
 (&
dev
->
°©
.
£ek_time
);

430 
	`°©_ª£t
 (&
dev
->
°©
.
x_£ek_time
);

431 
	`°©_ª£t
 (&
dev
->
°©
.
y_£ek_time
);

432 
	`°©_ª£t
 (&
dev
->
°©
.
tu∫¨ound_time
);

433 
	`°©_ª£t
 (&
dev
->
°©
.
tu∫¨ound_numbî
);

435 
	`°©_ª£t
 (&
dev
->
°©
.
°ªam_tu∫¨ound_time
);

436 
	`°©_ª£t
 (&
dev
->
°©
.
°ªam_tu∫¨ound_numbî
);

438 
	`°©_ª£t
 (&
dev
->
°©
.
subåack_ac˚s£s
);

439 
	`°©_ª£t
 (&
dev
->
°©
.
tùs_≥r_ac˚ss
);

440 
	`°©_ª£t
 (&
dev
->
°©
.
öa˘ive_time
);

441 
	`°©_ª£t
 (&
dev
->
°©
.
¥e„tched_blocks
);

443 
dev
->
°©
.
tŸÆ_íîgy_j
 = 0.0;

444 
dev
->
°©
.
£rvicög_íîgy_j
 = 0.0;

445 
dev
->
°©
.
°¨tup_íîgy_j
 = 0.0;

446 
dev
->
°©
.
idÀ_íîgy_j
 = 0.0;

447 
dev
->
°©
.
öa˘ive_íîgy_j
 = 0.0;

448 
dev
->
°©
.
num_•öups
 = 0;

449 
dev
->
°©
.
num_•ödowns
 = 0;

450 
dev
->
°©
.
num_buf„r_ac˚s£s
 = 0;

451 
dev
->
°©
.
num_buf„r_hôs
 = 0;

452 
dev
->
°©
.
num_öôül_tu∫¨ounds
 = 0;

453 
dev
->
°©
.
num_°ªam_tu∫¨ounds
 = 0;

456 
j
=0; j < 
dev
->
num_¶eds
; j++) {

457 i‡(
fú°time
) {

458 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_ªque°_íîgy_uj
,

459 &
dev
->
¶ed
[
j
].
°©
.
ªque°_íîgy_uj
);

460 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_£ek_time
,

461 &
dev
->
¶ed
[
j
].
°©
.
£ek_time
);

462 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_x_£ek_time
,

463 &
dev
->
¶ed
[
j
].
°©
.
x_£ek_time
);

464 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_y_£ek_time
,

465 &
dev
->
¶ed
[
j
].
°©
.
y_£ek_time
);

466 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_tu∫¨ound_time
,

467 &
dev
->
¶ed
[
j
].
°©
.
tu∫¨ound_time
);

468 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_tu∫¨ound_numbî
,

469 &
dev
->
¶ed
[
j
].
°©
.
tu∫¨ound_numbî
);

471 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_°ªam_tu∫¨ound_time
,

472 &
dev
->
¶ed
[
j
].
°©
.
°ªam_tu∫¨ound_time
);

473 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_°ªam_tu∫¨ound_numbî
,

474 &
dev
->
¶ed
[
j
].
°©
.
°ªam_tu∫¨ound_numbî
);

476 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_subåack_ac˚s£s
,

477 &
dev
->
¶ed
[
j
].
°©
.
subåack_ac˚s£s
);

478 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_tùs_≥r_ac˚ss
,

479 &
dev
->
¶ed
[
j
].
°©
.
tùs_≥r_ac˚ss
);

480 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_öa˘ive_time
,

481 &
dev
->
¶ed
[
j
].
°©
.
öa˘ive_time
);

482 
	`°©_öôülize
 (
°©deffûe
, 
°©desc_¥e„tched_blocks
,

483 &
dev
->
¶ed
[
j
].
°©
.
¥e„tched_blocks
);

485 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
ªque°_íîgy_uj
);

486 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
£ek_time
);

487 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
x_£ek_time
);

488 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
y_£ek_time
);

489 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
tu∫¨ound_time
);

490 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
tu∫¨ound_numbî
);

492 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
°ªam_tu∫¨ound_time
);

493 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
°ªam_tu∫¨ound_numbî
);

495 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
subåack_ac˚s£s
);

496 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
tùs_≥r_ac˚ss
);

497 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
öa˘ive_time
);

498 
	`°©_ª£t
 (&
dev
->
¶ed
[
j
].
°©
.
¥e„tched_blocks
);

500 
dev
->
¶ed
[
j
].
°©
.
tŸÆ_íîgy_j
 = 0.0;

501 
dev
->
¶ed
[
j
].
°©
.
£rvicög_íîgy_j
 = 0.0;

502 
dev
->
¶ed
[
j
].
°©
.
°¨tup_íîgy_j
 = 0.0;

503 
dev
->
¶ed
[
j
].
°©
.
idÀ_íîgy_j
 = 0.0;

504 
dev
->
¶ed
[
j
].
°©
.
öa˘ive_íîgy_j
 = 0.0;

505 
dev
->
¶ed
[
j
].
°©
.
num_•öups
 = 0;

506 
dev
->
¶ed
[
j
].
°©
.
num_•ödowns
 = 0;

507 
dev
->
¶ed
[
j
].
°©
.
num_buf„r_ac˚s£s
 = 0;

508 
dev
->
¶ed
[
j
].
°©
.
num_buf„r_hôs
 = 0;

509 
dev
->
¶ed
[
j
].
°©
.
num_öôül_tu∫¨ounds
 = 0;

510 
dev
->
¶ed
[
j
].
°©
.
num_°ªam_tu∫¨ounds
 = 0;

512 
	}
}

517 
	$mems_˛ón°©s
 ()

519 
mems_t
 *
dev
;

520 
i
;

521 
j
;

523 i‡(
disksim
->
memsöfo
 =
NULL
) {

528 
i
 = 0; i < 
disksim
->
memsöfo
->
devi˚s_Àn
; i++) {

529 
dev
 = 
	`gëmems
(
i
);

530 i‡(
dev
) {

531 
	`ioqueue_˛ón°©s
(
dev
->
queue
);

533 
j
 = 0; j < 
dev
->
num_¶eds
; j++) {

534 
	`ioqueue_˛ón°©s
(
dev
->
¶ed
[
j
].
queue
);

540 
	}
}

545 
	$mems_ª£t°©s
 ()

547 
mems_t
 *
dev
;

548 
i
;

549 
j
;

551 i‡(
disksim
->
memsöfo
 =
NULL
) {

555 
i
 = 0; i < 
disksim
->
memsöfo
->
devi˚s_Àn
; i++) {

556 
dev
 = 
	`gëmems
(
i
);

557 i‡(
dev
) {

558 
	`ioqueue_ª£t°©s
(
dev
->
queue
);

559 
j
=0; j<
MEMS_MAXSLEDS
; j++) {

560 
	`ioqueue_ª£t°©s
(
dev
->
¶ed
[
j
].
queue
);

562 
	`mems_°©öô
(
i
, 
FALSE
);

565 
	}
}

569 
	$mems_¥e„tch_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

571 
i
;

572 
j
;

573 
°©gí
 *
°©£t
[
MAXDEVICES
];

574 
mems_t
 *
dev
 = 0;

581 
i
=0; i < 
£tsize
; i++) {

582 
dev
 = 
	`gëmems
(
£t
[
i
]);

583 
°©£t
[
i
] = &
dev
->
°©
.
¥e„tched_blocks
;

585 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

588 
i
=0; i < 
£tsize
; i++) {

589 
√w¥efix
[80];

590 
dev
 = 
	`gëmems
(
£t
[
i
]);

592 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

593 
°©£t
[0] = &
dev
->
°©
.
¥e„tched_blocks
;

594 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

596 
j
=0; j < 
dev
->
num_¶eds
; j++) {

597 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

598 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
¥e„tched_blocks
;

599 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

602 
	}
}

606 
	$mems_£ektime_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

608 
i
;

609 
j
;

610 
°©gí
 *
°©£t
[
MAXDEVICES
];

611 
mems_t
 *
dev
 = 0;

618 
i
=0; i < 
£tsize
; i++) {

619 
dev
 = 
	`gëmems
(
£t
[
i
]);

620 
°©£t
[
i
] = &
dev
->
°©
.
£ek_time
;

622 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

625 
i
=0; i < 
£tsize
; i++) {

626 
√w¥efix
[80];

627 
dev
 = 
	`gëmems
(
£t
[
i
]);

629 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

630 
°©£t
[0] = &
dev
->
°©
.
£ek_time
;

631 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

633 
j
=0; j < 
dev
->
num_¶eds
; j++) {

634 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

635 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
£ek_time
;

636 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

645 
i
=0; i < 
£tsize
; i++) {

646 
dev
 = 
	`gëmems
(
£t
[
i
]);

647 
°©£t
[
i
] = &
dev
->
°©
.
x_£ek_time
;

649 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

652 
i
=0; i < 
£tsize
; i++) {

653 
√w¥efix
[80];

654 
dev
 = 
	`gëmems
(
£t
[
i
]);

656 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

657 
°©£t
[0] = &
dev
->
°©
.
x_£ek_time
;

658 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

660 
j
=0; j < 
dev
->
num_¶eds
; j++) {

661 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

662 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
x_£ek_time
;

663 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

672 
i
=0; i < 
£tsize
; i++) {

673 
dev
 = 
	`gëmems
(
£t
[
i
]);

674 
°©£t
[
i
] = &
dev
->
°©
.
y_£ek_time
;

676 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

679 
i
=0; i < 
£tsize
; i++) {

680 
√w¥efix
[80];

681 
dev
 = 
	`gëmems
(
£t
[
i
]);

683 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

684 
°©£t
[0] = &
dev
->
°©
.
y_£ek_time
;

685 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

687 
j
=0; j < 
dev
->
num_¶eds
; j++) {

688 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

689 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
y_£ek_time
;

690 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

699 
i
=0; i < 
£tsize
; i++) {

700 
dev
 = 
	`gëmems
(
£t
[
i
]);

701 
°©£t
[
i
] = &
dev
->
°©
.
tu∫¨ound_time
;

703 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

706 
i
=0; i < 
£tsize
; i++) {

707 
√w¥efix
[80];

708 
dev
 = 
	`gëmems
(
£t
[
i
]);

710 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

711 
°©£t
[0] = &
dev
->
°©
.
tu∫¨ound_time
;

712 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

714 
j
=0; j < 
dev
->
num_¶eds
; j++) {

715 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

716 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
tu∫¨ound_time
;

717 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

727 
	`Ârötf
(
ouçutfûe
, "%sTotal initialÅurnarounds: %d\n",

728 
¥efix
, 
dev
->
°©
.
num_öôül_tu∫¨ounds
);

730 
i
=0; i < 
£tsize
; i++) {

731 
dev
 = 
	`gëmems
(
£t
[
i
]);

732 
°©£t
[
i
] = &
dev
->
°©
.
tu∫¨ound_numbî
;

734 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

737 
i
=0; i < 
£tsize
; i++) {

738 
√w¥efix
[80];

739 
dev
 = 
	`gëmems
(
£t
[
i
]);

741 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

743 
	`Ârötf
(
ouçutfûe
, "%sTotal initialÅurnarounds: %d\n",

744 
√w¥efix
, 
dev
->
°©
.
num_öôül_tu∫¨ounds
);

746 
°©£t
[0] = &
dev
->
°©
.
tu∫¨ound_numbî
;

747 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

749 
j
=0; j < 
dev
->
num_¶eds
; j++) {

750 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

751 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
tu∫¨ound_numbî
;

752 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

761 
i
=0; i < 
£tsize
; i++) {

762 
dev
 = 
	`gëmems
(
£t
[
i
]);

763 
°©£t
[
i
] = &
dev
->
°©
.
°ªam_tu∫¨ound_time
;

765 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

768 
i
=0; i < 
£tsize
; i++) {

769 
√w¥efix
[80];

770 
dev
 = 
	`gëmems
(
£t
[
i
]);

772 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

773 
°©£t
[0] = &
dev
->
°©
.
°ªam_tu∫¨ound_time
;

774 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

776 
j
=0; j < 
dev
->
num_¶eds
; j++) {

777 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

778 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
°ªam_tu∫¨ound_time
;

779 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

788 
	`Ârötf
(
ouçutfûe
, "%sTotal streamingÅurnarounds: %d\n",

789 
¥efix
, 
dev
->
°©
.
num_°ªam_tu∫¨ounds
);

791 
i
=0; i < 
£tsize
; i++) {

792 
dev
 = 
	`gëmems
(
£t
[
i
]);

793 
°©£t
[
i
] = &
dev
->
°©
.
°ªam_tu∫¨ound_numbî
;

795 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

798 
i
=0; i < 
£tsize
; i++) {

799 
√w¥efix
[80];

800 
dev
 = 
	`gëmems
(
£t
[
i
]);

802 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

804 
	`Ârötf
(
ouçutfûe
, "%sTotal streamingÅurnarounds: %d\n",

805 
√w¥efix
, 
dev
->
°©
.
num_°ªam_tu∫¨ounds
);

807 
°©£t
[0] = &
dev
->
°©
.
°ªam_tu∫¨ound_numbî
;

808 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

810 
j
=0; j < 
dev
->
num_¶eds
; j++) {

811 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

812 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
°ªam_tu∫¨ound_numbî
;

813 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

816 
	}
}

820 
	$mems_íîgy_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

822 
i
;

823 
j
;

824 
°©gí
 *
°©£t
[
MAXDEVICES
];

825 
mems_t
 *
dev
;

832 
i
=0; i < 
£tsize
; i++) {

833 
dev
 = 
	`gëmems
(
£t
[
i
]);

834 
°©£t
[
i
] = &
dev
->
°©
.
ªque°_íîgy_uj
;

836 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

839 
i
=0; i < 
£tsize
; i++) {

840 
√w¥efix
[80];

841 
dev
 = 
	`gëmems
(
£t
[
i
]);

843 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

844 
°©£t
[0] = &
dev
->
°©
.
ªque°_íîgy_uj
;

845 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

847 
j
=0; j < 
dev
->
num_¶eds
; j++) {

848 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

849 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
ªque°_íîgy_uj
;

850 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

859 
tŸÆ_íîgy
 = 0.0;

860 
£rvicög_íîgy
 = 0.0;

861 
°¨tup_íîgy
 = 0.0;

862 
idÀ_íîgy
 = 0.0;

863 
öa˘ive_íîgy
 = 0.0;

864 
i
=0; i < 
£tsize
; i++) {

865 
dev
 = 
	`gëmems
(
£t
[
i
]);

866 
tŸÆ_íîgy
 +
dev
->
°©
.
tŸÆ_íîgy_j
;

867 
£rvicög_íîgy
 +
dev
->
°©
.
£rvicög_íîgy_j
;

868 
°¨tup_íîgy
 +
dev
->
°©
.
°¨tup_íîgy_j
;

869 
idÀ_íîgy
 +
dev
->
°©
.
idÀ_íîgy_j
;

870 
öa˘ive_íîgy
 +
dev
->
°©
.
öa˘ive_íîgy_j
;

872 
	`Ârötf
(
ouçutfûe
, "%sTŸÆÉ√rgy (J): %f\n", 
¥efix
, 
tŸÆ_íîgy
);

873 
	`Ârötf
(
ouçutfûe
,

874 "%sSîvicögÉ√rgy (J): %f\n", 
¥efix
, 
£rvicög_íîgy
);

875 
	`Ârötf
(
ouçutfûe
,

876 "%sSèπu∞íîgy (J): %f\n", 
¥efix
, 
°¨tup_íîgy
);

877 
	`Ârötf
(
ouçutfûe
,

878 "%sIdÀÉ√rgy (J): %f\n", 
¥efix
, 
idÀ_íîgy
);

879 
	`Ârötf
(
ouçutfûe
,

880 "%sI«˘ivêíîgy (J): %f\n", 
¥efix
, 
öa˘ive_íîgy
);

881 
	`Ârötf
(
ouçutfûe
, "\n");

885 
i
=0; i < 
£tsize
; i++) {

886 
dev
 = 
	`gëmems
(
£t
[
i
]);

887 
	`Ârötf
(
ouçutfûe
, "%sTotalÉnergy (J) for device %d: %f\n",

888 
¥efix
, 
£t
[
i
], 
dev
->
°©
.
tŸÆ_íîgy_j
);

889 
	`Ârötf
(
ouçutfûe
, "%sServicingÉnergy (J) for device %d: %f\n",

890 
¥efix
, 
£t
[
i
], 
dev
->
°©
.
£rvicög_íîgy_j
);

891 
	`Ârötf
(
ouçutfûe
, "%sStartupÉnergy (J) for device %d: %f\n",

892 
¥efix
, 
£t
[
i
], 
dev
->
°©
.
°¨tup_íîgy_j
);

893 
	`Ârötf
(
ouçutfûe
, "%sIdleÉnergy (J) for device %d: %f\n",

894 
¥efix
, 
£t
[
i
], 
dev
->
°©
.
idÀ_íîgy_j
);

895 
	`Ârötf
(
ouçutfûe
, "%sInactiveÉnergy (J) for device %d: %f\n",

896 
¥efix
, 
£t
[
i
], 
dev
->
°©
.
öa˘ive_íîgy_j
);

898 
j
=0; j < 
dev
->
num_¶eds
; j++) {

899 
	`Ârötf
(
ouçutfûe
, "%sTotalÉnergy (J) for device %d sled %d: %f\n",

900 
¥efix
, 
£t
[
i
], 
j
, 
dev
->
¶ed
[j].
°©
.
tŸÆ_íîgy_j
);

901 
	`Ârötf
(
ouçutfûe
,

903 
¥efix
, 
£t
[
i
], 
j
, 
dev
->
¶ed
[j].
°©
.
£rvicög_íîgy_j
);

904 
	`Ârötf
(
ouçutfûe
,

906 
¥efix
, 
£t
[
i
], 
j
, 
dev
->
¶ed
[j].
°©
.
°¨tup_íîgy_j
);

907 
	`Ârötf
(
ouçutfûe
,

909 
¥efix
, 
£t
[
i
], 
j
, 
dev
->
¶ed
[j].
°©
.
idÀ_íîgy_j
);

910 
	`Ârötf
(
ouçutfûe
,

912 
¥efix
, 
£t
[
i
], 
j
, 
dev
->
¶ed
[j].
°©
.
öa˘ive_íîgy_j
);

914 
	`Ârötf
(
ouçutfûe
, "\n");

916 
	}
}

920 
	$mems_buf„r_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

922 
i
;

923 
mems_t
 *
dev
;

924 
tŸÆ_ac˚s£s
 = 0;

925 
tŸÆ_hôs
 = 0;

926 
hô_øtio
;

930 
i
=0; i < 
£tsize
; i++) {

931 
dev
 = 
	`gëmems
(
£t
[
i
]);

932 
tŸÆ_ac˚s£s
 +
dev
->
°©
.
num_buf„r_ac˚s£s
;

933 
tŸÆ_hôs
 +
dev
->
°©
.
num_buf„r_hôs
;

935 
hô_øtio
 = ()
tŸÆ_hôs
 / ()
tŸÆ_ac˚s£s
;

937 
	`Ârötf
(
ouçutfûe
, "%sNumber of bufferáccesses: %d\n",

938 
¥efix
, 
tŸÆ_ac˚s£s
);

939 
	`Ârötf
(
ouçutfûe
, "%sNumber of hits: %d\n",

940 
¥efix
, 
tŸÆ_hôs
);

941 
	`Ârötf
(
ouçutfûe
, "%sBuffer hitÑatio: %f\n",

942 
¥efix
, 
hô_øtio
);

943 
	`Ârötf
(
ouçutfûe
, "%sBuffer missÑatio: %f\n",

944 
¥efix
, 1.0 - 
hô_øtio
);

945 
	`Ârötf
(
ouçutfûe
, "\n");

949 
i
=0; i < 
£tsize
; i++) {

950 
dev
 = 
	`gëmems
(
£t
[
i
]);

952 i‡(
dev
->
°©
.
num_buf„r_ac˚s£s
) {

953 
hô_øtio
 = ()
dev
->
°©
.
num_buf„r_hôs
 /

954 ()
dev
->
°©
.
num_buf„r_ac˚s£s
;

955 
	`Ârötf
(
ouçutfûe
, "%sNumber of bufferáccesses for device %d: %d\n",

956 
¥efix
, 
i
, 
dev
->
°©
.
num_buf„r_ac˚s£s
);

957 
	`Ârötf
(
ouçutfûe
, "%sNumber of buffer hits for device %d: %d\n",

958 
¥efix
, 
i
, 
dev
->
°©
.
num_buf„r_hôs
);

959 
	`Ârötf
(
ouçutfûe
, "%sBuffer hitÑatio for device %d: %f\n",

960 
¥efix
, 
i
, 
hô_øtio
);

961 
	`Ârötf
(
ouçutfûe
, "%sBuffer missÑatio for device %d: %f\n",

962 
¥efix
, 
i
, 1.0 - 
hô_øtio
);

963 
	`Ârötf
(
ouçutfûe
, "\n");

965 
	`Ârötf
(
ouçutfûe
, "%sNo bufferáccesses for device %d\n",

966 
¥efix
, 
i
);

969 
	}
}

973 
	$mems_öa˘ive_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

975 
i
;

976 
j
;

977 
°©gí
 *
°©£t
[
MAXDEVICES
];

978 
mems_t
 *
dev
;

985 
tŸÆ_•öups
 = 0;

986 
i
=0; i < 
£tsize
; i++) {

987 
dev
 = 
	`gëmems
(
£t
[
i
]);

988 
tŸÆ_•öups
 +
dev
->
°©
.
num_•öups
;

990 
	`Ârötf
(
ouçutfûe
, "%sNumber of spinups: %d\n\n",

991 
¥efix
, 
tŸÆ_•öups
);

995 
i
=0; i < 
£tsize
; i++) {

996 
dev
 = 
	`gëmems
(
£t
[
i
]);

997 
	`Ârötf
(
ouçutfûe
, "%sNumber of spinups for device %d: %d\n",

998 
¥efix
, 
£t
[
i
], 
dev
->
°©
.
num_•öups
);

999 
j
=0; j < 
dev
->
num_¶eds
; j++) {

1000 
	`Ârötf
(
ouçutfûe
, "%sNumber of spinups for device %d sled %d: %d\n",

1001 
¥efix
, 
£t
[
i
], 
j
, 
dev
->
¶ed
[j].
°©
.
num_•öups
);

1003 
	`Ârötf
(
ouçutfûe
, "\n");

1011 
tŸÆ_•ödowns
 = 0;

1012 
i
=0; i < 
£tsize
; i++) {

1013 
dev
 = 
	`gëmems
(
£t
[
i
]);

1014 
tŸÆ_•ödowns
 +
dev
->
°©
.
num_•ödowns
;

1016 
	`Ârötf
(
ouçutfûe
, "%sNumber of spindowns: %d\n\n",

1017 
¥efix
, 
tŸÆ_•ödowns
);

1021 
i
=0; i < 
£tsize
; i++) {

1022 
dev
 = 
	`gëmems
(
£t
[
i
]);

1023 
	`Ârötf
(
ouçutfûe
, "%sNumber of spindowns for device %d: %d\n",

1024 
¥efix
, 
£t
[
i
], 
dev
->
°©
.
num_•ödowns
);

1025 
j
=0; j < 
dev
->
num_¶eds
; j++) {

1026 
	`Ârötf
(
ouçutfûe
, "%sNumber of spindowns for device %d sled %d: %d\n",

1027 
¥efix
, 
£t
[
i
], 
j
, 
dev
->
¶ed
[j].
°©
.
num_•ödowns
);

1029 
	`Ârötf
(
ouçutfûe
, "\n");

1037 
i
=0; i < 
£tsize
; i++) {

1038 
dev
 = 
	`gëmems
(
£t
[
i
]);

1039 
°©£t
[
i
] = &
dev
->
°©
.
öa˘ive_time
;

1041 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

1044 
i
=0; i < 
£tsize
; i++) {

1045 
√w¥efix
[80];

1046 
dev
 = 
	`gëmems
(
£t
[
i
]);

1048 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

1049 
°©£t
[0] = &
dev
->
°©
.
öa˘ive_time
;

1050 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

1052 
j
=0; j < 
dev
->
num_¶eds
; j++) {

1053 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

1054 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
öa˘ive_time
;

1055 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

1058 
	}
}

1062 
	$mems_Ÿhî_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

1064 
i
;

1065 
j
;

1066 
°©gí
 *
°©£t
[
MAXDEVICES
];

1067 
mems_t
 *
dev
;

1074 
i
=0; i < 
£tsize
; i++) {

1075 
dev
 = 
	`gëmems
(
£t
[
i
]);

1076 
°©£t
[
i
] = &
dev
->
°©
.
subåack_ac˚s£s
;

1078 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

1081 
i
=0; i < 
£tsize
; i++) {

1082 
√w¥efix
[80];

1083 
dev
 = 
	`gëmems
(
£t
[
i
]);

1085 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

1086 
°©£t
[0] = &
dev
->
°©
.
subåack_ac˚s£s
;

1087 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

1089 
j
=0; j < 
dev
->
num_¶eds
; j++) {

1090 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

1091 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
subåack_ac˚s£s
;

1092 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

1101 
i
=0; i < 
£tsize
; i++) {

1102 
dev
 = 
	`gëmems
(
£t
[
i
]);

1103 
°©£t
[
i
] = &
dev
->
°©
.
tùs_≥r_ac˚ss
;

1105 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

1108 
i
=0; i < 
£tsize
; i++) {

1109 
√w¥efix
[80];

1110 
dev
 = 
	`gëmems
(
£t
[
i
]);

1112 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d ", 
¥efix
, 
i
);

1113 
°©£t
[0] = &
dev
->
°©
.
tùs_≥r_ac˚ss
;

1114 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

1116 
j
=0; j < 
dev
->
num_¶eds
; j++) {

1117 
	`•rötf
(
√w¥efix
, "%sdevi˚ %d sÀd %d ", 
¥efix
, 
i
, 
j
);

1118 
°©£t
[0] = &
dev
->
¶ed
[
j
].
°©
.
tùs_≥r_ac˚ss
;

1119 
	`°©_¥öt_£t
(
°©£t
, 1, 
√w¥efix
);

1122 
	}
}

1127 
	$mems_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
)

1129 
i
;

1130 
ioq
 *
queue£t
[
MAXDEVICES
];

1131 
ªq˙t
 = 0;

1132 
¥efix
[80];

1134 
	`•rötf
(
¥efix
, "%smem†", 
sour˚°r
);

1135 
i
=0; i<
£tsize
; i++) {

1136 
mems_t
 *
dev
 = 
	`gëmems
(
£t
[
i
]);

1137 
queue£t
[
i
] = 
dev
->
queue
;

1138 
ªq˙t
 +
	`ioqueue_gë_numbî_of_ªque°s
(
dev
->
queue
);

1140 i‡(
ªq˙t
 == 0) {

1141 
	`Ârötf
(
ouçutfûe
, "\nNo memsÑequests for members ofÅhis set\n\n");

1144 
	`ioqueue_¥öt°©s
(
queue£t
, 
£tsize
, 
¥efix
);

1146 
	`mems_¥e„tch_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

1147 
	`mems_£ektime_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

1148 
	`mems_Ÿhî_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

1149 
	`mems_öa˘ive_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

1150 
	`mems_buf„r_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

1151 
	`mems_íîgy_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

1152 
	}
}

1157 
	$mems_¥öt°©s
 ()

1159 
ioq
 *
queue£t
[
MAXDEVICES
];

1160 
£t
[
MAXDEVICES
];

1161 
i
;

1162 
ªq˙t
 = 0;

1163 
¥efix
[80];

1164 
dev˙t
;

1166 
mems_t
 *
dev
;

1168 
	`Ârötf
(
ouçutfûe
, "\nMEMS STATISTICS\n----------------\n\n");

1169 
	`•rötf
(
¥efix
, "Mems ");

1171 i‡(!
disksim
->
memsöfo
) {

1172 
	`Ârötf
(
ouçutfûe
, "No memsÑequestsÉncountered (1)\n");

1176 
dev˙t
 = 0;

1177 
i
 = 0; i < 
disksim
->
memsöfo
->
devi˚s_Àn
; i++) {

1178 
dev
 = 
	`gëmems
(
i
);

1179 i‡(
dev
) {

1182 
queue£t
[
dev˙t
] = 
dev
->
¶ed
[0].
queue
;

1183 
ªq˙t
 +
	`ioqueue_gë_numbî_of_ªque°s
(
dev
->
queue
);

1184 
dev˙t
++;

1187 
	`as£π
(
dev˙t
 =
disksim
->
memsöfo
->
numdevi˚s
);

1196 
	`ioqueue_¥öt°©s
(
queue£t
, 
dev˙t
, 
¥efix
);

1198 
dev˙t
 = 0;

1199 
i
=0; i < 
disksim
->
memsöfo
->
devi˚s_Àn
; i++) {

1200 
dev
 = 
	`gëmems
(
i
);

1201 i‡(
dev
) {

1202 
£t
[
dev˙t
] = 
i
;

1203 
dev˙t
++;

1206 
	`as£π
(
dev˙t
 =
disksim
->
memsöfo
->
numdevi˚s
);

1208 
	`mems_¥e„tch_¥öt°©s
(
£t
, 
dev˙t
, 
¥efix
);

1209 
	`mems_£ektime_¥öt°©s
(
£t
, 
dev˙t
, 
¥efix
);

1210 
	`mems_Ÿhî_¥öt°©s
(
£t
, 
dev˙t
, 
¥efix
);

1211 
	`mems_öa˘ive_¥öt°©s
(
£t
, 
dev˙t
, 
¥efix
);

1212 
	`mems_buf„r_¥öt°©s
(
£t
, 
dev˙t
, 
¥efix
);

1213 
	`mems_íîgy_¥öt°©s
(
£t
, 
dev˙t
, 
¥efix
);

1214 
	`Ârötf
(
ouçutfûe
, "\n\n");

1215 
	}
}

1223 
mems
 *
	$memsmodñ_mems_lﬂd∑øms
(
Õ_block
 *
b
,

1224 *
num±r
)

1226 
c
;

1227 
num
;

1228 
mems
 *
ªsu…
;

1229 
mems_¶ed_t
 
tmp¶ed
;

1231 
	`devi˚_öôülize_devi˚öfo
();

1233 
	`bzîo
(&
tmp¶ed
, (tmpsled));

1235 
ªsu…
 = 
	`mÆloc
((
mems_t
));

1236 if(!
ªsu…
)  0;

1237 
	`bzîo
(
ªsu…
, (
mems_t
));

1239 ((
devi˚_hódî
 *)
ªsu…
)->
devi˚_ty≥
 = 
DEVICETYPE_MEMS
;

1242 i‡(
disksim
->
memsöfo
 =
NULL
) {

1243 
disksim
->
memsöfo
 = 
	`mÆloc
((
mems_öfo
));

1244 
	`ASSERT
(
disksim
->
memsöfo
 !
NULL
);

1245 
	`bzîo
((*)
disksim
->
memsöfo
, (
mems_öfo
));

1252 
c
 = 0; c < 
disksim
->
memsöfo
->
devi˚s_Àn
; c++) {

1253 if(!
disksim
->
memsöfo
->
devi˚s
[
c
]) {

1258 if(
c
 =
disksim
->
memsöfo
->
devi˚s_Àn
) {

1259 
√wÀn
 = 
disksim
->
memsöfo
->
devi˚s_Àn
 ?

1260 
disksim
->
memsöfo
->
devi˚s_Àn
 * 2 : 2;

1261 
zîﬁí
 = 
√wÀn
 == 2 ? 2 :Çewlen / 2;

1263 
disksim
->
memsöfo
->
devi˚s
 =

1264 
	`ªÆloc
(
disksim
->
memsöfo
->
devi˚s
,

1265 
√wÀn
 * (
mems_t
 *));

1267 
	`bzîo
(
disksim
->
memsöfo
->
devi˚s
 + 
c
, 
zîﬁí
 * (
mems_t
 *));

1268 
disksim
->
memsöfo
->
devi˚s_Àn
 = 
√wÀn
;

1271 
disksim
->
memsöfo
->
devi˚s
[
c
] = 
ªsu…
;

1272 
num
 = 
c
;

1273 if(
num±r
Ë*num±∏
num
;

1274 
ªsu…
->
hdr
 = 
mems_hdr_öôülizî
;

1275 
ªsu…
->
hdr
.
devi˚_«me
 = 
	`°rdup
(
b
->
«me
);

1277 
disksim
->
memsöfo
->
numdevi˚s
++;

1281 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
memsmodñ_mems_mod
);

1283 
c
 = 0; c < 
MAXINBUSES
; c++) {

1284 
ªsu…
->
öbu£s
[
c
] = -1;

1285 
ªsu…
->
dïth
[
c
] = -1;

1286 
ªsu…
->
¶Ÿno
[
c
] = -1;

1290 
c
 = 0; c < 
ªsu…
->
num_¶eds
; c++) {

1291 
	`mem˝y
(&
ªsu…
->
¶ed
[
c
], &ªsu…->¶ed[0],Ñesu…->
num_¶eds
 * (
mems_¶ed_t
));

1292 
ªsu…
->
¶ed
[
c
].
queue
 = 
	`ioqueue_c›y
(result->queue);

1296 
	`devi˚_add
((
devi˚_hódî
 *)
ªsu…
, 
num
);

1297  
ªsu…
;

1298 
	}
}

1300 
mems_t
 *
	$mems_c›y
(
mems_t
 *
§c
) {

1301 
mems_t
 *
ªsu…
 = 
	`mÆloc
((mems_t));

1302 
	`bzîo
(
ªsu…
, (
mems_t
));

1303 
	`mem˝y
(
ªsu…
, 
§c
, (
mems_t
));

1304 
ªsu…
->
queue
 = 
	`ioqueue_c›y
(
§c
->queue);

1305 
	`mem˝y
(&
ªsu…
->
¶ed
, 
§c
->¶ed, src->
num_¶eds
 * (
mems_¶ed_t
));

1306  
ªsu…
;

1307 
	}
}

1314 
	$mems_öôülize
 ()

1316 
i
;

1317 
j
;

1318 
k
;

1319 
mems_t
 *
dev
;

1321 i‡(
disksim
->
memsöfo
 =
NULL
) ;

1323 
	`ioqueue_£tˇŒbacks
();

1326 
i
 = 0; i < 
disksim
->
memsöfo
->
devi˚s_Àn
; i++) {

1327 
dev
 = 
	`gëmems
(
i
);

1328 i‡(
dev
) {

1329 
dev
->
busow√d
 = -1;

1330 
	`addli°t€xåaq
((
evít
 **)&
dev
->
buswaô
);

1331 
	`ioqueue_öôülize
(
dev
->
queue
, 
i
);

1332 
dev
->
d©ax„r_ªq
 = 
NULL
;

1333 
dev
->
d©ax„r_queue
 = 
NULL
;

1336 i‡((
dev
->
num£gs
 > 0Ë&& (dev->
£gli°
 =
NULL
)) {

1337 
dev
->
£gli°
 = (
mems_£gmít
 *)
	`DISKSIM_mÆloc
((mems_segment));

1338 
dev
->
£gli°
->
√xt
 = 
NULL
;

1339 
dev
->
£gli°
->
¥ev
 = 
NULL
;

1340 
dev
->
£gli°
->
time
 = 0.0;

1341 
dev
->
£gli°
->
°¨tblkno
 = 0;

1342 
dev
->
£gli°
->
ídblkno
 = 0;

1343 
k
 = 1; k < 
dev
->
num£gs
; k++) {

1344 
mems_£gmít
 *
tmp£g
 = (mems_£gmíà*)
	`DISKSIM_mÆloc
((mems_segment));

1345 
tmp£g
->
√xt
 = 
dev
->
£gli°
;

1346 
dev
->
£gli°
 = 
tmp£g
;

1347 
tmp£g
->
√xt
->
¥ev
 =Åmpseg;

1348 
tmp£g
->
¥ev
 = 
NULL
;

1349 
tmp£g
->
°¨tblkno
 = 0;

1350 
tmp£g
->
ídblkno
 = 0;

1353 i‡(
dev
->
num£gs
 =0Ë
	`addli°t€xåaq
((
evít
 **)&dev->
£gli°
);

1355 
	`mems_check_numblocks
(
dev
);

1357 
j
 = 0; j < 
dev
->
num_¶eds
; j++) {

1358 
dev
->
¶ed
[
j
].dev = dev;

1360 
	`ioqueue_öôülize
(
dev
->
¶ed
[
j
].
queue
, 
i
);

1362 
dev
->
¶ed
[
j
].
a˘ive
 = 
MEMS_SLED_INACTIVE
;

1363 
dev
->
¶ed
[
j
].
a˘ive_ªque°
 = 
NULL
;

1364 
dev
->
¶ed
[
j
].
¥e„tch_öfo
 = 
NULL
;

1365 
dev
->
¶ed
[
j
].
œ°ªq_lbn
 = 
	`mems_˚¡îmo°_lbn
(&dev->sled[j]);

1366 
dev
->
¶ed
[
j
].
œ°ªq_com±ime
 = 0.0;

1369 
	`mems_lbn_to_posôi⁄
(
dev
->
¶ed
[
j
].
œ°ªq_lbn
, &dev->¶ed[j], &dev->¶ed[j].
co‹d£t_up
, &dev->¶ed[j].
co‹d£t_dn
, &dev->¶ed[j].
tù£t
, 
NULL
, NULL, NULL);

1370 
	`mems_co‹d_t_c›y
(&
dev
->
¶ed
[
j
].
co‹d£t_up
.
£rvo_°¨t
, &dev->¶ed[j].
pos
);

1373 
	`mems_°©öô
(
i
, 
TRUE
);

1374 i‡(
dev
->
¥ecompuã_£ek_cou¡
 > 0) {

1375 
	`mems_¥ecompuã_£ek_curve
(
dev
);

1379 
	}
}

1382 
	$mems_unim∂emíãd
() {

1383 
	`Ârötf
(
°dîr
, "***Érror: mems method unsupported\n");

1384 
	`as£π
(0);

1385 
	}
}

1388 
mems_evít_¨rive
 (
i‹eq_evít
 *
cuº
);

1389 
mems_bus_dñay_com∂ëe
 (
devno
, 
i‹eq_evít
 *
cuº
, 
£¡bu¢o
);

1390 
mems_bus_ow√rshù_gø¡
 (
devno
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
);

1394 
devi˚_hódî
 
	gmems_hdr_öôülizî
 = {

1395 
DEVICETYPE_MEMS
,

1396 (
mems
),

1398 (*)
mems_c›y
,

1399 
mems_£t_dïth
,

1400 
mems_gë_dïth
,

1401 
mems_gë_öbus
,

1402 
mems_gë_bu¢o
,

1403 
mems_gë_¶Ÿno
,

1404 
mems_gë_numbî_of_blocks
,

1405 
mems_gë_maxout°™dög
,

1406 
mems_gë_numcyls
,

1407 
mems_gë_blkå™°ime
,

1408 
mems_gë_avg_£˘≥rcyl
,

1409 
mems_gë_m≠pög
,

1410 
mems_evít_¨rive
,

1411 
mems_gë_di°™˚
,

1412 
mems_gë_£rvtime
,

1413 
mems_gë_£ektime
,

1414 (*)
mems_unim∂emíãd
,

1415 
mems_bus_dñay_com∂ëe
,

1416 
mems_bus_ow√rshù_gø¡


	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_disksim.h

39 #i‚de‡
MEMS_DISKSIM_H


40 
	#MEMS_DISKSIM_H


	)

42 
mems_evít_¨rive
 (
i‹eq_evít
 *
cuº
);

43 
mems_bus_dñay_com∂ëe
 (
devno
, 
i‹eq_evít
 *
cuº
, 
£¡bu¢o
);

44 
mems_bus_ow√rshù_gø¡
 (
devno
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
);

46 
mems_˛ón°©s
 ();

47 
mems_gë_ac˘ime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
maxtime
);

48 
mems_gë_avg_£˘≥rcyl
 (
devno
);

49 
mems_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
);

50 
mems_gë_bu¢o
 (
i‹eq_evít
 *
cuº
);

51 
mems_gë_dïth
 (
devno
);

52 
mems_gë_öbus
 (
devno
);

53 
mems_gë_m≠pög
 (
m≠ty≥
, 
devno
, 
blkno
, *
cyÕå
, *
surÁ˚±r
, *
blk±r
);

54 
mems_gë_maxout°™dög
 (
devno
);

55 
mems_gë_numbî_of_blocks
 (
devno
);

56 
mems_gë_numcyls
 (
devno
);

57 
mems_gë_£ektime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
);

58 
mems_gë_£rvtime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
);

59 
mems_gë_¶Ÿno
 (
devno
);

60 
mems_öôülize
 ();

61 
mems_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

62 
mems_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
);

63 
mems_¥öt°©s
 ();

64 
mems_ªad_•ecs
 (
FILE
 *
∑rfûe
, 
devno
, 
c›õs
);

65 
mems_ªad_t›röts
 (
FILE
 *
∑rfûe
);

66 
mems_ª£t°©s
 ();

67 
mems_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
);

68 
mems_gë_di°™˚
 (
devno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
);

78 
devi˚_hódî
 
mems_hdr_öôülizî
;

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_event.c

39 
	~<°dio.h
>

40 
	~<°dlib.h
>

42 
	~"mems_globÆ.h
"

43 
	~"mems_disksim.h
"

44 
	~"mems_m≠pög.h
"

45 
	~"mems_öã∫Æs.h
"

46 
	~"mems_buf„r.h
"

48 
	~"disksim_bus.h
"

49 
	~"disksim_ioqueue.h
"

53 
	gmems_ªqöfo_mÆlocs
 = 0;

54 
	gmems_ªqöfo_‰ìs
 = 0;

56 
	gmems_exã¡_mÆlocs
 = 0;

57 
	gmems_exã¡_‰ìs
 = 0;

64 
	$mems_£nd_evít_up_∑th
 (
i‹eq_evít
 * 
cuº
,

65 
dñay
)

71 
mems_t
 *
dev
 = 
	`gëmems
(
cuº
->
devno
);

72 
bu¢o
 = 
	`mems_gë_bu¢o
(
cuº
);

73 
¶Ÿno
 = 
	`mems_gë_¶Ÿno
(
cuº
->
devno
);

76 
cuº
->
√xt
 = 
dev
->
buswaô
;

77 
dev
->
buswaô
 = 
cuº
;

78 
cuº
->
ãmpöt1
 = 
bu¢o
;

79 
cuº
->
time
 = 
dñay
;

81 i‡(
dev
->
busow√d
 == -1)

84 i‡(
	`bus_ow√rshù_gë
(
bu¢o
, 
¶Ÿno
, 
cuº
Ë=
FALSE
) {

89 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
cuº
->
devno
, 
dñay
, curr);

92 i‡(
dev
->
busow√d
 =
bu¢o
)

95 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
cuº
->
devno
, 
dñay
, curr);

99 
	`Ârötf
(
°dîr
, "Wrong bus owned forÅransfer desired!\n");

100 
	`exô
(1);

102 
	}
}

105 
	$mems_bus_ow√rshù_gø¡
 (
devno
,

106 
i‹eq_evít
 *
cuº
,

107 
bu¢o
,

108 
¨bdñay
)

110 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

111 
i‹eq_evít
 *
tmp
 = 
dev
->
buswaô
;

113 #ifde‡
VERBOSE_EVENTLOOP


114 
	`¥ötf
("Hi! I'm i¿mems_bus_ow√rshù_gø¡: %f\n", 
simtime
);

115 
	`fÊush
(
°dout
);

118 (
tmp
 !
NULL
Ë&& (tm∞!
cuº
)Ëtm∞tmp->
√xt
;

120 i‡(!
tmp
)

122 
	`Ârötf
(
°dîr
,

124 
devno
, 
bu¢o
);

125 
	`exô
(1);

128 
dev
->
busow√d
 = 
bu¢o
;

134 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
dev
->
devno
, 
tmp
->
time
, 
cuº
);

135 
	}
}

138 
	$mems_bus_dñay_com∂ëe
 (
devno
,

139 
i‹eq_evít
 *
cuº
,

140 
£¡bu¢o
)

142 
mems_t
 *
dev
 = 
	`gëmems
(
devno
);

143 
ötch¨
 
¶Ÿno
;

144 
ötch¨
 
bu¢o
;

145 
dïth
;

147 #ifde‡
VERBOSE_EVENTLOOP


148 
	`¥ötf
("Hñlo! I'm i¿mems_bus_dñay_com∂ëe: %f\n", 
simtime
);

149 
	`fÊush
(
°dout
);

152 
bu¢o
.
vÆue
 = 
cuº
->busno;

153 
¶Ÿno
.
vÆue
 = 
cuº
->slotno;

154 
dïth
 = 
	`mems_gë_dïth
(
cuº
->
devno
);

155 
¶Ÿno
.
byã
[
dïth
] = slotno.byte[depth] >> 4;

157 
cuº
->
time
 = ()0.0;

159 i‡(
cuº
 =
dev
->
buswaô
)

161 
dev
->
buswaô
 = 
cuº
->
√xt
;

165 
i‹eq_evít
 *
tmp
 = 
dev
->
buswaô
;

166 (
tmp
->
√xt
 !
NULL
Ë&& (tmp->√xà!
cuº
))Åmp =Åmp->next;

167 i‡(
tmp
->
√xt
 !
cuº
)

169 
	`Ârötf
(
°dîr
,

171 
devno
, 
bu¢o
.
vÆue
);

172 
	`exô
(1);

176 i‡(
dïth
 == 0)

178 
	`öå_ªque°
 ((
evít
 *)
cuº
);

182 
	`bus_dñivî_evít
 (
bu¢o
.
byã
[
dïth
], 
¶Ÿno
.byã[dïth], 
cuº
);

184 
	}
}

190 
mems_exã¡_t
 *

191 
	$mems_gë_√w_exã¡
(
i‹eq_evít
 *
cuº
)

193 
mems_exã¡_t
 *
√w_exã¡
 = (mems_exã¡_à*)
	`mÆloc
((mems_extent_t));

195 
mems_exã¡_mÆlocs
++;

197 
√w_exã¡
->
fú°block
 = 
cuº
->
blkno
;

198 
√w_exã¡
->
œ°block
 = 
cuº
->
blkno
 + cuº->
bcou¡
 - 1;

199 
√w_exã¡
->
com∂ëed_block_medü
 = -1;

200 
√w_exã¡
->
com∂ëed_block_bus
 = -1;

201 
√w_exã¡
->
bus_d⁄e
 = 
FALSE
;

202 
√w_exã¡
->
medü_d⁄e
 = 
FALSE
;

203 
√w_exã¡
->
√xt
 = 
NULL
;

204 
√w_exã¡
->
¥ev
 = 
NULL
;

205 
√w_exã¡
->
ªque°
 = 
cuº
;

206 
√w_exã¡
->
√xt_block_°¨t
 = -1;

207 
√w_exã¡
->
√xt_block_íd
 = -1;

209  
√w_exã¡
;

210 
	}
}

213 
	$mems_upd©e_ªqöfo
(
i‹eq_evít
 *
cuº
)

215 
mems_ªqöfo_t
 *
r
 = 
cuº
->
mems_ªqöfo
;

216 
mems_exã¡_t
 *
exã¡_±r
 = 
r
->
exã¡s
;

217 
i‹eq_evít
 *
evít_±r
;

218 
i‹eq_evít
 *
√xt_evít_±r
;

220 #ifde‡
VERBOSE_EVENTLOOP


221 
	`¥ötf
("mems_update_reqinfo --Éntry\n");

224 
evít_±r
 = 
cuº
;

226 
evít_±r
)

228 
√xt_evít_±r
 = 
evít_±r
->
b©ch_√xt
;

229 
	`‰ì
(((
mems_ªqöfo_t
 *)
evít_±r
->
mems_ªqöfo
)->
exã¡s
);

230 
mems_ªqöfo_‰ìs
++;

231 i‡(
evít_±r
->
mems_ªqöfo
 !
r
)

233 
	`‰ì
(
evít_±r
->
mems_ªqöfo
);

234 
mems_ªqöfo_‰ìs
++;

237 
evít_±r
 = 
√xt_evít_±r
;

240 
r
->
exã¡s
 = 
	`mems_gë_√w_exã¡
(
cuº
);

241 
r
->
num_exã¡s
 = 1;

243 
r
->
b©ch_¨rivÆ_time
 = 
cuº
->
time
;

245 #ifde‡
VERBOSE_EVENTLOOP


246 
	`¥ötf
("mems_upd©e_ªqöfÿ-- cuº->Êag†%d\n", 
cuº
->
Êags
);

264 
exã¡_±r
 = 
r
->
exã¡s
;

265 
evít_±r
 = 
cuº
->
b©ch_√xt
;

267 
evít_±r
 !
NULL
)

269 
exã¡_±r
->
√xt
 = 
	`mems_gë_√w_exã¡
(
evít_±r
);

270 
exã¡_±r
->
√xt
->
¥ev
 =Éxtent_ptr;

272 i‡((
evít_±r
->
Êags
 & 0x1Ë=
DISKSIM_WRITE
)

274 #ifde‡
VERBOSE_EVENTLOOP


275 
	`¥ötf
("mems_update_reqinfo --Åhis isá write\n");

277 
exã¡_±r
->
√xt
->
com∂ëed_block_bus
 =Éxã¡_±r->√xt->
œ°block
;

278 
exã¡_±r
->
√xt
->
bus_d⁄e
 = 
TRUE
;

279 #ifde‡
VERBOSE_EVENTLOOP


280 
	`¥ötf
("mems_update_reqinfo -- completed_block_bus = %d\n",

281 
exã¡_±r
->
√xt
->
com∂ëed_block_bus
);

284 
r
->
num_exã¡s
++;

285 i‡(
cuº
->
time
 < 
r
->
b©ch_¨rivÆ_time
)

287 
r
->
b©ch_¨rivÆ_time
 = 
cuº
->
time
;

289 
evít_±r
->
mems_ªqöfo
 = 
NULL
;

290 
evít_±r
 =Évít_±r->
b©ch_√xt
;

291 
exã¡_±r
 =Éxã¡_±r->
√xt
;

293 
	}
}

295 
mems_ªqöfo_t
 *

296 
	$mems_gë_√w_ªqöfo
 (
i‹eq_evít
 *
cuº
)

298 
i‹eq_evít
 *
evít_±r
;

299 
mems_exã¡_t
 *
exã¡_±r
;

302 
mems_ªqöfo_t
 *
r
 = (mems_ªqöfo_à*)
	`mÆloc
((mems_reqinfo_t));

303 
mems_ªqöfo_mÆlocs
++;

305 
exã¡_±r
 = 
r
->
exã¡s
;

307 
r
->
exã¡s
 = 
	`mems_gë_√w_exã¡
(
cuº
);

308 
r
->
num_exã¡s
 = 1;

310 
exã¡_±r
 = 
r
->
exã¡s
;

311 
evít_±r
 = 
cuº
;

313 
evít_±r
->
b©ch_√xt
 !
NULL
)

315 
evít_±r
 =Évít_±r->
b©ch_√xt
;

316 
exã¡_±r
->
√xt
 = 
	`mems_gë_√w_exã¡
(
evít_±r
);

317 
r
->
num_exã¡s
++;

320 
r
->
bus_≥ndög
 = 
FALSE
;

321 
r
->
bus_d⁄e
 = 
FALSE
;

322 
r
->
medü_d⁄e
 = 
FALSE
;

324 
r
->
bus_exã¡
 = 
NULL
;

326 
r
->
ªque°_íîgy_uj
 = 0.0;

327 
r
->
fú°£ek
 = 1;

328 
r
->
subåack_ac˚ss_num
 = 0;

329 
r
->
subåack_ac˚ss_tùs
 = 0;

331  
r
;

332 
	}
}

334 
mems_¥e„tch_öfo
 *

335 
	$mems_gë_¥e„tch_öfo
 (
i‹eq_evít
 *
cuº
)

337 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

338 
mems_ªqöfo_t
 *
ªqöfo
 = 
cuº
->
mems_ªqöfo
;

339 
mems_¥e„tch_öfo
 *
p
;

341 i‡(!
¶ed
->
¥e„tch_dïth
Ë 
NULL
;

343 
p
 = (
mems_¥e„tch_öfo
 *)
	`gë‰omexåaq
();

345 
p
->
fú°block
 = 
ªqöfo
->
œ°block
 + 1;

346 
p
->
œ°block
 =Ö->
fú°block
 + 
¶ed
->
¥e„tch_dïth
 - 1;

348 
p
->
com∂ëed_block
 = -1;

349 
p
->
√xt_block_°¨t
 = -1;

350 
p
->
√xt_block_íd
 = -1;

352  
p
;

353 
	}
}

357 
	$£nd_disc⁄√˘
 (
i‹eq_evít
 *
cuº
,

358 
œãncy
)

360 
i‹eq_evít
 *
öåp
 = 
	`i‹eq_c›y
(
cuº
);

361 
öåp
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

362 
öåp
->
ˇu£
 = 
DISCONNECT
;

363 
	`mems_£nd_evít_up_∑th
(
öåp
, 
œãncy
);

364 
	}
}

367 
	$£nd_com∂ëi⁄
 (
i‹eq_evít
 *
cuº
,

368 
œãncy
)

370 
i‹eq_evít
 *
öåp
 = 
	`i‹eq_c›y
(
cuº
);

371 
öåp
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

372 
öåp
->
ˇu£
 = 
COMPLETION
;

373 
	`mems_£nd_evít_up_∑th
(
öåp
, 
œãncy
);

374 
	}
}

377 
	$£nd_ªc⁄√˘
 (
i‹eq_evít
 *
cuº
,

378 
œãncy
)

380 
i‹eq_evít
 *
öåp
 = 
	`i‹eq_c›y
(
cuº
);

381 
öåp
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

382 
öåp
->
ˇu£
 = 
RECONNECT
;

383 
	`mems_£nd_evít_up_∑th
(
öåp
, 
œãncy
);

384 
	}
}

387 
	$mems_ªque°_com∂ëe
 (
i‹eq_evít
 *
cuº
,

388 
œãncy
)

390 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

391 
mems_ªqöfo_t
 *
ªqöfo
 = 
cuº
->
mems_ªqöfo
;

392 
i‹eq_evít
 *
b©ch_±r
;

393 
i‹eq_evít
 *
√xt_±r
;

395 #ifde‡
VERBOSE_EVENTLOOP


396 
	`¥ötf
("Entering mems_request_complete() - curr->blkno = %d,Åime = %f,Üatency = %f\n",

397 
cuº
->
blkno
, 
simtime
, 
œãncy
);

398 
	`fÊush
(
°dout
);

402 
mems_ªqöfo_t
 *
r
 = 
cuº
->
mems_ªqöfo
;

406 i‡(!
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
¶ed
->
queue
, 
cuº
))

408 
	`Ârötf
(
°dîr
, "mems_request_complete: sled ioreq_eventÇot found by ioqueue_physical_access_done call\n");

409 
	`exô
(1);

418 
	`£nd_com∂ëi⁄
(
cuº
, 
œãncy
);

421 i‡(
ªqöfo
 &&Ñeqöfo->
subåack_ac˚ss_num
)

428 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
ªque°_íîgy_uj
,

429 
ªqöfo
->
ªque°_íîgy_uj
);

430 
	`°©_upd©e
(&
¶ed
->
°©
.
ªque°_íîgy_uj
,

431 
ªqöfo
->
ªque°_íîgy_uj
);

433 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
subåack_ac˚s£s
,

434 
ªqöfo
->
subåack_ac˚ss_num
);

435 
	`°©_upd©e
(&
¶ed
->
°©
.
subåack_ac˚s£s
,

436 
ªqöfo
->
subåack_ac˚ss_num
);

438 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
tùs_≥r_ac˚ss
,

439 
ªqöfo
->
subåack_ac˚ss_tùs
 /Ñeqöfo->
subåack_ac˚ss_num
);

440 
	`°©_upd©e
(&
¶ed
->
°©
.
tùs_≥r_ac˚ss
,

441 
ªqöfo
->
subåack_ac˚ss_tùs
 /Ñeqöfo->
subåack_ac˚ss_num
);

443 
	}
}

446 
	$¥öt_exã¡_öfo
(
mems_ªqöfo_t
 *
ªqöfo
)

448 
i
;

449 
mems_exã¡_t
 *
exã¡_±r
;

451 
exã¡_±r
 = 
ªqöfo
->
exã¡s
;

453 
i
 = 0;

455 
exã¡_±r
 !
NULL
)

457 
	`¥ötf
("Éxtent %d, firstblock = %d,Üastblock = %d\n",

458 
i
, 
exã¡_±r
->
fú°block
,Éxã¡_±r->
œ°block
);

459 
	`¥ötf
("Çext_block_start = %d,Çext_block_end = %d\n",

460 
exã¡_±r
->
√xt_block_°¨t
,Éxã¡_±r->
√xt_block_íd
);

461 
	`¥ötf
(" completed_block_media = %d, completed_block_bus = %d\n",

462 
exã¡_±r
->
com∂ëed_block_medü
,Éxã¡_±r->
com∂ëed_block_bus
);

463 
	`¥ötf
(" media_done = %d, bus_done = %d\n",

464 
exã¡_±r
->
medü_d⁄e
,Éxã¡_±r->
bus_d⁄e
);

465 
exã¡_±r
 =Éxã¡_±r->
√xt
;

466 
i
++;

468 
	}
}

475 
	$mems_íîgy_upd©e_devi˚_ovîhód_com∂ëe_öa˘ive
(
mems_¶ed_t
 *
¶ed
)

477 
íîgy_j
;

480 
íîgy_j
 =

481 (
¶ed
->
öa˘ive_powî_mw
 * (
simtime
 - sÀd->
œ°ªq_com±ime
)) /

483 
¶ed
->
dev
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

484 
¶ed
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

486 
¶ed
->
dev
->
°©
.
öa˘ive_íîgy_j
 +
íîgy_j
;

487 
¶ed
->
°©
.
öa˘ive_íîgy_j
 +
íîgy_j
;

490 
íîgy_j
 =

491 (
¶ed
->
a˘ive_powî_mw
 * sÀd->
°¨tup_time_ms
) / 1000000.0;

492 
¶ed
->
dev
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

493 
¶ed
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

495 
¶ed
->
dev
->
°©
.
°¨tup_íîgy_j
 +
íîgy_j
;

496 
¶ed
->
°©
.
°¨tup_íîgy_j
 +
íîgy_j
;

499 
	}
}

502 
	$mems_íîgy_upd©e_devi˚_ovîhód_com∂ëe_a˘ive
(
mems_¶ed_t
 *
¶ed
,

503 
ñ≠£d_time
)

505 
íîgy_j
 = (
¶ed
->
a˘ive_powî_mw
 * 
ñ≠£d_time
) / 1000000.0;

507 
¶ed
->
dev
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

508 
¶ed
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

510 
¶ed
->
dev
->
°©
.
idÀ_íîgy_j
 +
íîgy_j
;

511 
¶ed
->
°©
.
idÀ_íîgy_j
 +
íîgy_j
;

512 
	}
}

515 
	$mems_íîgy_upd©e_¶ed_£ek
(
mems_¶ed_t
 *
¶ed
,

516 
timedñè
)

518 
íîgy_j
 = (
¶ed
->
a˘ive_powî_mw
 * 
timedñè
) / 1000000.0;

520 
¶ed
->
dev
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

521 
¶ed
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

522 i‡(
¶ed
->
a˘ive_ªque°
)

524 
mems_ªqöfo_t
 *
ªqöfo
 = 
¶ed
->
a˘ive_ªque°
->
mems_ªqöfo
;

525 
ªqöfo
->
ªque°_íîgy_uj
 +
íîgy_j
 * 1000000.0;

528 i‡(
¶ed
->
a˘ive_ªque°
 || sÀd->
¥e„tch_öfo
)

530 
¶ed
->
dev
->
°©
.
£rvicög_íîgy_j
 +
íîgy_j
;

531 
¶ed
->
°©
.
£rvicög_íîgy_j
 +
íîgy_j
;

535 
¶ed
->
dev
->
°©
.
idÀ_íîgy_j
 +
íîgy_j
;

536 
¶ed
->
°©
.
idÀ_íîgy_j
 +
íîgy_j
;

538 
	}
}

541 
	$mems_íîgy_upd©e_¶ed_£rvo
(
mems_¶ed_t
 *
¶ed
,

542 
timedñè
)

546 
num_tùs
 = 
¶ed
->
tù£t
.num_tips;

547 
íîgy_j
 =

548 ((
¶ed
->
a˘ive_powî_mw
 * 
timedñè
) +

549 (
¶ed
->
tù_powî_mw
 * 
num_tùs
 * 
timedñè
)) / 1000000.0;

551 
¶ed
->
dev
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

552 
¶ed
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

553 i‡(
¶ed
->
a˘ive_ªque°
)

555 
mems_ªqöfo_t
 *
ªqöfo
 = 
¶ed
->
a˘ive_ªque°
->
mems_ªqöfo
;

556 
num_tùs_ªq
 = 
¶ed
->
tù_£˘‹s_≥r_lbn
 *

557 (
ªqöfo
->
√xt_block_íd
 -Ñeqöfo->
√xt_block_°¨t
 + 1);

558 
íîgy_j_ªq
 =

559 ((
¶ed
->
a˘ive_powî_mw
 * 
timedñè
) +

560 (
¶ed
->
tù_powî_mw
 * 
num_tùs_ªq
 * 
timedñè
)) / 1000000.0;

562 
ªqöfo
->
ªque°_íîgy_uj
 +
íîgy_j_ªq
 * 1000000.0;

565 i‡(
¶ed
->
a˘ive_ªque°
 || sÀd->
¥e„tch_öfo
)

567 
¶ed
->
dev
->
°©
.
£rvicög_íîgy_j
 +
íîgy_j
;

568 
¶ed
->
°©
.
£rvicög_íîgy_j
 +
íîgy_j
;

572 
¶ed
->
dev
->
°©
.
idÀ_íîgy_j
 +
íîgy_j
;

573 
¶ed
->
°©
.
idÀ_íîgy_j
 +
íîgy_j
;

575 
	}
}

578 
	$mems_íîgy_upd©e_¶ed_d©a
(
mems_¶ed_t
 *
¶ed
,

579 
timedñè
)

583 
num_tùs
 = 
¶ed
->
tù£t
.num_tips;

584 
íîgy_j
 =

585 ((
¶ed
->
a˘ive_powî_mw
 * 
timedñè
) +

586 (
¶ed
->
tù_powî_mw
 * 
num_tùs
 * 
timedñè
)) / 1000000.0;

588 
¶ed
->
dev
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

589 
¶ed
->
°©
.
tŸÆ_íîgy_j
 +
íîgy_j
;

591 i‡(
¶ed
->
a˘ive_ªque°
)

593 
mems_ªqöfo_t
 *
ªqöfo
 = 
¶ed
->
a˘ive_ªque°
->
mems_ªqöfo
;

594 
num_tùs_ªq
 = 
¶ed
->
tù_£˘‹s_≥r_lbn
 *

595 (
ªqöfo
->
√xt_block_íd
 -Ñeqöfo->
√xt_block_°¨t
 + 1);

596 
íîgy_j_ªq
 =

597 ((
¶ed
->
a˘ive_powî_mw
 * 
timedñè
) +

598 (
¶ed
->
tù_powî_mw
 * 
num_tùs_ªq
 * 
timedñè
)) / 1000000.0;

600 
ªqöfo
->
ªque°_íîgy_uj
 +
íîgy_j_ªq
 * 1000000.0;

603 
¶ed
->
dev
->
°©
.
£rvicög_íîgy_j
 +
íîgy_j
;

604 
¶ed
->
°©
.
£rvicög_íîgy_j
 +
íîgy_j
;

605 
	}
}

612 
	$mems_io_ac˚ss_¨rive
(
i‹eq_evít
 *
cuº
)

614 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

615 
mems_t
 *
dev
 = 
	`gëmems
(
cuº
->
devno
);

617 #ifde‡
VERBOSE_EVENTLOOP


618 
	`¥ötf
("\nIO_ACCESS_ARRIVE: %f -- %s for %d(%d), batchno = %d, batch_complete = %d\n",

619 
simtime
, (
cuº
->
Êags
 & 
READ
Ë? "R" : "W", cuº->
blkno
, cuº->
bcou¡
, cuº->
b©chno
, cuº->
b©ch_com∂ëe
);

620 
	`fÊush
(
°dout
);

627 
cuº
->
b©ch_√xt
 = 
NULL
;

628 
cuº
->
b©ch_¥ev
 = 
NULL
;

629 
cuº
->
b©ch_size
 = 0;

631 
cuº
->
mems_¶ed
 = 
	`mems_lbn_to_¶ed
(
dev
, cuº->
blkno
);

632 
cuº
->
mems_ªqöfo
 = 
	`mems_gë_√w_ªqöfo
(curr);

634 
dev
->
busow√d
 = 
	`mems_gë_bu¢o
(
cuº
);

636 
cuº
->
time
 = 
simtime
 + 
dev
->
ovîhód
;

637 
cuº
->
ty≥
 = 
DEVICE_OVERHEAD_COMPLETE
;

638 
	`addtoötq
((
evít
 *)
cuº
);

639 
	}
}

642 
	$mems_devi˚_ovîhód_com∂ëe
(
i‹eq_evít
 *
cuº
)

644 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

645 
mems_t
 *
dev
 = 
	`gëmems
(
cuº
->
devno
);

647 #ifde‡
VERBOSE_EVENTLOOP


648 
	`¥ötf
("\nDEVICE_OVERHEAD_COMPLETE: %f\n", 
simtime
);

649 
	`fÊush
(
°dout
);

653 
	`ioqueue_add_√w_ªque°
(
¶ed
->
queue
, 
cuº
);

661 i‡(!(
cuº
->
Êags
 & 
READ
))

663 
i‹eq_evít
 *
bu§eq
 = 
	`i‹eq_c›y
(
cuº
);

664 #ifde‡
VERBOSE_EVENTLOOP


665 
	`¥ötf
("\¿addögá MEMS_BUS_INITIATEÉvíàtÿthêötq: %f\n", 
simtime
);

666 
	`fÊush
(
°dout
);

668 
bu§eq
->
ty≥
 = 
MEMS_BUS_INITIATE
;

669 
bu§eq
->
time
 = 
simtime
;

670 
	`addtoötq
((
evít
 *)
bu§eq
);

671 ((
mems_ªqöfo_t
 *)(
cuº
->
mems_ªqöfo
))->
bus_≥ndög
 = 
TRUE
;

691 
mems_ªqöfo_t
 *
ªqöfo
 = 
cuº
->
mems_ªqöfo
;

692 
mems_exã¡_t
 *
exã¡_±r
 = 
ªqöfo
->
exã¡s
;

694 i‡(
	`mems_buf„r_check
(
exã¡_±r
->
fú°block
,

695 
exã¡_±r
->
œ°block
, 
¶ed
->
dev
)) {

697 
	`ioqueue_gë_•ecific_ªque°
(
¶ed
->
queue
, 
cuº
);

698 
exã¡_±r
->
com∂ëed_block_medü
 =Éxã¡_±r->
œ°block
;

699 
exã¡_±r
->
medü_d⁄e
 = 
TRUE
;

701 
i‹eq_evít
 *
bu§eq
 = 
	`i‹eq_c›y
(
cuº
);

702 
bu§eq
->
ty≥
 = 
MEMS_BUS_INITIATE
;

703 
bu§eq
->
time
 = 
simtime
;

704 
	`addtoötq
((
evít
 *)
bu§eq
);

705 
ªqöfo
->
bus_≥ndög
 = 
TRUE
;

707 
	`addt€xåaq
((
evít
 *)
cuº
);

712 i‡(!
¶ed
->
dev
->
d©ax„r_ªq
)

714 
	`£nd_disc⁄√˘
(
cuº
, 0.0);

733 i‡(!
¶ed
->
dev
->
d©ax„r_ªq
)

735 
	`£nd_disc⁄√˘
(
cuº
, 0.0);

744 i‡((
cuº
->
b©chno
 =0Ë|| (cuº->
b©ch_com∂ëe
 =
TRUE
))

748 i‡(
¶ed
->
a˘ive
 =
MEMS_SLED_INACTIVE
)

750 
i‹eq_evít
 *
r
 = (i‹eq_evíà*)
	`gë‰omexåaq
();

753 
r
->
devno
 = 
cuº
->devno;

755 
r
->
ty≥
 = 
MEMS_SLED_SCHEDULE
;

756 
r
->
time
 = 
simtime
 + 
¶ed
->
°¨tup_time_ms
;

758 
r
->
mems_¶ed
 = 
¶ed
;

759 
	`addtoötq
((
evít
 *)
r
);

761 
¶ed
->
a˘ive
 = 
MEMS_SLED_ACTIVE
;

764 
¶ed
->
°©
.
num_•öups
++;

765 
¶ed
->
dev
->
°©
.
num_•öups
++;

766 
	`°©_upd©e
(&
¶ed
->
°©
.
öa˘ive_time
,

767 (
simtime
 - 
¶ed
->
œ°ªq_com±ime
));

768 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
öa˘ive_time
,

769 (
simtime
 - 
¶ed
->
œ°ªq_com±ime
));

772 
	`mems_íîgy_upd©e_devi˚_ovîhód_com∂ëe_öa˘ive
(
¶ed
);

774 i‡(
¶ed
->
a˘ive
 =
MEMS_SLED_IDLE
)

777 
co‹d_t
 *
upd©e_co‹d
;

778 
ñ≠£d_time
;

779 
swìp_time
;

780 
À·ovî_time
;

781 
exåa_swìps
;

782 
exåa_di°™˚
;

783 
¶ed_Àngth_bôs
;

785 
i‹eq_evít
 *
r
 = (i‹eq_evíà*)
	`gë‰omexåaq
();

787 
r
->
devno
 = 
cuº
->devno;

789 
r
->
ty≥
 = 
MEMS_SLED_SCHEDULE
;

790 
r
->
time
 = 
simtime
;

793 
	`ªmove‰omötq
((
evít
 *)
¶ed
->
a˘ive_ªque°
);

794 
¶ed
->
a˘ive_ªque°
 = 
NULL
;

797 
upd©e_co‹d
 = 
	`mems_gë_cuºít_posôi⁄
(
¶ed
);

799 
ñ≠£d_time
 = 
simtime
 - 
¶ed
->
œ°ªq_com±ime
;

800 
swìp_time
 =

801 
	`föd_tu∫¨ound_time
((
¶ed
->
y_Àngth_nm
 / 2),

802 
¶ed
->
y_ac˚ss_•ìd_bô_s
 * sÀd->
bô_Àngth_nm
,

803 
¶ed
->
x_ac˚l_nm_s2
,

804 
¶ed
->
•rög_Á˘‹
,

805 
¶ed
->
y_Àngth_nm
);

806 
swìp_time
 +=

807 
¶ed
->
y_Àngth_nm
 / sÀd->
y_ac˚ss_•ìd_bô_s
 * sÀd->
bô_Àngth_nm
;

809 
À·ovî_time
 = 
	`fmod
(
ñ≠£d_time
, 
swìp_time
);

810 
exåa_swìps
 = ()(
À·ovî_time
 / 
swìp_time
);

812 
¶ed_Àngth_bôs
 = 
¶ed
->
y_Àngth_nm
 / sÀd->
bô_Àngth_nm
;

814 
exåa_di°™˚
 =

815 ()(
exåa_swìps
 * ()(
¶ed
->
y_Àngth_nm
)Ë/ sÀd->
bô_Àngth_nm
;

817 i‡(
upd©e_co‹d
->
y_vñ
 > 0)

820 
upd©e_co‹d
->
y_pos
 +
exåa_di°™˚
;

822 i‡(
	`abs
(
upd©e_co‹d
->
y_pos
Ë> (
¶ed_Àngth_bôs
 / 2))

825 
upd©e_co‹d
->
y_pos
 =

826 ((
¶ed_Àngth_bôs
 / 2)

828 (
upd©e_co‹d
->
y_pos
 - (
¶ed_Àngth_bôs
 / 2)));

829 
upd©e_co‹d
->
y_vñ
 = -update_coord->y_vel;

836 
upd©e_co‹d
->
y_pos
 -
exåa_di°™˚
;

838 i‡(
	`abs
(
upd©e_co‹d
->
y_pos
Ë> (
¶ed_Àngth_bôs
 / 2))

841 
upd©e_co‹d
->
y_pos
 =

842 ((-
¶ed_Àngth_bôs
 / 2)

844 (
	`abs
(
upd©e_co‹d
->
y_pos
Ë- (
¶ed_Àngth_bôs
 / 2)));

845 
upd©e_co‹d
->
y_vñ
 = -update_coord->y_vel;

848 
	`mems_commô_move
(
¶ed
, 
upd©e_co‹d
);

850 
r
->
mems_¶ed
 = 
¶ed
;

851 
	`addtoötq
((
evít
 *)
r
);

852 
¶ed
->
a˘ive
 = 
MEMS_SLED_ACTIVE
;

854 
	`mems_íîgy_upd©e_devi˚_ovîhód_com∂ëe_a˘ive
(
¶ed
,

855 
ñ≠£d_time
);

858 
	}
}

861 
	$mems_¶ed_scheduÀ
(
i‹eq_evít
 *
cuº
)

863 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

864 
mems_t
 *
dev
 = 
	`gëmems
(
cuº
->
devno
);

865 
i‹eq_evít
 *
ﬁd_a˘ive_ªque°
;

867 #ifde‡
VERBOSE_EVENTLOOP


868 
	`¥ötf
("MEMS_SLED_SCHEDULE: %f\n", 
simtime
);

869 
	`fÊush
(
°dout
);

872 i‡((
¶ed
->
a˘ive
 =
MEMS_SLED_IDLE
)

874 (
cuº
->
time
 >
¶ed
->
œ°ªq_com±ime
 + sÀd->
öa˘ive_dñay_ms
))

878 
¶ed
->
œ°ªq_com±ime
 = 
cuº
->
time
;

882 
	`mems_lbn_to_posôi⁄
(
	`mems_˚¡îmo°_lbn
(
¶ed
),

883 
¶ed
,

884 &
¶ed
->
co‹d£t_up
,

885 &
¶ed
->
co‹d£t_dn
,

886 &
¶ed
->
tù£t
,

887 
NULL
, NULL, NULL);

888 
	`mems_co‹d_t_c›y
(&
¶ed
->
co‹d£t_up
.
£rvo_°¨t
, &¶ed->
pos
);

889 
¶ed
->
a˘ive
 = 
MEMS_SLED_INACTIVE
;

890 
¶ed
->
a˘ive_ªque°
 = 
NULL
;

891 
	`addt€xåaq
((
evít
 *)
cuº
);

894 
¶ed
->
°©
.
num_•ödowns
++;

895 
¶ed
->
dev
->
°©
.
num_•ödowns
++;

900 i‡((
¶ed
->
a˘ive
 =
MEMS_SLED_IDLE
)

902 (
cuº
->
time
 < 
¶ed
->
œ°ªq_com±ime
 + sÀd->
öa˘ive_dñay_ms
))

906 
¶ed
->
a˘ive
 = 
MEMS_SLED_ACTIVE
;

908 
	`ªmove‰omötq
((
evít
 *)
¶ed
->
a˘ive_ªque°
);

909 
¶ed
->
a˘ive_ªque°
 = 
NULL
;

913 i‡(!
¶ed
->
a˘ive_ªque°
)

915 
¶ed
->
a˘ive_ªque°
 = 
	`ioqueue_gë_√xt_ªque°
(¶ed->
queue
);

916 i‡(
¶ed
->
a˘ive_ªque°
)

933 i‡(
¶ed
->
a˘ive_ªque°
->
b©ch_√xt
 !
NULL
)

936 
	`mems_upd©e_ªqöfo
(
¶ed
->
a˘ive_ªque°
);

937 #ifde‡
VERBOSE_EVENTLOOP


938 
	`¥öt_exã¡_öfo
(
¶ed
->
a˘ive_ªque°
->
mems_ªqöfo
);

942 
ﬁd_a˘ive_ªque°
 = 
¶ed
->
a˘ive_ªque°
;

943 
¶ed
->
a˘ive_ªque°
 = 
	`i‹eq_c›y
(sled->active_request);

944 
ﬁd_a˘ive_ªque°
->
mems_ªqöfo
 = 
NULL
;

962 i‡(
¶ed
->
a˘ive_ªque°
->
Êags
 & 
READ
)

971 i‡(
¶ed
->
a˘ive_ªque°
)

973 
exã¡
;

974 
block
;

975 
œ°block
;

976 
mems_ªqöfo_t
 *
ªqöfo
;

977 
°¨ãd_m≠pög
 = 
FALSE
;

978 
tù£˘‹_co‹d_£t_t
 
tmp_co‹d£t_up
, 
tmp_co‹d£t_dn
;

979 
tù£t
 
tmp_tù£t
;

980 
tù£˘‹_co‹d_£t_t
 
fú°_co‹d£t_up
, 
fú°_co‹d£t_dn
;

981 
tù£t
 
fú°_tù£t
;

982 
mems_exã¡_t
 *
exã¡_±r
;

984 
ªqöfo
 = 
¶ed
->
a˘ive_ªque°
->
mems_ªqöfo
;

986 #ifde‡
VERBOSE_EVENTLOOP


987 
	`¥ötf
("MEMS_SLED_SCHEDULE:: before\n");

988 
	`¥öt_exã¡_öfo
(
ªqöfo
);

992 
exã¡_±r
 = 
ªqöfo
->
exã¡s
;

994 
exã¡
 = 0;Éxã¡ < 
ªqöfo
->
num_exã¡s
;Éxtent++)

996 i‡(
exã¡_±r
->
medü_d⁄e
 =
TRUE
)

998 
exã¡_±r
 =Éxã¡_±r->
√xt
;

1002 i‡(
exã¡_±r
->
com∂ëed_block_medü
 == -1)

1004 
exã¡_±r
->
√xt_block_°¨t
 =Éxã¡_±r->
fú°block
;

1008 
exã¡_±r
->
√xt_block_°¨t
 =Éxã¡_±r->
com∂ëed_block_medü
 + 1;

1013 i‡(
°¨ãd_m≠pög
 =
FALSE
)

1015 
	`mems_lbn_to_posôi⁄
(
exã¡_±r
->
√xt_block_°¨t
,

1016 
¶ed
,

1017 &
¶ed
->
co‹d£t_up
,

1018 &
¶ed
->
co‹d£t_dn
,

1019 &
¶ed
->
tù£t
,

1020 
NULL
, NULL, NULL);

1022 
¶ed
->
tù£t
.
num_tùs
 = 0;

1023 
°¨ãd_m≠pög
 = 
TRUE
;

1027 
	`mems_lbn_to_posôi⁄
(
exã¡_±r
->
√xt_block_°¨t
,

1028 
¶ed
,

1029 &
exã¡_±r
->
co‹d£t_up
,

1030 &
exã¡_±r
->
co‹d£t_dn
,

1031 &
exã¡_±r
->
tù£t
,

1032 
NULL
, NULL, NULL);

1034 i‡(
	`mems_equÆ_co‹d_£ts
(&
¶ed
->
co‹d£t_up
,

1035 &
exã¡_±r
->
co‹d£t_up
Ë=
FALSE
)

1037 
exã¡_±r
->
√xt_block_°¨t
 = -1;

1038 
exã¡_±r
->
√xt_block_íd
 = -1;

1039 
exã¡_±r
 =Éxã¡_±r->
√xt
;

1043 i‡(
¶ed
->
tù£t
.
num_tùs
 + 
exã¡_±r
->tipset.num_tips

1045 
¶ed
->
tùs_simu…™eous
)

1047 
exã¡_±r
->
√xt_block_°¨t
 = -1;

1048 
exã¡_±r
->
√xt_block_íd
 = -1;

1049 
exã¡_±r
 =Éxã¡_±r->
√xt
;

1053 
¶ed
->
tù£t
.
num_tùs
 +
exã¡_±r
->tipset.num_tips;

1054 
exã¡_±r
->
√xt_block_íd
 =Éxã¡_±r->
√xt_block_°¨t
;

1058 
block
 = 
exã¡_±r
->
√xt_block_íd
 + 1;

1059 
block
 <
exã¡_±r
->
œ°block
;

1060 
block
++)

1064 i‡(!(
¶ed
->
a˘ive_ªque°
->
Êags
 & 
READ
) &&

1065 (
block
 > 
exã¡_±r
->
com∂ëed_block_bus
))

1070 
	`mems_lbn_to_posôi⁄
(
block
,

1071 
¶ed
,

1072 &
tmp_co‹d£t_up
,

1073 &
tmp_co‹d£t_dn
,

1074 &
tmp_tù£t
,

1075 
NULL
, NULL, NULL);

1080 i‡(
	`mems_equÆ_co‹d_£ts
(&
¶ed
->
co‹d£t_up
,

1081 &
tmp_co‹d£t_up
Ë=
FALSE
)

1088 i‡(
¶ed
->
tù£t
.
num_tùs
 + 
tmp_tù£t
.num_tips

1090 
¶ed
->
tùs_simu…™eous
)

1095 
¶ed
->
tù£t
.
num_tùs
 +
tmp_tù£t
.num_tips;

1096 
exã¡_±r
->
√xt_block_íd
 = 
block
;

1098 
exã¡_±r
 =Éxã¡_±r->
√xt
;

1114 i‡(
cuº
->
time
 < 
¶ed
->
œ°ªq_com±ime
 + sÀd->
öa˘ive_dñay_ms
)

1117 
¶ed
->
œ°ªq_com±ime
 = 
cuº
->
time
;

1118 
¶ed
->
a˘ive
 = 
MEMS_SLED_IDLE
;

1119 
¶ed
->
a˘ive_ªque°
 = 
cuº
;

1121 
cuº
->
ty≥
 = 
MEMS_SLED_SCHEDULE
;

1122 
cuº
->
time
 = 
simtime
 + 
¶ed
->
öa˘ive_dñay_ms
;

1123 
	`addtoötq
((
evít
 *)
cuº
);

1126 i‡(
cuº
->
time


1128 
¶ed
->
œ°ªq_com±ime
 + sÀd->
öa˘ive_dñay_ms
)

1132 
¶ed
->
œ°ªq_com±ime
 = 
cuº
->
time
;

1136 
	`mems_lbn_to_posôi⁄
(
	`mems_˚¡îmo°_lbn
(
¶ed
), sÀd, &¶ed->
co‹d£t_up
,

1137 &
¶ed
->
co‹d£t_dn
, &¶ed->
tù£t
,

1138 
NULL
, NULL, NULL);

1139 
	`mems_co‹d_t_c›y
(&
¶ed
->
co‹d£t_up
.
£rvo_°¨t
, &¶ed->
pos
);

1140 
¶ed
->
a˘ive
 = 
MEMS_SLED_INACTIVE
;

1141 
	`addt€xåaq
((
evít
 *)
cuº
);

1144 
¶ed
->
°©
.
num_•ödowns
++;

1145 
¶ed
->
dev
->
°©
.
num_•ödowns
++;

1152 #ifde‡
VERBOSE_EVENTLOOP


1153 
	`¥ötf
("MEMS_SLED_SCHEDULE::áfter\n");

1154 
	`¥öt_exã¡_öfo
(
¶ed
->
a˘ive_ªque°
->
mems_ªqöfo
);

1157 
cuº
->
ty≥
 = 
MEMS_SLED_SEEK
;

1158 
	`addtoötq
((
evít
 *)
cuº
);

1159 
	}
}

1162 
	$mems_upd©e_£ek_°©s
(
£ek_time
,

1163 
x_£ek_time
,

1164 
y_£ek_time
,

1165 
tu∫¨ound_time
,

1166 
num_tu∫¨ounds
,

1167 
mems_¶ed_t
 *
¶ed
)

1169 i‡(
¶ed
->
a˘ive_ªque°
)

1171 
mems_ªqöfo_t
 *
ªqöfo
 = 
¶ed
->
a˘ive_ªque°
->
mems_ªqöfo
;

1173 
ªqöfo
->
subåack_ac˚ss_num
++;

1175 
ªqöfo
->
subåack_ac˚ss_tùs
 +
¶ed
->
tù_£˘‹s_≥r_lbn
 *

1176 (
ªqöfo
->
√xt_block_íd
 -Ñeqöfo->
√xt_block_°¨t
 + 1);

1178 i‡(
ªqöfo
->
fú°£ek
)

1180 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
£ek_time
, seek_time);

1181 
	`°©_upd©e
(&
¶ed
->
°©
.
£ek_time
, seek_time);

1182 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
x_£ek_time
, x_seek_time);

1183 
	`°©_upd©e
(&
¶ed
->
°©
.
x_£ek_time
, x_seek_time);

1184 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
y_£ek_time
, y_seek_time);

1185 
	`°©_upd©e
(&
¶ed
->
°©
.
y_£ek_time
, y_seek_time);

1187 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
tu∫¨ound_time
,Åurnaround_time);

1188 
	`°©_upd©e
(&
¶ed
->
°©
.
tu∫¨ound_time
,Åurnaround_time);

1189 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
tu∫¨ound_numbî
, 
num_tu∫¨ounds
);

1190 
	`°©_upd©e
(&
¶ed
->
°©
.
tu∫¨ound_numbî
, 
num_tu∫¨ounds
);

1192 
¶ed
->
dev
->
°©
.
num_öôül_tu∫¨ounds
 +
num_tu∫¨ounds
;

1193 
¶ed
->
°©
.
num_öôül_tu∫¨ounds
 +
num_tu∫¨ounds
;

1202 
ªqöfo
->
fú°£ek
 = 0;

1204 i‡(
num_tu∫¨ounds
 != 0)

1206 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
°ªam_tu∫¨ound_time
, 
tu∫¨ound_time
);

1207 
	`°©_upd©e
(&
¶ed
->
°©
.
°ªam_tu∫¨ound_time
, 
tu∫¨ound_time
);

1208 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
°ªam_tu∫¨ound_numbî
, 
num_tu∫¨ounds
);

1209 
	`°©_upd©e
(&
¶ed
->
°©
.
°ªam_tu∫¨ound_numbî
, 
num_tu∫¨ounds
);

1211 
¶ed
->
dev
->
°©
.
num_°ªam_tu∫¨ounds
 +
num_tu∫¨ounds
;

1212 
¶ed
->
°©
.
num_°ªam_tu∫¨ounds
 +
num_tu∫¨ounds
;

1221 
	}
}

1224 
	$mems_¶ed_£ek
(
i‹eq_evít
 *
cuº
)

1226 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

1227 
	edúe˘i⁄_íum
 { 
UP
, 
DOWN
 } 
dúe˘i⁄
;

1228 
time_up
, 
x_up
, 
y_up
, 
to_up
;

1229 
time_dn
 = 0.0;

1230 
x_dn
, 
y_dn
, 
to_dn
;

1231 
num_up
, 
num_dn
;

1232 
timedñè
;

1234 #ifde‡
VERBOSE_EVENTLOOP


1235 
	`¥ötf
("MEMS_SLED_SEEK: %f\n", 
simtime
);

1236 
	`fÊush
(
°dout
);

1239 
time_up
 = 
	`mems_£ek_time_£ekˇche
(
¶ed
, &¶ed->
pos
,

1240 &
¶ed
->
co‹d£t_up
.
£rvo_°¨t
,

1241 &
x_up
, &
y_up
, &
to_up
, &
num_up
);

1248 i‡(
¶ed
->
bidúe˘i⁄Æ_ac˚ss
)

1250 
time_dn
 = 
	`mems_£ek_time_£ekˇche
(
¶ed
, &¶ed->
pos
,

1251 &
¶ed
->
co‹d£t_dn
.
£rvo_°¨t
,

1252 &
x_dn
, &
y_dn
, &
to_dn
, &
num_dn
);

1255 i‡(!
¶ed
->
bidúe˘i⁄Æ_ac˚ss
)

1257 
dúe˘i⁄
 = 
UP
;

1259 i‡(
time_up
 < 
time_dn
)

1261 
dúe˘i⁄
 = 
UP
;

1265 
dúe˘i⁄
 = 
DOWN
;

1275 i‡(
dúe˘i⁄
 =
UP
)

1277 
timedñè
 = 
time_up
;

1278 
	`mems_tù£˘‹_co‹d_£t_t_c›y
(&
¶ed
->
co‹d£t_up
, &¶ed->
co‹d£t
);

1279 
	`mems_upd©e_£ek_°©s
(
time_up
, 
x_up
, 
y_up
, 
to_up
, 
num_up
, 
¶ed
);

1283 
timedñè
 = 
time_dn
;

1284 
	`mems_tù£˘‹_co‹d_£t_t_c›y
(&
¶ed
->
co‹d£t_dn
, &¶ed->
co‹d£t
);

1285 
	`mems_upd©e_£ek_°©s
(
time_dn
, 
x_dn
, 
y_dn
, 
to_dn
, 
num_dn
, 
¶ed
);

1291 
cuº
->
ty≥
 = 
MEMS_SLED_SERVO
;

1292 
cuº
->
time
 +
timedñè
;

1293 
	`addtoötq
((
evít
 *)
cuº
);

1294 
	`mems_commô_move
(
¶ed
, &¶ed->
co‹d£t
.
£rvo_°¨t
);

1297 
	`mems_íîgy_upd©e_¶ed_£ek
(
¶ed
, 
timedñè
);

1298 
	}
}

1301 
	$mems_¶ed_£rvo
(
i‹eq_evít
 *
cuº
)

1303 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

1304 
timedñè
;

1306 #ifde‡
VERBOSE_EVENTLOOP


1307 
	`¥ötf
("MEMS_SLED_SERVO: %f\n", 
simtime
);

1308 
	`fÊush
(
°dout
);

1319 
timedñè
 = 
	`mems_medü_ac˚ss_time
(
¶ed
, &¶ed->
pos
,

1320 &
¶ed
->
co‹d£t
.
tù£˘‹_°¨t
);

1323 i‡(
¶ed
->
a˘ive_ªque°
 || sÀd->
¥e„tch_öfo
)

1325 
cuº
->
ty≥
 = 
MEMS_SLED_DATA
;

1329 
cuº
->
ty≥
 = 
MEMS_SLED_SCHEDULE
;

1340 i‡(
¶ed
->
a˘ive_ªque°
)

1342 
mems_ªqöfo_t
 *
ªqöfo
 = 
¶ed
->
a˘ive_ªque°
->
mems_ªqöfo
;

1343 
mems_exã¡_t
 *
exã¡_±r
 = 
ªqöfo
->
exã¡s
;

1344 
i
;

1345 
d©a_to_wrôe
 = 
TRUE
;

1347 
i
 = 0; i < 
ªqöfo
->
num_exã¡s
; i++)

1349 i‡(!(
exã¡_±r
->
ªque°
->
Êags
 & 
READ
) &&

1350 (
exã¡_±r
->
√xt_block_°¨t
 >Éxã¡_±r->
com∂ëed_block_bus
))

1352 
d©a_to_wrôe
 = 
FALSE
;

1356 
d©a_to_wrôe
 = 
TRUE
;

1358 
exã¡_±r
 =Éxã¡_±r->
√xt
;

1360 i‡(
d©a_to_wrôe
 =
FALSE
)

1362 
cuº
->
ty≥
 = 
MEMS_SLED_SCHEDULE
;

1365 
¶ed
->
tù£t
.
num_tùs
 = 1;

1371 
cuº
->
time
 +
timedñè
;

1372 
	`addtoötq
((
evít
 *)
cuº
);

1373 
	`mems_commô_move
(
¶ed
, &¶ed->
co‹d£t
.
tù£˘‹_°¨t
);

1376 
	`mems_íîgy_upd©e_¶ed_£rvo
(
¶ed
, 
timedñè
);

1377 
	}
}

1380 
	$mems_¶ed_d©a
(
i‹eq_evít
 *
cuº
)

1382 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

1383 
timedñè
;

1385 #ifde‡
VERBOSE_EVENTLOOP


1386 
	`¥ötf
("MEMS_SLED_DATA: %f\n", 
simtime
);

1397 
timedñè
 = 
	`mems_medü_ac˚ss_time
(
¶ed
, &¶ed->
pos
,

1398 &
¶ed
->
co‹d£t
.
tù£˘‹_íd
);

1400 
cuº
->
ty≥
 = 
MEMS_SLED_UPDATE
;

1401 
cuº
->
time
 +
timedñè
;

1402 
	`addtoötq
((
evít
 *)
cuº
);

1403 
	`mems_commô_move
(
¶ed
, &¶ed->
co‹d£t
.
tù£˘‹_íd
);

1406 
	`mems_íîgy_upd©e_¶ed_d©a
(
¶ed
, 
timedñè
);

1407 
	}
}

1410 
	$mems_¶ed_upd©e
(
i‹eq_evít
 *
cuº
)

1412 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

1414 #ifde‡
VERBOSE_EVENTLOOP


1415 
	`¥ötf
("MEMS_SLED_UPDATE: %f\n", 
simtime
);

1416 
	`fÊush
(
°dout
);

1419 i‡(
¶ed
->
a˘ive_ªque°
)

1421 
mems_ªqöfo_t
 *
ªqöfo
 = 
¶ed
->
a˘ive_ªque°
->
mems_ªqöfo
;

1422 
exã¡
;

1423 
mems_exã¡_t
 *
exã¡_±r
;

1424 
mems_exã¡_t
 *
√xt_exã¡
;

1425 
Æl_medü_d⁄e
 = 
TRUE
;

1426 
num_öôül_exã¡s
 = 
ªqöfo
->
num_exã¡s
;

1428 #ifde‡
VERBOSE_EVENTLOOP


1429 
	`¥ötf
("MEMS_SLED_UPDATE:: before\n");

1430 
	`¥öt_exã¡_öfo
(
ªqöfo
);

1433 
exã¡_±r
 = 
ªqöfo
->
exã¡s
;

1435 
exã¡
 = 0;Éxã¡ < 
num_öôül_exã¡s
;Éxtent++)

1437 
œãncy
 = 0.0;

1438 
√xt_exã¡
 = 
exã¡_±r
->
√xt
;

1439 
exã¡_±r
->
com∂ëed_block_medü
 =Éxã¡_±r->
√xt_block_íd
;

1441 i‡(
exã¡_±r
->
ªque°
->
Êags
 & 
READ
) {

1442 
	`mems_buf„r_ö£π
(
exã¡_±r
->
√xt_block_°¨t
,

1443 
exã¡_±r
->
√xt_block_íd
, 
¶ed
->
dev
);

1448 i‡((
exã¡_±r
->
ªque°
->
Êags
 & 
READ
) &&

1449 (
ªqöfo
->
bus_≥ndög
 =
FALSE
))

1451 
i‹eq_evít
 *
bu§eq
 = 
	`i‹eq_c›y
(
¶ed
->
a˘ive_ªque°
);

1452 
bu§eq
->
ty≥
 = 
MEMS_BUS_INITIATE
;

1453 
bu§eq
->
time
 = 
simtime
;

1454 
	`addtoötq
((
evít
 *)
bu§eq
);

1455 
ªqöfo
->
bus_≥ndög
 = 
TRUE
;

1456 
	`as£π
(
exã¡_±r
->
bus_d⁄e
 =
FALSE
);

1459 i‡(
exã¡_±r
->
com∂ëed_block_medü
 >exã¡_±r->
œ°block
)

1461 
exã¡_±r
->
medü_d⁄e
 = 
TRUE
;

1465 i‡(
exã¡_±r
->
bus_d⁄e
 =
TRUE
)

1467 i‡(
exã¡_±r
->
¥ev
)

1469 
exã¡_±r
->
¥ev
->
√xt
 =Éxtent_ptr->next;

1473 
ªqöfo
->
exã¡s
 = 
exã¡_±r
->
√xt
;

1475 i‡(
exã¡_±r
->
√xt
)

1477 
exã¡_±r
->
√xt
->
¥ev
 =Éxtent_ptr->prev;

1479 
ªqöfo
->
num_exã¡s
--;

1480 i‡(
ªqöfo
->
num_exã¡s
 == 0)

1484 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
b©ch_ª•⁄£_time
,

1485 (
simtime
 - 
ªqöfo
->
b©ch_¨rivÆ_time
));

1486 
	`°©_upd©e
(&
¶ed
->
°©
.
b©ch_ª•⁄£_time
,

1487 (
simtime
 - 
ªqöfo
->
b©ch_¨rivÆ_time
));

1492 
œãncy
 += 0.001;

1493 
	`mems_ªque°_com∂ëe
(
exã¡_±r
->
ªque°
, 
œãncy
);

1494 
	`addt€xåaq
((
evít
 *)
exã¡_±r
->
ªque°
);

1495 
	`‰ì
(
exã¡_±r
);

1496 
mems_exã¡_‰ìs
++;

1502 
Æl_medü_d⁄e
 = 
FALSE
;

1505 #ifde‡
VERBOSE_EVENTLOOP


1506 
	`¥ötf
("media completed = %d,Üast = %d\n",

1507 
exã¡_±r
->
com∂ëed_block_medü
,Éxã¡_±r->
œ°block
);

1508 
	`fÊush
(
°dout
);

1511 
exã¡_±r
 = 
√xt_exã¡
;

1514 #ifde‡
VERBOSE_EVENTLOOP


1515 
	`¥ötf
("MEMS_SLED_UPDATE::áfter\n");

1516 
	`¥öt_exã¡_öfo
(
ªqöfo
);

1521 i‡(
Æl_medü_d⁄e
 =
TRUE
)

1523 
	`addt€xåaq
((
evít
 *)
¶ed
->
a˘ive_ªque°
);

1524 
¶ed
->
œ°ªq_com±ime
 = 
cuº
->
time
;

1525 
¶ed
->
a˘ive_ªque°
 = 
NULL
;

1530 
cuº
->
ty≥
 = 
MEMS_SLED_SCHEDULE
;

1531 
	`addtoötq
((
evít
 *)
cuº
);

1532 
	}
}

1535 
	$mems_io_öãºu±_com∂ëe
(
i‹eq_evít
 *
cuº
)

1537 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

1538 
mems_t
 *
dev
 = 
	`gëmems
(
cuº
->
devno
);

1540 #ifde‡
VERBOSE_EVENTLOOP


1541 i‡(
cuº
->
ˇu£
==
DISCONNECT
Ë
	`¥ötf
("IO_INTERRUPT_DISCONNECT: %f\n", 
simtime
);

1542 i‡(
cuº
->
ˇu£
==
COMPLETION
Ë
	`¥ötf
("IO_INTERRUPT_COMPLETION: %f\n", 
simtime
);

1543 i‡(
cuº
->
ˇu£
==
RECONNECT
Ë
	`¥ötf
("IO_INTERRUPT_RECONNECT: %f\n", 
simtime
);

1544 
	`fÊush
(
°dout
);

1547 
cuº
->
ˇu£
)

1550 
DISCONNECT
:

1551 
	`addt€xåaq
((
evít
 *)
cuº
);

1552 i‡(
dev
->
busow√d
 != -1)

1554 
	`bus_ow√rshù_ªÀa£
(
dev
->
busow√d
);

1555 
dev
->
busow√d
 = -1;

1559 
COMPLETION
:

1562 i‡(
cuº
->
mems_ªqöfo
)

1564 
	`‰ì
(
cuº
->
mems_ªqöfo
);

1565 
mems_ªqöfo_‰ìs
++;

1568 
	`addt€xåaq
((
evít
 *)
cuº
);

1569 i‡(
dev
->
busow√d
 != -1)

1571 
	`bus_ow√rshù_ªÀa£
(
dev
->
busow√d
);

1572 
dev
->
busow√d
 = -1;

1576 
RECONNECT
:

1577 
	`addt€xåaq
((
evít
 *)
cuº
);

1578 
dev
->
d©ax„r_ªq
->
ty≥
 = 
MEMS_BUS_TRANSFER
;

1579 
dev
->
d©ax„r_ªq
->
time
 = 
simtime
;

1580 
	`addtoötq
((
evít
 *)
dev
->
d©ax„r_ªq
);

1584 
	`Ârötf
(
°dîr
,

1586 
cuº
->
ˇu£
);

1587 
	`exô
(1);

1589 
	}
}

1592 
	$mems_bus_öôüã
(
i‹eq_evít
 *
cuº
)

1594 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

1595 
mems_t
 *
dev
 = 
	`gëmems
(
cuº
->
devno
);

1596 
mems_ªqöfo_t
 *
ªqöfo
 = 
cuº
->
mems_ªqöfo
;

1597 
mems_exã¡_t
 *
exã¡_±r
;

1598 
num_exã¡s
;

1599 
i
;

1601 #ifde‡
VERBOSE_EVENTLOOP


1602 
	`¥ötf
("MEMS_BUS_INITIATE: %f\n", 
simtime
);

1603 
	`fÊush
(
°dout
);

1607 i‡(
ªqöfo
->
bus_exã¡
 =
NULL
)

1609 
exã¡_±r
 = 
ªqöfo
->
exã¡s
;

1610 
num_exã¡s
 = 
ªqöfo
->num_extents;

1612 
i
 = 0; i < 
num_exã¡s
; i++)

1614 i‡(
exã¡_±r
->
com∂ëed_block_bus
 == -1)

1616 
ªqöfo
->
bus_exã¡
 = 
exã¡_±r
;

1621 
exã¡_±r
 =Éxã¡_±r->
√xt
;

1630 i‡(!
dev
->
d©ax„r_ªq
)

1633 
dev
->
d©ax„r_ªq
 = 
cuº
;

1634 
	`£nd_ªc⁄√˘
(
cuº
, 0.0);

1640 
i‹eq_evít
 *
tmp
 = 
dev
->
d©ax„r_queue
;

1641 i‡(!
dev
->
d©ax„r_queue
)

1643 
dev
->
d©ax„r_queue
 = 
cuº
;

1644 
cuº
->
¥ev
 = 
NULL
;

1645 
cuº
->
√xt
 = 
NULL
;

1649 
tmp
->
√xt
)Åmp =Åmp->next;

1650 
tmp
->
√xt
 = 
cuº
;

1651 
cuº
->
¥ev
 = 
tmp
;

1652 
cuº
->
√xt
 = 
NULL
;

1655 
	}
}

1658 
	$mems_bus_å™s„r
(
i‹eq_evít
 *
cuº
)

1660 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

1662 #ifde‡
VERBOSE_EVENTLOOP


1663 
	`¥ötf
("MEMS_BUS_TRANSFER: %f\n", 
simtime
);

1664 
	`fÊush
(
°dout
);

1666 
cuº
->
ty≥
 = 
MEMS_BUS_UPDATE
;

1669 
cuº
->
time
 = 
simtime
 + 
	`devi˚_gë_blkå™°ime
(curr);

1670 
	`addtoötq
((
evít
 *)
cuº
);

1671 
	}
}

1674 
	$mems_bus_upd©e
(
i‹eq_evít
 *
cuº
)

1676 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

1677 
mems_t
 *
dev
 = 
	`gëmems
(
cuº
->
devno
);

1678 
mems_ªqöfo_t
 *
ªqöfo
 = 
cuº
->
mems_ªqöfo
;

1679 
mems_exã¡_t
 *
exã¡_±r
;

1680 
mems_exã¡_t
 *
bus_exã¡
;

1681 
exã¡
;

1682 
num_exã¡s
;

1683 
i§ód
;

1685 #ifde‡
VERBOSE_EVENTLOOP


1686 
	`¥ötf
("MEMS_BUS_UPDATE: %f\n", 
simtime
);

1687 
	`fÊush
(
°dout
);

1690 
bus_exã¡
 = 
ªqöfo
->bus_extent;

1691 
i§ód
 = (
bus_exã¡
->
ªque°
->
Êags
 & 
READ
);

1694 i‡(
bus_exã¡
->
com∂ëed_block_bus
 == -1)

1696 
bus_exã¡
->
com∂ëed_block_bus
 = bus_exã¡->
fú°block
;

1700 
bus_exã¡
->
com∂ëed_block_bus
++;

1704 i‡(!
i§ód
) {

1705 
	`mems_buf„r_ö£π
(
bus_exã¡
->
com∂ëed_block_bus
,

1706 
bus_exã¡
->
com∂ëed_block_bus
, 
dev
);

1709 #ifde‡
VERBOSE_EVENTLOOP


1710 
	`¥ötf
("bus completed = %d,Üast = %d\n",

1711 
bus_exã¡
->
com∂ëed_block_bus
,

1712 
bus_exã¡
->
œ°block
);

1713 
	`fÊush
(
°dout
);

1717 i‡(
bus_exã¡
->
com∂ëed_block_bus
 >bus_exã¡->
œ°block
)

1719 
bus_exã¡
->
bus_d⁄e
 = 
TRUE
;

1720 
ªqöfo
->
bus_exã¡
 = 
NULL
;

1722 #ifde‡
VERBOSE_EVENTLOOP


1723 
	`¥ötf
("set bus_extent->bus_doneÅo be TRUE\n");

1724 
	`fÊush
(
°dout
);

1729 i‡(
bus_exã¡
->
medü_d⁄e
 =
TRUE
)

1731 i‡(
bus_exã¡
->
¥ev
)

1733 
bus_exã¡
->
¥ev
->
√xt
 = bus_extent->next;

1737 
ªqöfo
->
exã¡s
 = 
bus_exã¡
->
√xt
;

1739 i‡(
bus_exã¡
->
√xt
)

1741 
bus_exã¡
->
√xt
->
¥ev
 = bus_extent->prev;

1743 
ªqöfo
->
num_exã¡s
--;

1744 i‡(
ªqöfo
->
num_exã¡s
 == 0)

1748 
	`°©_upd©e
(&
¶ed
->
dev
->
°©
.
b©ch_ª•⁄£_time
,

1749 (
simtime
 - 
ªqöfo
->
b©ch_¨rivÆ_time
));

1750 
	`°©_upd©e
(&
¶ed
->
°©
.
b©ch_ª•⁄£_time
,

1751 (
simtime
 - 
ªqöfo
->
b©ch_¨rivÆ_time
));

1753 
	`mems_ªque°_com∂ëe
(
bus_exã¡
->
ªque°
, 0.0);

1754 
	`addt€xåaq
((
evít
 *)
bus_exã¡
->
ªque°
);

1755 
	`‰ì
(
bus_exã¡
);

1756 
mems_exã¡_‰ìs
++;

1761 #ifde‡
VERBOSE_EVENTLOOP


1762 
	`¥ötf
("reqinfo->num_extents = %d\n",

1763 
ªqöfo
->
num_exã¡s
);

1764 
	`fÊush
(
°dout
);

1766 
exã¡_±r
 = 
ªqöfo
->
exã¡s
;

1768 
exã¡_±r
 !
NULL
)

1770 #ifde‡
VERBOSE_EVENTLOOP


1771 
	`¥ötf
("firstblock = %d, completed_block_bus = %d,Ñequest_type = %s, completed_block_media = %d\n",

1772 
exã¡_±r
->
fú°block
,

1773 
exã¡_±r
->
com∂ëed_block_bus
,

1774 (((
exã¡_±r
->
ªque°
->
Êags
 & 0x1Ë=
DISKSIM_READ
) ? ("R") : ("W")),

1775 
exã¡_±r
->
com∂ëed_block_medü
);

1776 
	`fÊush
(
°dout
);

1778 i‡(
exã¡_±r
->
com∂ëed_block_bus
 == -1)

1780 i‡(((
exã¡_±r
->
ªque°
->
Êags
 & 0x1Ë=
DISKSIM_READ
)

1782 (
exã¡_±r
->
com∂ëed_block_medü
 != -1))

1786 i‡((
exã¡_±r
->
ªque°
->
Êags
 & 0x1Ë=
DISKSIM_WRITE
)

1791 
exã¡_±r
 =Éxã¡_±r->
√xt
;

1794 #ifde‡
VERBOSE_EVENTLOOP


1795 i‡(
exã¡_±r
)

1797 
	`¥ötf
("selectedÉxtent for block %dásÅheÇext busÅransfer\n",

1798 
exã¡_±r
->
fú°block
);

1799 
	`fÊush
(
°dout
);

1803 
	`¥ötf
("extent_ptr is NULL!\n");

1804 
	`fÊush
(
°dout
);

1808 i‡(!
exã¡_±r
)

1810 
dev
->
d©ax„r_ªq
 = 
NULL
;

1811 
ªqöfo
->
bus_≥ndög
 = 
FALSE
;

1812 i‡(
i§ód
 && (
ªqöfo
->
exã¡s
 =
NULL
))

1814 
	`‰ì
(
ªqöfo
);

1815 
mems_ªqöfo_‰ìs
++;

1821 
ªqöfo
->
bus_exã¡
 = 
exã¡_±r
;

1827 i‡((
bus_exã¡
->
ªque°
->
Êags
 & 
READ
) &&

1828 (
bus_exã¡
->
com∂ëed_block_bus
 >=

1829 
bus_exã¡
->
com∂ëed_block_medü
))

1834 
dev
->
d©ax„r_ªq
 = 
NULL
;

1835 
ªqöfo
->
bus_≥ndög
 = 
FALSE
;

1842 i‡(!
dev
->
d©ax„r_ªq
)

1844 i‡(
dev
->
d©ax„r_queue
)

1847 
dev
->
d©ax„r_ªq
 = dev->
d©ax„r_queue
;

1848 
dev
->
d©ax„r_queue
 = dev->d©ax„r_queue->
√xt
;

1849 i‡(
dev
->
d©ax„r_queue
Ëdev->d©ax„r_queue->
¥ev
 = 
NULL
;

1850 
dev
->
d©ax„r_ªq
->
√xt
 = 
NULL
;

1855 
	`£nd_ªc⁄√˘
(
dev
->
d©ax„r_ªq
, 0.000001);

1859 
	`£nd_disc⁄√˘
(
cuº
, 0.000001);

1861 
	`addt€xåaq
((
evít
 *)
cuº
);

1864 
cuº
->
ty≥
 = 
MEMS_BUS_TRANSFER
;

1865 
	`addtoötq
((
evít
 *)
cuº
);

1866 
	}
}

1869 
	$mems_io_qÀn_maxcheck
(
i‹eq_evít
 *
cuº
)

1871 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

1874 
cuº
->
ãmpöt1
 = -1;

1875 
cuº
->
ãmpöt2
 = 
	`mems_gë_maxout°™dög
(cuº->
devno
);

1876 
cuº
->
bcou¡
 = 0;

1877 
	}
}

1885 
	$mems_evít_¨rive
 (
i‹eq_evít
 *
cuº
)

1887 
mems_¶ed_t
 *
¶ed
 = 
cuº
->
mems_¶ed
;

1888 
timedñè
;

1890 
cuº
->
ty≥
)

1893 
IO_ACCESS_ARRIVE
:

1894 
	`mems_io_ac˚ss_¨rive
(
cuº
);

1897 
DEVICE_OVERHEAD_COMPLETE
:

1898 
	`mems_devi˚_ovîhód_com∂ëe
(
cuº
);

1901 
MEMS_SLED_SCHEDULE
:

1902 
	`mems_¶ed_scheduÀ
(
cuº
);

1905 
MEMS_SLED_SEEK
:

1906 
	`mems_¶ed_£ek
(
cuº
);

1909 
MEMS_SLED_SERVO
:

1910 
	`mems_¶ed_£rvo
(
cuº
);

1913 
MEMS_SLED_DATA
:

1914 
	`mems_¶ed_d©a
(
cuº
);

1917 
MEMS_SLED_UPDATE
:

1918 
	`mems_¶ed_upd©e
(
cuº
);

1921 
IO_INTERRUPT_COMPLETE
:

1922 
	`mems_io_öãºu±_com∂ëe
(
cuº
);

1925 
MEMS_BUS_INITIATE
:

1926 
	`mems_bus_öôüã
(
cuº
);

1929 
MEMS_BUS_TRANSFER
:

1930 
	`mems_bus_å™s„r
(
cuº
);

1933 
MEMS_BUS_UPDATE
:

1934 
	`mems_bus_upd©e
(
cuº
);

1937 
IO_QLEN_MAXCHECK
:

1938 
	`mems_io_qÀn_maxcheck
(
cuº
);

1942 
	`Ârötf
(
°dîr
, "Unknow¿ty≥Éncou¡îed i¿mems_evít_¨rivê(%d)\n", 
cuº
->
ty≥
);

1943 
	`exô
(1);

1945 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_global.h

33 #i‚de‡
_MEMS_GLOBAL_H_


34 
	#_MEMS_GLOBAL_H_


	)

36 
	~"disksim_globÆ.h
"

37 
	~"disksim_iosim.h
"

38 
	~"disksim_°©.h
"

40 
	#MEMS_MAXSLEDS
 9

	)

41 
	#MEMS_SEEKCACHE
 2

	)

43 
	#gëmems
(
d
Ë(
disksim
->
memsöfo
->
devi˚s
[d])

	)

45 
	#MEMS_SLED_INACTIVE
 0

	)

46 
	#MEMS_SLED_IDLE
 1

	)

47 
	#MEMS_SLED_ACTIVE
 2

	)

49 
	#MEMS_SEEK_PIECEWISE
 0

	)

50 
	#MEMS_SEEK_HONG
 1

	)

52 
	sco‹d
 {

53 
	mx_pos
;

54 
	my_pos
;

55 
	my_vñ
;

56 } 
	tco‹d_t
;

58 
	stù£˘‹_co‹d_£t
 {

59 
co‹d_t
 
	m£rvo_°¨t
;

60 
co‹d_t
 
	mtù£˘‹_°¨t
;

61 
co‹d_t
 
	mtù£˘‹_íd
;

62 } 
	ttù£˘‹_co‹d_£t_t
;

64 
	stù£t
 {

65 
	mtù_°¨t
;

66 
	mtù_íd
;

67 
	mnum_tùs
;

68 } 
	ttù£t_t
;

72 
	smems_¥e„tch_öfo
 {

73 
	mfú°block
;

74 
	mœ°block
;

76 
	mcom∂ëed_block
;

77 
	m√xt_block_°¨t
;

78 
	m√xt_block_íd
;

83 
	smems_£ekˇche
 {

84 
	mtime
;

85 
co‹d_t
 
	mbegö
;

86 
co‹d_t
 
	míd
;

87 
	mx_£ek_time
;

88 
	my_£ek_time
;

89 
	mtu∫¨ound_time
;

90 
	mtu∫¨ound_numbî
;

94 
	smems_£gmít
 {

95 
	mtime
;

96 
mems_£gmít
 *
	m√xt
;

97 
mems_£gmít
 *
	m¥ev
;

98 
	m°¨tblkno
;

99 
	mídblkno
;

103 
	smems_°©
 {

104 
°©gí
 
	mªque°_íîgy_uj
;

105 
	mtŸÆ_íîgy_j
;

106 
	m£rvicög_íîgy_j
;

107 
	m°¨tup_íîgy_j
;

108 
	midÀ_íîgy_j
;

109 
	möa˘ive_íîgy_j
;

111 
°©gí
 
	m£ek_time
;

112 
°©gí
 
	mx_£ek_time
;

113 
°©gí
 
	my_£ek_time
;

115 
	mnum_öôül_tu∫¨ounds
;

117 
°©gí
 
	mtu∫¨ound_time
;

118 
°©gí
 
	mtu∫¨ound_numbî
;

120 
	mnum_°ªam_tu∫¨ounds
;

122 
°©gí
 
	m°ªam_tu∫¨ound_time
;

123 
°©gí
 
	m°ªam_tu∫¨ound_numbî
;

125 
°©gí
 
	msubåack_ac˚s£s
;

126 
°©gí
 
	mtùs_≥r_ac˚ss
;

128 
	mnum_•öups
;

129 
	mnum_•ödowns
;

130 
°©gí
 
	möa˘ive_time
;

132 
	mnum_buf„r_ac˚s£s
;

133 
	mnum_buf„r_hôs
;

135 
°©gí
 
	m¥e„tched_blocks
;

136 
°©gí
 
	mb©ch_ª•⁄£_time
;

142 
mems
 *
	mdev
;

144 
	ma˘ive
;

145 
	mnumblocks
;

147 
mems_°©
 
	m°©
;

149 
ioq
 *
	mqueue
;

150 
i‹eq_evít
 *
	ma˘ive_ªque°
;

151 
mems_¥e„tch_öfo
 *
	m¥e„tch_öfo
;

152 
	m¥e„tch_dïth
;

154 
	mœ°ªq_com±ime
;

155 
	möa˘ive_dñay_ms
;

156 
	m°¨tup_time_ms
;

157 
	mœ°ªq_lbn
;

159 
co‹d_t
 
	mpos
;

160 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t
;

161 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_up
;

162 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_dn
;

163 
tù£t
 
	mtù£t
;

165 
	mœyout_pﬁicy
;

166 
	mx_Àngth_nm
;

167 
	my_Àngth_nm
;

169 
	mbô_Àngth_nm
;

170 
	mtù_£˘‹_Àngth_bôs
;

171 
	m£rvo_bur°_Àngth_bôs
;

172 
	mtù_£˘‹s_≥r_lbn
;

174 
	mtùs_ußbÀ
;

175 
	mtùs_simu…™eous
;

176 
	mbidúe˘i⁄Æ_ac˚ss
;

177 
	mx_ac˚l_nm_s2
;

178 
	my_ac˚l_nm_s2
;

180 
	my_ac˚ss_•ìd_bô_s
;

181 
	m¶ed_ªs⁄™t_‰eq_hz
;

182 
	mnum_time_c⁄°™ts
;

183 
	m•rög_Á˘‹
;

188 
mems_£ekˇche
 
	m£ekˇche
[
MEMS_SEEKCACHE
];

189 
	m£ekˇche_√xt
;

191 
	ma˘ive_powî_mw
;

192 
	möa˘ive_powî_mw
;

193 
	mtù_powî_mw
;

194 } 
	tmems_¶ed_t
;

197 
	smems
 {

198 
devi˚_hódî
 
	mhdr
;

199 
	mdevno
;

200 
	möôed
;

202 
mems_°©
 
	m°©
;

204 
	movîhód
;

205 
	mblkå™°ime
;

206 
	m¥öt°©s
;

207 
	mmaxqÀn
;

208 
	mnumblocks
;

210 
	mdïth
[
MAXINBUSES
];

211 
	möbu£s
[
MAXINBUSES
];

212 
	m¶Ÿno
[
MAXINBUSES
];

213 
	mnumöbu£s
;

215 
	mbusow√d
;

216 
i‹eq_evít
 *
	mbuswaô
;

217 
ioq
 *
	mqueue
;

218 
i‹eq_evít
 *
	md©ax„r_ªq
;

219 
i‹eq_evít
 *
	md©ax„r_queue
;

221 
mems_¶ed_t
 *
	m¶ed
;

222 
	mnum_¶eds
;

224 
	mnum£gs
;

225 
	m£gsize
;

226 
mems_£gmít
 *
	m£gli°
;

228 
	m£ek_fun˘i⁄
;

230 
	m¥ecompuã_£ek_cou¡
;

231 *
	m¥ecompuã_£ek_di°™˚s
;

232 *
	m¥ecompuã_x_£ek_times
;

233 *
	m¥ecompuã_y_£ek_times
;

235 } 
	tmems_t
;

238 
	smems_öfo
 {

239 
mems_t
 **
	mdevi˚s
;

240 
	mnumdevi˚s
;

241 
	mdevi˚s_Àn
;

244 
	smems_x
 {

245 
	mfú°block
;

246 
	mœ°block
;

248 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_up
;

249 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_dn
;

250 
tù£t_t
 
	mtù£t
;

251 
	mfú°block_cylödî
, 
	mfú°block_surÁ˚
, 
	mfú°block_block
;

253 
tù£˘‹_co‹d_£t_t
 
	mœ°block_up_co‹d_£t
;

254 
tù£˘‹_co‹d_£t_t
 
	mœ°block_dn_co‹d_£t
;

255 
tù£t_t
 
	mœ°block_tù£t
;

256 
	mœ°block_cylödî
, 
	mœ°block_surÁ˚
, 
	mœ°block_block
;

258 
	mcom∂ëed_block_medü
;

259 
	mcom∂ëed_block_bus
;

260 
	m√xt_block_°¨t
;

261 
	m√xt_block_íd
;

263 
	mbus_d⁄e
;

264 
	mmedü_d⁄e
;

266 
mems_x
 *
	m√xt
;

267 
mems_x
 *
	m¥ev
;

268 
i‹eq_evít
 *
	mªque°
;

269 } 
	tmems_exã¡_t
;

272 
	mfú°block
;

273 
	mœ°block
;

275 
	mb©ch_¨rivÆ_time
;

277 
mems_exã¡_t
 *
	mexã¡s
;

278 
	mnum_exã¡s
;

280 
mems_exã¡_t
 *
	mbus_exã¡
;

282 
	mbus_≥ndög
;

283 
	mbus_d⁄e
;

284 
	mmedü_d⁄e
;

286 
	mcom∂ëed_block_medü
;

287 
	mcom∂ëed_block_bus
;

288 
	m√xt_block_°¨t
;

289 
	m√xt_block_íd
;

292 
	mªque°_íîgy_uj
;

293 
	mfú°£ek
;

294 
	msubåack_ac˚ss_num
;

295 
	msubåack_ac˚ss_tùs
;

296 } 
	tmems_ªqöfo_t
;

298 
mems
* 
memsmodñ_mems_lﬂd∑øms
(
Õ_block
* 
b
, * 
num±r
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_hong_seek.c

1 
	~<°dlib.h
>

2 
	~<°dio.h
>

3 
	~<m©h.h
>

5 
	~"mems_h⁄g_£ek.h
"

7 
	#_VERBOSE_
 0

	)

10 
	$dmö
(
x
, 
y
) {

11  (
x
 < 
y
) ? x : y;

12 
	}
}

15 
	$dmax
(
x
, 
y
) {

16  (
x
 > 
y
) ? x : y;

17 
	}
}

20 
	$föd_m
(
x0
, 
x1
,

21 
•rög_Á˘‹
,

22 
Àngth_nm
) {

24 
kFx
;

25 
m
;

27 
kFx
 = 
•rög_Á˘‹
 / 
Àngth_nm
;

29 
m
 = ((
x0
 + 
x1
) / 2)

31 ((
kFx
 / 4Ë* (
x1
*x1 - 
x0
*x0));

33  
m
;

34 
	}
}

37 
	$föd_£ek_time_h⁄g_x
(
°¨t_off£t_nm
, 
íd_off£t_nm
,

38 
•rög_Á˘‹
, 
ac˚Àøti⁄_nm_s_s
,

39 
Àngth_nm
)

41 
xm
;

42 
mkx
;

43 
tx
;

45 
x0
 = 
°¨t_off£t_nm
 / 1e9;

46 
x1
 = 
íd_off£t_nm
 / 1e9;

47 
l
 = 
Àngth_nm
 / 1e9;

48 
a
 = 
ac˚Àøti⁄_nm_s_s
 / 1e9;

50 
ãmp_tx
;

52 
x0
 = 
	`dmö
(
°¨t_off£t_nm
, 
íd_off£t_nm
);

53 
x1
 = 
	`dmax
(
°¨t_off£t_nm
, 
íd_off£t_nm
);

55 
x0
 /= 1e9;

56 
x1
 /= 1e9;

58 
xm
 = 
	`föd_m
(
x0
, 
x1
, 
•rög_Á˘‹
, 
l
);

60 i‡(
_VERBOSE_
) {

61 
	`¥ötf
("find_seek_time_hong_x -- xm = %0.10Lf\n",

62 
xm
);

65 i‡(
•rög_Á˘‹
 == 0.0) {

66 
mkx
 = 0.0;

68 i‡(
_VERBOSE_
) {

69 
	`¥ötf
("l = %0.10Lf, spring_factor = %0.10Lf,á = %0.10Lf\n",

70 
l
, 
•rög_Á˘‹
, 
a
);

72 
mkx
 = 
l
 / (
•rög_Á˘‹
 * 
a
);

75 
tx
 = 0.0;

77 
ãmp_tx
 =

78 
	`sqπ
(
mkx
)

80 
	`acos
(

81 (
xm
 - 
a
*
mkx
)

83 (
x0
 - 
a
*
mkx
)

86 
tx
 +
ãmp_tx
;

88 i‡(
_VERBOSE_
) {

89 
	`¥ötf
("(1)Åemp_tx = %0.10Lf,Åx = %0.10Lf\n",

90 
ãmp_tx
, 
tx
);

93 
ãmp_tx
 =

94 
	`sqπ
(
mkx
)

96 
	`acos
(

97 (
xm
 + 
a
*
mkx
)

99 (
x1
 + 
a
*
mkx
)

102 
tx
 +
ãmp_tx
;

104 i‡(
_VERBOSE_
) {

105 
	`¥ötf
("(2)Åemp_tx = %0.10Lf,Åx = %0.10Lf\n",

106 
ãmp_tx
, 
tx
);

107 
	`¥ötf
("find_seek_time_hong_x --Åx = %0.10Lf\n",

108 
tx
);

111  
tx
;

112 
	}
}

115 
	$föd_£ek_time_h⁄g_y
(
°¨t_off£t_nm
, 
íd_off£t_nm
,

116 
•rög_Á˘‹
, 
ac˚Àøti⁄_nm_s_s
,

117 
Àngth_nm
, 
vñocôy_nm_s
) {

119 
ym
;

120 
mk
;

121 
ty
;

123 
y0
 = 
°¨t_off£t_nm
 / 1e9;

124 
y1
 = 
íd_off£t_nm
 / 1e9;

125 
l
 = 
Àngth_nm
 / 1e9;

126 
a
 = 
ac˚Àøti⁄_nm_s_s
 / 1e9;

127 
v
 = 
vñocôy_nm_s
 / 1e9;

129 
Ø
, 
bb
, 
cc
;

131 
ãmp_ty
;

133 i‡(
_VERBOSE_
) {

134 
	`¥ötf
("find_seek_time_hong_y --á = %0.10Lf, v = %0.10Lf, spring_factor = %0.10Lf\n",

135 
a
, 
v
, 
•rög_Á˘‹
);

138 
y0
 = 
	`dmö
(
°¨t_off£t_nm
, 
íd_off£t_nm
);

139 
y1
 = 
	`dmax
(
°¨t_off£t_nm
, 
íd_off£t_nm
);

141 
y0
 /= 1e9;

142 
y1
 /= 1e9;

144 i‡(
_VERBOSE_
) {

145 
	`¥ötf
("find_seek_time_hong_y -- y0 = %0.10Lf, y1 = %0.10Lf\n",

146 
y0
, 
y1
);

149 
ym
 = 
	`föd_m
(
y0
, 
y1
, 
•rög_Á˘‹
, 
l
);

151 i‡(
_VERBOSE_
) {

152 
	`¥ötf
("find_seek_time_hong_y -- ym = %0.10Lf\n",

153 
ym
);

156 i‡(
•rög_Á˘‹
 == 0.0) {

157 
mk
 = 0.0;

159 i‡(
_VERBOSE_
) {

160 
	`¥ötf
("l = %0.10Lf, spring_factor = %0.10Lf,á = %0.10Lf\n",

161 
l
, 
•rög_Á˘‹
, 
a
);

163 
mk
 = 
l
 / (
•rög_Á˘‹
 * 
a
);

166 i‡(
_VERBOSE_
) {

167 
	`¥ötf
("find_seek_time_hong -- mk = %0.10Lf\n",

168 
mk
);

171 
ty
 = 0.0;

173 
ãmp_ty
 =

174 
	`sqπ
(
mk
)

176 
	`asö
(

177 (
ym
 - 
a
*
mk
)

179 
	`sqπ
(

180 (
y0
 - 
a
*
mk
)*(y0 -á*mk)

182 (
v
 * 
	`sqπ
(
mk
))*(v * sqrt(mk))

186 
ty
 +
ãmp_ty
;

188 i‡(
_VERBOSE_
) {

189 
	`¥ötf
("(1)Åemp_ty = %0.10Lf,Åy = %0.10Lf\n",

190 
ãmp_ty
, 
ty
);

193 
ãmp_ty
 =

194 
	`sqπ
(
mk
)

196 
	`asö
(

197 (
y0
 - 
a
*
mk
)

199 
	`sqπ
(

200 (
y0
 - 
a
*
mk
)*(y0 -á*mk)

202 (
v
 * 
	`sqπ
(
mk
))*(v * sqrt(mk))

206 
ty
 -
ãmp_ty
;

208 i‡(
_VERBOSE_
) {

209 
	`¥ötf
("(2)Åemp_ty = %0.10Lf,Åy = %0.10Lf\n",

210 
ãmp_ty
, 
ty
);

213 
ãmp_ty
 =

214 
	`sqπ
(
mk
)

216 
	`asö
(

217 (
y1
 + 
a
*
mk
)

219 
	`sqπ
(

220 (
y1
 + 
a
*
mk
)*(y1 +á*mk)

222 (
v
 * 
	`sqπ
(
mk
))*(v * sqrt(mk))

226 
ty
 +
ãmp_ty
;

228 i‡(
_VERBOSE_
) {

229 
	`¥ötf
("(3)Åemp_ty = %0.10Lf,Åy = %0.10Lf\n",

230 
ãmp_ty
, 
ty
);

232 
Ø
 = (
ym
 + 
a
*
mk
);

233 
	`¥ötf
("Ø = %0.10Lf\n", 
Ø
);

235 
Ø
 = (
y1
 + 
a
*
mk
)*(y1 +á*mk);

236 
	`¥ötf
("Ø = %0.10Lf\n", 
Ø
);

238 
bb
 = (
v
 * 
	`sqπ
(
mk
))*(v * sqrt(mk));

239 
	`¥ötf
("v = %0.10Lf, mk = %0.10Lf,áa = %0.20Lf\n",

240 
v
, 
mk
, 
bb
);

242 
Ø
 = 
	`sqπ
◊®+ 
bb
);

243 
	`¥ötf
("Ø = %0.10Lf\n", 
Ø
);

245 
Ø
 = (
ym
 + 
a
*
mk
)

247 
	`sqπ
(

248 (
y1
 + 
a
*
mk
)*(y1 +á*mk)

250 (
v
 * 
	`sqπ
(
mk
))*(v * sqrt(mk))

252 
	`¥ötf
("Ø = %0.10Lf\n", 
Ø
);

254 
bb
 = 
	`modf
(
Ø
, (*)(&
cc
));

255 
	`¥ötf
("BOOGA bb = %0.10Lf\n", 
bb
);

257 
Ø
 = 
	`asö
(aa);

258 
	`¥ötf
("Ø = %0.10Lf\n", 
Ø
);

260 
bb
 = 
	`asö
(bb);

261 
	`¥ötf
("bb = %0.10Lf\n", 
bb
);

264 
ãmp_ty
 =

265 
	`sqπ
(
mk
)

267 
	`asö
(

268 (
ym
 + 
a
*
mk
)

270 
	`sqπ
(

271 (
y1
 + 
a
*
mk
)*(y1 +á*mk)

273 (
v
 * 
	`sqπ
(
mk
))*(v * sqrt(mk))

277 
ty
 -
ãmp_ty
;

279 i‡(
_VERBOSE_
) {

280 
	`¥ötf
("(4)Åemp_ty = %0.10Lf,Åy = %0.10Lf\n",

281 
ãmp_ty
, 
ty
);

282 
	`¥ötf
("find_seek_time_hong --Åy = %0.10Lf\n",

283 
ty
);

286  
ty
;

287 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_hong_seek.h

1 #i‚de‡
_MEMS_HONG_SEEK_H_


2 
	#_MEMS_HONG_SEEK_H_


	)

5 
föd_£ek_time_h⁄g_x
(
°¨t_off£t_nm
, 
íd_off£t_nm
,

6 
•rög_Á˘‹
, 
ac˚Àøti⁄_nm_s_s
,

7 
Àngth_nm
);

10 
föd_£ek_time_h⁄g_y
(
°¨t_off£t_nm
, 
íd_off£t_nm
,

11 
•rög_Á˘‹
, 
ac˚Àøti⁄_nm_s_s
,

12 
Àngth_nm
, 
vñocôy_nm_s
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_internals.c

33 
	~"mems_globÆ.h
"

34 
	~"mems_öã∫Æs.h
"

36 
	~"mems_põ˚wi£_£ek.h
"

37 
	~"mems_h⁄g_£ek.h
"

44 #ifde‡
__SEPERATE__


45 
	#__OUTPUTFILE__
 
°dîr


	)

47 
	#__OUTPUTFILE__
 
ouçutfûe


	)

68 
co‹d_t
 *

69 
	$mems_gë_cuºít_posôi⁄
(
mems_¶ed_t
 *
¶ed
) {

74  (&
¶ed
->
pos
);

76 
	}
}

97 
	$mems_equÆ_co‹ds
(
co‹d_t
 *
⁄e
, co‹d_à*
two
) {

99 i‡((
⁄e
->
x_pos
 =
two
->x_posË&& (⁄e->
y_pos
 =two->y_posË&& (⁄e->
y_vñ
 ==Åwo->y_vel)) {

100  
TRUE
;

102  
FALSE
;

105 
	}
}

126 
	$mems_equÆ_co‹d_£ts
 (
tù£˘‹_co‹d_£t_t
 *
⁄e
,Åù£˘‹_co‹d_£t_à*
two
)

128  (
	`mems_equÆ_co‹ds
(&
⁄e
->
£rvo_°¨t
, &
two
->servo_start) &&

129 
	`mems_equÆ_co‹ds
(&
⁄e
->
tù£˘‹_°¨t
, &
two
->tipsector_start) &&

130 
	`mems_equÆ_co‹ds
(&
⁄e
->
tù£˘‹_íd
, &
two
->tipsector_end));

131 
	}
}

157 
	$mems_medü_ac˚ss_time
 (
mems_¶ed_t
 *
¶ed
, 
co‹d_t
 *
°¨t
, co‹d_à*
íd
)

159 
time
;

160 
vñocôy
;

161 
di°™˚
;

163 
vñocôy
 = ()(
¶ed
->
y_ac˚ss_•ìd_bô_s
 * sÀd->
bô_Àngth_nm
);

164 
di°™˚
 = (
	`Ábs
 (()(
°¨t
->
y_pos
 - 
íd
->y_pos))Ë* 
¶ed
->
bô_Àngth_nm
;

166 
time
 = 
di°™˚
 / 
vñocôy
;

169 
time
 *= 1000.0;

175  (
time
);

176 
	}
}

197 
	$mems_co‹d_t_c›y
 (
co‹d_t
 *
sour˚
, co‹d_à*
de°
) {

199 
de°
->
x_pos
 = 
sour˚
->x_pos;

200 
de°
->
y_pos
 = 
sour˚
->y_pos;

201 
de°
->
y_vñ
 = 
sour˚
->y_vel;

203 
	}
}

224 
	$mems_tù£˘‹_co‹d_£t_t_c›y
 (
tù£˘‹_co‹d_£t_t
 *
sour˚
,Åù£˘‹_co‹d_£t_à*
de°
) {

226 
	`mems_co‹d_t_c›y
(&
sour˚
->
£rvo_°¨t
, &
de°
->servo_start);

227 
	`mems_co‹d_t_c›y
(&
sour˚
->
tù£˘‹_°¨t
, &
de°
->tipsector_start);

228 
	`mems_co‹d_t_c›y
(&
sour˚
->
tù£˘‹_íd
, &
de°
->tipsector_end);

230 
	}
}

254 
	$mems_commô_move
(
mems_¶ed_t
 *
¶ed
,

255 
co‹d_t
 *
pos
) {

257 
	`mems_co‹d_t_c›y
(
pos
, &
¶ed
->pos);

258 
	}
}

286 
	$föd_£âÀ_time
(
num_time_c⁄°™ts
, 
ªs⁄™t_‰equícy
) {

288  (
num_time_c⁄°™ts
 * (1.0 / ((6.2831853Ë* (
ªs⁄™t_‰equícy
))));

290 
	}
}

316 
	$föd_tu∫¨ound_time
(
off£t_nm
, 
vñocôy_nm_s
, 
ba£_ac˚l_nm_s_s
,

317 
•rög_Á˘‹
, 
Àngth_nm
) {

319 
tu∫¨ound_time
;

320 
•rög_ac˚l
;

322 i‡(
_VERBOSE_
) {

323 
	`Ârötf
(
__OUTPUTFILE__
, "find_turnaround_time::Éntry\n");

325 
	`Ârötf
(
__OUTPUTFILE__
, "find_turnaround_time:: offset_nm = %f,Üength_nm = %f\n",

326 
off£t_nm
, 
Àngth_nm
);

330 
•rög_ac˚l
 = (
ba£_ac˚l_nm_s_s
 * (
•rög_Á˘‹
 * (
	`Ábs
(
off£t_nm
Ë/ (
Àngth_nm
 / 2.0))));

332 i‡–((
off£t_nm
 < 0.0Ë&& (
vñocôy_nm_s
 > 0.0)) ||

333 ((
off£t_nm
 > 0.0Ë&& (
vñocôy_nm_s
 < 0.0))

337 
•rög_ac˚l
 = -spring_accel;

342 
tu∫¨ound_time
 = 2.0 * (
	`Ábs
(
vñocôy_nm_s
)Ë/ (
ba£_ac˚l_nm_s_s
 + 
•rög_ac˚l
);

344 i‡(
_VERBOSE_
) {

345 
	`Ârötf
(
__OUTPUTFILE__
, "find_turnaround_time:: velocity_nm_s = %f, base_accel_nm_s_s = %f, spring_accel = %f\n",

346 
vñocôy_nm_s
, 
ba£_ac˚l_nm_s_s
, 
•rög_ac˚l
);

348 
	`Ârötf
(
__OUTPUTFILE__
, "föd_tu∫¨ound_time::Åu∫¨ound_timê%f\n", 
tu∫¨ound_time
);

351  
tu∫¨ound_time
;

352 
	}
}

384 
	$mems_£ek_time
 (
mems_¶ed_t
 *
¶ed
,

385 
co‹d_t
 *
begö
, co‹d_à*
íd
,

386 *
ªtu∫_x_£ek_time
, *
ªtu∫_y_£ek_time
,

387 *
ªtu∫_tu∫¨ound_time
, *
ªtu∫_tu∫¨ound_numbî
)

389 
£ek_time_x
=0.0;

390 
£ek_time_y
=0.0;

391 
di°_x_nm
=0.0;

392 
di°_y_nm
=0.0;

393 
di°_y_equiv_nm
=0.0;

394 
x_ac˚l
=0.0;

395 
y_ac˚l
=0.0;

396 
bô_width
=0.0;

397 
tu∫¨ound_time
=0.0;

398 
£âlög_time_x
=0.0;

399 
y_ac˚ss_•ìd_nm_s
;

400 
tŸÆ_time
;

402 
numbî_of_tu∫s
;

404 
•rög_Á˘‹
 = 0.0;

405 
x_Àngth_nm
 = 0;

406 
y_Àngth_nm
 = 0;

418 i‡(
	`mems_equÆ_co‹ds
(
begö
, 
íd
)) {

422 i‡(
ªtu∫_tu∫¨ound_time
 !
NULL
) {

423 *
ªtu∫_tu∫¨ound_time
 = 0.0;

426 i‡(
ªtu∫_tu∫¨ound_numbî
 !
NULL
) {

427 *
ªtu∫_tu∫¨ound_numbî
 = 0;

430 i‡(
ªtu∫_x_£ek_time
 !
NULL
) {

431 *
ªtu∫_x_£ek_time
 = 0.0;

434 i‡(
ªtu∫_y_£ek_time
 !
NULL
) {

435 *
ªtu∫_y_£ek_time
 = 0.0;

443 
x_ac˚l
 = ()
¶ed
->
x_ac˚l_nm_s2
;

444 
y_ac˚l
 = ()
¶ed
->
y_ac˚l_nm_s2
;

445 
bô_width
 = ()
¶ed
->
bô_Àngth_nm
;

446 
y_ac˚ss_•ìd_nm_s
 = 
¶ed
->
y_ac˚ss_•ìd_bô_s
 * sÀd->
bô_Àngth_nm
;

447 
x_Àngth_nm
 = 
¶ed
->x_length_nm;

448 
y_Àngth_nm
 = 
¶ed
->y_length_nm;

449 
•rög_Á˘‹
 = 
¶ed
->spring_factor;

458 i‡(
íd
->
x_pos
 =
begö
->x_pos) {

459 
di°_x_nm
 = ()0.0;

460 
£ek_time_x
 = ()0.0;

464 
£âlög_time_x
 = 
	`föd_£âÀ_time
(
¶ed
->
num_time_c⁄°™ts
, sÀd->
¶ed_ªs⁄™t_‰eq_hz
);

477 i‡(
¶ed
->
dev
->
£ek_fun˘i⁄
 =
MEMS_SEEK_HONG
) {

478 
£ek_time_x
 = 
	`föd_£ek_time_h⁄g_x
((
begö
->
x_pos
 * 
bô_width
),

479 (
íd
->
x_pos
 * 
bô_width
),

480 
•rög_Á˘‹
, 
x_ac˚l
,

481 
x_Àngth_nm
)

483 
£âlög_time_x
;

485 i‡(
¶ed
->
dev
->
¥ecompuã_£ek_cou¡
 > 0) {

486 
£ek_time_x
 =

487 
	`mems_föd_¥ecompuãd_£ek_time
(
¶ed
,

488 (
begö
->
x_pos
 * 
bô_width
), (
íd
->x_pos * bit_width),

489 
_X_SEEK_
)

491 
£âlög_time_x
;

493 
£ek_time_x
 =

494 
	`föd_£ek_time_põ˚wi£
((
begö
->
x_pos
 * 
bô_width
), (
íd
->x_pos * bit_width),

495 
•rög_Á˘‹
, 
x_ac˚l
,

496 
x_Àngth_nm
, 0.0)

498 
£âlög_time_x
;

535 
tu∫¨ound_time
 = 0.0;

536 
numbî_of_tu∫s
 = 0;

538 i‡(
begö
->
y_vñ
 >= 0) {

539 i‡(
íd
->
y_vñ
 > 0) {

540 i‡(
begö
->
y_pos
 >
íd
->y_pos) {

543 
tu∫¨ound_time
 = 
	`föd_tu∫¨ound_time
((
begö
->
y_pos
 * 
bô_width
),

544 
begö
->
y_vñ
,

545 
y_ac˚l
,

546 
•rög_Á˘‹
, 
y_Àngth_nm
);

547 
tu∫¨ound_time
 +
	`föd_tu∫¨ound_time
((
íd
->
y_pos
 * 
bô_width
),

548 
íd
->
y_vñ
,

549 
y_ac˚l
,

550 
•rög_Á˘‹
, 
y_Àngth_nm
);

551 
numbî_of_tu∫s
 = 2;

560 
numbî_of_tu∫s
 = 0;

568 i‡(
begö
->
y_pos
 >
íd
->y_pos) {

571 
tu∫¨ound_time
 = 
	`föd_tu∫¨ound_time
((
begö
->
y_pos
 * 
bô_width
),

572 
begö
->
y_vñ
,

573 
y_ac˚l
,

574 
•rög_Á˘‹
, 
y_Àngth_nm
);

575 
numbî_of_tu∫s
 = 1;

584 
tu∫¨ound_time
 = 
	`föd_tu∫¨ound_time
((
íd
->
y_pos
 * 
bô_width
),

585 
íd
->
y_vñ
,

586 
y_ac˚l
,

587 
•rög_Á˘‹
, 
y_Àngth_nm
);

588 
numbî_of_tu∫s
 = 1;

597 i‡(
íd
->
y_vñ
 > 0) {

598 i‡(
begö
->
y_pos
 >
íd
->y_pos) {

601 
tu∫¨ound_time
 = 
	`föd_tu∫¨ound_time
((
íd
->
y_pos
 * 
bô_width
),

602 
íd
->
y_vñ
,

603 
y_ac˚l
,

604 
•rög_Á˘‹
, 
y_Àngth_nm
);

605 
numbî_of_tu∫s
 = 1;

613 
tu∫¨ound_time
 = 
	`föd_tu∫¨ound_time
((
begö
->
y_pos
 * 
bô_width
),

614 
begö
->
y_vñ
,

615 
y_ac˚l
,

616 
•rög_Á˘‹
, 
y_Àngth_nm
);

617 
numbî_of_tu∫s
 = 1;

625 i‡(
begö
->
y_pos
 >
íd
->y_pos) {

628 
numbî_of_tu∫s
 = 0;

634 
di°_y_equiv_nm
 = 0;

638 
tu∫¨ound_time
 = 
	`föd_tu∫¨ound_time
((
begö
->
y_pos
 * 
bô_width
),

639 
begö
->
y_vñ
,

640 
y_ac˚l
,

641 
•rög_Á˘‹
, 
y_Àngth_nm
);

642 
tu∫¨ound_time
 +
	`föd_tu∫¨ound_time
((
íd
->
y_pos
 * 
bô_width
),

643 
íd
->
y_vñ
,

644 
y_ac˚l
,

645 
•rög_Á˘‹
, 
y_Àngth_nm
);

646 
numbî_of_tu∫s
 = 2;

656 
di°_y_nm
 = ()
	`abs
(
íd
->
y_pos
 - 
begö
->y_posË* 
¶ed
->
bô_Àngth_nm
;

668 i‡(
¶ed
->
dev
->
£ek_fun˘i⁄
 =
MEMS_SEEK_HONG
) {

669 
£ek_time_y
 =

670 
	`föd_£ek_time_h⁄g_y
((
begö
->
y_pos
 * 
bô_width
),

671 (
íd
->
y_pos
 * 
bô_width
),

672 
•rög_Á˘‹
, 
y_ac˚l
,

673 
y_Àngth_nm
, 
y_ac˚ss_•ìd_nm_s
)

675 
tu∫¨ound_time
;

677 i‡(
¶ed
->
dev
->
¥ecompuã_£ek_cou¡
 > 0) {

678 
£ek_time_y
 =

679 
	`mems_föd_¥ecompuãd_£ek_time
(
¶ed
,

680 (
begö
->
y_pos
 * 
bô_width
), (
íd
->y_pos * bit_width),

681 
_Y_SEEK_
)

683 
tu∫¨ound_time
;

685 
£ek_time_y
 =

686 
	`föd_£ek_time_põ˚wi£
((
begö
->
y_pos
 * 
bô_width
), (
íd
->y_pos * bit_width),

687 
•rög_Á˘‹
, 
y_ac˚l
,

688 
y_Àngth_nm
, 
y_ac˚ss_•ìd_nm_s
)

689 + 
tu∫¨ound_time
;

704 i‡(
ªtu∫_tu∫¨ound_time
 !
NULL
) {

705 *
ªtu∫_tu∫¨ound_time
 = (
tu∫¨ound_time
) * 1000.0;

708 i‡(
ªtu∫_tu∫¨ound_numbî
 !
NULL
) {

709 *
ªtu∫_tu∫¨ound_numbî
 = 
numbî_of_tu∫s
;

712 i‡(
ªtu∫_x_£ek_time
 !
NULL
) {

713 *
ªtu∫_x_£ek_time
 = 
£ek_time_x
 * 1000.0;

716 i‡(
ªtu∫_y_£ek_time
 !
NULL
) {

717 *
ªtu∫_y_£ek_time
 = 
£ek_time_y
 * 1000.0;

725 i‡(
_VERBOSE_
) {

726 
	`¥ötf
("dist_x = %f; dist_y = %f; seek_time_x = %f; seek_time_y = %f\n",

727 
di°_x_nm
, 
di°_y_nm
, 
£ek_time_x
, 
£ek_time_y
);

731 
tŸÆ_time
 = 
	`max
(
£ek_time_x
, 
£ek_time_y
);

734  (
tŸÆ_time
 * ()1000.0);

735 
	}
}

742 
	$mems_£ek_time_£ekˇche
 (
mems_¶ed_t
 *
¶ed
,

743 
co‹d_t
 *
begö
,

744 
co‹d_t
 *
íd
,

745 *
ªtu∫_x_£ek_time
,

746 *
ªtu∫_y_£ek_time
,

747 *
ªtu∫_tu∫¨ound_time
,

748 *
ªtu∫_tu∫¨ound_numbî
)

750 
mems_£ekˇche
 *
s
;

751 
i
;

754 
i
 = 0; i < 
MEMS_SEEKCACHE
; i++) {

755 
s
 = &
¶ed
->
£ekˇche
[
i
];

756 i‡(
	`mems_equÆ_co‹ds
(
begö
, &
s
->begin) &&

757 
	`mems_equÆ_co‹ds
(
íd
, &
s
->end)) {

758 i‡(
ªtu∫_x_£ek_time
Ë*ªtu∫_x_£ek_timê
s
->
x_£ek_time
;

759 i‡(
ªtu∫_y_£ek_time
Ë*ªtu∫_y_£ek_timê
s
->
y_£ek_time
;

760 i‡(
ªtu∫_tu∫¨ound_time
Ë*ªtu∫_tu∫¨ound_timê
s
->
tu∫¨ound_time
;

761 i‡(
ªtu∫_tu∫¨ound_numbî
Ë*ªtu∫_tu∫¨ound_numbî = 
s
->
tu∫¨ound_numbî
;

762  
s
->
time
;

766 
s
 = &
¶ed
->
£ekˇche
[¶ed->
£ekˇche_√xt
];

767 
	`mems_co‹d_t_c›y
(
begö
, &
s
->begin);

768 
	`mems_co‹d_t_c›y
(
íd
, &
s
->end);

769 
s
->
time
 = 
	`mems_£ek_time
(
¶ed
, &s->
begö
, &s->
íd
, &s->
x_£ek_time
, &s->
y_£ek_time
, &s->
tu∫¨ound_time
, &s->
tu∫¨ound_numbî
);

770 i‡(
ªtu∫_x_£ek_time
Ë*ªtu∫_x_£ek_timê
s
->
x_£ek_time
;

771 i‡(
ªtu∫_y_£ek_time
Ë*ªtu∫_y_£ek_timê
s
->
y_£ek_time
;

772 i‡(
ªtu∫_tu∫¨ound_time
Ë*ªtu∫_tu∫¨ound_timê
s
->
tu∫¨ound_time
;

773 i‡(
ªtu∫_tu∫¨ound_numbî
Ë*ªtu∫_tu∫¨ound_numbî = 
s
->
tu∫¨ound_numbî
;

774 
¶ed
->
£ekˇche_√xt
++;

775 i‡(
¶ed
->
£ekˇche_√xt
 =
MEMS_SEEKCACHE
) sled->seekcache_next = 0;

777  
s
->
time
;

778 
	}
}

785 
	$mems_¥öt_¥ecompuãd_£ek_times
(
mems_t
 *
dev
) {

787 
i
;

789 
i
 = 0; i <
dev
->
¥ecompuã_£ek_cou¡
; i++) {

790 
	`¥ötf
("i = %d, distance = %d, x_seek = %f, y_seek = %f\n",

791 
i
, 
dev
->
¥ecompuã_£ek_di°™˚s
[i], dev->
¥ecompuã_x_£ek_times
[i], dev->
¥ecompuã_y_£ek_times
[i]);

794 
	}
}

797 
	$mems_föd_¥ecompuãd_£ek_time
(
mems_¶ed_t
 *
¶ed
,

798 
°¨t_off£t_nm
, 
íd_off£t_nm
,

799 
dúe˘i⁄
) {

801 
£ektime
 = 0.0;

802 
di°_nm
;

803 
i
;

804 
mems_t
 *
dev
 = 
¶ed
->dev;

806 
di°_nm
 = ()
	`föd_di°_nm
(
°¨t_off£t_nm
, 
íd_off£t_nm
);

808 i‡(
_VERBOSE_
) {

809 
	`Ârötf
(
__OUTPUTFILE__
, "mems_find_precomputed_seek_time::Éntry - start_offset_nm = %f,Énd_offset_nm = %f\n",

810 
°¨t_off£t_nm
, 
íd_off£t_nm
);

811 
	`Ârötf
(
__OUTPUTFILE__
, "mems_find_precomputed_seek_time:: dist_nm = %d\n",

812 
di°_nm
);

819 i‡(
di°_nm
) {

820 
i
=0; i <
dev
->
¥ecompuã_£ek_cou¡
; i++) {

825 i‡(
di°_nm
 <
dev
->
¥ecompuã_£ek_di°™˚s
[
i
]) {

826 i‡(
di°_nm
 =
dev
->
¥ecompuã_£ek_di°™˚s
[
i
]) {

828 
£ektime
 = (
dúe˘i⁄
 =
_X_SEEK_
) ?

829 
dev
->
¥ecompuã_x_£ek_times
[
i
] :

830 
dev
->
¥ecompuã_y_£ek_times
[
i
];

832 
ddiff
 =

833 (Ë(
di°_nm
 - 
dev
->
¥ecompuã_£ek_di°™˚s
[(
i
-1)])

835 (Ë(
dev
->
¥ecompuã_£ek_di°™˚s
[
i
] - dev->precompute_seek_distances[(i-1)]);

841 i‡(
dúe˘i⁄
 =
_X_SEEK_
) {

842 
£ektime
 = 
dev
->
¥ecompuã_x_£ek_times
[(
i
-1)];

844 
£ektime
 +
ddiff
 * (
dev
->
¥ecompuã_x_£ek_times
[
i
] - dev->precompute_x_seek_times[(i-1)]);

851 
£ektime
 = 
dev
->
¥ecompuã_y_£ek_times
[(
i
-1)];

853 
£ektime
 +
ddiff
 * (
dev
->
¥ecompuã_y_£ek_times
[
i
] - dev->precompute_y_seek_times[(i-1)]);

864 i‡(
£ektime
 == 0.0) {

865 
	`Ârötf
(
°dîr
, "Sìk di°™˚Éx˚ed†¥ecompuã sìk curve: %d\n", 
di°_nm
);

866 
	`exô
(0);

870 i‡(
_VERBOSE_
) {

871 
	`Ârötf
(
__OUTPUTFILE__
, "mems_find_precompute_seek_time:: finished - seektime = %f\n",

872 
£ektime
);

877 (
£ektime
 / 1000.0);

878 
	}
}

881 
	$mems_¥ecompuã_£ek_curve
(
mems_t
 *
dev
) {

883 
co‹d_t
 
begö
, 
íd
;

885 
x_£ek_time
, 
y_£ek_time
;

886 
¶ed_Àngth_bôs
;

887 
off£t
;

888 
bô_°ï
;

889 
nm_°ï
;

890 
i
;

891 
num_time_c⁄°™ts
 = 
dev
->
¶ed
[0].num_time_constants;

892 
¥ecompuã_£ek_cou¡
 = 
dev
->precompute_seek_count;

894 
dev
->
¶ed
[0].
num_time_c⁄°™ts
 = 0.0;

895 
dev
->
¥ecompuã_£ek_cou¡
 = 0;

897 
¶ed_Àngth_bôs
 = (Ë(
dev
->
¶ed
[0].
x_Àngth_nm
 / dev->¶ed[0].
bô_Àngth_nm
);

898 
bô_°ï
 = 
¶ed_Àngth_bôs
 / 
¥ecompuã_£ek_cou¡
;

899 
nm_°ï
 = (
¶ed_Àngth_bôs
 * 
dev
->
¶ed
[0].
bô_Àngth_nm
Ë/ 
¥ecompuã_£ek_cou¡
;

901 
dev
->
¥ecompuã_£ek_di°™˚s
 = (*)
	`mÆloc
((
¥ecompuã_£ek_cou¡
 + 1) * ());

902 
dev
->
¥ecompuã_x_£ek_times
 = (*)
	`mÆloc
((
¥ecompuã_£ek_cou¡
 + 1) * ());

903 
dev
->
¥ecompuã_y_£ek_times
 = (*)
	`mÆloc
((
¥ecompuã_£ek_cou¡
 + 1) * ());

911 
i
 = 0; i < 
¥ecompuã_£ek_cou¡
; i++) {

913 
off£t
 = 
i
 * 
bô_°ï
;

917 
begö
.
x_pos
 = 0;

918 
begö
.
y_pos
 = 0;

919 
begö
.
y_vñ
 = 0;

921 
íd
.
x_pos
 = 
off£t
;

922 
íd
.
y_pos
 = 0;

923 
íd
.
y_vñ
 = 0;

930 
x_£ek_time
 = 
	`mems_£ek_time
(&(
dev
->
¶ed
[0]),

931 &
begö
, &
íd
,

932 
NULL
, NULL,

933 
NULL
, NULL);

935 
begö
.
x_pos
 = 0;

936 
begö
.
y_pos
 = 0;

937 
begö
.
y_vñ
 = 
dev
->
¶ed
[0].
y_ac˚ss_•ìd_bô_s
;

939 
íd
.
x_pos
 = 0;

940 
íd
.
y_pos
 = 
off£t
;

941 
íd
.
y_vñ
 = 
dev
->
¶ed
[0].
y_ac˚ss_•ìd_bô_s
;

948 
y_£ek_time
 = 
	`mems_£ek_time
(&(
dev
->
¶ed
[0]),

949 &
begö
, &
íd
,

950 
NULL
, NULL,

951 
NULL
, NULL);

958 
dev
->
¥ecompuã_£ek_di°™˚s
[
i
] = 
off£t
 * dev->
¶ed
[0].
bô_Àngth_nm
;

959 
dev
->
¥ecompuã_x_£ek_times
[
i
] = 
x_£ek_time
;

960 
dev
->
¥ecompuã_y_£ek_times
[
i
] = 
y_£ek_time
;

971 
begö
.
x_pos
 = 0;

972 
begö
.
y_pos
 = 0;

973 
begö
.
y_vñ
 = 0;

975 
íd
.
x_pos
 = 
¶ed_Àngth_bôs
;

976 
íd
.
y_pos
 = 0;

977 
íd
.
y_vñ
 = 0;

979 
x_£ek_time
 = 
	`mems_£ek_time
(&(
dev
->
¶ed
[0]),

980 &
begö
, &
íd
,

981 
NULL
, NULL,

982 
NULL
, NULL);

984 
begö
.
x_pos
 = 0;

985 
begö
.
y_pos
 = 0;

986 
begö
.
y_vñ
 = 
dev
->
¶ed
[0].
y_ac˚ss_•ìd_bô_s
;

988 
íd
.
x_pos
 = 0;

989 
íd
.
y_pos
 = 
¶ed_Àngth_bôs
;

990 
íd
.
y_vñ
 = 
dev
->
¶ed
[0].
y_ac˚ss_•ìd_bô_s
;

992 
y_£ek_time
 = 
	`mems_£ek_time
(&(
dev
->
¶ed
[0]),

993 &
begö
, &
íd
,

994 
NULL
, NULL,

995 
NULL
, NULL);

997 
dev
->
¥ecompuã_£ek_di°™˚s
[
¥ecompuã_£ek_cou¡
] = 
¶ed_Àngth_bôs
 * dev->
¶ed
[0].
bô_Àngth_nm
;

998 
dev
->
¥ecompuã_x_£ek_times
[
¥ecompuã_£ek_cou¡
] = 
x_£ek_time
;

999 
dev
->
¥ecompuã_y_£ek_times
[
¥ecompuã_£ek_cou¡
] = 
y_£ek_time
;

1006 
dev
->
¶ed
[0].
num_time_c⁄°™ts
 =Çum_time_constants;

1007 
dev
->
¥ecompuã_£ek_cou¡
 =Örecompute_seek_count;

1009 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_internals.h

33 #i‚de‡
_MEMS_INTERNALS_H_


34 
	#_MEMS_INTERNALS_H_


	)

36 
	~"mems_globÆ.h
"

40 
	smems_öã∫Æ_°©i°ics
 {

41 
	mi
;

42 } 
	tmems_öã∫Æ_°©i°ics_t
;

46 
	#X_OFFSET
(
_X_
Ë(()((_X_Ë- (
x_Àngth_nm
 / 2.0)))

	)

47 
	#Y_OFFSET
(
_Y_
Ë(()((_Y_Ë- (
y_Àngth_nm
 / 2.0)))

	)

49 
	#_X_SEEK_
 0

	)

50 
	#_Y_SEEK_
 1

	)

68 
mems_equÆ_co‹ds
(
co‹d_t
 *
⁄e
, co‹d_à*
two
);

83 
mems_equÆ_co‹d_£ts
(
tù£˘‹_co‹d_£t_t
 *
⁄e
,Åù£˘‹_co‹d_£t_à*
two
);

99 
mems_co‹d_t_c›y
(
co‹d_t
 *
sour˚
, co‹d_à*
de°
);

115 
mems_tù£˘‹_co‹d_£t_t_c›y
 (
tù£˘‹_co‹d_£t_t
 *
sour˚
,

116 
tù£˘‹_co‹d_£t_t
 *
de°
);

131 
co‹d_t
 *
mems_gë_cuºít_posôi⁄
(
mems_¶ed_t
 *
¶ed
);

154 
mems_£ek_time
(
mems_¶ed_t
 *
¶ed
,

155 
co‹d_t
 *
begö
, co‹d_à*
íd
,

156 *
ªtu∫_x_£ek_time
, *
ªtu∫_y_£ek_time
,

157 *
ªtu∫_tu∫¨ound_time
, *
ªtu∫_tu∫¨ound_numbî
);

165 
mems_£ek_time_£ekˇche
 (
mems_¶ed_t
 *
¶ed
,

166 
co‹d_t
 *
begö
,

167 
co‹d_t
 *
íd
,

168 *
ªtu∫_x_£ek_time
,

169 *
ªtu∫_y_£ek_time
,

170 *
ªtu∫_tu∫¨ound_time
,

171 *
ªtu∫_tu∫¨ound_numbî
);

175 
mems_föd_¥ecompuãd_£ek_time
(
mems_¶ed_t
 *
¶ed
,

176 
°¨t_off£t_nm
, 
íd_off£t_nm
,

177 
dúe˘i⁄
);

193 
mems_medü_ac˚ss_time
(
mems_¶ed_t
 *
¶ed
,

194 
co‹d_t
 *
°¨t
, co‹d_à*
íd
);

196 
föd_tu∫¨ound_time
(
off£t_nm
, 
vñocôy_nm_s
, 
ba£_ac˚l_nm_s_s
,

197 
•rög_Á˘‹
, 
Àngth_nm
);

213 
mems_commô_move
(
mems_¶ed_t
 *
¶ed
,

214 
co‹d_t
 *
pos
);

216 
mems_¥ecompuã_£ek_curve
(
mems_t
 *
dev
);

218 
mems_föd_¥ecompuãd_£ek_time
(
mems_¶ed_t
 *
¶ed
,

219 
°¨t_off£t_nm
,

220 
íd_off£t_nm
,

221 
dúe˘i⁄
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_mapping.c

39 
	~"mems_globÆ.h
"

40 
	~"mems_m≠pög.h
"

42 #ifde‡
_WIN32


43 
	#ölöe
 
__ölöe


	)

44 
	#__ölöe__
 
__ölöe


	)

47 
mems_¶ed_t
 *

48 
	$mems_lbn_to_¶ed
 (
mems_t
 *
dev
, 
lbn
)

58 
i
;

60 i‡(
lbn
 < 0 ||Üb¿>
dev
->
numblocks
) {

61 
	`Ârötf
(
°dîr
, "LBN %d outsidêvÆidÑ™gê(%d)\n", 
lbn
, 
dev
->
numblocks
);

62 
	`exô
(1);

66 i‡(
dev
->
num_¶eds
 =1Ë &dev->
¶ed
[0];

75 
i
 = 0; i < 
dev
->
num_¶eds
; i++) {

76 
¶ed_œ°block
 = (
i
+1Ë* 
dev
->
numblocks
 / dev->
num_¶eds
 - 1;

77 i‡(
lbn
 <
¶ed_œ°block
) ;

82  &
dev
->
¶ed
[
i
];

83 
	}
}

102 
ölöe
 
	$rows_≥r_cﬁumn
 (
mems_¶ed_t
 *
¶ed
) {

104 (
¶ed
->
y_Àngth_nm
 / sÀd->
bô_Àngth_nm
 - sÀd->
£rvo_bur°_Àngth_bôs
)

105 / (
¶ed
->
£rvo_bur°_Àngth_bôs
 + sÀd->
tù_£˘‹_Àngth_bôs
);

106 
	}
}

108 
ölöe
 
	$cﬁumns_≥r_cylödî
 (
mems_¶ed_t
 *
¶ed
) {

109  
¶ed
->
tùs_ußbÀ
 / sÀd->
tùs_simu…™eous
;

110 
	}
}

112 
ölöe
 
	$˚Œs_≥r_row
 (
mems_¶ed_t
 *
¶ed
) {

113  
¶ed
->
tùs_simu…™eous
 / sÀd->
tù_£˘‹s_≥r_lbn
;

114 
	}
}

116 
ölöe
 
	$˚Œs_≥r_cﬁumn
 (
mems_¶ed_t
 *
¶ed
) {

117  
	`˚Œs_≥r_row
(
¶ed
Ë* 
	`rows_≥r_cﬁumn
(sled);

118 
	}
}

120 
ölöe
 
	$˚Œs_≥r_cylödî
 (
mems_¶ed_t
 *
¶ed
) {

121  
	`˚Œs_≥r_cﬁumn
(
¶ed
Ë* 
	`cﬁumns_≥r_cylödî
(sled);

122 
	}
}

124 
ölöe
 

125 
	$shi·_co‹d£t
 (
tù£˘‹_co‹d_£t_t
 *
cs
, 
mems_¶ed_t
 *
¶ed
)

127 
x_shi·
 = 
¶ed
->
x_Àngth_nm
 / sÀd->
bô_Àngth_nm
 / 2;

128 
y_shi·
 = (
	`rows_≥r_cﬁumn
(
¶ed
Ë* (¶ed->
£rvo_bur°_Àngth_bôs
 + sÀd->
tù_£˘‹_Àngth_bôs
) + sled->servo_burst_length_bits) / 2;

131 
cs
->
£rvo_°¨t
.
x_pos
 -
x_shi·
;

132 
cs
->
tù£˘‹_°¨t
.
x_pos
 -
x_shi·
;

133 
cs
->
tù£˘‹_íd
.
x_pos
 -
x_shi·
;

137 
cs
->
£rvo_°¨t
.
y_pos
 -
y_shi·
;

138 
cs
->
tù£˘‹_°¨t
.
y_pos
 -
y_shi·
;

139 
cs
->
tù£˘‹_íd
.
y_pos
 -
y_shi·
;

140 
	}
}

144 
	$mems_lbn_to_posôi⁄
 (
lbn
,

145 
mems_¶ed_t
 *
¶ed
,

146 
tù£˘‹_co‹d_£t_t
 *
up
,

147 
tù£˘‹_co‹d_£t_t
 *
dn
,

148 
tù£t_t
 *
tù£t
,

149 *
cyÕå
, *
surÁ˚±r
, *
blk±r
)

154 
loˇŒbn
 = 
lbn
 % 
¶ed
->
numblocks
;

155 
y_ac˚ss_•ìd_nm_s
 = 
¶ed
->
y_ac˚ss_•ìd_bô_s
 * sÀd->
bô_Àngth_nm
;

156 
cylödî
;

157 
cﬁumn
;

158 
row
;

159 
˚Œ
;

161 
cylödî
 = 
loˇŒbn
 / 
	`˚Œs_≥r_cylödî
(
¶ed
);

162 
cﬁumn
 = (
loˇŒbn
 % 
	`˚Œs_≥r_cylödî
(
¶ed
)Ë/ 
	`˚Œs_≥r_cﬁumn
(sled);

163 
row
 = (
loˇŒbn
 % 
	`˚Œs_≥r_cﬁumn
(
¶ed
)Ë/ 
	`˚Œs_≥r_row
(sled);

164 
˚Œ
 = 
loˇŒbn
 % 
	`˚Œs_≥r_row
(
¶ed
);

167 
up
->
£rvo_°¨t
.
x_pos
 = up->
tù£˘‹_°¨t
.x_po†up->
tù£˘‹_íd
.x_po†
cylödî
;

168 
dn
->
£rvo_°¨t
.
x_pos
 = dn->
tù£˘‹_°¨t
.x_po†dn->
tù£˘‹_íd
.x_po†
cylödî
;

171 
up
->
£rvo_°¨t
.
y_vñ
 = up->
tù£˘‹_°¨t
.y_vñ = up->
tù£˘‹_íd
.y_vñ = 
y_ac˚ss_•ìd_nm_s
;

172 
dn
->
£rvo_°¨t
.
y_vñ
 = dn->
tù£˘‹_°¨t
.y_vñ = dn->
tù£˘‹_íd
.y_vñ = -
y_ac˚ss_•ìd_nm_s
;

199 i‡(
¶ed
->
œyout_pﬁicy
 =
MEMS_LAYOUT_STREAMING
) {

200 i‡(
	`cﬁumns_≥r_cylödî
(
¶ed
) % 2) {

201 i‡(
cylödî
 % 2) {

203 i‡(!(
cﬁumn
 % 2)Ë
row
 = 
	`rows_≥r_cﬁumn
(
¶ed
) -Ñow - 1;

206 i‡(
cﬁumn
 % 2Ë
row
 = 
	`rows_≥r_cﬁumn
(
¶ed
) -Ñow - 1;

210 i‡(
cﬁumn
 % 2Ë
row
 = 
	`rows_≥r_cﬁumn
(
¶ed
) -Ñow - 1;

215 
up
->
£rvo_°¨t
.
y_pos
 = 
row
 * (
¶ed
->
£rvo_bur°_Àngth_bôs
 + sÀd->
tù_£˘‹_Àngth_bôs
);

216 
up
->
tù£˘‹_°¨t
.
y_pos
 = up->
£rvo_°¨t
.y_po†+ 
¶ed
->
£rvo_bur°_Àngth_bôs
;

217 
up
->
tù£˘‹_íd
.
y_pos
 = up->
tù£˘‹_°¨t
.y_po†+ 
¶ed
->
tù_£˘‹_Àngth_bôs
;

220 
dn
->
£rvo_°¨t
.
y_pos
 = 
up
->
tù£˘‹_íd
.y_po†+ 
¶ed
->
£rvo_bur°_Àngth_bôs
;

221 
dn
->
tù£˘‹_°¨t
.
y_pos
 = 
up
->
tù£˘‹_íd
.y_pos;

222 
dn
->
tù£˘‹_íd
.
y_pos
 = 
up
->
tù£˘‹_°¨t
.y_pos;

225 
tù£t
->
tù_°¨t
 = 
˚Œ
 * 
¶ed
->
tù_£˘‹s_≥r_lbn
 + 
cﬁumn
 * sÀd->
tùs_simu…™eous
;

226 
tù£t
->
tù_íd
 =Åù£t->
tù_°¨t
 + 
¶ed
->
tù_£˘‹s_≥r_lbn
 - 1;

227 
tù£t
->
num_tùs
 =Åù£t->
tù_íd
 -Åù£t->
tù_°¨t
 + 1;

230 
	`shi·_co‹d£t
(
up
, 
¶ed
);

231 
	`shi·_co‹d£t
(
dn
, 
¶ed
);

234 i‡(
cyÕå
Ë*cyÕå = 
cylödî
;

235 i‡(
surÁ˚±r
Ë*surÁ˚±∏
cﬁumn
;

236 i‡(
blk±r
Ë*blk±∏
row
 * 
	`˚Œs_≥r_row
(
¶ed
Ë+ 
˚Œ
;

238 
	}
}

242 
	$mems_gë_numbî_of_cylödîs
 (
mems_t
 *
dev
)

244  
dev
->
¶ed
[0].
x_Àngth_nm
 / dev->¶ed[0].
bô_Àngth_nm
;

245 
	}
}

249 
	$mems_gë_blocks_≥r_cylödî
 (
mems_¶ed_t
 *
¶ed
)

251  
	`˚Œs_≥r_cylödî
(
¶ed
);

252 
	}
}

256 
	$mems_check_numblocks
 (
mems_t
 *
dev
) {

257 
numcylödîs
 = 
	`mems_gë_numbî_of_cylödîs
(
dev
);

258 
numblocks
 = 
	`˚Œs_≥r_cylödî
(&
dev
->
¶ed
[0]Ë* 
numcylödîs
 * dev->
num_¶eds
;

259 
i
;

261 i‡(
dev
->
numblocks
 == 0) {

262 
dev
->
numblocks
 =Çumblocks;

263 
i
 = 0; i < 
dev
->
num_¶eds
; i++Ëdev->
¶ed
[i].
numblocks
 =Çumblocks / dev->num_sleds;

268 i‡(
dev
->
numblocks
 !=Çumblocks) {

269 
	`Ârötf
(
°dîr
, "W¨nög: dev->numblock†öc⁄si°íà(•ec: %d,á˘uÆ: %d)\n", 
dev
->
numblocks
,Çumblocks);

271 
i
 = 0; i < 
dev
->
num_¶eds
; i++) {

272 i‡(
dev
->
¶ed
[
i
].
numblocks
 !numblock†/ dev->
num_¶eds
) {

273 
	`Ârötf
(
°dîr
, "W¨nög: sÀd[%d]->numblock†öc⁄si°íà(•ec: %d,á˘uÆ: %d)\n", 
i
, 
dev
->
¶ed
[i].
numblocks
,Çumblock†/ dev->
num_¶eds
);

278 
	}
}

282 
	$mems_˚¡îmo°_lbn
 (
mems_¶ed_t
 * 
¶ed
) {

285 
h‹iz_off£t
 = (
¶ed
->
x_Àngth_nm
 / sÀd->
bô_Àngth_nm
 / 2Ë* 
	`˚Œs_≥r_cylödî
(sled);

286 
vît_off£t
 = 
	`˚Œs_≥r_cylödî
(
¶ed
) / 2;

288  
h‹iz_off£t
 + 
vît_off£t
;

289 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_mapping.h

33 #i‚de‡
_MEMS_MAPPING_H_


34 
	#_MEMS_MAPPING_H_


	)

36 
	~"mems_globÆ.h
"

37 
	~"mems_öã∫Æs.h
"

41 
	tlbn_t
;

52 
	#MEMS_LAYOUT_SIMPLE
 6

	)

53 
	#MEMS_LAYOUT_STREAMING
 7

	)

79 
mems_lbn_to_posôi⁄
(
lbn_t
 
lbn
,

80 
mems_¶ed_t
 *
¶ed
,

81 
tù£˘‹_co‹d_£t_t
 *
up
,

82 
tù£˘‹_co‹d_£t_t
 *
down
,

83 
tù£t_t
 *
tù£t
,

84 *
cyÕå
, *
surÁ˚±r
, *
blk±r
);

101 
mems_¶ed_t
 *
mems_lbn_to_¶ed
(
mems_t
 *
dev
, 
lbn_t
 
lbn
);

117 
mems_check_numblocks
(
mems_t
 *
dev
);

131 
mems_˚¡îmo°_lbn
 (
mems_¶ed_t
 * 
¶ed
);

145 
mems_gë_numbî_of_cylödîs
 (
mems_t
 *
dev
);

159 
mems_gë_blocks_≥r_cylödî
 (
mems_¶ed_t
 *
¶ed
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_piecewise_seek.c

32 
	~<m©h.h
>

34 
	~"mems_globÆ.h
"

35 
	~"mems_põ˚wi£_£ek.h
"

42 #ifde‡
__SEPERATE__


43 
	#__OUTPUTFILE__
 
°dîr


	)

45 
	#__OUTPUTFILE__
 
ouçutfûe


	)

76 
	$föd_di°_nm
(
°¨t_off£t
, 
íd_off£t
) {

78 
di°_nm
;

80 i‡(((
°¨t_off£t
 > 0.0Ë&& (
íd_off£t
 > 0.0)) ||

81 ((
°¨t_off£t
 < 0.0Ë&& (
íd_off£t
 < 0.0))) {

83 
di°_nm
 = 
	`Ábs
(
íd_off£t
 - 
°¨t_off£t
);

85 
di°_nm
 = 
	`Ábs
(
°¨t_off£t
Ë+ fabs(
íd_off£t
);

88 i‡(
_VERBOSE_
) {

89 
	`Ârötf
(
__OUTPUTFILE__
, "find_dist_nm:: start_offset = %f,Énd_offset = %f, dist_nm = %f\n",

90 
°¨t_off£t
, 
íd_off£t
, 
di°_nm
);

93  
di°_nm
;

94 
	}
}

134 
	$föd_loˇl_a˘u©‹_dúe˘i⁄
(
°¨t_off£t_nm
, 
íd_off£t_nm
,

135 
ovîÆl_a˘u©‹_dúe˘i⁄
) {

137 i‡(
_VERBOSE_
) {

138 
	`Ârötf
(
__OUTPUTFILE__
, "find_local_actuator_direction:: start_offset_nm = %f,Énd_offset_nm = %f\n",

139 
°¨t_off£t_nm
, 
íd_off£t_nm
);

141 i‡(
ovîÆl_a˘u©‹_dúe˘i⁄
 =
OVERALL_POSITIVE
)

142 
	`Ârötf
(
__OUTPUTFILE__
, "find_local_actuator_direction:: overall_actuator_direction = OVERALL_POSITIVE\n");

144 
	`Ârötf
(
__OUTPUTFILE__
, "find_local_actuator_direction:: overall_actuator_direction = OVERALL_NEGATIVE\n");

147 i‡((
°¨t_off£t_nm
 <0.0Ë&& (
íd_off£t_nm
 <= 0.0)) {

149 i‡(
ovîÆl_a˘u©‹_dúe˘i⁄
 =
OVERALL_POSITIVE
) {

150 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_local_actuator_direction::Üocal_actuator_direction is INWARD (1)\n");

151  
INWARD
;

153 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_local_actuator_direction::Üocal_actuator_direction is OUTWARD (2)\n");

154  
OUTWARD
;

156 } i‡((
°¨t_off£t_nm
 >0.0Ë&& (
íd_off£t_nm
 >= 0.0)) {

158 i‡(
ovîÆl_a˘u©‹_dúe˘i⁄
 =
OVERALL_POSITIVE
) {

159 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_local_actuator_direction::Üocal_actuator_direction is OUTWARD (3)\n");

160  
OUTWARD
;

162 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_local_actuator_direction::Üocal_actuator_direction is OUTWARD (4)\n");

163  
INWARD
;

167 i‡(
	`Ábs
(
°¨t_off£t_nm
Ë> fabs(
íd_off£t_nm
)) {

169 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_local_actuator_direction::Üocal_actuator_direction is INWARD (5)\n");

170  
INWARD
;

172 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_local_actuator_direction::Üocal_actuator_direction is OUTWARD (6)\n");

173  
OUTWARD
;

176 
	}
}

220 
	$adju°_ac˚l
(
ac˚l
, 
•rög_Á˘‹
,

221 
off£t_1
, 
off£t_2
,

222 
Àngth
, 
ovîÆl_a˘u©‹_dúe˘i⁄
) {

224 
adju°ed_ac˚l
;

226 i‡(
	`föd_loˇl_a˘u©‹_dúe˘i⁄
(
off£t_1
, 
off£t_2
, 
ovîÆl_a˘u©‹_dúe˘i⁄
Ë=
INWARD
) {

228 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "adjust_accel:: springs helped!\n");

231 
•rög_Á˘‹
 = -spring_factor;

232 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "adjust_accel:: springs hurt!\n");

235 
adju°ed_ac˚l
 =

237 (
ac˚l


239 (
ac˚l
 * (
•rög_Á˘‹
 * (
	`Ábs
(
off£t_1
Ë/ (
Àngth
 / 2))))

242 (
ac˚l


244 (
ac˚l
 * (
•rög_Á˘‹
 * (
	`Ábs
(
off£t_2
Ë/ (
Àngth
 / 2))))

248 i‡(
_VERBOSE_
) {

249 
	`Ârötf
(
__OUTPUTFILE__
, "adjust_accel:: offset_1 = %f, offset_2 = %f,áccel = %f\n",

250 
off£t_1
, 
off£t_2
, 
ac˚l
);

251 
	`Ârötf
(
__OUTPUTFILE__
, "adjust_accel:: spring_factor = %f,Üength = %f\n",

252 
•rög_Á˘‹
, 
Àngth
);

253 
	`Ârötf
(
__OUTPUTFILE__
, "adjust_accel::ádjusted_accel = %f, diff = %f\n",

254 
adju°ed_ac˚l
, (◊dju°ed_ac˚»/ 
ac˚l
) * 100.0) - 100.0);

257  
adju°ed_ac˚l
;

258 
	}
}

283 
	$föd_swôch_off£t_‰om_di°
 (
°¨t_off£t_nm
, 
íd_off£t_nm
,

284 
di°_nm
, 
dúe˘i⁄
) {

286 
swôch_off£t_nm
;

288 i‡(
dúe˘i⁄
 =
OVERALL_POSITIVE
) {

289 
swôch_off£t_nm
 = 
°¨t_off£t_nm
 + (
di°_nm
 / 2);

291 
swôch_off£t_nm
 = 
°¨t_off£t_nm
 - (
di°_nm
 / 2);

294  
swôch_off£t_nm
;

295 
	}
}

318 
	$föd_ovîÆl_£ek_dúe˘i⁄
(
°¨t_off£t_nm
, 
íd_off£t_nm
) {

320 i‡(
íd_off£t_nm
 > 
°¨t_off£t_nm
) {

321  
OVERALL_POSITIVE
;

323  
OVERALL_NEGATIVE
;

326 
	}
}

360 
	$föd_£ek_time_põ˚wi£
(
°¨t_off£t_nm
, 
íd_off£t_nm
,

361 
•rög_Á˘‹
, 
ac˚Àøti⁄_nm_s_s
,

362 
Àngth_nm
, 
vñocôy_nm_s
) {

364 
di°_nm
;

365 
pha£1_di°_nm
;

366 
pha£2_di°_nm
;

367 
pha£1_chunk_Àngth_nm
;

368 
pha£2_chunk_Àngth_nm
;

369 
pha£1_ac˚Àøti⁄_nm_s_s
;

370 
pha£2_ac˚Àøti⁄_nm_s_s
;

371 
x
[2 * 
NUM_CHUNKS
 + 1];

372 
v
[2 * 
NUM_CHUNKS
 + 1];

373 
a
[2 * 
NUM_CHUNKS
 + 1];

374 
t
[2 * 
NUM_CHUNKS
 + 1];

376 
x_swôch
, 
v_swôch
, 
a_swôch
, 
t_swôch
;

377 
v_diff
, 
x_dñè
;

379 
mö_v_diff
;

380 
mö_v_diff_time
 = 0.0;

382 
tŸÆ_£ek_time
;

384 
i
, 
jj
;

385 
ovîÆl_£ek_dúe˘i⁄
;

386 
pha£1_a˘u©‹_dúe˘i⁄
, 
pha£2_a˘u©‹_dúe˘i⁄
;

388 
mö_v_diff
 = 666.0;

390 i‡(
_VERBOSE_
) {

391 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: **Éntry - start_offset_nm = %f,Énd_offset_nm = %f\n",

392 
°¨t_off£t_nm
, 
íd_off£t_nm
);

396 
di°_nm
 = 
	`föd_di°_nm
(
°¨t_off£t_nm
, 
íd_off£t_nm
);

397 
ovîÆl_£ek_dúe˘i⁄
 = 
	`föd_ovîÆl_£ek_dúe˘i⁄
(
°¨t_off£t_nm
, 
íd_off£t_nm
);

400 
x
[0] = 
°¨t_off£t_nm
;

401 
x
[
SWITCH_POINT
] = 
	`föd_swôch_off£t_‰om_di°
(
°¨t_off£t_nm
, 
íd_off£t_nm
,

402 
di°_nm
, 
ovîÆl_£ek_dúe˘i⁄
);

431 
jj
 = 1; jj < 
MEMS_SWITCH_ITERATIONS
; jj++) {

434 
pha£1_di°_nm
 = 
	`föd_di°_nm
(
°¨t_off£t_nm
, 
x
[
SWITCH_POINT
]);

435 
pha£2_di°_nm
 = 
	`föd_di°_nm
(
x
[
SWITCH_POINT
], 
íd_off£t_nm
);

438 
pha£1_chunk_Àngth_nm
 = 
pha£1_di°_nm
 / 
NUM_CHUNKS
;

439 
pha£2_chunk_Àngth_nm
 = 
pha£2_di°_nm
 / 
NUM_CHUNKS
;

441 i‡(
_VERBOSE_
) {

442 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise::Öhase1_dist_nm = %f,Öhase1_chunk_length_nm = %f\n",

443 
pha£1_di°_nm
, 
pha£1_chunk_Àngth_nm
);

444 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise::Öhase2_dist_nm = %f,Öhase2_chunk_length_nm = %f\n",

445 
pha£2_di°_nm
, 
pha£2_chunk_Àngth_nm
);

448 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: ** figuring outÖhase 1 x values\n");

451 
i
 = 1; i < 
SWITCH_POINT
; i++) {

452 i‡(
ovîÆl_£ek_dúe˘i⁄
 =
OVERALL_POSITIVE
)

453 
x
[
i
] = x[i-1] + 
pha£1_chunk_Àngth_nm
;

455 
x
[
i
] = x[i-1] - 
pha£1_chunk_Àngth_nm
;

458 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: ** figuring outÖhase 2 x values\n");

461 
i
 = 
SWITCH_POINT
 + 1; i <2*
NUM_CHUNKS
; i++) {

462 i‡(
ovîÆl_£ek_dúe˘i⁄
 =
OVERALL_POSITIVE
)

463 
x
[
i
] = x[i-1] + 
pha£2_chunk_Àngth_nm
;

465 
x
[
i
] = x[i-1] - 
pha£2_chunk_Àngth_nm
;

469 
pha£1_ac˚Àøti⁄_nm_s_s
 = 
ac˚Àøti⁄_nm_s_s
;

470 
pha£2_ac˚Àøti⁄_nm_s_s
 = 
ac˚Àøti⁄_nm_s_s
;

473 i‡(
ovîÆl_£ek_dúe˘i⁄
 =
OVERALL_POSITIVE
) {

474 
pha£1_a˘u©‹_dúe˘i⁄
 = 
OVERALL_POSITIVE
;

475 
pha£2_a˘u©‹_dúe˘i⁄
 = 
OVERALL_NEGATIVE
;

477 
pha£1_a˘u©‹_dúe˘i⁄
 = 
OVERALL_NEGATIVE
;

478 
pha£2_a˘u©‹_dúe˘i⁄
 = 
OVERALL_POSITIVE
;

481 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: **ádjustingÖhase 1áccelerations\n");

485 
i
 = 1; i <
SWITCH_POINT
; i++) {

486 i‡(
_VERBOSE_
) {

487 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: i = %d, x[i-1] = %f, x[i] = %f\n",

488 
i
, 
x
[i-1], x[i]);

490 
a
[
i
] = 
	`adju°_ac˚l
(
pha£1_ac˚Àøti⁄_nm_s_s
, 
•rög_Á˘‹
,

491 
x
[
i
-1], x[i],

492 
Àngth_nm
, 
pha£1_a˘u©‹_dúe˘i⁄
);

495 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: **ádjustingÖhase 2áccelerations\n");

499 
i
 = 
SWITCH_POINT
 + 1; i <2*
NUM_CHUNKS
; i++) {

500 i‡(
_VERBOSE_
) {

501 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: i = %d, x[i-1] = %f, x[i] = %f\n",

502 
i
, 
x
[i-1], x[i]);

504 
a
[
i
] = 
	`adju°_ac˚l
(
pha£2_ac˚Àøti⁄_nm_s_s
, 
•rög_Á˘‹
,

505 
x
[
i
-1], x[i],

506 
Àngth_nm
, 
pha£2_a˘u©‹_dúe˘i⁄
);

510 
t
[0] = 0.0;

511 
v
[0] = 
vñocôy_nm_s
;

513 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: ** findingÖhase 1Å'sánd v's\n");

516 
i
 = 1; i <
SWITCH_POINT
; i++) {

517 i‡(
_VERBOSE_
) {

518 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: v[i-1] = %f,á[i] = %f,Å[i-1] = %f, x[i-1] = %f, x[i] = %f\n",

519 
v
[
i
-1], 
a
[i], 
t
[i-1], 
x
[i-1], x[i]);

521 
t
[
i
] = (

522 -(
v
[
i
-1] - (
a
[i] * 
t
[i-1]))

523 + 
	`sqπ
(

524 (
v
[
i
-1] * v[i-1]Ë+ ((2.0 * 
a
[i]Ë* 
	`Ábs
((
x
[i] - x[i-1])))

526 Ë/ (
a
[
i
]);

528 i‡(
_VERBOSE_
) {

529 
	`Ârötf
(
__OUTPUTFILE__
, "föd_£ek_time_põ˚wi£::Å[%d] = %f\n", 
i
, 
t
[i]);

532 
v
[
i
] = (

533 
v
[
i
-1] + (
a
[i] * (
t
[i] -Å[i-1]))

536 i‡(
_VERBOSE_
) {

537 
	`Ârötf
(
__OUTPUTFILE__
, "föd_£ek_time_põ˚wi£:: v[%d] = %f\n", 
i
, 
v
[i]);

542 
tŸÆ_£ek_time
 = 
t
[
SWITCH_POINT
];

546 
x_swôch
 = 
x
[
SWITCH_POINT
];

547 
v_swôch
 = 
v
[
SWITCH_POINT
];

548 
a_swôch
 = 
a
[
SWITCH_POINT
];

549 
t_swôch
 = 
t
[
SWITCH_POINT
];

552 
t
[2*
NUM_CHUNKS
] = 0.0;

553 
v
[2*
NUM_CHUNKS
] = 
vñocôy_nm_s
;

555 i‡(
_VERBOSE_
Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: ** findingÖhase 2Å'sánd v's\n");

558 
i
 = 2*
NUM_CHUNKS
 - 1; i >
SWITCH_POINT
; i--) {

559 i‡(
_VERBOSE_
) {

560 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: v[i+1] = %f,á[i] = %f,Å[i+1] = %f, x[i+1] = %f, x[i] = %f\n",

561 
v
[
i
+1], 
a
[i], 
t
[i+1], 
x
[i+1], x[i]);

563 
t
[
i
] = (

564 -(
v
[
i
+1] - (
a
[i] * 
t
[i+1]))

565 + 
	`sqπ
(

566 (
v
[
i
+1] * v[i+1]Ë+ ((2.0 * 
a
[i]Ë* 
	`Ábs
((
x
[i+1] - x[i])))

568 Ë/ (
a
[
i
]);

570 i‡(
_VERBOSE_
) {

571 
	`Ârötf
(
__OUTPUTFILE__
, "föd_£ek_time_põ˚wi£::Å[%d] = %f\n", 
i
, 
t
[i]);

574 
v
[
i
] = (

575 
v
[
i
+1] + (
a
[i] * (
t
[i] -Å[i+1]))

578 i‡(
_VERBOSE_
) {

579 
	`Ârötf
(
__OUTPUTFILE__
, "föd_£ek_time_põ˚wi£:: v[%d] = %f\n", 
i
, 
v
[i]);

584 
tŸÆ_£ek_time
 +
t
[
SWITCH_POINT
];

587 i‡(
_VERBOSE_
) {

588 
i
 = 0; i <2 * 
NUM_CHUNKS
; i++) {

589 i‡(
i
 =
SWITCH_POINT
) {

590 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: x[%d] = %f,á[%d] = %f, v[%d] = %f,Å[%d] = %f ** SWITCH_POINT **\n",

591 
i
, 
x
[i], i, 
a
[i], i, 
v
[i], i, 
t
[i]);

593 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: x[%d] = %f,á[%d] = %f, v[%d] = %f,Å[%d] = %f\n",

594 
i
, 
x
[i], i, 
a
[i], i, 
v
[i], i, 
t
[i]);

598 
	`Ârötf
(
__OUTPUTFILE__
, "föd_£ek_time_põ˚wi£::ÅŸÆ_£ek_timê%f\n", 
	`Ábs
(
tŸÆ_£ek_time
));

600 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: x_switch = %f, x[SWITCH_POINT] = %f, diff = %f\n",

601 
x_swôch
, 
x
[
SWITCH_POINT
], ((x_switch / x[SWITCH_POINT]) * 100.0) - 100.0);

602 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: v_switch = %f, v[SWITCH_POINT] = %f, diff = %f\n",

603 
v_swôch
, 
v
[
SWITCH_POINT
], ((v_switch / v[SWITCH_POINT]) * 100.0) - 100.0);

604 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise::á_switch = %f,á[SWITCH_POINT] = %f, diff = %f\n",

605 
a_swôch
, 
a
[
SWITCH_POINT
], ((a_switch /á[SWITCH_POINT]) * 100.0) - 100.0);

606 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise::Å_switch = %f,Å[SWITCH_POINT] = %f, diff = %f\n",

607 
t_swôch
, 
t
[
SWITCH_POINT
], ((t_switch /Å[SWITCH_POINT]) * 100.0) - 100.0);

608 
	`Ârötf
(
__OUTPUTFILE__
, "föd_£ek_time_põ˚wi£::ÅryögÅÿfödÇew swôchÖoöt. jj = %d\n", 
jj
);

612 
v_diff
 = ((
v_swôch
 / 
v
[
SWITCH_POINT
]) * 100.0) - 100.0;

615 i‡(
•rög_Á˘‹
 == 0.0) {

616 
mö_v_diff_time
 = 
tŸÆ_£ek_time
;

621 
x_dñè
 = (
MEMS_SHIFT_PERCENTAGE
 - (1.0 / ((
MEMS_SWITCH_ITERATIONS
 - 
jj
) * 100.0)));

624 i‡(
v_swôch
 > 
v
[
SWITCH_POINT
]) {

626 i‡(
ovîÆl_£ek_dúe˘i⁄
 =
OVERALL_POSITIVE
) {

627 
x_dñè
 = -x_delta;

630 i‡(
ovîÆl_£ek_dúe˘i⁄
 =
OVERALL_NEGATIVE
) {

631 
x_dñè
 = -x_delta;

636 
x
[
SWITCH_POINT
] +
x_dñè
 * 
di°_nm
;

638 i‡(
_VERBOSE_
) {

639 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: shifting x_switch. x_delta = %f, x_delta_nm = %f, v_diff = %f\n",

640 
x_dñè
, (x_dñè * 
di°_nm
), 
v_diff
);

642 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: x_switch = %f, x[SWITCH_POINT] = %f, diff = %f\n",

643 
x_swôch
, 
x
[
SWITCH_POINT
], ((x_switch / x[SWITCH_POINT]) * 100.0) - 100.0);

646 
x
[0] = 
°¨t_off£t_nm
;

648 i‡(
_VERBOSE_
) {

649 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: min_v_diff = %f, v_diff = %f\n",

650 
mö_v_diff
, 
v_diff
);

654 i‡(
	`Ábs
(
v_diff
Ë< 
mö_v_diff
) {

655 
mö_v_diff
 = 
	`Ábs
(
v_diff
);

656 
mö_v_diff_time
 = 
tŸÆ_£ek_time
;

657 i‡(
_VERBOSE_
) {

658 
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise:: updating min_v_diff\n");

659 i‡(
mö_v_diff
 =0.0Ë
	`Ârötf
(
__OUTPUTFILE__
, "find_seek_time_piecewise::áugh!!! min_v_diff is zero!\n");

665  
	`Ábs
(
mö_v_diff_time
);

666 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_piecewise_seek.h

33 #i‚de‡
_MEMS_PIECEWISE_SEEK_H_


34 
	#_MEMS_PIECEWISE_SEEK_H_


	)

36 
	#_VERBOSE_
 0

	)

38 
	#NUM_CHUNKS
 8

39 
	#SWITCH_POINT
 (2 * 
NUM_CHUNKS
 / 2)

40 

	)

41 
	#MEMS_SWITCH_ITERATIONS
 9

42 
	#MEMS_SHIFT_PERCENTAGE
 0.05

43 

	)

44 
	#INWARD
 1

	)

45 
	#OUTWARD
 2

	)

47 
	#OVERALL_POSITIVE
 1

	)

48 
	#OVERALL_NEGATIVE
 2

	)

51 
föd_di°_nm
(
°¨t_off£t
, 
íd_off£t
);

54 
föd_£ek_time_põ˚wi£
(
°¨t_off£t_nm
, 
íd_off£t_nm
,

55 
•rög_Á˘‹
, 
ac˚Àøti⁄_nm_s_s
,

56 
Àngth_nm
, 
vñocôy_nm_s
);

58 
föd_di°_nm
(
°¨t_off£t
, 
íd_off£t
);

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_seektest.c

33 
	~<°dlib.h
>

34 
	~<°dio.h
>

35 
	~<m©h.h
>

37 
	~"mems_öã∫Æs.h
"

38 
	~"disksim_mÆloc.h
"

40 
	$öôülize_devi˚
(
mems_t
 *
dev
,

41 
•rög_Á˘‹
,

42 
time_c⁄°™ts
,

43 
h⁄g
) {

45 
mems_¶ed_t
 *
¶ed
;

47 
¶ed
 = &(
dev
->sled[0]);

48 
¶ed
->
dev
 = dev;

50 
¶ed
->
pos
.
x_pos
 = 0;

51 
¶ed
->
pos
.
y_pos
 = 0;

52 
¶ed
->
pos
.
y_vñ
 = 0;

54 
¶ed
->
x_ac˚l_nm_s2
 = 746.2 * 1000000000.0;

55 
¶ed
->
y_ac˚l_nm_s2
 = 746.2 * 1000000000.0;

56 
¶ed
->
bô_Àngth_nm
 = 50.0;

57 
¶ed
->
y_ac˚ss_•ìd_bô_s
 = 200000;

58 
¶ed
->
x_Àngth_nm
 = 2000.0 * 50.0;

59 
¶ed
->
y_Àngth_nm
 = 2000.0 * 50.0;

60 
¶ed
->
•rög_Á˘‹
 = spring_factor;

62 
¶ed
->
num_time_c⁄°™ts
 = 
time_c⁄°™ts
;

63 
¶ed
->
¶ed_ªs⁄™t_‰eq_hz
 = 739;

65 
¶ed
->
£rvo_bur°_Àngth_bôs
 = 10;

66 
¶ed
->
tù_£˘‹_Àngth_bôs
 = 80;

67 
¶ed
->
tù_£˘‹s_≥r_lbn
 = 64;

69 
dev
->
¥ecompuã_£ek_cou¡
 = 0;

70 
dev
->
£ek_fun˘i⁄
 = 
h⁄g
;

73 
	}
}

75 
	$maö
(
¨gc
, *
¨gv
[]) {

77 
mems_t
 
dev
;

78 
co‹d_t
 
begö
, 
íd
;

80 
•rög_Á˘‹
 = 0.0;

81 
ac˚l
;

82 
Àngth_nm
;

83 
vñocôy_nm_s
;

85 
£ek_time
;

86 
£ek_time_zîo
 = 0.0;

88 
bô_°ï
 = 10;

89 
i
;

90 
vîbo£
 = 0;

91 
thªe_dì
 = 0;

92 
m©hem©iˇ
 = 0;

93 
å™•o£
 = 0;

94 
h⁄g
 = 0;

96 
time_c⁄°™ts
 = 0.0;

98 
x_pos
, 
y_pos
;

99 
begö
.
x_pos
 = 1000;

100 
begö
.
y_pos
 = 1000;

105 
•rög_Á˘‹
 = 0.0;

107 
i
 = 0; i < 
¨gc
; i++) {

108 i‡(
	`°rcmp
(
¨gv
[
i
], "-v") == 0)

109 
vîbo£
 = 1;

110 i‡(
	`°rcmp
(
¨gv
[
i
], "-spring") == 0)

111 
•rög_Á˘‹
 = 
	`©of
(
¨gv
[
i
+1]);

112 i‡(
	`°rcmp
(
¨gv
[
i
], "-step") == 0)

113 
bô_°ï
 = 
	`©oi
(
¨gv
[
i
+1]);

114 i‡(
	`°rcmp
(
¨gv
[
i
], "-start") == 0)

116 i‡(
	`°rcmp
(
¨gv
[
i
], "-end") == 0)

118 i‡(
	`°rcmp
(
¨gv
[
i
], "-3d") == 0)

119 
thªe_dì
 = 1;

120 i‡(
	`°rcmp
(
¨gv
[
i
], "-num") == 0)

121 
time_c⁄°™ts
 = 
	`©of
(
¨gv
[
i
+1]);

122 i‡(
	`°rcmp
(
¨gv
[
i
], "-x") == 0)

123 
begö
.
x_pos
 = 
	`©oi
(
¨gv
[
i
+1]);

124 i‡(
	`°rcmp
(
¨gv
[
i
], "-y") == 0)

125 
begö
.
y_pos
 = 
	`©oi
(
¨gv
[
i
+1]);

126 i‡(
	`°rcmp
(
¨gv
[
i
], "-math") == 0)

127 
m©hem©iˇ
 = 
	`©oi
(
¨gv
[
i
+1]);

128 i‡(
	`°rcmp
(
¨gv
[
i
], "-transpose") == 0)

129 
å™•o£
 = 1;

130 i‡(
	`°rcmp
(
¨gv
[
i
], "-hong") == 0)

131 
h⁄g
 = 1;

134 
ac˚l
 = 746.2 * 1000000000.0;

135 
Àngth_nm
 = 2000.0 * 50.0;

137 
vñocôy_nm_s
 = 0.0;

139 
dev
.
¶ed
 = 
	`mÆloc
((
mems_¶ed_t
));

141 
	`öôülize_devi˚
(&
dev
,

142 
•rög_Á˘‹
,

143 
time_c⁄°™ts
,

144 
h⁄g
);

146 
begö
.
y_vñ
 = 0;

148 
íd
.
x_pos
 = 0;

149 
íd
.
y_pos
 = 0;

150 
íd
.
y_vñ
 = 0;

154 
x_pos
 = -1000; x_po†<1000; x_po†+
bô_°ï
) {

155 
y_pos
 = -1000; y_po†<1000; y_po†+
bô_°ï
) {

164 i‡(!
å™•o£
) {

165 
íd
.
x_pos
 = x_pos;

166 
íd
.
y_pos
 = y_pos;

168 
íd
.
x_pos
 = 
y_pos
;

169 
íd
.
y_pos
 = 
x_pos
;

172 i‡(
vîbo£
Ë
	`Ârötf
(
°dout
, "main: startingáÇew seek (monkey)\n");

174 
£ek_time
 = 
	`mems_£ek_time
(&(
dev
.
¶ed
[0]),

175 &
begö
, &
íd
,

176 
NULL
, NULL,

177 
NULL
, NULL);

179 
•rög_Á˘‹
 = 
dev
.
¶ed
[0].spring_factor;

180 
dev
.
¶ed
[0].
•rög_Á˘‹
 = 0.0;

182 
£ek_time_zîo
 = 
	`mems_£ek_time
(&(
dev
.
¶ed
[0]),

183 &
begö
, &
íd
,

184 
NULL
, NULL,

185 
NULL
, NULL);

187 
dev
.
¶ed
[0].
•rög_Á˘‹
 = spring_factor;

189 i‡(
vîbo£
Ë
	`Ârötf
(
°dout
, "goose\n");

190 i‡(
m©hem©iˇ
 == 1) {

191 
	`Ârötf
(
°dout
, "%‡", 
£ek_time
);

192 } i‡(
m©hem©iˇ
 == 2) {

193 
	`Ârötf
(
°dout
, "%‡", (
£ek_time
 - 
£ek_time_zîo
));

195 i‡(!
å™•o£
) {

196 
	`Ârötf
(
°dout
, "%d %d %f %f %f\n",

197 
x_pos
, 
y_pos
, 
£ek_time
, 
£ek_time_zîo
, (seek_time - seek_time_zero));

199 
	`Ârötf
(
°dout
, "%d %d %f %f %f\n",

200 
y_pos
, 
x_pos
, 
£ek_time
, 
£ek_time_zîo
, (seek_time - seek_time_zero));

210 i‡(
m©hem©iˇ
 !0Ë
	`Ârötf
(
°dout
, "\n");

213 
	`‰ì
(
dev
.
¶ed
);

216 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/memsmodel/modules/memsmodel_mems_param.c

1 
	~"memsmodñ_mems_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../mems_globÆ.h
"

5 
	$MEMSMODEL_MEMS_SCHEDULER_dïíd
(*
bv
)

8 
	}
}

11 
	$MEMSMODEL_MEMS_SCHEDULER_lﬂdî
(
mems
 * 
ªsu…
, 
Õ_block
 * 
blk
)

13 i‡(!(
ªsu…
->
queue
 = (
ioq
 *Ë
	`disksim_ioqueue_lﬂd∑øms
(
blk
, 
devi˚_¥ötqueue°©s
, 
devi˚_¥öt¸ô°©s
, 
devi˚_¥ötidÀ°©s
, 
devi˚_¥ötöèº°©s
, 
devi˚_¥ötsize°©s
))) {

16 
	}
}

19 
	$MEMSMODEL_MEMS_POINTS_IN_PRECOMPUTED_SEEK_CURVE_dïíd
(*
bv
)

22 
	}
}

25 
	$MEMSMODEL_MEMS_POINTS_IN_PRECOMPUTED_SEEK_CURVE_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

27 i‡(!((
i
 >= 0))) {

30 
ªsu…
->
¥ecompuã_£ek_cou¡
 = (
i
 == 0) ? 0 : i + 1;

32 
	}
}

35 
	$MEMSMODEL_MEMS_SEEK_FUNCTION_dïíd
(*
bv
)

38 
	}
}

41 
	$MEMSMODEL_MEMS_SEEK_FUNCTION_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

43 i‡(!(
	`RANGE
(
i
, 0, 1))) {

46 
ªsu…
->
£ek_fun˘i⁄
 = 
i
;

48 
	}
}

51 
	$MEMSMODEL_MEMS_MAX_QUEUE_LENGTH_dïíd
(*
bv
)

54 
	}
}

57 
	$MEMSMODEL_MEMS_MAX_QUEUE_LENGTH_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

59 i‡(!((
i
 >= 0))) {

62 
ªsu…
->
maxqÀn
 = 
i
;

64 
	}
}

67 
	$MEMSMODEL_MEMS_BULK_SECTOR_TRANSFER_TIME_dïíd
(*
bv
)

70 
	}
}

73 
	$MEMSMODEL_MEMS_BULK_SECTOR_TRANSFER_TIME_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

75 i‡(!((
d
 >= 0.0))) {

78 
ªsu…
->
blkå™°ime
 = 
d
;

80 
	}
}

83 
	$MEMSMODEL_MEMS_SEGMENT_SIZE__dïíd
(*
bv
)

86 
	}
}

89 
	$MEMSMODEL_MEMS_SEGMENT_SIZE__lﬂdî
(
mems
 * 
ªsu…
, 
i
)

91 i‡(!((
i
 >= 0))) {

94 
ªsu…
->
£gsize
 = 
i
;

96 
	}
}

99 
	$MEMSMODEL_MEMS_NUMBER_OF_BUFFER_SEGMENTS_dïíd
(*
bv
)

102 
	}
}

105 
	$MEMSMODEL_MEMS_NUMBER_OF_BUFFER_SEGMENTS_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

107 i‡(!((
i
 >= 0))) {

110 
ªsu…
->
num£gs
 = 
i
;

112 
	}
}

115 
	$MEMSMODEL_MEMS_PRINT_STATS_dïíd
(*
bv
)

118 
	}
}

121 
	$MEMSMODEL_MEMS_PRINT_STATS_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

123 i‡(!(
	`RANGE
(
i
, 0, 1))) {

126 
ªsu…
->
¥öt°©s
 = 
i
;

128 
	}
}

131 
	$MEMSMODEL_MEMS_COMMAND_OVERHEAD_dïíd
(*
bv
)

134 
	}
}

137 
	$MEMSMODEL_MEMS_COMMAND_OVERHEAD_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

139 i‡(!((
d
 >= 0.0))) {

142 
ªsu…
->
ovîhód
 = 
d
;

144 
	}
}

147 
	$MEMSMODEL_MEMS_NUMBER_OF_SLEDS_dïíd
(*
bv
)

150 
	}
}

153 
	$MEMSMODEL_MEMS_NUMBER_OF_SLEDS_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

155 i‡(!((
i
 >= 0))) {

158 
ªsu…
->
num_¶eds
 = 
i
;

159 
ªsu…
->
¶ed
 = 
	`mÆloc
(
i
 * (
mems_¶ed_t
));

160 
	`bzîo
(
ªsu…
->
¶ed
, 
i
 * (
mems_¶ed_t
));

162 
	}
}

165 
	$MEMSMODEL_MEMS_LAYOUT_POLICY_dïíd
(*
bv
)

167 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

168  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

171 
	}
}

174 
	$MEMSMODEL_MEMS_LAYOUT_POLICY_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

176 i‡(!((
i
 >= 0))) {

179 
ªsu…
->
¶ed
[0].
œyout_pﬁicy
 = 
i
;

181 
	}
}

184 
	$MEMSMODEL_MEMS_SLED_MOVEMENT_X_dïíd
(*
bv
)

186 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

187  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

190 
	}
}

193 
	$MEMSMODEL_MEMS_SLED_MOVEMENT_X_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

195 i‡(!((
i
 >= 0))) {

198 
ªsu…
->
¶ed
[0].
x_Àngth_nm
 = 
i
;

200 
	}
}

203 
	$MEMSMODEL_MEMS_SLED_MOVEMENT_Y_dïíd
(*
bv
)

205 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

206  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

209 
	}
}

212 
	$MEMSMODEL_MEMS_SLED_MOVEMENT_Y_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

214 i‡(!((
i
 >= 0))) {

217 
ªsu…
->
¶ed
[0].
y_Àngth_nm
 = 
i
;

219 
	}
}

222 
	$MEMSMODEL_MEMS_BIT_CELL_LENGTH_dïíd
(*
bv
)

224 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

225  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

228 
	}
}

231 
	$MEMSMODEL_MEMS_BIT_CELL_LENGTH_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

233 i‡(!((
i
 >= 0))) {

236 
ªsu…
->
¶ed
[0].
bô_Àngth_nm
 = 
i
;

238 
	}
}

241 
	$MEMSMODEL_MEMS_TIP_SECTOR_LENGTH_dïíd
(*
bv
)

243 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

244  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

247 
	}
}

250 
	$MEMSMODEL_MEMS_TIP_SECTOR_LENGTH_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

252 i‡(!((
i
 >= 0))) {

255 
ªsu…
->
¶ed
[0].
tù_£˘‹_Àngth_bôs
 = 
i
;

257 
	}
}

260 
	$MEMSMODEL_MEMS_SERVO_BURST_LENGTH_dïíd
(*
bv
)

262 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

263  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

266 
	}
}

269 
	$MEMSMODEL_MEMS_SERVO_BURST_LENGTH_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

271 i‡(!((
i
 >= 0))) {

274 
ªsu…
->
¶ed
[0].
£rvo_bur°_Àngth_bôs
 = 
i
;

276 
	}
}

279 
	$MEMSMODEL_MEMS_TIP_SECTORS_PER_LBN_dïíd
(*
bv
)

281 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

282  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

285 
	}
}

288 
	$MEMSMODEL_MEMS_TIP_SECTORS_PER_LBN_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

290 i‡(!((
i
 >= 0))) {

293 
ªsu…
->
¶ed
[0].
tù_£˘‹s_≥r_lbn
 = 
i
;

295 
	}
}

298 
	$MEMSMODEL_MEMS_NUMBER_OF_USABLE_TIPS_dïíd
(*
bv
)

300 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

301  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

304 
	}
}

307 
	$MEMSMODEL_MEMS_NUMBER_OF_USABLE_TIPS_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

309 i‡(!((
i
 >= 0))) {

312 
ªsu…
->
¶ed
[0].
tùs_ußbÀ
 = 
i
;

314 
	}
}

317 
	$MEMSMODEL_MEMS_SIMULTANEOUSLY_ACTIVE_TIPS_dïíd
(*
bv
)

319 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

320  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

323 
	}
}

326 
	$MEMSMODEL_MEMS_SIMULTANEOUSLY_ACTIVE_TIPS_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

328 i‡(!((
i
 >= 0))) {

331 
ªsu…
->
¶ed
[0].
tùs_simu…™eous
 = 
i
;

333 
	}
}

336 
	$MEMSMODEL_MEMS_BIDIRECTIONAL_ACCESS_dïíd
(*
bv
)

338 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

339  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

342 
	}
}

345 
	$MEMSMODEL_MEMS_BIDIRECTIONAL_ACCESS_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

347 i‡(!(
	`RANGE
(
i
, 0, 1))) {

350 
ªsu…
->
¶ed
[0].
bidúe˘i⁄Æ_ac˚ss
 = 
i
;

352 
	}
}

355 
	$MEMSMODEL_MEMS_SLED_ACCELERATION_X_dïíd
(*
bv
)

357 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

358  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

361 
	}
}

364 
	$MEMSMODEL_MEMS_SLED_ACCELERATION_X_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

366 i‡(!((
d
 >= 0.0))) {

369 
ªsu…
->
¶ed
[0].
x_ac˚l_nm_s2
 = 
d
 * 1000000000.0;

371 
	}
}

374 
	$MEMSMODEL_MEMS_SLED_ACCELERATION_Y_dïíd
(*
bv
)

376 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

377  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

380 
	}
}

383 
	$MEMSMODEL_MEMS_SLED_ACCELERATION_Y_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

385 i‡(!((
d
 >= 0.0))) {

388 
ªsu…
->
¶ed
[0].
y_ac˚l_nm_s2
 = 
d
 * 1000000000.0;

390 
	}
}

393 
	$MEMSMODEL_MEMS_SLED_ACCESS_SPEED_dïíd
(*
bv
)

395 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

396  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

399 
	}
}

402 
	$MEMSMODEL_MEMS_SLED_ACCESS_SPEED_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

404 i‡(!((
i
 >= 0))) {

407 
ªsu…
->
¶ed
[0].
y_ac˚ss_•ìd_bô_s
 = 
i
;

409 
	}
}

412 
	$MEMSMODEL_MEMS_SLED_RESONANT_FREQUENCY_dïíd
(*
bv
)

414 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

415  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

418 
	}
}

421 
	$MEMSMODEL_MEMS_SLED_RESONANT_FREQUENCY_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

423 i‡(!((
i
 >= 0))) {

426 
ªsu…
->
¶ed
[0].
¶ed_ªs⁄™t_‰eq_hz
 = 
i
;

428 
	}
}

431 
	$MEMSMODEL_MEMS_SETTLING_TIME_CONSTANTS_dïíd
(*
bv
)

433 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

434  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

437 
	}
}

440 
	$MEMSMODEL_MEMS_SETTLING_TIME_CONSTANTS_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

442 i‡(!((
d
 >= 0))) {

445 
ªsu…
->
¶ed
[0].
num_time_c⁄°™ts
 = 
d
;

447 
	}
}

450 
	$MEMSMODEL_MEMS_SPRING_CONSTANT_FACTOR_dïíd
(*
bv
)

452 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

453  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

456 
	}
}

459 
	$MEMSMODEL_MEMS_SPRING_CONSTANT_FACTOR_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

461 i‡(!((
d
 >= 0))) {

464 
ªsu…
->
¶ed
[0].
•rög_Á˘‹
 = 
d
;

466 
	}
}

469 
	$MEMSMODEL_MEMS_PREFETCH_DEPTH_dïíd
(*
bv
)

471 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

472  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

475 
	}
}

478 
	$MEMSMODEL_MEMS_PREFETCH_DEPTH_lﬂdî
(
mems
 * 
ªsu…
, 
i
)

480 i‡(!((
i
 >= 0))) {

483 
ªsu…
->
¶ed
[0].
¥e„tch_dïth
 = 
i
;

485 
	}
}

488 
	$MEMSMODEL_MEMS_TIME_BEFORE_SLED_INACTIVE_dïíd
(*
bv
)

490 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

491  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

494 
	}
}

497 
	$MEMSMODEL_MEMS_TIME_BEFORE_SLED_INACTIVE_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

499 i‡(!((
d
 >= 0.0))) {

502 
ªsu…
->
¶ed
[0].
öa˘ive_dñay_ms
 = 
d
;

504 
	}
}

507 
	$MEMSMODEL_MEMS_STARTUP_DELAY_dïíd
(*
bv
)

509 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

510  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

513 
	}
}

516 
	$MEMSMODEL_MEMS_STARTUP_DELAY_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

518 i‡(!((
d
 >= 0.0))) {

521 
ªsu…
->
¶ed
[0].
°¨tup_time_ms
 = 
d
;

523 
	}
}

526 
	$MEMSMODEL_MEMS_SLED_ACTIVE_POWER_dïíd
(*
bv
)

528 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

529  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

532 
	}
}

535 
	$MEMSMODEL_MEMS_SLED_ACTIVE_POWER_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

537 i‡(!((
d
 >= 0.0))) {

540 
ªsu…
->
¶ed
[0].
a˘ive_powî_mw
 = 
d
;

542 
	}
}

545 
	$MEMSMODEL_MEMS_SLED_INACTIVE_POWER_dïíd
(*
bv
)

547 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

548  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

551 
	}
}

554 
	$MEMSMODEL_MEMS_SLED_INACTIVE_POWER_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

556 i‡(!((
d
 >= 0.0))) {

559 
ªsu…
->
¶ed
[0].
öa˘ive_powî_mw
 = 
d
;

561 
	}
}

564 
	$MEMSMODEL_MEMS_TIP_ACCESS_POWER_dïíd
(*
bv
)

566 i‡(!
	`BIT_TEST
(
bv
, 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
)) {

567  
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
;

570 
	}
}

573 
	$MEMSMODEL_MEMS_TIP_ACCESS_POWER_lﬂdî
(
mems
 * 
ªsu…
, 
d
)

575 i‡(!((
d
 >= 0.0))) {

578 
ªsu…
->
¶ed
[0].
tù_powî_mw
 = 
d
;

580 
	}
}

582 *
	gMEMSMODEL_MEMS_lﬂdîs
[] = {

583 (*Ë
MEMSMODEL_MEMS_SCHEDULER_lﬂdî
,

584 (*Ë
MEMSMODEL_MEMS_POINTS_IN_PRECOMPUTED_SEEK_CURVE_lﬂdî
,

585 (*Ë
MEMSMODEL_MEMS_SEEK_FUNCTION_lﬂdî
,

586 (*Ë
MEMSMODEL_MEMS_MAX_QUEUE_LENGTH_lﬂdî
,

587 (*Ë
MEMSMODEL_MEMS_BULK_SECTOR_TRANSFER_TIME_lﬂdî
,

588 (*Ë
MEMSMODEL_MEMS_SEGMENT_SIZE__lﬂdî
,

589 (*Ë
MEMSMODEL_MEMS_NUMBER_OF_BUFFER_SEGMENTS_lﬂdî
,

590 (*Ë
MEMSMODEL_MEMS_PRINT_STATS_lﬂdî
,

591 (*Ë
MEMSMODEL_MEMS_COMMAND_OVERHEAD_lﬂdî
,

592 (*Ë
MEMSMODEL_MEMS_NUMBER_OF_SLEDS_lﬂdî
,

593 (*Ë
MEMSMODEL_MEMS_LAYOUT_POLICY_lﬂdî
,

594 (*Ë
MEMSMODEL_MEMS_SLED_MOVEMENT_X_lﬂdî
,

595 (*Ë
MEMSMODEL_MEMS_SLED_MOVEMENT_Y_lﬂdî
,

596 (*Ë
MEMSMODEL_MEMS_BIT_CELL_LENGTH_lﬂdî
,

597 (*Ë
MEMSMODEL_MEMS_TIP_SECTOR_LENGTH_lﬂdî
,

598 (*Ë
MEMSMODEL_MEMS_SERVO_BURST_LENGTH_lﬂdî
,

599 (*Ë
MEMSMODEL_MEMS_TIP_SECTORS_PER_LBN_lﬂdî
,

600 (*Ë
MEMSMODEL_MEMS_NUMBER_OF_USABLE_TIPS_lﬂdî
,

601 (*Ë
MEMSMODEL_MEMS_SIMULTANEOUSLY_ACTIVE_TIPS_lﬂdî
,

602 (*Ë
MEMSMODEL_MEMS_BIDIRECTIONAL_ACCESS_lﬂdî
,

603 (*Ë
MEMSMODEL_MEMS_SLED_ACCELERATION_X_lﬂdî
,

604 (*Ë
MEMSMODEL_MEMS_SLED_ACCELERATION_Y_lﬂdî
,

605 (*Ë
MEMSMODEL_MEMS_SLED_ACCESS_SPEED_lﬂdî
,

606 (*Ë
MEMSMODEL_MEMS_SLED_RESONANT_FREQUENCY_lﬂdî
,

607 (*Ë
MEMSMODEL_MEMS_SETTLING_TIME_CONSTANTS_lﬂdî
,

608 (*Ë
MEMSMODEL_MEMS_SPRING_CONSTANT_FACTOR_lﬂdî
,

609 (*Ë
MEMSMODEL_MEMS_PREFETCH_DEPTH_lﬂdî
,

610 (*Ë
MEMSMODEL_MEMS_TIME_BEFORE_SLED_INACTIVE_lﬂdî
,

611 (*Ë
MEMSMODEL_MEMS_STARTUP_DELAY_lﬂdî
,

612 (*Ë
MEMSMODEL_MEMS_SLED_ACTIVE_POWER_lﬂdî
,

613 (*Ë
MEMSMODEL_MEMS_SLED_INACTIVE_POWER_lﬂdî
,

614 (*Ë
MEMSMODEL_MEMS_TIP_ACCESS_POWER_lﬂdî


617 
Õ_∑ømdï_t
 
	gMEMSMODEL_MEMS_dïs
[] = {

618 
MEMSMODEL_MEMS_SCHEDULER_dïíd
,

619 
MEMSMODEL_MEMS_POINTS_IN_PRECOMPUTED_SEEK_CURVE_dïíd
,

620 
MEMSMODEL_MEMS_SEEK_FUNCTION_dïíd
,

621 
MEMSMODEL_MEMS_MAX_QUEUE_LENGTH_dïíd
,

622 
MEMSMODEL_MEMS_BULK_SECTOR_TRANSFER_TIME_dïíd
,

623 
MEMSMODEL_MEMS_SEGMENT_SIZE__dïíd
,

624 
MEMSMODEL_MEMS_NUMBER_OF_BUFFER_SEGMENTS_dïíd
,

625 
MEMSMODEL_MEMS_PRINT_STATS_dïíd
,

626 
MEMSMODEL_MEMS_COMMAND_OVERHEAD_dïíd
,

627 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS_dïíd
,

628 
MEMSMODEL_MEMS_LAYOUT_POLICY_dïíd
,

629 
MEMSMODEL_MEMS_SLED_MOVEMENT_X_dïíd
,

630 
MEMSMODEL_MEMS_SLED_MOVEMENT_Y_dïíd
,

631 
MEMSMODEL_MEMS_BIT_CELL_LENGTH_dïíd
,

632 
MEMSMODEL_MEMS_TIP_SECTOR_LENGTH_dïíd
,

633 
MEMSMODEL_MEMS_SERVO_BURST_LENGTH_dïíd
,

634 
MEMSMODEL_MEMS_TIP_SECTORS_PER_LBN_dïíd
,

635 
MEMSMODEL_MEMS_NUMBER_OF_USABLE_TIPS_dïíd
,

636 
MEMSMODEL_MEMS_SIMULTANEOUSLY_ACTIVE_TIPS_dïíd
,

637 
MEMSMODEL_MEMS_BIDIRECTIONAL_ACCESS_dïíd
,

638 
MEMSMODEL_MEMS_SLED_ACCELERATION_X_dïíd
,

639 
MEMSMODEL_MEMS_SLED_ACCELERATION_Y_dïíd
,

640 
MEMSMODEL_MEMS_SLED_ACCESS_SPEED_dïíd
,

641 
MEMSMODEL_MEMS_SLED_RESONANT_FREQUENCY_dïíd
,

642 
MEMSMODEL_MEMS_SETTLING_TIME_CONSTANTS_dïíd
,

643 
MEMSMODEL_MEMS_SPRING_CONSTANT_FACTOR_dïíd
,

644 
MEMSMODEL_MEMS_PREFETCH_DEPTH_dïíd
,

645 
MEMSMODEL_MEMS_TIME_BEFORE_SLED_INACTIVE_dïíd
,

646 
MEMSMODEL_MEMS_STARTUP_DELAY_dïíd
,

647 
MEMSMODEL_MEMS_SLED_ACTIVE_POWER_dïíd
,

648 
MEMSMODEL_MEMS_SLED_INACTIVE_POWER_dïíd
,

649 
MEMSMODEL_MEMS_TIP_ACCESS_POWER_dïíd


	@/Users/ysoh/disksim-4.0-fcl/memsmodel/modules/memsmodel_mems_param.h

2 #i‚de‡
_MEMSMODEL_MEMS_PARAM_H


3 
	#_MEMSMODEL_MEMS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
mems
 *
memsmodñ_mems_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
MEMSMODEL_MEMS_SCHEDULER
,

16 
MEMSMODEL_MEMS_POINTS_IN_PRECOMPUTED_SEEK_CURVE
,

17 
MEMSMODEL_MEMS_SEEK_FUNCTION
,

18 
MEMSMODEL_MEMS_MAX_QUEUE_LENGTH
,

19 
MEMSMODEL_MEMS_BULK_SECTOR_TRANSFER_TIME
,

20 
MEMSMODEL_MEMS_SEGMENT_SIZE_
,

21 
MEMSMODEL_MEMS_NUMBER_OF_BUFFER_SEGMENTS
,

22 
MEMSMODEL_MEMS_PRINT_STATS
,

23 
MEMSMODEL_MEMS_COMMAND_OVERHEAD
,

24 
MEMSMODEL_MEMS_NUMBER_OF_SLEDS
,

25 
MEMSMODEL_MEMS_LAYOUT_POLICY
,

26 
MEMSMODEL_MEMS_SLED_MOVEMENT_X
,

27 
MEMSMODEL_MEMS_SLED_MOVEMENT_Y
,

28 
MEMSMODEL_MEMS_BIT_CELL_LENGTH
,

29 
MEMSMODEL_MEMS_TIP_SECTOR_LENGTH
,

30 
MEMSMODEL_MEMS_SERVO_BURST_LENGTH
,

31 
MEMSMODEL_MEMS_TIP_SECTORS_PER_LBN
,

32 
MEMSMODEL_MEMS_NUMBER_OF_USABLE_TIPS
,

33 
MEMSMODEL_MEMS_SIMULTANEOUSLY_ACTIVE_TIPS
,

34 
MEMSMODEL_MEMS_BIDIRECTIONAL_ACCESS
,

35 
MEMSMODEL_MEMS_SLED_ACCELERATION_X
,

36 
MEMSMODEL_MEMS_SLED_ACCELERATION_Y
,

37 
MEMSMODEL_MEMS_SLED_ACCESS_SPEED
,

38 
MEMSMODEL_MEMS_SLED_RESONANT_FREQUENCY
,

39 
MEMSMODEL_MEMS_SETTLING_TIME_CONSTANTS
,

40 
MEMSMODEL_MEMS_SPRING_CONSTANT_FACTOR
,

41 
MEMSMODEL_MEMS_PREFETCH_DEPTH
,

42 
MEMSMODEL_MEMS_TIME_BEFORE_SLED_INACTIVE
,

43 
MEMSMODEL_MEMS_STARTUP_DELAY
,

44 
MEMSMODEL_MEMS_SLED_ACTIVE_POWER
,

45 
MEMSMODEL_MEMS_SLED_INACTIVE_POWER
,

46 
MEMSMODEL_MEMS_TIP_ACCESS_POWER


47 } 
	tmemsmodñ_mems_∑øm_t
;

49 
	#MEMSMODEL_MEMS_MAX_PARAM
 
MEMSMODEL_MEMS_TIP_ACCESS_POWER


	)

50 * 
MEMSMODEL_MEMS_lﬂdîs
[];

51 
Õ_∑ømdï_t
 
MEMSMODEL_MEMS_dïs
[];

54 
Õ_v¨•ec
 
	gmemsmodñ_mems_∑øms
 [] = {

55 {"ScheduÀr", 
BLOCK
, 1 },

56 {"Poöt†öÖªcompuãd sìk curve", 
I
, 1 },

57 {"Sìk fun˘i⁄", 
I
, 1 },

58 {"Max queuêÀngth", 
I
, 1 },

59 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

60 {"Segmíàsizê(ö blks)", 
I
, 1 },

61 {"Numbî o‡buf„∏£gmíts", 
I
, 1 },

62 {"Pröà°©s", 
I
, 1 },

63 {"Comm™d ovîhód", 
D
, 1 },

64 {"Numbî o‡¶eds", 
I
, 1 },

65 {"Layouàpﬁicy", 
I
, 1 },

66 {"SÀd movemíàX", 
I
, 1 },

67 {"SÀd movemíàY", 
I
, 1 },

68 {"Bô cñ»Àngth", 
I
, 1 },

69 {"Tù se˘‹Üígth", 
I
, 1 },

70 {"Sîvÿbur°Üígth", 
I
, 1 },

71 {"Tù se˘‹†≥∏lbn", 
I
, 1 },

72 {"Numbî o‡ußbÀÅùs", 
I
, 1 },

73 {"Simu…™eou¶yá˘ivêtùs", 
I
, 1 },

74 {"Bidúe˘i⁄Æác˚ss", 
I
, 1 },

75 {"SÀdác˚Àøti⁄ X", 
D
, 1 },

76 {"SÀdác˚Àøti⁄ Y", 
D
, 1 },

77 {"SÀdác˚s†•ìd", 
I
, 1 },

78 {"SÀdÑes⁄™à‰equícy", 
I
, 1 },

79 {"SëéögÅimêc⁄°™ts", 
D
, 1 },

80 {"S¥ög c⁄°™àÁ˘‹", 
D
, 1 },

81 {"Pª„tch dïth", 
I
, 1 },

82 {"Timêbef‹ê¶ed i«˘ive", 
D
, 1 },

83 {"Sèπu∞dñay", 
D
, 1 },

84 {"SÀdá˘ivêpowî", 
D
, 1 },

85 {"SÀd i«˘ivêpowî", 
D
, 1 },

86 {"Tùác˚s†powî", 
D
, 1 },

89 
	#MEMSMODEL_MEMS_MAX
 32

	)

90 
Õ_mod
 
	gmemsmodñ_mems_mod
 = { "memsmodñ_mems", 
memsmodñ_mems_∑øms
, 
MEMSMODEL_MEMS_MAX
, (
Õ_modlﬂdî_t
)
memsmodñ_mems_lﬂd∑øms
, 0, 0, 
MEMSMODEL_MEMS_lﬂdîs
, 
MEMSMODEL_MEMS_dïs
 };

93 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/memsmodel/modules/modules.h

2 #i‚de‡
_MEMSMODEL_MODULES_H


3 
	#_MEMSMODEL_MODULES_H


	)

6 
	~"memsmodñ_mems_∑øm.h
"

9 
Õ_mod
 *
	gmemsmodñ_mods
[] = {

10 &
memsmodñ_mems_mod


14 
	mMEMSMODEL_MOD_MEMS


15 } 
	tmemsmodñ_mod_t
;

17 
	#MEMSMODEL_MAX_MODULE
 0

	)

	@/Users/ysoh/disksim-4.0-fcl/src/config.h

33 
	~"ölöe.h
"

34 
	~<lib∑øm/lib∑øm.h
>

35 
	~<lib∑øm/bôve˘‹.h
>

36 
	~<libddbg/libddbg.h
>

	@/Users/ysoh/disksim-4.0-fcl/src/disksim.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_ioÁ˚.h
"

103 
	~"disksim_pfÁ˚.h
"

104 
	~"disksim_iŸø˚.h
"

105 
	~"c⁄fig.h
"

106 
	~"disksim_f˛.h
"

108 
	~"moduÀs/disksim_globÆ_∑øm.h
"

110 
	~<°dio.h
>

111 
	~<sig«l.h
>

112 
	~<°d¨g.h
>

114 #ifde‡
SUPPORT_CHECKPOINTS


115 
	~<uni°d.h
>

116 
	~<f˙é.h
>

117 
	~<sys/mm™.h
>

121 
disksim_t
 *
	gdisksim
 = 
NULL
;

124 
	#PRINT_TRACEFILE_HEADER
 
FALSE


	)

132 
	#EXTRAEVENTS
 32

	)

134 
	$Æloˇãexåa
 ()

136 
i
;

137 
evít
 *
ãmp
 = 
NULL
;

139 
	`SèticAs£π
 ((
evít
Ë=
DISKSIM_EVENT_SIZE
);

141 
ãmp
 = 
	`ˇŒoc
(
EXTRAEVENTS
, (
evít
));

145 
	`ddbg_as£π
(
ãmp
 != 0);

149 
i
 = 0; i < 
EXTRAEVENTS
; i++) {

150 
ãmp
[
i
].
√xt
 = &temp[i+1];

152 
ãmp
[
EXTRAEVENTS
-1].
√xt
 = 
disksim
->
exåaq
;

153 
disksim
->
exåaq
 = 
ãmp
;

154 
disksim
->
exåaqÀn
 +
EXTRAEVENTS
;

156 
	}
}

161 
	$addt€xåaq_check
(
evít
 *
ev
)

163 
evít
 *
ãmp
 = 
disksim
->
exåaq
;

165 
ãmp
 !
NULL
) {

166 i‡(
ev
 =
ãmp
) {

168 
	`ddbg_as£π
(
ev
 !
ãmp
);

170 
ãmp
 =Åemp->
√xt
;

173 
	}
}

177 
INLINE
 
	$addt€xåaq
 (
evít
 *
ãmp
)

181 i‡(
ãmp
 =
NULL
) {

184 
ãmp
->
√xt
 = 
disksim
->
exåaq
;

185 
ãmp
->
¥ev
 = 
NULL
;

186 
disksim
->
exåaq
 = 
ãmp
;

187 
disksim
->
exåaqÀn
++;

188 
	}
}

194 
INLINE
 
evít
 * 
	$gë‰omexåaq
 ()

196 
evít
 *
ãmp
;

198 if(
disksim
->
exåaqÀn
 == 0) {

199 
	`Æloˇãexåa
();

200 
ãmp
 = 
disksim
->
exåaq
;

201 
disksim
->
exåaq
 = disksim->exåaq->
√xt
;

203 if(
disksim
->
exåaqÀn
 == 1) {

204 
ãmp
 = 
disksim
->
exåaq
;

205 
disksim
->
exåaq
 = 
NULL
;

208 
ãmp
 = 
disksim
->
exåaq
;

209 
disksim
->
exåaq
 = disksim->exåaq->
√xt
;

212 
disksim
->
exåaqÀn
--;

213 
ãmp
->
√xt
 = 
NULL
;

214 
ãmp
->
¥ev
 = 
NULL
;

215  
ãmp
;

216 
	}
}

221 
	$addli°t€xåaq
 (
evít
 **
hód±r
)

223 
evít
 *
tmp1
, *
tmp2
;

225 
tmp1
 = *
hód±r
;

226 if(!
tmp1
) ;

235 
tmp2
 = 
tmp1
->
√xt
;

236 
	`addt€xåaq
(
tmp1
);

237 
tmp1
 = 
tmp2
;

238 } 
tmp1
 && (tmp1 !(*
hód±r
)));

240 *
hód±r
 = 
NULL
;

241 
	}
}

246 
evít
 *
	$evít_c›y
 (
evít
 *
‹ig
)

248 
evít
 *
√w
 = 
	`gë‰omexåaq
();

249 
	`memmove
((*)
√w
, (*)
‹ig
, 
DISKSIM_EVENT_SIZE
);

251 ((
evít
 *Ë
√w
);

252 
	}
}

260 
	$disksim_dumpötq
 ()

262 
evít
 *
tmp
;

263 
i
 = 0;

265 
tmp
 = 
disksim
->
ötq
;

266 
tmp
 !
NULL
) {

267 
i
++;

268 
	`Ârötf
 (
ouçutfûe
, "time %f,Åype %d\n",

269 
tmp
->
time
,Åmp->
ty≥
);

270 
tmp
 =Åmp->
√xt
;

272 
	}
}

281 
INLINE
 
	$addtoötq
 (
evít
 *
√wöt
)

289 i‡((
ãmp
->
time
 + 
DISKSIM_TIME_THRESHOLD
Ë< 
simtime
) {

290 
	`Ârötf
(
°dîr
, "AttemptingÅoáddtointqánÉvent whoseÅime hasÖassed\n");

291 
	`Ârötf
(
°dîr
, "simtimê%f, cuº->timê%f,Åy≥ = %d\n", 
simtime
, 
ãmp
->
time
,Åemp->
ty≥
);

292 
	`exô
(1);

297 
disksim
->
åa˚_mode
) {

298 
DISKSIM_MASTER
:

299 if(
	`wrôe
(
disksim
->
åa˚pùes
[1], (*)
√wöt
, (
evít
)) <= 0)

306 
DISKSIM_SLAVE
:

308 
evít
 
tm≥vt
;

309 
timediff
;

313 
	`ddbg_as£π
(
	`ªad
(
disksim
->
åa˚pùes
[0], (*)&
tm≥vt
, (
evít
)) > 0);

315 
timediff
 = 
	`Ábs
(
tm≥vt
.
time
 - 
√wöt
->time);

323 
	`ddbg_as£π
(
tm≥vt
.
ty≥
 =
√wöt
->type);

326 
√wöt
->
time
 = 
tm≥vt
.time;

327 if(
timediff
 > 0.000001) {

328 
	`¥ötf
("*** SLAVE:áddtoötq(Ëtimedif‡%f\n", 
timediff
);

330 
	`fÊush
(
°dout
);

334 
DISKSIM_NONE
:

340 i‡(
disksim
->
ötq
 =
NULL
) {

341 
disksim
->
ötq
 = 
√wöt
;

342 
√wöt
->
√xt
 = 
NULL
;

343 
√wöt
->
¥ev
 = 
NULL
;

345 i‡(
√wöt
->
time
 < 
disksim
->
ötq
->time) {

346 
√wöt
->
√xt
 = 
disksim
->
ötq
;

347 
disksim
->
ötq
->
¥ev
 = 
√wöt
;

348 
disksim
->
ötq
 = 
√wöt
;

349 
√wöt
->
¥ev
 = 
NULL
;

351 
evít
 *
run
 = 
disksim
->
ötq
;

352 
	`as£π
(
run
->
√xt
 !=Ñun);

353 
run
->
√xt
 !
NULL
) {

354 i‡(
√wöt
->
time
 < 
run
->
√xt
->time) {

357 
run
 =Ñun->
√xt
;

360 
√wöt
->
√xt
 = 
run
->next;

361 
run
->
√xt
 = 
√wöt
;

362 
√wöt
->
¥ev
 = 
run
;

363 i‡(
√wöt
->
√xt
 !
NULL
) {

364 
√wöt
->
√xt
->
¥ev
 =Çewint;

367 
	}
}

372 
INLINE
 
evít
 * 
	$gë‰omötq
 ()

374 
evít
 *
ãmp
 = 
NULL
;

376 i‡(
disksim
->
ötq
 =
NULL
) {

377 (
NULL
);

379 
ãmp
 = 
disksim
->
ötq
;

380 
disksim
->
ötq
 = disksim->ötq->
√xt
;

381 i‡(
disksim
->
ötq
 !
NULL
) {

382 
disksim
->
ötq
->
¥ev
 = 
NULL
;

385 
ãmp
->
√xt
 = 
NULL
;

386 
ãmp
->
¥ev
 = 
NULL
;

387 (
ãmp
);

388 
	}
}

394 
INLINE
 
	$ªmove‰omötq
 (
evít
 *
cuº
)

396 
evít
 *
tmp
;

398 
tmp
 = 
disksim
->
ötq
;

399 
tmp
 !
NULL
) {

400 i‡(
tmp
 =
cuº
) {

403 
tmp
 =Åmp->
√xt
;

405 i‡(
tmp
 =
NULL
) {

406 (
FALSE
);

408 i‡(
cuº
->
√xt
 !
NULL
) {

409 
cuº
->
√xt
->
¥ev
 = curr->prev;

411 i‡(
cuº
->
¥ev
 =
NULL
) {

412 
disksim
->
ötq
 = 
cuº
->
√xt
;

414 
cuº
->
¥ev
->
√xt
 = curr->next;

417 
cuº
->
√xt
 = 
NULL
;

418 
cuº
->
¥ev
 = 
NULL
;

419 (
TRUE
);

420 
	}
}

425 
	$sˇ≈¨am_öt
 (*
∑æöe
, *
∑∫ame
, *
∑Ωå
,

426 
∑rchecks
, 
∑rmövÆ
, 
∑rmaxvÆ
)

428 i‡(
	`ssˇnf
(
∑æöe
, "%d", 
∑Ωå
) != 1) {

429 
	`Ârötf
(
°dîr
, "Eº‹Ñódög '%s'\n", 
∑∫ame
);

430 
	`exô
(1);

432 i‡(((
∑rchecks
 & 1Ë&& (*
∑Ωå
 < 
∑rmövÆ
)Ë|| (’¨check†& 2Ë&& (*∑Ωå > 
∑rmaxvÆ
))) {

433 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ '%s': %d\n", 
∑∫ame
, *
∑Ωå
);

434 
	`exô
(1);

436 
	}
}

439 
	$gë∑øm_öt
 (
FILE
 *
∑rfûe
, *
∑∫ame
, *
∑Ωå
,

440 
∑rchecks
, 
∑rmövÆ
, 
∑rmaxvÆ
)

442 
löe
[201];

444 
	`•rötf
(
löe
, "%s: %s", 
∑∫ame
, "%d");

445 i‡(
	`fsˇnf
(
∑rfûe
, 
löe
, 
∑Ωå
) != 1) {

446 
	`Ârötf
(
°dîr
, "Eº‹Ñódög '%s'\n", 
∑∫ame
);

447 
	`exô
(1);

449 
	`fgës
(
löe
, 200, 
∑rfûe
);

450 i‡(((
∑rchecks
 & 1Ë&& (*
∑Ωå
 < 
∑rmövÆ
)Ë|| (’¨check†& 2Ë&& (*∑Ωå > 
∑rmaxvÆ
))) {

451 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ '%s': %d\n", 
∑∫ame
, *
∑Ωå
);

452 
	`exô
(1);

454 
	`Ârötf
 (
ouçutfûe
, "%s: %d\n", 
∑∫ame
, *
∑Ωå
);

455 
	}
}

458 
	$gë∑øm_doubÀ
 (
FILE
 *
∑rfûe
, *
∑∫ame
, *
∑Ωå
,

459 
∑rchecks
, 
∑rmövÆ
, 
∑rmaxvÆ
)

461 
löe
[201];

463 
	`•rötf
(
löe
, "%s: %s", 
∑∫ame
, "%lf");

464 i‡(
	`fsˇnf
(
∑rfûe
, 
löe
, 
∑Ωå
) != 1) {

465 
	`Ârötf
(
°dîr
, "Eº‹Ñódög '%s'\n", 
∑∫ame
);

466 
	`as£π
(0);

468 
	`fgës
(
löe
, 200, 
∑rfûe
);

469 i‡(((
∑rchecks
 & 1Ë&& (*
∑Ωå
 < 
∑rmövÆ
)Ë|| (’¨check†& 2Ë&& (*∑Ωå > 
∑rmaxvÆ
)) || ((parchecks & 4) && (*parptr <=Öarminval))) {

470 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ '%s': %f\n", 
∑∫ame
, *
∑Ωå
);

471 
	`as£π
(0);

473 
	`Ârötf
 (
ouçutfûe
, "%s: %f\n", 
∑∫ame
, *
∑Ωå
);

474 
	}
}

477 
	$gë∑øm_boﬁ
 (
FILE
 *
∑rfûe
, *
∑∫ame
, *
∑Ωå
)

479 
löe
[201];

481 
	`•rötf
(
löe
, "%†%s", 
∑∫ame
, "%d");

482 i‡(
	`fsˇnf
(
∑rfûe
, 
löe
, 
∑Ωå
) != 1) {

483 
	`Ârötf
(
°dîr
, "Eº‹Ñódög '%s'\n", 
∑∫ame
);

484 
	`exô
(1);

486 
	`fgës
(
löe
, 200, 
∑rfûe
);

487 i‡((*
∑Ωå
 !
TRUE
Ë&& (*∑Ωå !
FALSE
)) {

488 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ '%s': %d\n", 
∑∫ame
, *
∑Ωå
);

489 
	`exô
(1);

491 
	`Ârötf
 (
ouçutfûe
, "%†%d\n", 
∑∫ame
, *
∑Ωå
);

492 
	}
}

495 
	$ª£t°©s
 ()

497 i‡(
disksim
->
exã∫Æ_c⁄åﬁ
 | disksim->
sy¡hgí
 | disksim->
iŸø˚
) {

498 
	`io_ª£t°©s
();

500 i‡(
disksim
->
sy¡hgí
) {

501 
	`pf_ª£t°©s
();

503 
	}
}

506 
	$°©_w¨mup_d⁄e
 (
timî_evít
 *
timî
)

508 
w¨mu±ime
 = 
simtime
;

509 
	`ª£t°©s
();

510 
	`addt€xåaq
((
evít
 *)
timî
);

511 
	}
}

516 
	$disksim_globÆ_lﬂd∑øms
(
Õ_block
 *
b
)

520 
	`Õ_lﬂd∑øms
(0, 
b
, &
disksim_globÆ_mod
);

526 
	}
}

535 
	$disksim_¥öt°©s2
()

537 
	`Ârötf
 (
ouçutfûe
, "\nSIMULATION STATISTICS\n");

538 
	`Ârötf
 (
ouçutfûe
, "---------------------\n\n");

539 
	`Ârötf
 (
ouçutfûe
, "TŸÆÅimêo‡run: %f\n\n", 
simtime
);

540 
	`Ârötf
 (
ouçutfûe
, "W¨m-u∞time: %f\n\n", 
w¨mu±ime
);

542 i‡(
disksim
->
sy¡hgí
) {

543 
	`pf_¥öt°©s
();

545 i‡(
disksim
->
exã∫Æ_c⁄åﬁ
 | disksim->
sy¡hgí
 | disksim->
iŸø˚
) {

546 
	`io_¥öt°©s
();

548 
	}
}

551 
	$£tˇŒbacks
 ()

553 
disksim
->
issuefunc_˘Ãsm¨t
 = 
NULL
;

554 
disksim
->
queueföd_˘Ãsm¨t
 = 
NULL
;

555 
disksim
->
wakeupfunc_˘Ãsm¨t
 = 
NULL
;

556 
disksim
->
d⁄efunc_˘Ãsm¨t_ªad
 = 
NULL
;

557 
disksim
->
d⁄efunc_˘Ãsm¨t_wrôe
 = 
NULL
;

558 
disksim
->
d⁄efunc_ˇchemem_em±y
 = 
NULL
;

559 
disksim
->
d⁄efunc_ˇchedev_em±y
 = 
NULL
;

560 
disksim
->
idÀw‹k_ˇchemem
 = 
NULL
;

561 
disksim
->
idÀw‹k_ˇchedev
 = 
NULL
;

562 
disksim
->
c⁄ˇtok_ˇchemem
 = 
NULL
;

563 
disksim
->
íabÀmít_disk
 = 
NULL
;

564 
disksim
->
timîfunc_disksim
 = 
NULL
;

565 
disksim
->
timîfunc_ioqueue
 = 
NULL
;

566 
disksim
->
timîfunc_ˇchemem
 = 
NULL
;

567 
disksim
->
timîfunc_ˇchedev
 = 
NULL
;

569 
disksim
->
timîfunc_disksim
 = 
°©_w¨mup_d⁄e
;

570 
disksim
->
exã∫Æ_io_d⁄e_nŸify
 = 
NULL
;

572 
	`io_£tˇŒbacks
();

573 
	`pf_£tˇŒbacks
();

574 
	}
}

577 
	$öôülize
 ()

579 
vÆ
 = (
disksim
->
sy¡hgí
) ? 0 : 1;

581 
	`iŸø˚_öôülize_fûe
 (
disksim
->
iŸø˚fûe
, disksim->
åa˚f‹m©
, 
PRINT_TRACEFILE_HEADER
);

582 
disksim
->
ötq
) {

583 
	`addt€xåaq
(
	`gë‰omötq
());

585 i‡(
disksim
->
exã∫Æ_c⁄åﬁ
 | disksim->
sy¡hgí
 | disksim->
iŸø˚
) {

586 
	`io_öôülize
(
vÆ
);

588 i‡(
disksim
->
sy¡hgí
) {

589 
	`pf_öôülize
(
disksim
->
£edvÆ
);

591 
	`DISKSIM_§™d48
(
disksim
->
£edvÆ
);

593 
simtime
 = 0.0;

594 
	}
}

597 
	$disksim_˛ón°©s
 ()

599 i‡(
disksim
->
exã∫Æ_c⁄åﬁ
 | disksim->
sy¡hgí
 | disksim->
iŸø˚
) {

600 
	`io_˛ón°©s
();

602 i‡(
disksim
->
sy¡hgí
) {

603 
	`pf_˛ón°©s
();

605 
	}
}

608 
	$disksim_£t_exã∫Æ_io_d⁄e_nŸify
 (
disksim_iod⁄e_nŸify_t
 
‚
)

610 
disksim
->
exã∫Æ_io_d⁄e_nŸify
 = 
‚
;

611 
	}
}

614 
evít
 *
	$io_d⁄e_nŸify
 (
i‹eq_evít
 *
cuº
)

616 i‡(
disksim
->
sy¡hgí
) {

617  
	`pf_io_d⁄e_nŸify
(
cuº
, 0);

619 i‡(
disksim
->
exã∫Æ_c⁄åﬁ
) {

620 
disksim
->
	`exã∫Æ_io_d⁄e_nŸify
 (
cuº
, disksim->
nŸify_˘x
);

622 (
NULL
);

623 
	}
}

626 
INLINE
 
evít
 *

627 
	$gë√xãvít
()

629 
evít
 *
cuº
 = 
	`gë‰omötq
();

630 
evít
 *
ãmp
;

632 i‡(
cuº
) {

633 
simtime
 = 
cuº
->
time
;

635 i‡(
cuº
->
ty≥
 =
NULL_EVENT
) {

636 i‡((
disksim
->
iŸø˚
Ë&& 
	`io_usög_exã∫Æ_evít
(
cuº
)) {

637 
ãmp
 = 
	`io_gë_√xt_exã∫Æ_evít
(
disksim
->
iŸø˚fûe
);

638 i‡(!
ãmp
) {

639 
disksim
->
°›_sim
 = 
TRUE
;

646 
	`Ârötf
(
°dîr
, "NULL_EVENTÇotÜinkedÅoányÉxternal source\n");

647 
	`exô
(1);

650 i‡(
ãmp
) {

651 
ãmp
->
ty≥
 = 
NULL_EVENT
;

652 
	`addtoötq
(
ãmp
);

658 
	`Ârötf
 (
ouçutfûe
, "Returning NULL from getnextevent\n");

659 
	`fÊush
 (
ouçutfûe
);

662  
cuº
;

663 
	}
}

666 
	$disksim_checkpoöt
 (*
checkpoötfûíame
)

668 
FILE
 *
checkpoötfûe
;

671 i‡(
disksim
->
checkpoöt_dißbÀ
) {

672 
	`Ârötf
 (
ouçutfûe
, "Checkpoöà© simtimê%‡skù≥d beˇu£ checkpoötög i†dißbÀd\n", 
simtime
);

676 i‡((
checkpoötfûe
 = 
	`f›í
(
checkpoötfûíame
, "w")Ë=
NULL
) {

677 
	`Ârötf
 (
ouçutfûe
, "Checkpoöà© simtimê%‡skù≥d beˇu£ checkpoötfûêˇ¬Ÿ bê›íed f‹ wrôêac˚ss\n", 
simtime
);

681 i‡(
disksim
->
iŸø˚fûe
) {

682 i‡(
	`°rcmp
 (
disksim
->
iŸø˚fûíame
, "stdin") == 0) {

683 
	`Ârötf
 (
ouçutfûe
, "Checkpoöà© simtimê%‡skù≥d beˇu£ iŸø˚ come†‰om stdö\n", 
simtime
);

686 
	`fÊush
 (
disksim
->
iŸø˚fûe
);

687 
	`fgëpos
 (
disksim
->
iŸø˚fûe
, &disksim->
iŸø˚fûïosôi⁄
);

690 i‡(
outios
) {

691 
	`fÊush
 (
outios
);

692 
	`fgëpos
 (
outios
, &
disksim
->
outiosfûïosôi⁄
);

695 i‡(
ouçutfûe
) {

696 
	`fÊush
 (
ouçutfûe
);

697 
	`fgëpos
 (
ouçutfûe
, &
disksim
->
ouçutfûïosôi⁄
);

700 
	`ªwöd
 (
checkpoötfûe
);

701 
	`fwrôe
 (
disksim
, disksim->
tŸÆÀngth
, 1, 
checkpoötfûe
);

702 
	`fÊush
 (
checkpoötfûe
);

703 
	`f˛o£
 (
checkpoötfûe
);

704 
	}
}

707 
	$disksim_sim°›
 ()

709 
disksim
->
°›_sim
 = 
TRUE
;

710 
	}
}

713 
	$disksim_ªgi°î_checkpoöt
 (
©time
)

715 
evít
 *
checkpoöt
 = 
	`gë‰omexåaq
 ();

716 
checkpoöt
->
ty≥
 = 
CHECKPOINT
;

717 
checkpoöt
->
time
 = 
©time
;

718 
	`addtoötq
(
checkpoöt
);

719 
	}
}

722 
	$¥ime_simuœti⁄
 ()

724 
evít
 *
cuº
;

726 i‡(
disksim
->
w¨mup_evít
) {

727 
	`addtoötq
((
evít
 *)
disksim
->
w¨mup_evít
);

728 
disksim
->
w¨mup_evít
 = 
NULL
;

730 i‡(
disksim
->
checkpoöt_öãrvÆ
 > 0.0) {

731 
	`disksim_ªgi°î_checkpoöt
 (
disksim
->
checkpoöt_öãrvÆ
);

733 i‡(
disksim
->
iŸø˚
) {

734 i‡((
cuº
 = 
	`io_gë_√xt_exã∫Æ_evít
(
disksim
->
iŸø˚fûe
)Ë=
NULL
) {

735 
	`disksim_˛ón°©s
();

738 i‡((
disksim
->
åa˚f‹m©
 !
VALIDATE
Ë&& (disksim->
˛o£dios
 == 0)) {

739 
cuº
->
ty≥
 = 
NULL_EVENT
;

740 } i‡(
disksim
->
˛o£dios
) {

741 
io˙t
;

742 
	`io_usög_exã∫Æ_evít
(
cuº
);

743 
cuº
->
time
 = 
simtime
 + 
disksim
->
˛o£dthöktime
;

744 
io˙t
=1; io˙à< 
disksim
->
˛o£dios
; iocnt++) {

745 
cuº
->
√xt
 = 
	`io_gë_√xt_exã∫Æ_evít
(
disksim
->
iŸø˚fûe
);

746 i‡(
cuº
->
√xt
) {

747 
	`io_usög_exã∫Æ_evít
(
cuº
->
√xt
);

748 
cuº
->
time
 = 
simtime
 + 
disksim
->
˛o£dthöktime
;

749 
	`addtoötq
(
cuº
->
√xt
);

755 if(
disksim
->
åa˚f‹m©
 =
VALIDATE
) {

756 
i‹eq_evít
 *
tmp
 = (i‹eq_evíà*)
cuº
;

757 
	`disksim_exe˘ø˚
("Request issue: simtime %f, devno %d, blkno %d,Åime %f\n",

758 
simtime
, 
tmp
->
devno
,Åmp->
blkno
,Åmp->
time
);

761 
	`addtoötq
(
cuº
);

763 
	}
}

766 
	$disksim_simuœã_evít
 (
num
)

768 
evít
 *
cuº
;

770 i‡((
cuº
 = 
	`gë√xãvít
()Ë=
NULL
) {

771 
	`disksim_sim°›
 ();

775 
disksim
->
åa˚_mode
) {

776 
DISKSIM_NONE
:

777 
DISKSIM_MASTER
:

783 
DISKSIM_SLAVE
:

787 
simtime
 = 
cuº
->
time
;

789 i‡(
cuº
->
ty≥
 =
INTR_EVENT
)

791 
	`öå_acknowÀdge
 (
cuº
);

793 i‡((
cuº
->
ty≥
 >
IO_MIN_EVENT
Ë&& (cuº->ty≥ <
IO_MAX_EVENT
))

795 
	`io_öã∫Æ_evít
 ((
i‹eq_evít
 *)
cuº
);

797 i‡((
cuº
->
ty≥
 >
PF_MIN_EVENT
Ë&& (cuº->ty≥ <
PF_MAX_EVENT
))

799 
	`pf_öã∫Æ_evít
(
cuº
);

801 i‡(
cuº
->
ty≥
 =
TIMER_EXPIRED
)

803 
timî_evít
 *
timeout
 = (timî_evíà*Ë
cuº
;

804 (*
timeout
->
func
) (timeout);

806 i‡((
cuº
->
ty≥
 >
MEMS_MIN_EVENT
)

807 && (
cuº
->
ty≥
 <
MEMS_MAX_EVENT
))

809 
	`io_öã∫Æ_evít
 ((
i‹eq_evít
 *)
cuº
);

812 i‡((
cuº
->
ty≥
 >
SSD_MIN_EVENT
)

813 && (
cuº
->
ty≥
 <
SSD_MAX_EVENT
))

815 
	`io_öã∫Æ_evít
 ((
i‹eq_evít
 *)
cuº
);

817 i‡(
cuº
->
ty≥
 =
CHECKPOINT
)

819 i‡(
disksim
->
checkpoöt_öãrvÆ
) {

820 
	`disksim_ªgi°î_checkpoöt
(
simtime
 + 
disksim
->
checkpoöt_öãrvÆ
);

822 
	`disksim_checkpoöt
 (
disksim
->
checkpoötfûíame
);

824 i‡(
cuº
->
ty≥
 =
STOP_SIM
)

826 
	`disksim_sim°›
 ();

828 i‡(
cuº
->
ty≥
 =
EXIT_DISKSIM
)

830 
	`exô
 (0);

834 
	`Ârötf
(
°dîr
, "UƒecognizedÉvíàö simuœã: %d\n", 
cuº
->
ty≥
);

835 
	`exô
(1);

839 #ifde‡
FDEBUG


840 
	`Ârötf
 (
ouçutfûe
, "Event handled, going forÇext\n");

841 
	`fÊush
 (
ouçutfûe
);

846 
	}
}

849 
	$disksim_£tup_ouçutfûe
 (*
fûíame
, *
mode
)

851 i‡(
	`°rcmp
(
fûíame
, "stdout") == 0) {

852 
ouçutfûe
 = 
°dout
;

855 i‡((
ouçutfûe
 = 
	`f›í
(
fûíame
,
mode
)Ë=
NULL
) {

856 
	`Ârötf
(
°dîr
, "Outfûê%†ˇ¬Ÿ bê›íed f‹ wrôêac˚ss\n", 
fûíame
);

857 
	`exô
(1);

861 i‡(
	`°æí
(
fûíame
) <= 255) {

862 
	`°r˝y
 (
disksim
->
ouçutfûíame
, 
fûíame
);

865 
	`Ârötf
 (
°dîr
, "Name of output file isÅooÜong (>255 bytes); checkpointing disabled\n");

866 
disksim
->
checkpoöt_dißbÀ
 = 1;

869 
	`£tvbuf
(
ouçutfûe
, 0, 
_IONBF
, 0);

870 
	}
}

873 
	$disksim_£tup_iŸø˚fûe
 (*
fûíame
)

875 i‡(
	`°rcmp
(
fûíame
, "0") != 0) {

876 
	`as£π
 (
disksim
->
exã∫Æ_c⁄åﬁ
 == 0);

877 
disksim
->
iŸø˚
 = 1;

878 i‡(
	`°rcmp
(
fûíame
, "stdin") == 0) {

879 
disksim
->
iŸø˚fûe
 = 
°dö
;

881 i‡((
disksim
->
iŸø˚fûe
 = 
	`f›í
(
fûíame
,"rb")Ë=
NULL
) {

882 
	`Ârötf
(
°dîr
, "Tø˚fûê%†ˇ¬Ÿ bê›íed f‹Ñódác˚ss\n", 
fûíame
);

883 
	`exô
(1);

887 
disksim
->
iŸø˚fûe
 = 
NULL
;

890 i‡(
	`°æí
(
fûíame
) <= 255) {

891 
	`°r˝y
 (
disksim
->
iŸø˚fûíame
, 
fûíame
);

893 
	`Ârötf
 (
°dîr
, "Name of iotrace file isÅooÜong (>255 bytes); checkpointing disabled\n");

894 
disksim
->
checkpoöt_dißbÀ
 = 1;

896 
	}
}

899 
	$£tEndün
() {

900 
n
 = 0x11223344;

901 *
c
 = (*)&
n
;

903 if(
c
[0] == 0x11) {

904 
disksim
->
ídün
 = 
_BIG_ENDIAN
;

907 
disksim
->
ídün
 = 
_LITTLE_ENDIAN
;

910 
	}
}

912 
	$disksim_£tup_disksim
 (
¨gc
, **
¨gv
)

915 
	`£tEndün
();

917 
	`SèticAs£π
 ((
ötch¨
) == 4);

918 i‡(
¨gc
 < 6) {

919 
	`Ârötf
(
°dîr
,"Ußge: %†∑ømfûêoutfûêf‹m© iŸø˚ sy¡hgí?\n", 
¨gv
[0]);

920 
	`exô
(1);

923 #ifde‡
FDEBUG


924 
	`Ârötf
 (
°dîr
, "%†%†%†%†%†%s\n", 
¨gv
[0],árgv[1],árgv[2],árgv[3],

925 
¨gv
[4],árgv[5]);

928 i‡((
¨gc
 - 6) % 3) {

929 
	`Ârötf
(
°dîr
, "Parameter file overrides must be 3-tuples\n");

930 
	`exô
(1);

933 
	`disksim_£tup_ouçutfûe
 (
¨gv
[2], "w");

934 
	`Ârötf
 (
ouçutfûe
, "\n*** Ouçuàfûê«me: %s\n", 
¨gv
[2]);

935 
	`fÊush
 (
ouçutfûe
);

937 if(
	`°rcmp
 (
¨gv
[3], "external") == 0) {

938 
disksim
->
exã∫Æ_c⁄åﬁ
 = 1;

941 
	`iŸø˚_£t_f‹m©
(
¨gv
[3]);

944 
	`Ârötf
 (
ouçutfûe
, "*** I≈uàåa˚ f‹m©: %s\n", 
¨gv
[3]);

945 
	`fÊush
 (
ouçutfûe
);

947 
	`disksim_£tup_iŸø˚fûe
 (
¨gv
[4]);

948 
	`Ârötf
 (
ouçutfûe
, "*** I/OÅø˚ u£d: %s\n", 
¨gv
[4]);

949 
	`fÊush
 (
ouçutfûe
);

951 if(
	`°rcmp
(
¨gv
[5], "0") != 0) {

952 
disksim
->
sy¡hgí
 = 1;

953 
disksim
->
iŸø˚
 = 0;

956 
	`Ârötf
(
ouçutfûe
, "*** SynthgenÅo be used?: %d\n\n",

957 
disksim
->
sy¡hgí
);

959 
	`fÊush
(
ouçutfûe
);

961 
disksim
->
ovîrides
 = 
¨gv
 + 6;

962 
disksim
->
ovîrides_Àn
 = 
¨gc
 - 6;

965 
	`ddbg_as£π_£tfûe
(
°dîr
);

968 
disksim
->
åa˚pùes
[0] = 8;

969 
disksim
->
åa˚pùes
[1] = 9;

988 
disksim
->
åa˚_mode
 = 
DISKSIM_NONE
;

991 if(
	`disksim_lﬂd∑øms
(
¨gv
[1], 
disksim
->
sy¡hgí
)) {

992 
	`Ârötf
(
°dîr
, "***Érror: FATAL: failedÅoÜoad disksimÖarameter file.\n");

993 
	`exô
(1);

996 
	`Ârötf
(
ouçutfûe
, "loadparams complete\n");

997 
	`fÊush
(
ouçutfûe
);

1000 if(!
disksim
->
iosim_öfo
) {

1002 
	`iosim_öôülize_iosim_öfo
 ();

1006 
	`f˛_öô
();

1008 
	`öôülize
();

1009 
	`Ârötf
(
ouçutfûe
, "Initialization complete\n");

1010 
	`fÊush
(
ouçutfûe
);

1011 
	`¥ime_simuœti⁄
();

1015 
	`f˛o£
(
°©deffûe
);

1016 
°©deffûe
 = 
NULL
;

1017 
	}
}

1020 
	$disksim_ª°‹e_‰om_checkpoöt
 (*
fûíame
)

1022 #ifde‡
SUPPORT_CHECKPOINTS


1023 
fd
;

1024 *
°¨èddr
;

1025 
tŸÆÀngth
;

1026 
ªt
;

1028 
fd
 = 
	`›í
 (
fûíame
, 
O_RDWR
);

1029 
	`as£π
 (
fd
 >= 0);

1030 
ªt
 = 
	`ªad
 (
fd
, &
°¨èddr
,  (*));

1031 
	`as£π
 (
ªt
 == (*));

1032 
ªt
 = 
	`ªad
 (
fd
, &
tŸÆÀngth
,  ());

1033 
	`as£π
 (
ªt
 == ());

1034 
disksim
 = (
disksim_t
 *Ë
	`mm≠
 (
°¨èddr
, 
tŸÆÀngth
, (
PROT_READ
|
PROT_WRITE
), (
MAP_PRIVATE
), 
fd
, 0);

1037 
	`as£π
 (
disksim
 =
°¨èddr
);

1039 
	`disksim_£tup_ouçutfûe
 (
disksim
->
ouçutfûíame
, "r+");

1040 i‡(
ouçutfûe
 !
NULL
) {

1041 
ªt
 = 
	`f£ços
 (
ouçutfûe
, &
disksim
->
ouçutfûïosôi⁄
);

1042 
	`as£π
 (
ªt
 >= 0);

1044 
	`disksim_£tup_iŸø˚fûe
 (
disksim
->
iŸø˚fûíame
);

1045 i‡(
disksim
->
iŸø˚fûe
 !
NULL
) {

1046 
ªt
 = 
	`f£ços
 (
disksim
->
iŸø˚fûe
, &disksim->
iŸø˚fûïosôi⁄
);

1047 
	`as£π
 (
ªt
 >= 0);

1049 i‡((
	`°rcmp
(
disksim
->
outiosfûíame
, "0") != 0) && (strcmp(disksim->outiosfilename, "null") != 0)) {

1050 i‡((
outios
 = 
	`f›í
(
disksim
->
outiosfûíame
, "r+")Ë=
NULL
) {

1051 
	`Ârötf
(
°dîr
, "Outio†%†ˇ¬Ÿ bê›íed f‹ wrôêac˚ss\n", 
disksim
->
outiosfûíame
);

1052 
	`exô
(1);

1054 
ªt
 = 
	`f£ços
 (
outios
, &
disksim
->
outiosfûïosôi⁄
);

1055 
	`as£π
 (
ªt
 >= 0);

1058 
	`as£π
 ("Checkpoint/restoreÇot supported onÅhisÖlatform" == 0);

1060 
	`£tˇŒbacks
();

1061 
	}
}

1064 
	$disksim_run_simuœti⁄
 ()

1066 
evít_cou¡
 = 0;

1067 
	`DISKSIM_§™d48
(1000003);

1068 
disksim
->
°›_sim
 =
FALSE
) {

1069 
	`disksim_simuœã_evít
(
evít_cou¡
);

1071 
evít_cou¡
++;

1074 
	}
}

1078 
	$disksim_˛ónup
()

1080 
i
;

1082 i‡(
ouçutfûe
)

1084 
	`f˛o£
 (
ouçutfûe
);

1088 i‡(
disksim
->
iŸø˚fûe
)

1090 
	`f˛o£
(
disksim
->
iŸø˚fûe
);

1094 
	`iodrivî_˛ónup
();

1096 if(
outios
)

1098 
	`f˛o£
(
outios
);

1099 
outios
 = 
NULL
;

1101 
	}
}

1103 
	$disksim_¥öt°©s
() {

1104 
	`Ârötf
(
ouçutfûe
, "Simulation complete\n");

1105 
	`fÊush
(
ouçutfûe
);

1107 
	`disksim_˛ón°©s
();

1108 
	`disksim_¥öt°©s2
();

1109 
	}
}

1111 
	$disksim_˛ónup_™d_¥öt°©s
 ()

1113 
	`f˛_exô
();

1114 
	`disksim_¥öt°©s
();

1115 
	`disksim_˛ónup
();

1116 
	}
}

1120 
	$disksim_öôülize_disksim_°ru˘uª
 (
disksim
 *disksim)

1127 
disksim
->
˛o£dthöktime
 = 0.0;

1128 
w¨mu±ime
 = 0.0;

1129 
simtime
 = 0.0;

1130 
disksim
->
œ°phy°ime
 = 0.0;

1131 
disksim
->
checkpoöt_öãrvÆ
 = 0.0;

1134 
	}
}

1138 
	$disksim_exe˘ø˚
(*
fmt
, ...) {

1140 if(
disksim
->
exe˘ø˚
) {

1141 
va_li°
 
≠
;

1142 
	`va_°¨t
(
≠
, 
fmt
);

1143 
	`vÂrötf
(
disksim
->
exe˘ø˚
, 
fmt
, 
≠
);

1144 
	`va_íd
(
≠
);

1146 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_assertlib.h

101 #i‚de‡
DISKSIM_ASSERTLIB_H


102 
	#DISKSIM_ASSERTLIB_H


	)

104 
	~<as£π.h
>

106 #i‚de‡
ASSERTS


108 
	#ASSERT
(
c⁄d
)

	)

109 
	#ASSERT1
(
c⁄d
,
S1
,
V1
)

	)

110 
	#ASSERT1D
(
c⁄d
,
S1
,
V1
)

	)

111 
	#ASSERT2
(
c⁄d
,
S1
,
V1
,
S2
,
V2
)

	)

112 
	#ASSERT2p
(
c⁄d
,
S1
,
V1
,
S2
,
V2
)

	)

116 
	#ASSERT
(
c⁄d
) \

117 i‡(!(
c⁄d
)) { \

118 
	`Ârötf
(
°dîr
, "\nAssertion failed:\n"); \

119 
	`Ârötf
(
°dîr
, "simtime\à%f\n", 
simtime
); \

120 
	`Ârötf
(
°dîr
, "tŸÆªqs\à%d\n", 
disksim
->
tŸÆªqs
); \

122 
	`as£π
(
c⁄d
);

	)

124 
	#ASSERT1
(
c⁄d
,
S1
,
V1
) \

125 i‡(!(
c⁄d
)) { \

126 
	`Ârötf
(
°dîr
, "\nAssertion failed:\n"); \

127 
	`Ârötf
(
°dîr
, "simtime\à%f\n", 
simtime
); \

128 
	`Ârötf
(
°dîr
, "tŸÆªqs\à%d\n", 
disksim
->
tŸÆªqs
); \

129 
	`Ârötf
(
°dîr
, "%s\à%d\n",(
S1
),(
V1
)); \

131 
	`as£π
(
c⁄d
);

	)

133 
	#ASSERT1D
(
c⁄d
,
S1
,
V1
) \

134 i‡(!(
c⁄d
)) { \

135 
	`Ârötf
(
°dîr
, "\nAssertion failed:\n"); \

136 
	`Ârötf
(
°dîr
, "simtime\à%f\n", 
simtime
); \

137 
	`Ârötf
(
°dîr
, "tŸÆªqs\à%d\n", 
disksim
->
tŸÆªqs
); \

138 
	`Ârötf
(
°dîr
, "%s\à%f\n",(
S1
),(
V1
)); \

140 
	`as£π
(
c⁄d
);

	)

142 
	#ASSERT2
(
c⁄d
,
S1
,
V1
,
S2
,
V2
) \

143 i‡(!(
c⁄d
)) { \

144 
	`Ârötf
(
°dîr
, "\nAssertion failed:\n"); \

145 
	`Ârötf
(
°dîr
, "simtime\à%f\n", 
simtime
); \

146 
	`Ârötf
(
°dîr
, "tŸÆªqs\à%d\n", 
disksim
->
tŸÆªqs
); \

147 
	`Ârötf
(
°dîr
, "%s\à%d\n",(
S1
),(
V1
)); \

148 
	`Ârötf
(
°dîr
, "%s\à%d\n",(
S2
),(
V2
)); \

150 
	`as£π
(
c⁄d
);

	)

152 
	#ASSERT2p
(
c⁄d
,
S1
,
V1
,
S2
,
V2
) \

153 i‡(!(
c⁄d
)) { \

154 
	`Ârötf
(
°dîr
, "\nAssertion failed:\n"); \

155 
	`Ârötf
(
°dîr
, "simtime\à%f\n", 
simtime
); \

156 
	`Ârötf
(
°dîr
, "tŸÆªqs\à%d\n", 
disksim
->
tŸÆªqs
); \

157 
	`Ârötf
(
°dîr
, "%s\à%p\n",(
S1
),(
V1
)); \

158 
	`Ârötf
(
°dîr
, "%s\à%p\n",(
S2
),(
V2
)); \

160 
	`as£π
(
c⁄d
);

	)

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_bitstring.h

58 #i‚de‡
_BITSTRING_H_


59 
	#_BITSTRING_H_


	)

68 
	tbô°r_t
;

72 
	#_bô_byã
(
bô
) \

73 ((
bô
Ë>> 3)

	)

76 
	#_bô_mask
(
bô
) \

77 (1 << ((
bô
)&0x7))

	)

81 
	#bô°r_size
(
nbôs
) \

82 (((
nbôs
Ë+ 7Ë>> 3)

	)

85 
	#bô_Æloc
(
nbôs
) \

86 (
bô°r_t
 *)
	`ˇŒoc
((
size_t
)
	`bô°r_size
(
nbôs
), (bô°r_t))

	)

89 
	#bô_de˛
(
«me
, 
nbôs
) \

90 (
«me
)[
	`bô°r_size
(
nbôs
)]

	)

93 
	#bô_ã°
(
«me
, 
bô
) \

94 ((
«me
)[
	`_bô_byã
(
bô
)] & 
	`_bô_mask
(bô))

	)

97 
	#bô_£t
(
«me
, 
bô
) \

98 (
«me
)[
	`_bô_byã
(
bô
)] |
	`_bô_mask
(bô)

	)

101 
	#bô_˛ór
(
«me
, 
bô
) \

102 (
«me
)[
	`_bô_byã
(
bô
)] &~
	`_bô_mask
(bô)

	)

105 
	#bô_n˛ór
(
«me
, 
°¨t
, 
°›
) do { \

106 
bô°r_t
 *
_«me
 = 
«me
; \

107 
_°¨t
 = 
°¨t
, 
_°›
 = 
°›
; \

108 
_°¨t
 <
_°›
) { \

109 
	`bô_˛ór
(
_«me
, 
_°¨t
); \

110 
_°¨t
++; \

112 } 0)

	)

115 
	#bô_n£t
(
«me
, 
°¨t
, 
°›
) do { \

116 
bô°r_t
 *
_«me
 = 
«me
; \

117 
_°¨t
 = 
°¨t
, 
_°›
 = 
°›
; \

118 
_°¨t
 <
_°›
) { \

119 
	`bô_£t
(
_«me
, 
_°¨t
); \

120 
_°¨t
++; \

122 } 0)

	)

125 
	#bô_ffc
(
«me
, 
nbôs
, 
vÆue
) do { \

126 
bô°r_t
 *
_«me
 = 
«me
; \

127 
_bô
, 
_nbôs
 = 
nbôs
, 
_vÆue
 = -1; \

128 
_bô
 = 0; _bô < 
_nbôs
; ++_bit) \

129 i‡(!
	`bô_ã°
(
_«me
, 
_bô
)) { \

130 
_vÆue
 = 
_bô
; \

133 *(
vÆue
Ë
_vÆue
; \

134 } 0)

	)

137 
	#bô_ffs
(
«me
, 
nbôs
, 
vÆue
) do { \

138 
bô°r_t
 *
_«me
 = 
«me
; \

139 
_bô
, 
_nbôs
 = 
nbôs
, 
_vÆue
 = -1; \

140 
_bô
 = 0; _bô < 
_nbôs
; _bit+=8) { \

141 i‡((
«me
)[
	`_bô_byã
(
_bô
)] != 0) { \

145 ; 
_bô
 < 
_nbôs
; ++_bit) { \

146 i‡(
	`bô_ã°
(
_«me
, 
_bô
)) { \

147 
_vÆue
 = 
_bô
; \

151 *(
vÆue
Ë
_vÆue
; \

152 } 0)

	)

156 
	#bô_ffs
(
«me
, 
nbôs
, 
vÆue
) do { \

157 
bô°r_t
 *
_«me
 = 
«me
; \

158 
_bô
, 
_nbôs
 = 
nbôs
, 
_vÆue
 = -1; \

159 
_bô
 = 0; _bô < 
_nbôs
; ++_bit) \

160 i‡(
	`bô_ã°
(
_«me
, 
_bô
)) { \

161 
_vÆue
 = 
_bô
; \

164 *(
vÆue
Ë
_vÆue
; \

165 } 0)

	)

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_bus.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_iosim.h
"

103 
	~"disksim_°©.h
"

104 
	~"disksim_bus.h
"

105 
	~"disksim_˘Ã.h
"

106 
	~"disksim_c⁄åﬁÀr.h
"

107 
	~"c⁄fig.h
"

109 
	~"moduÀs/moduÀs.h
"

110 
	~"memsmodñ/moduÀs/moduÀs.h
"

112 
	~"disksim_devi˚.h
"

116 
	#BUS_TYPE_MIN
 1

	)

117 
	#EXCLUSIVE
 1

	)

118 
	#INTERLEAVED
 2

	)

119 
	#BUS_TYPE_MAX
 2

	)

123 
	#BUS_ARB_TYPE_MIN
 1

	)

124 
	#SLOTPRIORITY_ARB
 1

	)

125 
	#FIFO_ARB
 2

	)

126 
	#BUS_ARB_TYPE_MAX
 2

	)

130 
	#BUS_FREE
 1

	)

131 
	#BUS_OWNED
 2

	)

134  
bus
 * 
	$gëbus
 (
bu¢o
)

137 if((
bu¢o
 < 0Ë|| (bu¢ÿ>
numbu£s
)) {

141  
disksim
->
busöfo
->
bu£s
[
bu¢o
];

143 
	}
}

145 
bus
 *
	$gëbusby«me
(*
«me
, *
num
) {

146 
c
;

147 
c
 = 0; c < 
numbu£s
; c++) {

148 if(
disksim
->
busöfo
->
bu£s
[
c
])

149 if(!
	`°rcmp
(
disksim
->
busöfo
->
bu£s
[
c
]->
«me
,Çame)) {

150 if(
num
Ë*num = 
c
;

151  
disksim
->
busöfo
->
bu£s
[
c
];

156 
	}
}

160 
	$bus_£t_to_zîo_dïth
 (
bu¢o
)

162 
bus
 *
cuºbus
 = 
	`gëbus
(
bu¢o
);

163 
cuºbus
->
dïth
 = 0;

164 
	}
}

168 
	$bus_gë_c⁄åﬁÀr_¶Ÿ
 (
bu¢o
, 
˘ o
)

170 
i
;

171 
bus
 *
cuºbus
 = 
	`gëbus
 (
bu¢o
);

173 
i
 = 0; i < 
cuºbus
->
num¶Ÿs
; i++) {

174 i‡((
cuºbus
->
¶Ÿs
[
i
].
devno
 =
˘ o
Ë&& (cuºbus->¶Ÿs[i].
devty≥
 =
CONTROLLER
)) {

177  
i
;

181 
	`Ârötf
(
°dîr
, "C⁄åﬁÀ∏nŸ c⁄√˘edÅÿbu†buàˇŒed bus_gë_c⁄åﬁÀr_¶Ÿ: %d %d\n", 
˘ o
, 
bu¢o
);

182 
	`ddbg_as£π
(0);

184 
	}
}

187 
	$bus_£t_dïths
()

189 
dïth
;

190 
bu¢o
;

191 
¶Ÿno
;

192 
ötch¨
 
ªt
;

193 
i
;

194 
u_öt
 
devno
;

196 
dïth
 = 0; dïth < 
MAXDEPTH
; depth++) {

199 
bu¢o
 = 0; bu¢ÿ< 
numbu£s
; busno++) {

200 
bus
 *
cuºbus
 = 
	`gëbus
(
bu¢o
);

203 i‡(
cuºbus
->
dïth
 == depth) {

207 
¶Ÿno
 = 0; slŸnÿ< 
cuºbus
->
num¶Ÿs
; slotno++) {

211 
devno
 = 
cuºbus
->
¶Ÿs
[
¶Ÿno
].devno;

213 
cuºbus
->
¶Ÿs
[
¶Ÿno
].
devty≥
) {

214 
CONTROLLER
:

217 
ªt
.
vÆue
 = 
	`c⁄åﬁÀr_£t_dïth
(
devno
, 
bu¢o
, 
dïth
, 
¶Ÿno
);

220 
DEVICE
:

223 
ªt
.
vÆue
 = 
	`devi˚_£t_dïth
(
devno
, 
bu¢o
, 
dïth
, 
¶Ÿno
);

227 
	`Ârötf
(
°dîr
, "*** Invalid deviceÅype in bus slot\n");

228 
	`ddbg_as£π
(0);

232 i‡(
ªt
.
vÆue
 != 0) {

234 
i
 = 0; i < 
MAXDEPTH
; i++) {

235 i‡(
ªt
.
byã
[
i
] != 0) {

236 
bus
 *
cuºbus2
 = 
	`gëbus
(
ªt
.
byã
[
i
]);

239 
cuºbus2
->
dïth
 = depth + 1;

247 
	}
}

250 
	$bus_gë_å™s„r_time
(
bu¢o
, 
bcou¡
, 
ªad
)

252 
blkå™°ime
;

253 
bus
 *
cuºbus
 = 
	`gëbus
(
bu¢o
);

255 
blkå™°ime
 = (
ªad
Ë? 
cuºbus
->
ªadblkå™°ime
 : cuºbus->
wrôeblkå™°ime
;

256 ((Ë
bcou¡
 * 
blkå™°ime
);

257 
	}
}

265 
	$bus_dñay
(
bu¢o
, 
devty≥
, 
devno
, 
dñay
, 
i‹eq_evít
 *
cuº
)

267 
bus_evít
 *
tmp
 = (bus_evíà*Ë
	`gë‰omexåaq
();

268 
tmp
->
ty≥
 = 
BUS_DELAY_COMPLETE
;

269 
tmp
->
time
 = 
simtime
 + 
dñay
;

270 
tmp
->
devno
 = devno;

271 
tmp
->
bu¢o
 = busno;

272 
tmp
->
devty≥
 = devtype;

273 
tmp
->
dñayed_evít
 = 
cuº
;

274 
	`addtoötq
((
evít
 *Ë
tmp
);

275 
	}
}

278 
	$bus_evít_¨rive
(
i‹eq_evít
 *
±r
)

280 
bus_evít
 *
cuº
 = (bus_evíà*Ë
±r
;

282 i‡(
cuº
->
ty≥
 =
BUS_OWNERSHIP_GRANTED
) {

283 
bus
 *
cuºbus
 = 
	`gëbus
(
cuº
->
bu¢o
);

284 
	`ASSERT
(
cuº
 =
cuºbus
->
¨bwö√r
);

285 
cuºbus
->
¨bwö√r
 = 
NULL
;

286 
	`°©_upd©e
 (&
cuºbus
->
¨bwaô°©s
, (
simtime
 - 
cuº
->
waô_°¨t
));

289 
cuº
->
devty≥
) {

291 
CONTROLLER
:

292 i‡(
cuº
->
ty≥
 =
BUS_DELAY_COMPLETE
) {

293 
	`c⁄åﬁÀr_bus_dñay_com∂ëe
 (
cuº
->
devno
, cuº->
dñayed_evít
, cuº->
bu¢o
);

295 
	`c⁄åﬁÀr_bus_ow√rshù_gø¡
 (
cuº
->
devno
, cuº->
dñayed_evít
, cuº->
bu¢o
, (
simtime
 - cuº->
waô_°¨t
));

299 
DEVICE
:

300 i‡(
cuº
->
ty≥
 =
BUS_DELAY_COMPLETE
) {

301 
	`devi˚_bus_dñay_com∂ëe
 (
cuº
->
devno
, cuº->
dñayed_evít
, cuº->
bu¢o
);

303 
	`devi˚_bus_ow√rshù_gø¡
 (
cuº
->
devno
, cuº->
dñayed_evít
, cuº->
bu¢o
, (
simtime
 - cuº->
waô_°¨t
));

308 
	`Ârötf
(
°dîr
, "Unknow¿devi˚Åy≥áàbus_evít_¨rive: %d,Åy≥ %d\n", 
cuº
->
devty≥
, cuº->
ty≥
);

309 
	`exô
(1);

311 
	`addt€xåaq
((
evít
 *)
cuº
);

312 
	}
}

315 
bus_evít
 * 
	$bus_fifo_¨bôøti⁄
(
bus
 *
cuºbus
)

317 
bus_evít
 *
ªt
 = 
cuºbus
->
ow√rs
;

318 
	`ASSERT
(
cuºbus
->
ow√rs
 !
NULL
);

319 
cuºbus
->
ow√rs
 = 
ªt
->
√xt
;

320 (
ªt
);

321 
	}
}

324 
bus_evít
 * 
	$bus_¶Ÿ¥i‹ôy_¨bôøti⁄
(
bus
 *
cuºbus
)

326 
bus_evít
 *
ªt
 = 
cuºbus
->
ow√rs
;

328 
	`ASSERT
(
cuºbus
->
ow√rs
 !
NULL
);

329 i‡(
cuºbus
->
ow√rs
->
√xt
 =
NULL
) {

330 
cuºbus
->
ow√rs
 = 
NULL
;

331 (
ªt
);

333 
bus_evít
 *
åv
 = 
ªt
;

334 
åv
->
√xt
) {

335 i‡(
åv
->
√xt
->
¶Ÿno
 > 
ªt
->slotno) {

336 
ªt
 = 
åv
->
√xt
;

338 
åv
 =Årv->
√xt
;

340 i‡(
ªt
 =
cuºbus
->
ow√rs
) {

341 
cuºbus
->
ow√rs
 = 
ªt
->
√xt
;

342 
ªt
->
√xt
 = 
NULL
;

344 
åv
 = 
cuºbus
->
ow√rs
;

345 (
åv
->
√xt
 !
NULL
Ë&& (åv->√xà!
ªt
)) {

346 
åv
 =Årv->
√xt
;

348 
	`ASSERT
(
åv
->
√xt
 =
ªt
);

349 
åv
->
√xt
 = 
ªt
->next;

350 
ªt
->
√xt
 = 
NULL
;

353 (
ªt
);

354 
	}
}

357 
bus_evít
 * 
	$bus_¨bôøã_f‹_ow√rshù
(
bus
 *
cuºbus
)

359 
cuºbus
->
¨bty≥
) {

361 
SLOTPRIORITY_ARB
:

362 (
	`bus_¶Ÿ¥i‹ôy_¨bôøti⁄
(
cuºbus
));

364 
FIFO_ARB
:

365 (
	`bus_fifo_¨bôøti⁄
(
cuºbus
));

368 
	`Ârötf
(
°dîr
, "Unrecognized busárbitrationÅype in bus_arbitrate_for_ownership\n");

369 
	`exô
(1);

371 
	}
}

396 
	$bus_ow√rshù_gë
(
bu¢o
, 
¶Ÿno
, 
i‹eq_evít
 *
cuº
)

398 
bus_evít
 *
tmp
;

399 
bus
 *
cuºbus
 = 
	`gëbus
 (
bu¢o
);

401 i‡(
cuºbus
->
ty≥
 =
INTERLEAVED
) {

402 (
TRUE
);

404 
tmp
 = (
bus_evít
 *Ë
	`gë‰omexåaq
();

405 
tmp
->
ty≥
 = 
BUS_OWNERSHIP_GRANTED
;

406 
tmp
->
devno
 = 
cuºbus
->
¶Ÿs
[
¶Ÿno
].devno;

407 
tmp
->
bu¢o
 = busno;

408 
tmp
->
dñayed_evít
 = 
cuº
;

409 
tmp
->
waô_°¨t
 = 
simtime
;

410 i‡(
cuºbus
->
°©e
 =
BUS_FREE
) {

411 
tmp
->
devty≥
 = 
cuºbus
->
¶Ÿs
[
¶Ÿno
].devtype;

412 
tmp
->
time
 = 
simtime
 + 
cuºbus
->
¨btime
;

416 
cuºbus
->
¨bwö√r
 = 
tmp
;

417 
	`addtoötq
((
evít
 *Ë
tmp
);

418 
cuºbus
->
°©e
 = 
BUS_OWNED
;

419 
cuºbus
->
runidÀtime
 +
simtime
 - cuºbus->
œ°ow√d
;

420 
	`°©_upd©e
 (&
cuºbus
->
busidÀ°©s
, (
simtime
 - cuºbus->
œ°ow√d
));

422 
tmp
->
¶Ÿno
 = slotno;

426 
tmp
->
√xt
 = 
NULL
;

427 i‡(
cuºbus
->
ow√rs
) {

428 
bus_evít
 *
èû
 = 
cuºbus
->
ow√rs
;

429 
èû
->
√xt
) {

430 
èû
 =Åaû->
√xt
;

432 
èû
->
√xt
 = 
tmp
;

434 
cuºbus
->
ow√rs
 = 
tmp
;

437 (
FALSE
);

438 
	}
}

441 
	$bus_ow√rshù_ªÀa£
(
bu¢o
)

443 
bus_evít
 *
tmp
;

444 
bus
 *
cuºbus
 = 
	`gëbus
(
bu¢o
);

448 
	`ASSERT
(
cuºbus
->
¨bwö√r
 =
NULL
);

449 i‡(
cuºbus
->
ow√rs
 =
NULL
) {

453 
cuºbus
->
°©e
 = 
BUS_FREE
;

454 
cuºbus
->
œ°ow√d
 = 
simtime
;

456 
tmp
 = 
	`bus_¨bôøã_f‹_ow√rshù
(
cuºbus
);

457 
tmp
->
devty≥
 = 
cuºbus
->
¶Ÿs
[tmp->
¶Ÿno
].devtype;

458 
tmp
->
time
 = 
simtime
 + 
cuºbus
->
¨btime
;

462 
cuºbus
->
¨bwö√r
 = 
tmp
;

463 
	`addtoötq
((
evít
 *Ë
tmp
);

465 
	}
}

468 
	$bus_ªmove_‰om_¨bôøti⁄
(
bu¢o
, 
i‹eq_evít
 *
cuº
)

470 
bus_evít
 *
tmp
;

471 
bus_evít
 *
åv
;

472 
bus
 *
cuºbus
 = 
	`gëbus
(
bu¢o
);

474 i‡(
cuºbus
->
¨bwö√r
) {

475 i‡(
cuº
 =
cuºbus
->
¨bwö√r
->
dñayed_evít
) {

476 i‡(
	`ªmove‰omötq
((
evít
 *)
cuºbus
->
¨bwö√r
Ë!
TRUE
) {

477 
	`Ârötf
(
°dîr
, "OngoingárbwinnerÇot in internal queue,át bus_remove_from_arbitration\n");

478 
	`exô
(1);

480 
	`addt€xåaq
((
evít
 *Ë
cuºbus
->
¨bwö√r
);

481 
cuºbus
->
¨bwö√r
 = 
NULL
;

482 
	`bus_ow√rshù_ªÀa£
(
bu¢o
);

486 i‡(
cuº
 =
cuºbus
->
ow√rs
->
dñayed_evít
) {

487 
tmp
 = 
cuºbus
->
ow√rs
;

488 
cuºbus
->
ow√rs
 = 
tmp
->
√xt
;

490 
åv
 = 
cuºbus
->
ow√rs
;

491 (
åv
->
√xt
Ë&& (
cuº
 !åv->√xt->
dñayed_evít
)) {

492 
åv
 =Årv->
√xt
;

494 
	`ASSERT
(
åv
->
√xt
 !
NULL
);

495 
tmp
 = 
åv
->
√xt
;

496 
åv
->
√xt
 = 
tmp
->next;

498 
	`addt€xåaq
((
evít
 *Ë
tmp
);

499 
	}
}

502 
	$bus_dñivî_evít
(
bu¢o
, 
¶Ÿno
, 
i‹eq_evít
 *
cuº
)

504 
devno
;

505 
bus
 *
cuºbus
 = 
	`gëbus
(
bu¢o
);

507 
	`ASSERT2
((
¶Ÿno
 >0Ë&& (¶Ÿnÿ< 
cuºbus
->
num¶Ÿs
),

508 "¶Ÿno", 
¶Ÿno
, "bu¢o", 
bu¢o
);

513 
devno
 = 
cuºbus
->
¶Ÿs
[
¶Ÿno
].devno;

514 
cuºbus
->
¶Ÿs
[
¶Ÿno
].
devty≥
) {

516 
CONTROLLER
:

517 
	`c⁄åﬁÀr_evít_¨rive
(
devno
, 
cuº
);

520 
DEVICE
:

521 
	`ASSERT
(
devno
 =
cuº
->devno);

522 
	`devi˚_evít_¨rive
(
cuº
);

526 
	`Ârötf
(
°dîr
, "Invalid deviceÅype in bus slot\n");

527 
	`as£π
(0);

529 
	}
}

532 
	$bus_gë_d©a_å™s„ªd
(
i‹eq_evít
 *
cuº
, 
dïth
)

534 
ötch¨
 
¶Ÿno
;

535 
ötch¨
 
bu¢o
;

536 
checkdevno
;

537 
ªt
;

541 
bu¢o
.
vÆue
 = 
cuº
->busno;

542 
¶Ÿno
.
vÆue
 = 
cuº
->slotno;

543 
dïth
) {

544 
bus
 *
cuºbus
 = 
	`gëbus
(
bu¢o
.
byã
[
dïth
]);

545 
checkdevno
 = 
cuºbus
->
¶Ÿs
[(
¶Ÿno
.
byã
[
dïth
] >> 4)].
devno
;

546 
cuºbus
->
¶Ÿs
[(
¶Ÿno
.
byã
[
dïth
] >> 4)].
devty≥
) {

548 
CONTROLLER
: 
ªt
 = 
	`c⁄åﬁÀr_gë_d©a_å™s„ªd
(
checkdevno
, 
cuº
->
devno
);

551 : 
	`Ârötf
(
°dîr
, "Invalid deviceÅype in bus_get_data_transfered\n");

552 
	`exô
(1);

554 i‡(
ªt
 != -1) {

555 (
ªt
);

557 
dïth
--;

560 
	}
}

564 
	gdisksim_bus_¥ötidÀ°©s
;

565 
	gdisksim_bus_¥öèrbwaô°©s
;

569 
	$disksim_bus_°©s_lﬂd∑øms
(
Õ_block
 *
b
) {

571 if(!
disksim
->
busöfo
) {

572 
disksim
->
busöfo
 = 
	`mÆloc
((
busöfo_t
));

573 
	`bzîo
(
disksim
->
busöfo
, (
busöfo_t
));

581 
	`Õ_lﬂd∑øms
(0, 
b
, &
disksim_bus_°©s_mod
);

584 
	}
}

590 
	$bus_ª£t°©s
()

592 
i
;

594 
i
=0; i<
numbu£s
; i++) {

595 
bus
 *
cuºbus
 = 
	`gëbus
(
i
);

596 
cuºbus
->
œ°ow√d
 = 
simtime
;

597 
cuºbus
->
runidÀtime
 = 0.0;

598 
	`°©_ª£t
 (&
cuºbus
->
busidÀ°©s
);

599 
	`°©_ª£t
 (&
cuºbus
->
¨bwaô°©s
);

601 
	}
}

604 
	$bus_£tˇŒbacks
 ()

606 
	}
}

609 
	$bus_öôülize
()

611 
i
;

613 
	`SèticAs£π
 ((
bus_evít
Ë<
DISKSIM_EVENT_SIZE
);

614 
i
=0; i<
numbu£s
; i++) {

615 
bus
 *
cuºbus
 = 
	`gëbus
(
i
);

616 
cuºbus
->
°©e
 = 
BUS_FREE
;

617 
	`addli°t€xåaq
((
evít
 **Ë&
cuºbus
->
ow√rs
);

618 
	`°©_öôülize
 (
°©deffûe
, "Arbôøti⁄ waôÅime", &
cuºbus
->
¨bwaô°©s
);

619 
	`°©_öôülize
 (
°©deffûe
, "Bu†idÀÖîiodÜígth", &
cuºbus
->
busidÀ°©s
);

621 
	`bus_ª£t°©s
();

622 
	}
}

625 
	$bus_¥öt°©s
()

627 
i
;

628 
¥efix
[81];

630 
	`Ârötf
 (
ouçutfûe
, "\nBUS STATISTICS\n");

631 
	`Ârötf
 (
ouçutfûe
, "--------------\n\n");

633 
i
=0; i < 
disksim
->
busöfo
->
bu£s_Àn
; i++) {

634 
bus
 *
cuºbus
 = 
	`gëbus
(
i
); if(!currbus) ;

635 i‡(
cuºbus
->
¥öt°©s
) {

636 
	`•rötf
 (
¥efix
, "Bu†#%d (%sË", 
i
, 
cuºbus
->
«me
);

637 
	`Ârötf
 (
ouçutfûe
, "Bu†#%d\n", 
i
);

638 
	`Ârötf
 (
ouçutfûe
, "Bu†#%d TŸÆ utûiz©i⁄Åime: \t%.2‡ \t%6.5f\n", 
i
, (
simtime
 - 
w¨mu±ime
 - 
cuºbus
->
runidÀtime
), ((simtime - warmuptime - currbus->runidletime) / (simtime - warmuptime)));

639 i‡(
disksim
->
busöfo
->
bus_¥ötidÀ°©s
) {

640 
	`°©_¥öt
 (&
cuºbus
->
busidÀ°©s
, 
¥efix
);

642 i‡(
disksim
->
busöfo
->
bus_¥öèrbwaô°©s
) {

643 
	`Ârötf
 (
ouçutfûe
, "Bu†#%d Numbî o‡¨bôøti⁄s: \t%d\n", 
i
, 
	`°©_gë_cou¡
 (&
cuºbus
->
¨bwaô°©s
));

644 
	`°©_¥öt
 (&
cuºbus
->
¨bwaô°©s
, 
¥efix
);

646 
	`Ârötf
 (
ouçutfûe
, "\n");

649 
	}
}

652 
	$bus_˛ón°©s
()

654 
i
;

656 
i
=0; i<
numbu£s
; i++) {

657 
bus
 *
cuºbus
 = 
	`gëbus
(
i
);

658 i‡(
cuºbus
->
°©e
 =
BUS_FREE
) {

659 
cuºbus
->
runidÀtime
 +
simtime
 - cuºbus->
œ°ow√d
;

660 
	`°©_upd©e
 (&
cuºbus
->
busidÀ°©s
, (
simtime
 - cuºbus->
œ°ow√d
));

663 
	}
}

665 
bus
 *
	$bus_c›y
(
bus
 *
‹ig
) {

666 
bus
 *
ªsu…
 = 
	`mÆloc
((bus));

667 if(
ªsu…
Ë 
	`mem˝y
‘esu…, 
‹ig
, (
bus
));

669 
	}
}

677 
bus
 *
	$disksim_bus_lﬂd∑øms
(
Õ_block
 *
b
,

678 *
num
)

680 
bus
 *
ªsu…
;

681 
c
;

683 if(!
disksim
->
busöfo
) {

684 
disksim
->
busöfo
 = 
	`mÆloc
((
busöfo_t
));

685 
	`bzîo
(
disksim
->
busöfo
, (
busöfo_t
));

692 
c
 = 0; c < 
numbu£s
; c++) {

693 if(!
disksim
->
busöfo
->
bu£s
[
c
]) { ; }

696 if(
c
 =
disksim
->
busöfo
->
bu£s_Àn
) {

697 
√wÀn
 = 
c
 ? 2*c : 2;

699 
disksim
->
busöfo
->
bu£s
 = 
	`ªÆloc
(disksim->businfo->buses,

700 
√wÀn
 * (*));

701 if(
√wÀn
 > 2)

702 
	`bzîo
(
disksim
->
busöfo
->
bu£s
 + 
c
, (
√wÀn
/2)*(*));

704 
	`bzîo
(
disksim
->
busöfo
->
bu£s
, 2 * (*));

706 
disksim
->
busöfo
->
bu£s_Àn
 = 
√wÀn
;

709 
ªsu…
 = 
	`mÆloc
((
bus
));

710 if(!
ªsu…
) {  0; }

711 
numbu£s
++;

713 
disksim
->
busöfo
->
bu£s
[
c
] = 
ªsu…
;

714 
	`bzîo
(
ªsu…
, (
bus
));

715 if(
num
Ë*num = 
c
;

717 
ªsu…
->
«me
 = 
	`°rdup
(
b
->name);

721 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
disksim_bus_mod
);

723 
ªsu…
->
ow√rs
 = 
NULL
;

724 
ªsu…
->
dïth
 = -1;

726  
ªsu…
;

727 
	}
}

731 
	$lﬂd_bus_t›o
(
Õ_t›o•ec
 *
t
, *
∑ª¡˘ o
) {

732 
c
, 
d
;

733 
bus
 *
b
;

734 
Õ_t›o•ec
 *
ts
 = 0;

735 
bu¢o
;

736 
¶Ÿnum
 = 0;

737 
ty≥
;

739 
	`as£π
(!
	`°rcmp
(
t
->
ty≥
, 
disksim_mods
[
DISKSIM_MOD_BUS
]->
«me
));

742 #ifde‡
WIN32


745 
b
 = 
	`gëbusby«me
(
t
->
«me
, &
bu¢o
);

746 
	`as£π
(
b
);

748 
	`as£π
(
b
 = 
	`gëbusby«me
(
t
->
«me
, &
bu¢o
));

751 
b
->
num¶Ÿs
 = 0;

752 
c
 = 0; c < 
t
->
l
->
vÆues_Àn
; c++)

753 if(!
t
->
l
->
vÆues
[
c
]) ;

755 
d
 = 0; d < 
t
->
l
->
vÆues
[
c
]->
v
.t.
Àn
; d++)

756 if(
t
->
l
->
vÆues
[
c
]->
v
.t.l[
d
].
«me
 ||Å->l->vÆues[c]->v.t.l[d].lË
b
->
num¶Ÿs
++;

759 if(
∑ª¡˘ o
Ë{ 
b
->
num¶Ÿs
++; }

761 
b
->
¶Ÿs
 = 
	`mÆloc
(b->
num¶Ÿs
 * (
¶Ÿ
));

762 
	`bzîo
(
b
->
¶Ÿs
, b->
num¶Ÿs
 * (
¶Ÿ
));

764 if(
∑ª¡˘ o
) {

765 
b
->
¶Ÿs
[0].
devty≥
 = 
CONTROLLER
;

766 
b
->
¶Ÿs
[0].
devno
 = *
∑ª¡˘ o
;

767 
¶Ÿnum
 = 1;

770 
c
 = 0; c < 
t
->
l
->
vÆues_Àn
; c++) {

771 if(!
t
->
l
->
vÆues
[
c
]) ;

773 if(
t
->
l
->
vÆues
[
c
]->à!
TOPOSPEC
) {

774 
	`Ârötf
(
°dîr
, "***ÉrrorÜoadingÅopology spec -- bad child device spec.\n");

778 
d
 = 0; d < 
t
->
l
->
vÆues
[
c
]->
v
.t.
Àn
; d++) {

779 
ts
 = &
t
->
l
->
vÆues
[
c
]->
v
.t.l[
d
];

780 if(!
ts
->
ty≥
) ;

783 
ty≥
 = 
	`Õ_mod_«me
(
ts
->type);

784 if(
ty≥
 =
	`Õ_mod_«me
("disksim_ctlr")) {

785 
b
->
¶Ÿs
[
¶Ÿnum
].
devty≥
 = 
CONTROLLER
;

787 if(!
	`gë˘Ãby«me
(
ts
->
«me
, &
b
->
¶Ÿs
[
¶Ÿnum
].
devno
)) {

788 
	`Ârötf
(
°dîr
, "***Éº‹: faûedÅÿlﬂd c⁄åﬁÀ∏\"%s\" i¡ÿ¶Ÿ %d o‡bu†%s:Çÿsuch c⁄åﬁÀ∏\"%s\".\n", 
ts
->
«me
, 
c
, 
t
->name,Ås->name);

792 if(!
	`lﬂd_˘Ã_t›o
(
ts
, &
bu¢o
)) {

793 
	`Ârötf
(
°dîr
, "***Éº‹: faûedÅÿlﬂd c⁄åﬁÀ∏t›ﬁogy s≥¯f‹ bu†%†¶Ÿ %d\n", 
t
->
«me
, 
c
);

797 i‡((
ty≥
 =
	`Õ_mod_«me
("disksim_disk"))

799 (
ty≥
 =
	`Õ_mod_«me
("disksim_simpledisk"))

801 (
ty≥
 =
	`Õ_mod_«me
("memsmodel_mems"))

803 (
ty≥
 =
	`Õ_mod_«me
("ssdmodel_ssd"))

806 
b
->
¶Ÿs
[
¶Ÿnum
].
devty≥
 = 
DEVICE
;

808 if(!
	`gëdevby«me
(
ts
->
«me
, &
b
->
¶Ÿs
[
¶Ÿnum
].
devno
, 0, 0)) {

809 
	`Ârötf
(
°dîr
, "***Érror: failedÅoÜoad device \"%s\" into slot %d of bus %s:Ço such device \"%s\".\n",

810 
ts
->
«me
, 
c
, 
t
->name,Ås->name);

815 
	`Ârötf
(
°dîr
, "Eº‹ÜﬂdögÅ›ﬁogy s≥¯-- slŸ mu° c⁄èöá devi˚ o∏®c⁄åﬁÀ∏“Ÿ %s).\n", 
ts
->
ty≥
);

822 
¶Ÿnum
++;

828 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_bus.h

101 
	~<°dio.h
>

102 
	~"c⁄fig.h
"

103 
	~"disksim_iosim.h
"

104 
	~"disksim_globÆ.h
"

105 
	~"disksim_°©.h
"

107 #i‚de‡
DISKSIM_BUS_H


108 
	#DISKSIM_BUS_H


	)

112 
	mdevty≥
;

113 
	mdevno
;

116 } 
	t¶Ÿ
;

118 
	sbus_ev
 {

119 
	mtime
;

120 
	mty≥
;

121 
bus_ev
 *
	m√xt
;

122 
bus_ev
 *
	m¥ev
;

123 
	mdevno
;

124 
	mdevty≥
;

125 
	mbu¢o
;

126 
	m¶Ÿno
;

127 
i‹eq_evít
 *
	mdñayed_evít
;

128 
	mwaô_°¨t
;

129 } 
	tbus_evít
;

133 
	sbusöfo
 {

134 
bus
 **
	mbu£s
;

135 
	mbu£s_Àn
;

136 
	mnumbu£s
;

137 
	mbus_¥ötidÀ°©s
;

138 
	mbus_¥öèrbwaô°©s
;

139 } 
	tbusöfo_t
;

141 
	#numbu£s
 (
disksim
->
busöfo
->
numbu£s
)

	)

143 
	sbus
 {

144 
	m°©e
;

145 
	mty≥
;

146 
	m¨bty≥
;

147 
bus_evít
 *
	mow√rs
;

148 
	m¨btime
;

149 
	mªadblkå™°ime
;

150 
	mwrôeblkå™°ime
;

151 
bus_evít
 *
	m¨bwö√r
;

152 
	m¥öt°©s
;

153 
	mdïth
;

154 
	mnum¶Ÿs
;

155 
¶Ÿ
 *
	m¶Ÿs
;

156 
	mœ°ow√d
;

157 
	mrunidÀtime
;

158 
°©gí
 
	m¨bwaô°©s
;

159 
°©gí
 
	mbusidÀ°©s
;

160 *
	m«me
;

161 } 
	tbus
;

166 
bus_ªad_t›röts
 (
FILE
 *
∑rfûe
);

167 
bus_ªad_•ecs
 (
FILE
 *
∑rfûe
);

168 
bus_ªad_phys‹g
 (
FILE
 *
∑rfûe
);

169 
bus_∑øm_ovîride
 (*
∑øm«me
, *
∑rvÆ
, 
fú°
, 
œ°
);

170 
bus_ow√rshù_gë
 (
bu¢o
, 
¶Ÿno
, 
i‹eq_evít
 *
cuº
);

171 
bus_ow√rshù_ªÀa£
 (
bu¢o
);

172 
bus_ªmove_‰om_¨bôøti⁄
 (
bu¢o
, 
i‹eq_evít
 *
cuº
);

173 
bus_dñay
 (
bu¢o
, 
devty≥
, 
devno
, 
dñay
, 
i‹eq_evít
 *
cuº
);

174 
bus_evít_¨rive
 (
i‹eq_evít
 *
cuº
);

175 
bus_gë_å™s„r_time
 (
bu¢o
, 
bcou¡
, 
ªad
);

176 
bus_gë_d©a_å™s„ªd
 (
i‹eq_evít
 *
cuº
, 
dïth
);

177 
bus_gë_c⁄åﬁÀr_¶Ÿ
 (
bu¢o
, 
˘ o
);

178 
bus_dñivî_evít
 (
bu¢o
, 
¶Ÿno
, 
i‹eq_evít
 *
cuº
);

179 
bus_£t_dïths
 ();

180 
bus_£t_to_zîo_dïth
 (
bu¢o
);

181 
bus_¥öt_phys_c⁄fig
 ();

182 
bus_£tˇŒbacks
 ();

183 
bus_öôülize
 ();

184 
bus_ª£t°©s
 ();

185 
bus_¥öt°©s
 ();

186 
bus_˛ón°©s
 ();

187 
bus
 *
gëbusby«me
(*
«me
, *
num
);

189 
lﬂd_bus_t›o
(
Õ_t›o•ec
 *
t
, *
∑ª¡˘ o
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_cache.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_iosim.h
"

103 
	~"disksim_ioqueue.h
"

104 
	~"disksim_ˇche.h
"

105 
	~"disksim_ˇchemem.h
"

106 
	~"disksim_ˇchedev.h
"

107 
	~"c⁄fig.h
"

109 
	~"moduÀs/moduÀs.h
"

111 
	$ˇche_£tˇŒbacks
() {

112 
	`ˇchemem_£tˇŒbacks
();

113 
	`ˇchedev_£tˇŒbacks
();

114 
	}
}

116 
ˇche_if
 *
	$disksim_ˇche_lﬂd∑øms
(
Õ_block
 *
b
)

118 
c
 = 0;

119 
ˇche_if
 *
ªsu…
;

122 
b
->
ty≥
) {

123 
DISKSIM_MOD_CACHEMEM
:

124 
ªsu…
 = 
	`disksim_ˇchemem_lﬂd∑øms
(
b
);

126 
DISKSIM_MOD_CACHEDEV
:

127 
ªsu…
 = 
	`disksim_ˇchedev_lﬂd∑øms
(
b
);

130 
	`Ârötf
(
°dîr
, "***Éº‹: InvÆid cachêty≥ (%dË•ecifõd.\n", 
	`IVAL
(
b
->
∑øms
[
c
]));

136 if(!
ªsu…
) {

137 
	`Ârötf
(
°dîr
, "***Érror: failedÅoÜoad cache definition.\n");

141  
ªsu…
;

142 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_cache.h

101 #i‚de‡
DISKSIM_CACHE_H


102 
	#DISKSIM_CACHE_H


	)

104 
	~"c⁄fig.h
"

109 
	sˇche_if
 {

110 (*
	mˇche_£tˇŒbacks
)();

112 (*
	mˇche_öôülize
)(
ˇche_if
 *
	mˇche
,

113 (**
	missuefunc
)(*, 
	mi‹eq_evít
 *),

114 *
	missuï¨am
,

115 
	mioq
 * (**
	mqueueföd
)(*, ),

116 *
	mqueueföd∑øm
,

118 (**
	mwakeupfunc
)(*, 
	mˇchìvít
 *),

119 *
	mwakeuµ¨am
,

120 
	mnumdevs
);

122 (*
	mˇche_ª£t°©s
)(
ˇche_if
 *
	mˇche
);

124 (*
	mˇche_¥öt°©s
)(
ˇche_if
 *
	mˇche
, *
	m¥efix
);

126 (*
	mˇche_˛ón°©s
)(
ˇche_if
 *
	mˇche
);

128 
	mˇche_if
 *(*
	mˇche_c›y
)(
ˇche_if
 *
	mˇche
);

130 (*
	mˇche_gë_block
)(
ˇche_if
 *
	mˇche
,

131 
i‹eq_evít
 *
	mªq
,

132 (**
	md⁄efunc
)(*, 
	mi‹eq_evít
 *),

133 *
	md⁄ï¨am
);

135 (*
	mˇche_‰ì_block_˛ón
)(
ˇche_if
 *
	mˇche
,

136 
i‹eq_evít
 *
	mªq
);

138 (*
	mˇche_‰ì_block_dúty
)(
ˇche_if
 *
	mˇche
,

139 
i‹eq_evít
 *
	mªq
,

140 (**
	md⁄efunc
)(*, 
	mi‹eq_evít
 *),

141 *
	md⁄ï¨am
);

143 *(*
	mˇche_disk_ac˚ss_com∂ëe
)(
ˇche_if
 *
	mˇche
,

144 
i‹eq_evít
 *
	mcuº
);

146 (*
	mˇche_wakeup_com∂ëe
)(
ˇche_if
 *
	mˇche
,

147 *
	mdesc
);

149 (*
	mˇche_sync
)(
ˇche_if
 *
	mˇche
);

151 (*
	mˇche_gë_maxªqsize
)(
ˇche_if
 *
	mˇche
);

154 
ˇche_if
 *
disksim_ˇche_lﬂd∑øms
(
Õ_block
 *
b
);

156 
ˇche_£tˇŒbacks
();

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_cachedev.c

123 
	#CACHE_DEVICE
 2

	)

125 
	~"moduÀs/moduÀs.h
"

126 
	~"disksim_ˇchedev.h
"

134 
	$ˇchedev_gë_maxªqsize
 (
ˇche_if
 *
c
)

136 
ˇche_dev
 *
ˇche
 = (ˇche_dev *)
c
;

137 (
ˇche
->
maxªqsize
);

138 
	}
}

141 
	$ˇchedev_em±y_d⁄efunc
 (*
d⁄ï¨am
, 
i‹eq_evít
 *
ªq
)

143 
	`addt€xåaq
((
evít
 *Ë
ªq
);

144 
	}
}

148 
	$ˇchedev_add_⁄goög_ªque°
 (
ˇche_dev
 *
ˇche
,

149 *
¸q
)

151 
ˇche_dev_evít
 *
ˇchîeq
 = (ˇche_dev_evíà*)
¸q
;

152 
ˇchîeq
->
√xt
 = 
ˇche
->
⁄goög_ªque°s
;

153 
ˇchîeq
->
¥ev
 = 
NULL
;

154 i‡(
ˇchîeq
->
√xt
) {

155 
ˇchîeq
->
√xt
->
¥ev
 = cachereq;

157 
ˇche
->
⁄goög_ªque°s
 = 
ˇchîeq
;

158 
	}
}

162 
	$ˇchedev_ªmove_⁄goög_ªque°
 (
ˇche_dev
 *
ˇche
,

163 
ˇche_dev_evít
 *
ˇchîeq
)

165 i‡(
ˇchîeq
->
√xt
) {

166 
ˇchîeq
->
√xt
->
¥ev
 = cachereq->prev;

168 i‡(
ˇchîeq
->
¥ev
) {

169 
ˇchîeq
->
¥ev
->
√xt
 = cachereq->next;

171 i‡(
ˇche
->
⁄goög_ªque°s
 =
ˇchîeq
) {

172 
ˇche
->
⁄goög_ªque°s
 = 
ˇchîeq
->
√xt
;

174 
	}
}

177 
ˇche_dev_evít
 * 
	$ˇchedev_föd_⁄goög_ªque°
 (
ˇche_dev
 *
ˇche
, 
i‹eq_evít
 *
ªq
)

179 
ˇche_dev_evít
 *
tmp
 = 
ˇche
->
⁄goög_ªque°s
;

182 (
tmp
 !
NULL
Ë&& ((
ªq
->
›id
 !tmp->ªq->›idË|| (ªq->
blkno
 !tmp->ªq->blknoË|| (ªq->
bcou¡
 !tmp->ªq->bcou¡Ë|| (ªq->
buf
 !=Åmp->req->buf))) {

183 
tmp
 =Åmp->
√xt
;

186  (
tmp
);

187 
	}
}

191 
	$ˇchedev_cou¡_dúty_blocks
 (
ˇche_dev
 *
ˇche
)

193 
dútyblocks
 = 0;

194 
i
;

196 
i
=0; i<
ˇche
->
size
; i++) {

197 i‡(
	`bô_ã°
(
ˇche
->
dútym≠
,
i
)) {

198 
dútyblocks
++;

201  (
dútyblocks
);

202 
	}
}

205 
	$ˇchedev_£tbôs
 (
bô°r_t
 *
bôm≠
, 
i‹eq_evít
 *
ªq
)

207 
	`bô_n£t
 (
bôm≠
, 
ªq
->
blkno
, (ªq->blkno+ªq->
bcou¡
-1));

208 
	}
}

211 
	$ˇchedev_˛órbôs
 (
bô°r_t
 *
bôm≠
, 
i‹eq_evít
 *
ªq
)

213 
	`bô_n˛ór
 (
bôm≠
, 
ªq
->
blkno
, (ªq->blkno+ªq->
bcou¡
-1));

214 
	}
}

217 
	$ˇchedev_i§ódhô
 (
ˇche_dev
 *
ˇche
, 
i‹eq_evít
 *
ªq
)

219 
œ°blk
 = 
ªq
->
blkno
 +Ñeq->
bcou¡
;

220 
i
;

222 i‡(
œ°blk
 >
ˇche
->
size
) {

226 
i
=
ªq
->
blkno
; i<
œ°blk
; i++) {

227 i‡(
	`bô_ã°
(
ˇche
->
vÆidm≠
,
i
) == 0) {

233 
	}
}

236 
	$ˇchedev_iswrôehô
 (
ˇche_dev
 *
ˇche
, 
i‹eq_evít
 *
ªq
)

238 i‡((
ªq
->
blkno
+ªq->
bcou¡
Ë>
ˇche
->
size
) {

242 
	}
}

245 
	$ˇchedev_föd_dúty_ˇche_blocks
 (
ˇche_dev
 *
ˇche
, *
blknoPå
, *
bcou¡På
)

247 
blkno
;

249 
	`bô_ffs
 (
ˇche
->
dútym≠
, cache->
size
, 
blknoPå
);

250 i‡(*
blknoPå
 == -1) {

254 
blkno
 = *
blknoPå
;

255 
	`bô_ã°
 (
ˇche
->
dútym≠
, 
blkno
) != 0) {

256 
blkno
++;

258 *
bcou¡På
 = 
blkno
 - *
blknoPå
;

261 
	}
}

264 
	$ˇchedev_≥riodic_ˇŒback
 (
timî_evít
 *
timîeq
)

266 
	`Ârötf
 (
°dîr
, "cachedev_periodic_callbackÇot yet supported\n");

267 
	`ASSERT
 (0);

268 
	`exô
 (0);

269 
	}
}

272 
	$ˇchedev_idÀw‹k_ˇŒback
 (*
idÀw‹k∑øm
, 
idÀdevno
)

275 
ˇche_dev
 *
ˇche
 = 
idÀw‹k∑øm
;

276 
ˇche_dev_evít
 *
Êushdesc
;

277 
i‹eq_evít
 *
Êushªq
;

278 
blkno
, 
bcou¡
;

279 
ioq
 *
queue
;

281 
	`ASSERT
 (
idÀdevno
 =
ˇche
->
ªÆ_devno
);

283 
queue
 = (*
ˇche
->
queueföd
)(ˇche->
queueföd∑øm
, cache->
ªÆ_devno
);

284 i‡(
	`ioqueue_gë_numbî_ö_queue
 (
queue
) != 0) {

288 
queue
 = (*
ˇche
->
queueföd
)(ˇche->
queueföd∑øm
, cache->
ˇche_devno
);

289 i‡(
	`ioqueue_gë_numbî_ö_queue
 (
queue
) != 0) {

293 i‡(
	`ˇchedev_föd_dúty_ˇche_blocks
 (
ˇche
, &
blkno
, &
bcou¡
) == 0) {

298 
ˇche
->
buf„r•a˚
 +
bcou¡
;

299 i‡(
ˇche
->
buf„r•a˚
 > cache->
°©
.
maxbuf„r•a˚
) {

300 
ˇche
->
°©
.
maxbuf„r•a˚
 = cache->
buf„r•a˚
;

303 
Êushdesc
 = (
ˇche_dev_evít
 *Ë
	`gë‰omexåaq
();

304 
Êushdesc
->
ty≥
 = 
CACHE_EVENT_IDLEFLUSH_READ
;

305 
Êushªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

306 
Êushªq
->
buf
 = 
Êushdesc
;

307 
Êushªq
->
devno
 = 
ˇche
->
ˇche_devno
;

308 
Êushªq
->
blkno
 = blkno;

309 
Êushªq
->
bcou¡
 = bcount;

310 
Êushªq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

311 
Êushªq
->
Êags
 = 
READ
;

312 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
Êushªq
);

313 
ˇche
->
°©
.
de°agîóds
++;

314 
ˇche
->
°©
.
de°agîódblocks
 +
bcou¡
;

315 
	}
}

321 
ˇchedev_gë_block
 (
ˇche_if
 *
c
,

322 
i‹eq_evít
 *
ªq
,

323 (**
d⁄efunc
)(*, 
i‹eq_evít
 *),

324 *
d⁄ï¨am
)

326 
ˇche_dev
 *
ˇche
 = (ˇche_dev *)
c
;

327 
ˇche_dev_evít
 *
rwdesc
 = (ˇche_dev_evíà*Ë
	`gë‰omexåaq
();

328 
i‹eq_evít
 *
fûÃeq
;

329 
devno
;

334 i‡(
ªq
->
devno
 !
ˇche
->
ªÆ_devno
) {

335 
	`Ârötf
 (
°dîr
, "ˇchedev_gë_blockÅryögÅÿˇchêblock†f‹ wr⁄g devi˚ (%d should bê%d)\n", 
ªq
->
devno
, 
ˇche
->
ªÆ_devno
);

336 
	`ASSERT
(0);

337 
	`exô
(1);

342 
ˇche
->
buf„r•a˚
 +
ªq
->
bcou¡
;

343 i‡(
ˇche
->
buf„r•a˚
 > cache->
°©
.
maxbuf„r•a˚
) {

344 
ˇche
->
°©
.
maxbuf„r•a˚
 = cache->
buf„r•a˚
;

347 
rwdesc
->
ty≥
 = (
ªq
->
Êags
 & 
READ
Ë? 
CACHE_EVENT_READ
 : 
CACHE_EVENT_WRITE
;

348 
rwdesc
->
d⁄efunc
 = donefunc;

349 
rwdesc
->
d⁄ï¨am
 = doneparam;

350 
rwdesc
->
ªq
 =Ñeq;

351 
ªq
->
√xt
 = 
NULL
;

352 
ªq
->
¥ev
 = 
NULL
;

353 
rwdesc
->
Êags
 = 0;

354 
	`ˇchedev_add_⁄goög_ªque°
 (
ˇche
, 
rwdesc
);

356 i‡(
ªq
->
Êags
 & 
READ
) {

357 
ˇche
->
°©
.
ªads
++;

358 
ˇche
->
°©
.
ªadblocks
 +
ªq
->
bcou¡
;

361 i‡(
	`ˇchedev_i§ódhô
 (
ˇche
, 
ªq
)) {

362 
devno
 = 
ˇche
->
ˇche_devno
;

363 
ˇche
->
°©
.
ªadhôsfuŒ
++;

365 
devno
 = 
ˇche
->
ªÆ_devno
;

366 
ˇche
->
°©
.
ªadmis£s
++;

369 
fûÃeq
 = 
	`i‹eq_c›y
 (
ªq
);

370 
fûÃeq
->
buf
 = 
rwdesc
;

371 
fûÃeq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

372 
fûÃeq
->
devno
 = devno;

376 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
fûÃeq
);

383 (*
d⁄efunc
)(
d⁄ï¨am
, 
ªq
);

386 
	}
}

393 
	$ˇchedev_‰ì_block_˛ón
 (
ˇche_if
 *
c
,

394 
i‹eq_evít
 *
ªq
)

396 
ˇche_dev
 *
ˇche
 = (ˇche_dev *)
c
;

397 
ˇche_dev_evít
 *
rwdesc
;

404 
rwdesc
 = 
	`ˇchedev_föd_⁄goög_ªque°
 (
ˇche
, 
ªq
);

405 
	`ASSERT
 (
rwdesc
 !
NULL
);

407 i‡(
rwdesc
->
ty≥
 =
CACHE_EVENT_READ
) {

408 
ˇche
->
buf„r•a˚
 -
ªq
->
bcou¡
;

409 
	`ˇchedev_ªmove_⁄goög_ªque°
 (
ˇche
, 
rwdesc
);

410 
	`addt€xåaq
 ((
evít
 *Ë
rwdesc
);

412 
	`ASSERT
 (
rwdesc
->
ty≥
 =
CACHE_EVENT_POPULATE_ALSO
);

413 
rwdesc
->
ty≥
 = 
CACHE_EVENT_POPULATE_ONLY
;

415 
	}
}

422 
ˇchedev_‰ì_block_dúty
 (
ˇche_if
 *
c
,

423 
i‹eq_evít
 *
ªq
,

424 (**
d⁄efunc
)(*, 
i‹eq_evít
 *),

425 *
d⁄ï¨am
)

427 
ˇche_dev
 *
ˇche
 = (ˇche_dev *)
c
;

428 
i‹eq_evít
 *
Êushªq
;

429 
ˇche_dev_evít
 *
wrôedesc
;

433 
ˇche
->
°©
.
wrôes
++;

434 
ˇche
->
°©
.
wrôeblocks
 +
ªq
->
bcou¡
;

436 
wrôedesc
 = 
	`ˇchedev_föd_⁄goög_ªque°
 (
ˇche
, 
ªq
);

437 
	`ASSERT
 (
wrôedesc
 !
NULL
);

438 
	`ASSERT
 (
wrôedesc
->
ty≥
 =
CACHE_EVENT_WRITE
);

440 
wrôedesc
->
d⁄efunc
 = donefunc;

441 
wrôedesc
->
d⁄ï¨am
 = doneparam;

442 
wrôedesc
->
ªq
 =Ñeq;

443 
ªq
->
ty≥
 = 
IO_REQUEST_ARRIVE
;

444 
ªq
->
√xt
 = 
NULL
;

445 
ªq
->
¥ev
 = 
NULL
;

448 
Êushªq
 = 
	`i‹eq_c›y
(
ªq
);

449 
Êushªq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

450 
Êushªq
->
buf
 = 
wrôedesc
;

451 i‡(
	`ˇchedev_iswrôehô
 (
ˇche
, 
ªq
)) {

452 
Êushªq
->
devno
 = 
ˇche
->
ˇche_devno
;

453 
ˇche
->
°©
.
wrôehôsfuŒ
++;

455 
ˇche
->
°©
.
wrôemis£s
++;

460 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
Êushªq
);

463 i‡(
ˇche
->
Êush_idÀdñay
 >= 0.0) {

464 
	`ioqueue_ª£t_idÀdëe˘î
((*
ˇche
->
queueföd
)(ˇche->
queueföd∑øm
, 
ªq
->
devno
), 0);

469 
	}
}

472 
	$ˇchedev_sync
 (
ˇche_if
 *
c
)

475 
	}
}

479 
	$ˇchedev_disk_ac˚ss_com∂ëe
 (
ˇche_if
 *
c
,

480 
i‹eq_evít
 *
cuº
)

482 
ˇche_dev
 *
ˇche
 = (ˇche_dev *)
c
;

483 
ˇche_dev_evít
 *
rwdesc
 = 
cuº
->
buf
;

484 
ˇche_dev_evít
 *
tmp
 = 
NULL
;

488 
rwdesc
->
ty≥
) {

489 
CACHE_EVENT_READ
:

493 i‡(
cuº
->
devno
 =
ˇche
->
ªÆ_devno
) {

494 
i‹eq_evít
 *
Êushªq
 = 
	`i‹eq_c›y
(
rwdesc
->
ªq
);

495 
Êushªq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

496 
Êushªq
->
buf
 = 
rwdesc
;

497 
Êushªq
->
Êags
 = 
WRITE
;

498 
Êushªq
->
devno
 = 
ˇche
->
ˇche_devno
;

499 
rwdesc
->
ty≥
 = 
CACHE_EVENT_POPULATE_ALSO
;

500 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
Êushªq
);

501 
ˇche
->
°©
.
p›wrôes
++;

502 
ˇche
->
°©
.
p›wrôeblocks
 +
rwdesc
->
ªq
->
bcou¡
;

506 (*
rwdesc
->
d⁄efunc
)‘wdesc->
d⁄ï¨am
,rwdesc->
ªq
);

509 
CACHE_EVENT_WRITE
:

512 i‡(
cuº
->
devno
 =
ˇche
->
ˇche_devno
) {

513 
	`ˇchedev_£tbôs
 (
ˇche
->
vÆidm≠
, 
cuº
);

514 
	`ˇchedev_£tbôs
 (
ˇche
->
dútym≠
, 
cuº
);

515 i‡(
ˇche
->
wrôescheme
 =
CACHE_WRITE_THRU
) {

516 
i‹eq_evít
 *
Êushªq
 = 
	`i‹eq_c›y
(
rwdesc
->
ªq
);

517 
Êushªq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

518 
Êushªq
->
buf
 = 
rwdesc
;

519 
Êushªq
->
Êags
 = 
WRITE
;

520 
Êushªq
->
devno
 = 
ˇche
->
ªÆ_devno
;

521 
rwdesc
->
ty≥
 = 
CACHE_EVENT_FLUSH
;

522 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
Êushªq
);

523 
ˇche
->
°©
.
de°agewrôes
++;

524 
ˇche
->
°©
.
de°agewrôeblocks
 +
rwdesc
->
ªq
->
bcou¡
;

527 (*
rwdesc
->
d⁄efunc
)‘wdesc->
d⁄ï¨am
,rwdesc->
ªq
);

529 i‡(
rwdesc
->
ty≥
 !
CACHE_EVENT_FLUSH
) {

530 
	`ˇchedev_ªmove_⁄goög_ªque°
 (
ˇche
, 
rwdesc
);

531 
	`addt€xåaq
 ((
evít
 *Ë
rwdesc
);

532 
ˇche
->
buf„r•a˚
 -
cuº
->
bcou¡
;

537 
CACHE_EVENT_POPULATE_ONLY
:

538 
	`ˇchedev_£tbôs
 (
ˇche
->
vÆidm≠
, 
cuº
);

539 
	`ˇchedev_ªmove_⁄goög_ªque°
 (
ˇche
, 
rwdesc
);

540 
	`addt€xåaq
 ((
evít
 *Ë
rwdesc
);

541 
ˇche
->
buf„r•a˚
 -
cuº
->
bcou¡
;

544 
CACHE_EVENT_POPULATE_ALSO
:

545 
	`ˇchedev_£tbôs
 (
ˇche
->
vÆidm≠
, 
cuº
);

546 
rwdesc
->
ty≥
 = 
CACHE_EVENT_READ
;

549 
CACHE_EVENT_FLUSH
:

550 
	`ˇchedev_˛órbôs
 (
ˇche
->
dútym≠
, 
cuº
);

551 
	`ˇchedev_ªmove_⁄goög_ªque°
 (
ˇche
, 
rwdesc
);

552 
	`addt€xåaq
 ((
evít
 *Ë
rwdesc
);

553 
ˇche
->
buf„r•a˚
 -
cuº
->
bcou¡
;

556 
CACHE_EVENT_IDLEFLUSH_READ
:

558 
i‹eq_evít
 *
Êushªq
 = 
	`i‹eq_c›y
 (
cuº
);

559 
Êushªq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

560 
Êushªq
->
Êags
 = 
WRITE
;

561 
Êushªq
->
devno
 = 
ˇche
->
ªÆ_devno
;

562 
rwdesc
->
ty≥
 = 
CACHE_EVENT_IDLEFLUSH_FLUSH
;

563 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
Êushªq
);

564 
ˇche
->
°©
.
de°agewrôes
++;

565 
ˇche
->
°©
.
de°agewrôeblocks
 +
cuº
->
bcou¡
;

568 
CACHE_EVENT_IDLEFLUSH_FLUSH
:

569 
	`ˇchedev_˛órbôs
 (
ˇche
->
dútym≠
, 
cuº
);

570 
	`ˇchedev_ªmove_⁄goög_ªque°
 (
ˇche
, 
rwdesc
);

571 
	`addt€xåaq
 ((
evít
 *Ë
rwdesc
);

572 
	`ˇchedev_idÀw‹k_ˇŒback
 (
ˇche
, 
cuº
->
devno
);

573 
ˇche
->
buf„r•a˚
 -
cuº
->
bcou¡
;

577 
	`ddbg_as£π2
(0, "Unknown cachedevÉventÅype");

581 
	`addt€xåaq
((
evít
 *Ë
cuº
);

584 (
tmp
);

585 
	}
}

589 
	$ˇchedev_wakeup_com∂ëe
 (
ˇche_if
 *
c
,

590 *
d
)

592 
ˇche_dev_evít
 *
desc
 = (ˇche_dev_evíà*)
d
;

593 
ˇche_dev
 *
ˇche
 = (ˇche_dev *)
c
;

594 
	`ASSERT
 (0);

599 
desc
->
ty≥
) {

600 
CACHE_EVENT_READ
:

601 
	`ˇche_ªad_c⁄töue
(
ˇche
, 
desc
);

603 
CACHE_EVENT_WRITE
:

604 
	`ˇche_wrôe_c⁄töue
(
ˇche
, 
desc
);

606 
CACHE_EVENT_FLUSH
:

607 (*
desc
->
d⁄efunc
)(desc->
d⁄ï¨am
, desc->
ªq
);

608 
	`addt€xåaq
((
evít
 *Ë
desc
);

612 
	`ddbg_as£π2
(0, "Unknown cachedevÉventÅype");

616 
	}
}

620 
	$ˇchedev_ª£t°©s
 (
ˇche_if
 *
c
)

622 
ˇche_dev
 *
ˇche
 = (ˇche_dev *)
c
;

623 
ˇche
->
°©
.
ªads
 = 0;

624 
ˇche
->
°©
.
ªadblocks
 = 0;

625 
ˇche
->
°©
.
ªadhôsfuŒ
 = 0;

626 
ˇche
->
°©
.
ªadmis£s
 = 0;

627 
ˇche
->
°©
.
p›wrôes
 = 0;

628 
ˇche
->
°©
.
p›wrôeblocks
 = 0;

629 
ˇche
->
°©
.
wrôes
 = 0;

630 
ˇche
->
°©
.
wrôeblocks
 = 0;

631 
ˇche
->
°©
.
wrôehôsfuŒ
 = 0;

632 
ˇche
->
°©
.
wrôemis£s
 = 0;

633 
ˇche
->
°©
.
de°agîóds
 = 0;

634 
ˇche
->
°©
.
de°agîódblocks
 = 0;

635 
ˇche
->
°©
.
de°agewrôes
 = 0;

636 
ˇche
->
°©
.
de°agewrôeblocks
 = 0;

637 
ˇche
->
°©
.
maxbuf„r•a˚
 = 0;

638 
	}
}

642 
	$ˇchedev_£tˇŒbacks
()

644 
disksim
->
d⁄efunc_ˇchedev_em±y
 = 
ˇchedev_em±y_d⁄efunc
;

645 
disksim
->
idÀw‹k_ˇchedev
 = 
ˇchedev_idÀw‹k_ˇŒback
;

646 
disksim
->
timîfunc_ˇchedev
 = 
ˇchedev_≥riodic_ˇŒback
;

647 
	}
}

651 
ˇchedev_öôülize
 (
ˇche_if
 *
c
,

652 (**
issuefunc
)(*,
i‹eq_evít
 *),

653 *
issuï¨am
,

654 
ioq
 * (**
queueföd
)(*,),

655 *
queueföd∑øm
,

656 (**
wakeupfunc
)(*, 
ˇchìvít
 *),

657 *
wakeuµ¨am
,

658 
numdevs
)

660 
ˇche_dev
 *
ˇche
 = (ˇche_dev *)
c
;

661 
	`SèticAs£π
 ((
ˇche_dev_evít
Ë<
DISKSIM_EVENT_SIZE
);

663 
ˇche
->
issuefunc
 = issuefunc;

664 
ˇche
->
issuï¨am
 = issueparam;

665 
ˇche
->
queueföd
 = queuefind;

666 
ˇche
->
queueföd∑øm
 = queuefindparam;

667 
ˇche
->
wakeupfunc
 = wakeupfunc;

668 
ˇche
->
wakeuµ¨am
 = wakeupparam;

669 
ˇche
->
buf„r•a˚
 = 0;

670 
ˇche
->
⁄goög_ªque°s
 = 
NULL
;

671 
	`bzîo
 (
ˇche
->
vÆidm≠
, 
	`bô°r_size
(ˇche->
size
));

672 
	`bzîo
 (
ˇche
->
dútym≠
, 
	`bô°r_size
(ˇche->
size
));

673 
	`ˇchedev_ª£t°©s
(
c
);

675 i‡(
ˇche
->
Êush_idÀdñay
) {

676 
ioq
 *
queue
 = (*
queueföd
)(
queueföd∑øm
,
ˇche
->
ªÆ_devno
);

677 
	`ASSERT
 (
queue
 !
NULL
);

678 
	`ioqueue_£t_idÀw‹k_fun˘i⁄
 (
queue
,

679 &
disksim
->
idÀw‹k_ˇchedev
,

680 
ˇche
,

681 
ˇche
->
Êush_idÀdñay
);

684 i‡(
	`devi˚_gë_numbî_of_blocks
(
ˇche
->
ˇche_devno
Ë< cache->
size
) {

685 
	`Ârötf
 (
°dîr
, "Sizêo‡ˇchedevÉx˚ed†th© o‡a˘uÆ cachêdevi˚ (devnÿ%d): %d > %d\n", 
ˇche
->
ˇche_devno
, cache->
size
, 
	`devi˚_gë_numbî_of_blocks
(cache->cache_devno));

686 
	`ddbg_as£π
(0);

688 
	}
}

692 
	$ˇchedev_˛ón°©s
 (
ˇche_if
 *
ˇche
)

694 
	}
}

698 
	$ˇchedev_¥öt°©s
 (
ˇche_if
 *
c
, *
¥efix
)

700 
ˇche_dev
 *
ˇche
 = (ˇche_dev *)
c
;

701 
ªqs
 = 
ˇche
->
°©
.
ªads
 + cache->°©.
wrôes
;

702 
blocks
 = 
ˇche
->
°©
.
ªadblocks
 + cache->°©.
wrôeblocks
;

704 
	`Ârötf
 (
ouçutfûe
, "%sˇchêªque°s: %6d\n", 
¥efix
, 
ªqs
);

705 i‡(
ªqs
 == 0) {

709 
	`Ârötf
 (
ouçutfûe
, "%sˇchêªadÑeque°s: %6d \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
ªads
, ((Ëˇche->°©.ªad†/ (Ë
ªqs
));

711 i‡(
ˇche
->
°©
.
ªads
) {

712 
	`Ârötf
(
ouçutfûe
, "%sˇchêblock†ªad: %6d \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
ªadblocks
, ((Ëˇche->°©.ªadblock†/ (Ë
blocks
));

713 
	`Ârötf
(
ouçutfûe
, "%sˇchêªad mis£s: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
ªadmis£s
, ((Ëˇche->°©.ªadmis£†/ (Ë
ªqs
), ((Ëˇche->°©.ªadmis£†/ (Ëˇche->°©.
ªads
));

715 
	`Ârötf
(
ouçutfûe
, "%sˇchêªad fuŒ hôs: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
ªadhôsfuŒ
, ((Ëˇche->°©.ªadhôsfuŒ / (Ë
ªqs
), ((Ëˇche->°©.ªadhôsfuŒ / (Ëˇche->°©.
ªads
));

717 
	`Ârötf
(
ouçutfûe
, "%sˇchêp›uœti⁄ wrôes: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
p›wrôes
, ((Ëˇche->°©.p›wrôe†/ (Ë
ªqs
), ((Ëˇche->°©.p›wrôe†/ (Ëˇche->°©.
ªads
));

719 
	`Ârötf
(
ouçutfûe
, "%sˇchêblockÖ›uœti⁄ wrôes: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
p›wrôeblocks
, ((Ëˇche->°©.p›wrôeblock†/ (Ë
blocks
), ((Ëˇche->°©.p›wrôeblock†/ (Ëˇche->°©.
ªadblocks
));

722 
	`Ârötf
(
ouçutfûe
, "%sˇchêwrôêªque°s: %6d \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôes
, ((Ëˇche->°©.wrôe†/ (Ë
ªqs
));

724 i‡(
ˇche
->
°©
.
wrôes
) {

725 
	`Ârötf
(
ouçutfûe
, "%sˇchêblock†wrôãn: %6d \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôeblocks
, ((Ëˇche->°©.wrôeblock†/ (Ë
blocks
));

726 
	`Ârötf
(
ouçutfûe
, "%sˇchêwrôêmis£s: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôemis£s
, ((Ëˇche->°©.wrôemis£†/ (Ë
ªqs
), ((Ëˇche->°©.wrôemis£†/ (Ëˇche->°©.
wrôes
));

728 
	`Ârötf
(
ouçutfûe
, "%sˇchêfuŒ wrôêhôs: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôehôsfuŒ
, ((Ëˇche->°©.wrôehôsfuŒ / (Ë
ªqs
), ((Ëˇche->°©.wrôehôsfuŒ / (Ëˇche->°©.
wrôes
));

730 
	`Ârötf
(
ouçutfûe
, "%sˇchêde°agê¥e-ªads: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
de°agîóds
, ((Ëˇche->°©.de°agîód†/ (Ë
ªqs
), ((Ëˇche->°©.de°agîód†/ (Ëˇche->°©.
wrôes
));

731 
	`Ârötf
(
ouçutfûe
, "%sˇchêblock de°agê¥e-ªads: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
de°agîódblocks
, ((Ëˇche->°©.de°agîódblock†/ (Ë
blocks
), ((Ëˇche->°©.de°agîódblock†/ (Ëˇche->°©.
wrôeblocks
));

733 
	`Ârötf
(
ouçutfûe
, "%sˇchêde°age†(wrôe): %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
de°agewrôes
, ((Ëˇche->°©.de°agewrôe†/ (Ë
ªqs
), ((Ëˇche->°©.de°agewrôe†/ (Ëˇche->°©.
wrôes
));

735 
	`Ârötf
(
ouçutfûe
, "%sˇchêblock de°age†(wrôe): %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
de°agewrôeblocks
, ((Ëˇche->°©.de°agewrôeblock†/ (Ë
blocks
), ((Ëˇche->°©.de°agewrôeblock†/ (Ëˇche->°©.
wrôeblocks
));

737 
	`Ârötf
(
ouçutfûe
, "%sˇchêíd dúty blocks: %6d \t%6.4f\n", 
¥efix
, 
	`ˇchedev_cou¡_dúty_blocks
(
ˇche
), ((Ëˇchedev_cou¡_dúty_blocks(ˇcheË/ (Ëˇche->
°©
.
wrôeblocks
));

740 
	`Ârötf
 (
ouçutfûe
, "%sˇchêbuf„r•a˚ u£Énd: %6d\n", 
¥efix
, 
ˇche
->
buf„r•a˚
);

742 
	`Ârötf
 (
ouçutfûe
, "%sˇchêbuf„r•a˚ u£ max: %6d\n", 
¥efix
, 
ˇche
->
°©
.
maxbuf„r•a˚
);

743 
	}
}

746 
ˇche_if
 *

747 
	$ˇchedev_c›y
 (
ˇche_if
 *
c
)

749 
ˇche_dev
 *
ˇche
 = (ˇche_dev *)
c
;

750 
ˇche_dev
 *
√w
 = (ˇche_dev *Ë
	`DISKSIM_mÆloc
((cache_dev));

752 
	`ASSERT
(
√w
 !
NULL
);

753 
	`bzîo
 (
√w
, (
ˇche_dev
));

755 
√w
->
issuefunc
 = 
ˇche
->issuefunc;

756 
√w
->
issuï¨am
 = 
ˇche
->issueparam;

757 
√w
->
queueföd
 = 
ˇche
->queuefind;

758 
√w
->
queueföd∑øm
 = 
ˇche
->queuefindparam;

759 
√w
->
wakeupfunc
 = 
ˇche
->wakeupfunc;

760 
√w
->
wakeuµ¨am
 = 
ˇche
->wakeupparam;

761 
√w
->
size
 = 
ˇche
->size;

762 
√w
->
maxªqsize
 = 
ˇche
->maxreqsize;

764  (
ˇche_if
 *)
√w
;

765 
	}
}

767 
ˇche_if
 
	gdisksim_ˇche_dev
 = {

768 
ˇchedev_£tˇŒbacks
,

769 
ˇchedev_öôülize
,

770 
ˇchedev_ª£t°©s
,

771 
ˇchedev_¥öt°©s
,

772 
ˇchedev_˛ón°©s
,

773 
ˇchedev_c›y
,

774 
ˇchedev_gë_block
,

775 
ˇchedev_‰ì_block_˛ón
,

776 
ˇchedev_‰ì_block_dúty
,

777 
ˇchedev_disk_ac˚ss_com∂ëe
,

778 
ˇchedev_wakeup_com∂ëe
,

779 
ˇchedev_sync
,

780 
ˇchedev_gë_maxªqsize


783 
ˇche_if
 *
	$disksim_ˇchedev_lﬂd∑øms
(
Õ_block
 *
b
)

785 
c
;

786 
ˇche_dev
 *
ªsu…
;

788 
ªsu…
 = 
	`ˇŒoc
(1, (
ˇche_dev
));

789 
ªsu…
->
hdr
 = 
disksim_ˇche_dev
;

792 
ªsu…
->
«me
 = 
b
->«mê? 
	`°rdup
(b->name) : 0;

796 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
disksim_ˇchedev_mod
);

798  (
ˇche_if
 *)
ªsu…
;

799 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_cachedev.h

101 #i‚de‡
DISKSIM_CACHEDEV_H


102 
	#DISKSIM_CACHEDEV_H


	)

104 
	~"disksim_globÆ.h
"

105 
	~"disksim_iosim.h
"

106 
	~"disksim_ioqueue.h
"

107 
	~"c⁄fig.h
"

108 
	~"disksim_ˇche.h
"

112 
	#CACHE_EVENT_IOREQ
 0

	)

113 
	#CACHE_EVENT_READ
 1

	)

114 
	#CACHE_EVENT_POPULATE_ONLY
 2

	)

115 
	#CACHE_EVENT_POPULATE_ALSO
 3

	)

116 
	#CACHE_EVENT_WRITE
 4

	)

117 
	#CACHE_EVENT_FLUSH
 5

	)

118 
	#CACHE_EVENT_IDLEFLUSH_READ
 6

	)

119 
	#CACHE_EVENT_IDLEFLUSH_FLUSH
 7

	)

123 
	#CACHE_WRITE_MIN
 1

	)

124 
	#CACHE_WRITE_SYNCONLY
 1

	)

125 
	#CACHE_WRITE_THRU
 2

	)

126 
	#CACHE_WRITE_BACK
 3

	)

127 
	#CACHE_WRITE_MAX
 3

	)

131 
	#CACHE_FLUSH_MIN
 0

	)

132 
	#CACHE_FLUSH_DEMANDONLY
 0

	)

133 
	#CACHE_FLUSH_PERIODIC
 1

	)

134 
	#CACHE_FLUSH_MAX
 1

	)

138 
	sˇche_dev_evít
 {

139 
	mtime
;

140 
	mty≥
;

141 
ˇche_dev_evít
 *
	m√xt
;

142 
ˇche_dev_evít
 *
	m¥ev
;

143 (**
	md⁄efunc
)(*,
	mi‹eq_evít
 *);

144 *
	md⁄ï¨am
;

145 
	mÊags
;

146 
i‹eq_evít
 *
	mªq
;

147 
ˇche_dev_evít
 *
	mwaôìs
;

148 
	mvÆidpoöt
;

151 
	sˇche_dev_°©s
 {

152 
	mªads
;

153 
	mªadblocks
;

154 
	mªadhôsfuŒ
;

155 
	mªadmis£s
;

156 
	mp›wrôes
;

157 
	mp›wrôeblocks
;

158 
	mwrôes
;

159 
	mwrôeblocks
;

160 
	mwrôehôsfuŒ
;

161 
	mwrôemis£s
;

162 
	mde°agîóds
;

163 
	mde°agîódblocks
;

164 
	mde°agewrôes
;

165 
	mde°agewrôeblocks
;

166 
	mmaxbuf„r•a˚
;

170 
	sˇche_dev
 {

171 
ˇche_if
 
	mhdr
;

172 (**
	missuefunc
)(*,
	mi‹eq_evít
 *);

173 *
	missuï¨am
;

174 
	mioq
 * (**
	mqueueföd
)(*,);

175 *
	mqueueföd∑øm
;

177 (**
	mwakeupfunc
)(*, 
	mˇchìvít
 *);

178 *
	mwakeuµ¨am
;

179 
	msize
;

180 
	mˇche_devno
;

181 
	mªÆ_devno
;

182 
	mmaxªqsize
;

183 
	mwrôescheme
;

184 
	mÊush_pﬁicy
;

185 
	mÊush_≥riod
;

186 
	mÊush_idÀdñay
;

187 
	mbuf„r•a˚
;

188 
ˇche_dev_evít
 *
	m⁄goög_ªque°s
;

189 
bô°r_t
 *
	mvÆidm≠
;

190 
bô°r_t
 *
	mdútym≠
;

191 
ˇche_dev_°©s
 
	m°©
;

192 *
	m«me
;

195 
ˇchedev_£tˇŒbacks
();

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_cachemem.c

101 
	#CACHE_MEMORY
 1

	)

103 
	~"moduÀs/moduÀs.h
"

104 
	~"disksim_ˇchemem.h
"

109 
	#CACHE_VALID
 0x80000000

	)

110 
	#CACHE_DIRTY
 0x40000000

	)

111 
	#CACHE_LOCKDOWN
 0x20000000

	)

112 
	#CACHE_LOCKED
 0x10000000

	)

113 
	#CACHE_ATOMFLUSH
 0x08000000

	)

114 
	#CACHE_REALLOCATE_WRITE
 0x04000000

	)

115 
	#CACHE_SEGNUM
 0x000000FF

	)

119 
	#CACHE_FLAG_WASBLOCKED
 1

	)

120 
	#CACHE_FLAG_LINELOCKED_ALLOCATE
 2

	)

124 
	#CACHE_EVENT_IOREQ
 0

	)

125 
	#CACHE_EVENT_ALLOCATE
 1

	)

126 
	#CACHE_EVENT_READ
 2

	)

127 
	#CACHE_EVENT_WRITE
 3

	)

128 
	#CACHE_EVENT_SYNC
 4

	)

129 
	#CACHE_EVENT_SYNCPART
 5

	)

130 
	#CACHE_EVENT_READEXTRA
 6

	)

131 
	#CACHE_EVENT_WRITEFILLEXTRA
 7

	)

132 
	#CACHE_EVENT_IDLESYNC
 8

	)

140 
ˇche_ªad_c⁄töue
 (
ˇche_mem
 *
ˇche
, 
ˇche_mem_evít
 *
ªaddesc
);

141 
ˇche_wrôe_c⁄töue
 (
ˇche_mem
 *
ˇche
, 
ˇche_mem_evít
 *
wrôedesc
);

146 
	$ˇchemem_gë_maxªqsize
 (
ˇche_if
 *
c
)

148 
ˇche_mem
 *
ˇche
 = (ˇche_mem *)
c
;

149  
ˇche
->
maxªqsize
;

150 
	}
}

153 
	$ˇche_em±y_d⁄efunc
 (*
d⁄ï¨am
, 
i‹eq_evít
 *
ªq
)

155 
	`addt€xåaq
((
evít
 *Ë
ªq
);

156 
	}
}

159 
	$ˇche_c⁄ˇtok
 (*
c⁄ˇtok∑øm
, 
blkno1
, 
bcou¡1
, 
blkno2
, 
bcou¡2
)

161 
ˇche_mem
 *
ˇche
 = 
c⁄ˇtok∑øm
;

162 i‡((
ˇche
->
size
Ë&& (ˇche->
maxsˇtg©h
 != 0)) {

163 
löesize
 = 
	`max
(
ˇche
->linesize, 1);

164 
löío1
 = 
blkno1
 / 
löesize
;

165 
löío2
 = (
blkno2
 + 
bcou¡2
 - 1Ë/ 
löesize
;

166 
sˇtg©h˙t
 = 
löío2
 - 
löío1
;

167 i‡(
sˇtg©h˙t
 > 
ˇche
->
maxsˇtg©h
) {

172 
	}
}

175 
	$ˇche_waôf‹_IO
 (
ˇche_mem
 *
ˇche
, 
waô˙t
, 
ˇche_mem_evít
 *
ˇchîeq
, 
i‹eq_evít
 *
iﬂcc
)

177 
ˇchîeq
->
√xt
 = 
ˇche
->
IOwaôîs
;

178 
ˇchîeq
->
¥ev
 = 
NULL
;

179 i‡(
ˇchîeq
->
√xt
) {

180 
ˇchîeq
->
√xt
->
¥ev
 = cachereq;

182 
ˇche
->
IOwaôîs
 = 
ˇchîeq
;

186 
ˇchîeq
->
accblkno
 = 
iﬂcc
->
blkno
;

187 
	}
}

190 
	$ˇche_ö£π_√w_öto_hash
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
√w
)

192 
√w
->
hash_√xt
 = 
ˇche
->
hash
[“ew->
lbn
 & 
CACHE_HASHMASK
)];

193 
ˇche
->
hash
[(
√w
->
lbn
 & 
CACHE_HASHMASK
)] =Çew;

194 
√w
->
hash_¥ev
 = 
NULL
;

195 i‡(
√w
->
hash_√xt
) {

196 
√w
->
hash_√xt
->
hash_¥ev
 =Çew;

198 
	}
}

201 
	$ˇche_ªmove_íåy_‰om_hash
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
ﬁd
)

204 
	`ASSERT
((
ﬁd
->
hash_¥ev
 !
NULL
Ë|| (ﬁd->
hash_√xt
 !NULLË|| (
ˇche
->
hash
[(ﬁd->
lbn
 & 
CACHE_HASHMASK
)] == old));

206 i‡(
ﬁd
->
hash_¥ev
) {

207 
ﬁd
->
hash_¥ev
->
hash_√xt
 = old->hash_next;

209 
ˇche
->
hash
[(
ﬁd
->
lbn
 & 
CACHE_HASHMASK
)] = old->
hash_√xt
;

211 i‡(
ﬁd
->
hash_√xt
) {

212 
ﬁd
->
hash_√xt
->
hash_¥ev
 = old->hash_prev;

214 
ﬁd
->
hash_√xt
 = 
NULL
;

215 
ﬁd
->
hash_¥ev
 = 
NULL
;

216 
	}
}

219 
	$ˇche_cou¡_dúty_©oms
 (
ˇche_mem
 *
ˇche
)

221 
i
;

222 
dúty
 = 0;

224 
i
=0; i<
CACHE_HASHMASK
; i++) {

225 
ˇche_©om
 *
tmp
 = 
ˇche
->
hash
[
i
];

226 
tmp
) {

227 
dúty
 +(
tmp
->
°©e
 & 
CACHE_DIRTY
) ? 1 : 0;

228 
tmp
 =Åmp->
hash_√xt
;

231 (
dúty
);

232 
	}
}

235 
ˇche_©om
 * 
	$ˇche_föd_©om
 (
ˇche_mem
 *
ˇche
, 
devno
, 
lbn
)

237 
ˇche_©om
 *
tmp
 = 
ˇche
->
hash
[(
lbn
 & 
CACHE_HASHMASK
)];

241 (
tmp
Ë&& (—mp->
lbn
 !lbnË|| (tmp->
devno
 != devno))) {

242 
tmp
 =Åmp->
hash_√xt
;

244 (
tmp
);

245 
	}
}

249 
	$ˇche_ªmove_lbn_‰om_hash
 (
ˇche_mem
 *
ˇche
, 
devno
, 
lbn
)

251 
ˇche_©om
 *
tmp
;

253 i‡((
tmp
 = 
	`ˇche_föd_©om
(
ˇche
, 
devno
, 
lbn
))) {

254 
	`ˇche_ªmove_íåy_‰om_hash
(
ˇche
, 
tmp
);

256 
	}
}

261 
	$ˇche_check_f‹_ªsidí˚
 (
ˇche_mem
 *
ˇche
, 
devno
, 
lbn
, 
size
, *
miss
)

263 
ˇche_©om
 *
löe
 = 
NULL
;

264 
i
;

266 
i
=0; i<
size
; i++) {

267 i‡(
löe
 =
NULL
) {

268 
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
devno
, (
lbn
 + 
i
));

270 i‡((
löe
 =
NULL
Ë|| (÷öe->
°©e
 & 
CACHE_VALID
) == 0)) {

271 
miss
[(
i
 & 
INV_BITS_PER_INT_MASK
)] |1 << (ò& 
BITS_PER_INT_MASK
);

273 i‡(
löe
) {

274 
löe
 =Üöe->
löe_√xt
;

277 
	}
}

284 
	$ˇche_£t_°©e
 (
ˇche_mem
 *
ˇche
, 
devno
, 
lbn
, 
size
, 
mask
)

286 
ˇche_©om
 *
löe
 = 
NULL
;

287 
i
;

289 
i
=0; i<
size
; i++) {

290 i‡(
löe
 =
NULL
) {

291 
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
devno
, (
lbn
 + 
i
));

294 
	`ASSERT
(
löe
 !
NULL
);

296 
löe
->
°©e
 |
mask
;

297 
löe
 =Üöe->
löe_√xt
;

299 
	}
}

306 
	$ˇche_ª£t_°©e
 (
ˇche_mem
 *
ˇche
, 
devno
, 
lbn
, 
size
, 
mask
)

308 
ˇche_©om
 *
löe
 = 
NULL
;

309 
i
;

311 
i
=0; i<
size
; i++) {

312 i‡(
löe
 =
NULL
) {

313 
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
devno
, (
lbn
 + 
i
));

316 
	`ASSERT
(
löe
 !
NULL
);

318 
löe
->
°©e
 &~
mask
;

319 
löe
 =Üöe->
löe_√xt
;

321 
	}
}

325 
	$ˇche_add_to_Ãuli°
 (
ˇche_m≠íåy
 *
m≠
,

326 
ˇche_©om
 *
löe
,

327 
£gnum
)

329 
ˇche_©om
 **
hód
;

331 i‡(
£gnum
 =
CACHE_SEGNUM
) {

332 
hód
 = &
m≠
->
‰ìli°
;

334 
hód
 = &
m≠
->
Ãu
[
£gnum
];

335 
m≠
->
numa˘ive
[
£gnum
]++;

337 
löe
->
°©e
 |
£gnum
;

338 i‡(*
hód
) {

339 
löe
->
Ãu_√xt
 = *
hód
;

340 
löe
->
Ãu_¥ev
 = (*
hód
)->lru_prev;

341 (*
hód
)->
Ãu_¥ev
 = 
löe
;

342 
löe
->
Ãu_¥ev
->
Ãu_√xt
 =Üine;

344 
löe
->
Ãu_√xt
 =Üine;

345 
löe
->
Ãu_¥ev
 =Üine;

346 *
hód
 = 
löe
;

348 
	}
}

351 
	$ˇche_ªmove_‰om_Ãuli°
 (
ˇche_m≠íåy
 *
m≠
, 
ˇche_©om
 *
löe
, 
£gnum
)

353 
ˇche_©om
 **
hód
;

355 i‡(
£gnum
 =
CACHE_SEGNUM
) {

356 
hód
 = &
m≠
->
‰ìli°
;

358 
hód
 = &
m≠
->
Ãu
[
£gnum
];

359 
m≠
->
numa˘ive
[
£gnum
]--;

361 i‡(
löe
->
Ãu_√xt
 !=Üine) {

362 
löe
->
Ãu_¥ev
->
Ãu_√xt
 =Üine->lru_next;

363 
löe
->
Ãu_√xt
->
Ãu_¥ev
 =Üine->lru_prev;

364 i‡(*
hód
 =
löe
) {

365 *
hód
 = 
löe
->
Ãu_√xt
;

368 *
hód
 = 
NULL
;

370 
löe
->
°©e
 &~
CACHE_SEGNUM
;

371 
löe
->
Ãu_√xt
 = 
NULL
;

372 
löe
->
Ãu_¥ev
 = 
NULL
;

373 
	}
}

378 
	$ˇche_ac˚ss
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
löe
)

380 
£t
;

381 
£gnum
 = 0;

383 i‡(
ˇche
->
ª∂a˚pﬁicy
 !
CACHE_REPLACE_SLRU
) {

386 
löe
->
löe_¥ev
) {

387 
löe
 =Üöe->
löe_¥ev
;

389 
£t
 = (
ˇche
->
m≠mask
Ë? (
löe
->
lbn
 % cache->mapmask) : 0;

390 i‡(
löe
->
Ãu_√xt
) {

391 
£gnum
 = 
löe
->
°©e
 & 
CACHE_SEGNUM
;

392 
	`ˇche_ªmove_‰om_Ãuli°
(&
ˇche
->
m≠
[
£t
], 
löe
, 
£gnum
);

393 i‡(
£gnum
 !(
ˇche
->
num£gs
-1)) {

394 
£gnum
 = (£gnum + 1Ë& 
CACHE_SEGNUM
;

397 
	`ˇche_add_to_Ãuli°
(&
ˇche
->
m≠
[
£t
], 
löe
, 
£gnum
);

398 (
£gnum
) &&

399 (
ˇche
->
m≠
[
£t
].
numa˘ive
[
£gnum
] ==

400 
ˇche
->
m≠
[
£t
].
maxa˘ive
[
£gnum
]))

402 
löe
 = 
ˇche
->
m≠
[
£t
].
Ãu
[
£gnum
];

403 
	`ˇche_ªmove_‰om_Ãuli°
(&
ˇche
->
m≠
[
£t
], 
löe
, 
£gnum
);

404 
£gnum
--;

405 
	`ˇche_add_to_Ãuli°
(&
ˇche
->
m≠
[
£t
], 
löe
, 
£gnum
);

407 
	}
}

410 
	$ˇche_ª∂a˚_waôf‹löe
 (
ˇche_mem
 *
ˇche
, 
ˇche_mem_evít
 *
Ælocdesc
)

414 i‡(
ˇche
->
löewaôîs
) {

415 
Ælocdesc
->
√xt
 = 
ˇche
->
löewaôîs
->next;

416 
ˇche
->
löewaôîs
->
√xt
 = 
Ælocdesc
;

417 i‡(!(
Ælocdesc
->
Êags
 & 
CACHE_FLAG_LINELOCKED_ALLOCATE
)) {

418 
ˇche
->
löewaôîs
 = 
Ælocdesc
;

421 
Ælocdesc
->
√xt
 =állocdesc;

422 
ˇche
->
löewaôîs
 = 
Ælocdesc
;

424 
Ælocdesc
->
Êags
 |
CACHE_FLAG_LINELOCKED_ALLOCATE
;

425 
	}
}

428 
ˇche_©om
 *
	$ˇche_gë_ª∂a˚_°¨çoöt
 (
ˇche_mem
 *
ˇche
, 
£t
)

430 
ˇche_©om
 *
löe
 = 
ˇche
->
m≠
[
£t
].
Ãu
[0];

432 i‡(
löe
) {

433 i‡(
ˇche
->
ª∂a˚pﬁicy
 =
CACHE_REPLACE_RANDOM
) {

434 
choi˚
 = 
ˇche
->
m≠
[
£t
].
numa˘ive
[0] * 
	`DISKSIM_dønd48
();

435 
i
;

436 
i
=0; i<
choi˚
; i++) {

437 
löe
 =Üöe->
Ãu_¥ev
;

439 } i‡(
ˇche
->
ª∂a˚pﬁicy
 =
CACHE_REPLACE_LIFO
) {

440 
löe
 =Üöe->
Ãu_¥ev
;

441 } i‡((
ˇche
->
ª∂a˚pﬁicy
 !
CACHE_REPLACE_FIFO
Ë&& (ˇche->ª∂a˚pﬁicy !
CACHE_REPLACE_SLRU
)) {

442 
	`Ârötf
(
°dîr
, "Unknow¿ª∂a˚míàpﬁicyáàˇche_gë_ª∂a˚_°¨çoöt: %d\n", 
ˇche
->
ª∂a˚pﬁicy
);

443 
	`exô
(1);

446 (
löe
);

447 
	}
}

452 
	$ˇche_add_to_lock°ru˘
 (
ˇchñockw
 **
hód
, *
idítifõr
)

454 
ˇchñockw
 *
tmp
 = *
hód
;

455 
°¨t
 = 
FALSE
;

456 
i
;

458 i‡(
tmp
 =
NULL
) {

459 
tmp
 = (
ˇchñockw
 *Ë
	`gë‰omexåaq
();

460 
	`mem£t
((*)
tmp
, 0, (
ˇchñockw
));

462 
tmp
->
íåy
[0] = 
idítifõr
;

463 *
hód
 = 
tmp
;

465 
tmp
->
√xt
) {

466 
i
=0; i<
CACHE_LOCKSPERSTRUCT
; i++) {

467 i‡(
tmp
->
íåy
[
i
] =
idítifõr
) {

471 
tmp
 =Åmp->
√xt
;

473 
i
=0; i<
CACHE_LOCKSPERSTRUCT
; i++) {

474 i‡(
tmp
->
íåy
[
i
] =
idítifõr
) {

476 } i‡(
tmp
->
íåy
[
i
]) {

477 
°¨t
 = 
TRUE
;

478 } i‡(
°¨t
) {

479 
tmp
->
íåy
[
i
] = 
idítifõr
;

483 
tmp
->
√xt
 = (
ˇchñockw
 *Ë
	`gë‰omexåaq
();

484 
tmp
 =Åmp->
√xt
;

485 
	`mem£t
 ((*)
tmp
, 0, (
ˇchñockw
));

487 
tmp
->
íåy
[0] = 
idítifõr
;

489 
	}
}

494 
	$ˇche_©om_iswrôñocked
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
èrgë
)

496 
èrgë
->
lbn
 % 
ˇche
->
lockgøn
) {

497 
èrgë
 =Å¨gë->
löe_¥ev
;

499 (
èrgë
->
wrôñock
 !
NULL
);

500 
	}
}

505 
	$ˇche_©om_i¶ocked
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
èrgë
)

507 
èrgë
->
lbn
 % 
ˇche
->
lockgøn
) {

508 
èrgë
 =Å¨gë->
löe_¥ev
;

510 (
èrgë
->
ªadlocks
 ||Å¨gë->
wrôñock
);

511 
	}
}

518 
	$ˇche_give_lock_to_waôî
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
èrgë
, 
ˇche_mem_evít
 *
rwdesc
)

520 
rwdesc
->
ty≥
) {

522 
CACHE_EVENT_READ
:

523 
	`ˇche_ªad_c⁄töue
(
ˇche
, 
rwdesc
);

526 
CACHE_EVENT_WRITE
:

527 
	`ˇche_wrôe_c⁄töue
(
ˇche
, 
rwdesc
);

531 
	`Ârötf
(
°dîr
, "Unknow¿ty≥áàˇche_give_lock_to_waôî: %d\n", 
rwdesc
->
ty≥
);

532 
	`exô
(1);

534 
	}
}

538 
	$ˇche_lock_‰ì
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
èrgë
)

540 
ˇche_lockwaôîs
 *
tmp
;

541 
wrôñocked
 = 
FALSE
;

544 
	`ASSERT
(!
èrgë
->
wrôñock
);

546 i‡((
tmp
 = 
èrgë
->
lockwaôîs
)) {

547 
i
 = 0;

548 (
tmp
Ë&& (!
wrôñocked
Ë&& (!
èrgë
->
wrôñock
)) {

549 
ˇche_mem_evít
 *
waôî
 = 
NULL
;

550 i‡(
tmp
->
íåy
[
i
]) {

551 
wrôñocked
 = (
ˇche
->
sh¨edªadlocks
 =0Ë|| 
tmp
->
íåy
[
i
]->
lockty≥
;

552 i‡((!
wrôñocked
Ë|| (
èrgë
->
ªadlocks
 =
NULL
)) {

553 
waôî
 = 
tmp
->
íåy
[
i
];

554 
tmp
->
íåy
[
i
] = 
NULL
;

557 
i
++;

558 i‡(
i
 =
CACHE_LOCKSPERSTRUCT
) {

559 
èrgë
->
lockwaôîs
 = 
tmp
->
√xt
;

560 
	`addt€xåaq
((
evít
 *Ë
tmp
);

561 
tmp
 = 
èrgë
->
lockwaôîs
;

562 
i
 = 0;

564 i‡(
waôî
) {

565 (*
ˇche
->
wakeupfunc
)(ˇche->
wakeuµ¨am
, (
ˇchìvít
 *)
waôî
);

568 } i‡(
ˇche
->
löewaôîs
) {

569 
löesize
 = 
	`max
(
ˇche
->linesize, 1);

570 
ˇche_mem_evít
 *
Ælocdesc
;

571 
èrgë
->
lbn
 % 
löesize
) {

572 
èrgë
 =Å¨gë->
löe_¥ev
;

574 
èrgë
) {

575 i‡((
èrgë
->
wrôñock
Ë|| (èrgë->
ªadlocks
)) {

578 
èrgë
 =Å¨gë->
löe_√xt
;

580 
Ælocdesc
 = 
ˇche
->
löewaôîs
->
√xt
;

581 i‡(
Ælocdesc
->
√xt
 ==állocdesc) {

582 
ˇche
->
löewaôîs
 = 
NULL
;

584 
ˇche
->
löewaôîs
->
√xt
 = 
Ælocdesc
->next;

586 
Ælocdesc
->
√xt
 = 
NULL
;

588 (*
ˇche
->
wakeupfunc
)(ˇche->
wakeuµ¨am
, (
ˇchìvít
 *)
Ælocdesc
);

590 
	}
}

595 
	$ˇche_gë_wrôe_lock
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
èrgë
, 
ˇche_mem_evít
 *
rwdesc
)

599 
èrgë
->
lbn
 % 
ˇche
->
lockgøn
) {

600 
èrgë
 =Å¨gë->
löe_¥ev
;

605 i‡(
èrgë
->
wrôñock
 =
rwdesc
->
ªq
) {

606 (
ˇche
->
lockgøn
);

607 } i‡((
èrgë
->
wrôñock
Ë|| (èrgë->
ªadlocks
)) {

608 
rwdesc
->
lockty≥
 = 1;

609 
	`ˇche_add_to_lock°ru˘
(&
èrgë
->
lockwaôîs
, 
rwdesc
);

612 
èrgë
->
wrôñock
 = 
rwdesc
->
ªq
;

613 (
ˇche
->
lockgøn
);

615 
	}
}

618 
	$ˇche_‰ì_wrôe_lock
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
èrgë
, 
i‹eq_evít
 *
ow√r
)

623 
èrgë
->
lbn
 % 
ˇche
->
lockgøn
) {

624 
èrgë
 =Å¨gë->
löe_¥ev
;

629 i‡(
ow√r
 =
èrgë
->
wrôñock
) {

630 
èrgë
->
wrôñock
 = 
NULL
;

631 
	`ˇche_lock_‰ì
(
ˇche
, 
èrgë
);

632 (
ˇche
->
lockgøn
);

636 
	}
}

639 
	$ˇche_gë_ªad_lock
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
èrgë
, 
ˇche_mem_evít
 *
rwdesc
)

643 i‡(!
ˇche
->
sh¨edªadlocks
) {

644 (
	`ˇche_gë_wrôe_lock
(
ˇche
, 
èrgë
, 
rwdesc
));

646 
èrgë
->
lbn
 % 
ˇche
->
lockgøn
) {

647 
èrgë
 =Å¨gë->
löe_¥ev
;

652 i‡((
èrgë
->
wrôñock
Ë&& (èrgë->wrôñock !
rwdesc
->
ªq
)) {

653 
rwdesc
->
lockty≥
 = 0;

654 
	`ˇche_add_to_lock°ru˘
(&
èrgë
->
lockwaôîs
, 
rwdesc
);

657 
	`ˇche_add_to_lock°ru˘
((
ˇchñockw
 **)&
èrgë
->
ªadlocks
, 
rwdesc
->
ªq
);

658 i‡(
èrgë
->
wrôñock
) {

659 
èrgë
->
wrôñock
 = 
NULL
;

660 
	`ˇche_lock_‰ì
(
ˇche
, 
èrgë
);

662 (
ˇche
->
lockgøn
);

664 
	}
}

667 
	$ˇche_‰ì_ªad_lock
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
èrgë
, 
i‹eq_evít
 *
ow√r
)

669 
ˇche_lockhﬁdîs
 *
tmp
;

670 
found
 = 
FALSE
;

671 
i
;

675 i‡(!
ˇche
->
sh¨edªadlocks
) {

676 (
	`ˇche_‰ì_wrôe_lock
(
ˇche
, 
èrgë
, 
ow√r
));

681 
èrgë
->
lbn
 % 
ˇche
->
lockgøn
) {

682 
èrgë
 =Å¨gë->
löe_¥ev
;

684 
tmp
 = 
èrgë
->
ªadlocks
;

685 (
tmp
Ë&& (!
found
)) {

686 
a˘ive
 = 
FALSE
;

687 
i
=0; i<
CACHE_LOCKSPERSTRUCT
; i++) {

688 i‡(
tmp
->
íåy
[
i
] =
ow√r
) {

689 
tmp
->
íåy
[
i
] = 0;

690 
found
 = 
TRUE
;

691 } i‡(
tmp
->
íåy
[
i
]) {

692 
a˘ive
 = 
TRUE
;

695 i‡((
tmp
 =
èrgë
->
ªadlocks
Ë&& (
a˘ive
 =
FALSE
)) {

696 
èrgë
->
ªadlocks
 = 
tmp
->
√xt
;

697 
	`addt€xåaq
((
evít
 *Ë
tmp
);

698 
tmp
 = 
èrgë
->
ªadlocks
;

700 
tmp
 =Åmp->
√xt
;

703 i‡(
found
) {

704 i‡(!
èrgë
->
ªadlocks
) {

705 
	`ˇche_lock_‰ì
(
ˇche
, 
èrgë
);

707 (
ˇche
->
lockgøn
);

711 
	}
}

714 
	$ˇche_gë_ªad_lock_ønge
 (
ˇche_mem
 *
ˇche
, 
°¨t
, 
íd
, 
ˇche_©om
 *
°¨ètom
, 
ˇche_mem_evít
 *
waôî
)

716 
ˇche_©om
 *
löe
 = (
°¨ètom
->
lbn
 =
°¨t
Ë? sèπ©om : 
NULL
;

717 
lockgøn
 = 1;

718 
i
;

720 
i
=
°¨t
; i<=
íd
; i++) {

721 i‡(
löe
 =
NULL
) {

722 
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
°¨ètom
->
devno
, 
i
);

723 
	`ASSERT
(
löe
 !
NULL
);

725 i‡((
löe
->
lbn
 % 
lockgøn
) == 0) {

726 
lockgøn
 = 
	`ˇche_gë_ªad_lock
(
ˇche
, 
löe
, 
waôî
);

728 
	`ASSERT
(
lockgøn
 != 0);

730 
löe
 =Üöe->
löe_√xt
;

732 
	}
}

735 
	$ˇche_issue_Êushªq
 (
ˇche_mem
 *
ˇche
, 
°¨t
, 
íd
, 
ˇche_©om
 *
°¨ètom
, 
ˇche_mem_evít
 *
waôî
)

737 
i‹eq_evít
 *
Êushªq
;

738 
i‹eq_evít
 *
Êushwaô
;

739 
waôög
 = (
ˇche
->
IOwaôîs
 =
waôî
) ? 1 : 0;

743 
Êushªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

744 
Êushªq
->
devno
 = 
°¨ètom
->devno;

745 
Êushªq
->
blkno
 = 
°¨t
;

746 
Êushªq
->
bcou¡
 = 
íd
 - 
°¨t
 + 1;

747 
Êushªq
->
bu¢o
 = 
°¨ètom
->busno;

748 
Êushªq
->
¶Ÿno
 = 
°¨ètom
->slotno;

749 
Êushªq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

750 
Êushªq
->
Êags
 = 0;

752 
Êushwaô
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

753 
Êushwaô
->
ty≥
 = 
IO_REQUEST_ARRIVE
;

754 
Êushwaô
->
devno
 = 
Êushªq
->devno;

755 
Êushwaô
->
blkno
 = 
Êushªq
->blkno;

756 
Êushwaô
->
bcou¡
 = 
Êushªq
->bcount;

757 
Êushwaô
->
√xt
 = 
waôî
->
ªq
;

758 
Êushwaô
->
¥ev
 = 
NULL
;

759 i‡(
waôî
->
ªq
) {

760 
waôî
->
ªq
->
¥ev
 = 
Êushwaô
;

762 
waôî
->
ªq
 = 
Êushwaô
;

763 
waôî
->
accblkno
 = -1;

764 i‡(!
waôög
) {

765 
	`ˇche_waôf‹_IO
(
ˇche
, 1, 
waôî
, 
Êushwaô
);

767 
waôî
->
accblkno
 = -1;

768 
ˇche
->
°©
.
de°agewrôes
++;

769 
ˇche
->
°©
.
de°agewrôótoms
 +
íd
 - 
°¨t
 + 1;

771 
	`ˇche_gë_ªad_lock_ønge
(
ˇche
, 
°¨t
, 
íd
, 
°¨ètom
, 
waôî
);

775 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
Êushªq
);

777 
	}
}

780 
	$ˇche_Êush_˛u°î
 (
ˇche_mem
 *
ˇche
, 
devno
, 
blkno
, 
löe˙t
, 
dú
)

782 
ˇche_©om
 *
löe
 = 
NULL
;

783 
œ°˛ón
 = 0;

784 
wrôñocked
;

786 
	`ASSERT1
((
dú
 == 1) || (dir == -1), "dir", dir);

787 
löe˙t
 <
ˇche
->
Êush_maxlöe˛u°î
) {

788 i‡(
löe
 =
NULL
) {

789 
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
devno
, (
blkno
+
dú
));

790 i‡((
löe
 =
NULL
Ë|| (
œ°˛ón
)) {

793 
löe˙t
++;

796 
wrôñocked
 = 
	`ˇche_©om_iswrôñocked
(
ˇche
, 
löe
);

797 i‡((
löe
->
°©e
 & 
CACHE_DIRTY
Ë&& (!
wrôñocked
)) {

798 
löe
->
°©e
 &~
CACHE_DIRTY
;

799 
œ°˛ón
 = 0;

800 
blkno
 = 
löe
->
lbn
;

801 } i‡((
wrôñocked
Ë|| (!(
löe
->
°©e
 & 
CACHE_VALID
))) {

804 
œ°˛ón
 = 1;

806 
löe
 = (
dú
 =1Ë?Üöe->
löe_√xt
 :Üöe->
löe_¥ev
;

808 (
blkno
);

809 
	}
}

812 
	$ˇche_öôüã_dúty_block_Êush
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
dútylöe
, 
ˇche_mem_evít
 *
Ælocdesc
)

814 
ˇche_©om
 *
dúty©om
 = 0;

815 
dútyíd
 = 0;

816 
dúty°¨t
 = -1;

817 
ˇche_©om
 *
tmp
 = 
dútylöe
;

818 
Êush˙t
 = 0;

822 
tmp
) {

823 
wrôñocked
 = 
	`ˇche_©om_iswrôñocked
(
ˇche
, 
tmp
);

824 i‡((
tmp
->
°©e
 & 
CACHE_DIRTY
Ë&& (!
wrôñocked
)) {

825 
tmp
->
°©e
 &~
CACHE_DIRTY
;

826 i‡(
dúty°¨t
 == -1) {

827 
dúty©om
 = 
tmp
;

828 
dúty°¨t
 = 
tmp
->
lbn
;

830 
dútyíd
 = 
tmp
->
lbn
;

831 } i‡((
dúty°¨t
 !-1Ë&& ((!(
tmp
->
°©e
 & 
CACHE_VALID
)Ë|| (
wrôñocked
))) {

832 i‡((
ˇche
->
Êush_maxlöe˛u°î
 > 1Ë&& (
dúty°¨t
 =
dútylöe
->
lbn
)) {

833 
dúty°¨t
 = 
	`ˇche_Êush_˛u°î
(
ˇche
, 
dúty©om
->
devno
, dirtystart, 1, -1);

835 i‡(
	`ˇche_issue_Êushªq
(
ˇche
, 
dúty°¨t
, 
dútyíd
, 
dúty©om
, 
Ælocdesc
) == 0) {

836 (
Êush˙t
);

838 
dúty°¨t
 = -1;

839 
Êush˙t
++;

841 
tmp
 =Åmp->
löe_√xt
;

843 i‡(
dúty°¨t
 != -1) {

844 
löesize
 = 
	`max
(
ˇche
->linesize, 1);

845 
löe˙t
;

846 i‡((
ˇche
->
Êush_maxlöe˛u°î
 > 1Ë&& (
dúty°¨t
 =
dútylöe
->
lbn
)) {

847 
dúty°¨t
 = 
	`ˇche_Êush_˛u°î
(
ˇche
, 
dúty©om
->
devno
, dirtystart, 1, -1);

849 
löe˙t
 = 1 + ((
dútylöe
->
lbn
 - 
dúty°¨t
Ë/ 
löesize
);

850 i‡((
löe˙t
 < 
ˇche
->
Êush_maxlöe˛u°î
Ë&& (
dútyíd
 =(
dútylöe
->
lbn
 + 
löesize
 -1))) {

851 
dútyíd
 = 
	`ˇche_Êush_˛u°î
(
ˇche
, 
dúty©om
->
devno
, dútyíd, 
löe˙t
, 1);

853 
Êush˙t
 +
	`ˇche_issue_Êushªq
(
ˇche
, 
dúty°¨t
, 
dútyíd
, 
dúty©om
, 
Ælocdesc
);

858 (
Êush˙t
);

859 
	}
}

862 
ˇche_mem_evít
 *
	$ˇche_gë_Êushdesc
()

864 
ˇche_mem_evít
 *
Êushdesc
 = (ˇche_mem_evíà*Ë
	`gë‰omexåaq
();

865 
Êushdesc
->
ty≥
 = 
CACHE_EVENT_SYNC
;

866 
Êushdesc
->
d⁄efunc
 = &
disksim
->
d⁄efunc_ˇchemem_em±y
;

867 
Êushdesc
->
ªq
 = 
NULL
;

868 (
Êushdesc
);

869 
	}
}

872 
	$ˇche_˛ónup_Êushdesc
 (
ˇche_mem_evít
 *
Êushdesc
)

874 i‡(
Êushdesc
->
ªq
) {

875 i‡(
Êushdesc
->
ªq
->
√xt
 =
NULL
) {

876 
Êushdesc
->
accblkno
 = flushdesc->
ªq
->
blkno
;

879 
	`addt€xåaq
((
evít
 *Ë
Êushdesc
);

881 
	}
}

888 
	$ˇche_≥riodic_Êush
 (
timî_evít
 *
timîeq
)

890 
ˇche_mem
 *
ˇche
 = (ˇche_mem *Ë
timîeq
->
±r
;

891 
£g˙t
 = (
ˇche
->
ª∂a˚pﬁicy
 =
CACHE_REPLACE_SLRU
Ë? cache->
num£gs
 : 1;

892 
i
, 
j
;

893 
ˇche_©om
 *
löe
;

894 
ˇche_©om
 *
°›
;

895 
ˇche_©om
 *
tmp
;

896 
ˇche_mem_evít
 *
Êushdesc
 = 
	`ˇche_gë_Êushdesc
();

897 
Êush˙t
 = 0;

898 
°¨tô
;

900 
i
=0; i<=
ˇche
->
m≠mask
; i++) {

901 
j
=0; j<
£g˙t
; j++) {

902 
löe
 = 
ˇche
->
m≠
[
i
].
Ãu
[
j
];

903 
°›
 = 
löe
;

904 
°¨tô
 = 1;

905 (
°¨tô
Ë|| (
löe
 !
°›
)) {

906 
°¨tô
 = 0;

907 
tmp
 = 
löe
;

908 
tmp
) {

909 i‡(
tmp
->
°©e
 & 
CACHE_DIRTY
) {

910 
Êush˙t
 +
	`ˇche_öôüã_dúty_block_Êush
(
ˇche
, 
tmp
, 
Êushdesc
);

912 
tmp
 =Åmp->
löe_√xt
;

914 
löe
 =Üöe->
Ãu_√xt
;

918 
	`ˇche_˛ónup_Êushdesc
(
Êushdesc
);

919 
timîeq
->
time
 +
ˇche
->
Êush_≥riod
;

920 
	`addtoötq
((
evít
 *)
timîeq
);

923 
	}
}

926 
	$ˇche_idÀtime_dëe˘ed
 (*
idÀw‹k∑øm
, 
idÀdevno
)

928 
ˇche_mem
 *
ˇche
 = 
idÀw‹k∑øm
;

929 
ˇche_©om
 *
löe
 = 
	`ˇche_gë_ª∂a˚_°¨çoöt
(
ˇche
, 0);

930 
ˇche_©om
 *
°›
 = 
löe
;

931 
ˇche_©om
 *
tmp
;

932 
£g˙t
 = (
ˇche
->
ª∂a˚pﬁicy
 =
CACHE_REPLACE_SLRU
Ë? cache->
num£gs
 : 1;

933 
i
;

934 
ˇche_mem_evít
 *
Êushdesc
;

935 
°¨tô
;

937 i‡(
	`ioqueue_gë_numbî_ö_queue
((*
ˇche
->
queueföd
)(ˇche->
queueföd∑øm
, 
idÀdevno
))) {

941 
Êushdesc
 = 
	`ˇche_gë_Êushdesc
();

942 
Êushdesc
->
ty≥
 = 
CACHE_EVENT_IDLESYNC
;

944 
i
=0; i<
£g˙t
; i++) {

945 i‡(
i
) {

946 
löe
 = 
ˇche
->
m≠
[0].
Ãu
[
i
];

947 
°›
 = 
löe
;

949 
°¨tô
 = 1;

950 (
°¨tô
Ë|| (
löe
 !
°›
)) {

951 
°¨tô
 = 0;

952 i‡(
löe
->
devno
 =
idÀdevno
) {

953 
tmp
 = 
löe
;

954 
tmp
) {

955 i‡(
tmp
->
°©e
 & 
CACHE_DIRTY
) {

956 ()
	`ˇche_öôüã_dúty_block_Êush
(
ˇche
, 
tmp
, 
Êushdesc
);

957 i‡(
Êushdesc
->
ªq
) {

958 
ˇche_idÀtime_dëe˘ed_idÀu£d
;

961 
tmp
 =Åmp->
löe_√xt
;

964 
löe
 =Üöe->
Ãu_√xt
;

968 
ˇche_idÀtime_dëe˘ed_idÀu£d
:

970 
	`ˇche_˛ónup_Êushdesc
(
Êushdesc
);

971 
	}
}

974 
	$ˇche_unm≠_löe
 (
ˇche_mem
 *
ˇche
, 
ˇche_©om
 *
löe
, 
£t
)

976 
ˇche_©om
 *
tmp
;

978 i‡(
löe
->
Ãu_√xt
) {

979 
	`ˇche_ªmove_‰om_Ãuli°
(&
ˇche
->
m≠
[
£t
], 
löe
, (löe->
°©e
 & 
CACHE_SEGNUM
));

981 i‡(
ˇche
->
löesize
 == 0) {

982 (
tmp
 = 
löe
)) {

983 
löe
 =Üöe->
löe_√xt
;

984 
tmp
->
löe_√xt
 = 
NULL
;

985 
tmp
->
löe_¥ev
 = 
NULL
;

986 
	`ˇche_ªmove_íåy_‰om_hash
(
ˇche
, 
tmp
);

987 
	`ˇche_add_to_Ãuli°
(&
ˇche
->
m≠
[
£t
], 
tmp
, 
CACHE_SEGNUM
);

990 
	`ˇche_add_to_Ãuli°
(&
ˇche
->
m≠
[
£t
], 
löe
, 
CACHE_SEGNUM
);

991 
löe
) {

992 
	`ˇche_ªmove_íåy_‰om_hash
(
ˇche
, 
löe
);

993 
löe
 =Üöe->
löe_√xt
;

996 
	}
}

999 
	$ˇche_ª∂a˚
 (
ˇche_mem
 *
ˇche
, 
£t
, 
ˇche_mem_evít
 *
Ælocdesc
)

1001 
numwrôes
;

1002 
ˇche_©om
 *
löe
;

1003 
ˇche_©om
 *
tmp
;

1004 
ˇche_©om
 *
°›
;

1005 
dúty
 = 
FALSE
;

1006 
locked
 = 
FALSE
;

1007 
ˇche_mem_evít
 *
Êushdesc
 = (
ˇche
->
Æloˇãpﬁicy
 & 
CACHE_ALLOCATE_NONDIRTY
Ë? 
NULL
 : 
Ælocdesc
;

1009 i‡(
ˇche
->
m≠
[
£t
].
‰ìli°
) {

1012 i‡((
löe
 = 
	`ˇche_gë_ª∂a˚_°¨çoöt
(
ˇche
, 
£t
)Ë=
NULL
) {

1014 
	`ˇche_ª∂a˚_waôf‹löe
(
ˇche
, 
Ælocdesc
);

1017 
°›
 = 
löe
;

1019 
ˇche_ª∂a˚_lo›_c⁄töue
:

1021 i‡(
locked
 | 
dúty
) {

1022 
löe
 = (
ˇche
->
ª∂a˚pﬁicy
 =
CACHE_REPLACE_LIFO
Ë?Üöe->
Ãu_¥ev
 :Üöe->
Ãu_√xt
;

1024 i‡(
löe
 =
°›
) {

1025 i‡(
locked
) {

1026 i‡((
Êushdesc
Ë&& (
ˇche
->
Æloˇãpﬁicy
 & 
CACHE_ALLOCATE_NONDIRTY
)) {

1027 
	`ˇche_˛ónup_Êushdesc
(
Êushdesc
);

1029 
	`ˇche_ª∂a˚_waôf‹löe
(
ˇche
, 
Ælocdesc
);

1034 
locked
 = 
FALSE
;

1035 
tmp
 = 
löe
;

1036 
tmp
) {

1037 i‡((
locked
 = (
tmp
->
ªadlocks
 ||Åmp->
wrôñock
))) {

1038 
ˇche_ª∂a˚_lo›_c⁄töue
;

1040 
tmp
 =Åmp->
löe_√xt
;

1043 
dúty
 = 
FALSE
;

1044 
tmp
 = 
löe
;

1045 
tmp
) {

1046 i‡((
dúty
 = 
tmp
->
°©e
 & 
CACHE_DIRTY
)) {

1047 i‡(
Êushdesc
 =
NULL
) {

1048 
Êushdesc
 = 
	`ˇche_gë_Êushdesc
();

1050 
numwrôes
 = 
	`ˇche_öôüã_dúty_block_Êush
(
ˇche
, 
tmp
, 
Êushdesc
);

1051 i‡(
ˇche
->
Æloˇãpﬁicy
 & 
CACHE_ALLOCATE_NONDIRTY
) {

1052 
ˇche_ª∂a˚_lo›_c⁄töue
;

1054 (
numwrôes
);

1057 
tmp
 =Åmp->
löe_√xt
;

1060 
	`ˇche_unm≠_löe
(
ˇche
, 
löe
, 
£t
);

1063 
	}
}

1070 
	$ˇche_gë_‰ì_©om
 (
ˇche_mem
 *
ˇche
, 
lbn
, 
ˇche_©om
 **
ªt
, 
ˇche_mem_evít
 *
Ælocdesc
)

1072 
wrôeouts
 = 0;

1073 
£t
 = (
ˇche
->
m≠mask
Ë? (
lbn
 % cache->mapmask) : 0;

1077 i‡(
ˇche
->
m≠
[
£t
].
‰ìli°
 =
NULL
) {

1078 
wrôeouts
 = 
	`ˇche_ª∂a˚
(
ˇche
, 
£t
, 
Ælocdesc
);

1080 i‡((*
ªt
 = 
ˇche
->
m≠
[
£t
].
‰ìli°
)) {

1081 
	`ˇche_ªmove_‰om_Ãuli°
(&
ˇche
->
m≠
[
£t
], *
ªt
, 
CACHE_SEGNUM
);

1083 (
wrôeouts
);

1084 
	}
}

1090 
ˇche_mem_evít
 *
	$ˇche_Æloˇã_•a˚_c⁄töue
 (
ˇche_mem
 *
ˇche
, 
ˇche_mem_evít
 *
Ælocdesc
)

1092 
numwrôes
 = 0;

1093 
ˇche_©om
 *
√w
;

1100 
devno
 = 
Ælocdesc
->
ªq
->devno;

1101 
lbn
 = 
Ælocdesc
->
lock°›
;

1102 
°›
 = 
Ælocdesc
->
Æloc°›
;

1103 
ˇche_©om
 *
˛ó√d
 = 
Ælocdesc
->cleaned;

1104 
ˇche_©om
 *
löïªv
 = 
Ælocdesc
->lineprev;

1105 
löesize
 = (
ˇche
->linesize) ? cache->linesize : 1;

1109 i‡(
Ælocdesc
->
waôìs
) {

1110 
ˇche_mem_evít
 *
rwdesc
 = 
Ælocdesc
->
waôìs
;

1111 i‡(
rwdesc
->
ty≥
 =
CACHE_EVENT_READ
) {

1112 
	`ˇche_ªad_c⁄töue
(
ˇche
, 
rwdesc
);

1114 
	`ˇche_wrôe_c⁄töue
(
ˇche
, 
rwdesc
);

1116 
	`addt€xåaq
((
evít
 *Ë
Ælocdesc
);

1117 (
NULL
);

1119 
lbn
 < 
°›
) {

1120 i‡((
√w
 = 
˛ó√d
Ë=
NULL
) {

1121 
numwrôes
 +
	`ˇche_gë_‰ì_©om
(
ˇche
, 
lbn
, &
√w
, 
Ælocdesc
);

1123 i‡(
numwrôes
 == 0) {

1124 
	`ASSERT
(
√w
 !
NULL
);

1126 
√w
->
devno
 = devno;

1127 
√w
->
lbn
 =Übn;

1129 
	`ASSERT
((!
√w
->
wrôñock
Ë&& (!√w->
ªadlocks
));

1133 
√w
->
°©e
 = 
CACHE_LOCKDOWN
;

1134 
	`ˇche_ö£π_√w_öto_hash
(
ˇche
, 
√w
);

1135 
lbn
++;

1136 
√w
 = (
lbn
 % 
löesize
Ë?Çew->
löe_√xt
 :Çew;

1137 } 
lbn
 % 
löesize
);

1138 i‡(
ˇche
->
löesize
 == 0) {

1139 
√w
->
löe_√xt
 = 
NULL
;

1140 
√w
->
löe_¥ev
 = 
löïªv
;

1141 i‡(
löïªv
) {

1142 
löïªv
->
löe_√xt
 = 
√w
;

1144 
löïªv
 = ((
ˇche
->
löesize
 =-1Ë|| (
lbn
 %Üöesize)Ë? 
√w
 : 
NULL
;

1165 
Ælocdesc
->
lock°›
 = 
lbn
;

1166 
Ælocdesc
->
˛ó√d
 = 
√w
;

1167 
Ælocdesc
->
löïªv
 =Üineprev;

1172 (
Ælocdesc
);

1184 
	`addt€xåaq
((
evít
 *Ë
Ælocdesc
);

1185 (
NULL
);

1186 
	}
}

1189 
ˇche_mem_evít
 * 
	$ˇche_Æloˇã_•a˚
 (
ˇche_mem
 *
ˇche
, 
lbn
, 
size
, 
ˇche_mem_evít
 *
rwdesc
)

1191 
ˇche_mem_evít
 *
Ælocdesc
 = (ˇche_mem_evíà*Ë
	`gë‰omexåaq
();

1192 
löesize
 = 
	`max
(1, 
ˇche
->linesize);

1196 
Ælocdesc
->
ty≥
 = 
CACHE_EVENT_ALLOCATE
;

1197 
Ælocdesc
->
ªq
 = 
rwdesc
->req;

1198 
Ælocdesc
->
Êags
 = 
rwdesc
->Êag†& 
CACHE_FLAG_LINELOCKED_ALLOCATE
;

1199 
Ælocdesc
->
lock°›
 = 
lbn
 - (lb¿% 
löesize
);

1200 
Ælocdesc
->
Æloc°›
 = 
lbn
 + 
size
 + (
löesize
 - 1 - ((lbn + size - 1) %Üinesize));

1201 
Ælocdesc
->
˛ó√d
 = 
NULL
;

1202 
Ælocdesc
->
löïªv
 = 
NULL
;

1203 
Ælocdesc
->
¥ev
 = 
rwdesc
;

1204 
Ælocdesc
->
waôìs
 = 
NULL
;

1205 i‡((
Ælocdesc
 = 
	`ˇche_Æloˇã_•a˚_c⁄töue
(
ˇche
,állocdesc))) {

1206 
Ælocdesc
->
waôìs
 = 
rwdesc
;

1207 
rwdesc
->
Êags
 |
Ælocdesc
->Êag†& 
CACHE_FLAG_LINELOCKED_ALLOCATE
;

1209 (
Ælocdesc
);

1210 
	}
}

1213 
	$ˇche_gë_rw_lock
 (
ˇche_mem
 *
ˇche
, 
lockty≥
, 
ˇche_mem_evít
 *
rwdesc
, 
ˇche_©om
 *
löe
, 
i
, 
°›
)

1215 
lockgøn
;

1216 
ˇche_©om
 *
tmp
 = 
löe
;

1217 
j
 = 0;

1219 
lbn
 = 
rwdesc
->
ªq
->
blkno
;

1220 
devno
 = 
rwdesc
->
ªq
->devno;

1224 
j
 < 
°›
) {

1225 i‡(
lockty≥
 == 1) {

1226 
lockgøn
 = 
	`ˇche_gë_ªad_lock
(
ˇche
, 
tmp
, 
rwdesc
);

1228 i‡(
lockty≥
 == 3) {

1229 
	`ˇche_‰ì_ªad_lock
(
ˇche
, 
tmp
, 
rwdesc
->
ªq
);

1231 
lockgøn
 = 
	`ˇche_gë_wrôe_lock
(
ˇche
, 
tmp
, 
rwdesc
);

1236 i‡(
lockgøn
 == 0) {

1239 i‡((
löe
->
lbn
 !÷b¿+ 
i
)Ë|| (löe->
devno
 != devno)) {

1244 i‡(
lockty≥
 == 1) {

1245 
	`ˇche_‰ì_ªad_lock
(
ˇche
, 
tmp
, 
rwdesc
->
ªq
);

1247 
	`ˇche_‰ì_wrôe_lock
(
ˇche
, 
tmp
, 
rwdesc
->
ªq
);

1251 
j
++;

1252 
tmp
 =Åmp->
löe_√xt
;

1253 (
tmp
Ë&& (tmp->
lbn
 % 
lockgøn
)) {

1254 
j
++;

1255 
tmp
 =Åmp->
löe_√xt
;

1260 
	}
}

1263 
	$ˇche_issue_fûÃeq
 (
ˇche_mem
 *
ˇche
, 
°¨t
, 
íd
, 
ˇche_mem_evít
 *
rwdesc
, 
¥e„tchty≥
)

1265 
i‹eq_evít
 *
fûÃeq
;

1266 
löesize
 = 
	`max
(
ˇche
->linesize, 1);

1270 i‡(
¥e„tchty≥
 & 
CACHE_PREFETCH_FRONTOFLINE
) {

1271 
ˇche_©om
 *
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
rwdesc
->
ªq
->
devno
, 
°¨t
);

1272 
vÆid°¨t
 = -1;

1273 
lockgøn
 = 
ˇche
->lockgran;

1274 
°¨t
 % 
löesize
) {

1275 
löe
 =Üöe->
löe_¥ev
;

1276 i‡(
löe
->
°©e
 & 
CACHE_VALID
) {

1290 
vÆid°¨t
 = -1;

1292 i‡((
löe
->
lbn
 % 
lockgøn
) == (lockgran-1)) {

1293 i‡((!
ˇche
->
¥e„tch_waôf‹_locks
Ë&& (
	`ˇche_©om_i¶ocked
(ˇche, 
löe
))) {

1296 i‡((
lockgøn
 = 
	`ˇche_gë_wrôe_lock
(
ˇche
, 
löe
, 
rwdesc
)) == 0) {

1300 
°¨t
--;

1301 
löe
->
°©e
 |
CACHE_VALID
;

1309 i‡(
¥e„tchty≥
 & 
CACHE_PREFETCH_RESTOFLINE
) {

1310 
ˇche_©om
 *
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
rwdesc
->
ªq
->
devno
, 
íd
);

1311 
vÆidíd
 = -1;

1312 
lockgøn
 = 
ˇche
->lockgran;

1313 (
íd
+1Ë% 
löesize
) {

1314 
löe
 =Üöe->
löe_√xt
;

1315 i‡(
löe
->
°©e
 & 
CACHE_VALID
) {

1329 
vÆidíd
 = -1;

1331 i‡((
löe
->
lbn
 % 
lockgøn
) == 0) {

1332 i‡((!
ˇche
->
¥e„tch_waôf‹_locks
Ë&& (
	`ˇche_©om_i¶ocked
(ˇche, 
löe
))) {

1335 i‡((
lockgøn
 = 
	`ˇche_gë_wrôe_lock
(
ˇche
, 
löe
, 
rwdesc
)) == 0) {

1339 
íd
++;

1340 
löe
->
°©e
 |
CACHE_VALID
;

1349 
fûÃeq
 = 
	`i‹eq_c›y
(
rwdesc
->
ªq
);

1350 
fûÃeq
->
blkno
 = 
°¨t
;

1351 
fûÃeq
->
bcou¡
 = 
íd
 - 
°¨t
 + 1;

1352 
fûÃeq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

1353 
fûÃeq
->
Êags
 |
READ
;

1354 
rwdesc
->
ªq
->
ãmpöt1
 = 
°¨t
;

1355 
rwdesc
->
ªq
->
ãmpöt2
 = 
íd
;

1356 
rwdesc
->
ty≥
 = (rwdesc->ty≥ =
CACHE_EVENT_READ
Ë? 
CACHE_EVENT_READEXTRA
 : 
CACHE_EVENT_WRITEFILLEXTRA
;

1357 
	`ˇche_waôf‹_IO
(
ˇche
, 1, 
rwdesc
, 
fûÃeq
);

1361 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
fûÃeq
);

1362 (
íd
 - 
°¨t
 + 1);

1363 
	}
}

1366 
	$ˇche_u∆ock_©èched_¥e„tch
 (
ˇche_mem
 *
ˇche
, 
ˇche_mem_evít
 *
rwdesc
)

1368 
fûl°¨t
 = 
rwdesc
->
ªq
->
ãmpöt1
;

1369 
fûÀnd
 = 
rwdesc
->
ªq
->
ãmpöt2
 + 1;

1370 
ªq°¨t
 = 
rwdesc
->
ªq
->
blkno
;

1371 
ªqíd
 = 
ªq°¨t
 + 
rwdesc
->
ªq
->
bcou¡
;

1375 i‡(
fûl°¨t
 < 
ªq°¨t
) {

1376 
lockgøn
 = 
ˇche
->lockgran;

1377 
ªq°¨t
 % 
ˇche
->
lockgøn
) {

1378 
ªq°¨t
--;

1381 
ªq°¨t
--;

1382 i‡(
fûl°¨t
 <
ªq°¨t
) {

1383 
ˇche_©om
 *
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
rwdesc
->
ªq
->
devno
, 
ªq°¨t
);

1385 i‡((
löe
->
lbn
 % 
lockgøn
) == (lockgran-1)) {

1386 
lockgøn
 = 
	`ˇche_‰ì_wrôe_lock
(
ˇche
, 
löe
, 
rwdesc
->
ªq
);

1388 
	`ASSERT
(
lockgøn
 != 0);

1390 
löe
 =Üöe->
löe_¥ev
;

1391 
ªq°¨t
--;

1392 } 
fûl°¨t
 <
ªq°¨t
);

1395 i‡(
fûÀnd
 > 
ªqíd
) {

1396 
lockgøn
 = 
ˇche
->lockgran;

1397 
ªqíd
 % 
ˇche
->
lockgøn
) {

1398 
ªqíd
++;

1406 i‡(
fûÀnd
 > 
ªqíd
) {

1407 
ˇche_©om
 *
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
rwdesc
->
ªq
->
devno
, 
ªqíd
);

1409 i‡((
löe
->
lbn
 % 
lockgøn
) == 0) {

1410 
lockgøn
 = 
	`ˇche_‰ì_wrôe_lock
(
ˇche
, 
löe
, 
rwdesc
->
ªq
);

1412 
	`ASSERT
(
lockgøn
 != 0);

1414 
löe
 =Üöe->
löe_√xt
;

1415 
ªqíd
++;

1416 } 
fûÀnd
 > 
ªqíd
);

1419 
	}
}

1422 
	$ˇche_ªad_c⁄töue
 (
ˇche_mem
 *
ˇche
, 
ˇche_mem_evít
 *
ªaddesc
)

1424 
ˇche_©om
 *
löe
 = 
NULL
;

1425 
ˇche_©om
 *
tmp
;

1426 
i
, 
j
;

1427 
ˇche_mem_evít
 *
waôì
;

1428 
°›
 = 0;

1429 
cuæock
;

1430 
lockgøn
;

1431 
ªt
;

1433 
löesize
 = 
	`max
(1, 
ˇche
->linesize);

1434 
devno
 = 
ªaddesc
->
ªq
->devno;

1435 
lbn
 = 
ªaddesc
->
ªq
->
blkno
;

1436 
size
 = 
ªaddesc
->
ªq
->
bcou¡
;

1437 
vÆidpoöt
 = 
ªaddesc
->validpoint;

1439 i‡(
ˇche
->
size
 == 0) {

1440 
	`ˇche_waôf‹_IO
(
ˇche
, 1, 
ªaddesc
,Ñóddesc->
ªq
);

1441 
ˇche
->
°©
.
ªadmis£s
++;

1442 
ˇche
->
°©
.
fûÃóds
++;

1443 
ˇche
->
°©
.
fûÃód©oms
 +
ªaddesc
->
ªq
->
bcou¡
;

1444 
ªaddesc
->
ªq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

1445 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
	`i‹eq_c›y
(
ªaddesc
->
ªq
));

1448 
i
 = 
ªaddesc
->
lock°›
;

1452 
ªad_c⁄t_lo›
:

1453 
i
 < 
size
) {

1454 
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
devno
, (
lbn
 + 
i
));

1455 
waôì
 = 
NULL
;

1456 i‡(
löe
 =
NULL
) {

1457 i‡((
waôì
 = 
	`ˇche_Æloˇã_•a˚
(
ˇche
, (
lbn
 + 
i
), 1, 
ªaddesc
))) {

1458 
ªaddesc
->
lock°›
 = 
i
;

1464 
°›
 = 
	`mö
(
	`roundu±omu…
((
size
 - 
i
), 
ˇche
->
©om•îbô
), (
löesize
 - ((
lbn
 + i) %Üinesize)));

1469 
j
 = 0;

1470 
tmp
 = 
löe
;

1471 
cuæock
 = 2;

1472 
lockgøn
 = 0;

1473 
j
 < 
°›
) {

1474 
lockty≥
 = (
tmp
->
°©e
 & 
CACHE_VALID
) ? 1 : 2;

1478 i‡(
lockty≥
 > 
cuæock
) {

1479 
cuæock
 = 
lockty≥
;

1480 
lockgøn
 = 0;

1481 
lockty≥
 = 3;

1483 
cuæock
 = 
lockty≥
;

1485 i‡((
lockgøn
Ë&& ((
lbn
+
i
+
j
) %Üockgran)) {

1486 } i‡((
ªt
 = 
	`ˇche_gë_rw_lock
(
ˇche
, 
lockty≥
, 
ªaddesc
, 
tmp
, (
i
+
j
), 1))) {

1490 i‡(
ªt
 == 1) {

1491 
ªaddesc
->
lock°›
 = 
i
 + 
j
;

1494 
ªad_c⁄t_lo›
;

1497 
lockgøn
 = 
ˇche
->lockgran;

1498 i‡((
tmp
->
°©e
 & 
CACHE_VALID
) == 0) {

1499 
tmp
->
°©e
 |
CACHE_VALID
;

1500 i‡(
vÆidpoöt
 == -1) {

1501 
vÆidpoöt
 = 
tmp
->
lbn
;

1502 
ªaddesc
->
vÆidpoöt
 = validpoint;

1506 i‡(
vÆidpoöt
 != -1) {

1508 
ªaddesc
->
Æloc°›
 |= 2;

1509 
ˇche
->
°©
.
fûÃóds
++;

1510 
ªaddesc
->
lock°›
 = - (ªaddesc->
ªq
->
blkno
 % 
ˇche
->
©om•îbô
);

1514 
ˇche
->
°©
.
fûÃód©oms
 +
	`ˇche_issue_fûÃeq
(ˇche, 
vÆidpoöt
, (
tmp
->
lbn
 - 1), 
ªaddesc
, cache->
ªad_¥e„tch_ty≥
);

1515 
ªaddesc
->
vÆidpoöt
 = -1;

1519 
tmp
 =Åmp->
löe_√xt
;

1520 
j
++;

1522 i‡((
vÆidpoöt
 !-1Ë&& ((
ˇche
->
ªad_löe_by_löe
Ë|| (!
	`ˇche_c⁄ˇtok
(ˇche, vÆidpoöt, 1, (vÆidpoöt+1), (
löe
->
lbn
 + 
°›
 - validpoint))))) {

1524 
ªaddesc
->
Æloc°›
 |= 1;

1525 
ˇche
->
°©
.
fûÃóds
++;

1529 
ˇche
->
°©
.
fûÃód©oms
 +
	`ˇche_issue_fûÃeq
(ˇche, 
vÆidpoöt
, (
löe
->
lbn
 + 
°›
 - 1), 
ªaddesc
, cache->
ªad_¥e„tch_ty≥
);

1530 
ªaddesc
->
vÆidpoöt
 = -1;

1533 
i
 +
löesize
 - ((
lbn
 + i) %Üinesize);

1538 i‡(
vÆidpoöt
 != -1) {

1540 
ªaddesc
->
Æloc°›
 |= 1;

1541 
ˇche
->
°©
.
fûÃóds
++;

1543 
ªaddesc
->
lock°›
 = - (ªaddesc->
ªq
->
blkno
 % 
ˇche
->
©om•îbô
);

1544 
ªaddesc
->
vÆidpoöt
 = -1;

1548 
ˇche
->
°©
.
fûÃód©oms
 +
	`ˇche_issue_fûÃeq
(ˇche, 
vÆidpoöt
, (
löe
->
lbn
 + 
°›
 - 1), 
ªaddesc
, cache->
ªad_¥e„tch_ty≥
);

1551 
ˇche
->
°©
.
gëblockªadd⁄es
++;

1552 
ˇche
->
°©
.
ªads
++;

1553 
ˇche
->
°©
.
ªad©oms
 +
ªaddesc
->
ªq
->
bcou¡
;

1554 i‡(
ªaddesc
->
Æloc°›
) {

1555 
ˇche
->
°©
.
ªadmis£s
++;

1557 
ˇche
->
°©
.
ªadhôsfuŒ
++;

1559 i‡(
ªaddesc
->
Êags
 & 
CACHE_FLAG_WASBLOCKED
) {

1561 (*
ªaddesc
->
d⁄efunc
)‘óddesc->
d⁄ï¨am
,Ñóddesc->
ªq
);

1562 
	`addt€xåaq
((
evít
 *Ë
ªaddesc
);

1565 
	}
}

1568 
	$ˇche_wrôe_c⁄töue
 (
ˇche_mem
 *
ˇche
, 
ˇche_mem_evít
 *
wrôedesc
)

1570 
°›
;

1571 
ˇche_mem_evít
 *
waôì
;

1572 
ˇche_©om
 *
löe
;

1573 
ˇche_©om
 *
tmp
;

1574 
lockgøn
;

1575 
i
, 
j
;

1576 
°¨tfûl°¨t
;

1577 
°¨tfûl°›
 = 0;

1578 
ídfûl°¨t
;

1579 
ídfûl°›
 = 0;

1580 
ªt
;

1582 
devno
 = 
wrôedesc
->
ªq
->devno;

1583 
lbn
 = 
wrôedesc
->
ªq
->
blkno
;

1584 
size
 = 
wrôedesc
->
ªq
->
bcou¡
;

1585 
löesize
 = (
ˇche
->linesize > 1) ? cache->linesize : 1;

1587 i‡(
ˇche
->
size
 == 0) {

1590 
i
 = 
wrôedesc
->
lock°›
;

1594 
wrôe_c⁄t_lo›
:

1596 
i
 < 
size
) {

1597 
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
devno
, (
lbn
 + 
i
));

1598 
waôì
 = 
NULL
;

1599 i‡(
löe
 =
NULL
) {

1600 i‡(
ˇche
->
no_wrôe_Æloˇã
) {

1602 
	`Ârötf
(
°dîr
, "Not yet handling write-no-allocate\n");

1603 
	`exô
(1);

1605 i‡((
waôì
 = 
	`ˇche_Æloˇã_•a˚
(
ˇche
, (
lbn
 + 
i
), 1, 
wrôedesc
))) {

1606 
wrôedesc
->
lock°›
 = 
i
;

1613 
°›
 = 
	`mö
(
	`roundu±omu…
((
size
 - 
i
), 
ˇche
->
©om•îbô
), (
löesize
 - ((
lbn
 + i) %Üinesize)));

1614 
j
 = 0;

1615 
tmp
 = 
löe
;

1616 
lockgøn
 = 0;

1617 
°¨tfûl°¨t
 = -1;

1618 
ídfûl°¨t
 = -1;

1619 
j
 < 
°›
) {

1620 i‡((
lockgøn
Ë&& ((
lbn
+
i
+
j
) %Üockgran)) {

1621 } i‡((
ªt
 = 
	`ˇche_gë_rw_lock
(
ˇche
, 2, 
wrôedesc
, 
tmp
, (
i
+
j
), 1))) {

1622 i‡(
ªt
 == 1) {

1623 
wrôedesc
->
lock°›
 = 
i
;

1626 
wrôe_c⁄t_lo›
;

1629 
lockgøn
 = 
ˇche
->lockgran;

1630 i‡((
tmp
->
lbn
 <ÜbnË&& (—mp->
°©e
 & 
CACHE_VALID
) == 0)) {

1631 
wrôedesc
->
Æloc°›
 |= 2;

1632 
tmp
->
°©e
 |
CACHE_VALID
;

1633 i‡(
°¨tfûl°¨t
 == -1) {

1634 
°¨tfûl°¨t
 = 
tmp
->
lbn
;

1636 
°¨tfûl°›
 = 
tmp
->
lbn
;

1637 } i‡((
tmp
->
°©e
 & 
CACHE_VALID
) == 0) {

1638 
tmpvÆ
 = 
tmp
->
lbn
 - (lb¿+ 
size
 - 1);

1639 
wrôedesc
->
Æloc°›
 |= 2;

1640 i‡((
tmpvÆ
 > 0Ë&& (tmpvÆ < (
ˇche
->
©om•îbô
 - ((
lbn
 + 
size
 - 1) % cache->atomsperbit)))) {

1641 
tmp
->
°©e
 |
CACHE_VALID
;

1642 i‡(
ídfûl°¨t
 == -1) {

1643 
ídfûl°¨t
 = 
tmp
->
lbn
;

1645 
ídfûl°›
 = 
tmp
->
lbn
;

1647 } i‡(
tmp
->
°©e
 & 
CACHE_DIRTY
) {

1648 
wrôedesc
->
Æloc°›
 |= 4;

1650 
tmp
 =Åmp->
löe_√xt
;

1651 
j
++;

1657 i‡((
°¨tfûl°¨t
 !-1Ë|| (
ídfûl°¨t
 != -1)) {

1658 
fûlblkno
 = (
°¨tfûl°¨t
 !-1Ë? sèπfûl°¨à: 
ídfûl°¨t
;

1659 
fûlbcou¡
 = 1 - 
fûlblkno
;

1660 
fûlbcou¡
 +((
°¨tfûl°¨t
 !-1Ë&& (
ídfûl°¨t
 =-1)Ë? 
°¨tfûl°›
 : 
ídfûl°›
;

1661 
ˇche
->
°©
.
wrôeödu˚dfûls
++;

1665 
ˇche
->
°©
.
wrôeödu˚dfûœtoms
 +
	`ˇche_issue_fûÃeq
(ˇche, 
fûlblkno
, (fûlblknÿ+ 
fûlbcou¡
 - 1), 
wrôedesc
, cache->
wrôefûl_¥e„tch_ty≥
);

1669 
i
 +
löesize
 - ((
lbn
 + i) %Üinesize);

1671 
ˇche
->
°©
.
wrôes
++;

1672 
ˇche
->
°©
.
wrôótoms
 +
wrôedesc
->
ªq
->
bcou¡
;

1673 
ˇche
->
°©
.
gëblockwrôed⁄es
++;

1674 i‡(
wrôedesc
->
Æloc°›
 & 4) {

1675 
ˇche
->
°©
.
wrôehôsdúty
++;

1676 } i‡(
wrôedesc
->
Æloc°›
) {

1677 
ˇche
->
°©
.
wrôemis£s
++;

1679 
ˇche
->
°©
.
wrôehôs˛ón
++;

1681 i‡(
wrôedesc
->
Êags
 & 
CACHE_FLAG_WASBLOCKED
) {

1683 (*
wrôedesc
->
d⁄efunc
)(wrôedesc->
d⁄ï¨am
, wrôedesc->
ªq
);

1684 
	`addt€xåaq
((
evít
 *Ë
wrôedesc
);

1687 
	}
}

1693 
ˇchemem_gë_block
 (
ˇche_if
 *
c
,

1694 
i‹eq_evít
 *
ªq
,

1695 (**
d⁄efunc
)(*, 
i‹eq_evít
 *),

1696 *
d⁄ï¨am
)

1698 
ˇche_mem
 *
ˇche
 = (ˇche_mem *)
c
;

1699 
ˇche_mem_evít
 *
rwdesc
 = (ˇche_mem_evíà*Ë
	`gë‰omexåaq
();

1700 
ªt
;

1705 
rwdesc
->
ty≥
 = (
ªq
->
Êags
 & 
READ
Ë? 
CACHE_EVENT_READ
 : 
CACHE_EVENT_WRITE
;

1706 
rwdesc
->
d⁄efunc
 = donefunc;

1707 
rwdesc
->
d⁄ï¨am
 = doneparam;

1708 
rwdesc
->
ªq
 =Ñeq;

1709 
ªq
->
√xt
 = 
NULL
;

1710 
ªq
->
¥ev
 = 
NULL
;

1711 
rwdesc
->
vÆidpoöt
 = -1;

1712 
rwdesc
->
lock°›
 = - (
ªq
->
blkno
 % 
ˇche
->
©om•îbô
);

1713 
rwdesc
->
Æloc°›
 = 0;

1714 
rwdesc
->
Êags
 = 0;

1715 i‡(
ªq
->
Êags
 & 
READ
) {

1716 
ˇche
->
°©
.
gëblockªad°¨ts
++;

1717 
ªt
 = 
	`ˇche_ªad_c⁄töue
(
ˇche
, 
rwdesc
);

1719 
ˇche
->
°©
.
gëblockwrôe°¨ts
++;

1720 
ªt
 = 
	`ˇche_wrôe_c⁄töue
(
ˇche
, 
rwdesc
);

1725 i‡(
ªt
 == 0) {

1726 (*
d⁄efunc
)(
d⁄ï¨am
, 
ªq
);

1727 
	`addt€xåaq
((
evít
 *Ë
rwdesc
);

1729 
rwdesc
->
Êags
 |
CACHE_FLAG_WASBLOCKED
;

1731 (
ªt
);

1732 
	}
}

1739 
	$ˇchemem_‰ì_block_˛ón
 (
ˇche_if
 *
c
,

1740 
i‹eq_evít
 *
ªq
)

1742 
ˇche_mem
 *
ˇche
 = (ˇche_mem *)
c
;

1743 
ˇche_©om
 *
löe
 = 
NULL
;

1744 
lockgøn
 = 0;

1745 
i
;

1749 
ˇche
->
°©
.
‰ìblock˛óns
++;

1750 i‡(
ˇche
->
size
 == 0) {

1753 
i
=0; i<
ªq
->
bcou¡
; i++) {

1754 i‡(
löe
 =
NULL
) {

1755 
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
ªq
->
devno
, (ªq->
blkno
 + 
i
));

1757 
	`ASSERT
(
löe
 !
NULL
);

1759 i‡(
ªq
->
ty≥
) {

1760 
	`ˇche_ac˚ss
(
ˇche
, 
löe
);

1763 i‡(((
löe
->
lbn
 % 
ˇche
->
lockgøn
Ë=(ˇche->lockgøn-1)Ë|| (
i
 =(
ªq
->
bcou¡
-1))) {

1764 
lockgøn
 +
	`ˇche_‰ì_ªad_lock
(
ˇche
, 
löe
, 
ªq
);

1766 
löe
 =Üöe->
löe_√xt
;

1769 
	`ASSERT2
((
lockgøn
 >
ªq
->
bcou¡
), "lockgran",Üockgran, "reqbcount",Ñeq->bcount);

1770 
	}
}

1774 
ˇche_wrôe_löe_by_löe
 (
ˇche_mem
 *
ˇche
,

1775 
i‹eq_evít
 *
Êushªq
,

1776 
ˇche_mem_evít
 *
wrôedesc
,

1777 
ªqd⁄e
);

1784 
ˇchemem_‰ì_block_dúty
 (
ˇche_if
 *
c
,

1785 
i‹eq_evít
 *
ªq
,

1786 (**
d⁄efunc
)(*, 
i‹eq_evít
 *),

1787 *
d⁄ï¨am
)

1789 
ˇche_mem
 *
ˇche
 = (ˇche_mem *)
c
;

1790 
ˇche_©om
 *
löe
 = 
NULL
;

1791 
i‹eq_evít
 *
Êushªq
 = 0;

1792 
ˇche_mem_evít
 *
wrôedesc
 = 0;

1793 
lockgøn
 = 0;

1794 
Êushblkno
 = 
ªq
->
blkno
;

1795 
Êushbcou¡
 = 
ªq
->
bcou¡
;

1796 
löebylöe
 = 
ˇche
->
löebylöëmp
;

1797 
i
;

1799 
wrôëhru
 = (
ˇche
->
size
 =0Ë|| (ˇche->
wrôescheme
 !
CACHE_WRITE_BACK
);

1803 
ˇche
->
löebylöëmp
 = 0;

1804 
ˇche
->
°©
.
‰ìblockdútys
++;

1805 i‡(
wrôëhru
) {

1806 
wrôedesc
 = (
ˇche_mem_evít
 *Ë
	`gë‰omexåaq
();

1807 
wrôedesc
->
ty≥
 = 
CACHE_EVENT_SYNC
;

1808 
wrôedesc
->
d⁄efunc
 = donefunc;

1809 
wrôedesc
->
d⁄ï¨am
 = doneparam;

1810 
wrôedesc
->
ªq
 =Ñeq;

1811 
ªq
->
ty≥
 = 
IO_REQUEST_ARRIVE
;

1812 
ªq
->
√xt
 = 
NULL
;

1813 
ªq
->
¥ev
 = 
NULL
;

1814 
Êushªq
 = 
	`i‹eq_c›y
(
ªq
);

1815 
Êushªq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

1816 
Êushªq
->
buf
 = 
ˇche
;

1818 i‡(
ˇche
->
size
 == 0) {

1819 
ˇche
->
°©
.
de°agewrôes
++;

1820 
ˇche
->
°©
.
de°agewrôótoms
 +
Êushªq
->
bcou¡
;

1821 
	`ˇche_waôf‹_IO
(
ˇche
, 1, 
wrôedesc
, 
Êushªq
);

1822 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
Êushªq
);

1828 
Êushblkno
 -(
ªq
->
blkno
 % 
ˇche
->
©om•îbô
);

1829 
Êushbcou¡
 +(
ªq
->
blkno
 % 
ˇche
->
©om•îbô
);

1830 
i
 = 
Êushblkno
 + 
Êushbcou¡
;

1831 
Êushbcou¡
 +
	`roundu±omu…
(
i
, 
ˇche
->
©om•îbô
) - i;

1835 
i
=0; i<
Êushbcou¡
; i++) {

1836 i‡(
löe
 =
NULL
) {

1837 i‡((
lockgøn
Ë&& (
wrôëhru
Ë&& ((
ˇche
->
wrôe_löe_by_löe
Ë|| (!
	`ˇche_c⁄ˇtok
(ˇche, 
Êushblkno
, 1, (Êushblkno+1), 
i
)))) {

1838 
Êushbcou¡
 = 
i
;

1839 
löebylöe
 = 1;

1842 
löe
 = 
	`ˇche_föd_©om
(
ˇche
, 
ªq
->
devno
, (
Êushblkno
 + 
i
));

1844 
	`ASSERT
(
löe
 !
NULL
);

1846 
	`ˇche_ac˚ss
(
ˇche
, 
löe
);

1848 i‡(!
wrôëhru
) {

1849 
löe
->
bu¢o
 = 
ªq
->busno;

1850 
löe
->
¶Ÿno
 = 
ªq
->slotno;

1852 
löe
->
°©e
 |(
wrôëhru
Ë? 
CACHE_VALID
 : (CACHE_VALID|
CACHE_DIRTY
);

1853 i‡(((
löe
->
lbn
 % 
ˇche
->
lockgøn
Ë!(ˇche->lockgøn-1)Ë&& (
i
 !(
Êushbcou¡
-1))) {

1854 } i‡(
wrôëhru
) {

1855 
lockgøn
 +
	`ˇche_gë_ªad_lock
(
ˇche
, 
löe
, 
wrôedesc
);

1857 
lockgøn
 +
	`ˇche_‰ì_wrôe_lock
(
ˇche
, 
löe
, 
ªq
);

1859 
löe
 =Üöe->
löe_√xt
;

1862 
	`ASSERT2
((
lockgøn
 >
Êushbcou¡
), "lockgran",Üockgran, "flushbcount", flushbcount);

1864 i‡(
wrôëhru
) {

1865 
ˇche
->
°©
.
de°agewrôes
++;

1866 
ˇche
->
°©
.
de°agewrôótoms
 +
Êushbcou¡
;

1867 
Êushªq
->
blkno
 = 
Êushblkno
;

1868 
Êushªq
->
bcou¡
 = 
Êushbcou¡
;

1869 i‡(
löebylöe
) {

1870 
	`ˇche_wrôe_löe_by_löe
(
ˇche
, 
Êushªq
, 
wrôedesc
, 0);

1872 
	`ˇche_waôf‹_IO
(
ˇche
, 1, 
wrôedesc
, 
Êushªq
);

1876 (*
ˇche
->
issuefunc
)(ˇche->
issuï¨am
, 
Êushªq
);

1877 i‡(
ˇche
->
wrôescheme
 =
CACHE_WRITE_SYNCONLY
) {

1881 
ªq
->
ty≥
 = -1;

1882 
wrôedesc
->
d⁄efunc
 = &
disksim
->
d⁄efunc_ˇchemem_em±y
;

1883 
ªq
 = 
	`i‹eq_c›y
(req);

1885 } i‡(
ˇche
->
Êush_idÀdñay
 >= 0.0) {

1886 
	`ioqueue_ª£t_idÀdëe˘î
((*
ˇche
->
queueföd
)(ˇche->
queueföd∑øm
, 
ªq
->
devno
), 0);

1888 (*
d⁄efunc
)(
d⁄ï¨am
, 
ªq
);

1890 
	}
}

1894 
	$ˇche_wrôe_löe_by_löe
 (
ˇche_mem
 *
ˇche
,

1895 
i‹eq_evít
 *
Êushªq
,

1896 
ˇche_mem_evít
 *
wrôedesc
,

1897 
ªqd⁄e
)

1899 
ˇche_mem_evít
 *
tmp
 = 
ˇche
->
∑πwrôes
;

1901 (
tmp
Ë&& (tmp->
ªq
 !
wrôedesc
->req)) {

1902 
tmp
 =Åmp->
√xt
;

1905 i‡(
tmp
 =
NULL
) {

1907 
	`ASSERT
(!
ªqd⁄e
);

1909 
tmp
 = (
ˇche_mem_evít
 *Ë
	`gë‰omexåaq
();

1910 
tmp
->
ªq
 = 
wrôedesc
->req;

1911 
tmp
->
lockty≥
 = 
wrôedesc
->
ªq
->
blkno
;

1912 
tmp
->
lock°›
 = 
wrôedesc
->
ªq
->
bcou¡
;

1913 
tmp
->
√xt
 = 
ˇche
->
∑πwrôes
;

1914 
tmp
->
¥ev
 = 
NULL
;

1915 i‡(
tmp
->
√xt
) {

1916 
tmp
->
√xt
->
¥ev
 =Åmp;

1918 
ˇche
->
∑πwrôes
 = 
tmp
;

1920 i‡(
ªqd⁄e
) {

1921 
tmp
->
ªq
->
bcou¡
 =Åmp->
accblkno
 - 
Êushªq
->
blkno
;

1922 
tmp
->
ªq
->
blkno
 = 
Êushªq
->blkno;

1923 
tmp
->
ªq
->
ty≥
 = 0;

1924 
	`ˇchemem_‰ì_block_˛ón
((
ˇche_if
 *)
ˇche
, 
tmp
->
ªq
);

1925 i‡(
tmp
->
accblkno
 >—mp->
lockty≥
 +Åmp->
lock°›
)) {

1926 i‡(
tmp
->
¥ev
) {

1927 
tmp
->
¥ev
->
√xt
 =Åmp->next;

1929 
ˇche
->
∑πwrôes
 = 
tmp
->
√xt
;

1931 i‡(
tmp
->
√xt
) {

1932 
tmp
->
√xt
->
¥ev
 =Åmp->prev;

1934 
tmp
->
ªq
->
blkno
 =Åmp->
lockty≥
;

1935 
tmp
->
ªq
->
bcou¡
 =Åmp->
lock°›
;

1936 (*
wrôedesc
->
d⁄efunc
)(wrôedesc->
d⁄ï¨am
, 
tmp
->
ªq
);

1937 
	`addt€xåaq
((
evít
 *Ë
tmp
);

1939 
tmp
->
ªq
->
bcou¡
 =Åmp->
lockty≥
 +Åmp->
lock°›
 -Åmp->
accblkno
;

1940 
tmp
->
ªq
->
blkno
 =Åmp->
accblkno
;

1941 
ˇche
->
löebylöëmp
 = 1;

1942 
	`ˇchemem_‰ì_block_dúty
((
ˇche_if
 *)
ˇche
, 
tmp
->
ªq
, 
wrôedesc
->
d⁄efunc
, wrôedesc->
d⁄ï¨am
);

1944 
	`addt€xåaq
((
evít
 *Ë
wrôedesc
);

1946 
wrôedesc
->
ty≥
 = 
CACHE_EVENT_SYNCPART
;

1947 
tmp
->
accblkno
 = 
Êushªq
->
blkno
 + flushªq->
bcou¡
;

1949 
	}
}

1952 
	$ˇchemem_sync
 (
ˇche_if
 *
c
)

1955 
	}
}

1959 
	$ˇchemem_disk_ac˚ss_com∂ëe
 (
ˇche_if
 *
c
, 
i‹eq_evít
 *
cuº
)

1961 
ˇche_mem
 *
ˇche
 = (ˇche_mem *)
c
;

1962 
i‹eq_evít
 *
ªq
;

1963 
ˇche_mem_evít
 *
tmp
 = 
ˇche
->
IOwaôîs
;

1967 
tmp
) {

1968 
ªq
 = 
tmp
->req;

1969 
ªq
) {

1970 i‡((
cuº
->
devno
 =
ªq
->devnoË&& ((cuº->
blkno
 =
tmp
->
accblkno
Ë|| (—mp->accblknÿ=-1Ë&& (‘eq->
√xt
Ë|| (tmp->
ty≥
 =
CACHE_EVENT_SYNC
Ë|| (tmp->ty≥ =
CACHE_EVENT_IDLESYNC
)) && (curr->blkno ==Ñeq->blkno)))) {

1974 
com∂ëed_ac˚ss
;

1976 
ªq
 =Ñeq->
√xt
;

1978 
tmp
 =Åmp->
√xt
;

1981 
com∂ëed_ac˚ss
:

1983 i‡(
tmp
 =
NULL
) {

1984 
	`Ârötf
(
°dîr
, "Not yet supportingÇon-waited for diskáccesses in cache\n");

1985 
	`exô
(1);

1987 i‡(
tmp
->
¥ev
) {

1988 
tmp
->
¥ev
->
√xt
 =Åmp->next;

1990 
ˇche
->
IOwaôîs
 = 
tmp
->
√xt
;

1992 i‡(
tmp
->
√xt
) {

1993 
tmp
->
√xt
->
¥ev
 =Åmp->prev;

1998 i‡((
ˇche
->
size
 =0Ë|| (
tmp
->
ty≥
 =
CACHE_EVENT_SYNC
Ë|| (tmp->ty≥ =
CACHE_EVENT_IDLESYNC
)) {

1999 
ty≥
 = 
ªq
->type;

2000 i‡(
ªq
->
√xt
) {

2001 
ªq
->
√xt
->
¥ev
 =Ñeq->prev;

2003 i‡(
ªq
->
¥ev
) {

2004 
ªq
->
¥ev
->
√xt
 =Ñeq->next;

2006 
tmp
->
ªq
 =Ñeq->
√xt
;

2008 
ªq
->
ty≥
 = 0;

2009 
	`ˇchemem_‰ì_block_˛ón
((
ˇche_if
 *)
ˇche
, 
ªq
);

2010 
ªq
->
ty≥
 =Åype;

2011 i‡(
ty≥
 != -1) {

2012 (*
tmp
->
d⁄efunc
)—mp->
d⁄ï¨am
, 
ªq
);

2014 i‡(
tmp
->
ªq
) {

2015 
	`ˇche_waôf‹_IO
(
ˇche
, 1, 
tmp
,Åmp->
ªq
);

2016 
tmp
->
accblkno
 = (tmp->
ªq
->
√xt
Ë? -1 :Åmp->ªq->
blkno
;

2017 
tmp
 = (
ty≥
 =-1Ë? (
ˇche_mem_evít
 *Ë
	`evít_c›y
((
evít
 *ÈmpË: 
NULL
;

2019 i‡(
tmp
->
ty≥
 =
CACHE_EVENT_IDLESYNC
) {

2020 
	`ˇche_idÀtime_dëe˘ed
(
ˇche
, 
cuº
->
devno
);

2022 i‡(
ty≥
 != -1) {

2023 
	`addt€xåaq
((
evít
 *Ë
tmp
);

2024 
tmp
 = 
NULL
;

2027 i‡(
ty≥
 == -1) {

2028 
tmp
->
ªq
 =Ñeq;

2030 } i‡(
tmp
->
ty≥
 =
CACHE_EVENT_READ
) {

2031 } i‡(
tmp
->
ty≥
 =
CACHE_EVENT_WRITE
) {

2032 } i‡(
tmp
->
ty≥
 =
CACHE_EVENT_SYNCPART
) {

2033 
cuº
->
√xt
 = 
tmp
->
ªq
;

2034 
tmp
->
ªq

cuº
;

2035 
cuº
 = 
NULL
;

2036 } i‡(
tmp
->
ty≥
 =
CACHE_EVENT_ALLOCATE
) {

2040 
ªq
->
√xt
->
¥ev
 =Ñeq->prev;

2041 i‡(
ªq
->
¥ev
) {

2042 
ªq
->
¥ev
->
√xt
 =Ñeq->next;

2044 
tmp
->
ªq
 =Ñeq->
√xt
;

2046 
ªq
->
ty≥
 = 0;

2047 
	`ˇchemem_‰ì_block_˛ón
((
ˇche_if
 *)
ˇche
, 
ªq
);

2048 
	`addt€xåaq
((
evít
 *Ë
ªq
);

2049 i‡(
tmp
->
ªq
 !tmp->
waôìs
->req) {

2050 
	`ˇche_waôf‹_IO
(
ˇche
, 1, 
tmp
,Åmp->
ªq
);

2051 
tmp
->
accblkno
 = -1;

2052 
tmp
 = 
NULL
;

2054 } i‡(
tmp
->
ty≥
 =
CACHE_EVENT_READEXTRA
) {

2055 
tmp
->
ty≥
 = 
CACHE_EVENT_READ
;

2056 
	`ˇche_u∆ock_©èched_¥e„tch
(
ˇche
, 
tmp
);

2057 } i‡(
tmp
->
ty≥
 =
CACHE_EVENT_WRITEFILLEXTRA
) {

2058 
tmp
->
ty≥
 = 
CACHE_EVENT_WRITE
;

2059 
	`ˇche_u∆ock_©èched_¥e„tch
(
ˇche
, 
tmp
);

2061 
	`Ârötf
(
°dîr
, "Unknow¿ty≥áàˇche_disk_ac˚ss_com∂ëe: %d\n", 
tmp
->
ty≥
);

2062 
	`exô
(1);

2064 
	`addt€xåaq
((
evít
 *Ë
cuº
);

2065 (
tmp
);

2066 
	}
}

2070 
	$ˇchemem_wakeup_com∂ëe
 (
ˇche_if
 *
c
, *
d
)

2072 
ˇche_mem
 *
ˇche
 = (ˇche_mem *)
c
;

2073 
ˇche_mem_evít
 *
desc
 = (ˇche_mem_evíà*)
d
;

2075 
desc
->
ty≥
) {

2076 
CACHE_EVENT_READ
:

2077 
	`ˇche_ªad_c⁄töue
(
ˇche
, 
desc
);

2080 
CACHE_EVENT_WRITE
:

2081 
	`ˇche_wrôe_c⁄töue
(
ˇche
, 
desc
);

2084 
CACHE_EVENT_ALLOCATE
:

2085 
	`ˇche_Æloˇã_•a˚_c⁄töue
(
ˇche
, 
desc
);

2088 
CACHE_EVENT_SYNC
:

2089 (*
desc
->
d⁄efunc
)(desc->
d⁄ï¨am
, desc->
ªq
);

2090 
	`addt€xåaq
((
evít
 *Ë
desc
);

2093 
CACHE_EVENT_SYNCPART
:

2095 
i‹eq_evít
 *
Êushªq
 = 
desc
->
ªq
;

2096 
desc
->
ªq
 = 
Êushªq
->
√xt
;

2097 
	`ˇche_wrôe_löe_by_löe
(
ˇche
, 
Êushªq
, 
desc
, 1);

2098 
	`addt€xåaq
((
evít
 *Ë
Êushªq
);

2101 
	`ddbg_as£π2
(0, "No such cachememÉventÅype");

2104 
	}
}

2107 
	$ˇchemem_ª£t°©s
 (
ˇche_if
 *
c
)

2109 
ˇche_mem
 *
ˇche
 = (ˇche_mem *)
c
;

2111 
ˇche
->
°©
.
ªads
 = 0;

2112 
ˇche
->
°©
.
ªad©oms
 = 0;

2113 
ˇche
->
°©
.
ªadhôsfuŒ
 = 0;

2114 
ˇche
->
°©
.
ªadhôs‰⁄t
 = 0;

2115 
ˇche
->
°©
.
ªadhôsback
 = 0;

2116 
ˇche
->
°©
.
ªadhôsmiddÀ
 = 0;

2117 
ˇche
->
°©
.
ªadmis£s
 = 0;

2118 
ˇche
->
°©
.
fûÃóds
 = 0;

2119 
ˇche
->
°©
.
fûÃód©oms
 = 0;

2120 
ˇche
->
°©
.
wrôes
 = 0;

2121 
ˇche
->
°©
.
wrôótoms
 = 0;

2122 
ˇche
->
°©
.
wrôehôs˛ón
 = 0;

2123 
ˇche
->
°©
.
wrôehôsdúty
 = 0;

2124 
ˇche
->
°©
.
wrôemis£s
 = 0;

2125 
ˇche
->
°©
.
wrôeödu˚dfûls
 = 0;

2126 
ˇche
->
°©
.
wrôeödu˚dfûœtoms
 = 0;

2127 
ˇche
->
°©
.
de°agewrôes
 = 0;

2128 
ˇche
->
°©
.
de°agewrôótoms
 = 0;

2129 
ˇche
->
°©
.
gëblockªad°¨ts
 = 0;

2130 
ˇche
->
°©
.
gëblockªadd⁄es
 = 0;

2131 
ˇche
->
°©
.
gëblockwrôe°¨ts
 = 0;

2132 
ˇche
->
°©
.
gëblockwrôed⁄es
 = 0;

2133 
ˇche
->
°©
.
‰ìblock˛óns
 = 0;

2134 
ˇche
->
°©
.
‰ìblockdútys
 = 0;

2135 
	}
}

2139 
	$ˇchemem_£tˇŒbacks
()

2141 
disksim
->
d⁄efunc_ˇchemem_em±y
 = 
ˇche_em±y_d⁄efunc
;

2142 
disksim
->
idÀw‹k_ˇchemem
 = 
ˇche_idÀtime_dëe˘ed
;

2143 
disksim
->
c⁄ˇtok_ˇchemem
 = 
ˇche_c⁄ˇtok
;

2144 
disksim
->
timîfunc_ˇchemem
 = 
ˇche_≥riodic_Êush
;

2145 
	}
}

2149 
ˇchemem_öôülize
 (
ˇche_if
 *
c
,

2150 (**
issuefunc
)(*,
i‹eq_evít
 *),

2151 *
issuï¨am
,

2152 
ioq
 * (**
queueföd
)(*,),

2153 *
queueföd∑øm
,

2155 (**
wakeupfunc
)(*, 
ˇchìvít
 *),

2156 *
wakeuµ¨am
,

2157 
numdevs
)

2159 
ˇche_mem
 *
ˇche
 = (ˇche_mem *)
c
;

2160 
i
, 
j
;

2161 
ˇche_©om
 *
tmp
;

2163 
	`SèticAs£π
 ((
ˇche_©om
Ë<
DISKSIM_EVENT_SIZE
);

2164 
	`SèticAs£π
 ((
ˇche_mem_evít
Ë<
DISKSIM_EVENT_SIZE
);

2165 
	`SèticAs£π
 ((
ˇche_lockhﬁdîs
Ë<
DISKSIM_EVENT_SIZE
);

2166 
	`SèticAs£π
 ((
ˇche_lockhﬁdîs
Ë=(
ˇche_lockwaôîs
));

2168 
ˇche
->
issuefunc
 = issuefunc;

2169 
ˇche
->
issuï¨am
 = issueparam;

2170 
ˇche
->
queueföd
 = queuefind;

2171 
ˇche
->
queueföd∑øm
 = queuefindparam;

2172 
ˇche
->
wakeupfunc
 = wakeupfunc;

2173 
ˇche
->
wakeuµ¨am
 = wakeupparam;

2174 
ˇche
->
IOwaôîs
 = 
NULL
;

2175 
ˇche
->
∑πwrôes
 = 
NULL
;

2176 
ˇche
->
löewaôîs
 = 
NULL
;

2177 
ˇche
->
löebylöëmp
 = 0;

2178 
i
=0; i<
CACHE_HASHSIZE
; i++) {

2179 
ˇche
->
hash
[
i
] = 0;

2181 
j
=0; j<(
ˇche
->
m≠mask
+1); j++) {

2182 
ˇche_m≠íåy
 *
m≠íåy
 = &
ˇche
->
m≠
[
j
];

2183 
i
=0; i<
CACHE_MAXSEGMENTS
; i++) {

2184 (
tmp
 = 
m≠íåy
->
Ãu
[
i
])) {

2185 
	`ˇche_ªmove_‰om_Ãuli°
(
m≠íåy
, 
tmp
, 
i
);

2186 
	`ˇche_add_to_Ãuli°
(
m≠íåy
, 
tmp
, 
CACHE_SEGNUM
);

2188 
m≠íåy
->
numa˘ive
[
i
] = 0;

2190 i‡(
m≠íåy
->
‰ìli°
) {

2193 
©om˙t
 = 
ˇche
->
size
 / (ˇche->
m≠mask
+1);

2194 
löesize
 = (
ˇche
->linesize) ? cache->linesize : 1;

2195 
tmp
 = 
NULL
;

2196 
i
=0; i<
©om˙t
; i++) {

2197 
ˇche_©om
 *
√w©om
 = (ˇche_©om *Ë
	`gë‰omexåaq
();

2198 
	`mem£t
((*Ë
√w©om
, 0, 
DISKSIM_EVENT_SIZE
);

2200 i‡(
i
 % 
löesize
) {

2201 
√w©om
->
löe_√xt
 = 
tmp
;

2202 
tmp
->
löe_¥ev
 = 
√w©om
;

2204 i‡(
tmp
) {

2205 
	`ˇche_add_to_Ãuli°
(
m≠íåy
, 
tmp
, 
CACHE_SEGNUM
);

2208 
tmp
 = 
√w©om
;

2210 i‡(
tmp
) {

2211 
	`ˇche_add_to_Ãuli°
(
m≠íåy
, 
tmp
, 
CACHE_SEGNUM
);

2215 i‡(
ˇche
->
Êush_pﬁicy
 =
CACHE_FLUSH_PERIODIC
) {

2216 
timî_evít
 *
timîeq
 = (timî_evíà*Ë
	`gë‰omexåaq
();

2217 
timîeq
->
ty≥
 = 
TIMER_EXPIRED
;

2218 
timîeq
->
func
 = &
disksim
->
timîfunc_ˇchemem
;

2219 
timîeq
->
time
 = 
ˇche
->
Êush_≥riod
;

2220 
timîeq
->
±r
 = 
ˇche
;

2221 
	`addtoötq
((
evít
 *)
timîeq
);

2223 
i
=0; i<
numdevs
; i++) {

2224 
ioq
 *
queue
 = (*
queueföd
)(
queueföd∑øm
, 
i
);

2225 i‡(
ˇche
->
Êush_idÀdñay
 >= 0.0) {

2226 
	`ioqueue_£t_idÀw‹k_fun˘i⁄
(
queue
, &
disksim
->
idÀw‹k_ˇchemem
, 
ˇche
, cache->
Êush_idÀdñay
);

2228 i‡(
ˇche
 =
NULL
) {

2229 
	`ioqueue_£t_c⁄ˇtok_fun˘i⁄
(
queue
, &
disksim
->
c⁄ˇtok_ˇchemem
, 
ˇche
);

2232 
	`ˇchemem_ª£t°©s
((
ˇche_if
 *)
ˇche
);

2233 
	}
}

2236 
	$ˇchemem_˛ón°©s
 (
ˇche_if
 *
c
)

2238 
	}
}

2242 
	$ˇchemem_¥öt°©s
 (
ˇche_if
 *
c
, *
¥efix
)

2244 
ˇche_mem
 *
ˇche
 = (ˇche_mem *)
c
;

2246 
ªqs
 = 
ˇche
->
°©
.
ªads
 + cache->°©.
wrôes
;

2247 
©oms
 = 
ˇche
->
°©
.
ªad©oms
 + cache->°©.
wrôótoms
;

2249 
	`Ârötf
 (
ouçutfûe
, "%sˇchêªque°s: %6d\n", 
¥efix
, 
ªqs
);

2250 i‡(
ªqs
 == 0) {

2254 
	`Ârötf
 (
ouçutfûe
, "%sˇchêªadÑeque°s: %6d \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
ªads
, ((Ëˇche->°©.ªad†/ (Ë
ªqs
));

2256 i‡(
ˇche
->
°©
.
ªads
) {

2258 
	`Ârötf
(
ouçutfûe
, "%sˇchê©om†ªad: %6d \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
ªad©oms
, ((Ëˇche->°©.ªad©om†/ (Ë
©oms
));

2260 
	`Ârötf
(
ouçutfûe
, "%sˇchêªad mis£s: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
ªadmis£s
, ((Ëˇche->°©.ªadmis£†/ (Ë
ªqs
), ((Ëˇche->°©.ªadmis£†/ (Ëˇche->°©.
ªads
));

2262 
	`Ârötf
(
ouçutfûe
, "%sˇchêªad fuŒ hôs: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
ªadhôsfuŒ
, ((Ëˇche->°©.ªadhôsfuŒ / (Ë
ªqs
), ((Ëˇche->°©.ªadhôsfuŒ / (Ëˇche->°©.
ªads
));

2264 
	`Ârötf
(
ouçutfûe
, "%sˇchêfûl†‘ód): %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
fûÃóds
, ((Ëˇche->°©.fûÃód†/ (Ë
ªqs
), ((Ëˇche->°©.fûÃód†/ (Ëˇche->°©.
ªads
));

2266 
	`Ârötf
(
ouçutfûe
, "%sˇchê©om fûl†‘ód): %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
fûÃód©oms
, ((Ëˇche->°©.fûÃód©om†/ (Ë
©oms
), ((Ëˇche->°©.fûÃód©om†/ (Ëˇche->°©.
ªad©oms
));

2269 
	`Ârötf
(
ouçutfûe
, "%sˇchêwrôêªque°s: %6d \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôes
, ((Ëˇche->°©.wrôe†/ (Ë
ªqs
));

2271 i‡(
ˇche
->
°©
.
wrôes
) {

2273 
	`Ârötf
(
ouçutfûe
, "%sˇchê©om†wrôãn: %6d \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôótoms
, ((Ëˇche->°©.wrôótom†/ (Ë
©oms
));

2275 
	`Ârötf
(
ouçutfûe
, "%sˇchêwrôêmis£s: %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôemis£s
, ((Ëˇche->°©.wrôemis£†/ (Ë
ªqs
), ((Ëˇche->°©.wrôemis£†/ (Ëˇche->°©.
wrôes
));

2277 
	`Ârötf
(
ouçutfûe
, "%sˇchêwrôêhô†(˛ón): %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôehôs˛ón
, ((Ëˇche->°©.wrôehôs˛ó¿/ (Ë
ªqs
), ((Ëˇche->°©.wrôehôs˛ó¿/ (Ëˇche->°©.
wrôes
));

2279 
	`Ârötf
(
ouçutfûe
, "%sˇchêwrôêhô†(dúty): %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôehôsdúty
, ((Ëˇche->°©.wrôehôsdúty / (Ë
ªqs
), ((Ëˇche->°©.wrôehôsdúty / (Ëˇche->°©.
wrôes
));

2281 
	`Ârötf
(
ouçutfûe
, "%sˇchêfûl†(wrôe): %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôeödu˚dfûls
, (()ˇche->°©.wrôeödu˚dfûl†/ (Ë
ªqs
), ((Ëˇche->°©.wrôeödu˚dfûl†/ (Ëˇche->°©.
wrôes
));

2283 
	`Ârötf
(
ouçutfûe
, "%sˇchê©om fûl†(wrôe): %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
wrôeödu˚dfûœtoms
, (()ˇche->°©.wrôeödu˚dfûœtom†/ (Ë
©oms
), ((Ëˇche->°©.wrôeödu˚dfûœtom†/ (Ëˇche->°©.
wrôótoms
));

2285 
	`Ârötf
(
ouçutfûe
, "%sˇchêde°age†(wrôe): %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
de°agewrôes
, ((Ëˇche->°©.de°agewrôe†/ (Ë
ªqs
), ((Ëˇche->°©.de°agewrôe†/ (Ëˇche->°©.
wrôes
));

2287 
	`Ârötf
(
ouçutfûe
, "%sˇchê©om de°age†(wrôe): %6d \t%6.4‡ \t%6.4f\n", 
¥efix
, 
ˇche
->
°©
.
de°agewrôótoms
, ((Ëˇche->°©.de°agewrôótom†/ (Ë
©oms
), ((Ëˇche->°©.de°agewrôótom†/ (Ëˇche->°©.
wrôótoms
));

2289 
	`Ârötf
(
ouçutfûe
, "%sˇchêíd dútyátoms: %6d \t%6.4f\n", 
¥efix
, 
	`ˇche_cou¡_dúty_©oms
(
ˇche
), ((Ëˇche_cou¡_dúty_©oms(ˇcheË/ (Ëˇche->
°©
.
wrôótoms
));

2294 
	`Ârötf
(
ouçutfûe
, "%sˇchêgë_block sèπ†‘ód): %6d\n", 
¥efix
, 
ˇche
->
°©
.
gëblockªad°¨ts
);

2295 
	`Ârötf
(
ouçutfûe
, "%sˇchêgë_block d⁄e†‘ód): %6d\n", 
¥efix
, 
ˇche
->
°©
.
gëblockªadd⁄es
);

2296 
	`Ârötf
(
ouçutfûe
, "%sˇchêgë_block sèπ†(wrôe): %6d\n", 
¥efix
, 
ˇche
->
°©
.
gëblockwrôe°¨ts
);

2297 
	`Ârötf
(
ouçutfûe
, "%sˇchêgë_block d⁄e†(wrôe): %6d\n", 
¥efix
, 
ˇche
->
°©
.
gëblockwrôed⁄es
);

2298 
	`Ârötf
(
ouçutfûe
, "%sˇchê‰ì_block_˛óns: %6d\n", 
¥efix
, 
ˇche
->
°©
.
‰ìblock˛óns
);

2299 
	`Ârötf
(
ouçutfûe
, "%sˇchê‰ì_block_dútys: %6d\n", 
¥efix
, 
ˇche
->
°©
.
‰ìblockdútys
);

2302 
	}
}

2305 
ˇche_if
 *

2306 
	$ˇchemem_c›y
 (
ˇche_if
 *
c
)

2308 
ˇche_mem
 *
ˇche
 = (ˇche_mem *)
c
;

2309 
i
, 
j
;

2311 
ˇche_m≠íåy
 *
m≠íåy
;

2312 
ˇche_mem
 *
√w
;

2314 
√w
 = (
ˇche_mem
 *Ë
	`DISKSIM_mÆloc
((cache_mem));

2315 
	`bzîo
(
√w
, (
ˇche_mem
));

2317 
m≠íåy
 = (
ˇche_m≠íåy
 *Ë
	`DISKSIM_mÆloc
((cache_mapentry));

2318 
	`bzîo
(
m≠íåy
, (
ˇche_m≠íåy
));

2321 
	`ASSERT
((
√w
 !
NULL
Ë&& (
m≠íåy
 != NULL));

2323 
√w
->
m≠
 = 
m≠íåy
;

2324 
i
=0; i<(
ˇche
->
m≠mask
+1); i++) {

2325 
m≠íåy
[
i
].
‰ìli°
 = 
NULL
;

2326 
j
=0; j<
CACHE_MAXSEGMENTS
; j++) {

2327 
m≠íåy
[
i
].
maxa˘ive
[
j
] = 
ˇche
->
m≠
[i].maxactive[j];

2328 
m≠íåy
[
i
].
Ãu
[
j
] = 
NULL
;

2332 
√w
->
issuefunc
 = 
ˇche
->issuefunc;

2334 
√w
->
issuï¨am
 = 
ˇche
->issueparam;

2335 
√w
->
size
 = 
ˇche
->size;

2336 
√w
->
©omsize
 = 
ˇche
->atomsize;

2337 
√w
->
num£gs
 = 
ˇche
->numsegs;

2338 
√w
->
löesize
 = 
ˇche
->linesize;

2339 
√w
->
©om•îbô
 = 
ˇche
->atomsperbit;

2340 
√w
->
lockgøn
 = 
ˇche
->lockgran;

2341 
√w
->
sh¨edªadlocks
 = 
ˇche
->sharedreadlocks;

2342 
√w
->
maxªqsize
 = 
ˇche
->maxreqsize;

2343 
√w
->
ª∂a˚pﬁicy
 = 
ˇche
->replacepolicy;

2344 
√w
->
m≠mask
 = 
ˇche
->mapmask;

2345 
√w
->
wrôescheme
 = 
ˇche
->writescheme;

2346 
√w
->
Êush_pﬁicy
 = 
ˇche
->flush_policy;

2347 
√w
->
Êush_≥riod
 = 
ˇche
->flush_period;

2348 
√w
->
Êush_idÀdñay
 = 
ˇche
->flush_idledelay;

2349 
√w
->
Êush_maxlöe˛u°î
 = 
ˇche
->flush_maxlinecluster;

2350 
√w
->
ªad_¥e„tch_ty≥
 = 
ˇche
->read_prefetch_type;

2351 
√w
->
wrôefûl_¥e„tch_ty≥
 = 
ˇche
->writefill_prefetch_type;

2352 
√w
->
¥e„tch_waôf‹_locks
 = 
ˇche
->prefetch_waitfor_locks;

2353 
√w
->
°¨èŒÊushes
 = 
ˇche
->startallflushes;

2354 
√w
->
Æloˇãpﬁicy
 = 
ˇche
->allocatepolicy;

2355 
√w
->
ªad_löe_by_löe
 = 
ˇche
->read_line_by_line;

2356 
√w
->
wrôe_löe_by_löe
 = 
ˇche
->write_line_by_line;

2357 
√w
->
maxsˇtg©h
 = 
ˇche
->maxscatgath;

2358 
√w
->
no_wrôe_Æloˇã
 = 
ˇche
->no_write_allocate;

2360  (
ˇche_if
 *)
√w
;

2361 
	}
}

2366 
	$ˇchemem_£tup_£gs
(
ˇche_mem
 *
ªsu…
, 
Õ_li°
 *
l
) {

2367 
ªm
, 
c
, 
d
;

2368 
max£g‰ac
;

2370 
ªm
 = 
ªsu…
->
size
;

2371 
ªsu…
->
m≠mask
 = 0;

2372 
ªsu…
->
m≠
 =

2373 (
ˇche_m≠íåy
 *Ë
	`DISKSIM_mÆloc
((
ªsu…
->
m≠mask
+1) *

2374 (
ˇche_m≠íåy
));

2376 
	`ASSERT
(
ªsu…
->
m≠
 !
NULL
);

2377 
	`bzîo
(
ªsu…
->
m≠
, (ªsu…->
m≠mask
+1)*(
ˇche_m≠íåy
));

2379 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

2380 if(
l
->
vÆues
[
c
]Ë
ªsu…
->
num£gs
++;

2383 
d
 = 0;

2384 
c
 = 0; c < (
l
->
vÆues_Àn
 - 1); c++) {

2385 if(!
l
->
vÆues
[
c
]) ;

2387 
	`as£π
(
l
->
vÆues
[
c
]->
t
 =
D
);

2388 
max£g‰ac
 = 
l
->
vÆues
[
c
]->
v
.
d
;

2390 
ªsu…
->
m≠
[0].
maxa˘ive
[
d
] = ()((Ëªsu…->
size
 * 
max£g‰ac
);

2391 
ªm
 -
ªsu…
->
m≠
[0].
maxa˘ive
[
d
];

2392 
d
++;

2397 
	`ASSERT
((
ªsu…
->
size
 =0Ë|| (
ªm
 >= 0));

2399 if(
ªsu…
->
num£gs
 > 1)

2400 
ªsu…
->
m≠
[ªsu…->
num£gs
 - 1].
maxa˘ive
[0] = 
ªm
;

2404 
c
=0; c<(
ªsu…
->
m≠mask
+1); c++) {

2405 
ªsu…
->
m≠
[
c
].
‰ìli°
 = 
NULL
;

2406 
d
=0; d<
CACHE_MAXSEGMENTS
; d++) {

2407 
ªsu…
->
m≠
[
c
].
maxa˘ive
[
d
] =Ñesult->map[0].maxactive[d];

2408 
ªsu…
->
m≠
[
c
].
Ãu
[
d
] = 
NULL
;

2411 
	}
}

2414 
ˇche_if
 
	gdisksim_ˇche_mem
 = {

2415 
ˇchemem_£tˇŒbacks
,

2416 
ˇchemem_öôülize
,

2417 
ˇchemem_ª£t°©s
,

2418 
ˇchemem_¥öt°©s
,

2419 
ˇchemem_˛ón°©s
,

2420 
ˇchemem_c›y
,

2421 
ˇchemem_gë_block
,

2422 
ˇchemem_‰ì_block_˛ón
,

2423 
ˇchemem_‰ì_block_dúty
,

2424 
ˇchemem_disk_ac˚ss_com∂ëe
,

2425 
ˇchemem_wakeup_com∂ëe
,

2426 
ˇchemem_sync
,

2427 
ˇchemem_gë_maxªqsize


2432 
ˇche_if
 *
	$disksim_ˇchemem_lﬂd∑øms
(
Õ_block
 *
b
)

2434 
ˇche_mem
 *
ªsu…
;

2436 
ªsu…
 = 
	`ˇŒoc
(1, (
ˇche_mem
));

2437 
ªsu…
->
hdr
 = 
disksim_ˇche_mem
;

2439 
ªsu…
->
«me
 = 
b
->«mê? 
	`°rdup
(b->name) : 0;

2442 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
disksim_ˇchemem_mod
);

2445 if(
ªsu…
->
löesize
 %Ñesu…->
©om•îbô
) {

2446 
	`Ârötf
(
°dîr
, "***Érror: memcache: Valid/dirty bit granularity must divideÉvenly intoÜine size.\n");

2451 if(
ªsu…
->
löesize
 %Ñesu…->
lockgøn
) {

2452 
	`Ârötf
(
°dîr
, "***Érror: memcache: Lock granularity must divideÉvenly intoÜine size.\n");

2458 
ªsu…
->
¥e„tch_waôf‹_locks
 = 
FALSE
;

2459 
ªsu…
->
©omsize
 = 1;

2460 
ªsu…
->
°¨èŒÊushes
 = 
TRUE
;

2461 
ªsu…
->
no_wrôe_Æloˇã
 = 
FALSE
;

2464  (
ˇche_if
 *)
ªsu…
;

2465 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_cachemem.h

101 #i‚de‡
DISKSIM_CACHEMEM_H


102 
	#DISKSIM_CACHEMEM_H


	)

104 
	~"disksim_globÆ.h
"

105 
	~"disksim_iosim.h
"

106 
	~"disksim_ioqueue.h
"

107 
	~"c⁄fig.h
"

108 
	~"disksim_ˇche.h
"

110 
	#CACHE_MAXSEGMENTS
 10

	)

111 
	#CACHE_LOCKSPERSTRUCT
 15

	)

112 
	#CACHE_HASHSIZE
 (
ALLOCSIZE
/())

	)

113 
	#CACHE_HASHMASK
 (0x00000000 | (
CACHE_HASHSIZE
 - 1))

	)

115 
	sˇchñockh
 {

116 
i‹eq_ev
 *
	míåy
[
CACHE_LOCKSPERSTRUCT
];

117 
ˇchñockh
 *
	m√xt
;

118 } 
	tˇche_lockhﬁdîs
;

120 
	sˇchñockw
 {

121 
ˇche_mem_evít
 *
	míåy
[
CACHE_LOCKSPERSTRUCT
];

122 
ˇchñockw
 *
	m√xt
;

123 } 
	tˇche_lockwaôîs
;

125 
	sˇchótom
 {

126 
ˇchótom
 *
	mhash_√xt
;

127 
ˇchótom
 *
	mhash_¥ev
;

128 
ˇchótom
 *
	mlöe_√xt
;

129 
ˇchótom
 *
	mlöe_¥ev
;

130 
	mdevno
;

131 
	mlbn
;

132 
	m°©e
;

133 
ˇchótom
 *
	mÃu_√xt
;

134 
ˇchótom
 *
	mÃu_¥ev
;

135 
ˇche_lockhﬁdîs
 *
	mªadlocks
;

136 
i‹eq_evít
 *
	mwrôñock
;

137 
ˇche_lockwaôîs
 *
	mlockwaôîs
;

138 
	mbu¢o
;

139 
	m¶Ÿno
;

140 } 
	tˇche_©om
;

142 
	sˇche_mem_evít
 {

143 
	mtime
;

144 
	mty≥
;

145 
ˇche_mem_evít
 *
	m√xt
;

146 
ˇche_mem_evít
 *
	m¥ev
;

147 (**
	md⁄efunc
)(*,
	mi‹eq_evít
 *);

148 *
	md⁄ï¨am
;

149 
	mÊags
;

150 
i‹eq_evít
 *
	mªq
;

151 
	maccblkno
;

152 
ˇche_©om
 *
	m˛ó√d
;

153 
ˇche_©om
 *
	mlöïªv
;

154 
	mlockty≥
;

155 
	mlock°›
;

156 
	mÆloc°›
;

157 
ˇche_mem_evít
 *
	mwaôìs
;

158 
	mvÆidpoöt
;

162 
	sˇche_mem_°©s
 {

163 
	mªads
;

164 
	mªad©oms
;

165 
	mªadhôsfuŒ
;

166 
	mªadhôs‰⁄t
;

167 
	mªadhôsback
;

168 
	mªadhôsmiddÀ
;

169 
	mªadmis£s
;

170 
	mfûÃóds
;

171 
	mfûÃód©oms
;

172 
	mwrôes
;

173 
	mwrôótoms
;

174 
	mwrôehôs˛ón
;

175 
	mwrôehôsdúty
;

176 
	mwrôemis£s
;

177 
	mwrôeödu˚dfûls
;

178 
	mwrôeödu˚dfûœtoms
;

179 
	mde°agewrôes
;

180 
	mde°agewrôótoms
;

181 
	mgëblockªad°¨ts
;

182 
	mgëblockªadd⁄es
;

183 
	mgëblockwrôe°¨ts
;

184 
	mgëblockwrôed⁄es
;

185 
	m‰ìblock˛óns
;

186 
	m‰ìblockdútys
;

190 
ˇche_©om
 *
	m‰ìli°
;

191 
	m•a˚
;

192 
ˇche_©om
 *
	mÃu
[
CACHE_MAXSEGMENTS
];

193 
	mnuma˘ive
[
CACHE_MAXSEGMENTS
];

194 
	mmaxa˘ive
[
CACHE_MAXSEGMENTS
];

195 } 
	tˇche_m≠íåy
;

197 
	sˇche_mem
 {

198 
ˇche_if
 
	mhdr
;

199 
ˇche_©om
 *
	mhash
[
CACHE_HASHSIZE
];

200 (**
	missuefunc
)(*,
	mi‹eq_evít
 *);

201 *
	missuï¨am
;

202 
	mioq
 * (**
	mqueueföd
)(*,);

203 *
	mqueueföd∑øm
;

205 (**
	mwakeupfunc
)(*, 
	mˇchìvít
 *);

206 *
	mwakeuµ¨am
;

207 
	msize
;

208 
	m©omsize
;

209 
	mnum£gs
;

210 
	mlöesize
;

211 
	m©om•îbô
;

212 
	mlockgøn
;

213 
	msh¨edªadlocks
;

214 
	mmaxªqsize
;

215 
	mª∂a˚pﬁicy
;

216 
	mm≠mask
;

217 
	mwrôescheme
;

218 
	mªad_¥e„tch_ty≥
;

219 
	mwrôefûl_¥e„tch_ty≥
;

220 
	m¥e„tch_waôf‹_locks
;

221 
	m°¨èŒÊushes
;

222 
	mÆloˇãpﬁicy
;

223 
	mªad_löe_by_löe
;

224 
	mwrôe_löe_by_löe
;

225 
	mmaxsˇtg©h
;

226 
	mno_wrôe_Æloˇã
;

227 
	mÊush_pﬁicy
;

228 
	mÊush_≥riod
;

229 
	mÊush_idÀdñay
;

230 
	mÊush_maxlöe˛u°î
;

231 
ˇche_m≠íåy
 *
	mm≠
;

232 
	mlöebylöëmp
;

233 
ˇche_mem_evít
 *
	mIOwaôîs
;

234 
ˇche_mem_evít
 *
	m∑πwrôes
;

235 
ˇche_mem_evít
 *
	mlöewaôîs
;

236 
ˇche_mem_°©s
 
	m°©
;

237 *
	m«me
;

244 
	#CACHE_REPLACE_MIN
 1

	)

245 
	#CACHE_REPLACE_FIFO
 1

	)

246 
	#CACHE_REPLACE_SLRU
 2

	)

247 
	#CACHE_REPLACE_RANDOM
 3

	)

248 
	#CACHE_REPLACE_LIFO
 4

	)

249 
	#CACHE_REPLACE_MAX
 4

	)

253 
	#CACHE_WRITE_MIN
 1

	)

254 
	#CACHE_WRITE_SYNCONLY
 1

	)

255 
	#CACHE_WRITE_THRU
 2

	)

256 
	#CACHE_WRITE_BACK
 3

	)

257 
	#CACHE_WRITE_MAX
 3

	)

261 
	#CACHE_ALLOCATE_MIN
 0

	)

262 
	#CACHE_ALLOCATE_NONDIRTY
 1

	)

263 
	#CACHE_ALLOCATE_MAX
 1

	)

267 
	#CACHE_PREFETCH_MIN
 0

	)

268 
	#CACHE_PREFETCH_NONE
 0

	)

269 
	#CACHE_PREFETCH_FRONTOFLINE
 1

	)

270 
	#CACHE_PREFETCH_RESTOFLINE
 2

	)

271 
	#CACHE_PREFETCH_ALLOFLINE
 3

	)

272 
	#CACHE_PREFETCH_MAX
 3

	)

276 
	#CACHE_FLUSH_MIN
 0

	)

277 
	#CACHE_FLUSH_DEMANDONLY
 0

	)

278 
	#CACHE_FLUSH_PERIODIC
 1

	)

279 
	#CACHE_FLUSH_MAX
 1

	)

281 
ˇchemem_£tˇŒbacks
();

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_controller.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_iosim.h
"

103 
	~"disksim_c⁄åﬁÀr.h
"

104 
	~"disksim_˘Ã.h
"

105 
	~"disksim_‹gÁ˚.h
"

106 
	~"disksim_ioqueue.h
"

107 
	~"disksim_ˇche.h
"

108 
	~"disksim_bus.h
"

109 
	~"c⁄fig.h
"

111 
	~"moduÀs/moduÀs.h
"

116 
INLINE
 
c⁄åﬁÀr
 * 
	$gë˘Ã
 (
˘Ãno
)

118 
˘Ãöfo_t
 *
˘Ãöfo
 = 
disksim
->ctlrinfo;

119 
	`ASSERT1
((
˘Ãno
 >0Ë&& (˘Ãnÿ< 
˘Ãöfo
->
numc⁄åﬁÀrs
), "ctlrno", ctlrno);

120  (
˘Ãöfo
->
c⁄åﬁÀrs
[
˘Ãno
]);

121 
	}
}

123 
c⁄åﬁÀr
 *
	$gë˘Ãby«me
(*
«me
, *
num
) {

124 
c
;

125 
c
 = 0; c < 
disksim
->
˘Ãöfo
->
numc⁄åﬁÀrs
; c++) {

126 if(!
	`°rcmp
(
«me
, 
disksim
->
˘Ãöfo
->
c⁄åﬁÀrs
[
c
]->name)) {

127 if(
num
Ë*num = 
c
;

128  
disksim
->
˘Ãöfo
->
c⁄åﬁÀrs
[
c
];

132 
	}
}

135 
	$c⁄åﬁÀr_C700_ba£d
 (
˘ o
)

137 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

138 i‡(
cuº˘Ã
->
ty≥
 =
CTLR_BASED_ON_53C700
) {

139 (
TRUE
);

141 (
FALSE
);

142 
	}
}

145 
	$c⁄åﬁÀr_gë_downw¨d_bu¢o
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
, *
¶Ÿn›å
)

147 
ötch¨
 
bu¢o
;

148 
ötch¨
 
¶Ÿno
;

149 
dïth
;

151 
bu¢o
.
vÆue
 = 
cuº
->busno;

152 
¶Ÿno
.
vÆue
 = 
cuº
->slotno;

153 
dïth
 = 
cuº˘Ã
->depth[0];

154 
	`ASSERT1
(
dïth
 !
MAXDEPTH
, "depth", depth);

155 
dïth
++;

156 i‡(
¶Ÿn›å
 !
NULL
) {

157 *
¶Ÿn›å
 = 
¶Ÿno
.
byã
[
dïth
] & 0x0F;

159 (
bu¢o
.
byã
[
dïth
]);

160 
	}
}

163 
	$c⁄åﬁÀr_gë_upw¨d_bu¢o
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
, *
¶Ÿn›å
)

165 
ötch¨
 
bu¢o
;

166 
ötch¨
 
¶Ÿno
;

167 
dïth
;

169 
bu¢o
.
vÆue
 = 
cuº
->busno;

170 
¶Ÿno
.
vÆue
 = 
cuº
->slotno;

171 
dïth
 = 
cuº˘Ã
->depth[0];

172 i‡(
¶Ÿn›å
 !
NULL
) {

173 *
¶Ÿn›å
 = 
¶Ÿno
.
byã
[
dïth
] >> 4;

175 i‡(
dïth
 != 0) {

176 (
bu¢o
.
byã
[
dïth
]);

180 
	}
}

183 
	$c⁄åﬁÀr_£nd_evít_down_∑th
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
, 
dñay
)

185 
bu¢o
;

186 
¶Ÿno
;

188 
bu¢o
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(
cuº˘Ã
, 
cuº
, 
NULL
);

189 
¶Ÿno
 = 
	`c⁄åﬁÀr_gë_out¶Ÿ
(
cuº˘Ã
->
˘ o
, 
bu¢o
);

190 
cuº
->
√xt
 = 
cuº˘Ã
->
buswaô
;

191 
cuº˘Ã
->
buswaô
 = 
cuº
;

192 
cuº
->
ãmpöt1
 = 
bu¢o
;

196 
cuº
->
time
 = 
dñay
 * 
cuº˘Ã
->
timesˇÀ
;

197 i‡(
cuº˘Ã
->
outbusow√d
 == -1) {

198 i‡(
	`bus_ow√rshù_gë
(
bu¢o
, 
¶Ÿno
, 
cuº
Ë=
FALSE
) {

204 
	`bus_dñay
(
bu¢o
, 
CONTROLLER
, 
cuº˘Ã
->
˘ o
, 
cuº
->
time
, curr);

205 
cuº
->
time
 = () -1;

207 } i‡(
cuº˘Ã
->
outbusow√d
 =
bu¢o
) {

208 
	`bus_dñay
(
bu¢o
, 
CONTROLLER
, 
cuº˘Ã
->
˘ o
, 
cuº
->
time
, curr);

209 
cuº
->
time
 = () -1.0;

211 
	`Ârötf
(
°dîr
, "Wrong bus owned forÅransfer desired\n");

212 
	`exô
(1);

214 
	}
}

217 
	$c⁄åﬁÀr_£nd_evít_up_∑th
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
, 
dñay
)

219 
bu¢o
;

220 
¶Ÿno
;

222 
bu¢o
 = 
	`c⁄åﬁÀr_gë_upw¨d_bu¢o
(
cuº˘Ã
, 
cuº
, 
NULL
);

223 
¶Ÿno
 = 
cuº˘Ã
->slotno[0];

229 
cuº
->
√xt
 = 
cuº˘Ã
->
buswaô
;

230 
cuº˘Ã
->
buswaô
 = 
cuº
;

231 
cuº
->
ãmpöt1
 = 
bu¢o
;

232 
cuº
->
time
 = 
dñay
 * 
cuº˘Ã
->
timesˇÀ
;

233 i‡(
bu¢o
 == -1) {

234 
	`bus_dñay
(
bu¢o
, 
CONTROLLER
, 
cuº˘Ã
->
˘ o
, 
cuº
->
time
, curr);

235 
cuº
->
time
 = () -1.0;

236 } i‡(
cuº˘Ã
->
öbusow√d
 == -1) {

237 i‡(
	`bus_ow√rshù_gë
(
bu¢o
, 
¶Ÿno
, 
cuº
Ë=
FALSE
) {

239 
	`bus_dñay
(
bu¢o
, 
CONTROLLER
, 
cuº˘Ã
->
˘ o
, 
cuº
->
time
, curr);

240 
cuº
->
time
 = () -1.0;

242 } i‡(
cuº˘Ã
->
öbusow√d
 =
bu¢o
) {

243 
	`bus_dñay
(
bu¢o
, 
CONTROLLER
, 
cuº˘Ã
->
˘ o
, 
cuº
->
time
, curr);

244 
cuº
->
time
 = () -1.0;

246 
	`Ârötf
(
°dîr
, "Wrong bus owned forÅransfer desired\n");

247 
	`exô
(1);

249 
	}
}

252 
	$c⁄åﬁÀr_gë_d©a_å™s„ªd
(
˘ o
, 
devno
)

254 
tm±ime
;

255 
tmpblks
;

256 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

257 
i‹eq_evít
 *
tmp
 = 
cuº˘Ã
->
d©©øns„rs
;

261 
tmp
) {

262 i‡(
tmp
->
devno
 == devno) {

263 
tm±ime
 = ((
i‹eq_evít
 *Ë
tmp
->
ãmµå1
)->
time
;

264 
tm±ime
 = (tm±imê- 
simtime
Ë/ 
tmp
->
time
;

265 
tmpblks
 = ((
i‹eq_evít
 *Ë
tmp
->
ãmµå1
)->
blkno
 -Åmp->blkno;

266 
tmpblks
 +((
i‹eq_evít
 *Ë
tmp
->
ãmµå1
)->
bcou¡
;

267 ((Ë((Ë
tmpblks
 - 
tm±ime
));

269 
tmp
 =Åmp->
√xt
;

272 
	}
}

275 
	$c⁄åﬁÀr_disown_bu¢o
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
bu¢o
)

277 
	`ASSERT1
((
bu¢o
 =
cuº˘Ã
->
öbusow√d
Ë|| (bu¢ÿ=cuº˘Ã->
outbusow√d
), "busno", busno);

278 i‡(
cuº˘Ã
->
öbusow√d
 =
bu¢o
) {

279 
	`bus_ow√rshù_ªÀa£
(
cuº˘Ã
->
öbusow√d
);

280 
cuº˘Ã
->
öbusow√d
 = -1;

282 
cuº˘Ã
->
outbusow√d
 = -1;

284 
	}
}

287 
	$c⁄åﬁÀr_bus_ow√rshù_gø¡
 (
˘ o
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
)

289 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

290 
i‹eq_evít
 *
tmp
;

294 
tmp
 = 
cuº˘Ã
->
buswaô
;

295 (
tmp
Ë&& (tm∞!
cuº
)) {

296 
tmp
 =Åmp->
√xt
;

299 
	`ASSERT
(
tmp
 !
NULL
);

300 
tmp
->
ty≥
) {

301 
IO_ACCESS_ARRIVE
:

302 
IO_INTERRUPT_COMPLETE
:

303 
cuº˘Ã
->
outbusow√d
 = 
bu¢o
;

305 
IO_INTERRUPT_ARRIVE
:

306 
cuº˘Ã
->
öbusow√d
 = 
bu¢o
;

309 
	`Ârötf
(
°dîr
, "Unknow¿evíàty≥áàc⁄åﬁÀr_bus_ow√rshù_gø¡ - %d\n", 
tmp
->
ty≥
);

310 
	`exô
(1);

312 
cuº˘Ã
->
waôögf‹bus
 +
¨bdñay
;

313 
	`bus_dñay
(
bu¢o
, 
CONTROLLER
, 
cuº˘Ã
->
˘ o
, 
tmp
->
time
,Åmp);

314 
tmp
->
time
 = () -1.0;

315 
	`c⁄åﬁÀr_disown_bu¢o
(
cuº˘Ã
, 
bu¢o
);

317 
	}
}

320 
	$c⁄åﬁÀr_ªmove_ty≥_‰om_buswaô
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
ty≥
)

322 
i‹eq_evít
 *
tmp
;

323 
i‹eq_evít
 *
åv
;

324 
bu¢o
;

326 
	`ASSERT
(
cuº˘Ã
->
buswaô
 !
NULL
);

327 i‡(
cuº˘Ã
->
buswaô
->
ty≥
 ==Åype) {

328 
tmp
 = 
cuº˘Ã
->
buswaô
;

329 
cuº˘Ã
->
buswaô
 = 
tmp
->
√xt
;

331 
åv
 = 
cuº˘Ã
->
buswaô
;

332 (
åv
->
√xt
Ë&& (åv->√xt->
ty≥
 !=Åype)) {

333 
åv
 =Årv->
√xt
;

335 
	`ASSERT1
(
åv
->
√xt
 !
NULL
, "ty≥", 
ty≥
);

336 
tmp
 = 
åv
->
√xt
;

337 
åv
->
√xt
 = 
tmp
->next;

339 i‡(
tmp
->
time
 == -1.0) {

340 
	`Ârötf
(
°dîr
, "InÑemove_type_from_buswait,ÅheÉvent is inÅransit\n");

341 
	`exô
(1);

343 
bu¢o
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(
cuº˘Ã
, 
tmp
, 
NULL
);

344 
	`bus_ªmove_‰om_¨bôøti⁄
(
bu¢o
, 
tmp
);

345 
	`addt€xåaq
((
evít
 *Ë
tmp
);

347 
	}
}

350 
	$c⁄åﬁÀr_bus_dñay_com∂ëe
(
˘ o
, 
i‹eq_evít
 *
cuº
, 
bu¢o
)

352 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

353 
i‹eq_evít
 *
åv
;

354 
¶Ÿno
;

355 
buswaôdú
;

357 i‡(
cuº
 =
cuº˘Ã
->
buswaô
) {

358 
cuº˘Ã
->
buswaô
 = 
cuº
->
√xt
;

360 
åv
 = 
cuº˘Ã
->
buswaô
;

361 (
åv
->
√xt
 !
NULL
Ë&& (åv->√xà!
cuº
)) {

362 
åv
 =Årv->
√xt
;

364 
	`ASSERT
(
åv
->
√xt
 =
cuº
);

365 
åv
->
√xt
 = 
cuº
->next;

370 
cuº
->
√xt
 = 
NULL
;

371 
cuº
->
time
 = 0.0;

372 i‡(
bu¢o
 =
	`c⁄åﬁÀr_gë_upw¨d_bu¢o
(
cuº˘Ã
, 
cuº
, &
¶Ÿno
)) {

373 
buswaôdú
 = 
UP
;

374 i‡(
bu¢o
 == -1) {

375 
	`öå_ªque°
 ((
evít
 *)
cuº
);

377 
	`bus_dñivî_evít
(
bu¢o
, 
¶Ÿno
, 
cuº
);

379 i‡(
cuº˘Ã
->
öbusow√d
 != -1) {

380 
	`bus_ow√rshù_ªÀa£
(
cuº˘Ã
->
öbusow√d
);

381 
cuº˘Ã
->
öbusow√d
 = -1;

383 } i‡(
bu¢o
 =
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(
cuº˘Ã
, 
cuº
, &
¶Ÿno
)) {

384 
buswaôdú
 = 
DOWN
;

385 
	`bus_dñivî_evít
(
bu¢o
, 
¶Ÿno
, 
cuº
);

386 i‡(
cuº˘Ã
->
outbusow√d
 != -1) {

387 
cuº˘Ã
->
outbusow√d
 = -1;

390 
	`Ârötf
(
°dîr
, "N⁄-m©chög bu¢ÿf‹Ñeque° i¿c⁄åﬁÀr_bus_dñay_com∂ëe: bu¢ÿ%d\n", 
bu¢o
);

391 
	`exô
(1);

393 
	}
}

396 
	$c⁄åﬁÀr_evít_¨rive
 (
˘ o
, 
i‹eq_evít
 *
cuº
)

398 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

405 
cuº˘Ã
->
ty≥
) {

407 
CTLR_PASSTHRU
:

408 
	`c⁄åﬁÀr_∑s°hru_evít_¨rive
(
cuº˘Ã
, 
cuº
);

411 
CTLR_BASED_ON_53C700
:

412 
	`c⁄åﬁÀr_53c700_evít_¨rive
(
cuº˘Ã
, 
cuº
);

415 
CTLR_SMART
:

416 
	`c⁄åﬁÀr_sm¨t_evít_¨rive
(
cuº˘Ã
, 
cuº
);

420 
	`Ârötf
(
°dîr
, "Unknow¿c⁄åﬁÀ∏ty≥ i¿c⁄åﬁÀr_öãºu±_¨rive: %d\n", 
cuº˘Ã
->
ty≥
);

421 
	`exô
(1);

423 
	}
}

428 
	$disksim_˘Ã_°©s_lﬂd∑øms
(
Õ_block
 *
b
) {

430 
˘Ãöfo_t
 *
˘Ãöfo
;

432 if(
disksim
->
˘Ãöfo
 =
NULL
) {

433 
disksim
->
˘Ãöfo
 = 
	`mÆloc
((
˘Ãöfo_t
));

434 if(!
disksim
->
˘Ãöfo
)  0;

435 
	`bzîo
((*)
disksim
->
˘Ãöfo
, (
˘Ãöfo_t
));

437 
˘Ãöfo
 = 
disksim
->ctlrinfo;

440 
	`Õ_lﬂd∑øms
(0, 
b
, &
disksim_˘Ã_°©s_mod
);

443 
	}
}

448 
c⁄åﬁÀr
 *
	$c⁄åﬁÀr_c›y
(
c⁄åﬁÀr
 *
‹ig
) {

449 
c⁄åﬁÀr
 *
ªsu…
 = 
	`mÆloc
((controller));

450 if(!
ªsu…
)  0;

451 
	`mem˝y
(
ªsu…
, 
‹ig
, (
c⁄åﬁÀr
));

452 
ªsu…
->
ˇche
 = 
‹ig
->ˇche->
	`ˇche_c›y
(orig->cache);

453 
ªsu…
->
queue
 = 
	`ioqueue_c›y
(
‹ig
->queue);

456 
ªsu…
->
c⁄√˘i⁄s
 = 0;

457 
ªsu…
->
d©©øns„rs
 = 0;

458 
ªsu…
->
ho°waôîs
 = 0;

459 
ªsu…
->
buswaô
 = 0;

460 
ªsu…
->
outbu£s
 = 0;

462  
ªsu…
;

463 
	}
}

465 
c⁄åﬁÀr
 *
	$disksim_˘Ã_lﬂd∑øms
(
Õ_block
 *
b
)

467 
c
;

468 
c⁄åﬁÀr
 *
ªsu…
;

475 i‡(
disksim
->
˘Ãöfo
 =
NULL
) {

476 
disksim
->
˘Ãöfo
 = 
	`DISKSIM_mÆloc
 ((
˘Ãöfo_t
));

477 
	`bzîo
 ((*)
disksim
->
˘Ãöfo
, (
˘Ãöfo_t
));

483 
c
 = 0; c < 
disksim
->
˘Ãöfo
->
˘Ãs_Àn
; c++) {

484 if(!
disksim
->
˘Ãöfo
->
c⁄åﬁÀrs
[
c
]Ë{ 
found¶Ÿ
; }

489 
√wÀn
 = 
c
 ? 2*c : 2;

490 
zîooff
 = (
√wÀn
 =2Ë? 0 : 
c
;

491 
zîﬁí
 = ((
√wÀn
 == 2) ? 2 : (newlen / 2)) * (*);

493 
disksim
->
˘Ãöfo
->
c⁄åﬁÀrs
 = 
	`ªÆloc
(disksim->ctlrinfo->controllers,

494 
√wÀn
 * (*));

496 
	`bzîo
(
disksim
->
˘Ãöfo
->
c⁄åﬁÀrs
 + 
zîooff
, 
zîﬁí
);

497 
disksim
->
˘Ãöfo
->
˘Ãs_Àn
 = 
√wÀn
;

500 
found¶Ÿ
:

502 
disksim
->
˘Ãöfo
->
numc⁄åﬁÀrs
++;

505 
ªsu…
 = 
	`mÆloc
((
c⁄åﬁÀr
));

506 if(!
ªsu…
)  0;

507 
	`bzîo
(
ªsu…
, (
c⁄åﬁÀr
));

509 
disksim
->
˘Ãöfo
->
c⁄åﬁÀrs
[
c
] = 
ªsu…
;

510 
	`bzîo
(
ªsu…
, (
c⁄åﬁÀr
));

512 
ªsu…
->
«me
 = 
	`°rdup
(
b
->name);

515 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
disksim_˘Ã_mod
);

519 
ªsu…
->
ovrhd_disk_ªque°
 = 0.5;

522 
ªsu…
->
ovrhd_ªady
 = 0.5;

525 
ªsu…
->
ovrhd_disk_ªady
 = 0.5;

528 
ªsu…
->
ovrhd_disc⁄√˘
 = 0.5;

531 
ªsu…
->
ovrhd_disk_disc⁄√˘
 = 0.5;

534 
ªsu…
->
ovrhd_ªc⁄√˘
 = 0.5;

537 
ªsu…
->
ovrhd_disk_ªc⁄√˘
 = 0.5;

540 
ªsu…
->
ovrhd_com∂ëe
 = 0.5;

543 
ªsu…
->
ovrhd_disk_com∂ëe
 = 0.5;

547 
ªsu…
->
ovrhd_ª£t
 = 0.5;

552  
ªsu…
;

553 
	}
}

558 
	$c⁄åﬁÀr_ªad_log‹g
 (
FILE
 *
∑rfûe
)

560 
	`as£π
(0);

575 
	}
}

579 
	$c⁄åﬁÀr_£t_dïth
 (
˘ o
,

580 
öbu¢o
,

581 
dïth
,

582 
¶Ÿno
)

584 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
 (
˘ o
);

585 
ötch¨
 
ªt
;

586 
i
;

587 
˙t
;

593 
˙t
 = 
cuº˘Ã
->
numöbu£s
;

594 i‡((
˙t
 > 0Ë&& (
cuº˘Ã
->
dïth
[(cnt-1)] < depth)) {

597 
cuº˘Ã
->
numöbu£s
++;

599 i‡((
˙t
 + 1Ë> 
MAXINBUSES
) {

600 
	`Ârötf
(
°dîr
,

602 
˘ o
, (
˙t
+1));

603 
	`ddbg_as£π
(0);

606 
cuº˘Ã
->
öbu£s
[
˙t
] = 
öbu¢o
;

607 
cuº˘Ã
->
dïth
[
˙t
] = depth;

608 
cuº˘Ã
->
¶Ÿno
[
˙t
] = slotno;

609 
ªt
.
vÆue
 = 0;

611 
i
 = 0; i < 
cuº˘Ã
->
numoutbu£s
; i++) {

612 
ªt
.
byã
[
i
] = (Ë
cuº˘Ã
->
outbu£s
[i];

613 
cuº˘Ã
->
out¶Ÿ
[
i
] = 
	`bus_gë_c⁄åﬁÀr_¶Ÿ
(
ªt
.
byã
[i], 
˘ o
);

616  
ªt
.
vÆue
;

617 
	}
}

620 
	$c⁄åﬁÀr_gë_bus_ma°î
 (
bu¢o
)

622 
˘Ãöfo_t
 *
˘Ãöfo
 = 
disksim
->ctlrinfo;

623 
i
;

624 
j
;

626 
i
 = 0; i < 
˘Ãöfo
->
numc⁄åﬁÀrs
; i++) {

627 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
i
);

628 
j
 = 0; j < 
cuº˘Ã
->
numoutbu£s
; j++) {

629 i‡(
cuº˘Ã
->
outbu£s
[
j
] =
bu¢o
) {

630 (
i
);

635 
	}
}

638 
	$c⁄åﬁÀr_gë_out¶Ÿ
 (
˘ o
, 
bu¢o
)

640 
i
;

641 
¶Ÿno
 = 0;

642 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

644 
i
 = 0; i < 
cuº˘Ã
->
numoutbu£s
; i++) {

645 i‡(
cuº˘Ã
->
outbu£s
[
i
] =
bu¢o
) {

646 
¶Ÿno
 = 
cuº˘Ã
->
out¶Ÿ
[
i
];

651 (
¶Ÿno
);

652 
	}
}

655 
	$c⁄åﬁÀr_gë_numc⁄åﬁÀrs
 ()

657 
˘Ãöfo_t
 *
˘Ãöfo
 = 
disksim
->ctlrinfo;

658  (
˘Ãöfo
->
numc⁄åﬁÀrs
);

659 
	}
}

662 
	$c⁄åﬁÀr_gë_dïth
 (
˘ o
)

664 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

665  (
cuº˘Ã
->
dïth
[0]);

666 
	}
}

669 
	$c⁄åﬁÀr_gë_öbus
 (
˘ o
)

671 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

672  (
cuº˘Ã
->
öbu£s
[0]);

673 
	}
}

676 
	$c⁄åﬁÀr_gë_¶Ÿno
 (
˘ o
)

678 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

679  (
cuº˘Ã
->
¶Ÿno
[0]);

680 
	}
}

683 
	$c⁄åﬁÀr_gë_maxout°™dög
 (
˘ o
)

685 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

686  (
cuº˘Ã
->
maxout°™dög
);

687 
	}
}

690 
	$c⁄åﬁÀr_£tˇŒbacks
 ()

692 
	`c⁄åﬁÀr_sm¨t_£tˇŒbacks
 ();

693 
	}
}

696 
	$c⁄åﬁÀr_öôülize
()

698 
˘Ãöfo_t
 *
˘Ãöfo
 = 
disksim
->ctlrinfo;

699 
i
;

701 
i
 = 0; i < 
˘Ãöfo
->
numc⁄åﬁÀrs
; i++) {

702 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
i
);

703 
cuº˘Ã
->
˘ o
 = 
i
;

704 
cuº˘Ã
->
°©e
 = 
FREE
;

705 
	`addli°t€xåaq
((
evít
 **Ë&
cuº˘Ã
->
c⁄√˘i⁄s
);

706 
	`addli°t€xåaq
((
evít
 **Ë&
cuº˘Ã
->
buswaô
);

707 
	`addli°t€xåaq
((
evít
 **Ë&
cuº˘Ã
->
d©©øns„rs
);

708 
	`addli°t€xåaq
((
evít
 **Ë&
cuº˘Ã
->
ho°waôîs
);

709 
cuº˘Ã
->
ho°å™s„r
 = 
FALSE
;

710 
cuº˘Ã
->
öbusow√d
 = -1;

711 
cuº˘Ã
->
outbusow√d
 = -1;

712 
cuº˘Ã
->
waôögf‹bus
 = 0.0;

713 i‡(
cuº˘Ã
->
ty≥
 =
CTLR_SMART
) {

714 
	`c⁄åﬁÀr_sm¨t_öôülize
(
cuº˘Ã
);

717 
	}
}

720 
	$c⁄åﬁÀr_ª£t°©s
()

722 
˘Ãöfo_t
 *
˘Ãöfo
 = 
disksim
->ctlrinfo;

723 
i
;

725 
i
=0; i<
˘Ãöfo
->
numc⁄åﬁÀrs
; i++) {

726 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
i
);

727 
cuº˘Ã
->
waôögf‹bus
 = 0.0;

728 i‡(
cuº˘Ã
->
ty≥
 =
CTLR_SMART
) {

729 
	`c⁄åﬁÀr_sm¨t_ª£t°©s
(
cuº˘Ã
);

732 
	}
}

735 
	$c⁄åﬁÀr_¥öt°©s
()

737 
˘Ãöfo_t
 *
˘Ãöfo
 = 
disksim
->ctlrinfo;

738 
˘ o
;

739 
¥efix
[81];

740 
waôögf‹bus
 = 0.0;

742 
	`Ârötf
 (
ouçutfûe
, "\nCONTROLLER STATISTICS\n");

743 
	`Ârötf
 (
ouçutfûe
, "---------------------\n\n");

745 
˘ o
=0; cénÿ< 
˘Ãöfo
->
numc⁄åﬁÀrs
; ctlno++) {

746 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
	`gë˘Ã
(
˘ o
);

747 
waôögf‹bus
 +
cuº˘Ã
->waitingforbus;

748 i‡(
cuº˘Ã
->
¥öt°©s
 == 0) {

751 
	`•rötf
(
¥efix
, "C⁄åﬁÀ∏#%d ", 
˘ o
);

752 
	`Ârötf
 (
ouçutfûe
, "%s\n\n", 
¥efix
);

753 
cuº˘Ã
->
ty≥
) {

755 
CTLR_PASSTHRU
:

756 
	`c⁄åﬁÀr_∑s°hru_¥öt°©s
(
cuº˘Ã
, 
¥efix
);

759 
CTLR_BASED_ON_53C700
:

760 
	`c⁄åﬁÀr_53c700_¥öt°©s
(
cuº˘Ã
, 
¥efix
);

763 
CTLR_SMART
:

764 
	`c⁄åﬁÀr_sm¨t_¥öt°©s
(
cuº˘Ã
, 
¥efix
);

768 
	`Ârötf
(
°dîr
, "Unknow¿c⁄åﬁÀ∏ty≥ i¿c⁄åﬁÀr_¥öt°©s: %d\n", 
cuº˘Ã
->
ty≥
);

769 
	`exô
(1);

772 
	`Ârötf
 (
ouçutfûe
, "TŸÆ c⁄åﬁÀ∏bu†waôÅime: %f\n", 
waôögf‹bus
);

773 
	}
}

776 
	$c⁄åﬁÀr_˛ón°©s
()

778 
	}
}

781 
	$lﬂd_˘Ã_t›o
(
Õ_t›o•ec
 *
t
, *
öbus
) {

782 
c
;

783 
c⁄åﬁÀr
 *
˘Ã
;

784 
num
;

785 
Õ_t›o•ec
 *
ts
;

786 
¶Ÿs
;

787 
	`as£π
(!
	`°rcmp
(
t
->
ty≥
, 
disksim_mods
[
DISKSIM_MOD_CTLR
]->
«me
));

789 
˘Ã
 = 
	`gë˘Ãby«me
(
t
->
«me
, &
num
);

790 if(!
˘Ã
) {

791 
	`Ârötf
(
°dîr
, "***Éº‹:Çÿsuch c⁄åﬁÀ∏%s\n", 
t
->
«me
);

796 if(
öbus
) {

797 
˘Ã
->
öbu£s
[0] = *
öbus
;

800 if(!
˘Ã
->
outbu£s
) {

801 
˘Ã
->
numoutbu£s
 = 0;

802 
¶Ÿs
 = 
t
->
l
->
vÆues_Àn
;

803 
˘Ã
->
outbu£s
 = 
	`mÆloc
(
¶Ÿs
 * ());

804 
	`bzîo
(
˘Ã
->
outbu£s
, 
¶Ÿs
 * ());

807 
c
 = 0; c < 
t
->
l
->
vÆues_Àn
; c++) {

808 if(!
t
->
l
->
vÆues
[
c
]) ;

809 
	`as£π
(
t
->
l
->
vÆues
[
c
]->
v
.t.
Àn
 == 1);

810 
ts
 = &
t
->
l
->
vÆues
[
c
]->
v
.t.l[0];

811 if(!
	`°rcmp
(
ts
->
ty≥
, 
disksim_mods
[
DISKSIM_MOD_BUS
]->
«me
)) {

812 
	`gëbusby«me
(
ts
->
«me
, &
˘Ã
->
outbu£s
[
c
]);

814 if(
˘Ã
->
outbu£s
[
c
] == -1) {

815 
	`Ârötf
(
°dîr
, "***Éº‹: Nÿsuch bus: %s\n", 
ts
->
«me
);

819 if(!
	`lﬂd_bus_t›o
(
ts
, &
num
)) {

820 
	`Ârötf
(
°dîr
, "***Éº‹: faûedÅÿlﬂd bu†t›ﬁogy s≥¯f‹ c⁄åﬁÀ∏%s.\n", 
t
->
«me
);

824 
˘Ã
->
numoutbu£s
++;

827 
	`Ârötf
(
°dîr
, "***Éº‹: c™ o∆yáâach bu£†tÿc⁄åﬁÀr†%s\n", 
t
->
«me
);

833 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_controller.h

101 #i‚de‡
DISKSIM_CONTROLLER_H


102 
	#DISKSIM_CONTROLLER_H


	)

106 
c⁄åﬁÀr_ªad_t›röts
 (
FILE
 *
∑rfûe
);

107 
c⁄åﬁÀr_ªad_•ecs
 (
FILE
 *
∑rfûe
);

108 
c⁄åﬁÀr_ªad_phys‹g
 (
FILE
 *
∑rfûe
);

109 
c⁄åﬁÀr_ªad_log‹g
 (
FILE
 *
∑rfûe
);

110 
c⁄åﬁÀr_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

111 
c⁄åﬁÀr_£tˇŒbacks
 ();

112 
c⁄åﬁÀr_öôülize
 ();

113 
c⁄åﬁÀr_ª£t°©s
 ();

114 
c⁄åﬁÀr_¥öt°©s
 ();

115 
c⁄åﬁÀr_˛ón°©s
 ();

116 
c⁄åﬁÀr_C700_ba£d
 (
˘ o
);

117 
c⁄åﬁÀr_£t_dïth
 (
˘ o
, 
öbu¢o
, 
dïth
, 
¶Ÿno
);

118 
c⁄åﬁÀr_gë_numc⁄åﬁÀrs
 ();

119 
c⁄åﬁÀr_gë_dïth
 (
˘ o
);

120 
c⁄åﬁÀr_gë_bus_ma°î
 (
bu¢o
);

121 
c⁄åﬁÀr_gë_öbus
 (
˘ o
);

122 
c⁄åﬁÀr_gë_¶Ÿno
 (
˘ o
);

123 
c⁄åﬁÀr_gë_out¶Ÿ
 (
˘ o
, 
bu¢o
);

124 
c⁄åﬁÀr_gë_maxout°™dög
 (
˘ o
);

125 
c⁄åﬁÀr_evít_¨rive
 (
˘ o
, 
i‹eq_evít
 *
cuº
);

126 
c⁄åﬁÀr_gë_d©a_å™s„ªd
 (
˘ o
, 
devno
);

127 
c⁄åﬁÀr_bus_dñay_com∂ëe
 (
˘ o
, 
i‹eq_evít
 *
cuº
, 
bu¢o
);

128 
c⁄åﬁÀr_bus_ow√rshù_gø¡
 (
˘ o
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_ctlr.h

101 #i‚de‡
DISKSIM_CTLR_H


102 
	#DISKSIM_CTLR_H


	)

104 
	~"disksim_iosim.h
"

105 
	~"disksim_ioqueue.h
"

106 
	~"disksim_ˇche.h
"

108 
	~"c⁄fig.h
"

112 
	#MINCTLTYPE
 1

	)

113 
	#CTLR_PASSTHRU
 1

	)

114 
	#CTLR_BASED_ON_53C700
 2

	)

115 
	#CTLR_SMART
 3

	)

116 
	#MAXCTLTYPE
 3

	)

120 
	#FREE
 1

	)

121 
	#READ_DATA_TRANSFER
 2

	)

122 
	#WRITE_DATA_TRANSFER
 3

	)

123 
	#COMPLETION_PENDING
 4

	)

124 
	#DISCONNECT_PENDING
 5

	)

125 
	#RECONNECTING
 6

	)

126 
	#REQUEST_PENDING
 7

	)

130 
	#UP
 1

	)

131 
	#DOWN
 2

	)

134 
	sc⁄åﬁÀr
 {

135 
	m˘ o
;

136 
	mty≥
;

137 
	m°©e
;

138 
	m¥öt°©s
;

139 
ioq
 * 
	mqueue
;

140 
ˇche_if
 *
	mˇche
;

141 
	mnumdevi˚s
;

142 
devi˚
 * 
	mdevi˚s
;

143 
	mtimesˇÀ
;

144 
	mblkå™°ime
;

145 
	movrhd_disk_ªque°
;

146 
	movrhd_ªady
;

147 
	movrhd_disk_ªady
;

148 
	movrhd_disc⁄√˘
;

149 
	movrhd_disk_disc⁄√˘
;

150 
	movrhd_ªc⁄√˘
;

151 
	movrhd_disk_ªc⁄√˘
;

152 
	movrhd_com∂ëe
;

153 
	movrhd_disk_com∂ëe
;

154 
	movrhd_ª£t
;

155 
i‹eq_evít
 *
	mc⁄√˘i⁄s
;

156 
i‹eq_evít
 *
	md©©øns„rs
;

157 
	mho°å™s„r
;

158 
i‹eq_evít
 *
	mho°waôîs
;

159 
	mmaxout°™dög
;

160 
	mmaxdiskqsize
;

161 
	möbusow√d
;

162 
	moutbusow√d
;

163 
i‹eq_evít
 *
	mbuswaô
;

164 
	mnumöbu£s
;

165 
	möbu£s
[
MAXINBUSES
];

166 
	mdïth
[
MAXINBUSES
];

167 
	m¶Ÿno
[
MAXINBUSES
];

168 
	mnumoutbu£s
;

169 *
	moutbu£s
;

170 
	mout¶Ÿ
[
MAXOUTBUSES
];

171 
	mwaôögf‹bus
;

172 *
	m«me
;

173 } 
	tc⁄åﬁÀr
;

176 
	s˘Ãöfo
 {

177 
	mnumc⁄åﬁÀrs
;

178 
c⁄åﬁÀr
 **
	mc⁄åﬁÀrs
;

179 
	m˘Ãs_Àn
;

180 
	mnum˘l‹gs
;

181 
log‹g
 *
	m˘l‹gs
;

182 
	m˘l_¥ötˇche°©s
;

183 
	m˘l_¥ötsize°©s
;

184 
	m˘l_¥öéoˇlôy°©s
;

185 
	m˘l_¥ötblockög°©s
;

186 
	m˘l_¥ötöãr„ª°©s
;

187 
	m˘l_¥ötqueue°©s
;

188 
	m˘l_¥öt¸ô°©s
;

189 
	m˘l_¥ötidÀ°©s
;

190 
	m˘l_¥ötöèº°©s
;

191 
	m˘l_¥öt°ªak°©s
;

192 
	m˘l_¥öt°amp°©s
;

193 
	m˘l_¥öçîdisk°©s
;

194 } 
	t˘Ãöfo_t
;

199 
c⁄åﬁÀr_∑s°hru_evít_¨rive
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
);

200 
c⁄åﬁÀr_∑s°hru_¥öt°©s
 (
c⁄åﬁÀr
 *
cuº˘Ã
, *
¥efix
);

201 
c⁄åﬁÀr_53c700_evít_¨rive
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
);

202 
c⁄åﬁÀr_53c700_¥öt°©s
 (
c⁄åﬁÀr
 *
cuº˘Ã
, *
¥efix
);

206 
c⁄åﬁÀr_sm¨t_evít_¨rive
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
);

207 
c⁄åﬁÀr_sm¨t_£tˇŒbacks
 ();

208 
c⁄åﬁÀr_sm¨t_öôülize
 (
c⁄åﬁÀr
 *
cuº˘Ã
);

209 
c⁄åﬁÀr_sm¨t_ª£t°©s
 (
c⁄åﬁÀr
 *
cuº˘Ã
);

210 
c⁄åﬁÀr_sm¨t_ªad_•ecs
 (
FILE
 *
∑rfûe
, 
c⁄åﬁÀr
 *
c⁄åﬁÀrs
, 
°¨t
, 
c›õs
);

211 
c⁄åﬁÀr_sm¨t_¥öt°©s
 (
c⁄åﬁÀr
 *
cuº˘Ã
, *
¥efix
);

215 
INLINE
 
c⁄åﬁÀr
 * 
gë˘Ã
 (
˘Ãno
);

216 
c⁄åﬁÀr
 *
gë˘Ãby«me
(*
«me
, *
num
);

218 
lﬂd_˘Ã_t›o
(
Õ_t›o•ec
 *
t
, *
öbus
);

220 
c⁄åﬁÀr_£nd_evít_up_∑th
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
, 
dñay
);

221 
c⁄åﬁÀr_£nd_evít_down_∑th
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
, 
dñay
);

222 
c⁄åﬁÀr_ªmove_ty≥_‰om_buswaô
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
ty≥
);

223 
c⁄åﬁÀr_gë_downw¨d_bu¢o
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
, *
¶Ÿn›å
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_ctlrdumb.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_iosim.h
"

103 
	~"disksim_c⁄åﬁÀr.h
"

104 
	~"disksim_˘Ã.h
"

105 
	~"disksim_bus.h
"

110 
	#PASSTHRU_DELAY
 1.0

	)

113 
	$c⁄åﬁÀr_53c700_ª£t_com∂ëe
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

115 
i‹eq_evít
 *
tmp
;

117 
cuº˘Ã
->
°©e
) {

118 
COMPLETION_PENDING
:

119 
DISCONNECT_PENDING
:

122 
	`Ârötf
(
°dîr
, "ControllerÇot ináppropriate state forÑeset completion\n");

123 
	`exô
(1);

125 
cuº˘Ã
->
°©e
 = 
FREE
;

126 
	`addt€xåaq
((
evít
 *Ë
cuº
);

127 i‡(
cuº˘Ã
->
c⁄√˘i⁄s
 !
NULL
) {

131 
tmp
 = 
cuº˘Ã
->
c⁄√˘i⁄s
;

132 
cuº˘Ã
->
c⁄√˘i⁄s
 = 
tmp
->
√xt
;

133 
cuº˘Ã
->
°©e
 = 
RECONNECTING
;

134 
	`c⁄åﬁÀr_£nd_evít_up_∑th
(
cuº˘Ã
, 
tmp
, cuº˘Ã->
ovrhd_ª£t
);

136 
	}
}

139 
	$c⁄åﬁÀr_53c700_ªc⁄√˘i⁄_com∂ëe
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

141 
ªad
 = 
cuº
->
Êags
 & 
READ
;

143 
	`ASSERT
(
cuº˘Ã
->
°©e
 =
RECONNECTING
);

144 
cuº˘Ã
->
outbusow√d
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(cuº˘Ã, 
cuº
, 
NULL
);

145 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_disk_ªc⁄√˘
);

146 
cuº˘Ã
->
outbusow√d
 = -1;

147 
cuº˘Ã
->
°©e
 = (
ªad
Ë? 
READ_DATA_TRANSFER
 : 
WRITE_DATA_TRANSFER
;

148 
	}
}

151 
	$c⁄åﬁÀr_53c700_ªc⁄√˘_to_å™s„r
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

153 
cuº˘Ã
->
°©e
) {

155 
COMPLETION_PENDING
:

156 
DISCONNECT_PENDING
:

157 
cuº
->
√xt
 = 
cuº˘Ã
->
c⁄√˘i⁄s
;

158 
cuº˘Ã
->
c⁄√˘i⁄s
 = 
cuº
;

161 
REQUEST_PENDING
:

162 
	`c⁄åﬁÀr_ªmove_ty≥_‰om_buswaô
(
cuº˘Ã
, 
IO_ACCESS_ARRIVE
);

164 
FREE
:

165 
cuº˘Ã
->
°©e
 = 
RECONNECTING
;

166 
	`c⁄åﬁÀr_£nd_evít_up_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_ªc⁄√˘
);

170 
	`Ârötf
(
°dîr
, "Re˚ivedÑec⁄√˘i⁄Ñeque° i¿övÆid sèã - cénÿ%d, sèã %d\n", 
cuº˘Ã
->
˘ o
, cuº˘Ã->
°©e
);

171 
	`exô
(1);

173 
	}
}

176 
	$c⁄åﬁÀr_53c700_ªque°_com∂ëe
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

178 
i‹eq_evít
 *
ªt
;

180 
cuº˘Ã
->
°©e
) {

181 
READ_DATA_TRANSFER
:

182 
WRITE_DATA_TRANSFER
:

185 
	`Ârötf
(
°dîr
, "CompletingÑequestÇotÅransfering in controller_53c700_request_complete\n");

186 
	`exô
(1);

188 
ªt
 = 
	`i‹eq_c›y
(
cuº
);

189 
ªt
->
ty≥
 = 
IO_INTERRUPT_COMPLETE
;

190 
cuº˘Ã
->
outbusow√d
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(cuº˘Ã, 
cuº
, 
NULL
);

191 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
ªt
, cuº˘Ã->
ovrhd_disk_com∂ëe
);

192 
cuº˘Ã
->
outbusow√d
 = -1;

193 
cuº˘Ã
->
°©e
 = 
COMPLETION_PENDING
;

194 
	`c⁄åﬁÀr_£nd_evít_up_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_com∂ëe
);

195 
	}
}

198 
	$c⁄åﬁÀr_53c700_disc⁄√˘
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

200 
i‹eq_evít
 *
ªt
;

202 
cuº˘Ã
->
°©e
) {

203 
READ_DATA_TRANSFER
:

204 
WRITE_DATA_TRANSFER
:

205 
REQUEST_PENDING
:

208 
	`Ârötf
(
°dîr
, "CompletingÑequestÇotÅransfering in controller_53c700_request_complete\n");

209 
	`exô
(1);

211 
ªt
 = 
	`i‹eq_c›y
(
cuº
);

212 
ªt
->
ty≥
 = 
IO_INTERRUPT_COMPLETE
;

213 
cuº˘Ã
->
outbusow√d
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(cuº˘Ã, 
cuº
, 
NULL
);

214 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
ªt
, cuº˘Ã->
ovrhd_disk_disc⁄√˘
);

215 
cuº˘Ã
->
outbusow√d
 = -1;

216 
cuº˘Ã
->
°©e
 = 
DISCONNECT_PENDING
;

217 
	`c⁄åﬁÀr_£nd_evít_up_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_disc⁄√˘
);

218 
	}
}

221 
	$c⁄åﬁÀr_53c700_ªady_to_å™s„r
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

223 
	`ASSERT
(
cuº˘Ã
->
°©e
 =
REQUEST_PENDING
);

224 
cuº˘Ã
->
°©e
 = (
cuº
->
Êags
 & 
READ
Ë? 
READ_DATA_TRANSFER
 : 
WRITE_DATA_TRANSFER
;

225 
cuº
->
ty≥
 = 
IO_INTERRUPT_COMPLETE
;

226 
cuº
->
ˇu£
 = 
RECONNECT
;

227 
cuº˘Ã
->
outbusow√d
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(cuº˘Ã, 
cuº
, 
NULL
);

228 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_disk_ªady
);

230 
cuº˘Ã
->
outbusow√d
 = -1;

231 
	}
}

234 
	$c⁄åﬁÀr_53c700_ªque°_¨rive
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

239 
cuº˘Ã
->
°©e
) {

240 
FREE
:

242 
RECONNECTING
:

243 
	`addt€xåaq
((
evít
 *Ë
cuº
);

246 
	`Ârötf
(
°dîr
, "RequestárrivingátÇon-FREE controller\n");

247 
	`exô
(1);

249 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_disk_ªque°
);

250 
cuº˘Ã
->
°©e
 = 
REQUEST_PENDING
;

251 
	}
}

254 
	$c⁄åﬁÀr_53c700_öãºu±_¨rive
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

256 
cuº
->
ˇu£
) {

258 
COMPLETION
:

259 
	`c⁄åﬁÀr_53c700_ªque°_com∂ëe
(
cuº˘Ã
, 
cuº
);

262 
RECONNECT
:

263 
	`c⁄åﬁÀr_53c700_ªc⁄√˘_to_å™s„r
(
cuº˘Ã
, 
cuº
);

266 
DISCONNECT
:

267 
	`c⁄åﬁÀr_53c700_disc⁄√˘
(
cuº˘Ã
, 
cuº
);

270 
READY_TO_TRANSFER
:

271 
	`c⁄åﬁÀr_53c700_ªady_to_å™s„r
(
cuº˘Ã
, 
cuº
);

275 
	`Ârötf
(
°dîr
, "Unknown interrupt cause in 53c700_interrupt_arrive\n");

276 
	`exô
(1);

278 
	}
}

281 
	$c⁄åﬁÀr_53c700_öãºu±_com∂ëe
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

283 
cuº
->
ˇu£
) {

285 
COMPLETION
:

286 
DISCONNECT
:

287 
	`c⁄åﬁÀr_53c700_ª£t_com∂ëe
(
cuº˘Ã
, 
cuº
);

290 
RECONNECT
:

291 
	`c⁄åﬁÀr_53c700_ªc⁄√˘i⁄_com∂ëe
(
cuº˘Ã
, 
cuº
);

295 
	`Ârötf
(
°dîr
, "Unknown interrupt cause in 53c700_interrupt_complete\n");

296 
	`exô
(1);

298 
	}
}

301 
	$c⁄åﬁÀr_53c700_d©a_å™s„r
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

303 
i‹eq_evít
 *
tmp
;

307 i‡(
cuº
->
ty≥
 =
DEVICE_DATA_TRANSFER_COMPLETE
) {

308 
cuº
->
time
 = 
	`max
(
	`devi˚_gë_blkå™°ime
(cuº), 
cuº˘Ã
->
blkå™°ime
);

309 } i‡(
cuº
->
ty≥
 =
CONTROLLER_DATA_TRANSFER_COMPLETE
) {

310 
	`Ârötf
(
°dîr
, "Not yetÉquipedÅo handle controllerÅo controllerÅransfers\n");

311 
	`exô
(1);

313 
	`Ârötf
(
°dîr
, "IllegalÉventÅypeát controller_53c700_data_transfer\n");

314 
	`exô
(1);

316 
cuº
->
√xt
 = 
cuº˘Ã
->
d©©øns„rs
;

317 
cuº
->
¥ev
 = 
NULL
;

318 i‡(
cuº
->
√xt
) {

319 
cuº
->
√xt
->
¥ev
 = curr;

321 
cuº˘Ã
->
d©©øns„rs
 = 
cuº
;

322 
tmp
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

323 
tmp
->
time
 = 
simtime
 + (
cuº
->timê* (Ëcuº->
bcou¡
);

324 
tmp
->
ty≥
 = 
CONTROLLER_DATA_TRANSFER_COMPLETE
;

325 
tmp
->
blkno
 = 
cuº
->blkno;

326 
tmp
->
bcou¡
 = 
cuº
->bcount;

327 
tmp
->
ãmpöt2
 = 
cuº˘Ã
->
˘ o
;

328 
tmp
->
ãmµå1
 = 
cuº
;

329 
cuº
->
buf
 = 
tmp
;

330 
	`addtoötq
((
evít
 *Ë
tmp
);

331 
	}
}

334 
	$c⁄åﬁÀr_53c700_d©a_å™s„r_com∂ëe
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

336 
i‹eq_evít
 *
tmp
;

338 
tmp
 = (
i‹eq_evít
 *Ë
cuº
->
ãmµå1
;

339 
tmp
->
bcou¡
 -
cuº
->bcount;

340 
	`addt€xåaq
((
evít
 *Ë
cuº
);

341 i‡(
tmp
->
bcou¡
 < 0) {

342 
	`Ârötf
(
°dîr
, "Transfered moreÅhanÑequestedát controller_data_transfer_done\n");

343 
	`exô
(1);

344 } i‡(
tmp
->
bcou¡
 == 0) {

345 i‡(
tmp
->
√xt
) {

346 
tmp
->
√xt
->
¥ev
 =Åmp->prev;

348 i‡(
tmp
->
¥ev
) {

349 
tmp
->
¥ev
->
√xt
 =Åmp->next;

351 
cuº˘Ã
->
d©©øns„rs
 = 
tmp
->
√xt
;

353 
tmp
->
time
 = 
simtime
;

354 
	`addtoötq
((
evít
 *Ë
tmp
);

356 
	`Ârötf
(
°dîr
, "Haven'tÑequiredÜessÅhanáll outÅransferát controller_data_transfer_done\n");

357 
	`exô
(1);

359 
	}
}

362 
	$c⁄åﬁÀr_53c700_evít_¨rive
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

364 
bu¢o
;

365 
¶Ÿno
;

367 
cuº
->
ty≥
) {

369 
IO_ACCESS_ARRIVE
:

370 
	`c⁄åﬁÀr_53c700_ªque°_¨rive
(
cuº˘Ã
, 
cuº
);

373 
IO_INTERRUPT_ARRIVE
:

374 
	`c⁄åﬁÀr_53c700_öãºu±_¨rive
(
cuº˘Ã
, 
cuº
);

377 
IO_INTERRUPT_COMPLETE
:

378 
	`c⁄åﬁÀr_53c700_öãºu±_com∂ëe
(
cuº˘Ã
, 
cuº
);

381 
DEVICE_DATA_TRANSFER_COMPLETE
:

382 
	`c⁄åﬁÀr_53c700_d©a_å™s„r
(
cuº˘Ã
, 
cuº
);

385 
CONTROLLER_DATA_TRANSFER_COMPLETE
:

386 
	`c⁄åﬁÀr_53c700_d©a_å™s„r_com∂ëe
(
cuº˘Ã
, 
cuº
);

389 
IO_QLEN_MAXCHECK
:

390 
bu¢o
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(
cuº˘Ã
, 
cuº
, &
¶Ÿno
);

391 
	`bus_dñivî_evít
(
bu¢o
, 
¶Ÿno
, 
cuº
);

395 
	`Ârötf
(
°dîr
, "Unknow¿evíàty≥áºivögáà53c700 c⁄åﬁÀr: %d\n", 
cuº
->
ty≥
);

396 
	`exô
(1);

398 
	}
}

401 
	$c⁄åﬁÀr_∑s°hru_evít_¨rive
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

403 
bu¢o
;

404 
¶Ÿno
;

406 
cuº
->
ty≥
) {

408 
IO_INTERRUPT_COMPLETE
:

409 
cuº˘Ã
->
outbusow√d
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(cuº˘Ã, 
cuº
, 
NULL
);

410 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
cuº
, 
PASSTHRU_DELAY
);

411 
cuº˘Ã
->
outbusow√d
 = -1;

414 
IO_ACCESS_ARRIVE
:

418 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
cuº
, 
PASSTHRU_DELAY
);

421 
IO_INTERRUPT_ARRIVE
:

422 i‡(
cuº
->
ˇu£
 =
READY_TO_TRANSFER
) {

423 
cuº
->
ˇu£
 = 
RECONNECT
;

425 
	`c⁄åﬁÀr_£nd_evít_up_∑th
(
cuº˘Ã
, 
cuº
, 
PASSTHRU_DELAY
);

428 
DEVICE_DATA_TRANSFER_COMPLETE
:

429 
	`c⁄åﬁÀr_£nd_evít_up_∑th
(
cuº˘Ã
, 
cuº
, () 0.0);

432 
IO_QLEN_MAXCHECK
:

433 
bu¢o
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(
cuº˘Ã
, 
cuº
, &
¶Ÿno
);

434 
	`bus_dñivî_evít
(
bu¢o
, 
¶Ÿno
, 
cuº
);

438 
	`Ârötf
(
°dîr
, "Unknow¿evíàty≥áºivögáà∑s°hru c⁄åﬁÀr: %d\n", 
cuº
->
ty≥
);

439 
	`exô
(1);

441 
	}
}

444 
	$c⁄åﬁÀr_∑s°hru_¥öt°©s
 (
c⁄åﬁÀr
 *
cuº˘Ã
, *
¥efix
)

446 
	}
}

449 
	$c⁄åﬁÀr_53c700_¥öt°©s
 (
c⁄åﬁÀr
 *
cuº˘Ã
, *
¥efix
)

451 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_ctlrsmart.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_iosim.h
"

103 
	~"disksim_c⁄åﬁÀr.h
"

104 
	~"disksim_˘Ã.h
"

105 
	~"disksim_‹gÁ˚.h
"

106 
	~"disksim_ioqueue.h
"

107 
	~"disksim_ˇche.h
"

110 
ioq
 * 
	$c⁄åﬁÀr_sm¨t_queueföd
 (*
queueföd∑øm
, 
devno
)

112 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
queueföd∑øm
;

113 
	`ASSERT1
((
devno
 >0Ë&& (devnÿ< 
	`devi˚_gë_numdevi˚s
()), "devno", devno);

114 (
cuº˘Ã
->
devi˚s
[
devno
].
queue
);

115 
	}
}

118 
	$c⁄åﬁÀr_sm¨t_wakeup
 (*
wakeupfun˝¨am
, 
ˇchìvít
 *cacheevent)

120 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
wakeupfun˝¨am
;

121 i‡(
ˇchìvít
) {

122 
cuº˘Ã
->
ˇche
->
	`ˇche_wakeup_com∂ëe
(cuº˘Ã->ˇche, 
ˇchìvít
);

124 
	}
}

127 
	$c⁄åﬁÀr_sm¨t_issue_ac˚ss
 (*
issuefun˝¨am
, 
i‹eq_evít
 *
cuº
)

129 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
issuefun˝¨am
;

130 
ioq
 *
queue
 = 
cuº˘Ã
->
devi˚s
[
cuº
->
devno
].queue;

131 
numout
 = 
	`ioqueue_gë_ªqout°™dög
(
queue
);

135 
cuº
->
bu¢o
 = 
cuº˘Ã
->
devi˚s
[cuº->
devno
].
bu•©h
.
vÆue
;

136 
cuº
->
¶Ÿno
 = 
cuº˘Ã
->
devi˚s
[cuº->
devno
].
¶Ÿ∑th
.
vÆue
;

138 
	`ioqueue_add_√w_ªque°
(
queue
, 
cuº
);

139 i‡(
numout
 < 
cuº˘Ã
->
devi˚s
[
cuº
->
devno
].
maxout°™dög
) {

140 
i‹eq_evít
 *
sched
 = 
	`ioqueue_gë_√xt_ªque°
(
queue
);

141 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
sched
, cuº˘Ã->
ovrhd_disk_ªque°
);

143 
	}
}

146 
	$c⁄åﬁÀr_sm¨t_disk_d©a_å™s„r
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

148 
i‹eq_evít
 *
tmp
 = (i‹eq_evíà*Ë
	`gë‰omexåaq
();

152 
cuº
->
time
 = 
	`max
(
	`devi˚_gë_blkå™°ime
(cuº), 
cuº˘Ã
->
blkå™°ime
);

153 
tmp
->
time
 = 
simtime
 + ((Ë
cuº
->
bcou¡
 * curr->time);

154 
tmp
->
ty≥
 = 
CONTROLLER_DATA_TRANSFER_COMPLETE
;

155 
tmp
->
devno
 = 
cuº
->devno;

156 
tmp
->
blkno
 = 
cuº
->blkno;

157 
tmp
->
bcou¡
 = 
cuº
->bcount;

158 
tmp
->
ãmpöt2
 = 
cuº˘Ã
->
˘ o
;

159 
tmp
->
ãmµå1
 = 
cuº
;

162 
cuº
->
ãmµå1
 = 
tmp
;

163 
cuº
->
√xt
 = 
cuº˘Ã
->
d©©øns„rs
;

164 
cuº
->
¥ev
 = 
NULL
;

165 i‡(
cuº
->
√xt
) {

166 
cuº
->
√xt
->
¥ev
 = curr;

168 
cuº˘Ã
->
d©©øns„rs
 = 
cuº
;

170 
	`addtoötq
((
evít
 *Ë
tmp
);

171 
	}
}

174 
	$c⁄åﬁÀr_sm¨t_disk_d©a_å™s„r_com∂ëe
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

176 
i‹eq_evít
 *
tmp
 = (i‹eq_evíà*Ë
cuº
->
ãmµå1
;

178 
tmp
->
bcou¡
 -
cuº
->bcount;

179 
	`addt€xåaq
((
evít
 *Ë
cuº
);

180 
	`ASSERT
(
tmp
->
bcou¡
 >= 0);

181 i‡(
tmp
->
bcou¡
 == 0) {

182 i‡(
tmp
->
√xt
) {

183 
tmp
->
√xt
->
¥ev
 =Åmp->prev;

185 i‡(
tmp
->
¥ev
) {

186 
tmp
->
¥ev
->
√xt
 =Åmp->next;

188 
cuº˘Ã
->
d©©øns„rs
 = 
tmp
->
√xt
;

190 
tmp
->
time
 = 
simtime
;

191 
	`addtoötq
((
evít
 *Ë
tmp
);

193 
	`Ârötf
(
°dîr
, "Haven'tÑequiredÜessÅhanáll outÅransferát controller_smart_disk_data_transfer_complete\n");

194 
	`exô
(1);

196 
	}
}

199 
	$c⁄åﬁÀr_sm¨t_ªque°_com∂ëe
 (*
d⁄efun˝¨am
, 
i‹eq_evít
 *
cuº
)

201 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
d⁄efun˝¨am
;

206 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

207 
cuº
->
ˇu£
 = 
COMPLETION
;

208 
	`c⁄åﬁÀr_£nd_evít_up_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_com∂ëe
);

209 
	}
}

212 
	$c⁄åﬁÀr_sm¨t_ho°_d©a_å™s„r_com∂ëe
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

216 i‡(
cuº
->
Êags
 & 
READ
) {

217 
cuº˘Ã
->
ˇche
->
	`ˇche_‰ì_block_˛ón
(cuº˘Ã->ˇche, 
cuº
);

218 
	`c⁄åﬁÀr_sm¨t_ªque°_com∂ëe
(
cuº˘Ã
, 
cuº
);

221 
cuº˘Ã
->
ˇche
->
	`ˇche_‰ì_block_dúty
(cuº˘Ã->ˇche, 
cuº
, &
disksim
->
d⁄efunc_˘Ãsm¨t_wrôe
, currctlr);

223 i‡(
cuº˘Ã
->
ho°waôîs
) {

224 
cuº
 = 
cuº˘Ã
->
ho°waôîs
->
√xt
;

225 i‡(
cuº
->
√xt
 == curr) {

226 
cuº˘Ã
->
ho°waôîs
 = 
NULL
;

228 
cuº˘Ã
->
ho°waôîs
->
√xt
 = 
cuº
->next;

230 
cuº
->
√xt
 = 
NULL
;

232 
cuº
->
time
 = 
simtime
 + ((Ëcuº->
bcou¡
 * 
cuº˘Ã
->
blkå™°ime
);

233 
	`addtoötq
((
evít
 *Ë
cuº
);

235 
cuº˘Ã
->
ho°å™s„r
 = 
FALSE
;

237 
	}
}

240 
	$c⁄åﬁÀr_sm¨t_ho°_d©a_å™s„r
 (*
d⁄efun˝¨am
, 
i‹eq_evít
 *
cuº
)

242 
c⁄åﬁÀr
 *
cuº˘Ã
 = 
d⁄efun˝¨am
;

246 
cuº
->
ty≥
 = 
CONTROLLER_DATA_TRANSFER_COMPLETE
;

247 
cuº
->
ãmpöt2
 = 
cuº˘Ã
->
˘ o
;

248 
cuº
->
ãmµå1
 = 
NULL
;

250 i‡(
cuº˘Ã
->
ho°å™s„r
) {

251 i‡(
cuº˘Ã
->
ho°waôîs
) {

252 
cuº
->
√xt
 = 
cuº˘Ã
->
ho°waôîs
->next;

253 
cuº˘Ã
->
ho°waôîs
->
√xt
 = 
cuº
;

255 
cuº
->
√xt
 = curr;

257 
cuº˘Ã
->
ho°waôîs
 = 
cuº
;

261 
cuº
->
time
 = 
simtime
 + ((Ëcuº->
bcou¡
 * 
cuº˘Ã
->
blkå™°ime
);

262 
cuº˘Ã
->
ho°å™s„r
 = 
TRUE
;

263 
	`addtoötq
((
evít
 *Ë
cuº
);

264 
	}
}

267 
	$c⁄åﬁÀr_sm¨t_ªque°_¨rive
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

275 
cuº˘Ã
->
ˇche
->
	`ˇche_gë_block
(cuº˘Ã->ˇche, 
cuº
, &
disksim
->
d⁄efunc_˘Ãsm¨t_ªad
, currctlr);

276 
	}
}

279 
	$c⁄åﬁÀr_sm¨t_ac˚ss_com∂ëe
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

281 
ioq
 *
queue
 = 
cuº˘Ã
->
devi˚s
[
cuº
->
devno
].queue;

282 
i‹eq_evít
 *
d⁄e
 = 
	`i‹eq_c›y
(
cuº
);

283 
devno
 = 
cuº
->devno;

284 
numout
;

288 
d⁄e
->
ty≥
 = 
IO_INTERRUPT_COMPLETE
;

289 
cuº˘Ã
->
outbusow√d
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(cuº˘Ã, 
d⁄e
, 
NULL
);

290 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
d⁄e
, cuº˘Ã->
ovrhd_disk_com∂ëe
);

291 
cuº˘Ã
->
outbusow√d
 = -1;

295 
cuº
 = 
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
queue
, curr);

296 (
d⁄e
 = 
cuº
)) {

297 
cuº
 = cuº->
√xt
;

299 
	`c⁄åﬁÀr_sm¨t_wakeup
(
cuº˘Ã
, cuº˘Ã->
ˇche
->
	`ˇche_disk_ac˚ss_com∂ëe
(cuº˘Ã->ˇche, 
d⁄e
));

304 
numout
 = 
	`ioqueue_gë_ªqout°™dög
(
queue
);

305 i‡((
numout
 < 
cuº˘Ã
->
devi˚s
[
devno
].
maxout°™dög
Ë&& (
cuº
 = 
	`ioqueue_gë_√xt_ªque°
(
queue
))) {

306 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_disk_ªque°
);

308 
	}
}

311 
	$c⁄åﬁÀr_sm¨t_ªady_to_å™s„r
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

313 
cuº
->
ty≥
 = 
IO_INTERRUPT_COMPLETE
;

314 
cuº
->
ˇu£
 = 
RECONNECT
;

315 
cuº˘Ã
->
outbusow√d
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(cuº˘Ã, 
cuº
, 
NULL
);

316 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_disk_ªady
);

317 
cuº˘Ã
->
outbusow√d
 = -1;

318 
	}
}

321 
	$c⁄åﬁÀr_sm¨t_disc⁄√˘
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

323 
cuº
->
ty≥
 = 
IO_INTERRUPT_COMPLETE
;

324 
cuº˘Ã
->
outbusow√d
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(cuº˘Ã, 
cuº
, 
NULL
);

325 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_disk_disc⁄√˘
);

326 
cuº˘Ã
->
outbusow√d
 = -1;

327 
	}
}

330 
	$c⁄åﬁÀr_sm¨t_ªc⁄√˘_to_å™s„r
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

332 
cuº
->
ty≥
 = 
IO_INTERRUPT_COMPLETE
;

333 
cuº˘Ã
->
outbusow√d
 = 
	`c⁄åﬁÀr_gë_downw¨d_bu¢o
(cuº˘Ã, 
cuº
, 
NULL
);

334 
	`c⁄åﬁÀr_£nd_evít_down_∑th
(
cuº˘Ã
, 
cuº
, cuº˘Ã->
ovrhd_disk_ªc⁄√˘
);

335 
cuº˘Ã
->
outbusow√d
 = -1;

336 
	}
}

339 
	$c⁄åﬁÀr_sm¨t_öãºu±_¨rive
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

341 
cuº
->
ˇu£
) {

343 
COMPLETION
:

344 
	`c⁄åﬁÀr_sm¨t_ac˚ss_com∂ëe
(
cuº˘Ã
, 
cuº
);

347 
RECONNECT
:

348 
	`c⁄åﬁÀr_sm¨t_ªc⁄√˘_to_å™s„r
(
cuº˘Ã
, 
cuº
);

351 
DISCONNECT
:

352 
	`c⁄åﬁÀr_sm¨t_disc⁄√˘
(
cuº˘Ã
, 
cuº
);

355 
READY_TO_TRANSFER
:

356 
	`c⁄åﬁÀr_sm¨t_ªady_to_å™s„r
(
cuº˘Ã
, 
cuº
);

360 
	`Ârötf
(
°dîr
, "Unknow¿öãºu± cau£ i¿sm¨t_öãºu±_¨rive: %d\n", 
cuº
->
ˇu£
);

361 
	`exô
(1);

363 
	}
}

366 
	$c⁄åﬁÀr_sm¨t_öãºu±_com∂ëe
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

368 
cuº
->
ˇu£
) {

370 
COMPLETION
:

371 
	`addt€xåaq
((
evít
 *Ë
cuº
);

375 
	`Ârötf
(
°dîr
, "Unknow¿öãºu± cau£ i¿sm¨t_öãºu±_com∂ëe: %d\n", 
cuº
->
ˇu£
);

376 
	`exô
(1);

378 
	}
}

381 
	$c⁄åﬁÀr_sm¨t_evít_¨rive
 (
c⁄åﬁÀr
 *
cuº˘Ã
, 
i‹eq_evít
 *
cuº
)

383 
cuº
->
ty≥
) {

385 
IO_ACCESS_ARRIVE
:

386 
	`c⁄åﬁÀr_sm¨t_ªque°_¨rive
(
cuº˘Ã
, 
cuº
);

389 
IO_INTERRUPT_ARRIVE
:

390 
	`c⁄åﬁÀr_sm¨t_öãºu±_¨rive
(
cuº˘Ã
, 
cuº
);

393 
IO_INTERRUPT_COMPLETE
:

394 
	`c⁄åﬁÀr_sm¨t_öãºu±_com∂ëe
(
cuº˘Ã
, 
cuº
);

397 
DEVICE_DATA_TRANSFER_COMPLETE
:

398 
	`c⁄åﬁÀr_sm¨t_disk_d©a_å™s„r
(
cuº˘Ã
, 
cuº
);

401 
CONTROLLER_DATA_TRANSFER_COMPLETE
:

402 i‡(
cuº
->
ãmµå1
) {

403 
	`c⁄åﬁÀr_sm¨t_disk_d©a_å™s„r_com∂ëe
(
cuº˘Ã
, 
cuº
);

405 
	`c⁄åﬁÀr_sm¨t_ho°_d©a_å™s„r_com∂ëe
(
cuº˘Ã
, 
cuº
);

409 
IO_QLEN_MAXCHECK
:

410 
cuº
->
ãmpöt1
 = 
cuº˘Ã
->
˘ o
;

411 
cuº
->
ãmpöt2
 = 
cuº˘Ã
->
maxout°™dög
;

412 
cuº
->
bcou¡
 = 
cuº˘Ã
->
ˇche
->
	`ˇche_gë_maxªqsize
(currctlr->cache);

416 
	`Ârötf
(
°dîr
, "Unknow¿evíàty≥áºivögáà53c700 c⁄åﬁÀr: %d\n", 
cuº
->
ty≥
);

417 
	`exô
(1);

419 
	}
}

422 
	$c⁄åﬁÀr_sm¨t_£tˇŒbacks
 ()

424 
disksim
->
issuefunc_˘Ãsm¨t
 = 
c⁄åﬁÀr_sm¨t_issue_ac˚ss
;

425 
disksim
->
queueföd_˘Ãsm¨t
 = 
c⁄åﬁÀr_sm¨t_queueföd
;

426 
disksim
->
wakeupfunc_˘Ãsm¨t
 = 
c⁄åﬁÀr_sm¨t_wakeup
;

427 
disksim
->
d⁄efunc_˘Ãsm¨t_ªad
 = 
c⁄åﬁÀr_sm¨t_ho°_d©a_å™s„r
;

428 
disksim
->
d⁄efunc_˘Ãsm¨t_wrôe
 = 
c⁄åﬁÀr_sm¨t_ªque°_com∂ëe
;

429 
	`ioqueue_£tˇŒbacks
 ();

430 
	`ˇche_£tˇŒbacks
 ();

431 
	}
}

434 
	$c⁄åﬁÀr_sm¨t_öôülize
 (
c⁄åﬁÀr
 *
cuº˘Ã
)

436 
numdevs
 = 
	`devi˚_gë_numdevi˚s
();

437 
devi˚
 *
cuºdev
;

438 
i
;

440 
	`c⁄åﬁÀr_sm¨t_£tˇŒbacks
 ();

441 
cuº˘Ã
->
numdevi˚s
 = 
numdevs
;

442 
cuº˘Ã
->
devi˚s
 = (
devi˚
 *Ë
	`DISKSIM_mÆloc
(
numdevs
 * (device));

443 
	`ASSERT
(
cuº˘Ã
->
devi˚s
 !
NULL
);

444 
i
=0; i<
numdevs
; i++) {

445 
cuºdev
 = &
cuº˘Ã
->
devi˚s
[
i
];

446 
cuºdev
->
devno
 = 
i
;

447 
cuºdev
->
busy
 = 
FALSE
;

448 
cuºdev
->
Êag
 = 0;

449 
cuºdev
->
queue
 = 
	`ioqueue_c›y
(
cuº˘Ã
->queue);

450 
	`ioqueue_öôülize
(
cuºdev
->
queue
, 
i
);

451 
	`iosim_gë_∑th_to_devi˚
 (0, 
i
, &
cuºdev
->
bu•©h
, &cuºdev->
¶Ÿ∑th
);

452 
cuºdev
->
maxout°™dög
 = 
cuº˘Ã
->
maxdiskqsize
;

454 
cuº˘Ã
->
ˇche
->
	`ˇche_öôülize
(cuº˘Ã->ˇche, &
disksim
->
issuefunc_˘Ãsm¨t
, cuº˘Ã, &disksim->
queueföd_˘Ãsm¨t
, cuº˘Ã, &disksim->
wakeupfunc_˘Ãsm¨t
, cuº˘Ã, 
numdevs
);

455 
	}
}

458 
	$c⁄åﬁÀr_sm¨t_ª£t°©s
 (
c⁄åﬁÀr
 *
cuº˘Ã
)

460 
numdevs
 = 
	`devi˚_gë_numdevi˚s
();

461 
i
;

463 
i
=0; i<
numdevs
; i++) {

464 
	`ioqueue_ª£t°©s
(
cuº˘Ã
->
devi˚s
[
i
].
queue
);

466 
cuº˘Ã
->
ˇche
->
	`ˇche_ª£t°©s
(currctlr->cache);

467 
	}
}

472 
	$c⁄åﬁÀr_sm¨t_¥öt°©s
 (
c⁄åﬁÀr
 *
cuº˘Ã
, *
¥efix
)

474 
˘Ãöfo_t
 *
˘Ãöfo
 = 
disksim
->ctlrinfo;

475 
devno
;

476 
dev¥efix
[181];

477 
ioq
 **
queue£t
 = 
	`DISKSIM_mÆloc
 (
cuº˘Ã
->
numdevi˚s
 * (*));

479 i‡(
˘Ãöfo
->
˘l_¥ötˇche°©s
) {

480 
cuº˘Ã
->
ˇche
->
	`ˇche_¥öt°©s
(cuº˘Ã->ˇche, 
¥efix
);

483 
devno
=0; devno<
cuº˘Ã
->
numdevi˚s
; devno++) {

484 
queue£t
[
devno
] = 
cuº˘Ã
->
devi˚s
[devno].
queue
;

486 
	`•rötf
 (
dev¥efix
, "%sdevi˚†", 
¥efix
);

487 
	`ioqueue_¥öt°©s
 (
queue£t
, 
cuº˘Ã
->
numdevi˚s
, 
dev¥efix
);

489 i‡((
˘Ãöfo
->
˘l_¥öçîdisk°©s
Ë&& (
cuº˘Ã
->
numdevi˚s
 > 1)) {

490 
devno
=0; devno<
cuº˘Ã
->
numdevi˚s
; devno++) {

491 
ioq
 *
queue
 = 
cuº˘Ã
->
devi˚s
[
devno
].queue;

492 i‡(
	`ioqueue_gë_numbî_of_ªque°s
(
queue
)) {

493 
	`•rötf
(
dev¥efix
, "%sdevi˚ #%d ", 
¥efix
, 
devno
);

494 
	`ioqueue_¥öt°©s
(&
queue
, 1, 
dev¥efix
);

498 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_device.c

58 
	~"disksim_globÆ.h
"

59 
	~"disksim_iosim.h
"

60 
	~"disksim_devi˚.h
"

61 
	~"disksim_disk.h
"

62 
	~"disksim_sim∂edisk.h
"

63 
	~"memsmodñ/mems_globÆ.h
"

64 
	~"memsmodñ/mems_disksim.h
"

65 
	~"ssdmodñ/ssd.h
"

66 
	~"c⁄fig.h
"

68 
	~"moduÀs/moduÀs.h
"

82 
	#numdevi˚s
 (
disksim
->
devi˚öfo
->
numdevi˚s
)

	)

84 
	#devi˚ty≥s
 (
disksim
->
devi˚öfo
->
devi˚ty≥s
)

	)

86 
	#devi˚nos
 (
disksim
->
devi˚öfo
->
devi˚nos
)

	)

88 
	#maxdevi˚no
 (
disksim
->
devi˚öfo
->
maxdevi˚no
)

	)

91 
devi˚_hódî
 *

92 
	$gëdevby«me
(*
«me
,

93 *
gdevnum
,

94 *
ldevnum
,

95 *
ty≥
)

97 
c
;

98 
c
 = 0; c < 
disksim
->
devi˚öfo
->
devs_Àn
; c++) {

99 if(!
disksim
->
devi˚öfo
->
devi˚«mes
[
c
]) ;

100 if(!
	`°rcmp
(
«me
, 
disksim
->
devi˚öfo
->
devi˚«mes
[
c
])) {

102 if(
gdevnum
Ë*gdevnum = 
c
;

103 if(
ldevnum
Ë*ldevnum = 
devi˚nos
[
c
];

104 if(
ty≥
Ë*ty≥ = 
devi˚ty≥s
[
c
];

105 
devi˚ty≥s
[
c
]) {

106 
DEVICETYPE_DISK
:

107  (
devi˚_hódî
 *)
	`gëdisk
(
devi˚nos
[
c
]);

109 
DEVICETYPE_SIMPLEDISK
:

110  (
devi˚_hódî
 *)
	`gësim∂edisk
(
devi˚nos
[
c
]);

112 
DEVICETYPE_MEMS
:

113  (
devi˚_hódî
 *)
	`gëmems
(
devi˚nos
[
c
]);

115 
DEVICETYPE_SSD
:

116  (
devi˚_hódî
 *)
	`gëssd
(
devi˚nos
[
c
]);

122 
	}
}

124 
	$devi˚_öôülize_devi˚öfo
 ()

126 i‡(
disksim
->
devi˚öfo
 =
NULL
) {

127 
disksim
->
devi˚öfo
 = 
	`mÆloc
 ((
devi˚_öfo_t
));

128 
	`bzîo
 ((*)
disksim
->
devi˚öfo
, (
devi˚_öfo_t
));

130 
	}
}

132 
	$devi˚_add
(
devi˚_hódî
 *
d
, 
ldevno
) {

133 
c
, 
√wÀn
;

134 
zîo˙t
;

135 
	`devi˚_öôülize_devi˚öfo
();

137 
c
 = 0; c < 
disksim
->
devi˚öfo
->
devs_Àn
; c++) {

138 if(!
disksim
->
devi˚öfo
->
devi˚«mes
[
c
]) {

139 
found¶Ÿ
;

144 
√wÀn
 = 
numdevi˚s
 ? (2 *Çumdevices) : 2;

145 
zîo˙t
 = (
√wÀn
 == 2) ? 2 : (newlen/2);

146 
disksim
->
devi˚öfo
->
devi˚«mes
 =

147 
	`ªÆloc
(
disksim
->
devi˚öfo
->
devi˚«mes
, 
√wÀn
 * (*));

148 
	`bzîo
(
disksim
->
devi˚öfo
->
devi˚«mes
 + 
c
, 
zîo˙t
 * (*));

150 
devi˚nos
 = 
	`ªÆloc
(devi˚nos, 
√wÀn
*());

151 #i‚de‡
WIN32


152 
	`bzîo
(
devi˚nos
 + 
c
, 
zîo˙t
 * ());

154 
	`bzîo
(
devi˚nos
 + 
c
, 
zîo˙t
 * (*(devicenos)));

157 
devi˚ty≥s
 = 
	`ªÆloc
(devi˚ty≥s, 
√wÀn
*());

158 #i‚de‡
WIN32


159 
	`bzîo
(
devi˚ty≥s
 + 
c
, 
zîo˙t
 * ());

161 
	`bzîo
(
devi˚ty≥s
 + 
c
, 
zîo˙t
 * (*(devicetypes)));

164 
disksim
->
devi˚öfo
->
devi˚s
 = 
	`ªÆloc
(disksim->deviceinfo->devices,

165 
√wÀn
*());

166 #i‚de‡
WIN32


167 
	`bzîo
(
disksim
->
devi˚öfo
->
devi˚s
 + 
c
, 
zîo˙t
 * ());

169 
	`bzîo
(
disksim
->
devi˚öfo
->
devi˚s
 + 
c
, 
zîo˙t
 * (*(disksim->deviceinfo->devices)));

172 
disksim
->
devi˚öfo
->
devs_Àn
 = 
√wÀn
;

174 
found¶Ÿ
:

175 
disksim
->
devi˚öfo
->
devi˚«mes
[
c
] = 
d
->
devi˚_«me
;

176 
devi˚ty≥s
[
c
] = 
d
->
devi˚_ty≥
;

177 
devi˚nos
[
c
] = 
ldevno
;

178 if(
maxdevi˚no
[
devi˚ty≥s
[
c
]] < 
devi˚nos
[c]) {

179 
maxdevi˚no
[
devi˚ty≥s
[
c
]] = 
devi˚nos
[c];

181 
disksim
->
devi˚öfo
->
devi˚s
[
c
] = 
d
;

183 
numdevi˚s
++;

184 
	}
}

188 
	$disksim_devi˚_°©s_lﬂd∑øms
(
Õ_block
 *
b
) {

190 
	`devi˚_öôülize_devi˚öfo
();

195 
	`Õ_lﬂd∑øms
(0, 
b
, &
disksim_devi˚_°©s_mod
);

201 
	}
}

207 
	$devi˚_£tˇŒbacks
 ()

210 
	`disk_£tˇŒbacks
 ();

211 
	`sim∂edisk_£tˇŒbacks
 ();

213 
	`Ârötf
(
°dîr
,"Warning: mems checkpointingÇot supported (yet)!\n");

214 
	}
}

217 
	$devi˚_öôülize
 ()

220 
	`disk_öôülize
 ();

221 
	`sim∂edisk_öôülize
 ();

222 
	`mems_öôülize
 ();

223 
	`ssd_öôülize
 ();

224 
	}
}

226 
	$devi˚_ª£t°©s
 ()

229 
	`disk_ª£t°©s
 ();

230 
	`sim∂edisk_ª£t°©s
 ();

231 
	`mems_ª£t°©s
 ();

232 
	`ssd_ª£t°©s
 ();

233 
	}
}

236 
	$devi˚_¥öt°©s
 ()

239 
	`disk_¥öt°©s
 ();

240 
	`sim∂edisk_¥öt°©s
 ();

241 
	`mems_¥öt°©s
 ();

242 
	`ssd_¥öt°©s
 ();

243 
	}
}

246 
	$devi˚_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
)

248 
i
;

249 
devi˚ty≥
 = 
devi˚ty≥s
[
£t
[0]];

252 
i
=0; i<
£tsize
; i++) {

253 i‡(
devi˚ty≥s
[
£t
[
i
]] !
devi˚ty≥
) {

263 
devi˚ty≥
) {

264 
DEVICETYPE_DISK
:

265 
	`disk_¥öt£t°©s
 (
£t
, 
£tsize
, 
sour˚°r
);

267 
DEVICETYPE_SIMPLEDISK
:

268 
	`sim∂edisk_¥öt£t°©s
 (
£t
, 
£tsize
, 
sour˚°r
);

270 
DEVICETYPE_MEMS
:

271 
	`mems_¥öt£t°©s
 (
£t
, 
£tsize
, 
sour˚°r
);

273 
DEVICETYPE_SSD
:

274 
	`ssd_¥öt£t°©s
 (
£t
, 
£tsize
, 
sour˚°r
);

277 
	`Ârötf
(
°dîr
, "Unknow¿vÆuêf‹ devi˚Åy≥: devi˚ty≥ %d\n", 
devi˚ty≥
);

278 
	`as£π
(0);

280 
	}
}

283 
	$devi˚_˛ón°©s
 ()

286 
	`disk_˛ón°©s
 ();

287 
	`sim∂edisk_˛ón°©s
 ();

288 
	`mems_˛ón°©s
 ();

289 
	}
}

292 
INLINE
 
	$devi˚_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
)

294 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

295  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`£t_dïth
(
devi˚nos
[devno], 
öbu¢o
, 
dïth
, 
¶Ÿno
);

296 
	}
}

299 
INLINE
 
	$devi˚_gë_dïth
 (
devno
)

301 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

302  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_dïth
(devno);

303 
	}
}

306 
INLINE
 
	$devi˚_gë_öbus
 (
devno
)

308 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

309  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_öbus
(devno);

310 
	}
}

313 
INLINE
 
	$devi˚_gë_bu¢o
 (
i‹eq_evít
 *
cuº
)

315 
	`ASSERT1
 ((
cuº
->
devno
 >0Ë&& (cuº->devnÿ< 
numdevi˚s
), "curr->devno", curr->devno);

316  
disksim
->
devi˚öfo
->
devi˚s
[
cuº
->
devno
]->
	`gë_bu¢o
(curr);

317 
	}
}

320 
INLINE
 
	$devi˚_gë_¶Ÿno
 (
devno
)

322 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

323  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_¶Ÿno
(devno);

324 
	}
}

327 
INLINE
 
	$devi˚_gë_numbî_of_blocks
 (
devno
)

329 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

330  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_numbî_of_blocks
(devno);

331 
	}
}

334 
INLINE
 
	$devi˚_gë_maxout°™dög
 (
devno
)

336 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

337  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_maxout°™dög
(devno);

338 
	}
}

341 
	$devi˚_gë_numdevi˚s
 ()

343  ( 
numdevi˚s
 );

344 
	}
}

347 
INLINE
 
	$devi˚_gë_numcyls
 (
devno
)

349 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

350  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_numcyls
(devno);

351 
	}
}

354 
INLINE
 
	$devi˚_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
)

356 
	`ASSERT1
 ((
cuº
->
devno
 >0Ë&& (cuº->devnÿ< 
numdevi˚s
), "curr->devno", curr->devno);

357  
disksim
->
devi˚öfo
->
devi˚s
[
cuº
->
devno
]->
	`gë_blkå™°ime
(curr);

358 
	}
}

361 
INLINE
 
	$devi˚_gë_avg_£˘≥rcyl
 (
devno
)

363 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

364  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_avg_£˘≥rcyl
(devno);

365 
	}
}

368 
INLINE
 
	$devi˚_gë_m≠pög
 (
m≠ty≥
,

369 
devno
,

370 
blkno
,

371 *
cyÕå
,

372 *
surÁ˚±r
,

373 *
blk±r
)

375 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

376  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_m≠pög
(
m≠ty≥
,

377 
devno
,

378 
blkno
,

379 
cyÕå
,

380 
surÁ˚±r
,

381 
blk±r
);

382 
	}
}

385 
INLINE
 
	$devi˚_evít_¨rive
 (
i‹eq_evít
 *
cuº
)

387 
	`ASSERT1
 ((
cuº
->
devno
 >0Ë&& (cuº->devnÿ< 
numdevi˚s
), "curr->devno", curr->devno);

388  
disksim
->
devi˚öfo
->
devi˚s
[
cuº
->
devno
]->
	`evít_¨rive
(curr);

389 
	}
}

392 
INLINE
 
	$devi˚_gë_di°™˚
 (
devno
,

393 
i‹eq_evít
 *
ªq
,

394 
exa˘
,

395 
dúe˘i⁄
)

397 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

398  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_di°™˚
(devno,

399 
ªq
,

400 
exa˘
,

401 
dúe˘i⁄
);

402 
	}
}

405 
INLINE
 
	$devi˚_gë_£rvtime
 (
devno
,

406 
i‹eq_evít
 *
ªq
,

407 
checkˇche
,

408 
maxtime
)

410 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

411  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_£rvtime
(devno,

412 
ªq
,

413 
checkˇche
,

414 
maxtime
);

415 
	}
}

417 
	$devi˚_gë_£ektime
 (
devno
,

418 
i‹eq_evít
 *
ªq
,

419 
checkˇche
,

420 
maxtime
)

422 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

424  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_£ektime
(devno,

425 
ªq
,

426 
checkˇche
,

427 
maxtime
);

428 
	}
}

431 
INLINE
 
	$devi˚_gë_ac˘ime
 (
devno
,

432 
i‹eq_evít
 *
ªq
,

433 
maxtime
)

435 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

437  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`gë_ac˘ime
(devno,

438 
ªq
,

439 
maxtime
);

440 
	}
}

443 
INLINE
 
	$devi˚_bus_dñay_com∂ëe
 (
devno
,

444 
i‹eq_evít
 *
cuº
,

445 
£¡bu¢o
)

447 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

448  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`bus_dñay_com∂ëe
(devno,

449 
cuº
,

450 
£¡bu¢o
);

451 
	}
}

454 
INLINE
 
	$devi˚_bus_ow√rshù_gø¡
 (
devno
,

455 
i‹eq_evít
 *
cuº
,

456 
bu¢o
,

457 
¨bdñay
)

459 
	`ASSERT1
 ((
devno
 >0Ë&& (devnÿ< 
numdevi˚s
), "devno", devno);

460  
disksim
->
devi˚öfo
->
devi˚s
[
devno
]->
	`bus_ow√rshù_gø¡
(devno,

461 
cuº
,

462 
bu¢o
,

463 
¨bdñay
);

464 
	}
}

467 
	$disksim_devi˚_lﬂd∑øms
() {

468 
	`ddbg_as£π2
(0, "this isá dummyÅhat isn't supposedÅo be called");

469 
	}
}

472 
	$disksim_sync£t_lﬂd∑øms
(
Õ_block
 *
b
)

475 
c
;

477 
	`u≈¨£_block
(
b
, 
ouçutfûe
);

478 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

479 if(!
b
->
∑øms
[
c
]) ;

480 if(
	`PTYPE
(
b
->
∑øms
[
c
]Ë!
S
) ;

481 if(
	`°rcmp
(
b
->
∑øms
[
c
]->
«me
, "type")) ;

483 if(!
	`°rcmp
(
	`SVAL
(
b
->
∑øms
[
c
]), "simpledisk")) {

484 
	`Ârötf
(
°dîr
, "*** warning:Ço simpledisk syncsets\n");

487 if(!
	`°rcmp
(
	`SVAL
(
b
->
∑øms
[
c
]), "disk")) {

488  
	`disk_lﬂd_sync£ts
(
b
);

490 if(!
	`°rcmp
(
	`SVAL
(
b
->
∑øms
[
c
]), "mems")) {

491 
	`Ârötf
(
°dîr
, "*** warning:Ço mems syncsets\n");

499 
	}
}

502 
INLINE
 
	$dev_m≠_devno
(
n
)

504 
	`as£π
((
n
 < 
numdevi˚s
) && (n >=0));

505  
devi˚nos
[
n
];

506 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_device.h

58 #i‚de‡
DISKSIM_DEVICE_H


59 
	#DISKSIM_DEVICE_H


	)

61 
	~"disksim_iosim.h
"

66 
	mDEVICETYPE_DISK
 = 1,

67 
	mDEVICETYPE_SIMPLEDISK
 = 2,

68 
	mDEVICETYPE_MEMS
 = 3,

69 
	mDEVICETYPE_SSD
 = 4,

74 } 
	tdevi˚_ty≥_t
;

75 
	#DEVICETYPE_MIN
 
DEVICETYPE_DISK


	)

76 
	#DEVICETYPE_MAX
 
DEVICETYPE_MEMS


	)

79 
	sdevi˚_öfo
 {

80 
	mnumdevi˚s
;

82 *
	mdevi˚ty≥s
;

86 *
	mdevi˚nos
;

88 
	mmaxdevi˚no
[
DEVICETYPE_MAX
];

92 **
	mdevi˚«mes
;

95 
devi˚_hódî
 **
	mdevi˚s
;

97 
	mdevs_Àn
;

99 
	mdevi˚_¥ötqueue°©s
;

100 
	mdevi˚_¥öt¸ô°©s
;

101 
	mdevi˚_¥ötidÀ°©s
;

102 
	mdevi˚_¥ötöèº°©s
;

103 
	mdevi˚_¥ötsize°©s
;

104 
	mdevi˚_¥öt£ek°©s
;

105 
	mdevi˚_¥öé©ícy°©s
;

106 
	mdevi˚_¥ötx„r°©s
;

107 
	mdevi˚_¥öèc˘ime°©s
;

108 
	mdevi˚_¥ötöãr„ª°©s
;

109 
	mdevi˚_¥ötbuf„r°©s
;

111 } 
	tdevi˚_öfo_t
;

114 
	gdevi˚_hódî
;

125 
	#devi˚_¥ötqueue°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥ötqueue°©s
)

	)

126 
	#devi˚_¥öt¸ô°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥öt¸ô°©s
)

	)

127 
	#devi˚_¥ötidÀ°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥ötidÀ°©s
)

	)

128 
	#devi˚_¥ötöèº°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥ötöèº°©s
)

	)

129 
	#devi˚_¥ötsize°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥ötsize°©s
)

	)

130 
	#devi˚_¥öt£ek°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥öt£ek°©s
)

	)

131 
	#devi˚_¥öé©ícy°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥öé©ícy°©s
)

	)

132 
	#devi˚_¥ötx„r°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥ötx„r°©s
)

	)

133 
	#devi˚_¥öèc˘ime°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥öèc˘ime°©s
)

	)

134 
	#devi˚_¥ötöãr„ª°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥ötöãr„ª°©s
)

	)

135 
	#devi˚_¥ötbuf„r°©s
 (
disksim
->
devi˚öfo
->
devi˚_¥ötbuf„r°©s
)

	)

141 
devi˚_£tˇŒbacks
 ();

142 
devi˚_öôülize
 ();

144 
devi˚_ª£t°©s
 ();

145 
devi˚_¥öt°©s
 ();

146 
devi˚_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
);

147 
devi˚_˛ón°©s
 ();

148 
devi˚_gë_numdevi˚s
 ();

150 
devi˚_add
(
devi˚_hódî
 *
d
, );

153 
devi˚_hódî
 *
gëdevby«me
(*
«me
,

154 *
gdevnum
,

156 *
ldevnum
,

159 *
ty≥
);

162 
INLINE
 
dev_m≠_devno
(
n
);

164 
devi˚_öôülize_devi˚öfo
();

170 
	sdevi˚_hódî
 {

171 
	mdevi˚_ty≥
;

172 
	mdevi˚_Àn
;

173 *
	mdevi˚_«me
;

174 
	mdevi˚_hódî
*(*
	mdev_c›y
)(device_header *);

176 (*
	m£t_dïth
)(
	mdiskno
, 
	möbu¢o
, 
	mdïth
, 
	m¶Ÿno
);

177 (*
	mgë_dïth
)(
	mdiskno
);

178 (*
	mgë_öbus
)(
	mdiskno
);

179 (*
	mgë_bu¢o
)(
i‹eq_evít
 *
	mcuº
);

180 (*
	mgë_¶Ÿno
)(
	mdiskno
);

183 (*
	mgë_numbî_of_blocks
)(
	mdiskno
);

184 (*
	mgë_maxout°™dög
)(
	mdiskno
);

185 (*
	mgë_numcyls
)(
	mdiskno
);

186 (*
	mgë_blkå™°ime
)(
i‹eq_evít
 *
	mcuº
);

187 (*
	mgë_avg_£˘≥rcyl
)(
	mdevno
);

189 (*
	mgë_m≠pög
)(
	mm≠ty≥
,

190 
	mdiskno
,

191 
	mblkno
,

192 *
	mcyÕå
,

193 *
	msurÁ˚±r
,

194 *
	mblk±r
);

196 (*
	mevít_¨rive
)(
i‹eq_evít
 *
	mcuº
);

198 (*
	mgë_di°™˚
)(
	mdiskno
,

199 
i‹eq_evít
 *
	mªq
,

200 
	mexa˘
,

201 
	mdúe˘i⁄
);

203 (*
	mgë_£rvtime
)(
	mdiskno
,

204 
i‹eq_evít
 *
	mªq
,

205 
	mcheckˇche
,

206 
	mmaxtime
);

209 (*
	mgë_£ektime
)(
	mdiskno
,

210 
i‹eq_evít
 *
	mªq
,

211 
	mcheckˇche
,

212 
	mmaxtime
);

214 (*
	mgë_ac˘ime
)(
	mdiskno
,

215 
i‹eq_evít
 *
	mªq
,

216 
	mmaxtime
);

218 (*
	mbus_dñay_com∂ëe
)(
	mdevno
,

219 
i‹eq_evít
 *
	mcuº
,

220 
	m£¡bu¢o
);

222 (*
	mbus_ow√rshù_gø¡
)(
	mdevno
,

223 
i‹eq_evít
 *
	mcuº
,

224 
	mbu¢o
,

225 
	m¨bdñay
);

230 
devi˚_£t_dïth
 (
diskno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
);

231 
devi˚_gë_dïth
 (
diskno
);

232 
devi˚_gë_öbus
 (
diskno
);

233 
devi˚_gë_bu¢o
 (
i‹eq_evít
 *
cuº
);

234 
devi˚_gë_¶Ÿno
 (
diskno
);

237 
devi˚_gë_numbî_of_blocks
 (
diskno
);

238 
devi˚_gë_maxout°™dög
 (
diskno
);

239 
devi˚_gë_numcyls
 (
diskno
);

240 
devi˚_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
);

241 
devi˚_gë_avg_£˘≥rcyl
 (
devno
);

243 
devi˚_gë_m≠pög
 (
m≠ty≥
,

244 
diskno
,

245 
blkno
,

246 *
cyÕå
,

247 *
surÁ˚±r
,

248 *
blk±r
);

250 
devi˚_evít_¨rive
 (
i‹eq_evít
 *
cuº
);

252 
devi˚_gë_di°™˚
 (
diskno
,

253 
i‹eq_evít
 *
ªq
,

254 
exa˘
,

255 
dúe˘i⁄
);

257 
devi˚_gë_£rvtime
 (
diskno
,

258 
i‹eq_evít
 *
ªq
,

259 
checkˇche
,

260 
maxtime
);

263 
devi˚_gë_£ektime
 (
diskno
,

264 
i‹eq_evít
 *
ªq
,

265 
checkˇche
,

266 
maxtime
);

268 
devi˚_gë_ac˘ime
 (
diskno
,

269 
i‹eq_evít
 *
ªq
,

270 
maxtime
);

272 
devi˚_bus_dñay_com∂ëe
 (
devno
,

273 
i‹eq_evít
 *
cuº
,

274 
£¡bu¢o
);

276 
devi˚_bus_ow√rshù_gø¡
 (
devno
,

277 
i‹eq_evít
 *
cuº
,

278 
bu¢o
,

279 
¨bdñay
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_disk.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_iosim.h
"

103 
	~"disksim_°©.h
"

104 
	~"disksim_disk.h
"

105 
	~"disksim_ioqueue.h
"

106 
	~"c⁄fig.h
"

108 
	~"moduÀs/moduÀs.h
"

110 
disk_öôülize_disköfo
 ();

113 *
	g°©desc_£ekdi°°©s
 = "Seek distance";

114 *
	g°©desc_£ektime°©s
 = "SeekÅime";

115 *
	g°©desc_rŸœt°©s
 = "RotationalÜatency";

116 *
	g°©desc_x„πime°©s
 = "TransferÅime";

117 *
	g°©desc_po°ime°©s
 = "PositioningÅime";

118 *
	g°©desc_ac˘ime°©s
 = "AccessÅime";

121 
INLINE
 
disk
 *
	$gëdisk
 (
diskno
)

123 
disk
 *
cuºdisk
;

124 
	`ASSERT1
((
diskno
 >0Ë&& (disknÿ< 
MAXDEVICES
), "diskno", diskno);

125 
cuºdisk
 = 
disksim
->
disköfo
->
disks
[
diskno
];

126 i‡(!
cuºdisk
) {

129  (
cuºdisk
);

130 
	}
}

133 
	$disk_add
(
disk
 *
d
) {

134 
c
;

136 if(!
disksim
->
disköfo
Ë
	`disk_öôülize_disköfo
();

138 
c
 = 0; c < 
disksim
->
disköfo
->
disks_Àn
; c++) {

139 if(!
disksim
->
disköfo
->
disks
[
c
]) {

140 
disksim
->
disköfo
->
disks
[
c
] = 
d
;

141 
NUMDISKS
++;

142  
c
;

147 
disksim
->
disköfo
->
disks
 = 
	`ªÆloc
(disksim->diskinfo->disks,

148 2 * 
NUMDISKS
 * (
disk
 *));

149 
	`bzîo
(
disksim
->
disköfo
->
disks
 + 
NUMDISKS
, NUMDISKS);

150 
disksim
->
disköfo
->
disks
[
c
] = 
d
;

151 
NUMDISKS
++;

152 
disksim
->
disköfo
->
disks_Àn
 *= 2;

153  
c
;

154 
	}
}

157 
	$disk_gë_numdisks
 ()

159 (
NUMDISKS
);

160 
	}
}

163 
	$disk_˛ón°©s
 ()

165 
i
;

167 
i
=0; i<
MAXDEVICES
; i++) {

168 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
i
);

169 i‡(
cuºdisk
) {

170 
	`ioqueue_˛ón°©s
(
cuºdisk
->
queue
);

173 
	}
}

179 
	$disk°©öô
 (
diskno
, 
fú°time
)

181 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
diskno
);

182 
disk°©
 *
°©
 = &
cuºdisk
->stat;

184 i‡(
fú°time
) {

185 
	`°©_öôülize
(
°©deffûe
, 
°©desc_£ekdi°°©s
, &
°©
->
£ekdi°°©s
);

186 
	`°©_öôülize
(
°©deffûe
, 
°©desc_£ektime°©s
, &
°©
->
£ektime°©s
);

187 
	`°©_öôülize
(
°©deffûe
, 
°©desc_rŸœt°©s
, &
°©
->
rŸœt°©s
);

188 
	`°©_öôülize
(
°©deffûe
, 
°©desc_x„πime°©s
, &
°©
->
x„πime°©s
);

189 
	`°©_öôülize
(
°©deffûe
, 
°©desc_po°ime°©s
, &
°©
->
po°ime°©s
);

190 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ac˘ime°©s
, &
°©
->
ac˘ime°©s
);

193 
	`°©_ª£t
(&
°©
->
£ekdi°°©s
);

194 
	`°©_ª£t
(&
°©
->
£ektime°©s
);

195 
	`°©_ª£t
(&
°©
->
rŸœt°©s
);

196 
	`°©_ª£t
(&
°©
->
x„πime°©s
);

197 
	`°©_ª£t
(&
°©
->
po°ime°©s
);

198 
	`°©_ª£t
(&
°©
->
ac˘ime°©s
);

201 
°©
->
highblkno
 = 0;

202 
°©
->
zîo£eks
 = 0;

203 
°©
->
zîﬁ©ícy
 = 0;

204 
°©
->
wrôecombs
 = 0;

205 
°©
->
ªadmis£s
 = 0;

206 
°©
->
wrôemis£s
 = 0;

207 
°©
->
fuŒªadhôs
 = 0;

208 
°©
->
≠≥ndhôs
 = 0;

209 
°©
->
¥ïídhôs
 = 0;

210 
°©
->
ªadöghôs
 = 0;

211 
°©
->
ruƒódögsize
 = 0.0;

212 
°©
->
ªmªadögsize
 = 0.0;

213 
°©
->
∑πhôs
 = 0;

214 
°©
->
ru≈¨tsize
 = 0.0;

215 
°©
->
ªm∑πsize
 = 0.0;

216 
°©
->
öãr„ª
[0] = 0;

217 
°©
->
öãr„ª
[1] = 0;

218 
°©
->
ªque°edbus
 = 0.0;

219 
°©
->
waôögf‹bus
 = 0.0;

220 
°©
->
numbuswaôs
 = 0;

221 
	}
}

224 
	$disk_sync£t_öô
 ()

226 
i
, 
j
;

227 
syn˚d
[128];

229 
i
 = 1; i <
numsync£ts
; i++) {

230 
syn˚d
[
i
] = 0;

233 
i
 = 0; i < 
MAXDEVICES
; i++) {

234 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
i
);

235 if(!
cuºdisk
) {

239 
cuºdisk
->
modñ
->
mech
->
	`dm_øndomize_Ωm
(currdisk->model);

242 if(
cuºdisk
->
sync£t
 == 0) {

245 if((
cuºdisk
->
sync£t
 > 0) &&

246 (
syn˚d
[(
cuºdisk
->
sync£t
)] == 0))

248 
j
 = 
i
; j < 
MAXDEVICES
; j++) {

249 
disk
 *
cuºdisk2
 = 
	`gëdisk
(
j
);

250 if(!
cuºdisk2
) ;

252 i‡(
cuºdisk2
->
sync£t
 =
cuºdisk
->syncset) {

253 
cuºdisk2
->
mech_°©e
.
thëa
 = 
cuºdisk
->mech_state.theta;

256 
syn˚d
[(
cuºdisk
->
sync£t
)] = 1;

259 
	}
}

262 
	$disk_po°∑ss_≥rdisk
 (
disk
 *
cuºdisk
)

264 i‡((
cuºdisk
->
c⁄åód
Ë&& (cuºdisk->
íabÀˇche
 =
FALSE
)) {

265 
	`Ârötf
(
°dîr
, "MakesÇo senseÅo useÑead-ahead butÇot use caching\n");

266 
	`ddbg_as£π
(0);;

269 i‡((
cuºdisk
->
c⁄åód
 =
BUFFER_NO_READ_AHEAD
) &&

270 (
cuºdisk
->
möªadahód
 > 0)) {

272 
cuºdisk
->
möªadahód
 = 0;

275 i‡((
cuºdisk
->
maxªadahód
 < cuºdisk->
möªadahód
) ||

276 ((
cuºdisk
->
c⁄åód
 =
BUFFER_NO_READ_AHEAD
) &&

277 (
cuºdisk
->
maxªadahód
 > 0))) {

279 
cuºdisk
->
maxªadahód
 = cuºdisk->
möªadahód
;

282 i‡(
cuºdisk
->
kì¥eque°d©a
 >= 0) {

283 
cuºdisk
->
kì¥eque°d©a
 = 
	`abs
(currdisk->keeprequestdata - 1);

286 i‡((
cuºdisk
->
ªad™y‰ìblocks
 !
FALSE
) &&

287 (
cuºdisk
->
íabÀˇche
 =
FALSE
)) {

288 
	`Ârötf
(
°dîr
, "MakesÇo senseÅoÑead blocks with caching disabled\n");

289 
	`ddbg_as£π
(0);;

292 i‡((
cuºdisk
->
Á°wrôes
Ë&& (cuºdisk->
íabÀˇche
 =
FALSE
)) {

293 
	`Ârötf
(
°dîr
, "Can't use fast write ifÇotÉmploying caching\n");

294 
	`ddbg_as£π
(0);;

299 i‡((
cuºdisk
->
ªadahódifidÀ
 != 0) && (currdisk->readaheadifidle != 1)) {

300 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ÑódahódifidÀ i¿disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
ªadahódifidÀ
);

301 
	`ddbg_as£π
(0);;

304 i‡((
cuºdisk
->
wrôecomb
 != 0) && (currdisk->writecomb != 1)) {

305 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ wrôecomb i¿disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
wrôecomb
);

306 
	`ddbg_as£π
(0);;

309 i‡(
cuºdisk
->
maxqÀn
 < 0) {

310 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ maxqÀ¿ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
maxqÀn
);

311 
	`ddbg_as£π
(0);;

314 i‡((
cuºdisk
->
hﬁd_bus_f‹_whﬁe_ªad_x„r
 != 0) &&

315 (
cuºdisk
->
hﬁd_bus_f‹_whﬁe_ªad_x„r
 != 1)) {

316 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ hﬁd_bus_f‹_whﬁe_ªad_x„∏ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
hﬁd_bus_f‹_whﬁe_ªad_x„r
);

317 
	`ddbg_as£π
(0);;

320 i‡((
cuºdisk
->
hﬁd_bus_f‹_whﬁe_wrôe_x„r
 != 0) &&

321 (
cuºdisk
->
hﬁd_bus_f‹_whﬁe_wrôe_x„r
 != 1)) {

322 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ hﬁd_bus_f‹_whﬁe_wrôe_x„∏ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
hﬁd_bus_f‹_whﬁe_wrôe_x„r
);

323 
	`ddbg_as£π
(0);;

325 i‡((
cuºdisk
->
hﬁd_bus_f‹_whﬁe_ªad_x„r
 == 1) &&

326 ((
cuºdisk
->
¢ókyfuŒªadhôs
 == 1) ||

327 (
cuºdisk
->
¢óky∑πüÃódhôs
 == 1) ||

328 (
cuºdisk
->
¢ókyöãrmedüãªadhôs
 == 1))) {

329 
	`Ârötf
(
°dîr
, "hold_bus_for_whole_read_xferánd one or more sneakyreadhits detected disk_postpass_perdisk\n");

330 
	`ddbg_as£π
(0);;

333 i‡((
cuºdisk
->
Æmo°ªadhôs
 != 0) && (currdisk->almostreadhits != 1)) {

334 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹álmo°ªadhô†ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
Æmo°ªadhôs
);

335 
	`ddbg_as£π
(0);;

338 i‡((
cuºdisk
->
¢ókyfuŒªadhôs
 != 0) &&

339 (
cuºdisk
->
¢ókyfuŒªadhôs
 != 1)) {

340 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ s√akyfuŒªadhô†ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
¢ókyfuŒªadhôs
);

341 
	`ddbg_as£π
(0);;

343 i‡((
cuºdisk
->
¢ókyfuŒªadhôs
 == 1) &&

344 (
cuºdisk
->
hﬁd_bus_f‹_whﬁe_ªad_x„r
 == 1)) {

345 
	`Ârötf
(
°dîr
, "hold_bus_for_whole_read_xferánd sneakyfullreadhits detected disk_postpass_perdisk\n");

346 
	`ddbg_as£π
(0);;

349 i‡((
cuºdisk
->
¢óky∑πüÃódhôs
 != 0) &&

350 (
cuºdisk
->
¢óky∑πüÃódhôs
 != 1)) {

351 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ s√aky∑πüÃódhô†ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
¢óky∑πüÃódhôs
);

352 
	`ddbg_as£π
(0);;

354 i‡((
cuºdisk
->
¢óky∑πüÃódhôs
 == 1) &&

355 (
cuºdisk
->
hﬁd_bus_f‹_whﬁe_ªad_x„r
 == 1)) {

356 
	`Ârötf
(
°dîr
, "hold_bus_for_whole_read_xferánd sneakypartialreadhits detected disk_postpass_perdisk\n");

357 
	`ddbg_as£π
(0);;

360 i‡((
cuºdisk
->
¢ókyöãrmedüãªadhôs
 != 0) &&

361 (
cuºdisk
->
¢ókyöãrmedüãªadhôs
 != 1)) {

362 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ s√akyöãrmedüãªadhô†ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
¢ókyöãrmedüãªadhôs
);

363 
	`ddbg_as£π
(0);;

365 i‡((
cuºdisk
->
¢ókyöãrmedüãªadhôs
 == 1) &&

366 (
cuºdisk
->
hﬁd_bus_f‹_whﬁe_ªad_x„r
 == 1)) {

367 
	`Ârötf
(
°dîr
, "hold_bus_for_whole_read_xferánd sneakyintermediatereadhits detected disk_postpass_perdisk\n");

368 
	`ddbg_as£π
(0);;

371 i‡((
cuºdisk
->
ªadhôs⁄wrôed©a
 != 0) &&

372 (
cuºdisk
->
ªadhôs⁄wrôed©a
 != 1)) {

373 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹Ñódhôs⁄wrôed©®ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
ªadhôs⁄wrôed©a
);

374 
	`ddbg_as£π
(0);;

377 i‡((
cuºdisk
->
wrôïªbuf„rög
 != 0) &&

378 (
cuºdisk
->
wrôïªbuf„rög
 != 1)) {

379 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ wrôïªbuf„rög i¿disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
wrôïªbuf„rög
);

380 
	`ddbg_as£π
(0);;

383 i‡((
cuºdisk
->
¥e£ekög
 != 0) && (currdisk->preseeking != 1) &&

384 (
cuºdisk
->
¥e£ekög
 != 2)) {

385 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹Öª£ekög i¿disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
¥e£ekög
);

386 
	`ddbg_as£π
(0);;

389 i‡((
cuºdisk
->
√vîdisc⁄√˘
 != 0) && (currdisk->neverdisconnect != 1)) {

390 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹Çevîdisc⁄√˘ i¿disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
√vîdisc⁄√˘
);

391 
	`ddbg_as£π
(0);;

394 i‡(
cuºdisk
->
num£gs
 < 1) {

395 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹Çum£g†ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
num£gs
);

396 
	`ddbg_as£π
(0);;

399 i‡((
cuºdisk
->
£gsize
 < 1) ||

400 (
cuºdisk
->
£gsize
 > cuºdisk->
modñ
->
dm_£˘‹s
)) {

401 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ segsizêö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
modñ
->
dm_£˘‹s
);

402 
	`ddbg_as£π
(0);;

405 i‡((
cuºdisk
->
numwrôe£gs
 > cuºdisk->
num£gs
) ||

406 (
cuºdisk
->
numwrôe£gs
 < 1)) {

407 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹Çumwrôe£g†ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
numwrôe£gs
);

408 
	`ddbg_as£π
(0);;

411 i‡((
cuºdisk
->
num£gs
 <1Ë&& (cuºdisk->
dediˇãdwrôe£g
)) {

412 
	`Ârötf
(
°dîr
, "Must have more segmentsÅhan dedicated write segments\n");

413 
	`ddbg_as£π
(0);;

415 i‡((()
cuºdisk
->
dediˇãdwrôe£g
 != 0) &&

416 (()
cuºdisk
->
dediˇãdwrôe£g
 != 1)) {

417 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ dediˇãdwrôe£g i¿disk_po°∑ss_≥rdisk: %d\n", ()
cuºdisk
->
dediˇãdwrôe£g
);

418 
	`ddbg_as£π
(0);;

421 i‡((
cuºdisk
->
Á°wrôes
 != 0) && (currdisk->fastwrites != 1) &&

422 (
cuºdisk
->
Á°wrôes
 != 2)) {

423 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ fa°wrôe†ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
Á°wrôes
);

424 
	`ddbg_as£π
(0);;

426 i‡((
cuºdisk
->
Á°wrôes
 !0Ë&& (cuºdisk->
íabÀˇche
 =
FALSE
)) {

427 
	`Ârötf
(
°dîr
, "disk_postpass_perdisk: Can't use fast write ifÇotÉmploying caching\n");

428 
	`ddbg_as£π
(0);;

431 i‡(
cuºdisk
->
modñ
->
dm_surÁ˚s
 < 1) {

432 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ÇumsurÁ˚†ö disk_po°∑ss_≥rdisk: %d\n", 
cuºdisk
->
modñ
->
dm_surÁ˚s
);

433 
	`ddbg_as£π
(0);;

442 
	}
}

445 
	$disk_po°∑ss
 ()

447 
i
;

449 i‡(
NUMDISKS
 == 0) {

453 i‡(
ªadög_buf„r_whﬁe_£rvtime
 < 0.0) {

454 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹Ñódög_buf„r_whﬁe_£rvtimêö disk_po°∑ss: %f\n", 
ªadög_buf„r_whﬁe_£rvtime
);

455 
	`ddbg_as£π
(0);;

459 
	`ddbg_as£π3
(
buf„r_whﬁe_£rvtime
 >= 0.0, ("Invalid value for buffer_whole_servtime in disk_postpass: %f\n", buffer_whole_servtime));

462 i‡(
ªadög_buf„r_∑πül_£rvtime
 < 0.0) {

463 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹Ñódög_buf„r_∑πül_£rvtimêö disk_po°∑ss: %f\n", 
ªadög_buf„r_∑πül_£rvtime
);

464 
	`ddbg_as£π
(0);;

467 i‡(
buf„r_∑πül_£rvtime
 < 0.0) {

468 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ buf„r_∑πül_£rvtimêö disk_po°∑ss: %f\n", 
buf„r_∑πül_£rvtime
);

469 
	`ddbg_as£π
(0);

472 
i
 = 0; i < 
MAXDEVICES
; i++) {

473 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
i
);

474 i‡(
cuºdisk
) {

475 
	`disk_po°∑ss_≥rdisk
(
cuºdisk
);

491 
	}
}

494 
	$disk_£tˇŒbacks
 ()

496 
disksim
->
íabÀmít_disk
 = 
disk_íabÀmít_fun˘i⁄
;

497 
	`ioqueue_£tˇŒbacks
();

498 
	}
}

501 
	$disk_öôülize_disköfo
 ()

503 
disksim
->
disköfo
 = 
	`mÆloc
 ((
disk_öfo_t
));

504 
	`bzîo
 ((*)
disksim
->
disköfo
, (
disk_öfo_t
));

506 
disksim
->
disköfo
->
disks
 = (
disk
**Ë
	`mÆloc
(
MAXDEVICES
 * (disk));

507 
disksim
->
disköfo
->
disks_Àn
 = 
MAXDEVICES
;

508 
	`bzîo
 ((*)
disksim
->
disköfo
->
disks
, (
MAXDEVICES
 * (
disk
)));

511 
disk_¥öthacktime
 = 0.0;

514 
sw≠_f‹w¨d_⁄ly
 = 1;

515 
addtﬁ©ícy
 = 0.0;

516 
buf„r_∑πül_£rvtime
 = 0.000000001;

517 
ªadög_buf„r_∑πül_£rvtime
 = 0.000000001;

518 
buf„r_whﬁe_£rvtime
 = 0.000000000;

519 
ªadög_buf„r_whﬁe_£rvtime
 = 0.000000000;

520 
	}
}

523 
	$disk_ª£t°©s
 ()

525 
i
;

527 
i
=0; i<
MAXDEVICES
; i++) {

528 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
i
);

529 i‡(
cuºdisk
) {

530 
	`ioqueue_ª£t°©s
(
cuºdisk
->
queue
);

531 
	`disk°©öô
(
i
, 0);

534 
	}
}

538 
	$disk_£t_sync£t
 (
£t°¨t
, 
£ãnd
)

540 i‡((
£t°¨t
 < 0Ë|| (
£ãnd
 >
MAXDEVICES
) || (setend < setstart)) {

541 
	`Ârötf
 (
°dîr
, "BadÑ™gê∑s£dÅÿdisk_£t_sync£à(%d - %d)\n", 
£t°¨t
, 
£ãnd
);

542 
	`exô
 (0);

545 
numsync£ts
++;

546 ; 
£t°¨t
 <
£ãnd
; setstart++) {

547 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
£t°¨t
);

548 i‡(
cuºdisk
->
sync£t
 != 0) {

549 
	`Ârötf
 (
°dîr
, "Ovîœµög synchr⁄ized disk së†(%dánd %d)\n", 
numsync£ts
, 
cuºdisk
->
sync£t
);

550 
	`exô
 (0);

552 
cuºdisk
->
sync£t
 = 
numsync£ts
;

554 
	}
}

557 
	$disk_öãr„ª_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

559 
£q
 = 0;

560 
loc
 = 0;

561 
i
;

563 i‡(
devi˚_¥ötöãr„ª°©s
 =
FALSE
)

566 
i
=0; i<
£tsize
; i++) {

567 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
£t
[
i
]);

568 
£q
 +
cuºdisk
->
°©
.
öãr„ª
[0];

569 
loc
 +
cuºdisk
->
°©
.
öãr„ª
[1];

571 
	`Ârötf
 (
ouçutfûe
, "%sSequítü»öãr„ªn˚: %d\n", 
¥efix
, 
£q
);

572 
	`Ârötf
 (
ouçutfûe
, "%sLoˇ»öãr„ªn˚: %d\n", 
¥efix
, 
loc
);

573 
	}
}

576 
	$disk_buf„r_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

578 
wrôecombs
 = 0;

579 
ªadmis£s
 = 0;

580 
wrôemis£s
 = 0;

581 
fuŒªadhôs
 = 0;

582 
¥ïídhôs
 = 0;

583 
≠≥ndhôs
 = 0;

584 
ªadöghôs
 = 0;

585 
ruƒódögsize
 = 0.0;

586 
ªmªadögsize
 = 0.0;

587 
∑πhôs
 = 0;

588 
ru≈¨tsize
 = 0.0;

589 
ªm∑πsize
 = 0.0;

590 
waôögf‹bus
 = 0.0;

591 
numbuswaôs
 = 0;

592 
hôs
;

593 
mis£s
;

594 
tŸÆ
;

595 
ªads
;

596 
wrôes
;

597 
i
;

599 i‡(
devi˚_¥ötbuf„r°©s
 =
FALSE
)

602 
i
=0; i<
£tsize
; i++) {

603 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
£t
[
i
]);

604 
wrôecombs
 +
cuºdisk
->
°©
.writecombs;

605 
ªadmis£s
 +
cuºdisk
->
°©
.readmisses;

606 
wrôemis£s
 +
cuºdisk
->
°©
.writemisses;

607 
fuŒªadhôs
 +
cuºdisk
->
°©
.fullreadhits;

608 
¥ïídhôs
 +
cuºdisk
->
°©
.prependhits;

609 
≠≥ndhôs
 +
cuºdisk
->
°©
.appendhits;

610 
ªadöghôs
 +
cuºdisk
->
°©
.readinghits;

611 
ruƒódögsize
 +
cuºdisk
->
°©
.runreadingsize;

612 
ªmªadögsize
 +
cuºdisk
->
°©
.remreadingsize;

613 
∑πhôs
 +
cuºdisk
->
°©
.parthits;

614 
ru≈¨tsize
 +
cuºdisk
->
°©
.runpartsize;

615 
ªm∑πsize
 +
cuºdisk
->
°©
.rempartsize;

616 
waôögf‹bus
 +
cuºdisk
->
°©
.waitingforbus;

617 
numbuswaôs
 +
cuºdisk
->
°©
.numbuswaits;

619 
hôs
 = 
fuŒªadhôs
 + 
≠≥ndhôs
 + 
¥ïídhôs
 + 
∑πhôs
 + 
ªadöghôs
;

620 
mis£s
 = 
ªadmis£s
 + 
wrôemis£s
;

621 
ªads
 = 
fuŒªadhôs
 + 
ªadmis£s
 + 
ªadöghôs
 + 
∑πhôs
;

622 
tŸÆ
 = 
hôs
 + 
mis£s
;

623 
wrôes
 = 
tŸÆ
 - 
ªads
;

624 i‡(
tŸÆ
 == 0) {

627 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡buf„∏ac˚s£s: %d\n", 
¥efix
, 
tŸÆ
);

628 
	`Ârötf
(
ouçutfûe
, "%sBuf„∏hôÑ©io: %6d \t%f\n", 
¥efix
, 
hôs
, ((Ëhô†/ (Ë
tŸÆ
));

629 
	`Ârötf
(
ouçutfûe
, "%sBuf„∏mis†øtio: %6d \t%f\n", 
¥efix
, 
mis£s
, ((Ëmis£†/ (Ë
tŸÆ
));

630 
	`Ârötf
(
ouçutfûe
, "%sBuf„∏ªad hôÑ©io: %6d \t%‡\t%f\n", 
¥efix
, 
fuŒªadhôs
, ((ËfuŒªadhô†/ (Ë
	`max
(1,
ªads
)), ((ËfuŒªadhô†/ (Ë
tŸÆ
));

631 
	`Ârötf
(
ouçutfûe
, "%sBuf„∏¥ïíd hôÑ©io: %6d \t%f\n", 
¥efix
, 
¥ïídhôs
, ((Ë¥ïídhô†/ (Ë
	`max
(1,
wrôes
)));

632 
	`Ârötf
(
ouçutfûe
, "%sBuf„∏≠≥nd hôÑ©io: %6d \t%f\n", 
¥efix
, 
≠≥ndhôs
, ((Ë≠≥ndhô†/ (Ë
	`max
(1,
wrôes
)));

633 
	`Ârötf
(
ouçutfûe
, "%sWrôêcombö©i⁄s: %6d \t%f\n", 
¥efix
, 
wrôecombs
, ((Ëwrôecomb†/ (Ë
	`max
(1,
wrôes
)));

634 
	`Ârötf
(
ouçutfûe
, "%sOngoögÑód-ahód hôÑ©io: %6d \t%‡\t%f\n", 
¥efix
, 
ªadöghôs
, ((Ëªadöghô†/ (Ë
	`max
(1,
ªads
)), ((Ëªadöghô†/ (Ë
tŸÆ
));

635 
	`Ârötf
(
ouçutfûe
, "%sAvîagêªad-ahód hô size: %f\n", 
¥efix
, (
ruƒódögsize
 / (Ë
	`max
(1,
ªadöghôs
)));

636 
	`Ârötf
(
ouçutfûe
, "%sAvîagêªmaöögÑód-ahód: %f\n", 
¥efix
, (
ªmªadögsize
 / (Ë
	`max
(1,
ªadöghôs
)));

637 
	`Ârötf
(
ouçutfûe
, "%sP¨tü»ªad hôÑ©io: %6d \t%‡\t%f\n", 
¥efix
, 
∑πhôs
, ((Ë∑πhô†/ (Ë
	`max
(1,
ªads
)), ((Ë∑πhô†/ (Ë
tŸÆ
));

638 
	`Ârötf
(
ouçutfûe
, "%sAvîagê∑πü»hô size: %f\n", 
¥efix
, (
ru≈¨tsize
 / (Ë
	`max
(1,
∑πhôs
)));

639 
	`Ârötf
(
ouçutfûe
, "%sAvîagêªmaöögÖ¨tül: %f\n", 
¥efix
, (
ªm∑πsize
 / (Ë
	`max
(1,
∑πhôs
)));

640 
	`Ârötf
(
ouçutfûe
, "%sTŸÆ disk bu†waôÅime: %f\n", 
¥efix
, 
waôögf‹bus
);

641 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡disk bu†waôs: %d\n", 
¥efix
, 
numbuswaôs
);

642 
	}
}

645 
	$disk_£ek_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

647 
i
;

648 
zîos
 = 0;

649 
°©gí
 * 
°©£t
[
MAXDEVICES
];

650 
zîo‰ac
;

652 i‡(
devi˚_¥öt£ek°©s
 =
FALSE
) {

656 
i
=0; i<
£tsize
; i++) {

657 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
£t
[
i
]);

658 
zîos
 +
cuºdisk
->
°©
.
zîo£eks
;

659 
°©£t
[
i
] = &
cuºdisk
->
°©
.
£ekdi°°©s
;

661 i‡(
	`°©_gë_cou¡_£t
(
°©£t
,
£tsize
) > 0) {

662 
zîo‰ac
 = (Ë
zîos
 / (Ë
	`°©_gë_cou¡_£t
(
°©£t
, 
£tsize
);

664 
zîo‰ac
 = 0.0;

666 
	`Ârötf
 (
ouçutfûe
, "%sSìk†o‡zîÿdi°™˚:\t%d\t%f\n", 
¥efix
, 
zîos
, 
zîo‰ac
);

667 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

669 
i
=0; i<
£tsize
; i++) {

670 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
£t
[
i
]);

671 
°©£t
[
i
] = &
cuºdisk
->
°©
.
£ektime°©s
;

673 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

674 
	}
}

677 
	$disk_œãncy_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

679 
i
;

680 
zîos
 = 0;

681 
°©gí
 * 
°©£t
[
MAXDEVICES
];

682 
zîo‰ac
;

683 
disk
 *
cuºdisk
 = 
NULL
;

685 i‡(
devi˚_¥öé©ícy°©s
 =
FALSE
) {

689 
i
=0; i<
£tsize
; i++) {

690 
cuºdisk
 = 
	`gëdisk
 (
£t
[
i
]);

691 
zîos
 +
cuºdisk
->
°©
.
zîﬁ©ícy
;

692 
°©£t
[
i
] = &
cuºdisk
->
°©
.
rŸœt°©s
;

694 i‡(
£tsize
 == 1) {

695 
	`Ârötf
 (
ouçutfûe
, "%sFuŒÑŸ©i⁄Åime: %f\n", 
¥efix
, 
	`dm_time_ôod
(
cuºdisk
->
modñ
->
mech
->
	`dm_≥riod
(currdisk->model)));

697 i‡(
	`°©_gë_cou¡_£t
(
°©£t
,
£tsize
) > 0) {

698 
zîo‰ac
 = (Ë
zîos
 / (Ë
	`°©_gë_cou¡_£t
(
°©£t
, 
£tsize
);

700 
zîo‰ac
 = 0.0;

702 
	`Ârötf
 (
ouçutfûe
, "%sZîÿrŸ©êœãncy:\t%d\t%f\n", 
¥efix
, 
zîos
, 
zîo‰ac
);

703 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

704 
	}
}

707 
	$disk_å™s„r_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

709 
i
;

710 
°©gí
 * 
°©£t
[
MAXDEVICES
];

712 i‡(
devi˚_¥ötx„r°©s
) {

713 
i
=0; i<
£tsize
; i++) {

714 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
£t
[
i
]);

715 
°©£t
[
i
] = &
cuºdisk
->
°©
.
x„πime°©s
;

717 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

719 
	}
}

722 
	$disk_ac˘ime_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

724 
i
;

725 
°©gí
 * 
°©£t
[
MAXDEVICES
];

727 i‡(
devi˚_¥öèc˘ime°©s
) {

728 
i
=0; i<
£tsize
; i++) {

729 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
£t
[
i
]);

730 
°©£t
[
i
] = &
cuºdisk
->
°©
.
po°ime°©s
;

732 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

733 
i
=0; i<
£tsize
; i++) {

734 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
£t
[
i
]);

735 
°©£t
[
i
] = &
cuºdisk
->
°©
.
ac˘ime°©s
;

737 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

739 
	}
}

742 
	$disk_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
)

744 
i
;

745 
ioq
 * 
queue£t
[
MAXDEVICES
];

746 
ªq˙t
 = 0;

747 
¥efix
[80];

749 
	`•rötf
(
¥efix
, "%sdisk ", 
sour˚°r
);

750 
i
=0; i<
£tsize
; i++) {

751 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
£t
[
i
]);

752 
queue£t
[
i
] = 
cuºdisk
->
queue
;

753 
ªq˙t
 +
	`ioqueue_gë_numbî_of_ªque°s
(
cuºdisk
->
queue
);

755 i‡(
ªq˙t
 == 0) {

756 
	`Ârötf
 (
ouçutfûe
, "\nNo diskÑequests for members ofÅhis set\n\n");

759 
	`ioqueue_¥öt°©s
(
queue£t
, 
£tsize
, 
¥efix
);

761 
	`disk_£ek_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

762 
	`disk_œãncy_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

763 
	`disk_å™s„r_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

764 
	`disk_ac˘ime_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

765 
	`disk_öãr„ª_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

766 
	`disk_buf„r_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

767 
	}
}

770 
	$disk_¥öt°©s
 ()

772 
ioq
 * 
queue£t
[
MAXDEVICES
];

773 
£t
[
MAXDEVICES
];

774 
i
;

775 
ªq˙t
 = 0;

776 
¥efix
[80];

777 
disk˙t
;

779 
	`Ârötf
(
ouçutfûe
, "\nDISK STATISTICS\n");

780 
	`Ârötf
(
ouçutfûe
, "---------------\n\n");

782 
	`•rötf
(
¥efix
, "Disk ");

784 
disk˙t
 = 0;

785 
i
=0; i<
MAXDEVICES
; i++) {

786 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
i
);

787 i‡(
cuºdisk
) {

788 
queue£t
[
disk˙t
] = 
cuºdisk
->
queue
;

789 
ªq˙t
 +
	`ioqueue_gë_numbî_of_ªque°s
(
cuºdisk
->
queue
);

790 
disk˙t
++;

793 
	`ddbg_as£π
 (
disk˙t
 =
NUMDISKS
);

795 i‡(
ªq˙t
 == 0) {

796 
	`Ârötf
(
ouçutfûe
, "No diskÑequestsÉncountered\n");

802 
	`ioqueue_¥öt°©s
(
queue£t
, 
NUMDISKS
, 
¥efix
);

804 
disk˙t
 = 0;

805 
i
=0; i<
MAXDEVICES
; i++) {

806 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
i
);

807 i‡(
cuºdisk
) {

808 
£t
[
disk˙t
] = 
i
;

809 
disk˙t
++;

812 
	`ddbg_as£π
 (
disk˙t
 =
NUMDISKS
);

814 
	`disk_£ek_¥öt°©s
(
£t
, 
NUMDISKS
, 
¥efix
);

815 
	`disk_œãncy_¥öt°©s
(
£t
, 
NUMDISKS
, 
¥efix
);

816 
	`disk_å™s„r_¥öt°©s
(
£t
, 
NUMDISKS
, 
¥efix
);

817 
	`disk_ac˘ime_¥öt°©s
(
£t
, 
NUMDISKS
, 
¥efix
);

818 
	`disk_öãr„ª_¥öt°©s
(
£t
, 
NUMDISKS
, 
¥efix
);

819 
	`disk_buf„r_¥öt°©s
(
£t
, 
NUMDISKS
, 
¥efix
);

820 
	`Ârötf
 (
ouçutfûe
, "\n\n");

822 i‡(
NUMDISKS
 <= 1) {

826 
i
=0; i<
NUMDISKS
; i++) {

827 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
£t
[
i
]);

828 i‡(
cuºdisk
->
¥öt°©s
 =
FALSE
) {

831 i‡(
	`ioqueue_gë_numbî_of_ªque°s
(
cuºdisk
->
queue
) == 0) {

832 
	`Ârötf
(
ouçutfûe
, "Nÿªque°†f‹ disk #%d\n\n\n", 
£t
[
i
]);

835 
	`Ârötf
(
ouçutfûe
, "Disk #%d:\n\n", 
£t
[
i
]);

836 
	`Ârötf
(
ouçutfûe
, "Disk #%d highe° blockÇumbîÑeque°ed: %d\n", 
£t
[
i
], 
cuºdisk
->
°©
.
highblkno
);

837 
	`•rötf
(
¥efix
, "Disk #%d ", 
£t
[
i
]);

838 
	`ioqueue_¥öt°©s
(&
cuºdisk
->
queue
, 1, 
¥efix
);

839 
	`disk_£ek_¥öt°©s
(&
£t
[
i
], 1, 
¥efix
);

840 
	`disk_œãncy_¥öt°©s
(&
£t
[
i
], 1, 
¥efix
);

841 
	`disk_å™s„r_¥öt°©s
(&
£t
[
i
], 1, 
¥efix
);

842 
	`disk_ac˘ime_¥öt°©s
(&
£t
[
i
], 1, 
¥efix
);

843 
	`disk_öãr„ª_¥öt°©s
(&
£t
[
i
], 1, 
¥efix
);

844 
	`disk_buf„r_¥öt°©s
(&
£t
[
i
], 1, 
¥efix
);

845 
	`Ârötf
 (
ouçutfûe
, "\n\n");

847 
	}
}

852 
	~<diskmodñ/moduÀs/moduÀs.h
>

858 
disk
 *
	$disksim_disk_lﬂd∑øms
(
Õ_block
 *
b
,

859 *
num
)

861 
c
;

862 
disk
 *
ªsu…
;

863 
num2
;

865 
	`devi˚_öôülize_devi˚öfo
();

867 if(!
disksim
->
disköfo
Ë
	`disk_öôülize_disköfo
();

869 
	`disk_£tˇŒbacks
();

870 
	`disk_po°∑ss
();

871 
	`disk_sync£t_öô
();

873 
ªsu…
 = 
	`mÆloc
((
disk
));

874 if(!
ªsu…
)  0;

875 
	`mem£t
(
ªsu…
, 0, (
disk
));

877 
ªsu…
->
hdr
 = 
disk_hdr_öôülizî
;

878 
ªsu…
->
hdr
.
devi˚_«me
 = 
	`°rdup
(
b
->
«me
);

879 
num2
 = 
	`disk_add
(
ªsu…
);

880 if(
num
Ë*num = 
num2
;

882 ((
devi˚_hódî
 *)
ªsu…
)->
devi˚_ty≥
 = 
DEVICETYPE_DISK
;

885 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
disksim_disk_mod
);

888 
	`devi˚_add
((
devi˚_hódî
 *)
ªsu…
, 
num2
);

889  
ªsu…
;

890 
	}
}

895 
devi˚_hódî
 *
	$disk_c›y
(
devi˚_hódî
 *
‹ig
) {

897 
disk
 *
ªsu…
 = 
	`mÆloc
((disk));

898 
	`mem˝y
((
disk
 *)
ªsu…
, 
‹ig
, (disk));

903 
ªsu…
->
queue
 = 
	`ioqueue_c›y
(((
disk
 *)
‹ig
)->queue);

904  (
devi˚_hódî
 *)
ªsu…
;

905 
	}
}

908 
	$disk_lﬂd_sync£ts
(
Õ_block
 *
b
) {

909 
c
, 
d
;

910 
ty≥
, 
devnum
;

911 
Õ_li°
 *
l
;

912 
disk
 *
cuºdisk
;

914 ++
numsync£ts
;

916 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

917 if(!
b
->
∑øms
[
c
]) ;

918 if(
	`°rcmp
(
b
->
∑øms
[
c
]->
«me
, "devices")) ;

919 
l
 = 
	`LVAL
(
b
->
∑øms
[
c
]);

920 
d
 = 0; d < 
l
->
vÆues_Àn
; d++) {

921 if(!
l
->
vÆues
[
c
]) ;

922 
cuºdisk
 = (
disk
*)
	`gëdevby«me
(
l
->
vÆues
[
c
]->
v
.
s
, 0, &
devnum
, &
ty≥
);

923 if(!
cuºdisk
 || (
ty≥
 !
DEVICETYPE_DISK
)) {

924 
	`Ârötf
(
°dîr
, "***Éº‹: bad sync£à•ec:Çÿsuch devi˚ %†‹ %†i†o‡thêwr⁄gÅy≥.\n", 
l
->
vÆues
[
c
]->
v
.
s
,Ü->values[c]->v.s);

928 
cuºdisk
->
sync£t
 = 
numsync£ts
;

936 
	}
}

941 
	$disk_öôülize
 ()

943 
i
, 
j
;

944 
diskªq
 *
tmpdiskªq
;

945 
£gmít
 *
tmp£g
;

949 
	`SèticAs£π
 ((
£gmít
Ë<
DISKSIM_EVENT_SIZE
);

950 
	`SèticAs£π
 ((
diskªq
Ë<
DISKSIM_EVENT_SIZE
);

952 i‡(
disksim
->
disköfo
 =
NULL
) {

953 
	`disk_öôülize_disköfo
();

956 
	`disk_£tˇŒbacks
();

957 
	`disk_po°∑ss
();

958 
	`disk_sync£t_öô
();

960 
i
 = 0; i < 
MAXDEVICES
; i++) {

961 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
i
); if(!currdisk) ;

965 
	`ioqueue_öôülize
(
cuºdisk
->
queue
, 
i
);

966 
	`ioqueue_£t_íabÀmít_fun˘i⁄
 (
cuºdisk
->
queue
, &
disksim
->
íabÀmít_disk
);

967 
	`addli°t€xåaq
((
evít
 **Ë&
cuºdisk
->
outwaô
);

968 
	`addli°t€xåaq
((
evít
 **Ë&
cuºdisk
->
buswaô
);

970 i‡(
cuºdisk
->
cuºítbus
) {

971 i‡(
cuºdisk
->
cuºítbus
 =cuºdisk->
ef„˘ivebus
) {

972 
cuºdisk
->
ef„˘ivebus
 = 
NULL
;

974 
tmpdiskªq
 = 
cuºdisk
->
cuºítbus
;

975 i‡(
tmpdiskªq
->
£g
) {

976 
	`disk_buf„r_ªmove_‰om_£g
(
tmpdiskªq
);

978 
	`addli°t€xåaq
((
evít
 **Ë&
tmpdiskªq
->
i‹eqli°
);

979 
cuºdisk
->
cuºítbus
 = 
NULL
;

980 
	`addt€xåaq
((
evít
 *Ë
tmpdiskªq
);

983 i‡(
cuºdisk
->
ef„˘ivebus
) {

984 
tmpdiskªq
 = 
cuºdisk
->
ef„˘ivebus
;

985 i‡(
tmpdiskªq
->
£g
) {

986 
	`disk_buf„r_ªmove_‰om_£g
(
tmpdiskªq
);

988 
	`addli°t€xåaq
((
evít
 **Ë&
tmpdiskªq
->
i‹eqli°
);

989 
cuºdisk
->
ef„˘ivebus
 = 
NULL
;

990 
	`addt€xåaq
((
evít
 *Ë
tmpdiskªq
);

993 i‡(
cuºdisk
->
cuºíthda
) {

994 i‡(
cuºdisk
->
cuºíthda
 =cuºdisk->
ef„˘ivehda
) {

995 
cuºdisk
->
ef„˘ivehda
 = 
NULL
;

997 
tmpdiskªq
 = 
cuºdisk
->
cuºíthda
;

998 i‡(
tmpdiskªq
->
£g
) {

999 
	`disk_buf„r_ªmove_‰om_£g
(
tmpdiskªq
);

1001 
	`addli°t€xåaq
((
evít
 **Ë&
tmpdiskªq
->
i‹eqli°
);

1002 
cuºdisk
->
cuºíthda
 = 
NULL
;

1003 
	`addt€xåaq
((
evít
 *Ë
tmpdiskªq
);

1006 i‡(
cuºdisk
->
ef„˘ivehda
 !
NULL
) {

1007 
tmpdiskªq
 = 
cuºdisk
->
ef„˘ivehda
;

1008 i‡(
tmpdiskªq
->
£g
) {

1009 
	`disk_buf„r_ªmove_‰om_£g
(
tmpdiskªq
);

1011 
	`addli°t€xåaq
((
evít
 **Ë&
tmpdiskªq
->
i‹eqli°
);

1012 
cuºdisk
->
ef„˘ivehda
 = 
NULL
;

1013 
	`addt€xåaq
((
evít
 *Ë
tmpdiskªq
);

1016 
cuºdisk
->
≥ndx„r
) {

1017 
tmpdiskªq
 = 
cuºdisk
->
≥ndx„r
;

1018 i‡(
tmpdiskªq
->
£g
) {

1019 
	`disk_buf„r_ªmove_‰om_£g
(
tmpdiskªq
);

1021 
	`addli°t€xåaq
((
evít
 **Ë&
tmpdiskªq
->
i‹eqli°
);

1022 
cuºdisk
->
≥ndx„r
 = 
tmpdiskªq
->
bus_√xt
;

1023 
	`addt€xåaq
((
evít
 *Ë
tmpdiskªq
);

1026 
cuºdisk
->
out°©e
 = 
DISK_IDLE
;

1027 
cuºdisk
->
busy
 = 
FALSE
;

1028 
cuºdisk
->
¥ev_ªadahód_mö
 = -1;

1029 
cuºdisk
->
exåadisc_diskªq
 = 
NULL
;

1031 
cuºdisk
->
cuºtime
 = 0.0;

1032 
cuºdisk
->
œ°Êags
 = 
READ
;

1034 
cuºdisk
->
œ°gí
 = -1;

1035 
cuºdisk
->
busow√d
 = -1;

1036 
cuºdisk
->
numdúty
 = 0;

1037 i‡(
cuºdisk
->
£gli°
 =
NULL
) {

1038 
cuºdisk
->
£gli°
 = (
£gmít
 *Ë
	`DISKSIM_mÆloc
((segment));

1039 
cuºdisk
->
£gli°
->
√xt
 = 
NULL
;

1040 
cuºdisk
->
£gli°
->
¥ev
 = 
NULL
;

1041 
cuºdisk
->
£gli°
->
diskªqli°
 = 
NULL
;

1042 
cuºdisk
->
£gli°
->
ªcy˛îeq
 = 
NULL
;

1043 
cuºdisk
->
£gli°
->
ac˚ss
 = 
NULL
;

1044 
j
 = 1; j < 
cuºdisk
->
num£gs
; j++) {

1045 
tmp£g
 = (
£gmít
 *Ë
	`DISKSIM_mÆloc
((segment));

1046 
tmp£g
->
√xt
 = 
cuºdisk
->
£gli°
;

1047 
cuºdisk
->
£gli°
 = 
tmp£g
;

1048 
tmp£g
->
√xt
->
¥ev
 =Åmpseg;

1049 
tmp£g
->
¥ev
 = 
NULL
;

1050 
tmp£g
->
diskªqli°
 = 
NULL
;

1051 
tmp£g
->
ªcy˛îeq
 = 
NULL
;

1052 
tmp£g
->
ac˚ss
 = 
NULL
;

1054 i‡(
cuºdisk
->
dediˇãdwrôe£g
) {

1055 
cuºdisk
->
dediˇãdwrôe£g
 = cuºdisk->
£gli°
;

1058 
tmp£g
 = 
cuºdisk
->
£gli°
;

1061 
j
 = 0; j < 
cuºdisk
->
num£gs
; j++) {

1062 
tmp£g
->
out°©e
 = 
BUFFER_IDLE
;

1063 
tmp£g
->
°©e
 = 
BUFFER_EMPTY
;

1064 
tmp£g
->
size
 = 
cuºdisk
->
£gsize
;

1065 
tmp£g
->
diskªqli°
) {

1066 
	`addli°t€xåaq
((
evít
 **Ë&
tmp£g
->
diskªqli°
->
i‹eqli°
);

1067 
tmpdiskªq
 = 
tmp£g
->
diskªqli°
;

1068 
tmp£g
->
diskªqli°
 = 
tmpdiskªq
->
£g_√xt
;

1069 
	`addt€xåaq
((
evít
 *Ë
tmpdiskªq
);

1073 
tmp£g
->
ªcy˛îeq
 = 
NULL
;

1074 
	`addli°t€xåaq
((
evít
 **Ë&
tmp£g
->
ac˚ss
);

1075 
tmp£g
 =Åmp£g->
√xt
;

1079 
	`disk°©öô
(
i
, 
TRUE
);

1081 
	}
}

1085 
	$disk_ac˘ime°©s
 (
disk
 *
cuºdisk
, 
di°™˚
, 
£ektime
,

1086 
œãncy
, 
x„πime
, 
ac˘ime
)

1088 
di°
;

1090 i‡(
devi˚_¥öt£ek°©s
 =
TRUE
) {

1091 
di°
 = 
	`abs
(
di°™˚
);

1092 i‡(
di°
 == 0) {

1093 
cuºdisk
->
°©
.
zîo£eks
++;

1095 
	`°©_upd©e
(&
cuºdisk
->
°©
.
£ekdi°°©s
, (Ë
di°
);

1096 
	`°©_upd©e
(&
cuºdisk
->
°©
.
£ektime°©s
, 
£ektime
);

1098 i‡(
devi˚_¥öé©ícy°©s
 =
TRUE
) {

1099 i‡(
œãncy
 == () 0.0) {

1100 
cuºdisk
->
°©
.
zîﬁ©ícy
++;

1102 
	`°©_upd©e
(&
cuºdisk
->
°©
.
rŸœt°©s
, 
œãncy
);

1104 i‡(
devi˚_¥ötx„r°©s
 =
TRUE
) {

1105 
	`°©_upd©e
(&
cuºdisk
->
°©
.
x„πime°©s
, 
x„πime
);

1107 i‡(
devi˚_¥öèc˘ime°©s
 =
TRUE
) {

1108 
	`°©_upd©e
(&
cuºdisk
->
°©
.
po°ime°©s
, (
£ektime
+
œãncy
));

1109 
	`°©_upd©e
(&
cuºdisk
->
°©
.
ac˘ime°©s
, 
ac˘ime
);

1111 
	}
}

1114 
	$disk_gë_numbî_of_blocks
(
n
) {

1115  
disksim
->
disköfo
->
disks
[
n
]->
modñ
->
dm_£˘‹s
;

1116 
	}
}

1118 
	$disk_gë_numcyls
(
n
) {

1119  
disksim
->
disköfo
->
disks
[
n
]->
modñ
->
dm_cyls
;

1120 
	}
}

1124 
	$disk_gë_m≠pög
(
m≠ty≥
,

1125 
n
,

1126 
lbn
,

1127 *
c
,

1128 *
h
,

1129 *
s
)

1131 
dm_pbn
 
pbn
;

1132 
dm_disk_if
 *
d
 = 
disksim
->
disköfo
->
disks
[
n
]->
modñ
;

1133 
d
->
œyout
->
	`dm_å™¶©e_…›
(d, 
m≠ty≥
, 
lbn
, &
pbn
, 0);

1135 if(
c
) {

1136 *
c
 = 
pbn
.
cyl
;

1139 if(
h
) {

1140 *
h
 = 
pbn
.
hód
;

1143 if(
s
) {

1144 *
s
 = 
pbn
.
£˘‹
;

1146 
	}
}

1148 
	$disk_gë_avg_£˘≥rcyl
(
devno
)

1150  
disksim
->
disköfo
->
disks
[
devno
]->
£˘≥rcyl
;

1151 
	}
}

1155 
devi˚_hódî
 
	gdisk_hdr_öôülizî
 = {

1156 
DEVICETYPE_DISK
,

1157 (
disk
),

1159 
disk_c›y
,

1161 
disk_£t_dïth
,

1162 
disk_gë_dïth
,

1163 
disk_gë_öbus
,

1164 
disk_gë_bu¢o
,

1165 
disk_gë_¶Ÿno
,

1167 
disk_gë_numbî_of_blocks
,

1169 
disk_gë_maxout°™dög
,

1170 
disk_gë_numcyls
,

1172 
disk_gë_blkå™°ime
,

1173 
disk_gë_avg_£˘≥rcyl
,

1175 
disk_gë_m≠pög
,

1176 
disk_evít_¨rive
,

1177 
disk_gë_di°™˚
,

1178 
disk_gë_£rvtime
,

1179 
disk_gë_£ektime
,

1180 
disk_gë_ac˘ime
,

1181 
disk_bus_dñay_com∂ëe
,

1182 
disk_bus_ow√rshù_gø¡


	@/Users/ysoh/disksim-4.0-fcl/src/disksim_disk.h

101 #i‚de‡
DISKSIM_DISK_H


102 
	#DISKSIM_DISK_H


	)

104 
	~"disksim_°©.h
"

105 
	~"disksim_iosim.h
"

106 
	~"disksim_ioqueue.h
"

107 
	~"c⁄fig.h
"

109 
	~<diskmodñ/dm.h
>

113 
	mDISK_IDLE
 = 1,

114 
	mDISK_TRANSFERING
 = 2,

115 
	mDISK_WAIT_FOR_CONTROLLER
 = 3

116 } 
	tdisk_°©e_t
;

120 
	mBUFFER_EMPTY
 = 1,

121 
	mBUFFER_CLEAN
 = 2,

122 
	mBUFFER_DIRTY
 = 3,

123 
	mBUFFER_READING
 = 4,

124 
	mBUFFER_WRITING
 = 5,

125 } 
	tdisk_buf„r_°©e_t
;

129 
	mBUFFER_PREEMPT
 = 6,

130 
	mBUFFER_IDLE
 = 7,

131 
	mBUFFER_CONTACTING
 = 8,

132 
	mBUFFER_TRANSFERING
 = 9

133 } 
	tdisk_buf„r_out°©e_t
;

137 
	mBUFFER_COLLISION
 = -1,

138 
	mBUFFER_NOMATCH
 = 0,

139 
	mBUFFER_WHOLE
 = 1,

140 
	mBUFFER_PARTIAL
 = 2,

141 
	mBUFFER_PREPEND
 = 3,

142 
	mBUFFER_APPEND
 = 4

143 } 
	tdisk_ˇche_hô_t
;

148 
	#BUFFER_BACKGROUND
 0x10000000

	)

152 
	mBUFFER_NO_READ_AHEAD
 = 0,

153 
	mBUFFER_READ_UNTIL_TRACK_END
 = 1,

154 
	mBUFFER_READ_UNTIL_CYL_END
 = 2,

155 
	mBUFFER_READ_UNTIL_SEG_END
 = 3,

156 
	mBUFFER_DEC_PREFETCH_SCHEME
 = 4

157 } 
	tdisk_c⁄t_ªad_t
;

160 
	#SEG_OWNED
 0x00000001

	)

161 
	#HDA_OWNED
 0x00000002

	)

162 
	#EXTRA_WRITE_DISCONNECT
 0x00000004

	)

163 
	#COMPLETION_SENT
 0x00000008

	)

164 
	#COMPLETION_RECEIVED
 0x00000010

	)

165 
	#FINAL_WRITE_RECONNECTION_1
 0x00000020

	)

166 
	#FINAL_WRITE_RECONNECTION_2
 0x00000040

	)

171 
	mNO_PRESEEK
 = 0,

172 
	mPRESEEK_DURING_COMPLETION
 = 1,

173 
	mPRESEEK_BEFORE_COMPLETION
 = 2

174 } 
	tdisk_¥e£ek_t
;

178 
	mNO_FASTWRITE
 = 0,

179 
	mLIMITED_FASTWRITE
 = 1,

180 
	mFULL_FASTWRITE
 = 2

181 } 
	tdisk_Á°wrôe_t
;

185 
	#i‹eq_hﬁd_disk
 
ãmµå1


	)

186 
	#i‹eq_hﬁd_diskªq
 
ãmµå2


	)

189 
	#MAXSTATS
 10

	)

190 
	#MAXDISKS
 100

	)

193 
	s£g
 {

194 
	mtime
;

195 
disk_buf„r_°©e_t
 
	m°©e
;

196 
£g
 *
	m√xt
;

197 
£g
 *
	m¥ev
;

198 
	m°¨tblkno
;

199 
	mídblkno
;

200 
disk_buf„r_out°©e_t
 
	mout°©e
;

201 
	moutbcou¡
;

202 
	mmöªadahódblkno
;

203 
	mmaxªadahódblkno
;

205 
diskªq_t
 *
	mdiskªqli°
;

206 
	msize
;

213 
i‹eq_evít
 *
	mac˚ss
;

215 
	mhﬁd_blkno
;

216 
	mhﬁd_bcou¡
;

217 
diskªq_t
 *
	mªcy˛îeq
;

218 } 
	t£gmít
;

221 
	sdiskªq_t
 {

222 
	mÊags
;

223 
i‹eq_evít
 *
	mi‹eqli°
;

224 
diskªq_t
 *
	m£g_√xt
;

225 
diskªq_t
 *
	mbus_√xt
;

226 
	moutblkno
;

227 
	möblkno
;

228 
£gmít
 *
	m£g
;

229 
	mw©îm¨k
;

230 
disk_ˇche_hô_t
 
	mhôty≥
;

231 
	movîhód_d⁄e
;

232 
	m•a˚
[20];

233 } 
	tdiskªq
;

237 
	m£ektime
;

238 
	mœãncy
;

239 
	mx„πime
;

240 
	m£ekdi°™˚
;

241 
	mzîo£eks
;

242 
	mzîﬁ©ícy
;

243 
	mhighblkno
;

244 
°©gí
 
	m£ekdi°°©s
;

245 
°©gí
 
	m£ektime°©s
;

246 
°©gí
 
	mrŸœt°©s
;

247 
°©gí
 
	mx„πime°©s
;

248 
°©gí
 
	mpo°ime°©s
;

249 
°©gí
 
	mac˘ime°©s
;

250 
	mwrôecombs
;

251 
	mªadmis£s
;

252 
	mwrôemis£s
;

253 
	mfuŒªadhôs
;

254 
	m≠≥ndhôs
;

255 
	m¥ïídhôs
;

256 
	mªadöghôs
;

257 
	mruƒódögsize
;

258 
	mªmªadögsize
;

259 
	m∑πhôs
;

260 
	mru≈¨tsize
;

261 
	mªm∑πsize
;

262 
	möãr„ª
[2];

263 
	mªque°edbus
;

264 
	mwaôögf‹bus
;

265 
	mnumbuswaôs
;

266 } 
	tdisk°©
;

270 
	sdisk_cuº°©e
 {

271 
dm_mech_°©e
 
	ms
;

272 
dm_time_t
 
	mt
;

275 
	sdisk
 {

276 
devi˚_hódî
 
	mhdr
;

277 
dm_disk_if
 *
	mmodñ
;

279 
dm_mech_°©e
 
	mmech_°©e
;

280 
	måack_low
, 
	måack_high
;

282 
	mdevno
;

286 
	mc⁄°_ac˘ime
;

288 
	mac˘ime
;

292 
	mc⁄°_£ektime
;

294 
	m£ektime
;

297 
	movîhód
;

298 
	mtimesˇÀ
;

302 
	msync£t
;

305 
ioq
 *
	mqueue
;

307 
	m£˘≥rcyl
;

310 
	mhﬁd_bus_f‹_whﬁe_ªad_x„r
;

311 
	mhﬁd_bus_f‹_whﬁe_wrôe_x„r
;

314 
	mÆmo°ªadhôs
;

315 
	m¢ókyfuŒªadhôs
;

316 
	m¢óky∑πüÃódhôs
;

317 
	m¢ókyöãrmedüãªadhôs
;

318 
	mªadhôs⁄wrôed©a
;

319 
	mwrôïªbuf„rög
;

322 
	m¥e£ekög
;

324 
	m√vîdisc⁄√˘
;

328 
	mmaxqÀn
;

330 
	mbusy
;

333 
	m¥ev_ªadahód_mö
;

334 
	mwrôe_hô_°›_ªadahód
;

335 
	mªad_dúe˘_to_buf„r
;

336 
	mimmedå™s_™y_ªadhô
;

337 
	mªad™y‰ìblocks
;

339 
	mnum£gs
;

340 
	mnumwrôe£gs
;

341 
£gmít
 * 
	mdediˇãdwrôe£g
;

342 
	m£gsize
;

343 
	mwrôew©î
;

344 
	mªadw©î
;

345 
	mªqw©î
;

346 
	m£˘by£˘
;

347 
	míabÀˇche
;

348 
	mc⁄åód
;

349 
	mmöªadahód
;

350 
	mmaxªadahód
;

351 
	mkì¥eque°d©a
;

352 
	mªadahódifidÀ
;

353 
	mÁ°wrôes
;

354 
	mnumdúty
;

357 
	mwrôecomb
;

360 
	m°›ö£˘‹
;

363 
	mdisc⁄√˘ö£ek
;

366 
	mimmed°¨t
;

367 
	mimmedíd
;

370 
£gmít
 *
	m£gli°
;

373 
	movîhód_comm™d_ªadhô_a·îªad
;

374 
	movîhód_comm™d_ªadhô_a·îwrôe
;

376 
	movîhód_comm™d_ªadmiss_a·îªad
;

377 
	movîhód_comm™d_ªadmiss_a·îwrôe
;

379 
	movîhód_comm™d_wrôehô_a·îªad
;

380 
	movîhód_comm™d_wrôehô_a·îwrôe
;

382 
	movîhód_comm™d_wrôemiss_a·îªad
;

383 
	movîhód_comm™d_wrôemiss_a·îwrôe
;

385 
	movîhód_com∂ëe_ªad
;

386 
	movîhód_com∂ëe_wrôe
;

388 
	movîhód_d©a_¥ï
;

389 
	movîhód_ª£À˘_fú°
;

390 
	movîhód_ª£À˘_Ÿhî
;

392 
	movîhód_disc⁄√˘_ªad_a·îªad
;

393 
	movîhód_disc⁄√˘_ªad_a·îwrôe
;

395 
	movîhód_disc⁄√˘_wrôe
;

399 
diskªq_t
 *
	mexåadisc_diskªq
;

400 
	mexåa_wrôe_disc⁄√˘
;

401 
	mexåadisc_comm™d
;

402 
	mexåadisc_disc⁄√˘1
;

403 
	mexåadisc_öãr_disc⁄√˘
;

404 
	mexåadisc_disc⁄√˘2
;

405 
	mexåadisc_£ekdñè
;

407 
	mmöimum_£ek_dñay
;

414 
	mcuºtime
;

415 
dm_time_t
 
	mcuºtime_i
;

418 
	mœ°gí
;

421 
	mœ°Êags
;

425 
	m°¨âøns
;

428 
	mblkå™°ime
;

430 
disk_°©e_t
 
	mout°©e
;

433 
diskªq
 *
	m≥ndx„r
;

434 
diskªq
 *
	mcuºíthda
;

435 
diskªq
 *
	mef„˘ivehda
;

436 
diskªq
 *
	mcuºítbus
;

437 
diskªq
 *
	mef„˘ivebus
;

441 
	mblksd⁄e
;

443 
	mbusow√d
;

444 
i‹eq_evít
 *
	mbuswaô
;

445 
i‹eq_evít
 *
	moutwaô
;

447 
	mnumöbu£s
;

448 
	möbu£s
[
MAXINBUSES
];

449 
	mdïth
[
MAXINBUSES
];

450 
	m¶Ÿno
[
MAXINBUSES
];

453 
disk°©
 
	m°©
;

454 
	m¥öt°©s
;

458 
	mimmed
;

459 
	mimmedªad
;

460 
	mimmedwrôe
;

470 
	mÂcheck
;

472 } 
	tdisk
;

475 
	sdisk_öfo
 {

476 
disk
 **
	mdisks
;

477 
	mdisks_Àn
;

478 
	mnumdisks
;

479 
	mdisk_¥öthack
;

480 
	mdisk_¥öthacktime
;

481 
	mnumsync£ts
;

482 
	mexåa_wrôe_disc⁄√˘s
;

484 
	mb™d°¨t
;

485 
	msw≠_f‹w¨d_⁄ly
;

486 
	maddtﬁ©ícy
;

487 
	mdisk_£ek_°›time
;

488 
disk
 *
	mœ°disk
;

490 
	mLRU_©_£g_li°_hód
;

500 
	mbuf„r_∑πül_£rvtime
;

501 
	mªadög_buf„r_∑πül_£rvtime
;

502 
	mbuf„r_whﬁe_£rvtime
;

503 
	mªadög_buf„r_whﬁe_£rvtime
;

504 } 
	tdisk_öfo_t
;

508 
	#mu…i_disk_œ°_£ektime
 (
disksim
->
disköfo
->
mu…i_disk_œ°_£ektime
)

	)

509 
	#mu…i_disk_œ°_œãncy
 (
disksim
->
disköfo
->
mu…i_disk_œ°_œãncy
)

	)

510 
	#mu…i_disk_œ°_cy o
 (
disksim
->
disköfo
->
mu…i_disk_œ°_cy o
)

	)

511 
	#mu…i_disk_œ°_surÁ˚
 (
disksim
->
disköfo
->
mu…i_disk_œ°_surÁ˚
)

	)

512 
	#mu…i_disk_œ°_™gÀ
 (
disksim
->
disköfo
->
mu…i_disk_œ°_™gÀ
)

	)

513 
	#mu…i_disk_œ°_x„πime
 (
disksim
->
disköfo
->
mu…i_disk_œ°_x„πime
)

	)

514 
	#mu…i_disk_œ°
 (
disksim
->
disköfo
->
mu…i_disk_œ°
)

	)

515 
	#do_‰ì_blocks
 (
disksim
->
disköfo
->
do_‰ì_blocks
)

	)

516 
	#disk_œ°_™gÀ
 (
disksim
->
disköfo
->
disk_œ°_™gÀ
)

	)

517 
	#œ°disk
 (
disksim
->
disköfo
->
œ°disk
)

	)

518 
	#NUMDISKS
 (
disksim
->
disköfo
->
numdisks
)

	)

519 
	#disk_¥öthack
 (
disksim
->
disköfo
->
disk_¥öthack
)

	)

520 
	#disk_¥öthacktime
 (
disksim
->
disköfo
->
disk_¥öthacktime
)

	)

521 
	#numsync£ts
 (
disksim
->
disköfo
->
numsync£ts
)

	)

522 
	#exåa_wrôe_disc⁄√˘s
 (
disksim
->
disköfo
->
exåa_wrôe_disc⁄√˘s
)

	)

524 
	#b™d°¨t
 (
disksim
->
disköfo
->
b™d°¨t
)

	)

525 
	#sw≠_f‹w¨d_⁄ly
 (
disksim
->
disköfo
->
sw≠_f‹w¨d_⁄ly
)

	)

527 
	#addtﬁ©ícy
 (
disksim
->
disköfo
->
addtﬁ©ícy
)

	)

529 
	#disk_£ek_°›time
 (
disksim
->
disköfo
->
disk_£ek_°›time
)

	)

530 
	#disk_œ°_di°™˚
 (
disksim
->
disköfo
->
disk_œ°_di°™˚
)

	)

531 
	#disk_œ°_£ektime
 (
disksim
->
disköfo
->
disk_œ°_£ektime
)

	)

532 
	#disk_œ°_œãncy
 (
disksim
->
disköfo
->
disk_œ°_œãncy
)

	)

533 
	#disk_œ°_x„πime
 (
disksim
->
disköfo
->
disk_œ°_x„πime
)

	)

534 
	#disk_œ°_ac˘ime
 (
disksim
->
disköfo
->
disk_œ°_ac˘ime
)

	)

535 
	#disk_œ°_cy o
 (
disksim
->
disköfo
->
disk_œ°_cy o
)

	)

536 
	#disk_œ°_surÁ˚
 (
disksim
->
disköfo
->
disk_œ°_surÁ˚
)

	)

537 
	#LRU_©_£g_li°_hód
 (
disksim
->
disköfo
->
LRU_©_£g_li°_hód
)

	)

542 
	#buf„r_∑πül_£rvtime
 (
disksim
->
disköfo
->
buf„r_∑πül_£rvtime
)

	)

543 
	#ªadög_buf„r_∑πül_£rvtime
 (
disksim
->
disköfo
->
ªadög_buf„r_∑πül_£rvtime
)

	)

544 
	#buf„r_whﬁe_£rvtime
 (
disksim
->
disköfo
->
buf„r_whﬁe_£rvtime
)

	)

545 
	#ªadög_buf„r_whﬁe_£rvtime
 (
disksim
->
disköfo
->
ªadög_buf„r_whﬁe_£rvtime
)

	)

553 
disk_buf„r_°›abÀ_ac˚ss
 (
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
);

554 
disk_íabÀmít_fun˘i⁄
 (
i‹eq_evít
 *);

561 
£gmít
 * 
disk_buf„r_£À˘_£gmít
(
disk
 *
cuºdisk
,

562 
diskªq
 *
cuºdiskªq
,

563 
£t_exåadisc
);

565 
£gmít
 * 
disk_buf„r_ªcy˛abÀ_£gmít
(
disk
 *
cuºdisk
, 
i§ód
);

566 
diskªq
 * 
disk_buf„r_£g_ow√r
(
£gmít
 *
£g
, 
ef„˘ive
);

567 
disk_buf„r_©ãm±_£g_ow√rshù
(
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
);

569 
disk_buf„r_gë_max_ªadahód
(
disk
 *
cuºdisk
,

570 
£gmít
 *
£g
,

571 
i‹eq_evít
 *
cuº
);

573 
disk_buf„r_block_avaûabÀ
(
disk
 *
cuºdisk
, 
£gmít
 *
£g
, 
blkno
);

574 
disk_buf„r_ªußbÀ_£gmít_check
(
disk
 *
cuºdisk
, 
£gmít
 *
cuº£g
);

575 
disk_buf„r_ovîœp
(
£gmít
 *
£g
, 
i‹eq_evít
 *
cuº
);

576 
disk_buf„r_check_£gmíts
(
disk
 *
cuºdisk
,

577 
i‹eq_evít
 *
cuºi‹eq
,

578 *
buf„r_ªadög
);

580 
disk_buf„r_£t_£gmít
(
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
);

581 
disk_buf„r_£gmít_wøp
(
£gmít
 *
£g
, 
ídblkno
);

582 
disk_buf„r_ªmove_‰om_£g
(
diskªq
 *
cuºdiskªq
);

583 
disk_öãr„ª°©s
(
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuº
);

590 
INLINE
 
disk
 *
gëdisk
 (
diskno
);

591 
disk
 *
gëdiskby«me
(*
«me
);

593 
disk_£t_sync£t
 (
£t°¨t
, 
£ãnd
);

595 
disk_£tˇŒbacks
();

596 
disk_öôülize
();

597 
disk_ª£t°©s
();

598 
disk_¥öt°©s
();

599 
disk_¥öt£t°©s
(*
£t
, 
£tsize
, *
sour˚°r
);

600 
disk_˛ón°©s
();

602 
disk_£t_dïth
(
diskno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
);

603 
disk_gë_dïth
(
diskno
);

604 
disk_gë_öbus
(
diskno
);

605 
INLINE
 
disk_gë_bu¢o
(
i‹eq_evít
 *
cuº
);

606 
disk_gë_¶Ÿno
(
diskno
);

609 
disk_gë_maxout°™dög
(
diskno
);

611 
disk_gë_numdisks
();

614 
disk_gë_blkå™°ime
(
i‹eq_evít
 *
cuº
);

615 
disk_gë_avg_£˘≥rcyl
(
devno
);

629 
disk_evít_¨rive
(
i‹eq_evít
 *
cuº
);

631 
disk_gë_di°™˚
(
diskno
,

632 
i‹eq_evít
 *
ªq
,

633 
exa˘
,

634 
dúe˘i⁄
);

636 
disk_gë_£rvtime
(
diskno
,

637 
i‹eq_evít
 *
ªq
,

638 
checkˇche
,

639 
maxtime
);

641 
disk_gë_£ektime
(
diskno
,

642 
i‹eq_evít
 *
ªq
,

643 
checkˇche
,

644 
maxtime
);

646 
disk_gë_ac˘ime
(
diskno
,

647 
i‹eq_evít
 *
ªq
,

648 
maxtime
);

652 
disk_bus_dñay_com∂ëe
(
devno
,

653 
i‹eq_evít
 *
cuº
,

654 
£¡bu¢o
);

656 
disk_bus_ow√rshù_gø¡
(
devno
,

657 
i‹eq_evít
 *
cuº
,

658 
bu¢o
,

659 
¨bdñay
);

662 
devi˚_hódî
 
disk_hdr_öôülizî
;

664 
disk_lﬂd_sync£ts
(
Õ_block
 *
b
);

667 
disk_£tup_m≠pög
(
disk
 *
d
);

670 
disk_ac˘ime°©s
 (
disk
 *
cuºdisk
, 
di°™˚
, 
£ektime
,

671 
œãncy
, 
x„πime
, 
ac˘ime
);

673 
disk_lﬂd_sync£ts
(
Õ_block
 *
b
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_diskcache.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_iosim.h
"

103 
	~"disksim_°©.h
"

104 
	~"disksim_disk.h
"

113 
	$disk_buf„r_£gmít_wøp_√eded
 (
£gmít
 *
£g
, 
ídblkno
)

115 (
£g
->
°¨tblkno
 < (
ídblkno
 - seg->
size
));

116 
	}
}

120 
	$disk_buf„r_£gmít_wøp
 (
£gmít
 *
£g
, 
ídblkno
)

122 
£g
->
°¨tblkno
 = 
	`max
(£g->°¨tblkno, (
ídblkno
 - seg->
size
));

123 
	}
}

130 
	$disk_buf„r_ovîœp
 (
£gmít
 *
£g
, 
i‹eq_evít
 *
cuº
)

132 
tmp
;

134 i‡((
cuº
->
blkno
 >
£g
->
°¨tblkno
Ë&& (cuº->blknÿ< seg->
ídblkno
)) {

135 (
TRUE
);

138 
tmp
 = 
cuº
->
blkno
 + cuº->
bcou¡
;

139 i‡((
tmp
 > 
£g
->
°¨tblkno
Ë&& (tm∞<£g->
ídblkno
)) {

140 (
TRUE
);

143 i‡((
cuº
->
blkno
 <
£g
->
°¨tblkno
Ë&& (
tmp
 >£g->
ídblkno
)) {

144 (
TRUE
);

147 (
FALSE
);

148 
	}
}

151 
	$disk_buf„r_ªmove_‰om_£g
 (
diskªq
 *
cuºdiskªq
)

153 
£gmít
 *
£g
 = 
cuºdiskªq
->seg;

155 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

156 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_ªmove_‰om_£g\n",
simtime
,
cuºdiskªq
);

157 
	`fÊush
(
ouçutfûe
);

160 
	`ASSERT
(
£g
 !
NULL
);

162 i‡(
£g
->
diskªqli°
 =
cuºdiskªq
) {

163 
£g
->
diskªqli°
 = 
cuºdiskªq
->
£g_√xt
;

165 
diskªq
 *
tmpdiskªq
 = 
£g
->
diskªqli°
;

167 
tmpdiskªq
) {

168 i‡(
tmpdiskªq
->
£g_√xt
 =
cuºdiskªq
) {

169 
tmpdiskªq
->
£g_√xt
 = 
cuºdiskªq
->seg_next;

172 
tmpdiskªq
 =Åmpdiskªq->
£g_√xt
;

174 
	`ASSERT
(
tmpdiskªq
 !
NULL
);

176 
cuºdiskªq
->
£g
 = 
NULL
;

178 
	`ASSERT1
((
£g
->
diskªqli°
 || seg->
°©e
 !
BUFFER_DIRTY
),"seg->state",seg->state);

179 
	}
}

187 
diskªq
* 
	$disk_buf„r_£g_ow√r
 (
£gmít
 *
£g
, 
ef„˘ive
)

189 
diskªq
 *
£g_ow√r
 = 
£g
->
diskªqli°
;

190 
diskªq
 *
tmpdiskªq
 = 
£g
->
diskªqli°
;

192 
£g_ow√r
) {

193 i‡(
£g_ow√r
->
Êags
 & 
SEG_OWNED
) {

196 
£g_ow√r
 = seg_ow√r->
£g_√xt
;

199 i‡(
ef„˘ive
 && 
£g
->
ac˚ss
 && (£g->ac˚ss->
Êags
 & 
READ
)) {

200 
tmpdiskªq
) {

201 i‡((
£g
->
ªcy˛îeq
 !
tmpdiskªq
) &&

202 (!
tmpdiskªq
->
i‹eqli°
 ||

203 (
tmpdiskªq
->
i‹eqli°
->
Êags
 & 
READ
))) {

204 i‡(!
£g_ow√r
 || 
tmpdiskªq
->
outblkno
 < seg_owner->outblkno) {

205 
£g_ow√r
 = 
tmpdiskªq
;

211 
tmpdiskªq
 =Åmpdiskªq->
£g_√xt
;

215 (
£g_ow√r
);

216 
	}
}

224 
	$disk_buf„r_ªußbÀ_£gmít_check
 (
disk
 *
cuºdisk
, 
£gmít
 *
cuº£g
)

226 
diskªq
 *
cuºdiskªq
 = 
cuº£g
->
diskªqli°
;

227 
i‹eq_evít
 *
cuºi‹eq
;

229 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

230 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ E¡îög disk_buf„r_ªußbÀ_£gmít_check\n",
simtime
);

231 
	`fÊush
(
ouçutfûe
);

234 i‡(
cuºdisk
->
ac˘ime
 < 0.0 && !
cuº£g
->
ªcy˛îeq
 && 
cuºdiskªq
 &&

235 !
cuºdiskªq
->
£g_√xt
 && cuºdiskªq->
i‹eqli°
 &&

236 !(
cuºdiskªq
->
Êags
 & 
COMPLETION_RECEIVED
)) {

237 i‡(
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
) {

238 
cuºi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

239 
cuºi‹eq
->
√xt
) {

240 
cuºi‹eq
 = cuºi‹eq->
√xt
;

242 i‡((
cuºdiskªq
->
outblkno
 >
cuº£g
->
°¨tblkno
) &&

243 (
cuºdiskªq
->
outblkno
 < 
cuº£g
->
ídblkno
) &&

244 ((
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
Ë> 
cuº£g
->
°¨tblkno
) &&

245 ((
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
Ë<
cuº£g
->
ídblkno
)) {

246 i‡(!(
cuºdiskªq
->
Êags
 & 
SEG_OWNED
)) {

247 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,
cuºdiskªq
);

250 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

251 
	`Ârötf
 (
ouçutfûe
, " segmíà%8∞i†ªußbÀ\n",
cuº£g
);

252 
	`fÊush
(
ouçutfûe
);

255 (
TRUE
);

258 
cuºi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

259 
cuºi‹eq
->
√xt
) {

260 
cuºi‹eq
 = cuºi‹eq->
√xt
;

262 i‡(
cuºdiskªq
->
öblkno
 >(
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
)) {

263 i‡(!(
cuºdiskªq
->
Êags
 & 
SEG_OWNED
)) {

264 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,
cuºdiskªq
);

267 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

268 
	`Ârötf
 (
ouçutfûe
, " segmíà%8∞i†ªußbÀ\n",
cuº£g
);

269 
	`fÊush
(
ouçutfûe
);

272 (
TRUE
);

277 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

278 
	`Ârötf
 (
ouçutfûe
, " segmíà%8∞i†NOTÑeußbÀ\n",
cuº£g
);

279 
	`fÊush
(
ouçutfûe
);

282 (
FALSE
);

283 
	}
}

286 
	$disk_buf„r_ªcy˛abÀ_£gmít_check
 (
disk
 *
cuºdisk
, 
£gmít
 *
cuº£g
, 
i§ód
)

288 
diskªq
 *
cuºdiskªq
 = 
cuº£g
->
diskªqli°
;

289 
i‹eq_evít
 *
cuºi‹eq
;

291 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

292 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ E¡îög disk_buf„r_ªcy˛abÀ_£gmít_check\n",
simtime
);

293 
	`fÊush
(
ouçutfûe
);

296 i‡(
cuºdisk
->
ac˘ime
 < 0.0 && !
cuº£g
->
ªcy˛îeq
 && 
cuºdiskªq
 &&

297 !
cuºdiskªq
->
£g_√xt
 && cuºdiskªq->
i‹eqli°
 &&

298 !(
cuºdiskªq
->
Êags
 & 
COMPLETION_RECEIVED
)) {

299 i‡(
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
) {

300 i‡(
i§ód
 ||

301 (!
cuºdisk
->
dediˇãdwrôe£g
 &&

302 (
cuºdisk
->
numdúty
 < cuºdisk->
numwrôe£gs
))) {

303 
cuºi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

304 
cuºi‹eq
->
√xt
) {

305 
cuºi‹eq
 = cuºi‹eq->
√xt
;

307 i‡((
cuºdiskªq
->
outblkno
 >
cuº£g
->
°¨tblkno
) &&

308 (
cuºdiskªq
->
outblkno
 < 
cuº£g
->
ídblkno
) &&

309 ((
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
Ë> 
cuº£g
->
°¨tblkno
) &&

310 ((
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
Ë<
cuº£g
->
ídblkno
)) {

311 i‡(!(
cuºdiskªq
->
Êags
 & 
SEG_OWNED
)) {

312 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,
cuºdiskªq
);

315 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

316 
	`Ârötf
 (
ouçutfûe
, " segmíà%8∞i†ªcy˛abÀ\n",
cuº£g
);

317 
	`fÊush
(
ouçutfûe
);

320 (
TRUE
);

324 i‡(!
i§ód
 || !
cuºdisk
->
dediˇãdwrôe£g
) {

325 
cuºi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

326 
cuºi‹eq
->
√xt
) {

327 
cuºi‹eq
 = cuºi‹eq->
√xt
;

329 i‡(
cuºdiskªq
->
öblkno
 >(
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
)) {

330 i‡(!(
cuºdiskªq
->
Êags
 & 
SEG_OWNED
)) {

331 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,
cuºdiskªq
);

334 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

335 
	`Ârötf
 (
ouçutfûe
, " segmíà%8∞i†ªcy˛abÀ\n",
cuº£g
);

336 
	`fÊush
(
ouçutfûe
);

339 (
TRUE
);

345 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

346 
	`Ârötf
 (
ouçutfûe
, " segmíà%8∞i†NOTÑecy˛abÀ\n",
cuº£g
);

347 
	`fÊush
(
ouçutfûe
);

350 (
FALSE
);

351 
	}
}

354 
£gmít
* 
	$disk_buf„r_ªcy˛abÀ_£gmít
 (
disk
 *
cuºdisk
, 
i§ód
)

356 
£gmít
 *
cuº£g
 = 
cuºdisk
->
£gli°
;

358 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

359 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ E¡îög disk_buf„r_ªcy˛abÀ_£gmít\n",
simtime
);

360 
	`Ârötf
 (
ouçutfûe
, "Çumdúty = %d\n", 
cuºdisk
->
numdúty
);

361 
	`fÊush
(
ouçutfûe
);

364 i‡(
cuºdisk
->
ac˘ime
 >= 0.0) {

365 (
NULL
);

368 
cuº£g
) {

369 i‡(
	`disk_buf„r_ªcy˛abÀ_£gmít_check
(
cuºdisk
, 
cuº£g
, 
i§ód
)) {

371 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

372 
	`Ârötf
 (
ouçutfûe
, "Ñecyclable segment found\n");

373 
	`fÊush
(
ouçutfûe
);

376 (
cuº£g
);

378 
cuº£g
 = cuº£g->
√xt
;

382 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

383 
	`Ârötf
(
ouçutfûe
, " NoÑecyclable segment found\n");

384 
	`fÊush
(
ouçutfûe
);

387 (
NULL
);

388 
	}
}

396 
	$disk_buf„r_block_avaûabÀ
 (
disk
 *
cuºdisk
, 
£gmít
 *
£g
, 
blkno
)

398 
diskªq
 *
£g_ow√r
;

400 i‡(
blkno
 < 0) {

401 (
FALSE
);

403 i‡(
£g
->
°©e
 =
BUFFER_READING
) {

404 i‡((
blkno
 < 
£g
->
ídblkno
Ë&& (blknÿ>£g->
°¨tblkno
)) {

405 (
FALSE
);

407 i‡((
blkno
 < 
£g
->
°¨tblkno
) &&

408 ((!
cuºdisk
->
ªad™y‰ìblocks
) ||

409 (
£g
->
ídblkno
 !£g->
°¨tblkno
))) {

410 (
FALSE
);

412 
£g_ow√r
 = 
	`disk_buf„r_£g_ow√r
(
£g
,
TRUE
);

413 i‡(
£g_ow√r
 && !(£g_ow√r->
Êags
 & 
COMPLETION_SENT
) &&

414 ((
blkno
 - 
£g_ow√r
->
outblkno
Ë>
£g
->
size
)) {

415 (
FALSE
);

417 } i‡(
£g
->
°©e
 =
BUFFER_WRITING
) {

418 i‡((
blkno
 < 
cuºdisk
->
ef„˘ivehda
->
öblkno
) ||

419 (
blkno
 >
£g
->
ídblkno
)) {

420 (
FALSE
);

422 i‡((
cuºdisk
->
ef„˘ivehda
->
i‹eqli°
) &&

423 (
cuºdisk
->
exåa_wrôe_disc⁄√˘
)) {

424 i‡(
cuºdisk
->
ef„˘ivehda
->
i‹eqli°
->
bcou¡
 < 45) {

425 i‡((
£g
->
ídblkno
 - seg->
°¨tblkno
) <

426 
	`mö
(
cuºdisk
->
ef„˘ivehda
->
i‹eqli°
->
bcou¡
, 10)) {

427 (
FALSE
);

430 i‡((
£g
->
ídblkno
 - seg->
°¨tblkno
) < 15) {

431 (
FALSE
);

436 
	`Ârötf
(
°dîr
, "Notáctively using diskát disk_buffer_block_available\n");

437 
	`exô
(1);

439 (
TRUE
);

440 
	}
}

447 
	$disk_öãr„ª°©s
 (
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuº
)

449 i‡(!
devi˚_¥ötöãr„ª°©s
) {

453 i‡((
cuº
->
ˇu£
 !
cuºdisk
->
œ°gí
Ë&& (cuº->
Êags
 & (
SEQ
|
LOCAL
))) {

454 i‡(
cuº
->
Êags
 & 
SEQ
) {

455 
cuºdisk
->
°©
.
öãr„ª
[0]++;

457 
cuºdisk
->
°©
.
öãr„ª
[1]++;

460 
cuºdisk
->
œ°gí
 = 
cuº
->
ˇu£
;

461 
	}
}

464 
	$disk_buf„r_°©s
 (
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuº
, 
£gmít
 *
£g
, 
hôty≥
)

466 
size
;

468 i‡(!
devi˚_¥ötbuf„r°©s
) {

474 
hôty≥
) {

476 
BUFFER_NOMATCH
:

477 i‡(
cuº
->
Êags
 & 
READ
) {

478 
cuºdisk
->
°©
.
ªadmis£s
++;

480 
cuºdisk
->
°©
.
wrôemis£s
++;

484 
BUFFER_WHOLE
:

485 
cuºdisk
->
°©
.
fuŒªadhôs
++;

488 
BUFFER_APPEND
:

489 
cuºdisk
->
°©
.
≠≥ndhôs
++;

492 
BUFFER_PREPEND
:

493 
cuºdisk
->
°©
.
¥ïídhôs
++;

496 
BUFFER_PARTIAL
:

497 i‡(
£g
->
°¨tblkno
 <
cuº
->
blkno
) {

498 
size
 = (Ë(
£g
->
ídblkno
 - 
cuº
->
blkno
);

503 
	`Ârötf
(
°dîr
, "Tail hitsÇot currentlyállowed.\n");

504 
	`exô
(1);

506 i‡(
£g
->
°©e
 =
BUFFER_READING
) {

510 
cuºdisk
->
°©
.
ªadöghôs
++;

511 
cuºdisk
->
°©
.
ruƒódögsize
 +
size
;

512 
cuºdisk
->
°©
.
ªmªadögsize
 +
cuº
->
bcou¡
 - 
size
;

517 
cuºdisk
->
°©
.
∑πhôs
++;

518 
cuºdisk
->
°©
.
ru≈¨tsize
 +
size
;

519 
cuºdisk
->
°©
.
ªm∑πsize
 +
cuº
->
bcou¡
 - 
size
;

524 
	`Ârötf
(
°dîr
, "InvÆid hôty≥ i¿disk_buf„r_°©†- blknÿ%d, bcou¡ %d, sèã %d\n", 
cuº
->
blkno
, cuº->
bcou¡
, 
£g
->
°©e
);

525 
	`exô
(1);

528 
	}
}

580 
£gmít
 *

581 
	$disk_buf„r_£À˘_ªad_£gmít
(
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
)

583 
£gmít
 *
£g
;

584 
i‹eq_evít
 *
fú°_i‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

585 
i‹eq_evít
 *
tmpi‹eq
;

586 
be°_vÆue
 = 0;

587 
cuº_vÆue
;

588 
cuº_hôty≥
 = 0;

590 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

591 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_£À˘_ªad_£gmít\n",
simtime
,
cuºdiskªq
);

592 
	`fÊush
(
ouçutfûe
);

595 
cuºdiskªq
->
£g
 = 
NULL
;

596 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

597 
£g
 = 
cuºdisk
->
£gli°
;

598 
£g
) {

599 
cuº_vÆue
 = -1;

600 i‡(
cuºdiskªq
->
hôty≥
 =
BUFFER_COLLISION
) { }

601 i‡(
£g
->
ªcy˛îeq
) { }

602 i‡((
cuºdisk
->
dediˇãdwrôe£g
)

603 && (
£g
 =
cuºdisk
->
dediˇãdwrôe£g
))

606 i‡((
£g
->
°©e
 =
BUFFER_DIRTY
)

607 || (
£g
->
°©e
 =
BUFFER_WRITING
))

609 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

610 
tmpi‹eq
) {

611 i‡(
	`disk_buf„r_ovîœp
(
£g
,
tmpi‹eq
)) {

612 i‡(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

613 
cuºdiskªq
->
hôty≥
 = 
BUFFER_COLLISION
;

614 
cuºdiskªq
->
£g
 = 
NULL
;

618 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

622 i‡(
£g
->
°©e
 =
BUFFER_EMPTY
) {

623 
cuº_vÆue
 = 3;

624 
cuº_hôty≥
 = 
BUFFER_NOMATCH
;

626 i‡((
fú°_i‹eq
->
blkno
 < 
£g
->
°¨tblkno
)

627 || (
fú°_i‹eq
->
blkno
 >
£g
->
ídblkno
))

629 
cuº_hôty≥
 = 
BUFFER_NOMATCH
;

630 i‡((
£g
->
°©e
 =
BUFFER_CLEAN
Ë&& !(£g->
diskªqli°
)) {

631 
cuº_vÆue
 = 2;

633 i‡(
£g
->
°©e
 =
BUFFER_READING
) {

634 i‡((
£g
->
ídblkno
 =
fú°_i‹eq
->
blkno
) &&

635 
cuºdisk
->
Æmo°ªadhôs
) {

640 
cuº_hôty≥
 = 
BUFFER_PARTIAL
;

641 
cuº_vÆue
 = 5;

644 i‡(!
£g
->
diskªqli°
->
i‹eqli°
) {

645 
cuº_vÆue
 = 1;

649 i‡((
fú°_i‹eq
->
blkno
 < 
£g
->
°¨tblkno
)

650 && ((
£g
->
°©e
 =
BUFFER_DIRTY
)

651 || (
£g
->
°©e
 =
BUFFER_WRITING
)))

654 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

655 
tmpi‹eq
) {

656 i‡(
	`disk_buf„r_ovîœp
(
£g
,
tmpi‹eq
)) {

657 i‡(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

658 
cuºdiskªq
->
hôty≥
 = 
BUFFER_COLLISION
;

659 
cuºdiskªq
->
£g
 = 
NULL
;

663 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

668 
£g
->
°©e
) {

669 
BUFFER_DIRTY
:

670 i‡(
cuºdisk
->
íabÀˇche
) {

671 i‡((
cuºdisk
->
ªadhôs⁄wrôed©a
)

672 && (
be°_vÆue
 < 10)) {

673 
cuº_vÆue
 = 11;

676 i‡(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

677 
cuºdiskªq
->
hôty≥
 = 
BUFFER_COLLISION
;

678 
cuºdiskªq
->
£g
 = 
NULL
;

683 
BUFFER_WRITING
:

684 i‡(
cuºdisk
->
íabÀˇche
) {

685 i‡((
cuºdisk
->
ªadhôs⁄wrôed©a
)

686 && (
be°_vÆue
 < 10))

688 
cuº_vÆue
 = 10;

691 i‡(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

692 
cuºdiskªq
->
hôty≥
 = 
BUFFER_COLLISION
;

693 
cuºdiskªq
->
£g
 = 
NULL
;

698 
BUFFER_READING
:

699 i‡(
cuºdisk
->
íabÀˇche
) {

700 
cuº_vÆue
 = 9;

703 
BUFFER_CLEAN
:

704 i‡(
cuºdisk
->
ªadhôs⁄wrôed©a


705 || (
£g
->
ac˚ss
 && (£g->ac˚ss->
Êags
 & 
READ
)))

707 
cuº_vÆue
 = 8;

712 
	`ddbg_as£π
(0);

715 i‡(
£g
->
ídblkno
 >(
fú°_i‹eq
->
blkno
 + fú°_i‹eq->
bcou¡
)) {

716 
cuº_hôty≥
 = 
BUFFER_WHOLE
;

719 
cuº_hôty≥
 = 
BUFFER_PARTIAL
;

720 
cuº_vÆue
 -= 4;

724 i‡(
cuº_vÆue
 > 
be°_vÆue
) {

725 
cuºdiskªq
->
£g
 = seg;

726 
cuºdiskªq
->
hôty≥
 = 
cuº_hôty≥
;

727 
be°_vÆue
 = 
cuº_vÆue
;

729 
£g
 = seg->
√xt
;

736 i‡((
be°_vÆue
 == 1)

737 && !
	`disk_buf„r_°›abÀ_ac˚ss
(
cuºdisk
,
cuºdiskªq
))

739 
cuºdiskªq
->
£g
 = 
NULL
;

742 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

743 
	`Ârötf
 (
ouçutfûe
, " segmíà%8p, hôty≥ = %d\n",
cuºdiskªq
->
£g
,cuºdiskªq->
hôty≥
);

744 
	`fÊush
(
ouçutfûe
);

747  
cuºdiskªq
->
£g
;

748 
	}
}

776 
£gmít
* 
	$disk_buf„r_£À˘_wrôe_£gmít
(
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
)

778 
£gmít
 *
£g
;

779 
diskªq
 *
tmp_diskªq
;

780 
diskªq
 *
hﬁddiskªq
;

781 
i‹eq_evít
 *
fú°_i‹eq
;

782 
i‹eq_evít
 *
œ°_i‹eq
;

783 
i‹eq_evít
 *
tmpi‹eq
;

784 
be°_vÆue
 = 0;

785 
cuº_vÆue
;

786 
cuº_hôty≥
;

791 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

792 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_£À˘_wrôe_£gmít\n",
simtime
,
cuºdiskªq
);

793 
	`Ârötf
 (
ouçutfûe
, "Çumdúty = %d\n", 
cuºdisk
->
numdúty
);

794 
	`fÊush
(
ouçutfûe
);

797 
cuºdiskªq
->
£g
 = 
NULL
;

798 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

799 
£g
 = 
cuºdisk
->
£gli°
;

800 
£g
) {

801 
cuº_vÆue
 = -1;

802 
cuº_hôty≥
 = 
BUFFER_NOMATCH
;

803 i‡(
cuºdiskªq
->
hôty≥
 =
BUFFER_COLLISION
) {

804 } i‡(
£g
->
ªcy˛îeq
) {

805 } i‡((
cuºdisk
->
dediˇãdwrôe£g
) &&

806 (
£g
 !
cuºdisk
->
dediˇãdwrôe£g
)) {

808 i‡(((
£g
->
°©e
 =
BUFFER_CLEAN
) &&

809 (
£g
->
diskªqli°
)) ||

810 ((
£g
->
°©e
 =
BUFFER_READING
) &&

811 ((
£g
->
diskªqli°
->
i‹eqli°
) ||

812 (
£g
->
diskªqli°
->
£g_√xt
) ||

813 !
	`disk_buf„r_°›abÀ_ac˚ss
(
cuºdisk
,
cuºdiskªq
)))) {

814 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

815 
tmpi‹eq
) {

816 i‡(
	`disk_buf„r_ovîœp
(
£g
,
tmpi‹eq
)) {

817 i‡(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

818 
cuºdiskªq
->
hôty≥
 = 
BUFFER_COLLISION
;

819 
cuºdiskªq
->
£g
 = 
NULL
;

823 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

826 } i‡(
£g
->
°©e
 =
BUFFER_EMPTY
) {

827 i‡(
cuºdisk
->
numdúty
 < cuºdisk->
numwrôe£gs
) {

831 
cuº_vÆue
 = 3;

833 } i‡(
£g
->
°©e
 =
BUFFER_READING
) {

834 i‡(!
£g
->
diskªqli°
->
i‹eqli°
 && !£g->diskªqli°->
£g_√xt
) {

835 i‡(
cuºdisk
->
numdúty
 < cuºdisk->
numwrôe£gs
) {

839 
cuº_vÆue
 = 1;

842 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

843 
tmpi‹eq
) {

844 i‡(
	`disk_buf„r_ovîœp
(
£g
,
tmpi‹eq
)) {

845 i‡(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

846 
cuºdiskªq
->
hôty≥
 = 
BUFFER_COLLISION
;

847 
cuºdiskªq
->
£g
 = 
NULL
;

851 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

854 } i‡(
£g
->
°©e
 =
BUFFER_CLEAN
) {

855 i‡(!
£g
->
diskªqli°
) {

856 i‡(
cuºdisk
->
numdúty
 < cuºdisk->
numwrôe£gs
) {

860 
cuº_vÆue
 = 2;

861 
fú°_i‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

862 
fú°_i‹eq
) {

863 i‡(
	`disk_buf„r_ovîœp
(
£g
,
fú°_i‹eq
)) {

864 
cuº_vÆue
 = 4;

867 
fú°_i‹eq
 = fú°_i‹eq->
√xt
;

872 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

873 
tmpi‹eq
) {

874 i‡(
	`disk_buf„r_ovîœp
(
£g
,
tmpi‹eq
)) {

875 i‡(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

876 
cuºdiskªq
->
hôty≥
 = 
BUFFER_COLLISION
;

877 
cuºdiskªq
->
£g
 = 
NULL
;

881 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

884 } i‡((!
cuºdisk
->
wrôecomb
) ||

885 (
£g
->
out°©e
 =
BUFFER_TRANSFERING
)) {

888 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

889 
tmpi‹eq
) {

890 i‡(
	`disk_buf„r_ovîœp
(
£g
,
tmpi‹eq
)) {

891 i‡(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

892 
cuºdiskªq
->
hôty≥
 = 
BUFFER_COLLISION
;

893 
cuºdiskªq
->
£g
 = 
NULL
;

897 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

912 
fú°_i‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

913 
tmp_diskªq
 = 
hﬁddiskªq
 = 
£g
->
diskªqli°
;

914 
tmp_diskªq
->
£g_√xt
) {

915 
tmp_diskªq
 =Åmp_diskªq->
£g_√xt
;

916 i‡(!(
tmp_diskªq
->
i‹eqli°
->
Êags
 & 
READ
)) {

917 
hﬁddiskªq
 = 
tmp_diskªq
;

920 
œ°_i‹eq
 = 
hﬁddiskªq
->
i‹eqli°
;

921 
œ°_i‹eq
 &&Üa°_i‹eq->
√xt
) {

922 
œ°_i‹eq
 =Üa°_i‹eq->
√xt
;

924 i‡((
fú°_i‹eq
->
blkno
 =(
œ°_i‹eq
->blknÿ+Üa°_i‹eq->
bcou¡
)) &&

925 (
fú°_i‹eq
->
blkno
 =
£g
->
ídblkno
) &&

926 (
£g
->
size
 > (
fú°_i‹eq
->
blkno
 - (
	`disk_buf„r_£g_ow√r
(£g,
FALSE
))->
öblkno
))) {

927 
cuº_hôty≥
 = 
BUFFER_APPEND
;

928 
cuº_vÆue
 = ((
£g
->
°©e
 =
BUFFER_WRITING
) ? 7 : 6);

929 } i‡(
£g
->
°©e
 =
BUFFER_DIRTY
) {

930 
tŸÆ_bcou¡
 = 
cuºdiskªq
->
i‹eqli°
->
bcou¡
;

932 
œ°_i‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

933 
œ°_i‹eq
->
√xt
) {

934 
œ°_i‹eq
 =Üa°_i‹eq->
√xt
;

935 
tŸÆ_bcou¡
 +
œ°_i‹eq
->
bcou¡
;

937 
hﬁddiskªq
 = 
£g
->
diskªqli°
;

938 
hﬁddiskªq
->
i‹eqli°
->
Êags
 & 
READ
) {

939 
hﬁddiskªq
 = hﬁddiskªq->
£g_√xt
;

941 
fú°_i‹eq
 = 
hﬁddiskªq
->
i‹eqli°
;

942 i‡((
fú°_i‹eq
->
blkno
 =(
œ°_i‹eq
->blknÿ+Üa°_i‹eq->
bcou¡
)) &&

943 (
fú°_i‹eq
->
blkno
 =
£g
->
°¨tblkno
) &&

944 ((
£g
->
°¨tblkno
 =£g->
ídblkno
Ë|| (£g->
hﬁd_bcou¡
 == 0)) &&

945 (
£g
->
size
 >((£g->
ídblkno
 - seg->
°¨tblkno
Ë+ 
tŸÆ_bcou¡
)) &&

946 (!
cuºdisk
->
exåadisc_diskªq
 ||

947 (
cuºdisk
->
exåadisc_diskªq
->
£g
 != seg))) {

948 
cuº_hôty≥
 = 
BUFFER_PREPEND
;

949 
cuº_vÆue
 = 5;

952 i‡(
cuº_hôty≥
 =
BUFFER_NOMATCH
) {

954 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

955 
tmpi‹eq
) {

956 i‡(
	`disk_buf„r_ovîœp
(
£g
,
tmpi‹eq
)) {

957 i‡(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

958 
cuºdiskªq
->
hôty≥
 = 
BUFFER_COLLISION
;

959 
cuºdiskªq
->
£g
 = 
NULL
;

963 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

979 i‡(
cuº_vÆue
 > 
be°_vÆue
) {

980 
cuºdiskªq
->
£g
 = seg;

981 
cuºdiskªq
->
hôty≥
 = 
cuº_hôty≥
;

982 
be°_vÆue
 = 
cuº_vÆue
;

984 
£g
 = seg->
√xt
;

991 i‡((
be°_vÆue
 == 1) &&

992 !
	`disk_buf„r_°›abÀ_ac˚ss
(
cuºdisk
,
cuºdiskªq
)) {

994 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

995 
tmpi‹eq
) {

996 i‡(
	`disk_buf„r_ovîœp
(
cuºdiskªq
->
£g
,
tmpi‹eq
)) {

997 i‡(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

998 
cuºdiskªq
->
hôty≥
 = 
BUFFER_COLLISION
;

1002 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

1004 
cuºdiskªq
->
£g
 = 
NULL
;

1007 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1008 
	`Ârötf
 (
ouçutfûe
, " segmíà%8p, hôty≥ = %d\n",
cuºdiskªq
->
£g
,cuºdiskªq->
hôty≥
);

1009 
	`fÊush
(
ouçutfûe
);

1012 (
cuºdiskªq
->
£g
);

1013 
	}
}

1016 
£gmít
 * 
	$disk_buf„r_£À˘_£gmít
 (
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
,

1017 
£t_exåadisc
)

1019 
£gmít
 *
£g
;

1021 i‡(
cuºdisk
->
c⁄°_ac˘ime
) {

1022 
cuºdiskªq
->
£g
 = 
NULL
;

1023 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

1024 (
NULL
);

1027 if(
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
) {

1028 
£g
 = 
	`disk_buf„r_£À˘_ªad_£gmít
(
cuºdisk
, 
cuºdiskªq
);

1029 i‡(
cuºdisk
->
dediˇãdwrôe£g
 && (
£g
 == currdisk->dedicatedwriteseg)) {

1030 
	`Ârötf
(
°dîr
, "ReadÑequestáboutÅo useÅhe write segment\n");

1031 
	`exô
(1);

1035 
£g
 = 
	`disk_buf„r_£À˘_wrôe_£gmít
(
cuºdisk
, 
cuºdiskªq
);

1042 i‡(
£t_exåadisc


1043 && 
cuºdisk
->
exåa_wrôe_disc⁄√˘


1044 && !
cuºdisk
->
√vîdisc⁄√˘


1045 && !
cuºdisk
->
exåadisc_diskªq


1046 && !(
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
)

1047 && 
£g


1048 && ((
LRU_©_£g_li°_hód
 && !
£g
->
¥ev
)

1049 || (!
LRU_©_£g_li°_hód
 && !
£g
->
√xt
))

1050 && 
£g
->
ac˚ss


1051 && !(
£g
->
ac˚ss
->
Êags
 & 
READ
)

1052 && (
cuºdiskªq
->
i‹eqli°
->
blkno
 !
£g
->
ídblkno
))

1054 
cuºdiskªq
->
Êags
 |
EXTRA_WRITE_DISCONNECT
;

1056 (
£g
);

1057 
	}
}

1062 
	$disk_buf„r_check_ªad_£gmíts
 (
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuºi‹eq
, * 
buf„r_ªadög
)

1064 
£gmít
 *
£g
;

1065 
ªtu∫_hôty≥
 = 
BUFFER_NOMATCH
;

1066 
ªad_hô_⁄_dúty_d©a
 = 
FALSE
;

1068 i‡((
disk_¥öthack
 > 1Ë&& (
simtime
 >
disk_¥öthacktime
)) {

1069 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_check_ªad_£gmíts\n",
simtime
,
cuºi‹eq
);

1070 
	`fÊush
(
ouçutfûe
);

1073 i‡(!
cuºdisk
->
íabÀˇche
) {

1074 (
BUFFER_NOMATCH
);

1077 
£g
 = 
cuºdisk
->
£gli°
;

1078 
£g
) {

1079 i‡(
£g
->
ªcy˛îeq
) {

1080 } i‡(
£g
->
°©e
 =
BUFFER_EMPTY
) {

1081 } i‡((
cuºdisk
->
dediˇãdwrôe£g
) &&

1082 (
£g
 =
cuºdisk
->
dediˇãdwrôe£g
)) {

1084 i‡((
£g
->
°©e
 =
BUFFER_DIRTY
Ë|| (£g->°©ê=
BUFFER_WRITING
)) {

1085 i‡(
	`disk_buf„r_ovîœp
(
£g
,
cuºi‹eq
) &&

1086 !
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

1087 (
BUFFER_COLLISION
);

1090 } i‡((
cuºi‹eq
->
blkno
 < 
£g
->
°¨tblkno
) ||

1091 (
cuºi‹eq
->
blkno
 >
£g
->
ídblkno
)) {

1092 i‡(
£g
->
°©e
 =
BUFFER_CLEAN
) {

1093 } i‡(
£g
->
°©e
 =
BUFFER_READING
) {

1094 i‡((
£g
->
ídblkno
 =
cuºi‹eq
->
blkno
) &&

1095 
cuºdisk
->
Æmo°ªadhôs
) {

1100 i‡(
ªtu∫_hôty≥
 =
BUFFER_NOMATCH
) {

1101 *
buf„r_ªadög
 = 
TRUE
;

1102 
ªtu∫_hôty≥
 = 
BUFFER_PARTIAL
;

1105 } i‡(
cuºi‹eq
->
blkno
 < 
£g
->
°¨tblkno
) {

1107 i‡(
	`disk_buf„r_ovîœp
(
£g
,
cuºi‹eq
) &&

1108 !
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

1109 (
BUFFER_COLLISION
);

1113 
£g
->
°©e
) {

1114 
BUFFER_DIRTY
:

1115 
BUFFER_WRITING
:

1116 i‡(
ªad_hô_⁄_dúty_d©a
 ||

1117 (!
cuºdisk
->
ªadhôs⁄wrôed©a
 &&

1118 !
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
))) {

1119 (
BUFFER_COLLISION
);

1121 
ªad_hô_⁄_dúty_d©a
 = 
TRUE
;

1123 
BUFFER_READING
:

1125 
BUFFER_CLEAN
:

1126 i‡(!
cuºdisk
->
ªadhôs⁄wrôed©a
 &&

1127 
£g
->
ac˚ss
 && !(£g->ac˚ss->
Êags
 & 
READ
)) {

1132 
	`ddbg_as£π
(0);

1134 i‡(
£g
->
ídblkno
 >(
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
)) {

1135 
ªtu∫_hôty≥
 = 
BUFFER_WHOLE
;

1136 *
buf„r_ªadög
 = (
£g
->
°©e
 =
BUFFER_READING
);

1137 } i‡(
ªtu∫_hôty≥
 !
BUFFER_WHOLE
) {

1138 
ªtu∫_hôty≥
 = 
BUFFER_PARTIAL
;

1139 *
buf„r_ªadög
 = (
£g
->
°©e
 =
BUFFER_READING
);

1142 
£g
 = seg->
√xt
;

1145 i‡((
disk_¥öthack
 > 1Ë&& (
simtime
 >
disk_¥öthacktime
) &&

1146 (
ªtu∫_hôty≥
 !
BUFFER_NOMATCH
)) {

1147 
	`Ârötf
 (
ouçutfûe
, " HITable segment found\n");

1148 
	`fÊush
(
ouçutfûe
);

1151 (
ªtu∫_hôty≥
);

1153 
	}
}

1158 
	$disk_buf„r_check_wrôe_£gmíts
 (
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuºi‹eq
)

1160 
£gmít
 *
£g
;

1161 
ªtu∫_hôty≥
 = 
BUFFER_NOMATCH
;

1162 
diskªq
 *
tmp_diskªq
;

1163 
diskªq
 *
hﬁddiskªq
;

1164 
i‹eq_evít
 *
œ°_i‹eq
;

1166 i‡((
disk_¥öthack
 > 1Ë&& (
simtime
 >
disk_¥öthacktime
)) {

1167 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_check_wrôe_£gmíts\n",
simtime
,
cuºi‹eq
);

1168 
	`fÊush
(
ouçutfûe
);

1171 i‡(!
cuºdisk
->
wrôecomb
) {

1172 (
BUFFER_NOMATCH
);

1175 
£g
 = 
cuºdisk
->
£gli°
;

1176 
£g
) {

1177 i‡(
£g
->
ªcy˛îeq
) {

1179 i‡(
£g
->
°©e
 =
BUFFER_EMPTY
) {

1181 i‡(
£g
->
°©e
 =
BUFFER_READING
) {

1182 (
BUFFER_NOMATCH
);

1184 i‡((
cuºdisk
->
dediˇãdwrôe£g
) &&

1185 (
£g
 !
cuºdisk
->
dediˇãdwrôe£g
)) {

1187 i‡((
£g
->
°©e
 =
BUFFER_CLEAN
Ë&& seg->
diskªqli°
) {

1188 i‡(
	`disk_buf„r_ovîœp
(
£g
,
cuºi‹eq
) &&

1189 !
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

1190 (
BUFFER_COLLISION
);

1194 i‡((
£g
->
°©e
 =
BUFFER_CLEAN
) ||

1195 (
£g
->
°©e
 =
BUFFER_DIRTY
))

1198 i‡(
£g
->
diskªqli°
) {

1199 i‡(
	`disk_buf„r_ovîœp
(
£g
,
cuºi‹eq
) &&

1200 !
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

1201 (
BUFFER_COLLISION
);

1205 i‡(
£g
->
out°©e
 =
BUFFER_TRANSFERING
) {

1207 i‡(
	`disk_buf„r_ovîœp
(
£g
,
cuºi‹eq
) &&

1208 !
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

1209 (
BUFFER_COLLISION
);

1213 
tmp_diskªq
 = 
hﬁddiskªq
 = 
£g
->
diskªqli°
;

1214 
tmp_diskªq
->
£g_√xt
) {

1215 
tmp_diskªq
 =Åmp_diskªq->
£g_√xt
;

1216 i‡(!(
tmp_diskªq
->
i‹eqli°
->
Êags
 & 
READ
)) {

1217 
hﬁddiskªq
 = 
tmp_diskªq
;

1220 
œ°_i‹eq
 = 
hﬁddiskªq
->
i‹eqli°
;

1221 
œ°_i‹eq
 &&Üa°_i‹eq->
√xt
) {

1222 
œ°_i‹eq
 =Üa°_i‹eq->
√xt
;

1224 i‡((
cuºi‹eq
->
blkno
 =(
œ°_i‹eq
->blknÿ+Üa°_i‹eq->
bcou¡
)) &&

1225 (
cuºi‹eq
->
blkno
 =
£g
->
ídblkno
) &&

1226 (
£g
->
size
 > (
cuºi‹eq
->
blkno
 - (
	`disk_buf„r_£g_ow√r
(£g,
FALSE
))->
öblkno
))) {

1227 
ªtu∫_hôty≥
 = 
BUFFER_APPEND
;

1231 i‡(
	`disk_buf„r_ovîœp
(
£g
,
cuºi‹eq
) &&

1232 !
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
, 
£g
)) {

1233 (
BUFFER_COLLISION
);

1237 
£g
 = seg->
√xt
;

1240 i‡((
disk_¥öthack
 > 1Ë&& (
simtime
 >
disk_¥öthacktime
) &&

1241 (
ªtu∫_hôty≥
 =
BUFFER_APPEND
)) {

1242 
	`Ârötf
 (
ouçutfûe
, " APPENDable segment found\n");

1243 
	`fÊush
(
ouçutfûe
);

1246 (
ªtu∫_hôty≥
);

1247 
	}
}

1252 
	$disk_buf„r_check_£gmíts
 (
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuºi‹eq
,

1253 * 
buf„r_ªadög
)

1255 i‡(
cuºi‹eq
->
Êags
 & 
READ
) {

1256 (
	`disk_buf„r_check_ªad_£gmíts
(
cuºdisk
, 
cuºi‹eq
, 
buf„r_ªadög
));

1258 (
	`disk_buf„r_check_wrôe_£gmíts
(
cuºdisk
, 
cuºi‹eq
));

1260 
	}
}

1263 
	$disk_buf„r_£t_£gmít
 (
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
)

1265 
£gmít
 *
£g
 = 
cuºdiskªq
->seg;

1266 
£gmít
 *
tmp_£g
;

1267 
diskªq
 *
tmp_diskªq
;

1268 
i‹eq_evít
 *
tmp_i‹eq
;

1269 
is_ªad
 = (
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
);

1271 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1272 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_£t_£gmít\n",
simtime
,
cuºdiskªq
);

1273 
	`fÊush
(
ouçutfûe
);

1276 i‡(!
£g
) {

1277 
	`Ârötf
(
°dîr
, "diskreq has NULL segment in disk_buffer_set_segment\n");

1278 
	`exô
(1);

1283 i‡(
is_ªad
 && (
£g
 =
cuºdisk
->
dediˇãdwrôe£g
)) {

1284 
	`Ârötf
(
°dîr
, "ReadÑequestáboutÅo useÅhe write segment\n");

1285 
	`exô
(1);

1288 i‡(
£g
->
ªcy˛îeq
 && (
cuºdiskªq
 != seg->recyclereq)) {

1289 
	`Ârötf
(
°dîr
, "non-recyclereq detected forÑecycled segment in disk_buffer_set_segment\n");

1290 
	`exô
(1);

1293 
£g
->
°©e
) {

1294 
BUFFER_EMPTY
:

1295 i‡(
cuºdiskªq
 =
£g
->
ªcy˛îeq
) {

1296 
	`Ârötf
(
°dîr
, "seg->state of BUFFER_EMPTY forÑecyclereq in disk_buffer_set_segment\n");

1297 
	`exô
(1);

1301 
BUFFER_CLEAN
:

1302 i‡(
cuºdiskªq
 =
£g
->
ªcy˛îeq
) {

1303 
	`Ârötf
(
°dîr
, "seg->state of BUFFER_CLEAN forÑecyclereq in disk_buffer_set_segment\n");

1304 
	`exô
(1);

1306 i‡(
is_ªad
 && 
cuºdiskªq
->
hôty≥
 !
BUFFER_NOMATCH
 && !
cuºdisk
->
ªadhôs⁄wrôed©a
 && 
£g
->
ac˚ss
 && !(£g->ac˚ss->
Êags
 & 
READ
)) {

1307 
	`Ârötf
(
°dîr
, "UnallowedÑead hit on write data disk_buffer_set_segment\n");

1308 
	`exô
(1);

1312 
BUFFER_DIRTY
:

1313 i‡(
cuºdiskªq
 =
£g
->
ªcy˛îeq
) {

1314 
	`Ârötf
(
°dîr
, "seg->state of BUFFER_DIRTY forÑecyclereq in disk_buffer_set_segment\n");

1315 
	`exô
(1);

1317 i‡(
cuºdiskªq
->
hôty≥
 =
BUFFER_NOMATCH
) {

1318 
	`Ârötf
(
°dîr
, "AttemptÅo overwrite dirty data in disk_buffer_set_segment\n");

1319 
	`exô
(1);

1320 } i‡(
is_ªad
 && !
cuºdisk
->
ªadhôs⁄wrôed©a
) {

1321 
	`Ârötf
(
°dîr
, "UnallowedÑead hit on write data disk_buffer_set_segment\n");

1322 
	`exô
(1);

1324 i‡(!
is_ªad
) {

1325 
cuºdisk
->
°©
.
wrôecombs
++;

1329 
BUFFER_READING
:

1330 i‡(
cuºdiskªq
 =
£g
->
ªcy˛îeq
) {

1331 i‡(!(
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
)) {

1332 
	`Ârötf
(
°dîr
, "seg->state of BUFFER_READING for writeÑecyclereq in disk_buffer_set_segment\n");

1333 
	`exô
(1);

1335 } i‡(!
is_ªad
 || (
cuºdiskªq
->
hôty≥
 =
BUFFER_NOMATCH
)) {

1336 i‡(!
	`disk_buf„r_°›abÀ_ac˚ss
(
cuºdisk
,
cuºdiskªq
)) {

1337 
	`Ârötf
(
°dîr
, "AttemptÅoÑe-targetáctiveÑead segment in disk_buffer_set_segment\n");

1338 
	`exô
(1);

1343 
BUFFER_WRITING
:

1344 i‡(
cuºdiskªq
 =
£g
->
ªcy˛îeq
) {

1345 i‡(
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
) {

1346 
	`Ârötf
(
°dîr
, "seg->state of BUFFER_WRITING forÑeadÑecyclereq in disk_buffer_set_segment\n");

1347 
	`exô
(1);

1350 i‡((
cuºdiskªq
->
hôty≥
 =
BUFFER_NOMATCH
) ||

1351 (
cuºdiskªq
->
hôty≥
 =
BUFFER_PREPEND
)) {

1352 
	`Ârötf
(
°dîr
, "AttemptÅoÑe-targetáctive write segment in disk_buffer_set_segment\n");

1353 
	`exô
(1);

1355 i‡(!
is_ªad
) {

1356 
cuºdisk
->
°©
.
wrôecombs
++;

1362 
	`Ârötf
(
°dîr
, "InvÆid segmíà°©êö disk_buf„r_£t_£gmíà- blknÿ%d, bcou¡ %d, sèã %d\n", 
cuºdiskªq
->
i‹eqli°
->
blkno
, cuºdiskªq->i‹eqli°->
bcou¡
, 
£g
->
°©e
);

1363 
	`exô
(1);

1368 
	`disk_buf„r_°©s
(
cuºdisk
,
cuºdiskªq
->
i‹eqli°
,
£g
,cuºdiskªq->
hôty≥
);

1370 i‡(
LRU_©_£g_li°_hód
) {

1372 i‡(
£g
->
¥ev
) {

1373 
£g
->
¥ev
->
√xt
 = seg->next;

1374 i‡(
£g
->
√xt
) {

1375 
£g
->
√xt
->
¥ev
 = seg->prev;

1377 
£g
->
√xt
 = 
cuºdisk
->
£gli°
;

1378 
cuºdisk
->
£gli°
->
¥ev
 = 
£g
;

1379 
£g
->
¥ev
 = 
NULL
;

1380 
cuºdisk
->
£gli°
 = 
£g
;

1384 i‡(
£g
->
√xt
) {

1385 i‡(
£g
->
¥ev
) {

1386 
£g
->
¥ev
->
√xt
 = seg->next;

1388 
cuºdisk
->
£gli°
 = 
£g
->
√xt
;

1390 
£g
->
√xt
->
¥ev
 = seg->prev;

1391 
tmp_£g
 = 
cuºdisk
->
£gli°
;

1392 
tmp_£g
->
√xt
) {

1393 
tmp_£g
 =Åmp_£g->
√xt
;

1395 
tmp_£g
->
√xt
 = 
£g
;

1396 
£g
->
¥ev
 = 
tmp_£g
;

1397 
£g
->
√xt
 = 
NULL
;

1403 i‡(!
is_ªad
) {

1404 
tmp_£g
 = 
cuºdisk
->
£gli°
;

1405 
tmp_£g
) {

1406 i‡(
tmp_£g
 !
£g
) {

1407 
tmp_i‹eq

cuºdiskªq
->
i‹eqli°
;

1408 
tmp_i‹eq
) {

1409 i‡((
tmp_£g
->
°©e
 !
BUFFER_EMPTY
) &&

1410 
	`disk_buf„r_ovîœp
(
tmp_£g
,
tmp_i‹eq
)) {

1411 i‡((
tmp_£g
->
°©e
 =
BUFFER_CLEAN
) &&

1412 (
tmp_£g
->
diskªqli°
 =
NULL
)) {

1413 
tmp_£g
->
°©e
 = 
BUFFER_EMPTY
;

1421 
tmp_i‹eq
 =Åmp_i‹eq->
√xt
;

1424 
tmp_£g
 =Åmp_£g->
√xt
;

1431 i‡(!
£g
->
diskªqli°
) {

1432 i‡(
£g
->
ac˚ss
 =
NULL
) {

1433 
£g
->
ac˚ss
 = 
	`i‹eq_c›y
(
cuºdiskªq
->
i‹eqli°
);

1434 
£g
->
ac˚ss
->
ty≥
 = 
NULL_EVENT
;

1436 
£g
->
diskªqli°
 = 
cuºdiskªq
;

1437 
cuºdiskªq
->
£g_√xt
 = 
NULL
;

1439 
diskªq
 *
¥ev_diskªq
 = 0;

1440 
tmp_diskªq
 = 
£g
->
diskªqli°
;

1441 
tmp_diskªq
) {

1442 i‡(
tmp_diskªq
->
i‹eqli°
 &&

1443 (
cuºdiskªq
->
i‹eqli°
->
blkno
 < 
tmp_diskªq
->ioreqlist->blkno)) {

1444 
cuºdiskªq
->
£g_√xt
 = 
tmp_diskªq
;

1445 i‡(
£g
->
diskªqli°
 =
tmp_diskªq
) {

1446 
£g
->
diskªqli°
 = 
cuºdiskªq
;

1448 
¥ev_diskªq
->
£g_√xt
 = 
cuºdiskªq
;

1452 
¥ev_diskªq
 = 
tmp_diskªq
;

1453 
tmp_diskªq
 =Åmp_diskªq->
£g_√xt
;

1455 i‡(!
tmp_diskªq
) {

1456 
¥ev_diskªq
->
£g_√xt
 = 
cuºdiskªq
;

1457 
cuºdiskªq
->
£g_√xt
 = 
NULL
;

1464 
tmp_i‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

1466 i‡(
is_ªad
) {

1467 i‡(
cuºdisk
->
ªqw©î
) {

1468 
cuºdiskªq
->
w©îm¨k
 = 
	`max
(1, (Ë((Ë
	`mö
(
£g
->
size
, 
tmp_i‹eq
->
bcou¡
Ë* 
cuºdisk
->
ªadw©î
));

1470 
cuºdiskªq
->
w©îm¨k
 = (Ë(((Ë
£g
->
size
 * 
cuºdisk
->
ªadw©î
) + () 0.9999999999);

1473 i‡(
cuºdisk
->
ªqw©î
) {

1474 
cuºdiskªq
->
w©îm¨k
 = 
	`max
(1, (Ë((Ë
	`mö
(
£g
->
size
, 
tmp_i‹eq
->
bcou¡
Ë* 
cuºdisk
->
wrôew©î
));

1476 
cuºdiskªq
->
w©îm¨k
 = (Ë(((Ë
£g
->
size
 * 
cuºdisk
->
wrôew©î
) + () 0.9999999999);

1479 
	}
}

1482 
	$disk_buf„r_©ãm±_£g_ow√rshù
 (
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
)

1484 
£gmít
 *
£g
 = 
cuºdiskªq
->seg;

1485 
diskªq
 *
tmp_diskªq
;

1486 
i‹eq_evít
 *
cuºi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

1487 
cuºdiskªq_found
 = 
FALSE
;

1488 
wrôe_found
 = 
FALSE
;

1489 
wrôe_öcom∂ëe
 = 0;

1490 
i‹eq_evít
 *
tmpi‹eq
;

1492 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1493 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_©ãm±_£g_ow√rshù\n",
simtime
,
cuºdiskªq
);

1494 
	`fÊush
(
ouçutfûe
);

1497 i‡(!
£g
) {

1498 
	`Ârötf
(
°dîr
, "diskreq has NULL segment in disk_buffer_attempt_seg_ownership\n");

1499 
	`exô
(1);

1502 i‡(
cuºdiskªq
->
Êags
 & 
SEG_OWNED
) {

1503 
	`Ârötf
(
°dîr
, "diskreqálready owns seg in disk_buffer_attempt_seg_ownership\n");

1504 
	`exô
(1);

1507 
tmp_diskªq
 = 
£g
->
diskªqli°
;

1508 
tmp_diskªq
) {

1509 i‡(
tmp_diskªq
->
Êags
 & 
SEG_OWNED
) {

1510 i‡(
cuºdiskªq
->
hôty≥
 =
BUFFER_PREPEND
) {

1511 i‡(
£g
->
°©e
 !
BUFFER_DIRTY
) {

1512 
	`Ârötf
(
°dîr
, "PREPEND ofáctiveÑequest detected in disk_buffer_attempt_seg_ownership\n");

1513 
	`exô
(1);

1516 
tmp_diskªq
->
Êags
 &~
SEG_OWNED
;

1517 
tmp_diskªq
->
hôty≥
 = 
BUFFER_APPEND
;

1518 i‡(
£g
->
ídblkno
 !£g->
°¨tblkno
) {

1519 i‡(
£g
->
hﬁd_bcou¡
 != 0) {

1520 
	`Ârötf
(
°dîr
, "PREPEND of segmentálready 'holding' data detected in disk_buffer_attempt_seg_ownership\n");

1521 
	`exô
(1);

1523 
£g
->
hﬁd_blkno
 = seg->
°¨tblkno
;

1524 
£g
->
hﬁd_bcou¡
 = seg->
ídblkno
 - seg->
°¨tblkno
;

1530 i‡(
tmp_diskªq
 =
cuºdiskªq
) {

1531 
cuºdiskªq_found
 = 
TRUE
;

1532 } i‡(!
cuºdiskªq_found
 && 
tmp_diskªq
->
i‹eqli°
 &&

1533 !(
tmp_diskªq
->
i‹eqli°
->
Êags
 & 
READ
)) {

1534 
wrôe_found
 = 
TRUE
;

1535 
tmpi‹eq
 = 
tmp_diskªq
->
i‹eqli°
;

1536 
tmpi‹eq
->
√xt
) {

1537 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

1539 i‡(
tmp_diskªq
->
öblkno
 < (
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) {

1540 
wrôe_öcom∂ëe
 = 
TRUE
;

1543 
tmp_diskªq
 =Åmp_diskªq->
£g_√xt
;

1547 i‡(!
tmp_diskªq
) {

1548 
	`ASSERT
(!
wrôe_found
 || !
wrôe_öcom∂ëe
);

1549 
cuºdiskªq
->
Êags
 |
SEG_OWNED
;

1550 i‡(
cuºi‹eq
 &&

1551 (!
cuºdisk
->
ef„˘ivehda
 ||

1552 (
cuºdisk
->
ef„˘ivehda
 =
cuºdiskªq
) ||

1553 (
cuºdisk
->
ef„˘ivehda
->
£g
 != seg))) {

1554 
£g
->
ac˚ss
->
Êags
 = 
cuºi‹eq
->flags;

1559 i‡(!
cuºi‹eq
 || (cuºi‹eq->
Êags
 & 
READ
)) {

1566 i‡((
cuºdiskªq
->
hôty≥
 !
BUFFER_NOMATCH
) &&

1567 (
£g
->
°¨tblkno
 > 
cuºdiskªq
->
outblkno
)) {

1568 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

1572 i‡(
cuºdiskªq
->
hôty≥
 =
BUFFER_NOMATCH
) {

1573 
	`ASSERT
(
cuºi‹eq
 !
NULL
);

1574 
	`ASSERT1
(((
£g
->
ac˚ss
->
ty≥
 =
NULL_EVENT
) ||

1575 (
£g
->
ªcy˛îeq
 =
cuºdiskªq
)),"£g->ac˚ss->ty≥",£g->
ac˚ss
->
ty≥
);

1576 i‡(
cuºdiskªq
 !
£g
->
ªcy˛îeq
) {

1577 
£g
->
°©e
 = 
BUFFER_CLEAN
;

1578 
£g
->
ac˚ss
->
blkno
 = 
cuºdiskªq
->
outblkno
;

1580 
£g
->
°¨tblkno
 = seg->
ídblkno
 = 
cuºdiskªq
->
outblkno
;

1581 
£g
->
möªadahódblkno
 = seg->
maxªadahódblkno
 = -1;

1582 
£g
->
hﬁd_bcou¡
 = 0;

1585 i‡(
cuºi‹eq
) {

1586 
cuºi‹eq
->
√xt
) {

1587 
cuºi‹eq
 = cuºi‹eq->
√xt
;

1589 
£g
->
möªadahódblkno
 = 
	`max
(£g->möªadahódblkno, 
	`mö
((
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
 + 
cuºdisk
->
möªadahód
), cuºdisk->
modñ
->
dm_£˘‹s
));

1591 
£g
->
maxªadahódblkno
 = 
	`max
(£g->maxªadahódblkno, 
	`mö
(
	`disk_buf„r_gë_max_ªadahód
(
cuºdisk
,£g,
cuºi‹eq
), cuºdisk->
modñ
->
dm_£˘‹s
));

1593 i‡((
£g
->
ídblkno
 >(
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
)) &&

1594 (
cuºdisk
->
ef„˘ivehda
 =
cuºdiskªq
)) {

1595 
£g
->
ac˚ss
->
Êags
 |
BUFFER_BACKGROUND
;

1600 i‡(!
cuºdisk
->
ef„˘ivehda
 ||

1601 (
cuºdisk
->
ef„˘ivehda
 =
cuºdiskªq
) ||

1602 (
cuºdisk
->
ef„˘ivehda
->
£g
 != seg)) {

1603 i‡((
cuºdiskªq
 !
£g
->
ªcy˛îeq
) &&

1604 (
£g
->
ac˚ss
->
ty≥
 =
NULL_EVENT
)){

1605 
£g
->
ac˚ss
->
blkno
 = 
cuºdiskªq
->
öblkno
;

1607 i‡(
cuºdiskªq
->
Êags
 & 
COMPLETION_RECEIVED
) {

1608 
£g
->
ac˚ss
->
Êags
 |
BUFFER_BACKGROUND
;

1611 i‡(
cuºdiskªq
->
hôty≥
 =
BUFFER_NOMATCH
) {

1612 
£g
->
möªadahódblkno
 = seg->
maxªadahódblkno
 = -1;

1613 
£g
->
hﬁd_bcou¡
 = 0;

1614 
£g
->
°¨tblkno
 = seg->
ídblkno
 = 
cuºdiskªq
->
öblkno
;

1615 i‡(
cuºdiskªq
 !
£g
->
ªcy˛îeq
) {

1616 
£g
->
°©e
 = 
BUFFER_DIRTY
;

1617 
cuºdisk
->
numdúty
++;

1618 i‡((
disk_¥öthack
 > 1Ë&& (
simtime
 >
disk_¥öthacktime
)) {

1619 
	`Ârötf
 (
ouçutfûe
, "Çumdúty++ = %d\n",
cuºdisk
->
numdúty
);

1620 
	`fÊush
(
ouçutfûe
);

1622 
	`ASSERT1
(((
cuºdisk
->
numdúty
 >0Ë&& (cuºdisk->numdúty <cuºdisk->
numwrôe£gs
)),"numdirty",currdisk->numdirty);

1624 } i‡(
cuºdiskªq
->
hôty≥
 =
BUFFER_PREPEND
) {

1625 
£g
->
°¨tblkno
 = seg->
ídblkno
 = 
cuºdiskªq
->
öblkno
;

1629 i‡(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1630 
	`Ârötf
 (
ouçutfûe
, " Ow√rshù = %d\n",(
cuºdiskªq
->
Êags
 & 
SEG_OWNED
));

1631 
	`fÊush
(
ouçutfûe
);

1634 (
cuºdiskªq
->
Êags
 & 
SEG_OWNED
);

1635 
	}
}

1638 
	$disk_buf„r_gë_max_ªadahód
 (
disk
 *
cuºdisk
, 
£gmít
 *
£g
, 
i‹eq_evít
 *
cuº
)

1640 
ídªq
;

1642 i‡(!(
cuº
->
Êags
 & 
READ
)) {

1643 
	`Ârötf
(
°dîr
, "NoÑead-ahead for writeáccesses, in disk_buffer_get_max_readahead\n");

1644 
	`exô
(1);

1647 
ídªq
 = 
cuº
->
blkno
 + cuº->
bcou¡
;

1649 i‡(
cuºdisk
->
c⁄åód
 =
BUFFER_NO_READ_AHEAD
) {

1650 (
ídªq
);

1651 } i‡(
cuºdisk
->
c⁄åód
 =
BUFFER_DEC_PREFETCH_SCHEME
) {

1652 
°¨ébn
;

1653 
ídlbn
;

1654 
dm_pbn
 
pbn
;

1657 
cuº
->
blkno
 +cuº->
bcou¡
;

1661 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

1662 
cuº
->
blkno
,

1663 
MAP_FULL
,

1664 &
pbn
,

1667 
cuºdisk
->
modñ
->
œyout
->
	`dm_gë_åack_bound¨õs
(currdisk->model,

1668 &
pbn
,

1669 &
°¨ébn
,

1670 &
ídlbn
,

1673 
ídlbn
++;

1675 
cuº
->
blkno
 -cuº->
bcou¡
;

1677 i‡(
£g
->
°¨tblkno
 < 
°¨ébn
) {

1678  (
ídlbn
 + 
cuºdisk
->
modñ
->
œyout
->
	`dm_gë_£˘‹s_lbn
(cuºdisk->modñ, 
cuº
->
blkno
));

1680 (
ídlbn
);

1684 i‡(
cuºdisk
->
maxªadahód
) {

1685 (
ídªq
 + 
cuºdisk
->
maxªadahód
);

1687 i‡(
cuºdisk
->
kì¥eque°d©a
 > 0) {

1688 i‡((
cuº
->
bcou¡
 >
£g
->
size
)

1689 || ((
£g
->
size
 - 
cuº
->
bcou¡
Ë< 
cuºdisk
->
möªadahód
))

1691 (
ídªq
 + 
cuºdisk
->
möªadahód
);

1693 (
cuº
->
blkno
 + 
£g
->
size
);

1696 (
ídªq
 + 
£g
->
size
);

1697 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_diskctlr.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_iosim.h
"

103 
	~"disksim_°©.h
"

104 
	~"disksim_disk.h
"

105 
	~"disksim_ioqueue.h
"

106 
	~"disksim_bus.h
"

107 
	~"ölöe.h
"

109 
	~"ö°.h
"

113 
disk_buf„r_£˘‹_d⁄e
 (
disk
 *
cuºdisk
,

114 
i‹eq_evít
 *
cuº
);

117 
disk_buf„r_£ekd⁄e
 (
disk
 *
cuºdisk
,

118 
i‹eq_evít
 *
cuº
);

121 
disk_íabÀmít_fun˘i⁄
 (
i‹eq_evít
 *
cuºi‹eq
);

124 
disk_gŸ_ªm≠≥d_£˘‹
 (
disk
 *
cuºdisk
,

125 
i‹eq_evít
 *
cuº
);

128 
disk_check_bus
 (
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
);

132 
disk_ªÀa£_hda
 (
disk
 *
cuºdisk
,

133 
diskªq
 *
cuºdiskªq
);

136 
disk_check_hda
 (
disk
 *
cuºdisk
,

137 
diskªq
 *
cuºdiskªq
,

138 
ok_to_check_bus
);

140 
i‹eq_evít
 *

141 
disk_buf„r_å™s„r_size
 (
disk
 *
cuºdisk
,

142 
diskªq
 *
cuºdiskªq
,

143 
i‹eq_evít
 *
cuº
);

146 
disk_a˘iv©e_ªad
 (
disk
 *
cuºdisk
,

147 
diskªq
 *
cuºdiskªq
,

148 
£t£g
,

149 
ok_to_check_bus
);

152 
disk_a˘iv©e_wrôe
 (
disk
 *
cuºdisk
,

153 
diskªq
 *
cuºdiskªq
,

154 
£t£g
,

155 
ok_to_check_bus
);

158 
disk_buf„r_e°im©e_ac˘ime
(
disk
 *
cuºdisk
,

159 
i‹eq_evít
 *
cuº
,

160 
maxtime
);

164 
	$disk_£t_dïth
(
diskno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
)

166 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
diskno
);

167 
˙t
;

169 
˙t
 = 
cuºdisk
->
numöbu£s
;

170 
cuºdisk
->
numöbu£s
++;

171 
	`ddbg_as£π3
(((
˙t
 + 1Ë<
MAXINBUSES
),

173 
diskno
, (
˙t
+1)));

175 
cuºdisk
->
öbu£s
[
˙t
] = 
öbu¢o
;

176 
cuºdisk
->
dïth
[
˙t
] = depth;

177 
cuºdisk
->
¶Ÿno
[
˙t
] = slotno;

179 
	}
}

182 
	$disk_gë_dïth
 (
diskno
)

184 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
diskno
);

185 (
cuºdisk
->
dïth
[0]);

186 
	}
}

189 
	$disk_gë_¶Ÿno
 (
diskno
)

191 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
diskno
);

192 (
cuºdisk
->
¶Ÿno
[0]);

193 
	}
}

196 
	$disk_gë_öbus
 (
diskno
)

198 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
diskno
);

199 (
cuºdisk
->
öbu£s
[0]);

200 
	}
}

203 
	$disk_gë_maxout°™dög
 (
diskno
)

205 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
diskno
);

206 (
cuºdisk
->
maxqÀn
);

207 
	}
}

210 
	$disk_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
)

212 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
cuº
->
devno
);

213 
tm±ime
;

215 
tm±ime
 = 
	`bus_gë_å™s„r_time
(
	`disk_gë_bu¢o
(
cuº
), 1, (cuº->
Êags
 & 
READ
));

216 if(
tm±ime
 < 
cuºdisk
->
blkå™°ime
) {

217 
tm±ime
 = 
cuºdisk
->
blkå™°ime
;

219 (
tm±ime
);

220 
	}
}

223 
INLINE
 
	$disk_gë_bu¢o
 (
i‹eq_evít
 *
cuº
)

225 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
cuº
->
devno
);

226 
ötch¨
 
bu¢o
;

227 
dïth
;

229 
bu¢o
.
vÆue
 = 
cuº
->busno;

230 
dïth
 = 
cuºdisk
->depth[0];

231 (
bu¢o
.
byã
[
dïth
]);

232 
	}
}

246 
	$disk_£nd_evít_up_∑th
 (
i‹eq_evít
 *
cuº
, 
dñay
)

248 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
cuº
->
devno
);

249 
bu¢o
;

250 
¶Ÿno
;

252 
	`disksim_ö°_íãr
();

258 
bu¢o
 = 
	`disk_gë_bu¢o
(
cuº
);

259 
¶Ÿno
 = 
cuºdisk
->slotno[0];

262 
cuº
->
√xt
 = 
cuºdisk
->
buswaô
;

263 
cuºdisk
->
buswaô
 = 
cuº
;

265 
cuº
->
ãmpöt1
 = 
bu¢o
;

266 
cuº
->
time
 = 
dñay
;

267 if(
cuºdisk
->
busow√d
 == -1) {

269 if(
cuº
->
√xt
) {

270 
	`Ârötf
(
°dîr
,"Multiple busÑequestors detected in "

274 if(
	`bus_ow√rshù_gë
(
bu¢o
, 
¶Ÿno
, 
cuº
Ë=
FALSE
) {

276 
cuºdisk
->
°©
.
ªque°edbus
 = 
simtime
;

279 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
cuº
->
devno
, 
dñay
, curr);

282 if(
cuºdisk
->
busow√d
 =
bu¢o
) {

286 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
cuº
->
devno
, 
dñay
, curr);

289 
	`ddbg_as£π2
(0, "Wrong bus owned forÅransfer desired");

291 
	}
}

303 
	$disk_bus_ow√rshù_gø¡
(
devno
,

304 
i‹eq_evít
 *
cuº
,

305 
bu¢o
,

306 
¨bdñay
)

308 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
devno
);

309 
i‹eq_evít
 *
tmp
;

311 
tmp
 = 
cuºdisk
->
buswaô
;

312 (
tmp
 !
NULL
Ë&& (tm∞!
cuº
)) {

313 
tmp
 =Åmp->
√xt
;

316 
	`ddbg_as£π3
(
tmp
 != 0, ("Bus ownership grantedÅo unknown diskÑequest - "

318 
devno
, 
bu¢o
));

320 
cuºdisk
->
busow√d
 = 
bu¢o
;

321 
cuºdisk
->
°©
.
waôögf‹bus
 +
simtime
 - cuºdisk->°©.
ªque°edbus
;

322 
	`ddbg_as£π
(
¨bdñay
 =(
simtime
 - 
cuºdisk
->
°©
.
ªque°edbus
));

323 
cuºdisk
->
°©
.
numbuswaôs
++;

324 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
devno
, 
tmp
->
time
,Åmp);

325 
	}
}

329 
	$disk_bus_dñay_com∂ëe
(
devno
,

330 
i‹eq_evít
 *
cuº
,

331 
£¡bu¢o
)

333 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
devno
);

334 
ötch¨
 
¶Ÿno
;

335 
ötch¨
 
bu¢o
;

336 
dïth
;

341 if(
cuº
 =
cuºdisk
->
buswaô
) {

342 
cuºdisk
->
buswaô
 = 
cuº
->
√xt
;

344 
i‹eq_evít
 *
tmp
 = 
cuºdisk
->
buswaô
;

345 (
tmp
->
√xt
 !
NULL
Ë&& (tmp->√xà!
cuº
)) {

346 
tmp
 =Åmp->
√xt
;

349 
	`ddbg_as£π3
(
tmp
->
√xt
 =
cuº
, ("Bus delay complete for unknown disk "

351 
devno
, 
bu¢o
.
vÆue
));

353 
tmp
->
√xt
 = 
cuº
->next;

355 
bu¢o
.
vÆue
 = 
cuº
->busno;

356 
¶Ÿno
.
vÆue
 = 
cuº
->slotno;

357 
dïth
 = 
cuºdisk
->depth[0];

358 
¶Ÿno
.
byã
[
dïth
] = slotno.byte[depth] >> 4;

359 
cuº
->
time
 = 0.0;

360 if(
dïth
 == 0) {

361 
	`öå_ªque°
 ((
evít
 *)
cuº
);

364 
	`bus_dñivî_evít
(
bu¢o
.
byã
[
dïth
], 
¶Ÿno
.byã[dïth], 
cuº
);

366 
	}
}

370 
	$disk_¥ï¨e_f‹_d©a_å™s„r
(
i‹eq_evít
 *
cuº
)

372 
disk
 *
cuºdisk
 = 
	`gëdisk
(
cuº
->
devno
);

373 
diskªq
 *
cuºdiskªq
 = 
cuº
->
i‹eq_hﬁd_diskªq
;

375 
	`disksim_ö°_íãr
();

381 if(
cuºdiskªq
->
Êags
 & 
FINAL_WRITE_RECONNECTION_1
) {

382 
cuºdiskªq
->
Êags
 |
FINAL_WRITE_RECONNECTION_2
;

384 
	`addt€xåaq
((
evít
 *Ë
cuº
);

385 
	`disk_check_bus
(
cuºdisk
,
cuºdiskªq
);

386 
	}
}

391 
	$disk_check_¥e„tch_sw≠
 (
disk
 *
cuºdisk
)

393 
i‹eq_evít
 *
√xti‹eq
;

394 
diskªq
 *
√xtdiskªq
;

395 
£t£g
 = 
FALSE
;

397 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

398 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ E¡îög disk_check_¥e„tch_sw≠ f‹ disk %d\n", 
simtime
, 
cuºdisk
->
devno
);

399 
	`fÊush
(
ouçutfûe
);

402 
	`ddbg_as£π
(
cuºdisk
->
ef„˘ivehda
 != 0);

404 
	`ddbg_as£π
(
cuºdisk
->
ef„˘ivehda
->
£g
 != 0);

407 
i•uª¥e„tch
 =

408 (
cuºdisk
->
ef„˘ivehda
->
£g
->
ac˚ss
->
Êags
 & 
BUFFER_BACKGROUND
)

409 && (
cuºdisk
->
ef„˘ivehda
->
£g
->
ac˚ss
->
Êags
 & 
READ
);

411 
	`ddbg_as£π2
(
i•uª¥e„tch
, "effectivehda->seg->access isÇotáÖure "

416 
√xti‹eq
 = 
	`ioqueue_show_√xt_ªque°
(
cuºdisk
->
queue
);

417 if(
√xti‹eq
) {

418 
√xtdiskªq
 = 
√xti‹eq
->
i‹eq_hﬁd_diskªq
;

419 if(!
√xtdiskªq
->
£g
) {

420 
£t£g
 = 
TRUE
;

421 
	`disk_buf„r_£À˘_£gmít
(
cuºdisk
,
√xtdiskªq
,
FALSE
);

423 if(
√xti‹eq
->
Êags
 & 
READ
) {

424 
	`disk_a˘iv©e_ªad
(
cuºdisk
,
√xtdiskªq
,
£t£g
,
TRUE
);

427 
	`disk_a˘iv©e_wrôe
(
cuºdisk
,
√xtdiskªq
,
£t£g
,
TRUE
);

430 
	}
}

435 
	$disk_ªque°_com∂ëe
(
disk
 *
cuºdisk
,

436 
diskªq
 *
cuºdiskªq
,

437 
i‹eq_evít
 *
cuº
)

439 
i‹eq_evít
 *
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

440 
diskªq
 *
√xtdiskªq
;

441 
dñay
;

443 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

444 
	`Ârötf
 (
ouçutfûe
, "%12.6f %8p "

445 " E¡îög disk_ªque°_com∂ëe\n", 
simtime
, 
cuºdiskªq
);

446 
	`fÊush
(
ouçutfûe
);

452 
	`ddbg_as£π
(
cuºdisk
->
ef„˘ivebus
 =
cuºdiskªq
);

455 if(
cuº
->
blkno
 !
tmpi‹eq
->blkno) {

456 
	`addt€xåaq
((
evít
 *Ë
cuº
);

457 
cuº
 = 
	`i‹eq_c›y
(
tmpi‹eq
);

460 
cuºdisk
->
œ°Êags
 = 
cuº
->
Êags
;

462 
	`ddbg_as£π
(
cuºdisk
->
out°©e
 =
DISK_TRANSFERING
);

464 
cuºdiskªq
->
Êags
 |
COMPLETION_SENT
;

466 if(
cuºdisk
->
c⁄°_ac˘ime
) {

468 
	`ddbg_as£π2
(!(
cuºdiskªq
->
Êags
 & 
HDA_OWNED
),

472 
	`ddbg_as£π2
(
	`ioqueue_gë_•ecific_ªque°
(
cuºdisk
->
queue
,
tmpi‹eq
),

475 
	`disk_öãr„ª°©s
(
cuºdisk
, 
tmpi‹eq
);

477 
	`ddbg_as£π2
(
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
cuºdisk
->
queue
,
tmpi‹eq
),

480 
cuºdisk
->
cuºítbus
 =

481 
cuºdisk
->
cuºíthda
 =

482 
cuºdisk
->
ef„˘ivehda
 = 
NULL
;

484 
tmpi‹eq
 = 
	`ioqueue_show_√xt_ªque°
(
cuºdisk
->
queue
);

485 if(
tmpi‹eq
) {

486 
√xtdiskªq
 = (
diskªq
*Ë
tmpi‹eq
->
i‹eq_hﬁd_diskªq
;

487 if(
√xtdiskªq
->
i‹eqli°
->
Êags
 & 
READ
) {

488 
	`disk_a˘iv©e_ªad
(
cuºdisk
, 
√xtdiskªq
, 
FALSE
, 
TRUE
);

491 
	`disk_a˘iv©e_wrôe
(
cuºdisk
, 
√xtdiskªq
, 
FALSE
, 
TRUE
);

495 if(
tmpi‹eq
->
Êags
 & 
READ
) {

496 
tmpi‹eq
) {

497 
evtfound
 = 0;

498 if(!(
cuºdiskªq
->
Êags
 & 
HDA_OWNED
)) {

500 
	`ddbg_as£π2
(
	`ioqueue_gë_•ecific_ªque°
(
cuºdisk
->
queue
,
tmpi‹eq
),

503 
	`disk_öãr„ª°©s
(
cuºdisk
, 
tmpi‹eq
);

506 
evtfound
 = ()
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
cuºdisk
->
queue
,
tmpi‹eq
);

508 
	`ddbg_as£π2
(
evtfound
 != 0, "ioreq_eventÇot found");

510 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

512 if((
cuºdisk
->
kì¥eque°d©a
 == -1) &&

513 !
cuºdiskªq
->
£g
->
diskªqli°
->
£g_√xt
)

515 
	`ddbg_as£π2
((
cuºdiskªq
->
outblkno
 <cuºdiskªq->
£g
->
ídblkno
),

518 
cuºdiskªq
->
£g
->
°¨tblkno
 = cuºdiskªq->
outblkno
;

522 if((
cuºdiskªq
 =
cuºdisk
->
ef„˘ivehda
) ||

523 (
cuºdiskªq
 =
cuºdisk
->
cuºíthda
))

525 if(
cuºdiskªq
->
£g
->
ac˚ss
->
ty≥
 =
NULL_EVENT
) {

526 
	`disk_ªÀa£_hda
(
cuºdisk
,
cuºdiskªq
);

529 if(
cuºdisk
->
¥e£ekög
 !
NO_PRESEEK
) {

530 
	`disk_check_¥e„tch_sw≠
(
cuºdisk
);

536 if((
cuºdiskªq
 =
cuºdisk
->
ef„˘ivehda
)

537 || (
cuºdiskªq
 =
cuºdisk
->
cuºíthda
))

539 if(
cuºdiskªq
->
£g
->
ac˚ss
->
ty≥
 =
NULL_EVENT
) {

540 
	`disk_ªÀa£_hda
(
cuºdisk
,
cuºdiskªq
);

545 
cuº
->
time
 = 
simtime
;

546 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

547 
cuº
->
ˇu£
 = 
COMPLETION
;

549 if(
cuºdisk
->
c⁄°_ac˘ime
) {

550 
dñay
 = 0.0;

553 if(
cuº
->
Êags
 & 
READ
) {

554 
dñay
 = 
cuºdisk
->
ovîhód_com∂ëe_ªad
;

557 
dñay
 = 
cuºdisk
->
ovîhód_com∂ëe_wrôe
;

561 
	`disk_£nd_evít_up_∑th
(
cuº
, (
dñay
 * 
cuºdisk
->
timesˇÀ
));

562 
cuºdisk
->
out°©e
 = 
DISK_WAIT_FOR_CONTROLLER
;

563 
	}
}

566 
	$disk_ªc⁄√˘i⁄_‹_å™s„r_com∂ëe
 (
i‹eq_evít
 *
cuº
)

568 
disk
 *
cuºdisk
 = 
	`gëdisk
(
cuº
->
devno
);

569 
diskªq
 *
cuºdiskªq
;

570 
i‹eq_evít
 *
tmpi‹eq
;

571 
dñay
;

573 
	`disksim_ö°_íãr
();

575 
cuºdiskªq
 = 
cuºdisk
->
ef„˘ivebus
;

576 if(!
cuºdiskªq
) {

577 
cuºdiskªq
 = 
cuºdisk
->
ef„˘ivebus
 = cuºdisk->
cuºítbus
;

580 
	`ddbg_as£π2
(
cuºdiskªq
 != 0, "effectivebusánd currentbusáre NULL");

583 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

584 
	`Ârötf
 (
ouçutfûe
, "%12.6f %8p "

586 
simtime
, 
cuºdiskªq
, 
cuº
->
devno
);

587 
	`fÊush
(
ouçutfûe
);

590 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

591 
tmpi‹eq
) {

592 if(
tmpi‹eq
->
blkno
 =
cuº
->blkno) {

595 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

598 
	`ddbg_as£π2
(
tmpi‹eq
 != 0, "ioreq_eventÇot found inÉffectivebus");

600 
cuºdisk
->
out°©e
) {

601 
DISK_WAIT_FOR_CONTROLLER
:

602 
DISK_TRANSFERING
:

605 
	`ddbg_as£π3
(0, ("DiskÇot waitingÅoÅransfer - devno %d, state %d\n",

606 
cuº
->
devno
, 
cuºdisk
->
out°©e
));

609 
cuºdisk
->
ef„˘ivebus
 = 
cuºdiskªq
;

610 
cuºdisk
->
out°©e
 = 
DISK_TRANSFERING
;

611 
cuº
->
ty≥
 = 
DEVICE_DATA_TRANSFER_COMPLETE
;

612 
cuº
 = 
	`disk_buf„r_å™s„r_size
(
cuºdisk
, 
cuºdiskªq
, curr);

614 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

615 
	`Ârötf
 (
ouçutfûe
, " disk_buf„r_å™s„r_sizê£àbcou¡Åÿ%d\n", 
cuº
->
bcou¡
);

616 
	`fÊush
(
ouçutfûe
);

619 if(
cuº
->
bcou¡
 == -2) {

620 
	`ddbg_as£π2
(
cuºdisk
->
outwaô
 == 0, "non-NULL outwait found");

621 
cuºdisk
->
outwaô
 = 
cuº
;

623 if(
cuº
->
bcou¡
 == -1) {

624 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

625 
cuº
->
ˇu£
 = 
DISCONNECT
;

626 if(
tmpi‹eq
->
Êags
 & 
READ
) {

627 
dñay
 = ((
cuºdisk
->
œ°Êags
 & 
READ
)

628 ? 
cuºdisk
->
ovîhód_disc⁄√˘_ªad_a·îªad


629 : 
cuºdisk
->
ovîhód_disc⁄√˘_ªad_a·îwrôe
);

632 
dñay
 = ((
cuºdiskªq
->
Êags
 & 
EXTRA_WRITE_DISCONNECT
)

633 ? 
cuºdisk
->
exåadisc_disc⁄√˘2


634 : 
cuºdisk
->
ovîhód_disc⁄√˘_wrôe
);

637 
	`disk_£nd_evít_up_∑th
(
cuº
, (
dñay
 * 
cuºdisk
->
timesˇÀ
));

638 
cuºdisk
->
out°©e
 = 
DISK_WAIT_FOR_CONTROLLER
;

640 if(
cuº
->
bcou¡
 == 0) {

641 
	`disk_ªque°_com∂ëe
(
cuºdisk
, 
cuºdiskªq
, 
cuº
);

643 if(
cuº
->
bcou¡
 > 0) {

644 
cuºdisk
->
°¨âøns
 = 
simtime
;

645 
cuºdisk
->
blksd⁄e
 = 0;

646 
	`disk_£nd_evít_up_∑th
(
cuº
, () 0.0);

648 
	}
}

656 
	$disk_föd_√w_£g_ow√r
(
disk
 *
cuºdisk
, 
£gmít
 *
£g
)

658 
diskªq
 *
cuºdiskªq
 = 
£g
->
diskªqli°
;

659 
diskªq
 *
be°diskªq
 = 
NULL
;

661 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

662 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ E¡îög disk_föd_√w_£g_ow√∏f‹ disk %d\n", 
simtime
, 
cuºdisk
->
devno
);

663 
	`fÊush
(
ouçutfûe
);

666 
	`ddbg_as£π
(
£g
 !
NULL
);

667 
	`ddbg_as£π
(
£g
->
ªcy˛îeq
 =
NULL
);

669 
cuºdiskªq
) {

670 if(
cuºdiskªq
->
Êags
 & 
SEG_OWNED
) {

673 if(!
be°diskªq
 && (
cuºdiskªq
 !
cuºdisk
->
ef„˘ivehda
) &&

674 (
cuºdiskªq
->
Êags
 & 
HDA_OWNED
Ë&& (cuºdiskªq->
i‹eqli°
) &&

675 (
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
)) {

676 
be°diskªq
 = 
cuºdiskªq
;

678 
cuºdiskªq
 = cuºdiskªq->
£g_√xt
;

681 if(!
be°diskªq
) {

682 
cuºdiskªq
 = 
£g
->
diskªqli°
;

683 
cuºdiskªq
) {

684 if(
cuºdiskªq
->
hôty≥
 =
BUFFER_APPEND
) {

685 
be°diskªq
 = 
cuºdiskªq
;

688 
cuºdiskªq
 = cuºdiskªq->
£g_√xt
;

692 if(
be°diskªq
) {

693 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,
be°diskªq
);

695 if(
cuºdisk
->
ef„˘ivehda


696 && (
cuºdisk
->
ef„˘ivehda
->
£g
 == seg))

698 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,cuºdisk->
ef„˘ivehda
);

700 
	}
}

714 
	$disk_ªÀa£_hda
(
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
)

716 
i‹eq_evít
 *
tmpi‹eq
;

717 
i‹eq_evít
 *
hﬁdi‹eq
;

718 
£gmít
 *
£g
 = 
cuºdiskªq
->seg;

719 
diskªq
 *
tmpdiskªq
;

721 
diskªq
 *
√xtdiskªq
 = 
NULL
;

722 
ªÀa£_hda
 = 
FALSE
;

723 
‰ì_°ru˘s
 = 
FALSE
;

725 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

726 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_ªÀa£_hd®f‹ disk %d\n", 
simtime
, 
cuºdiskªq
,
cuºdisk
->
devno
);

727 
	`fÊush
(
ouçutfûe
);

730 
	`ddbg_as£π
(
cuºdiskªq
 !
NULL
);

732 
	`ddbg_as£π3
((
cuºdiskªq
 =
cuºdisk
->
ef„˘ivehda
),

734 
cuºdiskªq
, 
cuºdisk
->
ef„˘ivehda
));

736 
	`ddbg_as£π
(
£g
 !
NULL
);

738 if(!
cuºdiskªq
->
i‹eqli°
) {

739 
	`ddbg_as£π2
((
cuºdiskªq
->
Êags
 & 
COMPLETION_RECEIVED
),

742 
ªÀa£_hda
 = 
TRUE
;

743 
‰ì_°ru˘s
 = 
TRUE
;

744 
£g
->
°©e
 =

745 ((
cuºdisk
->
íabÀˇche
 || 
£g
->
diskªqli°
->
£g_√xt
)

746 ? 
BUFFER_CLEAN


747 : 
BUFFER_EMPTY
);

749 if(
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
) {

750 if((
cuºdisk
->
¥e£ekög
 =
PRESEEK_BEFORE_COMPLETION
)

751 || ((
cuºdisk
->
¥e£ekög
 =
PRESEEK_DURING_COMPLETION
)

752 && (
cuºdiskªq
->
Êags
 & 
COMPLETION_SENT
)))

754 
˛ónOrEm±y
;

755 
ªÀa£_hda
 = 
TRUE
;

757 
˛ónOrEm±y
 = !(
cuºdiskªq
->
Êags
 & 
COMPLETION_SENT
)

758 ? 
BUFFER_CLEAN


759 : 
BUFFER_EMPTY
;

761 
£g
->
°©e
 = (
cuºdisk
->
íabÀˇche


762 || 
£g
->
diskªqli°
->
£g_√xt


763 || 
˛ónOrEm±y
);

766 if((
cuºdiskªq
->
Êags
 & 
COMPLETION_RECEIVED
)

767 || (
cuºdisk
->
¥e£ekög
 =
PRESEEK_BEFORE_COMPLETION
)

768 || ((
cuºdisk
->
¥e£ekög
 =
PRESEEK_DURING_COMPLETION
)

769 && (
cuºdiskªq
->
Êags
 & 
COMPLETION_SENT
)))

771 
ªÀa£_hda
 = 
TRUE
;

772 if(
cuºdiskªq
->
Êags
 & 
COMPLETION_RECEIVED
) {

773 
‰ì_°ru˘s
 = 
TRUE
;

778 
tmpdiskªq
 = 
£g
->
diskªqli°
;

779 
tmpdiskªq
) {

780 if(
tmpdiskªq
 !
cuºdiskªq
) {

781 
tmpi‹eq
 = 
tmpdiskªq
->
i‹eqli°
;

782 
	`ddbg_as£π
(
tmpi‹eq
 !
NULL
);

783 if(!(
tmpi‹eq
->
Êags
 & 
READ
)) {

784 
tmpi‹eq
->
√xt
) {

785 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

787 if(
tmpdiskªq
->
öblkno
 < (
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) {

788 
£g
->
°©e
 = 
BUFFER_DIRTY
;

789 if((
tmpdiskªq
->
hôty≥
 =
BUFFER_APPEND
) &&

790 (
cuºdisk
->
Á°wrôes
 =
LIMITED_FASTWRITE
)) {

791 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

792 
	`ddbg_as£π
(
tmpi‹eq
 !
NULL
);

793 
tmpi‹eq
->
√xt
) {

794 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

796 if(
tmpdiskªq
->
i‹eqli°
->
blkno
 ==

797 (
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
))

799 
√xtdiskªq
 = 
tmpdiskªq
;

806 
tmpdiskªq
 =Åmpdiskªq->
£g_√xt
;

809 if(!
tmpdiskªq
) {

810 if(
£g
->
diskªqli°
->
£g_√xt
) {

811 
£g
->
°©e
 = 
BUFFER_CLEAN
;

814 
˛ón
 = (
cuºdisk
->
íabÀˇche
 && cuºdisk->
ªadhôs⁄wrôed©a
);

815 if(
˛ón
) {

816 
£g
->
°©e
 = 
BUFFER_CLEAN
;

819 
£g
->
°©e
 = 
BUFFER_EMPTY
;

822 
cuºdisk
->
numdúty
--;

823 if((
disk_¥öthack
 > 1)

824 && (
simtime
 >
disk_¥öthacktime
))

826 
	`Ârötf
 (
ouçutfûe
, "Çumdúty-- = %d\n",
cuºdisk
->
numdúty
);

827 
	`fÊush
(
ouçutfûe
);

829 
	`ddbg_as£π3
(((
cuºdisk
->
numdúty
 >= 0)

830 && (
cuºdisk
->
numdúty
 <cuºdisk->
numwrôe£gs
)),

831 ("numdúty: %d", 
cuºdisk
->
numdúty
));

836 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

837 
	`Ârötf
 (
ouçutfûe
, " fªe_°ru˘†%d,Ññó£_hd®%d\n", 
‰ì_°ru˘s
, 
ªÀa£_hda
);

838 
	`fÊush
(
ouçutfûe
);

841 if(
‰ì_°ru˘s
) {

842 
	`disk_buf„r_ªmove_‰om_£g
(
cuºdiskªq
);

843 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

844 
tmpi‹eq
) {

845 
hﬁdi‹eq
 = 
tmpi‹eq
->
√xt
;

846 
	`addt€xåaq
((
evít
 *Ë
tmpi‹eq
);

847 
tmpi‹eq
 = 
hﬁdi‹eq
;

849 
	`addt€xåaq
((
evít
 *Ë
cuºdiskªq
);

850 if(
£g
->
ªcy˛îeq
) {

852 
	`Ârötf
(
°dîr
,"GOT HERE! SURPRISE!\n");

854 
	`ddbg_as£π2
(
£g
->
diskªqli°
 == 0,

857 
√xtdiskªq
 = 
£g
->
ªcy˛îeq
;

858 
	`disk_buf„r_£t_£gmít
(
cuºdisk
,
£g
->
ªcy˛îeq
);

859 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,
£g
->
ªcy˛îeq
);

860 
£g
->
ªcy˛îeq
 = 
NULL
;

862 if(
£g
->
diskªqli°
) {

863 
	`disk_föd_√w_£g_ow√r
(
cuºdisk
,
£g
);

867 if(
ªÀa£_hda
) {

868 if(
cuºdisk
->
cuºíthda
 =cuºdisk->
ef„˘ivehda
) {

869 
cuºdisk
->
cuºíthda
 = 
NULL
;

871 
cuºdisk
->
ef„˘ivehda
 = 
NULL
;

872 
	`ddbg_as£π2
(
£g
->
ac˚ss
->
ty≥
 =
NULL_EVENT
,

875 
	`disk_check_hda
(
cuºdisk
, 
√xtdiskªq
, 
TRUE
);

878 
	}
}

885 
i‹eq_evít
 *

886 
	$disk_ªque°_√eds_bus
(
disk
 *
cuºdisk
,

887 
diskªq
 *
cuºdiskªq
,

888 
check_w©îm¨k
)

890 
i‹eq_evít
 *
busi‹eq
 = 
NULL
;

891 
i‹eq_evít
 *
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

892 
diskªq
 *
£g_ow√r
;

893 
£gmít
 *
£g
 = 
cuºdiskªq
->seg;

895 if((
cuºdisk
->
out°©e
 !
DISK_IDLE
Ë&& !cuºdisk->
outwaô
) {

899 if((
cuºdiskªq
->
Êags
 & 
FINAL_WRITE_RECONNECTION_1
) &&

900 !(
cuºdiskªq
->
Êags
 & 
FINAL_WRITE_RECONNECTION_2
)) {

904 if(
cuºdisk
->
c⁄°_ac˘ime
) {

905 if((
cuºdiskªq
 =
cuºdisk
->
cuºíthda
) &&

906 (
cuºdiskªq
->
ovîhód_d⁄e
 <
simtime
)) {

908 if(
cuºdisk
->
outwaô
) {

909 
busi‹eq
 = 
cuºdisk
->
outwaô
;

910 
cuºdisk
->
outwaô
 = 
NULL
;

911 
busi‹eq
->
time
 = 
simtime
;

914 
busi‹eq
 = 
	`i‹eq_c›y
(
tmpi‹eq
);

915 
busi‹eq
->
time
 = 
simtime
;

916 
busi‹eq
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

917 
busi‹eq
->
ˇu£
 = 
RECONNECT
;

920 
busi‹eq
->
bcou¡
 = 0;

922  
busi‹eq
;

925 if(
£g


926 && (
cuºdiskªq
 !
£g
->
ªcy˛îeq
)

927 && 
tmpi‹eq


928 && !(
cuºdiskªq
->
Êags
 & 
COMPLETION_SENT
))

930 
tmpi‹eq
 &&Åmpi‹eq->
√xt
) {

931 if(
cuºdiskªq
->
outblkno
 < (
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) {

934 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

936 if(
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
) {

937 
	`ddbg_as£π2
(
cuºdiskªq
->
outblkno
 <

938 (
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
),

941 if((
£g
->
ídblkno
 > 
cuºdiskªq
->
outblkno
)

942 && (
£g
->
°¨tblkno
 <
cuºdiskªq
->
outblkno
)

943 && (!
check_w©îm¨k


944 || (
£g
->
ídblkno
 >(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
))

945 || ((
£g
->
ídblkno
 - 
cuºdiskªq
->
outblkno
) >=

946 
cuºdiskªq
->
w©îm¨k
)))

948 if(
cuºdisk
->
outwaô
) {

949 
busi‹eq
 = 
cuºdisk
->
outwaô
;

950 
cuºdisk
->
outwaô
 = 
NULL
;

951 
busi‹eq
->
time
 = 
simtime
;

954 
busi‹eq
 = 
	`i‹eq_c›y
(
tmpi‹eq
);

955 
busi‹eq
->
time
 = 
simtime
;

956 
busi‹eq
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

957 
busi‹eq
->
ˇu£
 = 
RECONNECT
;

959 
busi‹eq
->
bcou¡
 = 
	`mö
(
£g
->
ídblkno
,(
tmpi‹eq
->
blkno
 +Åmpi‹eq->bcou¡)Ë- 
cuºdiskªq
->
outblkno
;

963 
£g_ow√r
 = 
	`disk_buf„r_£g_ow√r
(
£g
,
FALSE
);

964 if(!
£g_ow√r
) {

965 
£g_ow√r
 = 
cuºdiskªq
;

967 if((
cuºdiskªq
->
öblkno
 >(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
))

968 || ((
cuºdiskªq
->
outblkno
 =cuºdiskªq->
i‹eqli°
->
blkno
)

969 && (
cuºdiskªq
->
hôty≥
 !
BUFFER_APPEND
))

970 || ((
£g
->
ídblkno
 =
cuºdiskªq
->
outblkno
)

971 && (
£g
->
ídblkno
 < (
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
))

972 && ((
£g
->
ídblkno
 - 
£g_ow√r
->
öblkno
Ë< seg->
size
)

973 && (!
check_w©îm¨k


974 || ((
£g
->
ídblkno
 - 
cuºdiskªq
->
öblkno
) <=

975 
cuºdiskªq
->
w©îm¨k
))))

977 if(
cuºdisk
->
outwaô
) {

978 
busi‹eq
 = 
cuºdisk
->
outwaô
;

979 
cuºdisk
->
outwaô
 = 
NULL
;

980 
busi‹eq
->
time
 = 
simtime
;

983 
busi‹eq
 = 
	`i‹eq_c›y
(
tmpi‹eq
);

984 
busi‹eq
->
time
 = 
simtime
;

985 
busi‹eq
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

986 
busi‹eq
->
ˇu£
 = 
RECONNECT
;

988 if((
cuºdiskªq
->
outblkno
 =cuºdiskªq->
i‹eqli°
->
blkno
)

989 && (
cuºdiskªq
->
hôty≥
 !
BUFFER_APPEND
))

991 
busi‹eq
->
bcou¡
 = 
	`mö
(
tmpi‹eq
->bcou¡,
£g
->
size
);

994 
i1
 = 
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
 -

995 
cuºdiskªq
->
outblkno
;

997 
i2
 = 
£g
->
size
 - seg->
ídblkno
 + 
£g_ow√r
->
öblkno
;

999 
busi‹eq
->
bcou¡
 = 
	`mö
(
i1
, 
i2
);

1005  
busi‹eq
;

1006 
	}
}

1041 
diskªq
 *

1042 
	$disk_£À˘_bus_ªque°
(
disk
 *
cuºdisk
, 
i‹eq_evít
 **
busi‹eq
)

1044 
diskªq
 *
cuºdiskªq
 = 
cuºdisk
->
≥ndx„r
;

1045 
diskªq
 *
be°diskªq
 = 
NULL
;

1046 
i‹eq_evít
 *
cuºi‹eq
 = 0;

1047 
i‹eq_evít
 *
tmpi‹eq
;

1048 
cuº_vÆue
;

1049 
be°_vÆue
 = -99;

1050 
cuº_£t_£gmít
;

1051 
be°_£t_£gmít
 = 
FALSE
;

1053 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1054 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ E¡îög disk_£À˘_bus_ªque° f‹ disk %d\n", 
simtime
, 
cuºdisk
->
devno
);

1055 
	`fÊush
(
ouçutfûe
);

1058 
cuºdiskªq
) {

1059 
cuº_vÆue
 = -100;

1060 
cuº_£t_£gmít
 = 
FALSE
;

1061 
	`ddbg_as£π2
(
cuºdiskªq
->
i‹eqli°
 != 0,

1064 if(
cuºdiskªq
->
£g


1065 && (
cuºdiskªq
->
£g
->
ªcy˛îeq
 == currdiskreq))

1069 if(
cuºdiskªq
->
Êags
 & 
HDA_OWNED
) {

1070 
cuºi‹eq
 = 
	`disk_ªque°_√eds_bus
(
cuºdisk
,
cuºdiskªq
,
TRUE
);

1071 if(
cuºi‹eq
) {

1072 if(
cuºdiskªq
 =
cuºdisk
->
ef„˘ivehda
) {

1073 
cuº_vÆue
 = 9;

1075 if(
cuºdiskªq
 =
cuºdisk
->
cuºíthda
) {

1076 
cuº_vÆue
 = 8;

1079 
cuº_vÆue
 = 10;

1083 if((
be°_vÆue
 <= 7)

1084 && (
cuºdisk
->
Á°wrôes
 =
LIMITED_FASTWRITE
)

1085 && (
cuºdiskªq
->
hôty≥
 =
BUFFER_APPEND
))

1087 
cuºi‹eq
 = 
	`disk_ªque°_√eds_bus
(
cuºdisk
,
cuºdiskªq
,
TRUE
);

1088 if(
cuºi‹eq
) {

1089 
cuº_vÆue
 = 7;

1092 if((
be°_vÆue
 <= 6)

1093 && (
cuºdisk
->
¢ókyöãrmedüãªadhôs
)

1094 && (
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
))

1096 if(
cuºdiskªq
->
£g
) {

1097 
cuºi‹eq
 = 
	`disk_ªque°_√eds_bus
(
cuºdisk
,
cuºdiskªq
,
TRUE
);

1098 if(
cuºi‹eq
) {

1099 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

1100 
tmpi‹eq
->
√xt
) {

1101 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

1104 
cuº_vÆue
 = ((
cuºdiskªq
->
£g
->
ídblkno
 >(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) ? 6 : 5);

1106 if(
cuºdiskªq
->
outblkno
 =cuºdiskªq->
i‹eqli°
->
blkno
) {

1108 
cuºi‹eq
 = 
	`disk_ªque°_√eds_bus
(
cuºdisk
,
cuºdiskªq
,
FALSE
);

1109 if(
cuºi‹eq
) {

1110 
	`addt€xåaq
((
evít
 *)
cuºi‹eq
);

1115 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1116 
	`Ârötf
 (
ouçutfûe
, "%12.6f "

1119 
simtime
);

1121 
	`Ârötf
 (
ouçutfûe
, " "

1123 
cuºdiskªq
->
£g
->
°¨tblkno
,

1124 
cuºdiskªq
->
£g
->
ídblkno
);

1126 
	`Ârötf
 (
ouçutfûe
, " "

1128 
cuºdiskªq
->
i‹eqli°
->
blkno
,

1129 
cuºdiskªq
->
i‹eqli°
->
bcou¡
,

1130 (
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
));

1132 
	`fÊush
(
ouçutfûe
);

1137 
	`disk_buf„r_ªmove_‰om_£g
(
cuºdiskªq
);

1141 if(!
cuºdiskªq
->
£g
 && (
be°_vÆue
 <= 4)) {

1142 
	`disk_buf„r_£À˘_£gmít
(
cuºdisk
, 
cuºdiskªq
, 
FALSE
);

1143 if(
cuºdiskªq
->
£g
) {

1144 if(
cuºdiskªq
->
hôty≥
 =
BUFFER_NOMATCH
) {

1145 
cuºdiskªq
->
£g
 = 
NULL
;

1148 if(
cuºdisk
->
ªqw©î
) {

1149 
cuºdiskªq
->
w©îm¨k
 = 
	`max
(1, (Ë((Ë
	`mö
(cuºdiskªq->
£g
->
size
, cuºdiskªq->
i‹eqli°
->
bcou¡
Ë* 
cuºdisk
->
ªadw©î
));

1152 
cuºdiskªq
->
w©îm¨k
 = (Ë(((Ëcuºdiskªq->
£g
->
size
 * 
cuºdisk
->
ªadw©î
) + () 0.9999999999);

1155 
cuºi‹eq
 = 
	`disk_ªque°_√eds_bus
(
cuºdisk
,
cuºdiskªq
,
TRUE
);

1156 if(!
cuºi‹eq
) {

1157 
cuºdiskªq
->
£g
 = 
NULL
;

1158 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

1161 
cuº_vÆue
 = ((
cuºdiskªq
->
hôty≥
 =
BUFFER_WHOLE
) ? 4 : 3);

1162 
cuº_£t_£gmít
 = 
TRUE
;

1168 if((
be°_vÆue
 <= 2)

1169 && (
cuºdisk
->
wrôïªbuf„rög
)

1170 && !(
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
))

1172 if(
cuºdiskªq
->
£g
) {

1173 
cuºi‹eq
 = 
	`disk_ªque°_√eds_bus
(
cuºdisk
,
cuºdiskªq
,
TRUE
);

1174 if(
cuºi‹eq
) {

1175 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

1176 
tmpi‹eq
->
√xt
) {

1177 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

1179 if(
cuºdisk
->
ef„˘ivehda
 &&

1180 (
cuºdisk
->
ef„˘ivehda
->
£g
 =
cuºdiskªq
->seg)) {

1181 
cuº_vÆue
 = 2;

1183 if(
cuºdisk
->
cuºíthda
 &&

1184 (
cuºdisk
->
cuºíthda
->
£g
 =
cuºdiskªq
->seg)) {

1185 
cuº_vÆue
 = 1;

1188 
cuº_vÆue
 = 0;

1192 if(
be°_vÆue
 <= -1) {

1193 
	`disk_buf„r_£À˘_£gmít
(
cuºdisk
,
cuºdiskªq
,
FALSE
);

1194 if(
cuºdiskªq
->
£g
) {

1195 if(
cuºdisk
->
ªqw©î
) {

1196 
cuºdiskªq
->
w©îm¨k
 = 
	`max
(1, (Ë((Ë
	`mö
(cuºdiskªq->
£g
->
size
, cuºdiskªq->
i‹eqli°
->
bcou¡
Ë* 
cuºdisk
->
wrôew©î
));

1199 
cuºdiskªq
->
w©îm¨k
 = (Ë(((Ëcuºdiskªq->
£g
->
size
 * 
cuºdisk
->
wrôew©î
) + () 0.9999999999);

1201 
cuºi‹eq
 = 
	`disk_ªque°_√eds_bus
(
cuºdisk
,
cuºdiskªq
,
TRUE
);

1202 if(
cuºi‹eq
) {

1203 
cuº_vÆue
 = -1;

1204 
cuº_£t_£gmít
 = 
TRUE
;

1207 
cuºdiskªq
->
£g
 = 
NULL
;

1208 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

1214 if(
cuº_vÆue
 >
be°_vÆue
) {

1215 if(*
busi‹eq
) {

1216 
	`addt€xåaq
((
evít
 *Ë*
busi‹eq
);

1217 if(
be°_£t_£gmít
) {

1218 
be°diskªq
->
£g
 = 
NULL
;

1219 
be°diskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

1222 
be°_vÆue
 = 
cuº_vÆue
;

1223 
be°_£t_£gmít
 = 
cuº_£t_£gmít
;

1224 
be°diskªq
 = 
cuºdiskªq
;

1225 *
busi‹eq
 = 
cuºi‹eq
;

1226 } if(
cuº_£t_£gmít
) {

1227 
cuºdiskªq
->
£g
 = 
NULL
;

1228 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

1231 
cuºdiskªq
 = cuºdiskªq->
bus_√xt
;

1234 if(
be°_£t_£gmít
) {

1235 
	`disk_buf„r_£t_£gmít
(
cuºdisk
,
be°diskªq
);

1238 (
be°diskªq
);

1239 
	}
}

1258 
	$disk_check_bus
 (
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
)

1260 
diskªq
 *
√xtdiskªq
 = 
cuºdiskªq
;

1261 
diskªq
 *
tmpdiskªq
;

1262 
i‹eq_evít
 *
busi‹eq
 = 
NULL
;

1263 
dñay
;

1265 
	`disksim_ö°_íãr
();

1267 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1268 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_check_bu†f‹ disk %d\n", 
simtime
, 
cuºdiskªq
,
cuºdisk
->
devno
);

1269 
	`fÊush
(
ouçutfûe
);

1272 if(
cuºdisk
->
buswaô
) {

1278 if(
cuºdiskªq
) {

1279 if(
cuºdisk
->
ef„˘ivebus
) {

1280 if(
cuºdisk
->
ef„˘ivebus
 !
cuºdiskªq
) {

1281 
√xtdiskªq
 = 
NULL
;

1284 if(
cuºdisk
->
cuºítbus
) {

1285 if(
cuºdisk
->
cuºítbus
 !
cuºdiskªq
) {

1286 
√xtdiskªq
 = 
NULL
;

1289 if(
√xtdiskªq
) {

1295 
busi‹eq
 = 
	`disk_ªque°_√eds_bus
(
cuºdisk
,
√xtdiskªq
,
TRUE
);

1296 if(!
busi‹eq
) {

1297 
√xtdiskªq
 = 
NULL
;

1302 if(
cuºdisk
->
ef„˘ivebus
) {

1303 
busi‹eq
 = 
	`disk_ªque°_√eds_bus
(
cuºdisk
,cuºdisk->
ef„˘ivebus
,
TRUE
);

1304 if(
busi‹eq
) {

1305 
√xtdiskªq
 = 
cuºdisk
->
ef„˘ivebus
;

1308 if(
cuºdisk
->
cuºítbus
) {

1309 
busi‹eq
 = 
	`disk_ªque°_√eds_bus
(
cuºdisk
,cuºdisk->
cuºítbus
,
TRUE
);

1310 if(
busi‹eq
) {

1311 
√xtdiskªq
 = 
cuºdisk
->
cuºítbus
;

1315 
√xtdiskªq
 = 
	`disk_£À˘_bus_ªque°
(
cuºdisk
,&
busi‹eq
);

1319 if(
√xtdiskªq
) {

1320 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1321 
	`Ârötf
 (
ouçutfûe
, "Çextdiskªq = %8p\n", 
√xtdiskªq
);

1322 
	`fÊush
(
ouçutfûe
);

1325 if((
√xtdiskªq
 !
cuºdisk
->
cuºítbus
)

1326 && (
√xtdiskªq
 !
cuºdisk
->
ef„˘ivebus
))

1329 if(
cuºdisk
->
≥ndx„r
 =
√xtdiskªq
) {

1330 
cuºdisk
->
≥ndx„r
 = 
√xtdiskªq
->
bus_√xt
;

1333 
tmpdiskªq
 = 
cuºdisk
->
≥ndx„r
;

1334 
tmpdiskªq
 && (tmpdiskªq->
bus_√xt
 !
√xtdiskªq
)) {

1335 
tmpdiskªq
 =Åmpdiskªq->
bus_√xt
;

1338 
	`ddbg_as£π2
(
tmpdiskªq
 != 0,

1341 
tmpdiskªq
->
bus_√xt
 = 
√xtdiskªq
->bus_next;

1343 
√xtdiskªq
->
bus_√xt
 = 
NULL
;

1346 
cuºdisk
->
cuºítbus
 = cuºdisk->
ef„˘ivebus
 = 
√xtdiskªq
;

1348 if(
busi‹eq
->
ˇu£
 =
RECONNECT
) {

1349 if(
√xtdiskªq
->
i‹eqli°
->
Êags
 & 
READ
) {

1350 
	`disk_a˘iv©e_ªad
(
cuºdisk
, 
√xtdiskªq
, 
FALSE
, FALSE);

1353 
	`disk_a˘iv©e_wrôe
(
cuºdisk
, 
√xtdiskªq
, 
FALSE
, FALSE);

1356 if(
cuºdisk
->
exåadisc_diskªq
 =
√xtdiskªq
) {

1357 
cuºdisk
->
exåadisc_diskªq
 = 
NULL
;

1358 
dñay
 = 
cuºdisk
->
ovîhód_ª£À˘_fú°
;

1361 
dñay
 = ((
√xtdiskªq
->
Êags
 & 
EXTRA_WRITE_DISCONNECT
Ë? 
cuºdisk
->
ovîhód_ª£À˘_Ÿhî
 : cuºdisk->
ovîhód_ª£À˘_fú°
);

1364 if(
busi‹eq
->
bcou¡
 > 0) {

1365 
dñay
 +
cuºdisk
->
ovîhód_d©a_¥ï
;

1368 if(
cuºdisk
->
c⁄°_ac˘ime
) {

1369 
dñay
 = 0.0;

1372 
√xtdiskªq
->
£g
->
out°©e
 = 
BUFFER_CONTACTING
;

1375 
cuºdisk
->
out°©e
 = 
DISK_WAIT_FOR_CONTROLLER
;

1376 
	`disk_£nd_evít_up_∑th
(
busi‹eq
, (
dñay
 * 
cuºdisk
->
timesˇÀ
));

1379 if(
busi‹eq
->
ˇu£
 =
DEVICE_DATA_TRANSFER_COMPLETE
) {

1380 
	`disk_ªc⁄√˘i⁄_‹_å™s„r_com∂ëe
(
busi‹eq
);

1383 
	`ddbg_as£π2
(0, "unexpected busioreq->cause in disk_check_bus");

1386 
	}
}

1390 
	$disk_gë_ªm≠≥d_£˘‹
(
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuº
)

1392 
ac˘ime
;

1393 
£gmít
 *
£g
;

1394 
diskªq
 *
cuºdiskªq
 = 
cuºdisk
->
ef„˘ivehda
;

1396 
	`ddbg_as£π2
(
cuºdiskªq
 != 0, "NoÉffectivehda");

1398 
£g
 = 
cuºdiskªq
->seg;

1402 
uöt64_t
 
n£cs
;

1403 
dm_pbn
 
pbn
;

1405 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

1406 
cuº
->
blkno
,

1407 
MAP_FULL
,

1408 &
pbn
,

1410 
cuº
->
ˇu£
 = 
pbn
.
£˘‹
;

1424 
n£cs
 = 
cuºdisk
->
modñ
->
mech
->
	`dm_ac˘ime
(currdisk->model,

1425 &
cuºdisk
->
mech_°©e
,

1426 &
pbn
,

1428 (
cuº
->
Êags
 & 
READ
),

1430 &
cuºdisk
->
mech_°©e
,

1432 
ac˘ime
 = 
	`dm_time_ôod
(
n£cs
);

1436 
cuº
->
time
 = 
simtime
 + 
ac˘ime
;

1437 if(
cuºdisk
->
°©
.
œãncy
 == () -1.0) {

1438 
cuºdisk
->
°©
.
œãncy
 = () 0.0;

1439 
cuºdisk
->
°©
.
x„πime
 = 
ac˘ime
 - cuºdisk->°©.
£ektime
;

1442 
cuºdisk
->
°©
.
x„πime
 +
ac˘ime
;

1445 if(((
cuºdiskªq
 !
£g
->
ªcy˛îeq
)

1446 && 
	`disk_buf„r_block_avaûabÀ
(
cuºdisk
, 
£g
, 
cuº
->
blkno
))

1447 || ((
cuº
->
Êags
 & 
READ
Ë&& (!
cuºdisk
->
ªad_dúe˘_to_buf„r
)))

1449 
cuº
->
ty≥
 = 
DEVICE_GOT_REMAPPED_SECTOR
;

1454 
°
 = 
cuºdisk
->
modñ
->
œyout
->
	`dm_gë_£˘‹s_lbn
(currdisk->model,

1455 
cuº
->
blkno
);

1457 
rŸtime
 = 
cuºdisk
->
modñ
->
mech
->
	`dm_≥riod
(currdisk->model);

1460 
cuº
->
time
 -((Ë1 / (()
°
 * 
rŸtime
));

1461 
cuº
->
ty≥
 = 
DEVICE_GOTO_REMAPPED_SECTOR
;

1463 
	}
}

1467 
	$disk_gŸo_ªm≠≥d_£˘‹
 (
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuº
)

1469 
rŸ©ëime
 =

1470 
	`dm_time_ôod
(
cuºdisk
->
modñ
->
mech
->
	`dm_≥riod
(currdisk->model));

1472 
diskªq
 *
cuºdiskªq
 = 
cuºdisk
->
ef„˘ivehda
;

1473 
£gmít
 *
£g
;

1475 
	`ddbg_as£π2
(
cuºdiskªq
 != 0, "NoÉffectivehda");

1477 
£g
 = 
cuºdiskªq
->seg;

1478 if(
£g
->
out°©e
 =
BUFFER_PREEMPT
) {

1479 
	`disk_ªÀa£_hda
(
cuºdisk
, 
cuºdiskªq
);

1483 if((
cuºdiskªq
 !
£g
->
ªcy˛îeq
)

1484 && 
	`disk_buf„r_block_avaûabÀ
(
cuºdisk
, 
£g
, 
cuº
->
blkno
))

1487 
°
 = 
cuºdisk
->
modñ
->
œyout
->
	`dm_gë_£˘‹s_lbn
(currdisk->model,

1488 
cuº
->
blkno
);

1489 
rŸtime
 = 
cuºdisk
->
modñ
->
mech
->
	`dm_≥riod
(currdisk->model);

1492 
cuº
->
time
 +((Ë1 / (()
°
 * 
rŸtime
));

1493 
cuº
->
ty≥
 = 
DEVICE_GOT_REMAPPED_SECTOR
;

1496 
£g
->
time
 +
rŸ©ëime
;

1497 
cuºdisk
->
°©
.
x„πime
 +
rŸ©ëime
;

1498 
cuº
->
time
 +
rŸ©ëime
;

1499 
cuº
->
ty≥
 = 
DEVICE_GOTO_REMAPPED_SECTOR
;

1501 
	`addtoötq
((
evít
 *Ë
cuº
);

1502 
	}
}

1507 
	$disk_öôüã_£ek
 (
disk
 *
cuºdisk
,

1508 
£gmít
 *
£g
,

1509 
i‹eq_evít
 *
cuº
,

1510 
fú°£ek
,

1511 
dñay
,

1512 
mötime
)

1514 
dm_pbn
 
de°pbn
;

1515 
£ektime
;

1516 
£ekdi°
;

1517 
ªm≠£˘‹
 = 0;

1519 
	`disksim_ö°_íãr
();

1527 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1528 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ E¡îög disk_öôüã_£ekÅÿ%d f‹ disk %d\n", 
simtime
, 
cuº
->
blkno
, cuº->
devno
);

1529 
	`fÊush
(
ouçutfûe
);

1533 
cuº
->
ty≥
 = 
NULL_EVENT
;

1534 
£g
->
time
 = 
simtime
 + 
dñay
;

1539 
rv
;

1540 
uöt64_t
 
n£cs
;

1541 
dm_mech_°©e
 
íd
;

1542 
dm_mech_°©e
 
begö
 = 
cuºdisk
->
mech_°©e
;

1545 
rv
 = 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

1546 
cuº
->
blkno
,

1547 
MAP_FULL
,

1548 &
de°pbn
,

1549 &
ªm≠£˘‹
);

1550 
	`ddbg_as£π
(
rv
 =
DM_OK
);

1553 
£ekdi°
 = 
	`abs
(
cuºdisk
->
mech_°©e
.
cyl
 - 
de°pbn
.cyl);

1555 
íd
.
cyl
 = 
de°pbn
.cyl;

1556 
íd
.
hód
 = 
de°pbn
.head;

1557 
íd
.
thëa
 = 0;

1559 
cuº
->
ˇu£
 = 
de°pbn
.
£˘‹
;

1568 
n£cs
 = 
cuºdisk
->
modñ
->
mech
->
	`dm_£ek_time
(currdisk->model,

1569 &
begö
,

1570 &
íd
,

1571 (
cuº
->
Êags
 & 
READ
));

1572 
£ektime
 = 
	`dm_time_ôod
(
n£cs
);

1576 if(
£ektime
 < 
mötime
) {

1577 
£g
->
time
 +
mötime
 - 
£ektime
;

1580 
cuº
->
time
 = 
£g
->timê+ 
£ektime
;

1581 if((
cuº
->
Êags
 & 
BUFFER_BACKGROUND
)

1582 && (
cuº
->
Êags
 & 
READ
))

1584 if((
cuºdisk
->
c⁄åód
 =
BUFFER_READ_UNTIL_CYL_END
)

1585 && (
£ekdi°
 != 0))

1587  
FALSE
;

1590 if((
cuºdisk
->
c⁄åód
 =
BUFFER_READ_UNTIL_TRACK_END
)

1591 && ((
£ekdi°
 != 0) |

1592 (
cuºdisk
->
mech_°©e
.
hód
 !
de°pbn
.head)))

1594  
FALSE
;

1598 if(
fú°£ek
) {

1599 
cuºdisk
->
°©
.
£ekdi°™˚
 = 
£ekdi°
;

1600 
cuºdisk
->
°©
.
£ektime
 = seektime;

1601 
cuºdisk
->
°©
.
œãncy
 = () -1.0;

1602 
cuºdisk
->
°©
.
x„πime
 = () -1.0;

1604 if(
ªm≠£˘‹
 == 0) {

1605 
cuºdisk
->
°©
.
x„πime
 +
£ektime
;

1607 
cuº
->
ty≥
 = 
DEVICE_BUFFER_SEEKDONE
;

1608 if(
ªm≠£˘‹
 != 0) {

1609 
	`disk_gë_ªm≠≥d_£˘‹
(
cuºdisk
, 
cuº
);

1611 
	`addtoötq
((
evít
 *Ë
cuº
);

1619  
TRUE
;

1620 
	}
}

1630 
	$disk_gë_ef„˘ivehda
(
disk
 *
cuºdisk
,

1631 
diskªq
 *
cuºdiskªq
)

1633 
diskªq
 *
√xtdiskªq
 = 
cuºdiskªq
;

1634 
i‹eq_evít
 *
√xti‹eq
;

1637 if(
cuºdisk
->
cuºíthda
) {

1638 if(
cuºdiskªq
 && (cuºdiskªq !
cuºdisk
->
cuºíthda
)) {

1639 
	`Ârötf
(
°dîr
, "currdiskreq != currenthda in disk_check_hda\n");

1640 
	`as£π
(0);

1642 
cuºdisk
->
ef„˘ivehda
 = cuºdisk->
cuºíthda
;

1648 if(
√xtdiskªq
 &&Çextdiskªq->
i‹eqli°
) {

1649 
√xti‹eq
 = 
	`i‹eq_c›y
(
√xtdiskªq
->
i‹eqli°
);

1650 
√xti‹eq
->
i‹eq_hﬁd_diskªq
 = 
√xtdiskªq
;

1651 
√xti‹eq
->
i‹eq_hﬁd_disk
 = 
cuºdisk
;

1652 if(!
	`disk_íabÀmít_fun˘i⁄
(
√xti‹eq
)) {

1653 
√xtdiskªq
 = 
NULL
;

1655 
	`addt€xåaq
((
evít
 *)
√xti‹eq
);

1660 if(!
√xtdiskªq
) {

1661 
√xti‹eq
 = 
	`ioqueue_show_√xt_ªque°
(
cuºdisk
->
queue
);

1662 if(
√xti‹eq
) {

1663 
√xtdiskªq
 = (
diskªq
*Ë
√xti‹eq
->
i‹eq_hﬁd_diskªq
;

1670 if(
√xtdiskªq
) {

1671 if(
√xtdiskªq
->
Êags
 & 
HDA_OWNED
) {

1672 
	`Ârötf
(
°dîr
, "disk_check_hda:"

1674 
	`as£π
(0);

1679 if(
√xtdiskªq
->
£g
 &&

1680 !(
√xtdiskªq
->
Êags
 & 
SEG_OWNED
) &&

1681 (
√xtdiskªq
->
£g
->
ªcy˛îeq
 !=Çextdiskreq))

1683 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
, 
√xtdiskªq
);

1687 if(!
√xtdiskªq
->
£g
) {

1689 
	`disk_buf„r_£À˘_£gmít
(
cuºdisk
,
√xtdiskªq
,
FALSE
);

1690 if(
√xtdiskªq
->
£g
) {

1691 
	`disk_buf„r_£t_£gmít
(
cuºdisk
, 
√xtdiskªq
);

1692 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
, 
√xtdiskªq
);

1696 
√xtdiskªq
->
£g
 =

1697 
	`disk_buf„r_ªcy˛abÀ_£gmít
(
cuºdisk
,

1698 (
√xtdiskªq
->
i‹eqli°
->
Êags
 & 
READ
));

1699 if(
√xtdiskªq
->
£g
) {

1700 
√xtdiskªq
->
£g
->
ªcy˛îeq
 =Çextdiskreq;

1708 if(
√xtdiskªq
->
£g
) {

1709 
√xti‹eq
 = 
√xtdiskªq
->
i‹eqli°
;

1710 
√xti‹eq
) {

1711 if(!
	`ioqueue_gë_•ecific_ªque°
(
cuºdisk
->
queue
,

1712 
√xti‹eq
))

1714 
	`Ârötf
(
°dîr
, "disk_get_effectivehda()"

1717 
	`as£π
(0);

1720 
√xti‹eq
 =Çexti‹eq->
√xt
;

1725 
cuºdisk
->
cuºíthda
 = cuºdisk->
ef„˘ivehda
 = 
√xtdiskªq
;

1726 
√xtdiskªq
->
Êags
 |
HDA_OWNED
;

1731 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1732 
	`Ârötf
 (
ouçutfûe
, " "

1733 "ef„˘ivehd®%8p\n", 
cuºdisk
->
ef„˘ivehda
);

1734 
	`fÊush
(
ouçutfûe
);

1736 
	}
}

1744 
	$disk_check_hda_≥ndög
(
disk
 *
cuºdisk
,

1745 
i‹eq_evít
 *
√xti‹eq
,

1746 
diskªq
 *
√xtdiskªq
,

1747 
£gmít
 *
£g
,

1748 
ok_to_check_bus
,

1749 *
mötime
,

1750 *
immedüã_ªÀa£
,

1751 *
öôüã_£ek
)

1753 
	`disksim_ö°_íãr
();

1755 
√xti‹eq
 = 
√xtdiskªq
->
i‹eqli°
;

1756 
√xti‹eq
->
√xt
) {

1757 
√xti‹eq
 =Çexti‹eq->
√xt
;

1759 
£g
->
ac˚ss
->
Êags
 = 
√xti‹eq
->flags;

1762 if(
√xti‹eq
->
Êags
 & 
READ
) {

1763 if(
£g
->
ac˚ss
->
ty≥
 !
NULL_EVENT
) {

1778 
£g
->
ac˚ss
->
blkno
 = seg->
ídblkno
;

1781 if(!
£g
->
ªcy˛îeq
) {

1782 
£g
->
möªadahódblkno
 =

1783 
	`max
(
£g
->
möªadahódblkno
,

1784 
	`mö
((
√xti‹eq
->
blkno
 +

1785 
√xti‹eq
->
bcou¡
 +

1786 
cuºdisk
->
möªadahód
),

1787 
cuºdisk
->
modñ
->
dm_£˘‹s
));

1789 
£g
->
maxªadahódblkno
 =

1790 
	`max
(
£g
->
maxªadahódblkno
,

1791 
	`mö
(
	`disk_buf„r_gë_max_ªadahód
(
cuºdisk
,
£g
,
√xti‹eq
),

1792 
cuºdisk
->
modñ
->
dm_£˘‹s
));

1795 
cuºdisk
->
immed
 = cuºdisk->
immedªad
;

1796 
£g
->
°©e
 = 
BUFFER_READING
;

1797 if(
£g
->
ªcy˛îeq
) {

1798 
£g
->
ac˚ss
->
blkno
 = 
√xtdiskªq
->
outblkno
;

1799 *
öôüã_£ek
 = 
TRUE
;

1801 if((
£g
->
ídblkno
 < (
√xti‹eq
->
blkno
 +

1802 
√xti‹eq
->
bcou¡
))

1803 || (
£g
->
°¨tblkno
 > 
√xtdiskªq
->
outblkno
))

1805 *
öôüã_£ek
 = 
TRUE
;

1807 if(
£g
->
ídblkno
 <

1808 
	`max
(
£g
->
maxªadahódblkno
,

1809 
	`disk_buf„r_gë_max_ªadahód
(
cuºdisk
,

1810 
£g
,

1811 
√xti‹eq
)))

1813 
£g
->
ac˚ss
->
Êags
 |
BUFFER_BACKGROUND
;

1814 if(
cuºdisk
->
ªadahódifidÀ
) {

1816 *
öôüã_£ek
 = 
TRUE
;

1820 *
immedüã_ªÀa£
 = 
TRUE
;

1823 if(
£g
->
ac˚ss
->
ty≥
 !
NULL_EVENT
) {

1824 if(*
immedüã_ªÀa£
) {

1825 
	`Ârötf
(
°dîr
,"CHECK: immediate_releaseÑeset!\n");

1826 
	`fÊush
(
°dîr
);

1829 *
öôüã_£ek
 = 
FALSE
;

1830 *
immedüã_ªÀa£
 = 
FALSE
;

1836 if(
£g
->
ac˚ss
->
ty≥
 !
NULL_EVENT
) {

1837 
	`Ârötf
(
°dîr
, "non-NULL seg->access->type found"

1839 
	`as£π
(0);

1843 if((
√xtdiskªq
->
hôty≥
 !
BUFFER_APPEND
)

1844 || (
£g
->
ac˚ss
->
Êags
 & 
READ
)

1845 || (
£g
->
ac˚ss
->
blkno
 !
√xtdiskªq
->
i‹eqli°
->blkno)

1846 || (
£g
->
ac˚ss
->
bcou¡
 != 1)

1847 || (
£g
->
ac˚ss
->
time
 !
simtime
))

1849 *
mötime
 = 
cuºdisk
->
möimum_£ek_dñay
;

1856 
£g
->
ac˚ss
->
blkno
 = 
√xtdiskªq
->
öblkno
;

1857 if(
√xtdiskªq
->
Êags
 & 
COMPLETION_RECEIVED
) {

1858 
£g
->
ac˚ss
->
Êags
 |
BUFFER_BACKGROUND
;

1860 
cuºdisk
->
immed
 = cuºdisk->
immedwrôe
;

1861 if((
£g
->
°©e
 !
BUFFER_WRITING
)

1862 && (
£g
->
°©e
 !
BUFFER_DIRTY
))

1864 
cuºdisk
->
numdúty
++;

1866 if((
disk_¥öthack
 > 1)

1867 && (
simtime
 >
disk_¥öthacktime
))

1869 
	`Ârötf
 (
ouçutfûe
, " "

1870 "numdúty++ = %d\n",
cuºdisk
->
numdúty
);

1871 
	`fÊush
(
ouçutfûe
);

1874 
	`as£π
(
cuºdisk
->
numdúty
 >= 0);

1875 
	`as£π
(
cuºdisk
->
numdúty
 <cuºdisk->
numwrôe£gs
);

1879 
£g
->
°©e
 = 
BUFFER_WRITING
;

1880 if(
√xtdiskªq
->
öblkno
 < (
√xti‹eq
->
blkno
 +Çexti‹eq->
bcou¡
))

1882 *
öôüã_£ek
 = 
TRUE
;

1885 *
immedüã_ªÀa£
 = 
TRUE
;

1889 if(
ok_to_check_bus


1890 && (
cuºdisk
->
exåadisc_diskªq
 !
√xtdiskªq
))

1892 
	`disk_check_bus
(
cuºdisk
,
√xtdiskªq
);

1894 
	}
}

1903 
	$disk_check_hda
(
disk
 *
cuºdisk
,

1904 
diskªq
 *
cuºdiskªq
,

1905 
ok_to_check_bus
)

1907 
£gmít
 *
£g
;

1908 
diskªq
 *
√xtdiskªq
 = 0;

1909 
i‹eq_evít
 *
√xti‹eq
 = 0;

1910 
öôüã_£ek
 = 
FALSE
;

1911 
immedüã_ªÀa£
 = 
FALSE
;

1912 
dñay
 = 0.0;

1913 
mötime
 = 0.0;

1915 
	`disksim_ö°_íãr
();

1919 
cuºdisk
->
Âcheck
 = 6000;

1923 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1924 
	`Ârötf
 (
ouçutfûe
, "%12.6f %8p Entering disk_check_hda"

1925 " f‹ disk %d\n", 
simtime
, 
cuºdiskªq
,
cuºdisk
->
devno
);

1926 
	`fÊush
(
ouçutfûe
);

1929 if(
cuºdisk
->
c⁄°_ac˘ime
) {

1934 if(
cuºdisk
->
ef„˘ivehda
) {

1939 
	`disk_gë_ef„˘ivehda
(
cuºdisk
, 
cuºdiskªq
);

1940 if(!
cuºdisk
->
ef„˘ivehda
) {

1946 
√xtdiskªq
 = 
cuºdisk
->
ef„˘ivehda
;

1948 
	`as£π
(
√xtdiskªq
->
£g
 != 0);

1949 
£g
 = 
√xtdiskªq
->seg;

1951 if(
√xtdiskªq
->
i‹eqli°
) {

1952 
	`disk_check_hda_≥ndög
(
cuºdisk
,

1953 
√xti‹eq
,

1954 
√xtdiskªq
,

1955 
£g
,

1956 
ok_to_check_bus
,

1957 &
mötime
,

1958 &
immedüã_ªÀa£
,

1959 &
öôüã_£ek
);

1963 
£g
->
°©e
 = 
BUFFER_READING
;

1964 if(
£g
->
ídblkno
 < seg->
maxªadahódblkno
) {

1965 if(
£g
->
ac˚ss
->
ty≥
 !
NULL_EVENT
) {

1976 
£g
->
ac˚ss
->
blkno
 = seg->
ídblkno
;

1979 
£g
->
ac˚ss
->
Êags
 = 
READ
 | 
BUFFER_BACKGROUND
;

1980 
cuºdisk
->
immed
 = cuºdisk->
immedªad
;

1982 if(
£g
->
ac˚ss
->
ty≥
 =
NULL_EVENT
) {

1983 
öôüã_£ek
 = 
TRUE
;

1987 
immedüã_ªÀa£
 = 
TRUE
;

1991 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

1992 
	`Ârötf
 (
ouçutfûe
, " "

1994 
öôüã_£ek
, 
immedüã_ªÀa£
);

1995 
	`fÊush
(
ouçutfûe
);

1998 if(
öôüã_£ek
) {

1999 if(
√xtdiskªq
->
ovîhód_d⁄e
 > 
simtime
) {

2000 
dñay
 +
√xtdiskªq
->
ovîhód_d⁄e
 - 
simtime
;

2003 if(
disk_£ek_°›time
 > 
simtime
) {

2004 
dñay
 +
disk_£ek_°›time
 - 
simtime
;

2007 if(!
	`disk_öôüã_£ek
(
cuºdisk
,

2008 
£g
,

2009 
£g
->
ac˚ss
,

2010 
TRUE
,

2011 
dñay
,

2012 
mötime
))

2014 
	`disk_ªÀa£_hda
(
cuºdisk
, 
√xtdiskªq
);

2017 if(
immedüã_ªÀa£
) {

2018 
	`disk_ªÀa£_hda
(
cuºdisk
, 
√xtdiskªq
);

2021 if(!
immedüã_ªÀa£


2022 && (
£g
->
°©e
 =
BUFFER_READING
)

2023 && (
£g
->
ac˚ss
->
Êags
 & 
BUFFER_BACKGROUND
))

2025 
	`disk_check_¥e„tch_sw≠
(
cuºdisk
);

2028 
	}
}

2037 
	$disk_buf„r_°›_ac˚ss
 (
disk
 *
cuºdisk
)

2039 
diskªq
* 
ef„˘ive
 = 
cuºdisk
->
ef„˘ivehda
;

2040 
£gmít
* 
£g
;

2042 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

2043 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_°›_ac˚ss\n", 
simtime
, 
ef„˘ive
);

2044 
	`fÊush
(
ouçutfûe
);

2047 
	`ddbg_as£π2
(
ef„˘ive
 != 0, "disk has NULLÉffectivehda");

2049 
	`ddbg_as£π
(
ef„˘ive
 =
cuºdisk
->
cuºíthda
);

2051 
£g
 = 
ef„˘ive
->seg;

2053 
	`ddbg_as£π
((
£g
->
ac˚ss
->
Êags
 & 
BUFFER_BACKGROUND
) &&

2054 (
£g
->
ac˚ss
->
Êags
 & 
READ
));

2056 if(
£g
->
ac˚ss
->
ty≥
 !
NULL_EVENT
) {

2057 
rv
 = 
	`ªmove‰omötq
((
evít
 *)
£g
->
ac˚ss
);

2058 
	`ddbg_as£π3
(
rv
 !
FALSE
,

2060 
£g
->
ac˚ss
->
ty≥
));

2062 
£g
->
ac˚ss
->
ty≥
 = 
NULL_EVENT
;

2065 
£g
->
°©e
 = ((!(
ef„˘ive
->
Êags
 & 
COMPLETION_RECEIVED
)

2066 || 
cuºdisk
->
íabÀˇche


2067 || 
£g
->
diskªqli°
->
£g_√xt
Ë? 
BUFFER_CLEAN
 : 
BUFFER_EMPTY
);

2069 if(
ef„˘ive
->
Êags
 & 
COMPLETION_RECEIVED
) {

2070 
	`ddbg_as£π2
(
ef„˘ive
->
i‹eqli°
 == 0,

2073 
	`disk_buf„r_ªmove_‰om_£g
(
ef„˘ive
);

2074 
	`addt€xåaq
((
evít
 *Ë
ef„˘ive
);

2075 if(
£g
->
diskªqli°
) {

2076 
	`disk_föd_√w_£g_ow√r
(
cuºdisk
,
£g
);

2080 
cuºdisk
->
ef„˘ivehda
 = cuºdisk->
cuºíthda
 = 
NULL
;

2081 
	}
}

2087 
	$disk_buf„r_©ãm±_ac˚ss_sw≠
(
disk
 *
cuºdisk
,

2088 
diskªq
 *
cuºdiskªq
)

2090 
diskªq
 *
ef„˘ive
 = 
cuºdisk
->
ef„˘ivehda
;

2091 
i‹eq_evít
 *
cuºi‹eq
;

2092 
£gmít
 *
£g
;

2094 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

2095 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_©ãm±_ac˚ss_sw≠\n", 
simtime
, 
cuºdiskªq
);

2096 
	`Ârötf
 (
ouçutfûe
, "ÅryögÅÿsw≠ %8p\n", 
ef„˘ive
);

2097 
	`fÊush
(
ouçutfûe
);

2100 
	`ddbg_as£π2
(
ef„˘ive
 != 0, "disk has NULLÉffectivehda");

2102 
£g
 = 
ef„˘ive
->seg;

2104 
	`ddbg_as£π
(
£g
->
ac˚ss
->
Êags
 & 
READ
);

2105 
	`ddbg_as£π
(
cuºdiskªq
->
i‹eqli°
 !
NULL
);

2111 if((
ef„˘ive
 =
cuºdisk
->
cuºíthda
)

2112 && (
£g
->
ac˚ss
->
Êags
 & 
BUFFER_BACKGROUND
)

2113 && (!
sw≠_f‹w¨d_⁄ly


2114 || !
ef„˘ive
->
i‹eqli°


2115 || (
ef„˘ive
->
i‹eqli°
->
blkno
 < 
cuºdiskªq
->ioreqlist->blkno)))

2117 if(
ef„˘ive
->
Êags
 & 
COMPLETION_RECEIVED
) {

2118 
	`ddbg_as£π
(
ef„˘ive
->
i‹eqli°
 =
NULL
);

2119 
	`disk_buf„r_ªmove_‰om_£g
(
ef„˘ive
);

2120 
	`addt€xåaq
((
evít
 *Ë
ef„˘ive
);

2123 
	`ddbg_as£π
(
ef„˘ive
->
i‹eqli°
 !
NULL
);

2124 
cuºi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

2125 
	`ddbg_as£π
(
cuºi‹eq
 !
NULL
);

2126 
cuºi‹eq
->
√xt
) {

2127 
cuºi‹eq
 = cuºi‹eq->
√xt
;

2129 
£g
->
ac˚ss
->
Êags
 = 
cuºi‹eq
->flags;

2131 
£g
->
möªadahódblkno
 = 
	`max
(£g->möªadahódblkno, 
	`mö
((
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
 + 
cuºdisk
->
möªadahód
), cuºdisk->
modñ
->
dm_£˘‹s
));

2133 
£g
->
maxªadahódblkno
 = 
	`max
(£g->maxªadahódblkno, 
	`mö
(
	`disk_buf„r_gë_max_ªadahód
(
cuºdisk
,£g,
cuºi‹eq
), cuºdisk->
modñ
->
dm_£˘‹s
));

2135 if((
£g
->
ídblkno
 >(
cuºi‹eq
->
blkno
 + cuºi‹eq->
bcou¡
))

2136 && (
£g
->
ídblkno
 < seg->
maxªadahódblkno
))

2138 
£g
->
ac˚ss
->
Êags
 |
BUFFER_BACKGROUND
;

2141 
cuºdisk
->
ef„˘ivehda
 = cuºdisk->
cuºíthda
 = 
NULL
;

2143 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
))

2145 
	`Ârötf
 (
ouçutfûe
, " Swap successful\n");

2146 
	`fÊush
(
ouçutfûe
);

2149 (
TRUE
);

2152 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

2153 
	`Ârötf
 (
ouçutfûe
, " Swap unsuccessful\n");

2154 
	`fÊush
(
ouçutfûe
);

2157 (
FALSE
);

2158 
	}
}

2167 
	$disk_a˘iv©e_ªad
(
disk
 *
cuºdisk
,

2168 
diskªq
 *
cuºdiskªq
,

2169 
£t£g
,

2170 
ok_to_check_bus
)

2172 
i‹eq_evít
 *
cuºi‹eq
;

2174 
	`disksim_ö°_íãr
();

2176 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

2177 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_a˘iv©e_ªad\n", 
simtime
, 
cuºdiskªq
);

2178 
	`Ârötf
 (
ouçutfûe
, " së£g = %d\n", 
£t£g
);

2179 
	`fÊush
(
ouçutfûe
);

2184 if(
cuºdisk
->
c⁄°_ac˘ime
) {

2185 if(!
cuºdisk
->
cuºíthda
) {

2186 
cuºdisk
->
cuºíthda
 =

2187 
cuºdisk
->
ef„˘ivehda
 =

2188 
cuºdisk
->
cuºítbus
 = 
cuºdiskªq
;

2189 
cuºdiskªq
->
ovîhód_d⁄e
 = 
simtime
 + 
cuºdisk
->
ac˘ime
;

2190 
cuºi‹eq
 = 
	`i‹eq_c›y
(
cuºdiskªq
->
i‹eqli°
);

2191 
cuºi‹eq
->
i‹eq_hﬁd_diskªq
 = 
cuºdiskªq
;

2192 
cuºi‹eq
->
ty≥
 = 
DEVICE_PREPARE_FOR_DATA_TRANSFER
;

2193 
cuºi‹eq
->
time
 = 
cuºdiskªq
->
ovîhód_d⁄e
;

2194 
	`addtoötq
((
evít
 *Ë
cuºi‹eq
);

2195 
	`ioqueue_£t_°¨âime
(
cuºdisk
->
queue
,
cuºdiskªq
->
i‹eqli°
);

2202 if(!(
cuºdiskªq
->
Êags
 & 
HDA_OWNED
)

2203 && 
cuºdisk
->
ef„˘ivehda


2204 && (
cuºdisk
->
ef„˘ivehda
 !
cuºdiskªq
)

2205 && (
cuºdiskªq
->
hôty≥
 !
BUFFER_COLLISION
)

2206 && (!
cuºdiskªq
->
£g


2207 || (
cuºdiskªq
->
£g
->
ªcy˛îeq
 == currdiskreq)

2208 || (
cuºdiskªq
->
£g
->
°©e
 !
BUFFER_DIRTY
))

2209 && 
	`disk_buf„r_°›abÀ_ac˚ss
(
cuºdisk
,
cuºdiskªq
))

2211 if((
cuºdiskªq
->
£g
 !
cuºdisk
->
ef„˘ivehda
->seg)

2212 || (
cuºdiskªq
->
hôty≥
 =
BUFFER_NOMATCH
))

2214 
	`disk_buf„r_°›_ac˚ss
(
cuºdisk
);

2217 
	`disk_buf„r_©ãm±_ac˚ss_sw≠
(
cuºdisk
,
cuºdiskªq
);

2222 if(
cuºdiskªq
->
£g
 && 
£t£g
) {

2223 if(
cuºdisk
->
ef„˘ivehda
) {

2224 if(
cuºdiskªq
->
£g
->
ªcy˛îeq
 == currdiskreq) {

2226 
	`Ârötf
(
°dîr
,"GOT HERE! SURPRISE, SURPRISE!\n");

2227 
cuºdiskªq
->
£g
->
ªcy˛îeq
 = 
NULL
;

2229 
cuºdiskªq
->
£g
 = 
NULL
;

2230 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

2233 
	`disk_buf„r_£t_£gmít
(
cuºdisk
,
cuºdiskªq
);

2238 if(
cuºdiskªq
->
£g
 && !(cuºdiskªq->
Êags
 & 
SEG_OWNED
)) {

2239 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,
cuºdiskªq
);

2242 if(!(
cuºdiskªq
->
Êags
 & 
HDA_OWNED
)

2243 && (
cuºdiskªq
->
hôty≥
 !
BUFFER_COLLISION
)) {

2244 
	`disk_check_hda
(
cuºdisk
,
cuºdiskªq
,
ok_to_check_bus
);

2247 if(!(
cuºdiskªq
->
Êags
 & 
HDA_OWNED
)

2248 && (
cuºdisk
->
cuºítbus
 =
cuºdiskªq
)) {

2249 
cuºi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

2250 
cuºi‹eq
) {

2251 
	`ioqueue_£t_°¨âime
(
cuºdisk
->
queue
,
cuºi‹eq
);

2252 
cuºi‹eq
 = cuºi‹eq->
√xt
;

2255 
	}
}

2264 
	$disk_a˘iv©e_wrôe
(
disk
 *
cuºdisk
,

2265 
diskªq
 *
cuºdiskªq
,

2266 
£t£g
,

2267 
ok_to_check_bus
)

2269 
i‹eq_evít
 *
cuºi‹eq
;

2271 
	`disksim_ö°_íãr
();

2273 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

2274 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_a˘iv©e_wrôe\n", 
simtime
, 
cuºdiskªq
);

2275 
	`Ârötf
 (
ouçutfûe
, " së£g = %d\n", 
£t£g
);

2276 
	`fÊush
(
ouçutfûe
);

2279 if(!
cuºdisk
->
cuºíthda
 && (cuºdisk->
c⁄°_ac˘ime
)) {

2280 
cuºdisk
->
cuºíthda
 =

2281 
cuºdisk
->
ef„˘ivehda
 =

2282 
cuºdisk
->
cuºítbus
 = 
cuºdiskªq
;

2283 
cuºdiskªq
->
ovîhód_d⁄e
 = 
simtime
 + 
cuºdisk
->
ac˘ime
;

2284 
cuºi‹eq
 = 
	`i‹eq_c›y
(
cuºdiskªq
->
i‹eqli°
);

2285 
cuºi‹eq
->
i‹eq_hﬁd_diskªq
 = 
cuºdiskªq
;

2286 
cuºi‹eq
->
ty≥
 = 
DEVICE_PREPARE_FOR_DATA_TRANSFER
;

2287 
cuºi‹eq
->
time
 = 
cuºdiskªq
->
ovîhód_d⁄e
;

2288 
	`addtoötq
((
evít
 *Ë
cuºi‹eq
);

2289 
	`ioqueue_£t_°¨âime
(
cuºdisk
->
queue
,
cuºdiskªq
->
i‹eqli°
);

2293 if(!(
cuºdiskªq
->
Êags
 & 
HDA_OWNED
)

2294 && 
cuºdisk
->
ef„˘ivehda


2295 && (
cuºdisk
->
ef„˘ivehda
 !
cuºdiskªq
)

2296 && 
	`disk_buf„r_°›abÀ_ac˚ss
(
cuºdisk
,
cuºdiskªq
))

2298 if((
cuºdiskªq
->
£g
 !
cuºdisk
->
ef„˘ivehda
->seg)

2299 || (
cuºdiskªq
->
hôty≥
 !
BUFFER_APPEND
)) {

2300 
	`disk_buf„r_°›_ac˚ss
(
cuºdisk
);

2304 if(
cuºdiskªq
->
£g
 && 
£t£g
) {

2305 if(
cuºdisk
->
ef„˘ivehda
) {

2306 if(
cuºdiskªq
->
£g
->
ªcy˛îeq
 == currdiskreq) {

2308 
	`Ârötf
(
°dîr
,"GOT HERE! SURPRISE, SURPRISE, SURPRISE!\n");

2309 
cuºdiskªq
->
£g
->
ªcy˛îeq
 = 
NULL
;

2311 
cuºdiskªq
->
£g
 = 
NULL
;

2312 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

2315 
	`disk_buf„r_£t_£gmít
(
cuºdisk
,
cuºdiskªq
);

2319 if(
cuºdiskªq
->
£g
 && !(cuºdiskªq->
Êags
 & 
SEG_OWNED
)) {

2320 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,
cuºdiskªq
);

2323 if(!(
cuºdiskªq
->
Êags
 & 
HDA_OWNED
)

2324 && (
cuºdiskªq
->
hôty≥
 !
BUFFER_COLLISION
)) {

2325 
	`disk_check_hda
(
cuºdisk
,
cuºdiskªq
,
ok_to_check_bus
);

2328 if(!(
cuºdiskªq
->
Êags
 & 
HDA_OWNED
)

2329 && (
cuºdisk
->
cuºítbus
 =
cuºdiskªq
)) {

2330 
cuºi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

2331 
cuºi‹eq
) {

2332 
	`ioqueue_£t_°¨âime
(
cuºdisk
->
queue
,
cuºi‹eq
);

2333 
cuºi‹eq
 = cuºi‹eq->
√xt
;

2336 
	}
}

2339 
disk_ªad_¨rive
();

2340 
disk_wrôe_¨rive
();

2343 
	$disk_ªque°_¨rive
(
i‹eq_evít
 *
cuº
)

2345 
i‹eq_evít
 *
öåp
;

2346 
disk
 *
cuºdisk
;

2347 
Êags
;

2348 
diskªq
 *
√w_diskªq
;

2349 
£gmít
 *
£g
;

2355 
Êags
 = 
cuº
->flags;

2356 
cuºdisk
 = 
	`gëdisk
(
cuº
->
devno
);

2358 if((
cuº
->
blkno
 + cuº->
bcou¡
 -1Ë> 
cuºdisk
->
°©
.
highblkno
) {

2359 
cuºdisk
->
°©
.
highblkno
 = 
cuº
->
blkno
 + cuº->
bcou¡
 - 1;

2367 
	`ddbg_as£π3
((
cuº
->
blkno
 >= 0)

2368 && (
cuº
->
bcou¡
 > 0)

2369 &&(
cuº
->
blkno
 + cuº->
bcou¡
Ë<
cuºdisk
->
modñ
->
dm_£˘‹s
,

2372 
cuº
->
blkno
,

2373 
cuº
->
bcou¡
,

2374 
cuºdisk
->
modñ
->
dm_£˘‹s
));

2381 
cuºdisk
->
busow√d
 = 
	`disk_gë_bu¢o
(
cuº
);

2382 
öåp
 = 
	`i‹eq_c›y
(
cuº
);

2383 
öåp
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

2384 
cuºdisk
->
out°©e
 = 
DISK_WAIT_FOR_CONTROLLER
;

2390 
√w_diskªq
 = (
diskªq
 *Ë
	`gë‰omexåaq
();

2391 
√w_diskªq
->
Êags
 = 0;

2392 
√w_diskªq
->
i‹eqli°
 = 
cuº
;

2393 
√w_diskªq
->
£g_√xt
 = 
NULL
;

2394 
√w_diskªq
->
bus_√xt
 = 
NULL
;

2395 
√w_diskªq
->
outblkno
 =Çew_diskªq->
öblkno
 = 
cuº
->
blkno
;

2400 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

2401 
	`Ârötf
(
ouçutfûe
, "%12.6f %8p Entering disk_request_arrive\n",

2402 
simtime
, 
√w_diskªq
);

2404 
	`Ârötf
(
ouçutfûe
, " disk = %d, "

2406 
cuº
->
devno
, cuº->
blkno
, cuº->
bcou¡
, (
READ
 & cuº->
Êags
));

2407 
	`fÊush
(
ouçutfûe
);

2412 
cuºdisk
->
ef„˘ivebus
 = 
√w_diskªq
;

2417 
cuº
->
i‹eq_hﬁd_disk
 = 
cuºdisk
;

2418 
cuº
->
i‹eq_hﬁd_diskªq
 = 
√w_diskªq
;

2425 
	`ioqueue_add_√w_ªque°
(
cuºdisk
->
queue
, 
cuº
);

2427 
£g
 = 
	`disk_buf„r_£À˘_£gmít
(
cuºdisk
, 
√w_diskªq
,
TRUE
);

2434 if(
Êags
 & 
READ
) {

2435 
	`disk_ªad_¨rive
(
cuºdisk
, 
cuº
, 
√w_diskªq
, 
£g
, 
öåp
);

2438 
	`disk_wrôe_¨rive
(
cuºdisk
, 
cuº
, 
√w_diskªq
, 
£g
, 
öåp
);

2440 
	}
}

2444 
	$disk_ªad_¨rive
(
disk
 *
cuºdisk
,

2445 
i‹eq_evít
 *
cuº
,

2446 
diskªq
 *
√w_diskªq
,

2447 
£gmít
 *
£g
,

2448 
i‹eq_evít
 *
öåp
)

2450 
dñay
;

2451 
íough_ªady_to_go
 = 
TRUE
;

2453 
	`disksim_ö°_íãr
();

2460 if(
cuºdisk
->
œ°Êags
 & 
READ
) {

2461 
√w_diskªq
->
ovîhód_d⁄e
 =

2462 
cuºdisk
->
ovîhód_comm™d_ªadmiss_a·îªad
;

2465 
√w_diskªq
->
ovîhód_d⁄e
 =

2466 
cuºdisk
->
ovîhód_comm™d_ªadmiss_a·îwrôe
;

2468 
√w_diskªq
->
ovîhód_d⁄e
 *
cuºdisk
->
timesˇÀ
;

2469 
√w_diskªq
->
ovîhód_d⁄e
 +
simtime
;

2471 
√w_diskªq
->
hôty≥
) {

2472 
BUFFER_PARTIAL
:

2473 if(!
cuºdisk
->
immedå™s_™y_ªadhô
) {

2474 
ªadw©î
;

2476 if(
cuºdisk
->
ªqw©î
) {

2477 
ªadw©î
 = 
	`max
(1, ()(()
	`mö
(
£g
->
size
,
cuº
->
bcou¡
)

2478 * 
cuºdisk
->
ªadw©î
));

2481 
ªadw©î
 = ()((((Ë
£g
->
size
 * 
cuºdisk
->readwater)) + () 0.9999999999);

2483 if((
£g
->
ídblkno
 <
cuº
->
blkno
)

2484 || ((
£g
->
ídblkno
 - 
cuº
->
blkno
Ë< 
	`mö
(
ªadw©î
,cuº->
bcou¡
)))

2486 
íough_ªady_to_go
 = 
FALSE
;

2491 
BUFFER_COLLISION
:

2492 
BUFFER_NOMATCH
:

2493 if(
√w_diskªq
->
hôty≥
 !
BUFFER_PARTIAL
) {

2494 
íough_ªady_to_go
 = 
FALSE
;

2498 
BUFFER_WHOLE
:

2516 if(
cuºdisk
->
√vîdisc⁄√˘


2517 || (
íough_ªady_to_go


2518 && !
cuºdisk
->
cuºítbus


2519 && !
cuºdisk
->
c⁄°_ac˘ime


2520 && ((
cuºdisk
->
¢ókyfuŒªadhôs


2521 && (
√w_diskªq
->
hôty≥
 =
BUFFER_WHOLE
))

2522 || (
cuºdisk
->
¢óky∑πüÃódhôs


2523 && (
√w_diskªq
->
hôty≥
 =
BUFFER_PARTIAL
))

2524 || (!
cuºdisk
->
≥ndx„r


2525 && (!
cuºdisk
->
ef„˘ivehda


2526 || 
	`disk_buf„r_°›abÀ_ac˚ss
(
cuºdisk
,
√w_diskªq
)

2533 
öåp
->
ˇu£
 = 
READY_TO_TRANSFER
;

2534 
cuºdisk
->
cuºítbus
 = 
√w_diskªq
;

2535 if(
£g
) {

2536 
	`disk_buf„r_£t_£gmít
(
cuºdisk
,
√w_diskªq
);

2537 
£g
->
out°©e
 = 
BUFFER_CONTACTING
;

2540 if(!
cuºdisk
->
c⁄°_ac˘ime
) {

2541 if(
√w_diskªq
->
hôty≥
 =
BUFFER_NOMATCH
) {

2542 if(
cuºdisk
->
œ°Êags
 & 
READ
) {

2543 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_ªadmiss_a·îªad
;

2546 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_ªadmiss_a·îwrôe
;

2550 if(
cuºdisk
->
œ°Êags
 & 
READ
) {

2551 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_ªadhô_a·îªad
;

2554 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_ªadhô_a·îwrôe
;

2557 
dñay
 +
cuºdisk
->
ovîhód_d©a_¥ï
;

2560 
dñay
 = 0.0;

2563 
	`disk_£nd_evít_up_∑th
(
öåp
, (
dñay
 * 
cuºdisk
->
timesˇÀ
));

2564 
	`disk_a˘iv©e_ªad
(
cuºdisk
, 
√w_diskªq
, 
FALSE
, 
TRUE
);

2567 
öåp
->
ˇu£
 = 
DISCONNECT
;

2568 if(!
cuºdisk
->
c⁄°_ac˘ime
) {

2569 if(
cuºdisk
->
œ°Êags
 & 
READ
) {

2570 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_ªadmiss_a·îªad
 +

2571 
cuºdisk
->
ovîhód_disc⁄√˘_ªad_a·îªad
;

2574 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_ªadmiss_a·îwrôe
 +

2575 
cuºdisk
->
ovîhód_disc⁄√˘_ªad_a·îwrôe
;

2579 
dñay
 = 0.0;

2581 
	`disk_£nd_evít_up_∑th
(
öåp
, (
dñay
 * 
cuºdisk
->
timesˇÀ
));

2582 
	`disk_a˘iv©e_ªad
(
cuºdisk
, 
√w_diskªq
, 
TRUE
, TRUE);

2587 
	`ddbg_as£π3
(0, ("InvalidÑead hittype in disk_request_arrive - "

2589 
cuº
->
blkno
, cuº->
bcou¡
, 
√w_diskªq
->
hôty≥
));

2591 
	}
}

2594 
	$disk_wrôe_¨rive
(
disk
 *
cuºdisk
,

2595 
i‹eq_evít
 *
cuº
,

2596 
diskªq
 *
√w_diskªq
,

2597 
£gmít
 *
£g
,

2598 
i‹eq_evít
 *
öåp
)

2600 
dñay
;

2602 
	`disksim_ö°_íãr
();

2605 if(
cuºdisk
->
Á°wrôes
 =
NO_FASTWRITE
) {

2606 if(
cuºdisk
->
œ°Êags
 & 
READ
) {

2607 
√w_diskªq
->
ovîhód_d⁄e
 =

2608 
cuºdisk
->
ovîhód_comm™d_wrôemiss_a·îªad
;

2611 
√w_diskªq
->
ovîhód_d⁄e
 =

2612 
cuºdisk
->
ovîhód_comm™d_wrôemiss_a·îwrôe
;

2616 if(
cuºdisk
->
œ°Êags
 & 
READ
) {

2617 
√w_diskªq
->
ovîhód_d⁄e
 =

2618 
cuºdisk
->
ovîhód_comm™d_wrôehô_a·îªad
;

2621 
√w_diskªq
->
ovîhód_d⁄e
 =

2622 
cuºdisk
->
ovîhód_comm™d_wrôehô_a·îwrôe
;

2626 
√w_diskªq
->
ovîhód_d⁄e
 *
cuºdisk
->
timesˇÀ
;

2627 
√w_diskªq
->
ovîhód_d⁄e
 +
simtime
;

2635 if(
cuºdisk
->
√vîdisc⁄√˘


2636 || (
£g


2637 && !
cuºdisk
->
cuºítbus


2638 && !
cuºdisk
->
c⁄°_ac˘ime


2639 && (
cuºdisk
->
wrôïªbuf„rög


2640 || (!
cuºdisk
->
≥ndx„r


2641 && (!
cuºdisk
->
ef„˘ivehda


2642 || 
	`disk_buf„r_°›abÀ_ac˚ss
(
cuºdisk
,
√w_diskªq
)

2649 if((
√w_diskªq
->
Êags
 & 
EXTRA_WRITE_DISCONNECT
)

2650 && !
cuºdisk
->
c⁄°_ac˘ime
)

2653 
√w_diskªq
->
ovîhód_d⁄e
 =

2654 
cuºdisk
->
exåadisc_comm™d
 + cuºdisk->
exåadisc_£ekdñè
;

2656 
√w_diskªq
->
ovîhód_d⁄e
 *
cuºdisk
->
timesˇÀ
;

2657 
√w_diskªq
->
ovîhód_d⁄e
 +
simtime
;

2658 
cuºdisk
->
exåadisc_diskªq
 = 
√w_diskªq
;

2659 
öåp
->
ˇu£
 = 
DISCONNECT
;

2660 
dñay
 =

2661 
cuºdisk
->
exåadisc_comm™d
 + cuºdisk->
exåadisc_disc⁄√˘1
;

2663 
exåa_wrôe_disc⁄√˘s
++;

2664 if(
£g
) {

2665 
£g
->
out°©e
 = 
BUFFER_IDLE
;

2669 
öåp
->
ˇu£
 = 
READY_TO_TRANSFER
;

2670 if(!
cuºdisk
->
c⁄°_ac˘ime
) {

2671 if(
cuºdisk
->
Á°wrôes
 =
NO_FASTWRITE
) {

2672 if(
cuºdisk
->
œ°Êags
 & 
READ
) {

2673 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_wrôemiss_a·îªad
;

2676 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_wrôemiss_a·îwrôe
;

2680 if(
cuºdisk
->
œ°Êags
 & 
READ
) {

2681 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_wrôehô_a·îªad
;

2684 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_wrôehô_a·îwrôe
;

2687 
dñay
 +
cuºdisk
->
ovîhód_d©a_¥ï
;

2690 
dñay
 = 0.0;

2693 if(
£g
) {

2694 
£g
->
out°©e
 = 
BUFFER_CONTACTING
;

2697 
cuºdisk
->
cuºítbus
 = 
√w_diskªq
;

2700 if(
£g
) {

2701 
	`disk_buf„r_£t_£gmít
(
cuºdisk
,
√w_diskªq
);

2704 
	`disk_£nd_evít_up_∑th
(
öåp
, (
dñay
 * 
cuºdisk
->
timesˇÀ
));

2705 
	`disk_a˘iv©e_wrôe
(
cuºdisk
, 
√w_diskªq
, 
FALSE
, 
TRUE
);

2708 
√w_diskªq
->
Êags
 &~
EXTRA_WRITE_DISCONNECT
;

2709 
öåp
->
ˇu£
 = 
DISCONNECT
;

2710 if(
cuºdisk
->
Á°wrôes
 =
NO_FASTWRITE
) {

2711 if(
cuºdisk
->
œ°Êags
 & 
READ
) {

2712 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_wrôemiss_a·îªad
;

2715 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_wrôemiss_a·îwrôe
;

2719 if(!
cuºdisk
->
c⁄°_ac˘ime
) {

2721 if(
cuºdisk
->
œ°Êags
 & 
READ
) {

2722 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_wrôehô_a·îªad
;

2725 
dñay
 = 
cuºdisk
->
ovîhód_comm™d_wrôehô_a·îwrôe
;

2727 
dñay
 +
cuºdisk
->
ovîhód_disc⁄√˘_wrôe
;

2730 
dñay
 = 0.0;

2733 
	`disk_£nd_evít_up_∑th
(
öåp
, (
dñay
 * 
cuºdisk
->
timesˇÀ
));

2734 
	`disk_a˘iv©e_wrôe
(
cuºdisk
, 
√w_diskªq
, 
TRUE
, TRUE);

2737 
	}
}

2747 
	$disk_disc⁄√˘
 (
i‹eq_evít
 *
cuº
)

2749 
disk
 *
cuºdisk
 = 
	`gëdisk
(
cuº
->
devno
);

2750 
diskªq
 *
cuºdiskªq
;

2751 
i‹eq_evít
 *
tmpi‹eq
;

2753 
	`disksim_ö°_íãr
();

2755 
cuºdiskªq
 = 
cuºdisk
->
ef„˘ivebus
;

2757 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

2758 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_disc⁄√˘ f‹ disk %d\n", 
simtime
, 
cuºdiskªq
, 
cuºdisk
->
devno
);

2759 
	`fÊush
(
ouçutfûe
);

2762 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

2763 
tmpi‹eq
) {

2764 if(
tmpi‹eq
->
blkno
 =
cuº
->blkno) {

2767 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

2770 
	`ddbg_as£π2
(
tmpi‹eq
 != 0,

2773 
	`addt€xåaq
((
evít
 *Ë
cuº
);

2775 
cuºdisk
->
ef„˘ivebus
 = 
NULL
;

2777 if(
cuºdisk
->
busow√d
 != -1) {

2778 
	`bus_ow√rshù_ªÀa£
(
cuºdisk
->
busow√d
);

2779 
cuºdisk
->
busow√d
 = -1;

2780 
cuºdisk
->
out°©e
 = ((cuºdisk->
buswaô
Ë? 
DISK_WAIT_FOR_CONTROLLER
 : 
DISK_IDLE
);

2783 if(
cuºdiskªq
 =
cuºdisk
->
cuºítbus
) {

2784 if((
cuºdiskªq
->
Êags
 & 
EXTRA_WRITE_DISCONNECT
)

2785 && (
cuºdisk
->
exåadisc_diskªq
 =
cuºdiskªq
))

2787 
tmpi‹eq
 = 
	`i‹eq_c›y
(tmpioreq);

2788 
tmpi‹eq
->
i‹eq_hﬁd_diskªq
 = 
cuºdiskªq
;

2789 
tmpi‹eq
->
ty≥
 = 
DEVICE_PREPARE_FOR_DATA_TRANSFER
;

2790 
tmpi‹eq
->
time
 = 
simtime
 + 
cuºdisk
->
exåadisc_öãr_disc⁄√˘
;

2791 
	`addtoötq
((
evít
 *Ë
tmpi‹eq
);

2794 
cuºdisk
->
cuºítbus
 = 
NULL
;

2795 
cuºdiskªq
->
bus_√xt
 = 
cuºdisk
->
≥ndx„r
;

2796 
cuºdisk
->
≥ndx„r
 = 
cuºdiskªq
;

2797 
	`disk_check_bus
(
cuºdisk
, 
NULL
);

2801 
cuºdiskªq
->
bus_√xt
 = 
cuºdisk
->
≥ndx„r
;

2802 
cuºdisk
->
≥ndx„r
 = 
cuºdiskªq
;

2803 
	`disk_check_bus
(
cuºdisk
, 
NULL
);

2805 
	}
}

2814 
	$disk_com∂ëi⁄
 (
i‹eq_evít
 *
cuº
)

2816 
disk
 *
cuºdisk
 = 
	`gëdisk
(
cuº
->
devno
);

2817 
diskªq
 *
cuºdiskªq
;

2818 
i‹eq_evít
 *
tmpi‹eq
;

2819 
£gmít
 *
£g
;

2821 
	`disksim_ö°_íãr
();

2823 
cuºdiskªq
 = 
cuºdisk
->
ef„˘ivebus
;

2825 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

2826 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_com∂ëi⁄ f‹ disk %d\n", 
simtime
, 
cuºdiskªq
,
cuºdisk
->
devno
);

2827 
	`fÊush
(
ouçutfûe
);

2830 
	`ddbg_as£π2
(
cuºdiskªq
 != 0, "effectivebus is NULL");

2832 
	`ddbg_as£π2
((
cuºdiskªq
->
Êags
 & 
COMPLETION_SENT
),

2835 
£g
 = 
cuºdiskªq
->seg;

2836 
	`ddbg_as£π2
((
£g
 !0Ë|| (
cuºdisk
->
c⁄°_ac˘ime
 >= 0),

2839 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

2840 
tmpi‹eq
) {

2841 if(
tmpi‹eq
->
blkno
 =
cuº
->blkno) {

2844 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

2846 
	`ddbg_as£π2
(
tmpi‹eq
 != 0, "ioreq_eventÇot found inÉffectivebus");

2848 
tmpi‹eq
->
√xt
) {

2849 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

2852 
cuºdiskªq
->
Êags
 |
COMPLETION_RECEIVED
;

2853 
	`addt€xåaq
((
evít
 *Ë
cuº
);

2854 
cuºdisk
->
ef„˘ivebus
 = 
NULL
;

2855 if(
cuºdiskªq
 =
cuºdisk
->
cuºítbus
) {

2856 
cuºdisk
->
cuºítbus
 = 
NULL
;

2859 if(
cuºdisk
->
busow√d
 != -1) {

2860 
	`bus_ow√rshù_ªÀa£
(
cuºdisk
->
busow√d
);

2861 
cuºdisk
->
busow√d
 = -1;

2862 
cuºdisk
->
out°©e
 = 
DISK_IDLE
;

2865 if(
cuºdisk
->
c⁄°_ac˘ime
) {

2866 
	`addt€xåaq
((
evít
 *Ë
cuºdiskªq
->
i‹eqli°
);

2867 
	`addt€xåaq
((
evít
 *Ë
cuºdiskªq
);

2870 if(
cuºdiskªq
->
i‹eqli°
->
Êags
 & 
READ
) {

2871 
cuºdiskªq
->
i‹eqli°
) {

2872 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

2873 
cuºdiskªq
->
i‹eqli°
 = 
tmpi‹eq
->
√xt
;

2874 
	`addt€xåaq
((
evít
 *Ë
tmpi‹eq
);

2876 if((
cuºdiskªq
 =
cuºdisk
->
ef„˘ivehda
) ||

2877 (
cuºdiskªq
 =
cuºdisk
->
cuºíthda
)) {

2878 if(
£g
->
ac˚ss
->
ty≥
 =
NULL_EVENT
) {

2879 
	`disk_ªÀa£_hda
(
cuºdisk
,
cuºdiskªq
);

2882 
	`disk_check_¥e„tch_sw≠
(
cuºdisk
);

2886 
	`disk_buf„r_ªmove_‰om_£g
(
cuºdiskªq
);

2887 
	`addt€xåaq
((
evít
 *Ë
cuºdiskªq
);

2888 if(
£g
->
ªcy˛îeq
) {

2889 
	`ddbg_as£π2
(
£g
->
diskªqli°
 == 0,

2892 
	`disk_buf„r_£t_£gmít
(
cuºdisk
,
£g
->
ªcy˛îeq
);

2893 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,
£g
->
ªcy˛îeq
);

2894 
£g
->
ªcy˛îeq
 = 
NULL
;

2896 if(
£g
->
diskªqli°
) {

2897 
	`disk_föd_√w_£g_ow√r
(
cuºdisk
,
£g
);

2899 if(!
cuºdisk
->
íabÀˇche
) {

2900 
£g
->
°©e
 = 
BUFFER_EMPTY
;

2905 if(
cuºdiskªq
->
öblkno
 >(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) {

2906 if((
cuºdiskªq
 =
cuºdisk
->
ef„˘ivehda
) ||

2907 (
cuºdiskªq
 =
cuºdisk
->
cuºíthda
)) {

2908 
	`disk_ªÀa£_hda
(
cuºdisk
,
cuºdiskªq
);

2911 
cuºdiskªq
->
i‹eqli°
) {

2912 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

2913 
cuºdiskªq
->
i‹eqli°
 = 
tmpi‹eq
->
√xt
;

2914 
	`addt€xåaq
((
evít
 *Ë
tmpi‹eq
);

2916 
	`disk_buf„r_ªmove_‰om_£g
(
cuºdiskªq
);

2917 
	`addt€xåaq
((
evít
 *Ë
cuºdiskªq
);

2918 if(
£g
->
ªcy˛îeq
) {

2919 
	`ddbg_as£π2
(
£g
->
diskªqli°
 == 0,

2922 
	`disk_buf„r_£t_£gmít
(
cuºdisk
,
£g
->
ªcy˛îeq
);

2923 
	`disk_buf„r_©ãm±_£g_ow√rshù
(
cuºdisk
,
£g
->
ªcy˛îeq
);

2924 
£g
->
ªcy˛îeq
 = 
NULL
;

2925 } if(
£g
->
diskªqli°
) {

2926 
	`disk_föd_√w_£g_ow√r
(
cuºdisk
,
£g
);

2930 if(
cuºdiskªq
->
Êags
 & 
SEG_OWNED
) {

2931 
£g
->
ac˚ss
->
Êags
 |
BUFFER_BACKGROUND
;

2935 
	`disk_check_hda
(
cuºdisk
, 
NULL
, 
TRUE
);

2936 
	`disk_check_bus
(
cuºdisk
, 
NULL
);

2937 
	}
}

2942 
	$disk_öãºu±_com∂ëe
 (
i‹eq_evít
 *
cuº
)

2944 
cuº
->
ˇu£
) {

2946 
RECONNECT
:

2947 
	`disk_ªc⁄√˘i⁄_‹_å™s„r_com∂ëe
(
cuº
);

2950 
DISCONNECT
:

2951 
	`disk_disc⁄√˘
(
cuº
);

2954 
COMPLETION
:

2955 
	`disk_com∂ëi⁄
(
cuº
);

2959 
	`Ârötf
(
°dîr
, "UnrecognizedÉventÅypeát disk_interrupt_complete\n");

2960 
	`exô
(1);

2962 
	}
}

2966 
	gdebug_cou¡
 = 0;

2968 
	$disk_evít_¨rive
 (
i‹eq_evít
 *
cuº
)

2970 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
cuº
->
devno
);

2972 
	`disksim_ö°_íãr
();

2974 
debug_cou¡
 ++;

2980 
cuº
->
ty≥
) {

2982 
IO_ACCESS_ARRIVE
:

2983 if(
cuºdisk
->
ovîhód
 > 0.0) {

2984 
cuº
->
time
 = 
simtime
 + (
cuºdisk
->
ovîhód
 * cuºdisk->
timesˇÀ
);

2985 
cuº
->
ty≥
 = 
DEVICE_OVERHEAD_COMPLETE
;

2986 
	`addtoötq
((
evít
 *Ë
cuº
);

2989 
	`disk_ªque°_¨rive
(
cuº
);

2993 
DEVICE_OVERHEAD_COMPLETE
:

2994 
	`disk_ªque°_¨rive
(
cuº
);

2997 
DEVICE_BUFFER_SEEKDONE
:

2998 
	`disk_buf„r_£ekd⁄e
(
cuºdisk
, 
cuº
);

3001 
DEVICE_BUFFER_SECTOR_DONE
:

3002 
	`disk_buf„r_£˘‹_d⁄e
(
cuºdisk
, 
cuº
);

3005 
DEVICE_GOTO_REMAPPED_SECTOR
:

3006 
	`disk_gŸo_ªm≠≥d_£˘‹
(
cuºdisk
, 
cuº
);

3009 
DEVICE_GOT_REMAPPED_SECTOR
:

3010 
	`disk_gŸ_ªm≠≥d_£˘‹
(
cuºdisk
, 
cuº
);

3013 
DEVICE_PREPARE_FOR_DATA_TRANSFER
:

3014 
	`disk_¥ï¨e_f‹_d©a_å™s„r
(
cuº
);

3017 
DEVICE_DATA_TRANSFER_COMPLETE
:

3018 
	`disk_ªc⁄√˘i⁄_‹_å™s„r_com∂ëe
(
cuº
);

3021 
IO_INTERRUPT_COMPLETE
:

3022 
	`disk_öãºu±_com∂ëe
(
cuº
);

3025 
IO_QLEN_MAXCHECK
:

3027 
cuº
->
ãmpöt1
 = -1;

3028 
cuº
->
ãmpöt2
 = 
	`disk_gë_maxout°™dög
(cuº->
devno
);

3029 
cuº
->
bcou¡
 = 0;

3033 
	`¥ötf
 ( "Åy≥ = %d \n", 
cuº
->
ty≥
);

3034 
	`ddbg_as£π2
(0, "UnrecognizedÉventÅype");

3036 #i‡
DEBUG
 >= 1

3037 
	`Ârötf
 (
ouçutfûe
, "Exiting disk_event_arrive\n");

3039 
	}
}

3067 
	$disk_buf„r_ªque°_com∂ëe
(
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
)

3069 
background
;

3070 
ªadög
;

3071 
ªqd⁄e
 = 
FALSE
;

3072 
hﬁd_ty≥
;

3073 
ac˘ime
;

3074 
w©îm¨k
 = 
FALSE
;

3075 
i‹eq_evít
 *
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

3076 
£gmít
 *
£g
 = 
cuºdiskªq
->seg;

3078 
	`disksim_ö°_íãr
();

3080 if((
disk_¥öthack
 > 1Ë&& (
simtime
 >
disk_¥öthacktime
)) {

3081 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_ªque°_com∂ëe\n", 
simtime
, 
cuºdiskªq
);

3082 
	`fÊush
(
ouçutfûe
);

3085 
tmpi‹eq
 &&Åmpi‹eq->
√xt
) {

3086 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

3089 
background
 = 
£g
->
ac˚ss
->
Êags
 & 
BUFFER_BACKGROUND
;

3090 
ªadög
 = (
£g
->
°©e
 =
BUFFER_READING
);

3091 if(
cuºdisk
->
outwaô
) {

3092 
cuºdisk
->
outwaô
->
time
 = 
simtime
;

3093 
cuºdisk
->
outwaô
->
bcou¡
 = 0;

3094 
	`addtoötq
((
evít
 *Ë
cuºdisk
->
outwaô
);

3095 
cuºdisk
->
outwaô
 = 
NULL
;

3099 if(
ªadög
) {

3100 if(
background
) {

3101 if(
£g
->
ídblkno
 >£g->
maxªadahódblkno
) {

3102 
ªqd⁄e
 = 
TRUE
;

3106 if((
£g
->
ídblkno
 - 
cuºdiskªq
->
outblkno
Ë>cuºdiskªq->
w©îm¨k
) {

3107 
w©îm¨k
 = 
TRUE
;

3109 if(
£g
->
ídblkno
 >(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) {

3110 
ªqd⁄e
 = 
TRUE
;

3115 if(
background
) {

3116 if(
£g
->
ídblkno
 =
cuºdiskªq
->
öblkno
) {

3117 
ªqd⁄e
 = 
TRUE
;

3121 if((
£g
->
ídblkno
 - 
cuºdiskªq
->
öblkno
Ë<cuºdiskªq->
w©îm¨k
) {

3122 if(
£g
->
ídblkno
 < (
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) {

3123 
w©îm¨k
 = 
TRUE
;

3126 if(
cuºdiskªq
->
öblkno
 >(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) {

3127 
ªqd⁄e
 = 
TRUE
;

3133 if((
background
 && 
ªqd⁄e
 && 
ªadög
)

3134 || (
£g
->
out°©e
 =
BUFFER_PREEMPT
))

3136 
£g
->
ac˚ss
->
ty≥
 = 
NULL_EVENT
;

3137 
	`disk_ªÀa£_hda
(
cuºdisk
, 
cuºdiskªq
);

3138 (
TRUE
);

3141 if(!
background


3142 && (
£g
->
out°©e
 =
BUFFER_IDLE
)

3143 && (
ªqd⁄e
 | 
w©îm¨k
) )

3145 
	`disk_check_bus
(
cuºdisk
,
cuºdiskªq
);

3148 if(
background


3149 && 
ªadög


3150 && (
£g
->
ídblkno
 =£g->
möªadahódblkno
)

3151 && ((
cuºdisk
->
¥e£ekög
 =
PRESEEK_BEFORE_COMPLETION
)

3152 || (
cuºdiskªq
->
Êags
 & 
COMPLETION_RECEIVED
)

3153 || ((
cuºdisk
->
¥e£ekög
 =
PRESEEK_DURING_COMPLETION
)

3154 && (
cuºdiskªq
->
Êags
 & 
COMPLETION_SENT
)

3159 
hﬁd_ty≥
 = 
£g
->
ac˚ss
->
ty≥
;

3160 
£g
->
ac˚ss
->
ty≥
 = 
NULL_EVENT
;

3161 
	`disk_check_¥e„tch_sw≠
(
cuºdisk
);

3162 if((
£g
->
out°©e
 =
BUFFER_PREEMPT
) ||

3163 (
cuºdisk
->
ef„˘ivehda
 !
cuºdiskªq
)) {

3164 (
TRUE
);

3166 
£g
->
ac˚ss
->
ty≥
 = 
hﬁd_ty≥
;

3168 if((!
background
 || !
ªadög
Ë&& 
ªqd⁄e
) {

3169 if(!
ªadög


3170 || (
cuºdisk
->
c⁄åód
 =
BUFFER_NO_READ_AHEAD
)

3171 || (
£g
->
ídblkno
 >£g->
maxªadahódblkno
))

3173 
£g
->
ac˚ss
->
ty≥
 = 
NULL_EVENT
;

3176 
£g
->
ac˚ss
->
Êags
 |
BUFFER_BACKGROUND
;

3177 
ªqd⁄e
 = 
FALSE
;

3180 if(
cuºdisk
->
°©
.
£ekdi°™˚
 != -1) {

3181 
ac˘ime
 =

3182 
cuºdisk
->
°©
.
£ektime


3183 + 
cuºdisk
->
°©
.
œãncy


3184 + 
cuºdisk
->
°©
.
x„πime
;

3193 
	`disk_ac˘ime°©s
(
cuºdisk
,

3194 
cuºdisk
->
°©
.
£ekdi°™˚
,

3195 
cuºdisk
->
°©
.
£ektime
,

3196 
cuºdisk
->
°©
.
œãncy
,

3197 
cuºdisk
->
°©
.
x„πime
,

3198 
ac˘ime
);

3201 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

3202 
tmpi‹eq
) {

3203 
	`disk_öãr„ª°©s
(
cuºdisk
, 
tmpi‹eq
);

3204 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

3207 
cuºdisk
->
°©
.
£ekdi°™˚
 = -1;

3208 
cuºdisk
->
°©
.
x„πime
 = () 0.0;

3209 
cuºdisk
->
°©
.
œãncy
 = () 0.0;

3210 if(!
ªqd⁄e


3211 && ((
cuºdisk
->
¥e£ekög
 =
PRESEEK_BEFORE_COMPLETION
)

3212 || (
cuºdiskªq
->
Êags
 & 
COMPLETION_RECEIVED
)

3213 || ((
cuºdisk
->
¥e£ekög
 =
PRESEEK_DURING_COMPLETION
)

3214 && (
cuºdiskªq
->
Êags
 & 
COMPLETION_SENT
))))

3216 
hﬁd_ty≥
 = 
£g
->
ac˚ss
->
ty≥
;

3217 
£g
->
ac˚ss
->
ty≥
 = 
NULL_EVENT
;

3218 
	`disk_check_¥e„tch_sw≠
(
cuºdisk
);

3219 if((
£g
->
out°©e
 =
BUFFER_PREEMPT
) ||

3220 (
cuºdisk
->
ef„˘ivehda
 !
cuºdiskªq
)) {

3221 (
TRUE
);

3223 
£g
->
ac˚ss
->
ty≥
 = 
hﬁd_ty≥
;

3227 if(
ªqd⁄e
) {

3228 if(!
ªadög
) {

3229 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

3230 
tmpi‹eq
) {

3231 
	`ddbg_as£π2
(
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
cuºdisk
->
queue
,
tmpi‹eq
),

3235 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

3237 if(!(
cuºdiskªq
->
Êags
 & 
COMPLETION_SENT
)

3238 && (
£g
->
out°©e
 =
BUFFER_IDLE
))

3240 
	`disk_check_bus
(
cuºdisk
, 
cuºdiskªq
);

3243 
£g
->
ac˚ss
->
ty≥
 = 
NULL_EVENT
;

3244 
	`disk_ªÀa£_hda
(
cuºdisk
,
cuºdiskªq
);

3247 if(
ªqd⁄e
) {

3251 (
ªqd⁄e
);

3252 
	}
}

3255 
	$disk_gŸ_ªm≠≥d_£˘‹
 (
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuº
)

3257 
diskªq
 *
cuºdiskªq
 = 
cuºdisk
->
ef„˘ivehda
;

3258 
£gmít
 *
£g
;

3260 
	`ddbg_as£π2
(
cuºdiskªq
, "NoÉffectivehda");

3262 
£g
 = 
cuºdiskªq
->seg;

3263 if(
£g
->
out°©e
 =
BUFFER_PREEMPT
) {

3264 
£g
->
ac˚ss
->
ty≥
 = 
NULL_EVENT
;

3265 
	`disk_ªÀa£_hda
(
cuºdisk
, 
cuºdiskªq
);

3269 if((
cuºdiskªq
 =
£g
->
ªcy˛îeq
)

3270 || !
	`disk_buf„r_block_avaûabÀ
(
cuºdisk
, 
£g
, 
cuº
->
blkno
))

3272 
rŸtime
 = 
	`dm_time_ôod
(
cuºdisk
->
modñ
->
mech
->
	`dm_≥riod
(currdisk->model));

3273 
£g
->
time
 +
rŸtime
;

3274 
cuºdisk
->
°©
.
x„πime
 +
rŸtime
;

3275 
cuº
->
time
 +
rŸtime
;

3276 
cuº
->
ty≥
 = 
DEVICE_GOT_REMAPPED_SECTOR
;

3277 
	`addtoötq
((
evít
 *Ë
cuº
);

3280 if(
£g
->
°©e
 =
BUFFER_READING
) {

3281 if(
cuº
->
blkno
 !(
£g
->
ídblkno
+1)) {

3282 
	`Ârötf
(
°dîr
, "Logicaláddress ofÑemapped sectorÇotÇextÅoÑead (#1)\n");

3283 
	`as£π
(0);

3285 
£g
->
ídblkno
++;

3287 if(
cuº
->
blkno
 !
cuºdiskªq
->
öblkno
) {

3288 
	`Ârötf
(
°dîr
, "Logicaláddress ofÑemapped sectorÇotÇextÅoÑead (#2)\n");

3289 
	`as£π
(0);

3291 
cuºdiskªq
->
öblkno
++;

3293 if(!
	`disk_buf„r_ªque°_com∂ëe
(
cuºdisk
, 
cuºdiskªq
)) {

3294 
cuº
->
blkno
++;

3295 if(!
	`disk_öôüã_£ek
(
cuºdisk
, 
£g
, 
cuº
, 0, 0.0, 0.0)) {

3296 
	`disk_ªÀa£_hda
(
cuºdisk
,
cuºdiskªq
);

3300 
	}
}

3305 
	$disk_buf„r_upd©e_outbuf„r
(
disk
 *
cuºdisk
, 
£gmít
 *
£g
)

3307 
blks
;

3308 
diskªq
* 
cuºdiskªq
 = 
cuºdisk
->
ef„˘ivebus
;

3309 
tm±ime
;

3310 
i‹eq_evít
 *
tmpi‹eq
;

3311 
diskªq
 *
£g_ow√r
;

3313 if(!
cuºdiskªq
) {

3317 
	`ddbg_as£π
(
cuºdiskªq
->
£g
 == seg);

3320 
£g_ow√r
 = 
	`disk_buf„r_£g_ow√r
(
£g
,
FALSE
);

3321 if(!
£g_ow√r
) {

3322 
£g_ow√r
 = 
cuºdiskªq
;

3325 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

3326 
tmpi‹eq
) {

3327 if((
cuºdiskªq
->
outblkno
 >
tmpi‹eq
->
blkno
) &&

3328 (
cuºdiskªq
->
outblkno
 < (
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
))) {

3331 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

3334 
	`ddbg_as£π2
(
tmpi‹eq
 != 0, "Cannot find ioreq");

3337 #i‡
DEBUG
 >= 1

3338 
	`Ârötf
 (
ouçutfûe
, "E¡îed disk_buf„r_upd©e_⁄goög - devnÿ%d\n", 
£g
->
ac˚ss
->
devno
);

3341 if(
cuºdisk
->
outwaô
) {

3345 
blks
 = 
	`bus_gë_d©a_å™s„ªd
(
tmpi‹eq
, 
	`disk_gë_dïth
—mpi‹eq->
devno
));

3347 if(
blks
 == -1) {

3348 
tm±ime
 = 
	`disk_gë_blkå™°ime
(
tmpi‹eq
);

3349 if(
tm±ime
 != () 0.0) {

3350 
blks
 = (Ë((
simtime
 - 
cuºdisk
->
°¨âøns
Ë/ 
tm±ime
);

3353 
blks
 = 
£g
->
outbcou¡
;

3357 
blks
 = 
	`mö
(
£g
->
outbcou¡
, (blk†- 
cuºdisk
->
blksd⁄e
));

3358 
cuºdisk
->
blksd⁄e
 +
blks
;

3359 
cuºdiskªq
->
outblkno
 +
blks
;

3360 
£g
->
outbcou¡
 -
blks
;

3362 if(
cuºdiskªq
->
outblkno
 > 
£g
->
ídblkno
) {

3363 
£g
->
ídblkno
 = 
cuºdiskªq
->
outblkno
;

3366 
	`disk_buf„r_£gmít_wøp
(
£g
, seg->
ídblkno
);

3368 if((
£g
->
°©e
 =
BUFFER_WRITING
)

3369 && ((
£g_ow√r
->
öblkno
 < 
£g
->
°¨tblkno
)

3370 || (
£g_ow√r
->
öblkno
 > 
£g
->
ídblkno
)))

3372 
	`ddbg_as£π3
(0, ("Error with inblknoát disk_buffer_update_outbuffer: "

3374 
£g_ow√r
->
öblkno
,

3375 
£g
->
°¨tblkno
,

3376 
£g
->
ídblkno
,

3377 
blks
));

3379 #i‡
DEBUG
 >= 1

3380 
	`Ârötf
 (
ouçutfûe
, "Exiting disk_buffer_update_ongoing\n");

3385 
	}
}

3395 
i‹eq_evít
 *

3396 
	$disk_buf„r_å™s„r_size
(
disk
 *
cuºdisk
,

3397 
diskªq
 *
cuºdiskªq
,

3398 
i‹eq_evít
 *
cuº
)

3400 
£gmít
 *
£g
 = 
cuºdiskªq
->seg;

3401 
diskªq
 *
£g_ow√r
;

3402 
i‹eq_evít
 *
tmpi‹eq
;

3409 if(
cuºdisk
->
c⁄°_ac˘ime
) {

3410 if(
cuºdiskªq
->
ovîhód_d⁄e
 <
simtime
) {

3411 
cuº
->
bcou¡
 = 0;

3414 
cuº
->
bcou¡
 = -2;

3416 (
cuº
);

3419 if(!
£g
) {

3420 if(!
cuºdisk
->
√vîdisc⁄√˘
) {

3421 
	`Ârötf
(
°dîr
, "NULL seg foundát disk_buffer_transfer_size withoutÇeverdisconnect set\n");

3422 
	`exô
(1);

3424 
cuº
->
bcou¡
 = -2;

3425 (
cuº
);

3428 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

3429 
tmpi‹eq
) {

3430 if(
tmpi‹eq
->
blkno
 =
cuº
->blkno) {

3433 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

3435 if(!
tmpi‹eq
) {

3436 
	`Ârötf
(
°dîr
, "ioreq_eventÇot found inÉffectivebus in disk_buffer_transfer_size\n");

3437 
	`exô
(1);

3440 if(
tmpi‹eq
->
Êags
 & 
READ
) {

3441 if(
£g
->
out°©e
 =
BUFFER_TRANSFERING
) {

3442 
cuºdiskªq
->
outblkno
 +
£g
->
outbcou¡
;

3444 if(
cuºdiskªq
->
outblkno
 >(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) {

3445 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

3446 if(!
tmpi‹eq
) {

3447 
£g
->
out°©e
 = 
BUFFER_IDLE
;

3448 
cuº
->
bcou¡
 = 0;

3449 (
cuº
);

3452 if(
cuºdiskªq
->
outblkno
 >(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) {

3453 
	`Ârötf
(
°dîr
, "read ioreq_event skipped in disk_reconnection_or_transfer_complete\n");

3454 
	`exô
(1);

3456 
	`addt€xåaq
((
evít
 *Ë
cuº
);

3457 
cuº
 = 
	`i‹eq_c›y
(
tmpi‹eq
);

3460 if(
£g
->
ídblkno
 > 
cuºdiskªq
->
outblkno
) {

3461 
£g
->
out°©e
 = 
BUFFER_TRANSFERING
;

3462 
cuº
->
bcou¡
 = 
£g
->
outbcou¡
 = 
	`mö
(£g->
ídblkno
,(
tmpi‹eq
->
blkno
 +Åmpi‹eq->bcou¡)Ë- 
cuºdiskªq
->
outblkno
;

3463 } if(
cuºdisk
->
hﬁd_bus_f‹_whﬁe_ªad_x„r
 ||

3464 
cuºdisk
->
√vîdisc⁄√˘
) {

3465 
£g
->
out°©e
 = 
BUFFER_TRANSFERING
;

3466 
£g
->
outbcou¡
 = 0;

3467 
cuº
->
bcou¡
 = -2;

3469 
£g
->
out°©e
 = 
BUFFER_IDLE
;

3470 
cuº
->
bcou¡
 = -1;

3474 if((
cuºdiskªq
->
outblkno
 =(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
))

3475 && (
cuºdiskªq
->
öblkno
 >cuºdiskªq->
outblkno
)) {

3476 if(
tmpi‹eq
->
√xt
) {

3477 
	`Ârötf
(
°dîr
, "write ioreq_event skipped (A) in disk_reconnection_or_transfer_complete\n");

3478 
	`exô
(1);

3480 
£g
->
out°©e
 = 
BUFFER_IDLE
;

3481 
cuº
->
bcou¡
 = 0;

3482 (
cuº
);

3485 
£g_ow√r
 = 
	`disk_buf„r_£g_ow√r
(
£g
,
FALSE
);

3486 if(!
£g_ow√r
) {

3487 
£g_ow√r
 = 
cuºdiskªq
;

3490 if(
£g
->
out°©e
 =
BUFFER_TRANSFERING
) {

3491 
cuºdiskªq
->
outblkno
 +
£g
->
outbcou¡
;

3492 if(
tmpi‹eq
->
blkno
 < 
£g
->
°¨tblkno
) {

3493 
£g
->
°¨tblkno
 = 
tmpi‹eq
->
blkno
;

3495 if(
cuºdiskªq
->
outblkno
 > 
£g
->
ídblkno
) {

3496 
£g
->
ídblkno
 = 
cuºdiskªq
->
outblkno
;

3498 if(
£g
->
hﬁd_bcou¡
 &&

3499 (
£g
->
ídblkno
 =£g->
hﬁd_blkno
)) {

3500 if(
tmpi‹eq
->
√xt
 ||

3501 (
cuºdiskªq
->
outblkno
 !(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
))) {

3502 
	`Ârötf
(
°dîr
, "Error with hold fieldsát disk_buffer_transfer_size\n");

3503 
	`exô
(1);

3505 
£g
->
ídblkno
 +£g->
hﬁd_bcou¡
;

3506 
£g
->
hﬁd_bcou¡
 = 0;

3508 
	`disk_buf„r_£gmít_wøp
(
£g
, seg->
ídblkno
);

3509 
	`ddbg_as£π
((
£g_ow√r
->
öblkno
 >
£g
->
°¨tblkno
) &&

3510 (
£g_ow√r
->
öblkno
 <
£g
->
ídblkno
));

3511 if(
cuºdiskªq
->
outblkno
 >(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
)) {

3512 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

3513 if(!
tmpi‹eq
) {

3514 
£g
->
out°©e
 = 
BUFFER_IDLE
;

3515 if(
cuºdisk
->
Á°wrôes
 =
NO_FASTWRITE
) {

3516 
cuº
->
bcou¡
 = -1;

3519 
cuº
->
bcou¡
 = 0;

3521 (
cuº
);

3524 if(
cuºdiskªq
->
outblkno
 >(
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
))

3526 
	`Ârötf
(
°dîr
, "write ioreq_event skipped (B) in disk_reconnection_or_transfer_complete\n");

3527 
	`exô
(1);

3529 
	`addt€xåaq
((
evít
 *Ë
cuº
);

3530 
cuº
 = 
	`i‹eq_c›y
(
tmpi‹eq
);

3533 if((
cuºdiskªq
->
outblkno
 - 
£g_ow√r
->
öblkno
Ë> 
£g
->
size
) {

3534 
	`Ârötf
(
°dîr
, "BufferÇeedsÅo wrapáround\n");

3535 
	`exô
(1);

3539 
£g
->
out°©e
 = 
BUFFER_TRANSFERING
;

3540 
cuº
->
bcou¡
 = 
£g
->
outbcou¡
 =

3541 
	`mö
((
£g
->
size
 - (
cuºdiskªq
->
outblkno
 - 
£g_ow√r
->
öblkno
)),

3542 (
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
 - 
cuºdiskªq
->
outblkno
));

3546 if((!(
cuºdiskªq
->
Êags
 & 
SEG_OWNED
)

3547 && (
£g
->
ídblkno
 < 
cuºdiskªq
->
outblkno
))

3548 || (
£g
->
outbcou¡
 <= 0))

3550 if(
cuºdisk
->
hﬁd_bus_f‹_whﬁe_wrôe_x„r


3551 || 
cuºdisk
->
√vîdisc⁄√˘
)

3553 if((
disk_¥öthack
 > 1Ë&& (
simtime
 >
disk_¥öthacktime
)) {

3554 
	`Ârötf
(
°dîr
,"Holding bus...\n");

3556 
£g
->
out°©e
 = 
BUFFER_TRANSFERING
;

3557 
£g
->
outbcou¡
 = 0;

3558 
cuº
->
bcou¡
 = -2;

3561 
£g
->
out°©e
 = 
BUFFER_IDLE
;

3562 
cuº
->
bcou¡
 = -1;

3566 (
cuº
);

3567 
	}
}

3589 
	$disk_íabÀmít_fun˘i⁄
(
i‹eq_evít
 *
cuºi‹eq
)

3591 
diskªq
 *
cuºdiskªq
 = (diskªq*Ë
cuºi‹eq
->
i‹eq_hﬁd_diskªq
;

3592 
disk
 *
cuºdisk
 = (disk*Ë
cuºi‹eq
->
i‹eq_hﬁd_disk
;

3593 
i‹eq_evít
 *
tmpi‹eq
;

3594 
diskªq
 *
£g_ow√r
;

3596 if(!
cuºdisk
) {

3597 
	`Ârötf
(
°dîr
, "Disk ioqueue iobuf has NULL ioreq_hold_disk (disk*)\n");

3598 
	`exô
(1);

3601 if(!
cuºdiskªq
) {

3602 
	`Ârötf
(
°dîr
, "Disk ioqueue iobuf has NULL ioreq_hold_diskreq (diskreq*)\n");

3603 
	`exô
(1);

3606 if(
cuºdisk
->
c⁄°_ac˘ime
) {

3607 (
TRUE
);

3610 if(
cuºi‹eq
->
Êags
 & 
READ
) {

3616 if(
cuºdiskªq
->
£g
) {

3617 
	`ddbg_as£π
(
cuºdiskªq
->
£g
->
ªcy˛îeq
 != currdiskreq);

3618 if((
cuºdiskªq
->
£g
->
°©e
 =
BUFFER_WRITING
) ||

3619 (
cuºdiskªq
->
£g
->
°©e
 =
BUFFER_DIRTY
)) {

3620 if(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
,
cuºdiskªq
->
£g
)) {

3621 (
FALSE
);

3625 
	`disk_buf„r_£À˘_£gmít
(
cuºdisk
,
cuºdiskªq
,
FALSE
);

3626 if(
cuºdiskªq
->
£g
) {

3627 if((
cuºdiskªq
->
£g
->
°©e
 =
BUFFER_WRITING
)

3628 || (
cuºdiskªq
->
£g
->
°©e
 =
BUFFER_DIRTY
))

3630 if(!
	`disk_buf„r_ªußbÀ_£gmít_check
(
cuºdisk
,
cuºdiskªq
->
£g
)) {

3631 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

3632 
cuºdiskªq
->
£g
 = 
NULL
;

3633 (
FALSE
);

3636 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

3637 
cuºdiskªq
->
£g
 = 
NULL
;

3640 if((
cuºdiskªq
->
hôty≥
 =
BUFFER_COLLISION
)

3641 || !
	`disk_buf„r_ªcy˛abÀ_£gmít
(
cuºdisk
,
TRUE
))

3643 (
FALSE
);

3649 if(
cuºdiskªq
->
£g
) {

3653 
	`ddbg_as£π
(
cuºdiskªq
->
£g
->
ªcy˛îeq
 != currdiskreq);

3654 if(!(
cuºdiskªq
->
Êags
 & 
SEG_OWNED
)) {

3655 
£g_ow√r
 = 
	`disk_buf„r_£g_ow√r
(
cuºdiskªq
->
£g
,
FALSE
);

3656 if(!
£g_ow√r
) {

3657 
£g_ow√r
 = 
cuºdiskªq
->
£g
->
diskªqli°
;

3658 
	`ddbg_as£π
(
£g_ow√r
->
i‹eqli°
 !
NULL
);

3659 
£g_ow√r
->
i‹eqli°
->
Êags
 & 
READ
) {

3660 
£g_ow√r
 = seg_ow√r->
£g_√xt
;

3661 
	`ddbg_as£π
(
£g_ow√r
 !
NULL
);

3662 
	`ddbg_as£π
(
£g_ow√r
->
i‹eqli°
 !
NULL
);

3665 if(
£g_ow√r
 !
cuºdiskªq
) {

3666 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

3667 
	`ddbg_as£π
(
tmpi‹eq
 !
NULL
);

3668 
tmpi‹eq
->
√xt
) {

3669 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

3671 if(((
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
 - 
£g_ow√r
->
öblkno
) >

3672 
cuºdiskªq
->
£g
->
size
)

3673 && (
£g_ow√r
->
öblkno
 !
cuºdiskªq
->
i‹eqli°
->
blkno
))

3675 (
FALSE
);

3681 
	`disk_buf„r_£À˘_£gmít
(
cuºdisk
,
cuºdiskªq
,
FALSE
);

3682 if(
cuºdiskªq
->
£g
) {

3683 if(
cuºdiskªq
->
hôty≥
 =
BUFFER_APPEND
) {

3684 
£g_ow√r
 = 
	`disk_buf„r_£g_ow√r
(
cuºdiskªq
->
£g
, 
FALSE
);

3685 
	`ddbg_as£π
(
£g_ow√r
 !
NULL
);

3686 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

3687 
	`ddbg_as£π
(
tmpi‹eq
 !
NULL
);

3688 
tmpi‹eq
->
√xt
) {

3689 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

3692 if(((
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
 - 
£g_ow√r
->
öblkno
) >

3693 
cuºdiskªq
->
£g
->
size
)

3694 && (
£g_ow√r
->
öblkno
 !
cuºdiskªq
->
i‹eqli°
->
blkno
))

3696 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

3697 
cuºdiskªq
->
£g
 = 
NULL
;

3698 (
FALSE
);

3701 
cuºdiskªq
->
hôty≥
 = 
BUFFER_NOMATCH
;

3702 
cuºdiskªq
->
£g
 = 
NULL
;

3705 if((
cuºdiskªq
->
hôty≥
 =
BUFFER_COLLISION
) ||

3706 !
	`disk_buf„r_ªcy˛abÀ_£gmít
(
cuºdisk
,
FALSE
)) {

3707 (
FALSE
);

3713 (
TRUE
);

3714 
	}
}

3731 
	$disk_buf„r_°›abÀ_ac˚ss
 (
disk
 *
cuºdisk
, 
diskªq
 *
cuºdiskªq
)

3733 
£gmít
 *
£g
;

3734 
diskªq
 *
ef„˘ive
 = 
cuºdisk
->
ef„˘ivehda
;

3735 
i‹eq_evít
 *
cuºi‹eq
;

3737 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

3738 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_°›abÀ_ac˚ss\n", 
simtime
, 
cuºdiskªq
);

3739 
	`Ârötf
 (
ouçutfûe
, " checkög i‡%8∞i†°›∑bÀ\n", 
ef„˘ive
);

3740 
	`fÊush
(
ouçutfûe
);

3743 if(!
ef„˘ive
) {

3744 
	`Ârötf
(
°dîr
, "TryingÅo stopáÇon-existentáccess\n");

3745 
	`exô
(1);

3748 
£g
 = 
ef„˘ive
->seg;

3750 if(!
£g
) {

3751 
	`Ârötf
(
°dîr
, "effectivehda has NULL seg in disk_buffer_stopable_access\n");

3752 
	`exô
(1);

3755 if(
£g
->
ªcy˛îeq
) {

3756 if(
£g
->
ªcy˛îeq
 !
ef„˘ive
) {

3757 
	`Ârötf
(
°dîr
, "effectivehda !=Ñecyclereq in disk_buffer_stopable_access\n");

3758 
	`exô
(1);

3760 (
FALSE
);

3763 
	`ddbg_as£π2
(((
£g
->
°©e
 =
BUFFER_READING
)

3764 || (
£g
->
°©e
 =
BUFFER_WRITING
)),

3768 if(
£g
->
°©e
 =
BUFFER_READING
) {

3769 #i‡
DEBUG
 >= 2

3770 
	`Ârötf
 (
ouçutfûe
, "%f, InsidêbackgroundÑódÖ‹ti⁄ o‡°›abÀ_ac˚s†-Ñód %d\n", 
simtime
, (
cuº
->
Êags
 & 
READ
));

3772 
cuºi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

3778 if((
ef„˘ive
->
i‹eqli°
 !
NULL
) &&

3779 (
£g
->
ídblkno
 < seg->
möªadahódblkno
) &&

3780 (!(
cuºi‹eq
->
Êags
 & 
READ
) ||

3781 (
cuºdiskªq
->
£g
 != seg) ||

3782 (
cuºi‹eq
->
blkno
 < 
£g
->
°¨tblkno
) ||

3783 (
cuºi‹eq
->
blkno
 > 
£g
->
ídblkno
))) {

3784 (
FALSE
);

3787 if(!(
cuºi‹eq
->
Êags
 & 
READ
Ë&& (
cuºdisk
->
wrôe_hô_°›_ªadahód
)) {

3788 
cuºi‹eq
) {

3789 if(
	`disk_buf„r_ovîœp
(
£g
, 
cuºi‹eq
)) {

3790 
£g
->
maxªadahódblkno
 = seg->
möªadahódblkno
 = seg->
ídblkno
;

3793 
cuºi‹eq
 = cuºi‹eq->
√xt
;

3797 
cuºi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

3807 if((
cuºi‹eq
->
Êags
 & 
READ
) &&

3808 
cuºdisk
->
íabÀˇche
 &&

3809 (
cuºdiskªq
->
£g
 == seg) &&

3810 (
cuºi‹eq
->
blkno
 >
£g
->
°¨tblkno
) &&

3811 ((
cuºi‹eq
->
blkno
 < 
£g
->
ídblkno
) ||

3812 (
cuºdisk
->
Æmo°ªadhôs
 && (
cuºi‹eq
->
blkno
 =
£g
->
ídblkno
)))) {

3813 
i‹eq_evít
 *
be°i‹eq
 = 
	`ioqueue_show_√xt_ªque°
(
cuºdisk
->
queue
);

3815 if(!
be°i‹eq
 ||

3816 (
be°i‹eq
->
i‹eq_hﬁd_diskªq
 =
cuºdiskªq
)) {

3817 (
TRUE
);

3821 
be°i‹eq
 = 
	`ioqueue_show_√xt_ªque°
(
cuºdisk
->
queue
);

3822 if(
be°i‹eq
->
i‹eq_hﬁd_diskªq
 =
cuºdiskªq
) {

3823 (
TRUE
);

3825 (
FALSE
);

3830 if((!(
ef„˘ive
->
Êags
 & 
COMPLETION_SENT
)

3831 && (
cuºdisk
->
¥e£ekög
 !
PRESEEK_BEFORE_COMPLETION
))

3832 || (!(
ef„˘ive
->
Êags
 & 
COMPLETION_RECEIVED
)

3833 && (
cuºdisk
->
¥e£ekög
 =
NO_PRESEEK
)))

3835 (
FALSE
);

3838 if(
£g
->
ídblkno
 < seg->
möªadahódblkno
) {

3839 
£g
->
maxªadahódblkno
 = seg->
möªadahódblkno
;

3840 (
FALSE
);

3843 if((
£g
->
ac˚ss
->
ty≥
 =
DEVICE_GOT_REMAPPED_SECTOR
) ||

3844 (
£g
->
ac˚ss
->
ty≥
 =
DEVICE_GOTO_REMAPPED_SECTOR
))

3846 
£g
->
out°©e
 = 
BUFFER_PREEMPT
;

3847 (
FALSE
);

3849 if(
£g
->
ac˚ss
->
ty≥
 =
NULL_EVENT
) {

3850 (
TRUE
);

3853 if((!
cuºdisk
->
disc⁄√˘ö£ek
)

3854 && ((
£g
->
ac˚ss
->
ty≥
 =
DEVICE_BUFFER_SEEKDONE
)

3855 || (!
cuºdisk
->
°›ö£˘‹
)))

3857 
rv
 = 
	`ªmove‰omötq
((
evít
 *)
£g
->
ac˚ss
);

3858 
	`ddbg_as£π3
(
rv
 != 0,

3860 "£g->ac˚ss->ty≥: %d", 
£g
->
ac˚ss
->
ty≥
));

3862 if(
£g
->
ac˚ss
->
ty≥
 =
DEVICE_BUFFER_SEEKDONE
) {

3865 
uöt64_t
 
n£cs
;

3866 
dm_mech_°©e
 
íd
;

3867 
dm_pbn
 
pbn
;

3869 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

3870 
£g
->
ac˚ss
->
blkno
,

3871 
MAP_FULL
,

3872 &
pbn
,

3875 
£g
->
ac˚ss
->
ˇu£
 = 
pbn
.
£˘‹
;

3877 
íd
.
hód
 = 
pbn
.head;

3878 
íd
.
cyl
 = 
pbn
.cyl;

3879 
íd
.
thëa
 = 0;

3893 
n£cs
 = 
cuºdisk
->
modñ
->
mech
->

3894 
	`dm_£ek_time
(
cuºdisk
->
modñ
,

3895 &
cuºdisk
->
mech_°©e
,

3896 &
íd
,

3897 (
£g
->
ac˚ss
->
Êags
 & 
READ
));

3900 
cuºdisk
->
mech_°©e
.
hód
 = 
íd
.head;

3901 
cuºdisk
->
mech_°©e
.
cyl
 = 
íd
.cyl;

3903 
£g
->
ac˚ss
->
time
 = seg->timê+ 
	`dm_time_ôod
(
n£cs
);

3906 
disk_£ek_°›time
 = 
£g
->
ac˚ss
->
time
;

3907 
£g
->
ac˚ss
->
ty≥
 = 
NULL_EVENT
;

3908 (
TRUE
);

3911 if((
£g
->
ac˚ss
->
ty≥
 =
DEVICE_BUFFER_SEEKDONE
)

3912 || (!
cuºdisk
->
°›ö£˘‹
))

3915 
£g
->
out°©e
 = 
BUFFER_PREEMPT
;

3916  
FALSE
;

3918  
TRUE
;

3921 if(
£g
->
°©e
 =
BUFFER_WRITING
) {

3922 if((
cuºdiskªq
->
hôty≥
 =
BUFFER_APPEND
) &&

3923 (
cuºdiskªq
->
£g
 == seg) &&

3924 (
£g
->
ídblkno
 =
cuºdiskªq
->
i‹eqli°
->
blkno
) &&

3925 ((
cuºdisk
->
Á°wrôes
 !
LIMITED_FASTWRITE
) ||

3926 (
	`ioqueue_gë_numbî_≥ndög
(
cuºdisk
->
queue
) == 1))) {

3927 
i‹eq_evít
 *
be°i‹eq
 = 
	`ioqueue_show_√xt_ªque°
(
cuºdisk
->
queue
);

3929 if(!
be°i‹eq
 || (be°i‹eq->
i‹eq_hﬁd_diskªq
 =
cuºdiskªq
)) {

3930 (
TRUE
);

3937 (
FALSE
);

3938 
	}
}

3944 
	$dbskd⁄e_check_times
() {

3947 
uöt64_t
 
n£cs
;

3948 
dm_mech_°©e
 
íd
;

3949 
dm_pbn
 
pbn
;

3950 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

3951 
cuº
->
blkno
,

3952 
MAP_FULL
,

3953 &
pbn
,

3956 
íd
.
cyl
 = 
pbn
.cyl;

3957 
íd
.
hód
 = 
pbn
.head;

3958 
íd
.
thëa
 = 0;

3959 
cuº
->
ˇu£
 = 
pbn
.
£˘‹
;

3973 
n£cs
 =

3974 
cuºdisk
->
modñ
->
mech
->
	`dm_£ek_time
(currdisk->model,

3975 &
cuºdisk
->
mech_°©e
,

3976 &
íd
,

3977 (
cuº
->
Êags
 & 
READ
));

3979 
cuºdisk
->
mech_°©e
.
cyl
 = 
íd
.cyl;

3980 
cuºdisk
->
mech_°©e
.
hód
 = 
íd
.head;

3981 
cuº
->
time
 = 
£g
->timê+ 
	`dm_time_ôod
(
n£cs
);

3984 
mydiff
 = 
	`Ábs
(
cuº
->
time
 - 
simtime
);

3987 if((
mydiff
 > 0.0001Ë&& (mydif‡> (0.00000000001 * 
simtime
)))

3989 
	`Ârötf
(
°dîr
, "Ac˚s†time†d⁄'àm©ch (1Ë-Éxp. %‡á˘uÆ %‡ mydif‡%f\n", 
simtime
, 
cuº
->
time
, 
mydiff
);

3990 
	`as£π
(0);

3993 
	}
}

3996 
	$disk_buf„r_£ekd⁄e
(
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuº
)

3998 
åack°¨t
;

3999 
immed
;

4000 
diskªq
 *
cuºdiskªq
 = 
cuºdisk
->
ef„˘ivehda
;

4001 
£gmít
 *
£g
;

4002 
mydiff
;

4003 
dm_pbn
 
pbn
;

4006 #i‚de‡
WIN32


4007 
	`disksim_ö°_íãr
();

4011 
fú°
, 
œ°
;

4013 
ªm≠£˘‹
 = 0;

4015 
£g
 = 
cuºdiskªq
->seg;

4023 if(
disk_¥öthack
 && (
simtime
 >
disk_¥öthacktime
)) {

4024 
	`Ârötf
 (
ouçutfûe
, "%12.6‡ %8∞ E¡îög disk_buf„r_£ekd⁄êf‹ disk %d\n", 
simtime
, 
cuºdiskªq
,
cuºdisk
->
devno
);

4025 
	`fÊush
(
ouçutfûe
);

4028 
	`dbskd⁄e_check_times
();

4030 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

4031 
cuº
->
blkno
,

4032 
MAP_FULL
,

4033 &
pbn
,

4035 
cuºdisk
->
mech_°©e
.
cyl
 = 
pbn
.cyl;

4036 
cuºdisk
->
mech_°©e
.
hód
 = 
pbn
.head;

4038 
cuº
->
time
 = 
simtime
;

4040 if(
£g
->
out°©e
 =
BUFFER_PREEMPT
) {

4041 
cuº
->
ty≥
 = 
NULL_EVENT
;

4042 
	`disk_ªÀa£_hda
(
cuºdisk
,
cuºdiskªq
);

4046 if(
cuºdisk
->
°©
.
x„πime
 == () -1) {

4047 
cuºdisk
->
°©
.
œãncy
 = 
simtime
;

4050 
immed
 = 
cuºdisk
->immed;

4053 
dm_pbn
 
pbn
;

4055 
dm_±ﬁ_ªsu…_t
 
rv
;

4056 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

4057 
cuº
->
blkno
,

4058 
MAP_FULL
,

4059 &
pbn
,

4060 
NULL
);

4061 
rv
 = 
cuºdisk
->
modñ
->
œyout
->

4062 
	`dm_gë_åack_bound¨õs
(
cuºdisk
->
modñ
,

4063 &
pbn
,

4064 &
fú°
,

4065 &
œ°
,

4066 &
ªm≠£˘‹
);

4067 
	`ddbg_as£π
(
rv
 =
DM_OK
);

4069 
cuºdisk
->
åack_low
 = 
fú°
;

4070 
cuºdisk
->
åack_high
 = 
œ°
;

4072 
cuº
->
bcou¡
 = 
œ°
 - 
fú°
 + 1;

4073 
œ°
++;

4075 
	`ddbg_as£π3
(((
fú°
 <
cuº
->
blkno
Ë&& (cuº->blknÿ<
œ°
 )),

4077 
cuº
->
blkno
,

4078 
fú°
,

4079 
œ°
));

4082 #i‡
DEBUG
 >= 2

4083 
	`Ârötf
 (
ouçutfûe
, "ªm≠£˘‹ %d,Éndo·øck %d, fú°⁄åack %d, blk•îåack %d\n", 
ªm≠£˘‹
, 
cuºdisk
->
ído·øck
, 
fú°
, 
cuº
->
bcou¡
);

4088 if((
cuºdisk
->
ªad™y‰ìblocks
)

4089 && (
cuº
->
Êags
 & 
READ
)

4090 && (
cuº
->
blkno
 !
fú°
))

4092 
cuº
->
blkno
 = 
fú°
;

4093 
immed
 = 
TRUE
;

4096 
£g
->
time
 = 
simtime
;

4098 
£˘‹s
;

4099 
uöt64_t
 
n£cs
;

4100 
œãncy
;

4101 
dm_pbn
 
tmp
;

4107 
dm_time_t
 
isimtime
 = 
	`dm_time_dtoi
(
£g
->
time
Ë- 
cuºdisk
->
cuºtime_i
;

4108 
dm_time_t
 
ªsidtime
 =

4109 
isimtime
 % 
cuºdisk
->
modñ
->
mech
->
	`dm_≥riod
(currdisk->model);

4111 
dm_mech_°©e
 
°¨t°©e
 = 
cuºdisk
->
mech_°©e
;

4112 
°¨t°©e
.
thëa
 +
cuºdisk
->
modñ
->
mech
->
	`dm_rŸ©e
(currdisk->model,

4113 &
ªsidtime
);

4114 
n£cs
 = 
cuºdisk
->
modñ
->
mech
->
	`dm_œãncy
(currdisk->model,

4115 &
°¨t°©e
,

4116 
cuº
->
ˇu£
,

4117 
cuº
->
bcou¡
,

4118 
immed
,

4120 
œãncy
 = 
	`dm_time_ôod
(
n£cs
);

4124 
åack°¨t
 =

4125 
cuºdisk
->
modñ
->
mech
->
	`dm_ac˚ss_block
(currdisk->model,

4126 &
°¨t°©e
,

4127 
cuº
->
ˇu£
,

4128 
cuº
->
bcou¡
,

4129 
immed
);

4131 
tmp
.
cyl
 = 
°¨t°©e
.cyl;

4132 
tmp
.
hód
 = 
°¨t°©e
.head;

4133 
tmp
.
£˘‹
 = 0;

4134 
£˘‹s
 = 
cuºdisk
->
modñ
->
œyout
->
	`dm_gë_£˘‹s_pbn
(currdisk->model,

4135 &
tmp
);

4140 
cuº
->
time
 = 
£g
->timê+ 
œãncy
;

4143 
cuºdisk
->
immed°¨t
 = 
œ°
;

4144 
cuºdisk
->
immedíd
 = cuºdisk->
immed°¨t
;

4149 #ifde‡
WIN32


4150 
dm_pbn
 
tmµbn
 = { 
cuºdisk
->
mech_°©e
.
cyl
,

4151 
cuºdisk
->
mech_°©e
.
hód
,

4152 
åack°¨t
 };

4154 
dm_pbn
 
tmµbn
 = { .
cyl
 = 
cuºdisk
->
mech_°©e
.cyl,

4155 .
hód
 = 
cuºdisk
->
mech_°©e
.head,

4156 .
£˘‹
 = 
åack°¨t
 };

4159 
cuº
->
blkno
 = 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_±ﬁ
(cuºdisk->modñ, &
tmµbn
, 0);

4160 
	`ddbg_as£π
(
cuº
->
blkno
 >= 0);

4163 
	`ddbg_as£π
(
cuºdisk
->
åack_low
 <
cuº
->
blkno
 && cuº->blknÿ<cuºdisk->
åack_high
);

4169 
cuº
->
ˇu£
 = 
åack°¨t
;

4170 
cuº
->
ty≥
 = 
DEVICE_BUFFER_SECTOR_DONE
;

4171 
cuº
->
bcou¡
 = 0;

4172 
	`addtoötq
((
evít
 *Ë
cuº
);

4174 #i‡
DEBUG
 >= 2

4175 
	`Ârötf
 (
ouçutfûe
, "startblkno %d,Éndblkno %d, outblkno %d, "

4177 
£g
->
°¨tblkno
, seg->
ídblkno
,

4178 
cuºdiskªq
->
outblkno
, 
£g
->
ªqli°
->
blkno
,

4179 (
£g
->
ªqli°
->
blkno
 + seg->ªqli°->
bcou¡
));

4180 
	`Ârötf
 (
ouçutfûe
, "Leaving disk_buffer_seekdone\n");

4182 
	}
}

4189 
	$dbsd_£tup
(
disk
 *
cd
,

4190 
i‹eq_evít
 *
cuº
,

4191 *
blkno
,

4192 *
ˇu£
,

4193 *
fú°
,

4194 *
œ°
,

4195 *
√xt
,

4196 *
ªm≠£˘‹
)

4198 
rv
;

4199 
dm_pbn
 
pbn
;

4239 *
fú°
 = 
cd
->
åack_low
;

4240 *
œ°
 = 
cd
->
åack_high
;

4242 
	`ddbg_as£π
((*
fú°
 <
cuº
->
blkno
Ë&& (cuº->blknÿ<*
œ°
));

4244 *
√xt
 = *
œ°
+1;

4246 if(
cuº
->
blkno
 > *
fú°
) {

4247 *
blkno
 = 
cuº
->blkno - 1;

4250 *
blkno
 = *
œ°
;

4253 
rv
 =

4254 
cd
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(cd->model,

4255 *
blkno
,

4256 
MAP_FULL
,

4257 &
pbn
,

4258 
ªm≠£˘‹
);

4259 
	`ddbg_as£π
(
rv
 =
DM_OK
);

4261 *
ˇu£
 = 
pbn
.
£˘‹
;

4264 
	}
}

4270 
	$dbsd_check_times
()

4277 
uöt64_t
 
n£cs
;

4278 
dm_pbn
 
pbn
;

4284 
dm_time_t
 
ªqtime
 = 
	`dm_time_dtoi
(
£g
->
time
Ë- 
cuºdisk
->
cuºtime_i
;

4287 
dm_time_t
 
ªsidtime
 =

4288 
ªqtime
 % 
cuºdisk
->
modñ
->
mech
->
	`dm_≥riod
(currdisk->model);

4290 
dm_mech_°©e
 
°¨t°©e
 = 
cuºdisk
->
mech_°©e
;

4291 
°¨t°©e
.
thëa
 +
cuºdisk
->
modñ
->
mech
->
	`dm_rŸ©e
(currdisk->model,

4292 &
ªsidtime
);

4294 
pbn
.
cyl
 = 
cuºdisk
->
mech_°©e
.cyl;

4295 
pbn
.
hód
 = 
cuºdisk
->
mech_°©e
.head;

4296 
pbn
.
£˘‹
 = 
cuº
->
ˇu£
;

4301 
n£cs
 = 
cuºdisk
->
modñ
->
mech
->
	`dm_pos_time
(currdisk->model,

4302 &
°¨t°©e
,

4303 &
pbn
,

4305 (
cuº
->
Êags
 & 
READ
),

4309 
cuºdisk
->
mech_°©e
.
cyl
 = 
pbn
.cyl;

4310 
cuºdisk
->
mech_°©e
.
hód
 = 
pbn
.head;

4313 
cuºdisk
->
mech_°©e
.
thëa
 = 
°¨t°©e
.theta +

4314 
cuºdisk
->
modñ
->
mech
->
	`dm_rŸ©e
(cuºdisk->modñ, &
n£cs
);

4319 
cuºdisk
->
cuºtime
 = 
£g
->
time
 + 
	`dm_time_ôod
(
n£cs
);

4320 
cuºdisk
->
cuºtime_i
 = 
	`dm_time_dtoi
(
£g
->
time
Ë+ 
n£cs
;

4322 
cuº
->
time
 = 
£g
->timê+ 
	`dm_time_ôod
(
n£cs
);

4324 
mydiff
 = 
	`Ábs
(
cuº
->
time
 - 
simtime
);

4328 
	`ddbg_as£π3
((
mydiff
 <0.00001Ë|| (mydif‡<(0.00001 * 
simtime
)),

4332 
simtime
,

4333 
cuº
->
time
,

4334 
cuº
->
devno
,

4335 
cuº
->
blkno
,

4336 
cuº
->
bcou¡
,

4337 
cuº
->
ãmµå1
,

4338 (
cuº
->
blkno
 - 
b™d°¨t
)));

4342 
	}
}

4347 
	$disk_buf„r_£˘‹_d⁄e
 (
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuº
)

4349 
£gmít
 *
£g
;

4350 
diskªq
 *
cuºdiskªq
 = 
cuºdisk
->
ef„˘ivehda
;

4351 
i‹eq_evít
 *
tmpi‹eq
;

4353 
fú°
, 
œ°
;

4354 
√xt
;

4355 
fú°blkno
;

4356 
œ°blkno
;

4357 
ídœt
 = 0;

4361 
cuºblkno
 = -1;

4362 
cuºˇu£
 = -1;

4364 
dm_time_t
 
diff_i
;

4365 
mydiff
;

4366 
ªm≠£˘‹
 = 0;

4368 
rv
;

4369 
dm_pbn
 
pbn
;

4371 
	`disksim_ö°_íãr
();

4373 
cuºdisk
->
Âcheck
--;

4376 
	`ddbg_as£π
(
cuºdisk
->
Âcheck
);

4380 
	`ddbg_as£π2
(
cuºdiskªq
 != 0, "NoÉffectivehda");

4382 
£g
 = 
cuºdiskªq
->seg;

4384 
	`dbsd_£tup
(
cuºdisk
, 
cuº
,

4385 &
cuºblkno
, &
cuºˇu£
,

4386 &
fú°
, &
œ°
, &
√xt
,

4387 &
ªm≠£˘‹
);

4397 if(
ªm≠£˘‹
 | (
cuºblkno
 < 0)) {

4399 
cuºblkno
 = -1;

4400 if(
cuº
->
bcou¡
) {

4401 
cuº
->
bcou¡
 = 2;

4406 if(!
cuº
->
bcou¡
) {

4407 
cuº
->
time
 = 
simtime
;

4409 
diff_i
 = (
	`dm_time_dtoi
(
£g
->
time
Ë- 
cuºdisk
->
cuºtime_i
Ë% cuºdisk->
modñ
->
mech
->
	`dm_≥riod
(currdisk->model);

4410 
cuºdisk
->
mech_°©e
.
thëa
 +cuºdisk->
modñ
->
mech
->
	`dm_rŸ©e
(cuºdisk->modñ, &
diff_i
);

4415 
diff_i
 = 
	`dm_time_dtoi
(
simtime
 - 
£g
->
time
);

4416 
cuºdisk
->
mech_°©e
.
thëa
 +cuºdisk->
modñ
->
mech
->
	`dm_rŸ©e
(cuºdisk->modñ, &
diff_i
 );

4420 
cuºdisk
->
cuºtime
 = 
simtime
;

4421 
cuºdisk
->
cuºtime_i
 = 
	`dm_time_dtoi
(
simtime
);

4424 if(!
cuºdisk
->
ªad_dúe˘_to_buf„r


4425 && (
cuº
->
Êags
 & 
READ
)

4426 && (
cuº
->
bcou¡
 == 1)

4427 && !(
	`disk_buf„r_block_avaûabÀ
(
cuºdisk
, 
£g
, 
cuºblkno
)))

4429 
cuº
->
bcou¡
 = 2;

4441 if(
£g
->
ªcy˛îeq
 =
cuºdiskªq
) {

4442 
cuº
->
bcou¡
 = 2;

4443 
fú°blkno
 = 
cuºdiskªq
->
öblkno
;

4444 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

4445 
tmpi‹eq
->
√xt
) {

4446 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

4448 
œ°blkno
 = 
	`mö
((
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
), 
√xt
);

4450 if(
£g
->
°©e
 =
BUFFER_READING
) {

4451 
fú°blkno
 = 
£g
->
ídblkno
;

4452 if(
cuº
->
Êags
 & 
BUFFER_BACKGROUND
) {

4453 
œ°blkno
 = 
	`mö
(
£g
->
maxªadahódblkno
, 
√xt
);

4456 
tmpi‹eq
 = 
cuºdiskªq
->
i‹eqli°
;

4457 
tmpi‹eq
->
√xt
) {

4458 
tmpi‹eq
 =Åmpi‹eq->
√xt
;

4460 
œ°blkno
 = 
	`mö
((
tmpi‹eq
->
blkno
 +Åmpi‹eq->
bcou¡
), 
√xt
);

4464 
fú°blkno
 = 
cuºdiskªq
->
öblkno
;

4465 
œ°blkno
 = 
	`mö
(
£g
->
ídblkno
, 
√xt
);

4468 if(
cuºdisk
->
°©
.
x„πime
 == -1.0) {

4469 
ídœt
++;

4473 
	`ddbg_as£π
((0 <
cuº
->
bcou¡
) && (curr->bcount <= 2));

4478 if(
cuº
->
bcou¡
 == 1) {

4479 if(
cuºblkno
 =
fú°blkno
) {

4488 
fú°blkno
++;

4489 
	`ddbg_as£π
(
fú°blkno
 < (
cuºdisk
->
modñ
->
dm_£˘‹s
+1));

4490 if(
fú°blkno
 =
cuºdisk
->
immed°¨t
) {

4491 
fú°blkno
 = 
cuºdisk
->
immedíd
;

4493 
cuºdisk
->
immed°¨t
 = 
√xt
 + 1;

4494 
cuºdisk
->
immedíd
 = cuºdisk->
immed°¨t
;

4496 
ídœt
++;

4498 if(
cuºblkno
 < 
£g
->
°¨tblkno
) {

4502 
	`ddbg_as£π3
(((
£g
->
°©e
 =
BUFFER_READING
)

4503 && 
cuºdisk
->
ªad™y‰ìblocks
),

4505 
£g
->
°©e
,

4506 
cuºdisk
->
ªad™y‰ìblocks
));

4508 
£g
->
°¨tblkno
 = 
cuºblkno
;

4509 
fú°blkno
 = 
cuºblkno
 + 1;

4510 
	`ddbg_as£π
(
fú°blkno
 < 
cuºdisk
->
modñ
->
dm_£˘‹s
);

4512 if((
cuºdisk
->
immed
)

4513 && (
cuºdisk
->
immed°¨t
 >
√xt
))

4516 if(
cuºblkno
 >
œ°blkno
) {

4517 if((
£g
->
°©e
 =
BUFFER_READING
)

4518 && (
cuºdisk
->
c⁄åód
 !
BUFFER_NO_READ_AHEAD
)

4519 && (
cuºblkno
 < 
cuºdiskªq
->
öblkno
))

4521 
cuºdisk
->
immed°¨t
 = 
cuºblkno
;

4522 
cuºdisk
->
immedíd
 = 
cuºblkno
 + 1;

4525 if(
cuºblkno
 > 
fú°blkno
) {

4526 
cuºdisk
->
immed°¨t
 = 
cuºblkno
;

4527 
cuºdisk
->
immedíd
 = 
cuºblkno
 + 1;

4528 
ídœt
++;

4531 if((
cuºblkno
 =
cuºdisk
->
immedíd
)

4532 && ((
cuºblkno
 < 
œ°blkno
)

4533 || (
cuºblkno
 < 
cuºdiskªq
->
öblkno
)))

4535 
cuºdisk
->
immedíd
++;

4536 
	`disk_buf„r_£gmít_wøp
(
£g
, 
cuºdisk
->
immedíd
);

4538 if((
cuºblkno
 > 
cuºdisk
->
immedíd
Ë&& (cuºblknÿ< 
œ°blkno
)) {

4539 
cuºdisk
->
immed°¨t
 = 
cuºblkno
;

4540 
cuºdisk
->
immedíd
 = 
cuºblkno
 + 1;

4545 if((
cuºdiskªq
 !
£g
->
ªcy˛îeq
) &&

4546 (
£g
->
out°©e
 =
BUFFER_TRANSFERING
)) {

4547 
	`disk_buf„r_upd©e_outbuf„r
(
cuºdisk
, 
£g
);

4552 if(
ídœt
 == 2) {

4553 
cuºdisk
->
°©
.
œãncy
 = 
£g
->
time
 - currdisk->stat.latency;

4554 
cuºdisk
->
°©
.
x„πime
 = () 0.0;

4557 if(
cuºdisk
->
°©
.
x„πime
 != () -1) {

4558 
cuºdisk
->
°©
.
x„πime
 +
simtime
 - 
£g
->
time
;

4562 if(
cuºdiskªq
 !
£g
->
ªcy˛îeq
) {

4563 if(
£g
->
°©e
 =
BUFFER_READING
) {

4564 
£g
->
ídblkno
 = 
fú°blkno
;

4567 
cuºdiskªq
->
öblkno
 = 
fú°blkno
;

4570 
	`disk_buf„r_£gmít_wøp
(
£g
, seg->
ídblkno
);

4572 if(
	`disk_buf„r_ªque°_com∂ëe
(
cuºdisk
, 
cuºdiskªq
)) {

4584 if(
fú°blkno
 >
√xt
) {

4587 
cuº
->
blkno
 = 
√xt
;

4588 if(!(
	`disk_öôüã_£ek
(
cuºdisk
, 
£g
, 
cuº
, 0, 0.0, 0.0))) {

4589 
	`disk_ªÀa£_hda
(
cuºdisk
,
cuºdiskªq
);

4605 if(
cuº
->
blkno
 < 
œ°
) {

4606 
cuº
->
blkno
++;

4609 
cuº
->
blkno
 = 
fú°
;

4613 
	`ddbg_as£π
(
cuº
->
blkno
 <
cuºdisk
->
åack_high
);

4615 
rv
 =

4616 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

4617 
cuº
->
blkno
,

4618 
MAP_FULL
,

4619 &
pbn
,

4620 &
ªm≠£˘‹
);

4622 
cuºˇu£
 = 
cuº
->
ˇu£
;

4623 
cuº
->
ˇu£
 = 
pbn
.
£˘‹
;

4634 
£g
->
time
 = 
simtime
;

4636 
cuº
->
time
 = 
£g
->timê+ 
	`dm_time_ôod
(
cuºdisk
->
modñ
->
mech
->
	`dm_x„πime
(cuºdisk->modñ, &cuºdisk->
mech_°©e
, 1));

4642 
√wcuºˇu£
;

4643 
dm_pbn
 
pbn
;

4644 
pbn
.
cyl
 = 
cuºdisk
->
mech_°©e
.cyl;

4645 
pbn
.
hód
 = 
cuºdisk
->
mech_°©e
.head;

4646 
pbn
.
£˘‹
 = 
cuºˇu£
;

4648 
√wcuºˇu£
 = 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_±ﬁ
(currdisk->model,

4649 &
pbn
,

4650 &
ªm≠£˘‹
);

4652 
cuºˇu£
 = 
√wcuºˇu£
;

4655 if(
ªm≠£˘‹
) {

4656 
cuºˇu£
 = -1;

4659 if((
cuºdiskªq
 !
£g
->
ªcy˛îeq
)

4660 && (
cuºˇu£
 == -2)

4661 && (
£g
->
°©e
 =
BUFFER_READING
)

4662 && (
cuºdiskªq
->
i‹eqli°
)

4663 && (
cuºdisk
->
ªad™y‰ìblocks
)

4664 && (
cuºblkno
 >= 0)

4665 && (
cuºblkno
 =(
£g
->
ídblkno
-1))

4666 && (
£g
->
ídblkno
 < 
cuºdiskªq
->
i‹eqli°
->
blkno
)

4667 && (
cuº
->
ˇu£
 > 0))

4669 
£g
->
°¨tblkno
 = 
cuºdiskªq
->
i‹eqli°
->
blkno
;

4670 
£g
->
ídblkno
 = seg->
°¨tblkno
;

4671 
cuºˇu£
 = -1;

4674 if((
cuºˇu£
 == -2)

4675 && (
cuºblkno
 >= 0)

4676 && (
cuºblkno
 =(
fú°blkno
-1)))

4678 
cuº
->
blkno
--;

4680 if(
cuº
->
ˇu£
 == 0) {

4681 
cuº
->
blkno
 = 
√xt
;

4684 
	`disk_gë_ªm≠≥d_£˘‹
(
cuºdisk
, 
cuº
);

4687 
cuº
->
bcou¡
 = 1;

4688 if(((
cuºdisk
->
ªad_dúe˘_to_buf„r


4689 || !(
cuº
->
Êags
 & 
READ
))

4690 && ((
cuºdiskªq
 =
£g
->
ªcy˛îeq
)

4691 || !(
	`disk_buf„r_block_avaûabÀ
(
cuºdisk
, 
£g
, 
cuºˇu£
))))

4692 || (
cuºˇu£
 < 0))

4694 
cuº
->
bcou¡
 = 2;

4698 
	`addtoötq
((
evít
 *Ë
cuº
);

4702 
	}
}

4717 
	$disk_buf„r_e°im©e_£rvtime
(
disk
 *
cuºdisk
,

4718 
i‹eq_evít
 *
cuº
,

4719 
checkˇche
,

4720 
maxtime
)

4722 
dm_pbn
 
de°pbn
;

4723 
tm±ime
;

4724 
tmpblkno
;

4725 
œ°⁄åack
;

4726 
hôty≥
 = 
BUFFER_NOMATCH
;

4728 if(
cuºdisk
->
c⁄°_ac˘ime
) {

4729 (
cuºdisk
->
ac˘ime
);

4732 if(
checkˇche
) {

4733 
buf„r_ªadög
 = 
FALSE
;

4735 
hôty≥
 = 
	`disk_buf„r_check_£gmíts
(
cuºdisk
,
cuº
,&
buf„r_ªadög
);

4736 if(
hôty≥
 =
BUFFER_APPEND
) {

4739 if(
hôty≥
 =
BUFFER_WHOLE
) {

4740 (
buf„r_ªadög
 ? 
ªadög_buf„r_whﬁe_£rvtime
 :

4741 
buf„r_whﬁe_£rvtime
);

4743 if(
hôty≥
 =
BUFFER_PARTIAL
) {

4744 (
buf„r_ªadög
 ? 
ªadög_buf„r_∑πül_£rvtime
 :

4745 
buf„r_∑πül_£rvtime
);

4749 
tmpblkno
 = 
cuº
->
bcou¡
;

4750 
tm±ime
 = 
cuº
->
time
;

4754 
uöt64_t
 
n£cs
;

4755 
dm_mech_°©e
 
íd
;

4757 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

4758 
cuº
->
blkno
,

4759 
MAP_FULL
,

4760 &
de°pbn
,

4762 
íd
.
cyl
 = 
de°pbn
.cyl;

4763 
íd
.
hód
 = 
de°pbn
.head;

4764 
íd
.
thëa
 = 0;

4765 
cuº
->
ˇu£
 = 
de°pbn
.
£˘‹
;

4768 
n£cs
 =

4769 
cuºdisk
->
modñ
->
mech
->
	`dm_£ek_time
(currdisk->model,

4770 &
cuºdisk
->
mech_°©e
,

4771 &
íd
,

4772 (
cuº
->
Êags
 & 
READ
));

4774 
cuº
->
time
 = 
	`dm_time_ôod
(
n£cs
);

4777 if(
cuº
->
time
 < 
maxtime
) {

4778 
cuº
->
time
 = 
tm±ime
;

4781 
cuºdisk
->
modñ
->
œyout
->
	`dm_gë_åack_bound¨õs
(currdisk->model,

4782 &
de°pbn
,

4784 &
œ°⁄åack
,

4787 
œ°⁄åack
++;

4790 
cuº
->
bcou¡
 = 
	`mö
(cuº->bcou¡, (
œ°⁄åack
 - cuº->
blkno
));

4795 
dm_time_t
 
n£cs
;

4796 
dm_pbn
 
pbn
;

4797 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

4798 
cuº
->
blkno
,

4799 
MAP_FULL
,

4800 &
pbn
,

4802 
cuº
->
ˇu£
 = 
pbn
.
£˘‹
;

4805 if(
cuº
->
Êags
 & 
READ
) {

4806 
cuºdisk
->
immed
 = cuºdisk->
immedªad
;

4809 
cuºdisk
->
immed
 = cuºdisk->
immedwrôe
;

4837 
n£cs
 = 
cuºdisk
->
modñ
->
mech
->

4838 
	`dm_ac˘ime
(
cuºdisk
->
modñ
,

4839 &
cuºdisk
->
mech_°©e
,

4840 &
pbn
,

4841 
cuº
->
bcou¡
,

4842 (
cuº
->
Êags
 & 
READ
),

4843 
cuºdisk
->
immed
,

4847 
n£cs
 -
cuºdisk
->
modñ
->
mech
->

4848 
	`dm_x„πime
(
cuºdisk
->
modñ
,

4849 (
dm_mech_°©e
 *)&
pbn
,

4850 
cuº
->
bcou¡
);

4853 
tm±ime
 = 
	`dm_time_ôod
(
n£cs
);

4855 
cuº
->
bcou¡
 = 
tmpblkno
;

4856 if((!(
cuº
->
Êags
 & 
READ
)) &&

4857 (
tm±ime
 < 
cuºdisk
->
möimum_£ek_dñay
)) {

4858 
tm±ime
 = 
cuºdisk
->
möimum_£ek_dñay
;

4862 
tm±ime
 = 
maxtime
 + 1.0;

4864  
tm±ime
;

4865 
	}
}

4872 
	$disk_buf„r_e°im©e_£ektime
(
disk
 *
cuºdisk
,

4873 
i‹eq_evít
 *
cuº
,

4874 
checkˇche
,

4875 
maxtime
)

4877 
tm±ime
;

4878 
hôty≥
 = 
BUFFER_NOMATCH
;

4880 if(
cuºdisk
->
c⁄°_£ektime
) {

4881  
cuºdisk
->
£ektime
;

4884 if(
checkˇche
) {

4885 
buf„r_ªadög
 = 
FALSE
;

4886 
hôty≥
 = 
	`disk_buf„r_check_£gmíts
(
cuºdisk
,
cuº
,&
buf„r_ªadög
);

4888 
hôty≥
) {

4890 
BUFFER_APPEND
:

4893 
BUFFER_WHOLE
:

4894 if(
buf„r_ªadög
) {

4895  
ªadög_buf„r_whﬁe_£rvtime
;

4898  
buf„r_whﬁe_£rvtime
;

4901 
BUFFER_PARTIAL
:

4902 if(
buf„r_ªadög
) {

4903  
ªadög_buf„r_∑πül_£rvtime
;

4906  
buf„r_∑πül_£rvtime
;

4910 
	`as£π
(0);

4916 
dm_time_t
 
n£cs
;

4917 
dm_pbn
 
pbn
;

4918 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

4919 
cuº
->
blkno
,

4920 
MAP_FULL
,

4921 &
pbn
,

4925 
n£cs
 = 
cuºdisk
->
modñ
->
mech
->

4926 
	`dm_£ek_time
(
cuºdisk
->
modñ
,

4927 &
cuºdisk
->
mech_°©e
,

4928 (
dm_mech_°©e
 *)&
pbn
,

4929 (
cuº
->
Êags
 & 
READ
));

4932 
tm±ime
 = 
	`dm_time_ôod
(
n£cs
);

4935 if(
tm±ime
 < 
maxtime
) {

4936 if((!(
cuº
->
Êags
 & 
READ
))

4937 && (
tm±ime
 < 
cuºdisk
->
möimum_£ek_dñay
))

4939 
tm±ime
 = 
cuºdisk
->
möimum_£ek_dñay
;

4943 
tm±ime
 = 
maxtime
 + 1.0;

4946  
tm±ime
;

4947 
	}
}

4955 
	$disk_gë_di°™˚
(
diskno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
)

4957 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
diskno
);

4958 
cyl1
, 
hód1
;

4959 
cyl2
, 
hód2
;

4961 if(
exa˘
 == -1) {

4962 
cyl1
 = 
cuºdisk
->
mech_°©e
.
cyl
;

4963 
hód1
 = 
cuºdisk
->
mech_°©e
.
hód
;

4966 
dm_pbn
 
pbn
;

4967 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

4968 
exa˘
,

4969 
MAP_FULL
,

4970 &
pbn
,

4973 
cyl1
 = 
pbn
.
cyl
;

4974 
hód1
 = 
pbn
.
hód
;

4977 
dm_pbn
 
pbn
;

4978 
cuºdisk
->
modñ
->
œyout
->
	`dm_å™¶©e_…›
(currdisk->model,

4979 
ªq
->
blkno
,

4980 
MAP_FULL
,

4981 &
pbn
,

4983 
cyl2
 = 
pbn
.
cyl
;

4984 
hód2
 = 
pbn
.
hód
;

4987 if(
cyl1
 > 
cyl2
) {

4988  (
cyl1
 - 
cyl2
);

4990 if(
cyl1
 < 
cyl2
) {

4991  (
cyl2
 - 
cyl1
);

4993 if((
dúe˘i⁄
Ë&& (
hód1
 !
hód2
)) {

4999 
	}
}

5007 
	$disk_gë_£rvtime
(
diskno
,

5008 
i‹eq_evít
 *
ªq
,

5009 
checkˇche
,

5010 
maxtime
)

5012 
£rvtime
;

5013 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
diskno
);

5015 
£rvtime
 = 
	`disk_buf„r_e°im©e_£rvtime
(
cuºdisk
, 
ªq
, 
checkˇche
, 
maxtime
);

5016 (
£rvtime
);

5017 
	}
}

5025 
	$disk_gë_£ektime
(
diskno
,

5026 
i‹eq_evít
 *
ªq
,

5027 
checkˇche
,

5028 
maxtime
)

5030 
£ektime
;

5031 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
diskno
);

5033 
£ektime
 = 
	`disk_buf„r_e°im©e_£ektime
(
cuºdisk
, 
ªq
, 
checkˇche
, 
maxtime
);

5034 (
£ektime
);

5035 
	}
}

5046 
	$disk_gë_ac˘ime
 (
diskno
, 
i‹eq_evít
 *
ªq
, 
maxtime
)

5048 
ac˘ime
;

5049 
disk
 *
cuºdisk
 = 
	`gëdisk
 (
diskno
);

5051 
ac˘ime
 = 
	`disk_buf„r_e°im©e_ac˘ime
(
cuºdisk
, 
ªq
, 
maxtime
);

5052 (
ac˘ime
);

5053 
	}
}

5058 
	$disk_buf„r_e°im©e_ac˘ime
(
disk
 *
cuºdisk
, 
i‹eq_evít
 *
cuº
, 
maxtime
)

5060 
çass
 = 0.0;

5063 
	`ddbg_as£π
(
FALSE
);

5065 (
çass
);

5066 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_diskmap.h

101 #i‚de‡
DISKSIM_DISKMAP_H


102 
	#DISKSIM_DISKMAP_H


	)

107 
	#MAXSLIPS
 2048

	)

108 
	#MAXDEFECTS
 2048

	)

113 
	#NO_SPARING
 0

	)

114 
	#TRACK_SPARING
 1

	)

115 
	#SECTPERCYL_SPARING
 2

	)

116 
	#SECTPERTRACK_SPARING
 3

	)

117 
	#SECTPERCYL_SPARING_SLIPTOEND
 4

	)

118 
	#SECTPERCYL_SPARING_ATFRONT
 5

	)

119 
	#SECTPERCYL_SPARING_ATFRONT_SLIPTOEND
 6

	)

120 
	#SECTATEND_SPARING
 7

	)

121 
	#SECTPERRANGE_SPARING
 8

	)

122 
	#SECTSPERZONE_SPARING
 9

	)

123 
	#SECTSPERZONE_SPARING_SLIPTOEND
 10

	)

124 
	#MAXSPARESCHEME
 10

	)

129 
	#LAYOUT_NORMAL
 0

	)

130 
	#LAYOUT_CYLSWITCHONSURF1
 1

	)

132 
	#LAYOUT_CYLSWITCHONSURF2
 2

	)

134 
	#LAYOUT_SERPENTINE
 3

	)

135 
	#LAYOUT_RAWFILE
 4

	)

136 
	#LAYOUT_MAX
 4

	)

141 
	#is•¨ót‰⁄t
(
cuºdisk
) \

142 (((
cuºdisk
)->
•¨escheme
 =
SECTPERCYL_SPARING_ATFRONT
) || \

143 ((
cuºdisk
)->
•¨escheme
 =
SECTPERCYL_SPARING_ATFRONT_SLIPTOEND
))

	)

145 
	#is¶ùt€nd
(
cuºdisk
) \

146 (((
cuºdisk
)->
•¨escheme
 =
SECTPERCYL_SPARING_SLIPTOEND
) || \

147 ((
cuºdisk
)->
•¨escheme
 =
SECTPERCYL_SPARING_ATFRONT_SLIPTOEND
) || \

148 ((
cuºdisk
)->
•¨escheme
 =
SECTATEND_SPARING
))

	)

150 
	#is£˘≥rcyl
(
cuºdisk
) \

151 (((
cuºdisk
)->
•¨escheme
 =
SECTPERCYL_SPARING
) || \

152 ((
cuºdisk
)->
•¨escheme
 =
SECTPERCYL_SPARING_SLIPTOEND
) || \

153 ((
cuºdisk
)->
•¨escheme
 =
SECTPERCYL_SPARING_ATFRONT
) || \

154 ((
cuºdisk
)->
•¨escheme
 =
SECTPERCYL_SPARING_ATFRONT_SLIPTOEND
))

	)

159 
	gb™d
;

160 
	gdisk
;

162 
diskm≠_öôülize
 (
disk
 *
cuºdisk
);

164 
b™d
 * 
disk_å™¶©e_lbn_to_pbn
 (
disk
 *
cuºdisk
, 
blkno
, 
m≠ty≥
, *
cyÕå
, *
surÁ˚±r
, *
blk±r
);

166 
disk_å™¶©e_pbn_to_lbn
 (
disk
 *
cuºdisk
, 
b™d
 *
cuºb™d
, 
cy o
, 
surÁ˚no
, 
blkno
);

168 
disk_m≠_pbn_skew
 (
disk
 *
cuºdisk
, 
b™d
 *
cuºb™d
, 
cy o
, 
surÁ˚no
);

170 
disk_gë_lbn_bound¨õs_f‹_åack
 (
disk
 *
cuºdisk
,

171 
b™d
 *
cuºb™d
,

172 
cy o
,

173 
surÁ˚no
,

174 *
°¨çå
,

175 *
íd±r
);

177 
disk_check_numblocks
 (
disk
 *
cuºdisk
);

179 
disk_compuã_blksöb™d
 (
disk
 *
cuºdisk
, 
b™d
 *
cuºb™d
);

182 
disk_pbn_to_lbn_£˘≥πøck•¨e
(
disk
 *
cuºdisk
,

183 
b™d
 *
cuºb™d
,

184 
cy o
, 
surÁ˚no
,

185 
blkno
);

187 
disk_pbn_to_lbn_£˘≥rcyl•¨e
(
disk
 *
cuºdisk
,

188 
b™d
 *
cuºb™d
,

189 
cy o
, 
surÁ˚no
,

190 
blkno
);

192 
disk_pbn_to_lbn_£˘≥º™ge•¨e
(
disk
 *
cuºdisk
,

193 
b™d
 *
cuºb™d
,

194 
cy o
, 
surÁ˚no
,

195 
blkno
);

197 
disk_pbn_to_lbn_£˘≥rz⁄e•¨e
(
disk
 *
cuºdisk
,

198 
b™d
 *
cuºb™d
,

199 
cy o
, 
surÁ˚no
,

200 
blkno
);

202 
disk_pbn_to_lbn_åack•¨e
(
disk
 *
cuºdisk
,

203 
b™d
 *
cuºb™d
,

204 
cy o
, 
surÁ˚no
,

205 
blkno
);

208 
disk_pbn_to_lbn_no•¨e
(
disk
 *
cuºdisk
,

209 
b™d
 *
cuºb™d
,

210 
cy o
, 
surÁ˚no
,

211 
blkno
);

213 
disk_pbn_to_lbn_øwœyout
(
disk
 *
cuºdisk
,

214 
b™d
 *
cuºb™d
,

215 
cy o
,

216 
surÁ˚no
,

217 
blkno
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl.c

11 
	~"disksim_iosim.h
"

12 
	~"moduÀs/moduÀs.h
"

13 
	~"disksim_f˛.h
"

14 
	~"disksim_ioqueue.h
"

15 
	~"disksim_f˛_ˇche.h
"

16 
	~"disksim_f˛_m≠.h
"

17 
	~"../ssdmodñ/ssd_˛ón.h
"

19 
	#MAX_DIRTY
 8

	)

20 
	#MAX_STAGE
 1

	)

24 
ioq
 *
	gf˛_globÆ_queue
 = 
NULL
;

25 
ioq
 *
	gf˛_background_queue
 = 
NULL
;

26 
ˇche_m™agî
 *
	gf˛_ˇche_m™agî
;

27 
ˇche_m™agî
 *
	gf˛_a˘ive_block_m™agî
;

28 
li°node
 *
	gf˛_≥ndög_m™agî
;

30 
f˛_∑ømëîs
 *
	gf˛_∑øms
;

32 (*
f˛_timî_func
)(
timî_ev
 *);

34 
f˛_›id
 = 0;

36 
f˛_out°™dög
 = 1000000;

38 
Êash_max_∑ges
 = 50000;

39 
Êash_max_£˘‹s
 = 50000;

40 
hdd_max_∑ges
 = 50000;

41 
hdd_max_£˘‹s
 = 50000;

43 
f˛_idÀ_time
 = 100000.0;

45 
f˛_ˇche_by∑ss
 = 1;

47 
	#Ârötf


	)

51 
i‹eq_evít
 *
	$f˛_¸óã_chûd
 (
i‹eq_evít
 *
∑ª¡
, 
devno
, 
blkno
, 
bcou¡
, 
Êags
){

52 
i‹eq_evít
 *
chûd
 = 
NULL
;

54 
chûd
 = 
	`i‹eq_c›y
 ( 
∑ª¡
 );

60 
chûd
->
time
 = 
∑ª¡
->time;

61 
chûd
->
devno
 = devno;

62 
chûd
->
blkno
 = blkno;

63 
chûd
->
bcou¡
 = bcount;

64 
chûd
->
Êags
 = flags;

65 
chûd
->
f˛_evít_√xt
 = 
NULL
;

68  
chûd
;

69 
	}
}

71 
	$f˛_©èch_chûd
 (
i‹eq_evít
 **
f˛_evít_li°
, *
f˛_evít_cou¡
, 
li°_ödex
, i‹eq_evíà*
chûd
){

72 
i‹eq_evít
 *
œ°
;

74 
debug_cou¡
 = 0;

76 
œ°
 = 
f˛_evít_li°
[
li°_ödex
];

78 i‡–
œ°
 =
NULL
 ) {

79 
f˛_evít_li°
[
li°_ödex
]
chûd
;

82  
œ°
->
f˛_evít_√xt
 !
NULL
 ){

83 
œ°
 =Üa°->
f˛_evít_√xt
;

92 
	`ASSERT
 ( 
chûd
->
devno
 =
œ°
->devnÿ&& chûd->
Êags
 ==Üast->flags );

94 
œ°
->
f˛_evít_√xt
 = 
chûd
;

97 
chûd
->
f˛_evít_√xt
 = 
NULL
;

101 
f˛_evít_cou¡
[
li°_ödex
] += 1;

104 
œ°
 = 
f˛_evít_li°
[
li°_ödex
];

108  
œ°
 !
NULL
 ) {

111 
œ°
 =Üa°->
f˛_evít_√xt
;

112 
debug_cou¡
 ++;

115 
	`ASSERT
 ( 
debug_cou¡
 =
f˛_evít_cou¡
[
li°_ödex
] );

116 
	}
}

118 
	$f˛_∑ª¡_öô
 (
i‹eq_evít
 *
∑ª¡
) {

119 
i
;

121 
f˛_›id
 ++;

123 
∑ª¡
->
›id
 = 
f˛_›id
;

124 
∑ª¡
->
f˛_evít_±r
 = 0;

125 
∑ª¡
->
f˛_evít_num
 = 0;

130  
i
 = 0; i < 
FCL_EVENT_MAX
; i++) {

131 
∑ª¡
->
f˛_evít_cou¡
[
i
] = 0;

132 
∑ª¡
->
f˛_evít_li°
[
i
] = 
NULL
;

135 
	`Œ_¸óã
 ( (
li°node
 **Ë&
∑ª¡
->
f˛_com∂ëe_li°
 );

136 
	`Œ_¸óã
 ( (
li°node
 **Ë&
∑ª¡
->
f˛_a˘ive_li°
 );

137 
	`Œ_¸óã
 ( (
li°node
 **Ë&
∑ª¡
->
f˛_öa˘ive_li°
 );

138 
	`Œ_¸óã
 ( (
li°node
 **Ë&
∑ª¡
->
f˛_≥ndög_li°
 );

140 
	}
}

142 
	$f˛_∑ª¡_ªÀa£
 ( 
i‹eq_evít
 *
∑ª¡
 ) {

144 
	`f˛_ªmove_com∂ëe_li°
 ( 
∑ª¡
 );

146 
	`Œ_ªÀa£
 ( 
∑ª¡
->
f˛_com∂ëe_li°
 );

147 
	`Œ_ªÀa£
 ( 
∑ª¡
->
f˛_a˘ive_li°
 );

148 
	`Œ_ªÀa£
 ( 
∑ª¡
->
f˛_öa˘ive_li°
 );

149 
	`Œ_ªÀa£
 ( 
∑ª¡
->
f˛_≥ndög_li°
 );

152 
	}
}

153 
	$f˛_issue_√xt_chûd
 ( 
i‹eq_evít
 *
∑ª¡
 ){

154 
i‹eq_evít
 *
ªq
;

155 
Êags
 = -1;

156 
devno
 = -1;

158 
	`Ârötf
 ( 
°dout
, " issuê√xà%d \n", 
∑ª¡
->
f˛_evít_±r
 );

160 
	`ASSERT
 ( 
∑ª¡
->
f˛_evít_cou¡
[∑ª¡->
f˛_evít_±r
] != 0 );

162 
ªq
 = 
∑ª¡
->
f˛_evít_li°
[∑ª¡->
f˛_evít_±r
];

163 
	`ASSERT
 ( 
ªq
 !
NULL
);

165 
Êags
 = 
ªq
->flags;

166 
devno
 = 
ªq
->devno;

168  
ªq
 !
NULL
 ){

171 
	`Ârötf
 ( 
°dout
, "Ñeq blknÿ%d, dev = %d, bcou¡ = %d \n", 
ªq
->
blkno
,Ñeq->
devno
,Ñeq->
bcou¡
);

172 i‡–
ªq
->
devno
 =
HDD
) {

173 
	`¥ötf
 ( "Ñeq blknÿ%d, dev = %d, bcou¡ = %d, fœg†%d \n", 
ªq
->
blkno
,Ñeq->
devno
,Ñeq->
bcou¡
,Ñeq->
Êags
);

183 
	`addtoötq
((
evít
 *Ë
ªq
);

185 i‡–
ªq
 ) {

186 
Êags
 = 
ªq
->flags;

187 
devno
 = 
ªq
->devno;

190 
ªq
 =Ñeq->
f˛_evít_√xt
;

194 
∑ª¡
->
f˛_evít_li°
[∑ª¡->
f˛_evít_±r
] = 
NULL
;

195 
∑ª¡
->
f˛_evít_±r
++;

197 
	}
}

199 
	$f˛_gíî©e_chûd_ªque°
 ( 
i‹eq_evít
 *
∑ª¡
, 
devno
, 
blkno
, 
Êags
, 
li°_ödex
 )

201 
i‹eq_evít
 *
chûd
 = 
NULL
;

203 
	`ASSERT
 ( 
li°_ödex
 < 
FCL_EVENT_MAX
 );

205 i‡–
devno
 =
SSD
 ) {

206 
blkno
 = blknÿ* 
FCL_PAGE_SIZE
;

209 
chûd
 = 
	`f˛_¸óã_chûd
 ( 
∑ª¡
,

210 
devno
,

211 
blkno
,

212 
FCL_PAGE_SIZE
,

213 
Êags
 );

215 
chûd
->
devno
 = devno;

216 
chûd
->
ty≥
 = 
IO_REQUEST_ARRIVE2
;

217 
chûd
->
time
 = 
simtime
 + 0.000;

218 
chûd
->
f˛_∑ª¡
 = 
∑ª¡
;

220 
	`f˛_©èch_chûd
 ( 
∑ª¡
->
f˛_evít_li°
,

221 
∑ª¡
->
f˛_evít_cou¡
,

222 
li°_ödex
,

223 
chûd
 );

224 
	}
}

226 
Ãu_node
 * 
	$f˛_ª∂a˚_ˇche
 (
i‹eq_evít
 *
∑ª¡
, 
blkno
) {

227 
Ãu_node
 *
 
;

230 
 
 = 
	`CACHE_REPLACE
(
f˛_ˇche_m™agî
, 0);

232 i‡–
 
 ) {

233 
	`ASSERT
 ( 
 
->
˙_Êag
 =
FCL_CACHE_FLAG_SEALED
 );

236 i‡–
 
 &&Ün->
˙_ssd_blk
 > 0 ) {

239 
	`ASSERT
 ( 
	`CACHE_PRESEARCH
 ( 
f˛_a˘ive_block_m™agî
, 
 
->
˙_blkno
Ë=
NULL
 );

242 i‡–
 
->
˙_dúty
 ) {

243 
	`_f˛_make_de°age_ªq
 ( 
∑ª¡
, 
 
, 0 );

244 
	`ASSERT
 ( 
f˛_ˇche_m™agî
->
cm_dúty_cou¡
 >= 0 );

246 
	`ªvî£_m≠_ªÀa£_blk
 ( 
 
->
˙_ssd_blk
 );

249 
 
 = 
	`CACHE_ALLOC
(
f˛_ˇche_m™agî
,Ün, 
blkno
);

250 
 
->
˙_Êag
 = 
FCL_CACHE_FLAG_FILLING
;

251 
 
->
˙_ssd_blk
 = 
	`ªvî£_m≠_Æloc_blk
–
blkno
 );

252 
 
->
˙_dúty
 = 0;

255 i‡–
∑ª¡
->
Êags
 & 
READ
 ) {

256 
	`_f˛_make_°age_ªq
 ( 
∑ª¡
, 
 
, 2);

259  
 
;

260 
	}
}

262 
	$f˛_make_n‹mÆ_ªq
 (
i‹eq_evít
 *
∑ª¡
, 
blkno
) {

263 
Ãu_node
 *
 
 = 
NULL
;

265 
 
 = 
	`CACHE_SEARCH
(
f˛_ˇche_m™agî
, 
blkno
);

268 if(
 
){

270 
 
 = 
	`CACHE_REMOVE
(
f˛_ˇche_m™agî
,Ün);

273 i‡–
 
->
˙_Êag
 =
FCL_CACHE_FLAG_FILLING
 ) {

274 
	`ASSERT
 ( 
 
->
˙_Êag
 =
FCL_CACHE_FLAG_SEALED
 );

278 
 
 = 
	`f˛_ª∂a˚_ˇche
 ( 
∑ª¡
, 
blkno
 );

279 
	`ASSERT
 ( 
 
 );

282 i‡–
∑ª¡
->
Êags
 & 
READ
 ) {

283 
	`f˛_gíî©e_chûd_ªque°
 ( 
∑ª¡
, 
SSD
, 
 
->
˙_ssd_blk
, 
READ
, 
FCL_EVENT_MAX
 - 2 );

285 
	`f˛_gíî©e_chûd_ªque°
 ( 
∑ª¡
, 
SSD
, 
 
->
˙_ssd_blk
, 
WRITE
, 
FCL_EVENT_MAX
 - 1 );

287 i‡–
 
->
˙_dúty
 == 0 ) {

288 
 
->
˙_dúty
 = 1;

289 
f˛_ˇche_m™agî
->
cm_dúty_cou¡
++;

294 
	`CACHE_INSERT
(
f˛_ˇche_m™agî
, 
 
);

296 
	}
}

299 
	$f˛_make_°age_ªq
 (
i‹eq_evít
 *
∑ª¡
, 
blkno
) {

300 
li°_ödex
 = 0;

301 
devno
 = 0;

302 
fûlög
 = 0;

303 
Ãu_node
 *
 
 = 
NULL
;

305 
 
 = 
	`CACHE_PRESEARCH
(
f˛_ˇche_m™agî
, 
blkno
);

308 if–
 
 ){

309 
	`¥ötf
 ( " SègöêHô .. blknÿ%d \n", 
blkno
 );

310 
	`ASSERT
 ( 
 
 =
NULL
 );

313 
 
 = 
	`f˛_ª∂a˚_ˇche
–
∑ª¡
, 
blkno
 );

316 
	`CACHE_INSERT
(
f˛_ˇche_m™agî
, 
 
);

317 
	}
}

319 
	$_f˛_make_°age_ªq
 ( 
i‹eq_evít
 *
∑ª¡
, 
Ãu_node
 *
 
, 
li°_ödex
 ) {

321 
	`f˛_gíî©e_chûd_ªque°
 ( 
∑ª¡
, 
HDD
, 
	`ªvî£_gë_blk
(
 
->
˙_ssd_blk
), 
READ
, 
li°_ödex
++);

322 
	`f˛_gíî©e_chûd_ªque°
 ( 
∑ª¡
, 
SSD
, 
 
->
˙_ssd_blk
, 
WRITE
, 
li°_ödex
++);

324 
f˛_ˇche_m™agî
->
cm_°age_cou¡
++;

326 
	}
}

328 
	$_f˛_make_de°age_ªq
 ( 
i‹eq_evít
 *
∑ª¡
, 
Ãu_node
 *
 
, 
li°_ödex
 ) {

330 
	`¥ötf
(" makêde°agê%‡%d\n", 
simtime
, 
	`ªvî£_gë_blk
(
 
->
˙_ssd_blk
));

332 
	`f˛_gíî©e_chûd_ªque°
 ( 
∑ª¡
, 
SSD
, 
 
->
˙_ssd_blk
, 
READ
, 
li°_ödex
++);

333 
	`f˛_gíî©e_chûd_ªque°
 ( 
∑ª¡
, 
HDD
, 
	`ªvî£_gë_blk
(
 
->
˙_ssd_blk
), 
WRITE
, 
li°_ödex
++);

335 
f˛_ˇche_m™agî
->
cm_de°age_cou¡
++;

336 
f˛_ˇche_m™agî
->
cm_dúty_cou¡
--;

338 
	}
}

340 
	$f˛_make_de°age_ªq
 (
i‹eq_evít
 *
∑ª¡
, 
blkno
) {

341 
li°_ödex
 = 0;

342 
Ãu_node
 *
 
 = 
NULL
;

344 
 
 = 
	`CACHE_SEARCH
(
f˛_ˇche_m™agî
, 
blkno
);

347 
	`ASSERT
 ( 
 
 !
NULL
 );

350 
 
 = 
	`CACHE_REMOVE
(
f˛_ˇche_m™agî
,Ün);

353 i‡–
 
->
˙_Êag
 =
FCL_CACHE_FLAG_FILLING
 ) {

354 
	`ASSERT
 ( 
 
->
˙_Êag
 =
FCL_CACHE_FLAG_SEALED
 );

356 
	`ASSERT
 ( 
 
->
˙_dúty
 ) ;

358 
	`_f˛_make_de°age_ªq
 ( 
∑ª¡
, 
 
, 0 );

359 
	`ªvî£_m≠_ªÀa£_blk
 ( 
 
->
˙_ssd_blk
 );

361 
	`‰ì
 ( 
 
 );

362 
	}
}

365 
Ãu_node
 *
	$f˛_lookup_a˘ive_li°
 ( 
blkno
 ) {

366 
Ãu_node
 *
node
;

368 
node
 = 
	`CACHE_PRESEARCH
–
f˛_a˘ive_block_m™agî
, 
blkno
 );

369 i‡–
node
 ) {

370  
node
;

372  
NULL
;

373 
	}
}

375 
	$f˛_ö£π_a˘ive_li°
 ( 
i‹eq_evít
 *
chûd
 ) {

376 
Ãu_node
 *
 
 = 
NULL
;

378 
 
 = 
	`CACHE_ALLOC
 ( 
f˛_a˘ive_block_m™agî
, 
NULL
, 
chûd
->
blkno
 );

379 
 
->
˙_Êag
 = 0;

380 
 
->
˙_ãmp1
 = (*)
chûd
;

381 
	`Œ_¸óã
 ( (
li°node
 **Ë&
 
->
˙_ãmp2
 );

383 
	`CACHE_INSERT
 ( 
f˛_a˘ive_block_m™agî
, 
 
 );

384 
	}
}

386 
	$f˛_ö£π_öa˘ive_li°
 ( 
i‹eq_evít
 *
chûd
 ) {

387 
Ãu_node
 *
 
 = 
NULL
;

389 
 
 = 
	`CACHE_PRESEARCH
 ( 
f˛_a˘ive_block_m™agî
, 
chûd
->
blkno
 );

391 
	`Œ_ö£π_©_èû
 ( 
 
->
˙_ãmp2
, 
chûd
 );

392 
	}
}

394 
	$f˛_˛assify_chûd_ªque°
 ( 
i‹eq_evít
 *
∑ª¡
, i‹eq_evíà*
chûd
, 
blkno
 ) {

395 
Ãu_node
 *
node
;

397 
node
 = 
	`f˛_lookup_a˘ive_li°
 ( 
blkno
 );

399 i‡–!
node
 ) {

401 
	`f˛_ö£π_a˘ive_li°
 ( 
chûd
 );

402 
	`Œ_ö£π_©_èû
 ( 
∑ª¡
->
f˛_a˘ive_li°
, 
chûd
 );

405 
	`f˛_ö£π_öa˘ive_li°
 ( 
chûd
 );

406 
	`Œ_ö£π_©_èû
 ( 
∑ª¡
->
f˛_öa˘ive_li°
, 
chûd
 );

409 
	}
}

412 
	$f˛_make_≥ndög_li°
 ( 
i‹eq_evít
 *
∑ª¡
, 
›_ty≥
 ) {

413 
∑ge_cou¡
 = 
∑ª¡
->
bcou¡
 / 
FCL_PAGE_SIZE
;

414 
devno
 = 
∑ª¡
->devno;

415 
Êags
 = 
∑ª¡
->flags;

416 
blkno
;

417 
i
;

419 
i‹eq_evít
 *
chûd
;

420 
li°node
 *
node
;

422 
∑ª¡
->
ãmpöt1
 = 
›_ty≥
;

424  
›_ty≥
 ) {

425 
FCL_OPERATION_NORMAL
:

427 
FCL_OPERATION_DESTAGING
:

428 
∑ª¡
->
Êags
 = 
WRITE
;

430 
FCL_OPERATION_STAGING
:

431 
∑ª¡
->
Êags
 = 
READ
;

435 
Êags
 = 
∑ª¡
->flags;

437 
i
 = 0; i < 
∑ge_cou¡
; i++){

438 
blkno
 = 
∑ª¡
->blknÿ+ 
i
 * 
FCL_PAGE_SIZE
;

440 
chûd
 = 
	`f˛_¸óã_chûd
 ( 
∑ª¡
, 
devno
, 
blkno
,

441 
FCL_PAGE_SIZE
, 
Êags
 );

443 
chûd
->
f˛_∑ª¡
 = 
∑ª¡
;

445 
	`Œ_ö£π_©_èû
 ( 
∑ª¡
->
f˛_≥ndög_li°
, 
chûd
 );

448 
	}
}

450 
	$f˛_make_ªque°
 ( 
i‹eq_evít
 *
∑ª¡
, 
blkno
 ) {

451  
∑ª¡
->
ãmpöt1
 ) {

455 
FCL_OPERATION_NORMAL
:

457 
	`f˛_make_n‹mÆ_ªq
 ( 
∑ª¡
, 
blkno
 );

460 
FCL_OPERATION_DESTAGING
:

462 
	`f˛_make_de°age_ªq
 ( 
∑ª¡
, 
blkno
 );

465 
FCL_OPERATION_STAGING
:

467 
	`f˛_make_°age_ªq
 ( 
∑ª¡
, 
blkno
 );

471 
	}
}

472 
	$f˛_•lô_∑ª¡_ªque°
 (
i‹eq_evít
 *
∑ª¡
) {

474 
i
;

475 
blkno
;

476 
a˘ive_∑ge_cou¡
;

477 
li°node
 *
node
;

478 
li°node
 *
a˘ive_li°
;

479 
i‹eq_evít
 *
chûd
;

483 
tŸÆ_ªq
 = 0;

485  
i
 = 0; i < 
∑ª¡
->
f˛_evít_num
; i++) {

486 
tŸÆ_ªq
 +
∑ª¡
->
f˛_evít_cou¡
[
i
];

487 
	`ASSERT
 ( 
∑ª¡
->
f˛_evít_li°
[
i
] =
NULL
 );

490 
	`ASSERT
 ( 
tŸÆ_ªq
 == 0 );

491 
	`ASSERT
 ( 
∑ª¡
->
bcou¡
 % 
FCL_PAGE_SIZE
 == 0 );

492 
	`ASSERT
 ( 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 ) != 0 );

494 
a˘ive_∑ge_cou¡
 = 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 );

496 
node
 = ((
li°node
 *)
∑ª¡
->
f˛_a˘ive_li°
)->
√xt
 ;

498 
i
 = 0; i < 
a˘ive_∑ge_cou¡
; i++){

500 
	`ASSERT
 ( 
node
 !
NULL
 );

502 
chûd
 = (
i‹eq_evít
 *)
node
->
d©a
;

503 
blkno
 = 
chûd
->blkno;

505 
	`f˛_make_ªque°
 ( 
∑ª¡
, 
blkno
 );

507 
node
 =Çode->
√xt
;

509 
	}
}

512 
	$f˛_ªq_is_c⁄£cutive
–
i‹eq_evít
 *
ªq1
, i‹eq_evíà*
ªq2
 ){

514 i‡–
ªq1
->
blkno
 +Ñeq1->
bcou¡
 =
ªq2
->blkno ) {

519 
	}
}

521 
	$f˛_make_mîge_√xt_ªque°
 (
i‹eq_evít
 **
f˛_evít_li°
, *
f˛_evít_cou¡
) {

522 
i‹eq_evít
 *
ªq
;

523 
i‹eq_evít
 *
mîged_ªq
;

524 
i
;

526  
i
 = 0; i < 
FCL_EVENT_MAX
; i++ ) {

528 i‡–
f˛_evít_cou¡
[
i
] == 0 ) {

532 
ªq
 = 
f˛_evít_li°
[
i
];

534 
	`ASSERT
 ( 
ªq
 !
NULL
);

536  
ªq
 !
NULL
 ){

538 i‡(
ªq
->
f˛_evít_√xt
 &&

539 
	`f˛_ªq_is_c⁄£cutive
 ( 
ªq
,Ñeq->
f˛_evít_√xt
 )) {

542 
mîged_ªq
 = 
ªq
->
f˛_evít_√xt
;

545 
ªq
->
bcou¡
 +
mîged_ªq
->bcount;

548 
ªq
->
f˛_evít_√xt
 = 
mîged_ªq
->fcl_event_next;

550 
	`addt€xåaq
((
evít
 *)
mîged_ªq
);

552 
f˛_evít_cou¡
[
i
] --;

555 
ªq
 =Ñeq->
f˛_evít_√xt
;

559 
	}
}

561 
	$f˛_ªmove_em±y_node
 ( 
i‹eq_evít
 *
∑ª¡
 ) {

562 
i
, 
j
;

566  
i
 = 0; i < 
FCL_EVENT_MAX
; i++){

567  
j
 = 1; j < 
FCL_EVENT_MAX
-
i
; j++) {

569 i‡–
∑ª¡
->
f˛_evít_cou¡
 [
j
-1] == 0 ) {

570 
∑ª¡
->
f˛_evít_cou¡
 [
j
-1] =Öarent->fcl_event_count [j];

571 
∑ª¡
->
f˛_evít_li°
 [
j
-1] =Öarent->fcl_event_list [j];

573 
∑ª¡
->
f˛_evít_cou¡
 [
j
] = 0;

574 
∑ª¡
->
f˛_evít_li°
 [
j
] = 
NULL
;

575 
	`Ârötf
 ( 
°dout
, " [%d] %∞%d \n", 
j
,

576 
∑ª¡
->
f˛_evít_li°
[
j
],Ö¨ít->
f˛_evít_cou¡
[j]);

582  
i
 = 0; i < 
FCL_EVENT_MAX
; i++){

584 i‡–
∑ª¡
->
f˛_evít_cou¡
 [
i
] ) {

585 
∑ª¡
->
f˛_evít_num
 ++ ;

586 
	`Ârötf
 ( 
°dout
, " [%d] %∞%d \n", 
i
,

587 
∑ª¡
->
f˛_evít_li°
[
i
],Ö¨ít->
f˛_evít_cou¡
[i]);

591 
	}
}

595 
	$f˛_make_chûd_ªque°
 (
i‹eq_evít
 *
∑ª¡
) {

597 
i
, 
j
;

600 
	`f˛_issue_≥ndög_chûd
 ( 
∑ª¡
 );

603 i‡–
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 ) ) {

605 
	`f˛_•lô_∑ª¡_ªque°
 ( 
∑ª¡
 );

607 
∑ª¡
->
f˛_evít_±r
 = 0;

608 
∑ª¡
->
f˛_evít_num
 = 0;

610 
	`f˛_ªmove_em±y_node
 ( 
∑ª¡
 );

614 
	`f˛_make_mîge_√xt_ªque°
 ( 
∑ª¡
->
f˛_evít_li°
,Ö¨ít->
f˛_evít_cou¡
 );

624 
	}
}

626 
	gã°_blk
 = 0;

628 
	$_f˛_ªque°_¨rive
 ( 
i‹eq_evít
 *
∑ª¡
, 
›_ty≥
 ) {

631 
∑ª¡
->
blkno
 =Ö¨ít->blknÿ% (
hdd_max_£˘‹s
);

633 
∑ª¡
->
blkno
 = (∑ª¡->blknÿ/ 
FCL_PAGE_SIZE
) * FCL_PAGE_SIZE;

634 i‡–
∑ª¡
->
bcou¡
 % 
FCL_PAGE_SIZE
 ) {

635 
∑ª¡
->
bcou¡
 +
FCL_PAGE_SIZE
 - (Öarent->bcount % FCL_PAGE_SIZE);

638 i‡–
∑ª¡
->
bcou¡
 > 128 ) {

639 
∑ª¡
->
bcou¡
 = 128;

640 
	`¥ötf
 ("Åo beÉdited \n");

644 
	`ASSERT
 ( 
∑ª¡
->
blkno
 % 
FCL_PAGE_SIZE
 == 0 &&

645 
∑ª¡
->
bcou¡
 % 
FCL_PAGE_SIZE
 == 0 );

647 
	`f˛_∑ª¡_öô
 ( 
∑ª¡
 );

650 
∑ª¡
->
blkno
 = 
ã°_blk
;

651 
∑ª¡
->
bcou¡
 = 
FCL_PAGE_SIZE
;

652 
ã°_blk
 +
FCL_PAGE_SIZE
;

654 
	`f˛_make_≥ndög_li°
 ( 
∑ª¡
, 
FCL_OPERATION_STAGING
 );

657 
	`f˛_make_≥ndög_li°
 ( 
∑ª¡
, 
›_ty≥
 );

660 
	`f˛_make_chûd_ªque°
 ( 
∑ª¡
 );

664 i‡–
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 ) ) {

666 
	`f˛_issue_√xt_chûd
 ( 
∑ª¡
 );

670 i‡–
›_ty≥
 =
FCL_OPERATION_NORMAL
 ) {

671 
i‹eq_evít
 *
ãmp
 = 
NULL
;

672 
	`ioqueue_add_√w_ªque°
 ( 
f˛_globÆ_queue
, 
∑ª¡
 );

677 
	`ASSERT
 ( 
	`ioqueue_gë_numbî_ö_queue
 ( 
f˛_globÆ_queue
 ) < 
f˛_out°™dög
);

679 
ãmp
 = 
	`ioqueue_gë_√xt_ªque°
 ( 
f˛_globÆ_queue
 );

680 
	`ASSERT
 ( 
ãmp
 =
∑ª¡
 );

682 
i‹eq_evít
 *
ãmp
 = 
NULL
;

683 
	`ioqueue_add_√w_ªque°
 ( 
f˛_background_queue
, 
∑ª¡
 );

685 
ãmp
 = 
	`ioqueue_gë_√xt_ªque°
 ( 
f˛_background_queue
 );

686 
	`ASSERT
 ( 
ãmp
 =
∑ª¡
 );

690 
	`¥ötf
 ( " getÇext .. \n" );

692 
	`¥ötf
 ( " Queuê# o‡out°™dögÑeq†%d \n", 
	`ioqueue_gë_ªqout°™dög
 ( 
f˛_globÆ_queue
 ));

693 
	`¥ötf
 ( " Queuê# o‡ªq†ö queuê%d \n", 
	`ioqueue_gë_numbî_ö_queue
 ( 
f˛_globÆ_queue
 ));

694 
	`¥ötf
 ( " Queuê# o‡≥ndögÑeq†%d \n", 
	`ioqueue_gë_numbî_≥ndög
 ( 
f˛_globÆ_queue
 ));

699 
	}
}

700 
	$f˛_ªque°_¨rive
 (
i‹eq_evít
 *
∑ª¡
){

702 
	`¥ötf
 ( " FCL Req ArriveÅime = %.2f, blkno = %d, bcount = %d, flags = %d \n",

703 
simtime
, 
∑ª¡
->
blkno
,Ö¨ít->
bcou¡
,Ö¨ít->
Êags
);

707 i‡–!
f˛_ˇche_by∑ss
 ) {

708 
	`_f˛_ªque°_¨rive
 ( 
∑ª¡
, 
FCL_OPERATION_NORMAL
 );

710 
∑ª¡
->
devno
 = 
HDD
;

711 
∑ª¡
->
ty≥
 = 
IO_REQUEST_ARRIVE2
;

712 
	`addtoötq
 ( 
∑ª¡
 );

717 
	}
}

743 
	$f˛_£Æ_com∂ëe_ªque°
 ( 
i‹eq_evít
 *
∑ª¡
 ) {

744 
Ãu_node
 *
 
;

746 
li°node
 *
a˘ive_node
;

747 
i‹eq_evít
 *
chûd
;

748 
a˘ive_∑ge_cou¡
 = 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 );

750 
i
;

752 
a˘ive_node
 = ((
li°node
 *)
∑ª¡
->
f˛_a˘ive_li°
)->
√xt
;

754 
i
 = 0; i < 
a˘ive_∑ge_cou¡
; i++){

756 
	`ASSERT
 ( 
a˘ive_node
 !
NULL
 );

758 
chûd
 = (
i‹eq_evít
 *)
a˘ive_node
->
d©a
;

761 
 
 = 
	`CACHE_PRESEARCH
(
f˛_ˇche_m™agî
, 
chûd
->
blkno
);

763 
	`ASSERT
 ( 
 
 !
NULL
 );

765 i‡–
 
 ) {

766 
 
->
˙_Êag
 = 
FCL_CACHE_FLAG_SEALED
;

769 
a˘ive_node
 =á˘ive_node->
√xt
;

771 
	}
}

772 
	$¥öt_∑ª¡_chûd_°©e
 ( 
i‹eq_evít
 *
∑ª¡
 ) {

774 
	`¥ötf
 ( " Parent opid = %d, blkno = %d,C = %d, A = %d, I = %d, P = %d \n",

775 
∑ª¡
->
›id
,

776 
∑ª¡
->
blkno
,

777 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_com∂ëe_li°
 ),

778 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 ),

779 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_öa˘ive_li°
 ),

780 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_≥ndög_li°
 )

783 
	}
}

785 
	$f˛_ö£π_≥ndög_m™agî
 ( 
i‹eq_evít
 * 
∑ª¡
) {

787 
li°node
 *
≥ndög_∑ª¡
 = 
f˛_≥ndög_m™agî
->
√xt
;

788 
≥ndög_∑ª¡_cou¡
 = 
	`Œ_gë_size
 ( 
f˛_≥ndög_m™agî
 );

790 
exi°
 = 0;

791 
i
;

793  
i
 = 0; i < 
≥ndög_∑ª¡_cou¡
; i++ ) {

794 i‡–
∑ª¡
 =
≥ndög_∑ª¡
->
d©a
 ) {

795 
exi°
 = 1;

799 
≥ndög_∑ª¡
 =Öídög_∑ª¡->
√xt
;

802 i‡–!
exi°
 ) {

803 
	`Œ_ö£π_©_èû
 ( 
f˛_≥ndög_m™agî
, 
∑ª¡
 ) ;

808 
	}
}

810 
	$f˛_ªmove_öa˘ive_li°
 ( 
i‹eq_evít
 *
∑ª¡
, i‹eq_evíà*
chûd
) {

811 
li°node
 *
öa˘ive_li°
 = (÷i°nodê*)
∑ª¡
->
f˛_öa˘ive_li°
);

812 
li°node
 *
öa˘ive_node
 = 
öa˘ive_li°
->
√xt
;

813 
li°node
 *
found_node
 = 
NULL
;

814 
öa˘ive_cou¡
 = 
	`Œ_gë_size
 ( 
öa˘ive_li°
 );

815 
i
;

817  
i
 = 0; i < 
öa˘ive_cou¡
; i++ ) {

819 i‡–
öa˘ive_node
->
d©a
 =
chûd
 ) {

820 
found_node
 = 
öa˘ive_node
;

824 
öa˘ive_node
 = i«˘ive_node->
√xt
;

827 
	`ASSERT
 ( 
found_node
 !
NULL
 );

829 i‡–
found_node
 ) {

830 
	`Œ_ªÀa£_node
 ( 
∑ª¡
->
f˛_öa˘ive_li°
, 
found_node
 );

833 
	}
}

835 
	$f˛_move_≥ndög_li°
 ( 
li°node
 *
öa˘ive_li°
 ){

837 
li°node
 *
öa˘ive_node
 = 
öa˘ive_li°
->
√xt
;

838 
i‹eq_evít
 *
chûd
;

839 
i‹eq_evít
 *
∑ª¡
;

841 
öa˘ive_cou¡
 = 
	`Œ_gë_size
 ( 
öa˘ive_li°
 );

842 
i
;

846  
i
 = 0; i < 
öa˘ive_cou¡
; i++ ) {

848 
chûd
 = 
öa˘ive_node
->
d©a
;

849 
∑ª¡
 = 
chûd
->
f˛_∑ª¡
;

855 
	`f˛_ªmove_öa˘ive_li°
 ( 
∑ª¡
, 
chûd
 );

856 
	`Œ_ö£π_©_èû
 ( 
∑ª¡
->
f˛_≥ndög_li°
, 
chûd
 );

858 
	`f˛_ö£π_≥ndög_m™agî
 ( 
∑ª¡
 );

862 
öa˘ive_node
 = i«˘ive_node->
√xt
;

866 
	`Œ_ªÀa£
 ( 
öa˘ive_li°
 );

867 
	}
}

869 
	$f˛_ªmove_a˘ive_li°
 ( 
i‹eq_evít
 *
∑ª¡
 ) {

870 
Ãu_node
 *
 
;

872 
li°node
 *
a˘ive_node
;

873 
i‹eq_evít
 *
chûd
;

874 
a˘ive_∑ge_cou¡
 = 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 );

876 
li°node
 *
cuº_com∂ëe_li°
;

877 
li°node
 *
com∂ëe_node
;

878 
i
;

881 
	`Œ_¸óã
 ( &
cuº_com∂ëe_li°
 );

884 
a˘ive_node
 = ((
li°node
 *)
∑ª¡
->
f˛_a˘ive_li°
)->
√xt
;

885 
i
 = 0; i < 
a˘ive_∑ge_cou¡
; i++){

887 
	`ASSERT
 ( 
a˘ive_node
 !
NULL
 );

889 
chûd
 = (
i‹eq_evít
 *)
a˘ive_node
->
d©a
;

891 
	`Œ_ö£π_©_èû
 ( 
∑ª¡
->
f˛_com∂ëe_li°
, 
chûd
 );

892 
	`Œ_ö£π_©_èû
 ( 
cuº_com∂ëe_li°
, (*Ë
chûd
->
blkno
 );

894 
a˘ive_node
 =á˘ive_node->
√xt
;

897  
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 ) ) {

898 
	`Œ_ªÀa£_èû
 ( 
∑ª¡
->
f˛_a˘ive_li°
 );

902 
	`ASSERT
 ( 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 ) == 0 );

906 
com∂ëe_node
 = 
cuº_com∂ëe_li°
->
√xt
;

907 
i
 = 0; i < 
a˘ive_∑ge_cou¡
; i++){

908 
blkno
 = 0;

910 
	`ASSERT
 ( 
com∂ëe_node
 !
NULL
 );

912 
blkno
 = ()
com∂ëe_node
->
d©a
;

915 
 
 = 
	`CACHE_PRESEARCH
(
f˛_a˘ive_block_m™agî
, 
blkno
);

917 
	`ASSERT
 ( 
 
 !
NULL
 );

919 i‡–
 
 ) {

921 i‡–
	`Œ_gë_size
 ( (
li°node
 *)
 
->
˙_ãmp2
 )){

926 
	`f˛_move_≥ndög_li°
 ( 
 
->
˙_ãmp2
 );

927 
 
->
˙_ãmp2
 = 
NULL
;

931 
	`CACHE_REMOVE
 ( 
f˛_a˘ive_block_m™agî
, 
 
 );

933 
	`‰ì
 (
 
);

936 
com∂ëe_node
 = com∂ëe_node->
√xt
;

939 
	`Œ_ªÀa£
 ( 
cuº_com∂ëe_li°
 );

943 
	}
}

946 
	$f˛_ªmove_com∂ëe_li°
 ( 
i‹eq_evít
 *
∑ª¡
 ) {

948 
li°node
 *
com∂ëe_node
;

949 
i‹eq_evít
 *
chûd
;

951 
com∂ëe_∑ge_cou¡
 = 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_com∂ëe_li°
 );

952 
i
;

954 
com∂ëe_node
 = ((
li°node
 *)
∑ª¡
->
f˛_com∂ëe_li°
)->
√xt
;

956 
i
 = 0; i < 
com∂ëe_∑ge_cou¡
; i++){

958 
	`ASSERT
 ( 
com∂ëe_node
 !
NULL
 );

960 
chûd
 = (
i‹eq_evít
 *)
com∂ëe_node
->
d©a
;

961 
	`addt€xåaq
 ( (
evít
 *)
chûd
 );

962 
com∂ëe_node
 = com∂ëe_node->
√xt
;

965  
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_com∂ëe_li°
 ) ) {

966 
	`Œ_ªÀa£_èû
 ( 
∑ª¡
->
f˛_com∂ëe_li°
 );

969 
	`ASSERT
 ( 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_com∂ëe_li°
 ) == 0 );

971 
	}
}

974 
	$f˛_issue_≥ndög_chûd
 ( 
i‹eq_evít
 *
∑ª¡
 ) {

976 
li°node
 *
≥ndög_node
 = 
∑ª¡
->
f˛_≥ndög_li°
;

977 
i‹eq_evít
 *
chûd
;

979 
≥ndög_cou¡
 = 
	`Œ_gë_size
 ( 
≥ndög_node
 );

980 
i
;

982 
≥ndög_node
 =Öídög_node->
√xt
;

984  
i
 = 0; i < 
≥ndög_cou¡
 ; i++ ) {

985 
chûd
 = (
i‹eq_evít
 *)
≥ndög_node
->
d©a
;

987 
	`ASSERT
 ( 
∑ª¡
 =
chûd
->
f˛_∑ª¡
 );

988 
	`f˛_˛assify_chûd_ªque°
 ( 
∑ª¡
, 
chûd
, chûd->
blkno
 );

990 
≥ndög_node
 =Öídög_node->
√xt
;

993  
i
 = 0; i < 
≥ndög_cou¡
; i++ ) {

994 
	`Œ_ªÀa£_èû
 ( 
∑ª¡
->
f˛_≥ndög_li°
 );

997 
	`ASSERT
 ( 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_≥ndög_li°
 ) == 0 );

1002 
	}
}

1005 
	$f˛_issue_≥ndög_∑ª¡
 (){

1006 
li°node
 *
≥ndög_√xt
 = 
f˛_≥ndög_m™agî
->
√xt
;

1007 
li°node
 *
≥ndög_dñ
 = 
NULL
;

1008 
i‹eq_evít
 *
∑ª¡
;

1009 
≥ndög_cou¡
 = 
	`Œ_gë_size
 ( 
f˛_≥ndög_m™agî
 );

1010 
i
;

1012 
debug_cou¡
 = 0;

1014  
i
 = 0; i < 
≥ndög_cou¡
; i++ ) {

1015 
∑ª¡
 = 
≥ndög_√xt
->
d©a
;

1018 
≥ndög_dñ
 = 
≥ndög_√xt
;

1019 
≥ndög_√xt
 =Öídög_√xt->
√xt
;

1021 i‡–
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 ) == 0 &&

1022 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_öa˘ive_li°
 ) == 0 ) {

1024 
	`f˛_make_chûd_ªque°
 ( 
∑ª¡
 );

1026 i‡–
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 ) ) {

1027 
	`f˛_issue_√xt_chûd
 ( 
∑ª¡
 );

1030 
debug_cou¡
 ++;

1032 
	`Œ_ªÀa£_node
 ( 
f˛_≥ndög_m™agî
, 
≥ndög_dñ
 );

1036 i‡–
debug_cou¡
 ) {

1042 
	}
}

1045 
	$f˛_com∑ª_blkno
(c⁄° *
a
,c⁄° *
b
){

1046 if(((
i‹eq_evít
 *)
a
)->
blkno
 < ((i‹eq_evíà*)
b
)->blkno)

1048 if(((
i‹eq_evít
 *)
a
)->
blkno
 > ((i‹eq_evíà*)
b
)->blkno)

1051 
	}
}

1053 
i‹eq_evít
 *
	$f˛_¸óã_∑ª¡
 (
blkno
,
bcou¡
, 
time
, 
Êags
, 
devno
) {

1054 
i‹eq_evít
 * 
∑ª¡
;

1056 
∑ª¡
 = (
i‹eq_evít
 *Ë
	`i‹eq_c›y
 ( (i‹eq_evíà*Ë
io_extq
 );

1058 
∑ª¡
->
blkno
 = blkno;

1059 
∑ª¡
->
bcou¡
 = bcount;

1060 
∑ª¡
->
time
 =Åime;

1061 
∑ª¡
->
Êags
 = flags;

1062 
∑ª¡
->
devno
 = devno;

1065  
∑ª¡
;

1067 
	}
}

1069 
	$f˛_mîge_li°
 ( 
li°node
 *
dúty_li°
 ) {

1070 
li°node
 *
dúty_node
;

1071 
i
;

1072 
ªq_cou¡
 = 
	`Œ_gë_size
 ( 
dúty_li°
 );

1074 
dúty_node
 = 
dúty_li°
->
√xt
;

1076  
i
 = 0; i < 
ªq_cou¡
; i++ ) {

1077 
li°node
 *
dúty_√xt
;

1078 
i‹eq_evít
 *
ªq1
, *
ªq2
;

1080 
dúty_√xt
 = 
dúty_node
->
√xt
;

1081 
ªq1
 = 
dúty_node
->
d©a
;

1082 
ªq2
 = 
dúty_√xt
->
d©a
;

1084 i‡–
dúty_√xt
 !
dúty_li°
 &&

1085 
	`f˛_ªq_is_c⁄£cutive
 ( 
ªq1
, 
ªq2
)) {

1087 
ªq1
->
bcou¡
 +
ªq2
->bcount;

1088 
	`addt€xåaq
((
evít
 *Ë
ªq2
);

1089 
	`Œ_ªÀa£_node
 ( 
dúty_li°
, 
dúty_√xt
 );

1092 
dúty_node
 = dúty_node->
√xt
;

1098 
	}
}

1100 
	$f˛_°age_ªque°
 () {

1101 
i‹eq_evít
 *
∑ª¡
;

1102 
li°node
 *
°age_li°
;

1103 
li°node
 *
°age_node
;

1105 
i
;

1106 
ªq_cou¡
 = 0;

1108 
li°_cou¡
 = 
Êash_max_∑ges
;

1110 
	`Œ_¸óã
 ( &
°age_li°
 );

1112  
i
 = 0; i < 
li°_cou¡
; i++ ) {

1113 
blkno
 = 
i
 * 
FCL_PAGE_SIZE
;

1115 i‡–
	`CACHE_PRESEARCH
 ( 
f˛_ˇche_m™agî
, 
blkno
 ) =
NULL
 ) {

1116 
∑ª¡
 = 
	`f˛_¸óã_∑ª¡
 ( 
blkno
, 
FCL_PAGE_SIZE
, 
simtime
, 0, 0 );

1117 
∑ª¡
->
ãmpöt1
 = 
FCL_OPERATION_STAGING
;

1119 
	`Œ_ö£π_©_s‹t
 ( 
°age_li°
, (*Ë
∑ª¡
, 
f˛_com∑ª_blkno
 );

1120 
ªq_cou¡
++;

1123 i‡–
	`Œ_gë_size
 ( 
°age_li°
 ) >
MAX_STAGE
 )

1128 
	`f˛_mîge_li°
 ( 
°age_li°
 );

1130 
°age_node
 = 
°age_li°
->
√xt
;

1132  
i
 = 0; i < 
	`Œ_gë_size
 ( 
°age_li°
) ; i++ ) {

1134 
∑ª¡
 = 
°age_node
->
d©a
;

1135 
	`_f˛_ªque°_¨rive
 ( 
∑ª¡
, 
FCL_OPERATION_STAGING
 );

1137 
°age_node
 = sège_node->
√xt
;

1141 
	`Œ_ªÀa£
 ( 
°age_li°
 );

1142 
	}
}

1146 
	$f˛_de°age_ªque°
 () {

1147 
i‹eq_evít
 *
∑ª¡
;

1150 
li°_hód
 *
hód
 = &
f˛_ˇche_m™agî
->
cm_dúty_hód
;

1151 
li°_hód
 *
±r
;

1153 
li°node
 *
dúty_li°
;

1154 
li°node
 *
dúty_node
;

1156 
Ãu_node
 *
 
;

1157 
i
;

1158 
ªq_cou¡
 = 0;

1160 
dúty_cou¡
 = 
f˛_ˇche_m™agî
->
cm_dúty_cou¡
;

1162 i‡–
dúty_cou¡
 < 
MAX_DIRTY
 )

1167 
	`Œ_¸óã
 ( &
dúty_li°
 );

1169 
	`li°_f‹_óch_¥ev
–
±r
, 
hód
 ) {

1170 
 
 = (
Ãu_node
 *Ë
	`li°_íåy
 ( 
±r
, Ãu_node, 
˙_dúty_li°
);

1172 
	`ASSERT
 ( 
 
->
˙_dúty
 == 1 );

1174 i‡–
 
->
˙_dúty
 ) {

1175 
∑ª¡
 = 
	`f˛_¸óã_∑ª¡
 ( 
 
->
˙_blkno
, 
FCL_PAGE_SIZE
, 
simtime
, 0, 0 );

1176 
∑ª¡
->
ãmpöt1
 = 
FCL_OPERATION_DESTAGING
;

1180 
	`Œ_ö£π_©_s‹t
 ( 
dúty_li°
, (*Ë
∑ª¡
, 
f˛_com∑ª_blkno
 );

1181 
ªq_cou¡
++;

1184 i‡–
	`Œ_gë_size
 ( 
dúty_li°
 ) >
MAX_DIRTY
 )

1191 
	`f˛_mîge_li°
 ( 
dúty_li°
 );

1193 
dúty_node
 = 
dúty_li°
->
√xt
;

1195  
i
 = 0; i < 
	`Œ_gë_size
 ( 
dúty_li°
 ); i++ ) {

1197 
∑ª¡
 = 
dúty_node
->
d©a
;

1199 
	`_f˛_ªque°_¨rive
 ( 
∑ª¡
, 
FCL_OPERATION_DESTAGING
 );

1201 
dúty_node
 = dúty_node->
√xt
;

1204 
	`Œ_ªÀa£
 ( 
dúty_li°
 );

1206 
	}
}

1208 
	$f˛_timî_evít
 ( 
timî_evít
 *
timîeq
) {

1213 i‡–
	`ioqueue_gë_numbî_ö_queue
 ( 
f˛_globÆ_queue
 ) == 0 &&

1214 
	`ioqueue_gë_numbî_ö_queue
 ( 
f˛_background_queue
 ) == 0 )

1218 
	`f˛_de°age_ªque°
 ();

1221 
f˛_timî_func
 = 
NULL
;

1222 
	`addt€xåaq
 ( (
evít
 *Ë
timîeq
 );

1223 
	}
}

1225 
	$f˛_make_timî
 () {

1226 
timî_evít
 *
timîeq
 = (timî_evíà*)
	`gë‰omexåaq
();

1228 
f˛_timî_func
 = 
f˛_timî_evít
;

1230 
timîeq
->
func
 = &
f˛_timî_func
 ;

1231 
timîeq
->
ty≥
 = 
TIMER_EXPIRED
;

1232 
timîeq
->
time
 = 
simtime
 + (Ë
f˛_idÀ_time
;

1233 
timîeq
->
±r
 = 
NULL
;

1235 
	`addtoötq
 ( (
evít
 *Ë
timîeq
 );

1240 
	}
}

1242 
	$_f˛_ªque°_com∂ëe
 ( 
i‹eq_evít
 *
chûd
 ) {

1243 
i‹eq_evít
 *
∑ª¡
, *
ªq2
;

1244 
tŸÆ_ªq
 = 0;

1245 
i
;

1248 
∑ª¡
 = (
i‹eq_evít
 *)
chûd
->
f˛_∑ª¡
;

1250 
∑ª¡
->
f˛_evít_cou¡
[∑ª¡->
f˛_evít_±r
-1] -- ;

1253 i‡–
∑ª¡
->
f˛_evít_cou¡
[∑ª¡->
f˛_evít_±r
-1] == 0 &&

1254 
∑ª¡
->
f˛_evít_±r
 <Ö¨ít->
f˛_evít_num
 )

1258 
	`f˛_issue_√xt_chûd
 ( 
∑ª¡
 );

1261 
	`addt€xåaq
 ((
evít
 *Ë
chûd
);

1263  
i
 = 0; i < 
∑ª¡
->
f˛_evít_num
; i++) {

1264 
tŸÆ_ªq
 +
∑ª¡
->
f˛_evít_cou¡
[
i
];

1268 i‡–
tŸÆ_ªq
 == 0 ) {

1271 i‡–
∑ª¡
->
ãmpöt1
 =
FCL_OPERATION_NORMAL
 ||

1272 
∑ª¡
->
ãmpöt1
 =
FCL_OPERATION_STAGING
 ) {

1273 
	`f˛_£Æ_com∂ëe_ªque°
 ( 
∑ª¡
 );

1278 
	`f˛_ªmove_a˘ive_li°
 ( 
∑ª¡
 );

1284 
	`ASSERT
 ( 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 ) == 0 );

1289 i‡–
	`Œ_gë_size
 ( 
f˛_≥ndög_m™agî
 ) &&

1290 
	`ioqueue_gë_numbî_ö_queue
 ( 
f˛_background_queue
 ) == 0 ) {

1294 
	`f˛_issue_≥ndög_∑ª¡
 ();

1299 i‡–
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_com∂ëe_li°
 ) =∑ª¡->
bcou¡
/
FCL_PAGE_SIZE
 ){

1301 
	`ASSERT
 ( 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_a˘ive_li°
 ) == 0 &&

1302 
	`Œ_gë_size
 ( 
∑ª¡
->
f˛_öa˘ive_li°
 ) == 0 );

1304 
	`f˛_∑ª¡_ªÀa£
 ( 
∑ª¡
 );

1306 i‡–
∑ª¡
->
ãmpöt1
 =
FCL_OPERATION_NORMAL
 ) {

1307 
ªq2
 = 
	`ioqueue_physiˇl_ac˚ss_d⁄e
 (
f˛_globÆ_queue
, 
∑ª¡
);

1309 
ªq2
 = 
	`ioqueue_physiˇl_ac˚ss_d⁄e
 (
f˛_background_queue
, 
∑ª¡
);

1311 
	`ASSERT
 (
ªq2
 !
NULL
);

1315 
	`addt€xåaq
 ((
evít
 *Ë
∑ª¡
);

1318 i‡–
∑ª¡
->
ãmpöt1
 =
FCL_OPERATION_DESTAGING
 ) {

1319 
	`¥ötf
 ( " $ Reque° De°agög Com∂ëê%d, %‡\n", 
∑ª¡
->
blkno
, 
simtime
 );

1322 i‡–
∑ª¡
->
ãmpöt1
 =
FCL_OPERATION_STAGING
 ) {

1323 
	`¥ötf
 ( " $ Reque° Sègög Com∂ëê%d, %‡\n", 
∑ª¡
->
blkno
, 
simtime
 );

1326 i‡–
∑ª¡
->
ãmpöt1
 =
FCL_OPERATION_NORMAL
 ) {

1327 /
	`¥ötf
 ( " $ Reque° N‹mÆ Com∂ëê%d, %‡\n", 
∑ª¡
->
blkno
, 
simtime
 );

1332 
	`Ârötf
 ( 
°dout
, " ** %.2‡%.2‡(%.2fË Com∂ëê∑ª¡Ñeq ... %d %d %d \n", 
simtime
, 
∑ª¡
->
time
, simtimê-Ö¨ít->time,Ö¨ít->
blkno
,Ö¨ít->
bcou¡
,Ö¨ít->
Êags
);

1340 i‡–
	`ioqueue_gë_numbî_ö_queue
 ( 
f˛_globÆ_queue
 ) == 0 &&

1341 
	`ioqueue_gë_numbî_ö_queue
 ( 
f˛_background_queue
 ) == 0 &&

1342 
f˛_timî_func
 =
NULL
 &&

1343 
∑ª¡
->
ãmpöt1
 =
FCL_OPERATION_NORMAL
 )

1346 i‡–
	`ioqueue_gë_numbî_ö_queue
 ( 
f˛_globÆ_queue
 ) == 0 &&

1347 
	`ioqueue_gë_numbî_ö_queue
 ( 
f˛_background_queue
 ) == 0 &&

1348 
f˛_timî_func
 =
NULL
 &&

1349 !
	`„of
 ( 
disksim
->
iŸø˚fûe
) )

1352 
	`f˛_make_timî
 ();

1355 
	}
}

1356 
	$f˛_ªque°_com∂ëe
 (
i‹eq_evít
 *
chûd
){

1359 
	`¥ötf
 (" %.2f, %.2‡ Reque° Com∂ëê.. \n", 
simtime
, simtimê- 
chûd
->
time
);

1360 i‡–!
f˛_ˇche_by∑ss
 ) {

1361 
	`_f˛_ªque°_com∂ëe
 ( 
chûd
 );

1363 
	`addt€xåaq
 ( 
chûd
 );

1366 
	}
}

1369 
	$disksim_f˛_lﬂd∑øms
 ( 
Õ_block
 *
b
, *
num
) {

1371 
f˛_∑øms
 = 
	`mÆloc
 ( (
f˛_∑ømëîs
) );

1372 
	`mem£t
 ( 
f˛_∑øms
, 0x00, (
f˛_∑ømëîs
) );

1373 
	`Õ_lﬂd∑øms
 ( 
f˛_∑øms
, 
b
, &
disksim_f˛_mod
);

1376 
	}
}

1378 
	$f˛_¥öt_∑ømëîs
 () {

1379 
	`¥ötf
 ( "Öagêsizê%d se˘‹†\n", 
f˛_∑øms
->
Âa_∑ge_size
 );

1380 
	`¥ötf
 ( " maxÖage†%d, %.2‡MB \n", 
f˛_∑øms
->
Âa_max_∑ges
, () fcl_params->fpa_max_pages/256 );

1381 
	`¥ötf
 ( " by∑s†ˇchê%d \n", 
f˛_∑øms
->
Âa_by∑ss_ˇche
 );

1382 
	`¥ötf
 ( " idÀ dëe˘Åime%d m†\n", 
f˛_∑øms
->
Âa_idÀ_dëe˘_time
 );

1383 
	`¥ötf
 ( "\n");

1384 
	}
}

1387 
	$f˛_öô
 () {

1388 
Ãu_size
 = 50000;

1389 
ssd_t
 *
ssd
 = 
	`gëssd
 ( 
SSD
 );

1393 
	`f˛_¥öt_∑ømëîs
 () ;

1396 
	`Ârötf
 ( 
°dout
, " Flash Cache Layer is initializing ... \n");

1398 
Êash_max_∑ges
 = 
	`ssd_ñem_exp‹t_size2
 ( 
ssd
 );

1399 
Êash_max_£˘‹s
 = 
Êash_max_∑ges
 * 
FCL_PAGE_SIZE
;

1402 
Ãu_size
 = 
f˛_∑øms
->
Âa_max_∑ges
;

1404 
	`¥ötf
 (" FCL: Fœsh CachêUßbÀ Sizê%.2fGB \n", ()
Êash_max_∑ges
 / 256 / 1024);

1406 
hdd_max_∑ges
 = 
	`devi˚_gë_numbî_of_blocks
 (
HDD
)/
FCL_PAGE_SIZE
;

1407 
hdd_max_£˘‹s
 = 
hdd_max_∑ges
 * 
FCL_PAGE_SIZE
;

1412 
	`¥ötf
 (" FCL: H¨d Disk UßbÀ Sizê%.2fGB \n", ()
hdd_max_∑ges
 / 256 / 1024);

1414 
	`¥ötf
 (" FCL Ef„˘ivêCachêSizê%.2fMB \n", (Ë
Ãu_size
 / 256 );

1416 
	`Ãu_öô
 ( &
f˛_ˇche_m™agî
, "LRU", 
Ãu_size
,Üru_size, 1, 0);

1417 
	`Ãu_öô
 ( &
f˛_a˘ive_block_m™agî
, "AtiveBlockM™agî", 
Ãu_size
,Üru_size, 1, 0);

1419 
	`ªvî£_m≠_¸óã
 ( 
Ãu_size
+1 );

1423 
f˛_globÆ_queue
 = 
	`ioqueue_¸óãdeÁu…queue
();

1424 
	`ioqueue_öôülize
 (
f˛_globÆ_queue
, 0);

1426 
f˛_background_queue
 = 
	`ioqueue_¸óãdeÁu…queue
();

1427 
	`ioqueue_öôülize
 (
f˛_background_queue
, 0);

1430 
c⁄°öèºtime
 = 5.0;

1432 
	`Œ_¸óã
 ( &
f˛_≥ndög_m™agî
 );

1434 
	}
}

1436 
	$f˛_exô
 () {

1438 
	`Ârötf
 ( 
°dout
, " Flash Cache Layer is finalizing ... \n");

1440 
	`ªvî£_m≠_‰ì
();

1442 
	`CACHE_CLOSE
(
f˛_ˇche_m™agî
, 1);

1443 
	`CACHE_CLOSE
(
f˛_a˘ive_block_m™agî
, 0);

1445 
f˛_globÆ_queue
->
¥ötqueue°©s
 = 
TRUE
;

1446 
	`ioqueue_¥öt°©s
–&
f˛_globÆ_queue
, 1, " FCL Forground: ");

1447 
	`‰ì
 (
f˛_globÆ_queue
);

1449 
f˛_background_queue
->
¥ötqueue°©s
 = 
TRUE
;

1450 
	`ioqueue_¥öt°©s
–&
f˛_background_queue
, 1, " FCL Background: ");

1451 
	`‰ì
 (
f˛_background_queue
);

1453 
	`Œ_ªÀa£
 ( 
f˛_≥ndög_m™agî
 );

1456 
	`‰ì
 ( 
f˛_∑øms
 );

1458 
	}
}

1549 
	$f˛_ªque°_¨rive
 (
i‹eq_evít
 *
∑ª¡
){

1550 
i‹eq_evít
 *
chûd
 = 
NULL
;

1551 
i‹eq_evít
 *
ãmp
 = 
NULL
;

1553 
f˛_›id
 ++;

1554 
∑ª¡
->
›id
 = 
f˛_›id
;

1555 
∑ª¡
->
f˛_ªq_num
 = 1;

1557 
chûd
 = 
	`i‹eq_c›y
 (
∑ª¡
);

1559 
chûd
->
f˛_∑ª¡
 = 
∑ª¡
;

1560 
chûd
->
ty≥
 = 
IO_REQUEST_ARRIVE2
;

1561 
chûd
->
time
 = 
simtime
 + 0.0000;

1563 
	`ioqueue_add_√w_ªque°
 (
f˛_globÆ_queue
, 
∑ª¡
);

1564 
ãmp
 = 
	`ioqueue_gë_√xt_ªque°
 (
f˛_globÆ_queue
);

1566 
	`ASSERT
 ( 
ãmp
 =
∑ª¡
 );

1568 
	`addtoötq
((
evít
 *Ë
chûd
);

1574 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl.h

11 
	~"disksim_globÆ.h
"

12 
	~"disksim_f˛_ˇche.h
"

15 #i‚de‡
_DISKSIM_FCL_H


16 
	#_DISKSIM_FCL_H


	)

18 
	#FCL_PAGE_SIZE
 (
f˛_∑øms
->
Âa_∑ge_size
)

	)

20 
	#SSD
 1

	)

21 
	#HDD
 0

	)

23 
	#FCL_OPERATION_NORMAL
 1

	)

24 
	#FCL_OPERATION_DESTAGING
 2

	)

25 
	#FCL_OPERATION_STAGING
 3

	)

27 
	sf˛_∑ømëîs
 {

28 
	mÂa_∑ge_size
;

29 
	mÂa_max_∑ges
;

30 
	mÂa_by∑ss_ˇche
;

31 
	mÂa_idÀ_dëe˘_time
;

32 
	mÂa_ˇche_pﬁicy
;

33 
	mÂa_background_a˘ivôy
;

36 
f˛_ªque°_¨rive
 (
i‹eq_evít
 *);

37 
f˛_ªque°_com∂ëe
 (
i‹eq_evít
 *);

38 
f˛_öô
 () ;

39 
f˛_exô
 () ;

41 
f˛_ªmove_com∂ëe_li°
 ( 
i‹eq_evít
 *);

42 
f˛_make_°age_ªq
 (
i‹eq_evít
 *
∑ª¡
, 
blkno
);

43 
f˛_make_de°age_ªq
 (
i‹eq_evít
 *
∑ª¡
, 
blkno
);

44 
_f˛_make_de°age_ªq
 ( 
i‹eq_evít
 *
∑ª¡
, 
Ãu_node
 *
 
, 
li°_ödex
 ) ;

45 
_f˛_make_°age_ªq
 ( 
i‹eq_evít
 *
∑ª¡
, 
Ãu_node
 *
 
, 
li°_ödex
 ) ;

46 
f˛_issue_≥ndög_chûd
 ( 
i‹eq_evít
 *
∑ª¡
 ) ;

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_bgclock.c

1 
	~<°dio.h
>

2 
	~"ˇche.h
"

3 
	~"ssd_utûs.h
"

4 
	~"wow_drivî.h
"

9 
bg˛ock_evi˘_blocks
(
ˇche_m™agî
 *
c
, 
bgÃu_node
 *
bn
);

10 
bg˛ock_make_ªq
(
ˇche_m™agî
 *
c
, 
blkno
, 
is_ªad
,
døm_hô
,
gho°_hô
);

13 
	$bg˛ock_›í
(
ˇche_m™agî
 *
c
,
ˇche_size
, 
ˇche_max
){

14 
i
;

16 
	`Œ_¸óã
(&(
c
->
cm_hód
));

18 
c
->
cm_hash
 = (
li°node
 **)
	`mÆloc
(÷i°nodê*Ë* 
HASH_NUM
);

19 if(
c
->
cm_hash
 =
NULL
){

20 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

21 
	`exô
(1);

23 
i
 = 0;ò< 
HASH_NUM
;i++){

24 
	`Œ_¸óã
(&
c
->
cm_hash
[
i
]);

27 
	`Œ_¸óã
(&
c
->
cm_hddrq
);

28 
	`Œ_¸óã
(&
c
->
cm_hddwq
);

29 
	`Œ_¸óã
(&
c
->
cm_ssdrq
);

30 
	`Œ_¸óã
(&
c
->
cm_ssdwq
);

33 
c
->
cm_de°age_±r
 = c->
cm_hód
;

34 
c
->
cm_ªf
 = 0;

35 
c
->
cm_hô
 = 0;

36 
c
->
cm_miss
 = 0;

37 
c
->
cm_size
 = 
ˇche_size
;

38 
c
->
cm_‰ì
 = 
ˇche_size
;

39 
c
->
cm_cou¡
 = 0;

40 
c
->
cm_max
 = 
ˇche_max
;

42 
	}
}

44 
	$bg˛ock_˛o£
(
ˇche_m™agî
 *
c
){

45 
li°node
 *
node
 = 
c
->
cm_hód
->
√xt
;

46 
bgÃu_node
 *
bn
;

47 
i
;

51 
node
 !
c
->
cm_hód
 &&Çode){

52 
bn
 = (
bgÃu_node
 *)
node
->
d©a
;

54 
	`bg˛ock_evi˘_blocks
(
c
, (
bgÃu_node
 *)
bn
);

56 
	`‰ì
(
bn
);

59 
c
->
cm_groupcou¡
--;

60 
node
 =Çode->
√xt
;

62 if(
c
->
cm_groupcou¡
 != 0){

63 
	`Ârötf
(
°dîr
, " check ... \n");

65 
	`Œ_ªÀa£
(
c
->
cm_hód
);

67 
i
 = 0;ò< 
HASH_NUM
;i++){

68 
	`Œ_ªÀa£
(
c
->
cm_hash
[
i
]);

71 
	}
}

72 
	$com∑ª_hdd3
(c⁄° *
a
,c⁄° *
b
){

73 if(((
bgÃu_node
 *)
a
)->
bg_no
 > ((bgÃu_nodê*)
b
)->bg_no)

75 if(((
bgÃu_node
 *)
a
)->
bg_no
 < ((bgÃu_nodê*)
b
)->bg_no)

78 
	}
}

81 
	$com∑ª_hdd
(c⁄° *
a
,c⁄° *
b
){

82 if(((
Ãu_node
 *)
a
)->
˙_blkno
 > ((Ãu_nodê*)
b
)->cn_blkno)

84 if(((
Ãu_node
 *)
a
)->
˙_blkno
 < ((Ãu_nodê*)
b
)->cn_blkno)

87 
	}
}

89 
	$com∑ª_hdd2
(c⁄° *
a
,c⁄° *
b
){

90 if(((
Ãu_node
 *)
a
)->
˙_blkno
 =()
b
)

94 
	}
}

97 
	$bg˛ock_com∑ª_gno
(c⁄° *
a
,c⁄° *
b
){

98 if(()(((
bgÃu_node
 *)
a
)->
bg_no
Ë=()
b
)

101 
	}
}

106 
li°node
 *
	$bg˛ock_¥e£¨ch
(
ˇche_m™agî
 *
c
, 
blkno
){

107 
bgÃu_node
 *
bn
 = 
NULL
;

108 
Ãu_node
 *
 
 = 
NULL
;

109 
li°node
 *
gnode
, *
node
;

110 
grou≤o
 = 
blkno
/
GRP2BLK
;

111 
group_Æloc
 = 0, 
node_Æloc
 = 0;

115 
gnode
 = 
	`CACHE_SEARCH
(
c
, 
blkno
);

116 if(
gnode
){

117 
bn
 = (
bgÃu_node
 *)
gnode
->
d©a
;

123 
node
 = 
	`Œ_föd_node
(
bn
->
bg_block_hash
[
blkno
%
BG_HASH_NUM
], (*)blkno, 
com∑ª_hdd2
);

124 if(
node
){

127 
node_Æloc
 = 0;

128 
group_Æloc
 = 0;

130 
 
 = (
Ãu_node
 *)
node
->
d©a
;

131  (
li°node
 *)
 
;

134 
node_Æloc
 = 1;

138 
group_Æloc
 = 1;

139 
node_Æloc
 = 1;

142  
NULL
;

143 
	}
}

145 
li°node
 *
	$bg˛ock_£¨ch
(
ˇche_m™agî
 *
c
, 
blkno
){

146 
li°node
 *
gnode
;

147 
li°node
 *
hód
;

148 
grou≤o
 = 
blkno
/
GRP2BLK
;

150 
hód
 = 
c
->
cm_hash
[
grou≤o
%
HASH_NUM
];

151 
gnode
 = 
	`Œ_föd_node
(
hód
,(*)
grou≤o
, 
bg˛ock_com∑ª_gno
);

152 if(
gnode
){

153  
gnode
;

156  
NULL
;

157 
	}
}

161 *
	$bg˛ock_ªmove
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªmove_±r
){

162 
bgÃu_node
 *
bn
;

163 
li°node
 *
vi˘im
;

165 
bn
 = (
bgÃu_node
 *)
ªmove_±r
->
d©a
;

168 
	`Œ_ªÀa£_node
(
c
->
cm_hód
, 
bn
->
bg_node
);

171 
	`Œ_ªÀa£_node
(
c
->
cm_hash
[
bn
->
bg_no
%
HASH_NUM
], bn->
bg_hash
);

178 
c
->
cm_groupcou¡
--;

180 
bn
->
bg_node
 = 
NULL
;

181 
bn
->
bg_hash
 = 
NULL
;

183  (*)
bn
;

185 
	}
}

188 *
	$bg˛ock_Æloc
(
bgÃu_node
 *
bn
, 
grou≤o
){

189 
i
;

191 if(
bn
 =
NULL
){

192 
bn
 = (
bgÃu_node
 *)
	`mÆloc
((bglru_node));

193 if(
bn
 =
NULL
){

194 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

195 
	`exô
(1);

197 
	`mem£t
(
bn
, 0x00, (
bgÃu_node
));

200 
bn
->
bg_no
 = 
grou≤o
;

201 
bn
->
bg_ª˚ncy
 = 0;

203 
	`Œ_¸óã
(&
bn
->
bg_block_li°
);

205 
i
 = 0;ò<
BG_HASH_NUM
;i++){

206 
	`Œ_¸óã
(&
bn
->
bg_block_hash
[
i
]);

209  
bn
;

210 
	}
}

214 
Ãu_node
 *
	$bg˛ock_ö£π_block_to_group
(
ˇche_m™agî
 *
c
, 
bgÃu_node
 *
bn
,
blk
, 
Ãu_node
 *
 
){

217 if(
 
 =
NULL
){

218 
 
 = (
Ãu_node
 *)
	`Ãu_Æloc
(
NULL
, 
blk
);

219 
 
->
˙_ssd_blk
 = 
	`ªvî£_m≠_Æloc_blk
(
blk
);

222 
 
->
˙_node
 = 
	`Œ_ö£π_©_èû
(
bn
->
bg_block_li°
,Ün);

223 
bn
->
block_cou¡
++;

224 
 
->
˙_hash
 = 
	`Œ_ö£π_©_hód
(
bn
->
bg_block_hash
[
blk
%
BG_HASH_NUM
],Ün);

226 
c
->
cm_‰ì
--;

227 
c
->
cm_cou¡
++;

229  
 
;

230 
	}
}

232 
	$bg˛ock_ö£π
(
ˇche_m™agî
 *
c
,
bgÃu_node
 *
bn
){

235 
bn
->
bg_node
 = (
li°node
 *)
	`Œ_ö£π_©_s‹t
(
c
->
cm_hód
,(*)bn, 
com∑ª_hdd3
);

237 
c
->
cm_groupcou¡
++;

240 
bn
->
bg_hash
 = (
li°node
 *)
	`Œ_ö£π_©_hód
(
c
->
cm_hash
[(bn->
bg_no
)%
HASH_NUM
],(*)bn);

242 
	}
}

244 
ˇche_m™agî
 *
døm_ˇche
;

246 
	$bg˛ock_evi˘_blocks
(
ˇche_m™agî
 *
c
, 
bgÃu_node
 *
bn
){

247 
Ãu_node
 *
 
;

248 
li°node
 *
node
;

249 
i
;

251 
node
 = 
bn
->
bg_block_li°
->
¥ev
;

253 
bn
->
block_cou¡
){

254 
 
 = (
Ãu_node
 *)
node
->
d©a
;

256 if(
 
->
˙_dúty
){

257 
	`CACHE_MAKERQ
(
c
, c->
cm_ssdrq
, 
NULL
, 
 
->
˙_ssd_blk
);

258 
	`CACHE_MAKERQ
(
c
, c->
cm_hddwq
, 
NULL
, 
	`ªvî£_gë_blk
(
 
->
˙_ssd_blk
));

259 
	`£¨ch_døm_ˇche
(
døm_ˇche
, 
	`ªvî£_gë_blk
(
 
->
˙_ssd_blk
), 
WRITE
);

260 
c
->
cm_de°age_cou¡
++;

262 
	`ssd_åim_comm™d
(
SSD
, 
 
->
˙_ssd_blk
 * 
BLOCK2SECTOR
);

265 
	`ªvî£_m≠_ªÀa£_blk
(
 
->
˙_ssd_blk
);

267 
	`‰ì
(
 
);

269 
bn
->
block_cou¡
--;

270 
c
->
cm_‰ì
++;

271 
c
->
cm_cou¡
--;

272 
	`NODE_PREV
(
node
);

276 
	`Œ_ªÀa£
(
bn
->
bg_block_li°
);

278 
i
 = 0;ò< 
BG_HASH_NUM
;i++){

279 
	`Œ_ªÀa£
(
bn
->
bg_block_hash
[
i
]);

282 
	}
}

283 
li°node
 *
	$bg˛ock_£À˘_vi˘im
(
ˇche_m™agî
 *
c
, 
li°node
 *
de°age_±r
){

284 
bgÃu_node
 *
bn
;

288 if(
de°age_±r
 =
c
->
cm_hód
)

289 
de°age_±r
 = de°age_±r->
¥ev
;

291 
bn
 = (
bgÃu_node
 *)(
de°age_±r
->
d©a
);

292 if(!
bn
->
bg_ª˚ncy
){

295 
bn
->
bg_ª˚ncy
 = 0;

296 
de°age_±r
 = de°age_±r->
¥ev
;

299  
de°age_±r
;

300 
	}
}

303 
li°node
 *
	$bg˛ock_ª∂a˚
(
ˇche_m™agî
 *
c
, 
w©îm¨k
){

304 
li°node
 *
de°age_±r
;

305 
li°node
 *
ªmove_±r
;

306 
bgÃu_node
 *
vi˘im
 = 
NULL
;

308 if(
c
->
cm_‰ì
 < 
w©îm¨k
 + 1){

309 
de°age_±r
 = 
c
->
cm_de°age_±r
;

310 
de°age_±r
 = 
	`bg˛ock_£À˘_vi˘im
(
c
, destage_ptr);

312 
ªmove_±r
 = 
de°age_±r
;

313 
c
->
cm_de°age_±r
 = 
de°age_±r
->
¥ev
;

315 
vi˘im
 = 
	`CACHE_REMOVE
(
c
, 
ªmove_±r
);

316 
	`bg˛ock_evi˘_blocks
(
c
, (
bgÃu_node
 *)
vi˘im
);

318 
	`‰ì
(
vi˘im
);

319 
vi˘im
 = 
NULL
;

322  (
li°node
 *)
vi˘im
;

323 
	}
}

326 
	$bg˛ock_öc
(
ˇche_m™agî
 *
c
, 
öc_vÆ
){

328 if((
c
->
cm_size
+
öc_vÆ
Ë< (c->
cm_max
)){

329 
c
->
cm_size
+=
öc_vÆ
;

330 
c
->
cm_‰ì
+=
öc_vÆ
;

331  
öc_vÆ
;

335 
	}
}

337 
	$bg˛ock_dec
(
ˇche_m™agî
 *
c
, 
dec_vÆ
){

338 if((
c
->
cm_size
-
dec_vÆ
) > 0){

339 
c
->
cm_size
-=
dec_vÆ
;

340 
c
->
cm_‰ì
-=
dec_vÆ
;

341  
dec_vÆ
;

348 
	}
}

349 
	$bg˛ock_make_ªqli°
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªq_li°
, 
Rb_node
 *
rbåì
, 
blk
){

351 
	`Œ_ö£π_©_èû
(
ªq_li°
, (*)
blk
);

354 
	}
}

355 
	$bg˛ock_ªÀa£_ªqli°
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªq_li°
){

357 
	`Œ_gë_size
(
ªq_li°
)){

358 
	`Œ_ªÀa£_èû
(
ªq_li°
);

360 
	}
}

363 
	$bg˛ock_öô
(
ˇche_m™agî
 **
c
,*
«me
, 
size
,
max_sz
, 
high
, 
low
){

364 *
c
 = (
ˇche_m™agî
 *)
	`mÆloc
((cache_manager));

365 if(*
c
 =
NULL
){

366 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

367 
	`exô
(1);

369 
	`mem£t
(*
c
, 0x00, (
ˇche_m™agî
));

371 (*
c
)->
ˇche_›í
 = 
bg˛ock_›í
;

372 (*
c
)->
ˇche_˛o£
 = 
bg˛ock_˛o£
;

373 (*
c
)->
ˇche_¥e£¨ch
 = 
bg˛ock_¥e£¨ch
;

374 (*
c
)->
ˇche_£¨ch
 = 
bg˛ock_£¨ch
;

375 (*
c
)->
ˇche_ª∂a˚
 = 
bg˛ock_ª∂a˚
;

376 (*
c
)->
ˇche_ªmove
 = 
bg˛ock_ªmove
;

377 (*
c
)->
ˇche_ö£π
 = 
bg˛ock_ö£π
;

378 (*
c
)->
ˇche_öc
 = 
bg˛ock_öc
;

379 (*
c
)->
ˇche_dec
 = 
bg˛ock_dec
;

380 (*
c
)->
ˇche_Æloc
 = 
bg˛ock_Æloc
;

381 (*
c
)->
ˇche_makîq
 = 
bg˛ock_make_ªqli°
;

382 (*
c
)->
ˇche_ªÀa£rq
 = 
bg˛ock_ªÀa£_ªqli°
;

384 
	`CACHE_OPEN
((*
c
), 
size
, 
max_sz
);

386 (*
c
)->
cm_«me
 = (*)
	`mÆloc
(
	`°æí
(
«me
)+1);

387 
	`°r˝y
((*
c
)->
cm_«me
, 
«me
);

390 (*
c
)->
cm_highw©î
 = 
high
;

391 (*
c
)->
cm_loww©î
 = 
low
;

392 
	}
}

396 
	$bg˛ock_make_ªq
(
ˇche_m™agî
 *
c
, 
blkno
, 
is_ªad
,
døm_hô
,
£q_io
){

397 
bgÃu_node
 *
bn
 = 
NULL
;

398 
Ãu_node
 *
 
 = 
NULL
;

399 
li°node
 *
gnode
 = 
NULL
, *
node
 = NULL;

400 
grou≤o
 = 
blkno
/
GRP2BLK
;

401 
group_Æloc
 = 0, 
node_Æloc
 = 0;

403 
c
->
cm_ªf
++;

405 
gnode
 = 
	`CACHE_SEARCH
(
c
, 
blkno
);

406 if(
gnode
){

407 
bn
 = (
bgÃu_node
 *)
gnode
->
d©a
;

410 
bn
->
bg_ª˚ncy
 = 1;

412 
node
 = 
	`Œ_föd_node
(
bn
->
bg_block_hash
[
blkno
%
BG_HASH_NUM
], (*)blkno, 
com∑ª_hdd2
);

413 if(
node
){

415 
c
->
cm_hô
++;

416 
node_Æloc
 = 0;

417 
group_Æloc
 = 0;

419 
 
 = (
Ãu_node
 *)
node
->
d©a
;

422 
node_Æloc
 = 1;

426 
group_Æloc
 = 1;

427 
node_Æloc
 = 1;

430 if(
£q_io
){

431 if(
node
){

435 
	`Œ_ªÀa£_node
(
bn
->
bg_block_hash
[
blkno
%
BG_HASH_NUM
], 
 
->
˙_hash
);

436 
	`Œ_ªÀa£_node
(
bn
->
bg_block_li°
, 
 
->
˙_node
);

438 
	`ssd_åim_comm™d
(
SSD
, 
 
->
˙_ssd_blk
 * 
BLOCK2SECTOR
);

439 
	`ªvî£_m≠_ªÀa£_blk
(
 
->
˙_ssd_blk
);

440 
	`‰ì
(
 
);

442 
bn
->
block_cou¡
--;

443 
c
->
cm_‰ì
++;

444 
c
->
cm_cou¡
--;

447 if(
is_ªad
){

448 
	`CACHE_MAKERQ
(
c
, c->
cm_hddrq
, 
NULL
, 
blkno
);

450 
	`CACHE_MAKERQ
(
c
, c->
cm_hddwq
, 
NULL
, 
blkno
);

456 if(
node_Æloc
){

458 if(
c
->
cm_‰ì
 <c->
cm_loww©î
){

459 if(
is_ªad
 && 
c
->
cm_pﬁicy
 =
CACHE_BGCLOCK_RW
){

460 
	`Ãu_°age
(
c
);

461 
	`Ãu_ssd_ªad
(
c
, 
SSD
, 
READ
, c->
cm_ssdrq
, 0);

464 
c
->
cm_‰ì
 < c->
cm_highw©î
){

465 
	`CACHE_REPLACE
(
c
, c->
cm_highw©î
);

468 if(
is_ªad
 && 
c
->
cm_pﬁicy
 =
CACHE_BGCLOCK_RW
){

469 
	`Ãu_de°age
(
c
);

474 if(
group_Æloc
){

476 
bn
 = 
	`CACHE_ALLOC
(
c
, 
NULL
, 
grou≤o
);

477 
	`CACHE_INSERT
(
c
, 
bn
);

480 
 
 = 
	`bg˛ock_ö£π_block_to_group
(
c
, 
bn
, 
blkno
, 
NULL
);

483 if(
is_ªad
){

484 
	`CACHE_MAKERQ
(
c
, c->
cm_hddrq
, 
NULL
, 
blkno
);

485 
	`CACHE_MAKERQ
(
c
, c->
cm_ssdwq
, 
NULL
, 
 
->
˙_ssd_blk
);

486 
c
->
cm_°age_cou¡
++;

490 if(!
is_ªad
){

491 
	`CACHE_MAKERQ
(
c
, c->
cm_ssdwq
, 
NULL
, 
 
->
˙_ssd_blk
);

492 
 
->
˙_dúty
 = 1;

494 if(!
døm_hô
)

495 
	`CACHE_MAKERQ
(
c
, c->
cm_ssdrq
, 
NULL
, 
 
->
˙_ssd_blk
);

499 
	}
}

500 
	$bg˛ock_maö
(){

501 
ˇche_m™agî
 *
bgÃu_m™agî
;

502 
blkno
 = 
	`RND
(700000);

503 
i
;

506 
	`bg˛ock_öô
(&
bgÃu_m™agî
,"BGCLOCK", 50000, 50000, 1024, 0);

508 
i
 =0;i < 1000000;i++){

509 
blkno
 = 
	`RND
(700000);

511 
	`bg˛ock_make_ªq
(
bgÃu_m™agî
, 
blkno
, 
READ
, 0, 1);

514 
	`CACHE_CLOSE
(
bgÃu_m™agî
);

517 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_bglru.c

1 
	~<°dio.h
>

2 
	~"ˇche.h
"

3 
	~"ssd_utûs.h
"

4 
	~"wow_drivî.h
"

9 
bgÃu_evi˘_blocks
(
ˇche_m™agî
 *
c
, 
bgÃu_node
 *
bn
);

12 
	$bgÃu_›í
(
ˇche_m™agî
 *
c
,
ˇche_size
, 
ˇche_max
){

13 
i
;

15 
	`Œ_¸óã
(&(
c
->
cm_hód
));

17 
c
->
cm_hash
 = (
li°node
 **)
	`mÆloc
(÷i°nodê*Ë* 
HASH_NUM
);

18 if(
c
->
cm_hash
 =
NULL
){

19 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

20 
	`exô
(1);

22 
i
 = 0;ò< 
HASH_NUM
;i++){

23 
	`Œ_¸óã
(&
c
->
cm_hash
[
i
]);

26 
	`Œ_¸óã
(&
c
->
cm_hddrq
);

27 
	`Œ_¸óã
(&
c
->
cm_hddwq
);

28 
	`Œ_¸óã
(&
c
->
cm_ssdrq
);

29 
	`Œ_¸óã
(&
c
->
cm_ssdwq
);

32 
c
->
cm_de°age_±r
 = c->
cm_hód
;

33 
c
->
cm_ªf
 = 0;

34 
c
->
cm_hô
 = 0;

35 
c
->
cm_miss
 = 0;

36 
c
->
cm_size
 = 
ˇche_size
;

37 
c
->
cm_‰ì
 = 
ˇche_size
;

38 
c
->
cm_cou¡
 = 0;

39 
c
->
cm_max
 = 
ˇche_max
;

41 
	}
}

43 
	$bgÃu_˛o£
(
ˇche_m™agî
 *
c
){

44 
li°node
 *
node
 = 
c
->
cm_hód
->
√xt
;

45 
bgÃu_node
 *
bn
;

46 
i
;

50 
node
 !
c
->
cm_hód
 &&Çode){

51 
bn
 = (
bgÃu_node
 *)
node
->
d©a
;

53 
	`bgÃu_evi˘_blocks
(
c
, (
bgÃu_node
 *)
bn
);

55 
	`‰ì
(
bn
);

58 
c
->
cm_groupcou¡
--;

59 
node
 =Çode->
√xt
;

61 if(
c
->
cm_groupcou¡
 != 0){

62 
	`Ârötf
(
°dîr
, " check ... \n");

64 
	`Œ_ªÀa£
(
c
->
cm_hód
);

66 
i
 = 0;ò< 
HASH_NUM
;i++){

67 
	`Œ_ªÀa£
(
c
->
cm_hash
[
i
]);

70 
	}
}

72 
	$com∑ª_hdd
(c⁄° *
a
,c⁄° *
b
){

73 if(((
Ãu_node
 *)
a
)->
˙_blkno
 > ((Ãu_nodê*)
b
)->cn_blkno)

75 if(((
Ãu_node
 *)
a
)->
˙_blkno
 < ((Ãu_nodê*)
b
)->cn_blkno)

78 
	}
}

80 
	$com∑ª_hdd2
(c⁄° *
a
,c⁄° *
b
){

81 if(((
Ãu_node
 *)
a
)->
˙_blkno
 =()
b
)

85 
	}
}

88 
	$bgÃu_com∑ª_gno
(c⁄° *
a
,c⁄° *
b
){

89 if(()(((
bgÃu_node
 *)
a
)->
bg_no
Ë=()
b
)

92 
	}
}

97 
li°node
 *
	$bgÃu_¥e£¨ch
(
ˇche_m™agî
 *
c
, 
blkno
){

98 
bgÃu_node
 *
bn
 = 
NULL
;

99 
Ãu_node
 *
 
 = 
NULL
;

100 
li°node
 *
gnode
, *
node
;

101 
grou≤o
 = 
blkno
/
GRP2BLK
;

102 
group_Æloc
 = 0, 
node_Æloc
 = 0;

106 
gnode
 = 
	`CACHE_SEARCH
(
c
, 
blkno
);

107 if(
gnode
){

108 
bn
 = (
bgÃu_node
 *)
gnode
->
d©a
;

114 
node
 = 
	`Œ_föd_node
(
bn
->
bg_block_hash
[
blkno
%
BG_HASH_NUM
], (*)blkno, 
com∑ª_hdd2
);

115 if(
node
){

118 
node_Æloc
 = 0;

119 
group_Æloc
 = 0;

121 
 
 = (
Ãu_node
 *)
node
->
d©a
;

122  (
li°node
 *)
 
;

125 
node_Æloc
 = 1;

129 
group_Æloc
 = 1;

130 
node_Æloc
 = 1;

133  
NULL
;

134 
	}
}

136 
li°node
 *
	$bgÃu_£¨ch
(
ˇche_m™agî
 *
c
, 
blkno
){

137 
li°node
 *
gnode
;

138 
li°node
 *
hód
;

139 
grou≤o
 = 
blkno
/
GRP2BLK
;

141 
hód
 = 
c
->
cm_hash
[
grou≤o
%
HASH_NUM
];

142 
gnode
 = 
	`Œ_föd_node
(
hód
,(*)
grou≤o
, 
bgÃu_com∑ª_gno
);

143 if(
gnode
){

144  
gnode
;

147  
NULL
;

148 
	}
}

152 *
	$bgÃu_ªmove
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªmove_±r
){

153 
bgÃu_node
 *
bn
;

154 
li°node
 *
vi˘im
;

156 
bn
 = (
bgÃu_node
 *)
ªmove_±r
->
d©a
;

159 
	`Œ_ªÀa£_node
(
c
->
cm_hód
, 
bn
->
bg_node
);

162 
	`Œ_ªÀa£_node
(
c
->
cm_hash
[
bn
->
bg_no
%
HASH_NUM
], bn->
bg_hash
);

169 
c
->
cm_groupcou¡
--;

171 
bn
->
bg_node
 = 
NULL
;

172 
bn
->
bg_hash
 = 
NULL
;

174  (*)
bn
;

176 
	}
}

179 *
	$bgÃu_Æloc
(
bgÃu_node
 *
bn
, 
grou≤o
){

180 
i
;

182 if(
bn
 =
NULL
){

183 
bn
 = (
bgÃu_node
 *)
	`mÆloc
((bglru_node));

184 if(
bn
 =
NULL
){

185 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

186 
	`exô
(1);

188 
	`mem£t
(
bn
, 0x00, (
bgÃu_node
));

191 
bn
->
bg_no
 = 
grou≤o
;

194 
	`Œ_¸óã
(&
bn
->
bg_block_li°
);

196 
i
 = 0;ò<
BG_HASH_NUM
;i++){

197 
	`Œ_¸óã
(&
bn
->
bg_block_hash
[
i
]);

200  
bn
;

201 
	}
}

205 
Ãu_node
 *
	$bgÃu_ö£π_block_to_group
(
ˇche_m™agî
 *
c
, 
bgÃu_node
 *
bn
,
blk
, 
Ãu_node
 *
 
){

208 if(
 
 =
NULL
){

209 
 
 = (
Ãu_node
 *)
	`Ãu_Æloc
(
NULL
, 
blk
);

210 
 
->
˙_ssd_blk
 = 
	`ªvî£_m≠_Æloc_blk
(
blk
);

213 
 
->
˙_node
 = 
	`Œ_ö£π_©_s‹t
(
bn
->
bg_block_li°
,Ün, 
com∑ª_hdd
);

214 
bn
->
block_cou¡
++;

215 
 
->
˙_hash
 = 
	`Œ_ö£π_©_èû
(
bn
->
bg_block_hash
[
blk
%
BG_HASH_NUM
],Ün);

217 
c
->
cm_‰ì
--;

218 
c
->
cm_cou¡
++;

220  
 
;

221 
	}
}

223 
	$bgÃu_ö£π
(
ˇche_m™agî
 *
c
,
bgÃu_node
 *
bn
){

226 
bn
->
bg_node
 = (
li°node
 *)
	`Œ_ö£π_©_√xt
(
c
->
cm_hód
, c->
cm_de°age_±r
,(*)bn);

228 
c
->
cm_groupcou¡
++;

231 
bn
->
bg_hash
 = (
li°node
 *)
	`Œ_ö£π_©_hód
(
c
->
cm_hash
[(bn->
bg_no
)%
HASH_NUM
],(*)bn);

233 
	}
}

237 
	$bgÃu_evi˘_blocks
(
ˇche_m™agî
 *
c
, 
bgÃu_node
 *
bn
){

238 
Ãu_node
 *
 
;

239 
li°node
 *
node
;

240 
i
;

242 
node
 = 
bn
->
bg_block_li°
->
¥ev
;

244 
bn
->
block_cou¡
){

245 
 
 = (
Ãu_node
 *)
node
->
d©a
;

247 if(
 
->
˙_dúty
){

248 
	`CACHE_MAKERQ
(
c
, c->
cm_ssdrq
, 
NULL
, 
 
->
˙_ssd_blk
);

249 
	`CACHE_MAKERQ
(
c
, c->
cm_hddwq
, 
NULL
, 
	`ªvî£_gë_blk
(
 
->
˙_ssd_blk
));

250 
c
->
cm_de°age_cou¡
++;

252 
	`ªvî£_m≠_ªÀa£_blk
(
 
->
˙_ssd_blk
);

254 
	`‰ì
(
 
);

256 
bn
->
block_cou¡
--;

257 
c
->
cm_‰ì
++;

258 
c
->
cm_cou¡
--;

259 
	`NODE_PREV
(
node
);

263 
	`Œ_ªÀa£
(
bn
->
bg_block_li°
);

265 
i
 = 0;ò< 
BG_HASH_NUM
;i++){

266 
	`Œ_ªÀa£
(
bn
->
bg_block_hash
[
i
]);

269 
	}
}

272 
li°node
 *
	$bgÃu_ª∂a˚
(
ˇche_m™agî
 *
c
, 
w©îm¨k
){

273 
li°node
 *
de°age_±r
;

274 
li°node
 *
ªmove_±r
;

275 
bgÃu_node
 *
vi˘im
 = 
NULL
;

277 if(
c
->
cm_‰ì
 < 
w©îm¨k
 + 1){

278 
ªmove_±r
 = 
c
->
cm_hód
->
¥ev
;

279 
c
->
cm_de°age_±r
 = c->
cm_hód
;

280 
vi˘im
 = 
	`CACHE_REMOVE
(
c
, 
ªmove_±r
);

281 
	`bgÃu_evi˘_blocks
(
c
, (
bgÃu_node
 *)
vi˘im
);

283 
	`‰ì
(
vi˘im
);

284 
vi˘im
 = 
NULL
;

287  (
li°node
 *)
vi˘im
;

288 
	}
}

291 
	$bgÃu_öc
(
ˇche_m™agî
 *
c
, 
öc_vÆ
){

293 if((
c
->
cm_size
+
öc_vÆ
Ë< (c->
cm_max
)){

294 
c
->
cm_size
+=
öc_vÆ
;

295 
c
->
cm_‰ì
+=
öc_vÆ
;

296  
öc_vÆ
;

300 
	}
}

302 
	$bgÃu_dec
(
ˇche_m™agî
 *
c
, 
dec_vÆ
){

303 if((
c
->
cm_size
-
dec_vÆ
) > 0){

304 
c
->
cm_size
-=
dec_vÆ
;

305 
c
->
cm_‰ì
-=
dec_vÆ
;

306  
dec_vÆ
;

313 
	}
}

314 
	$bgÃu_make_ªqli°
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªq_li°
, 
Rb_node
 *
rbåì
, 
blk
){

316 
	`Œ_ö£π_©_èû
(
ªq_li°
, (*)
blk
);

319 
	}
}

320 
	$bgÃu_ªÀa£_ªqli°
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªq_li°
){

322 
	`Œ_gë_size
(
ªq_li°
)){

323 
	`Œ_ªÀa£_èû
(
ªq_li°
);

325 
	}
}

328 
	$bgÃu_öô
(
ˇche_m™agî
 **
c
,*
«me
, 
size
,
max_sz
, 
high
, 
low
){

329 *
c
 = (
ˇche_m™agî
 *)
	`mÆloc
((cache_manager));

330 if(*
c
 =
NULL
){

331 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

332 
	`exô
(1);

334 
	`mem£t
(*
c
, 0x00, (
ˇche_m™agî
));

336 (*
c
)->
ˇche_›í
 = 
bgÃu_›í
;

337 (*
c
)->
ˇche_˛o£
 = 
bgÃu_˛o£
;

338 (*
c
)->
ˇche_¥e£¨ch
 = 
bgÃu_¥e£¨ch
;

339 (*
c
)->
ˇche_£¨ch
 = 
bgÃu_£¨ch
;

340 (*
c
)->
ˇche_ª∂a˚
 = 
bgÃu_ª∂a˚
;

341 (*
c
)->
ˇche_ªmove
 = 
bgÃu_ªmove
;

342 (*
c
)->
ˇche_ö£π
 = 
bgÃu_ö£π
;

343 (*
c
)->
ˇche_öc
 = 
bgÃu_öc
;

344 (*
c
)->
ˇche_dec
 = 
bgÃu_dec
;

345 (*
c
)->
ˇche_Æloc
 = 
bgÃu_Æloc
;

346 (*
c
)->
ˇche_makîq
 = 
bgÃu_make_ªqli°
;

347 (*
c
)->
ˇche_ªÀa£rq
 = 
bgÃu_ªÀa£_ªqli°
;

349 
	`CACHE_OPEN
((*
c
), 
size
, 
max_sz
);

351 (*
c
)->
cm_«me
 = (*)
	`mÆloc
(
	`°æí
(
«me
)+1);

352 
	`°r˝y
((*
c
)->
cm_«me
, 
«me
);

355 (*
c
)->
cm_highw©î
 = 
high
;

356 (*
c
)->
cm_loww©î
 = 
low
;

357 
	}
}

361 
	$bgÃu_make_ªq
(
ˇche_m™agî
 *
c
, 
blkno
, 
is_ªad
){

362 
bgÃu_node
 *
bn
 = 
NULL
;

363 
Ãu_node
 *
 
 = 
NULL
;

364 
li°node
 *
gnode
, *
node
;

365 
grou≤o
 = 
blkno
/
GRP2BLK
;

366 
group_Æloc
 = 0, 
node_Æloc
 = 0;

368 
c
->
cm_ªf
++;

370 
gnode
 = 
	`CACHE_SEARCH
(
c
, 
blkno
);

371 if(
gnode
){

372 
bn
 = (
bgÃu_node
 *)
gnode
->
d©a
;

375 
bn
 = 
	`CACHE_REMOVE
(
c
, 
gnode
);

376 
	`CACHE_INSERT
(
c
, 
bn
);

378 
node
 = 
	`Œ_föd_node
(
bn
->
bg_block_hash
[
blkno
%
BG_HASH_NUM
], (*)blkno, 
com∑ª_hdd2
);

379 if(
node
){

381 
c
->
cm_hô
++;

382 
node_Æloc
 = 0;

383 
group_Æloc
 = 0;

385 
 
 = (
Ãu_node
 *)
node
->
d©a
;

388 
node_Æloc
 = 1;

392 
group_Æloc
 = 1;

393 
node_Æloc
 = 1;

396 if(
node_Æloc
){

397 if(
c
->
cm_‰ì
 <c->
cm_loww©î
){

398 
c
->
cm_‰ì
 < c->
cm_highw©î
){

399 
	`CACHE_REPLACE
(
c
, c->
cm_highw©î
);

403 if(
group_Æloc
){

405 
bn
 = 
	`CACHE_ALLOC
(
c
, 
NULL
, 
grou≤o
);

406 
	`CACHE_INSERT
(
c
, 
bn
);

408 
 
 = 
	`bgÃu_ö£π_block_to_group
(
c
, 
bn
, 
blkno
, 
NULL
);

410 if(!
is_ªad
){

411 
	`CACHE_MAKERQ
(
c
, c->
cm_ssdwq
, 
NULL
, 
 
->
˙_ssd_blk
);

412 
 
->
˙_dúty
 = 1;

414 
	`CACHE_MAKERQ
(
c
, c->
cm_ssdrq
, 
NULL
, 
 
->
˙_ssd_blk
);

418 
	}
}

419 
	$bgÃu_maö
(){

420 
ˇche_m™agî
 *
bgÃu_m™agî
;

421 
blkno
 = 
	`RND
(700000);

422 
i
;

425 
	`bgÃu_öô
(&
bgÃu_m™agî
,"BGLRU", 50000, 50000, 1024, 0);

427 
i
 =0;i < 1000000;i++){

428 
blkno
 = 
	`RND
(700000);

430 
	`bgÃu_make_ªq
(
bgÃu_m™agî
, 
blkno
, 
READ
);

433 
	`CACHE_CLOSE
(
bgÃu_m™agî
);

436 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_cache.h

11 
	~"../ssdmodñ/ssd_utûs.h
"

12 
	~"li°.h
"

14 #i‚de‡
_FCL_CACHE_H


15 
	#_FCL_CACHE_H


	)

18 
	#HASH_NUM
 (16*1024)

	)

19 
	#BG_HASH_NUM
 (1024)

	)

20 
	#GRP2BLK
 1024

	)

22 
	#FCL_CACHE_FLAG_FILLING
 1

	)

23 
	#FCL_CACHE_FLAG_SEALED
 2

	)

25 
	sÃu_node
{

27 
li°_hód
 
	m˙_li°
;

28 
li°_hód
 
	m˙_dúty_li°
;

29 
hli°_node
 
	m˙_hash
;

31 
	m˙_blkno
;

32 
	m˙_ssd_blk
;

34 
	m˙_dúty
;

35 
	m˙_ªad
;

36 
	m˙_Êag
;

37 
	m˙_ª˚ncy
;

38 
	m˙_‰equícy
;

40 *
	m˙_ãmp1
;

41 *
	m˙_ãmp2
;

45 
	sˇche_m™agî
{

50 
li°_hód
 
	mcm_hód
;

51 
li°_hód
 
	mcm_dúty_hód
;

52 
hli°_hód
 *
	mcm_hash
;

55 
li°_hód
 *
	mcm_de°age_±r
;

56 
	mcm_hô
;

57 
	mcm_miss
;

58 
	mcm_ªf
;

59 
	mcm_ªad_hô
;

60 
	mcm_ªad_ªf
;

62 
	mcm_size
;

63 
	mcm_‰ì
;

64 
	mcm_cou¡
;

65 
	mcm_max
;

66 
	mcm_mö
;

67 *
	mcm_«me
;

69 
	mcm_dúty_cou¡
;

71 
	mcm_de°age_cou¡
;

72 
	mcm_°age_cou¡
;

74 
	mcm_groupcou¡
;

75 
	mcm_loww©î
;

76 
	mcm_highw©î
;

77 
	mcm_pﬁicy
;

79 (*
	mˇche_›í
)(
ˇche_m™agî
 *
	mˇche
,
	mˇche_size
, 
	mˇche_max
);

80 (*
	mˇche_˛o£
)(
ˇche_m™agî
 *
	mˇche
, 
	m¥öt
);

81 
	mÃu_node
 *(*
	mˇche_¥e£¨ch
)(
ˇche_m™agî
 *
	mˇche
, 
	mblkno
);

82 
	mÃu_node
 *(*
	mˇche_£¨ch
)(
ˇche_m™agî
 *
	mˇche
,
	mblkno
);

83 *(*
	mˇche_ª∂a˚
)(
ˇche_m™agî
 *
	mˇche
,
	mw
);

84 *(*
	mˇche_ªmove
)(
ˇche_m™agî
 *
	mˇche
, 
Ãu_node
 *
	m 
);

85 (*
	mˇche_ö£π
)(
ˇche_m™agî
 *
	mˇche
, 
Ãu_node
 *
	mnode
);

86 *(*
	mˇche_Æloc
)(
Ãu_node
 *
	mnode
, 
	mblkno
);

87 (*
	mˇche_öc
)(
ˇche_m™agî
 *
	mˇche
, 
	mi
);

88 (*
	mˇche_dec
)(
ˇche_m™agî
 *
	mˇche
, 
	mi
);

94 
	sgho°_node
{

95 
li°node
 *
	mgn_node
;

96 
li°node
 *
	mgn_hash
;

97 
	mgn_blkno
;

98 
	mgn_ssd_blk
;

99 
	mgn_dúty
;

100 
	mgn_ª˚ncy
;

101 
	mgn_‰equícy
;

104 
	s˛ock_node
{

105 
li°node
 *
	m˙_node
;

106 
li°node
 *
	m˙_hash
;

107 
	m˙_blkno
;

108 
	m˙_ssd_blk
;

109 
	m˙_dúty
;

110 
	m˙_ªad
;

111 
	m˙_ª˚ncy
;

112 
	m˙_‰equícy
;

118 
	sbgÃu_node
{

119 
li°node
 *
	mbg_node
;

120 
li°node
 *
	mbg_hash
;

121 
	mbg_no
;

122 
	mblock_cou¡
;

123 
	mbg_ª˚ncy
;

124 
li°node
 *
	mbg_block_li°
;

125 
li°node
 *
	mbg_block_hash
[
BG_HASH_NUM
];

128 
	s£q_node
{

129 
li°node
 *
	msq_node
;

130 
li°node
 *
	msq_hash
;

131 
	msq_no
;

132 
	msq_block_cou¡
;

133 
	msq_dúty_cou¡
;

134 
	msq_ªf
;

135 
	msq_hô
;

136 
	msq_°¨t_time
;

137 
li°node
 *
	msq_block_li°
;

138 
li°node
 *
	msq_block_hash
[
BG_HASH_NUM
];

142 
	#CACHE_OPEN
(
c
, 
sz
, 
m
Ëc->
	`ˇche_›í
((
ˇche_m™agî
 *)c, sz, m)

	)

143 
	#CACHE_CLOSE
(
c
, 
¥öt
 ) c->
	`ˇche_˛o£
((
ˇche_m™agî
 *)c,Öröt)

	)

144 
	#CACHE_PRESEARCH
(
c
, 
p
Ëc->
	`ˇche_¥e£¨ch
((
ˇche_m™agî
 *)c,Ö)

	)

145 
	#CACHE_SEARCH
(
c
, 
p
Ëc->
	`ˇche_£¨ch
((
ˇche_m™agî
 *)c,Ö)

	)

146 
	#CACHE_REPLACE
(
c
, 
w
Ëc->
	`ˇche_ª∂a˚
((
ˇche_m™agî
 *)c, w)

	)

147 
	#CACHE_REMOVE
(
c
, 
p
Ëc->
	`ˇche_ªmove
((
ˇche_m™agî
 *)c,Ö)

	)

148 
	#CACHE_INSERT
(
c
, 
p
Ëc->
	`ˇche_ö£π
((
ˇche_m™agî
 *)c,Ö)

	)

149 
	#CACHE_ALLOC
(
c
, 
n
, 
p
Ëc->
	`ˇche_Æloc
“,Ö)

	)

150 
	#CACHE_INC
(
c
, 
i
Ëc->
	`ˇche_öc
((
ˇche_m™agî
 *)c, i)

	)

151 
	#CACHE_DEC
(
c
, 
i
Ëc->
	`ˇche_dec
((
ˇche_m™agî
 *)c, i)

	)

152 
	#CACHE_HIT
(
c
Ë(()c->
cm_hô
/c->
cm_ªf
)

	)

153 
	#CACHE_MAKERQ
(
c
, 
p
, 
r
, 
i
Ëc->
	`ˇche_makîq
((
ˇche_m™agî
 *)c,Ö,Ñ, i)

	)

154 
	#CACHE_RELEASERQ
(
c
, 
p
Ëc->
	`ˇche_ªÀa£rq
((
ˇche_m™agî
 *)c,Ö)

	)

155 
	#CACHE_FLUSHRQ
(
c
, 
d
, 
r
, 
l
Ëc->
	`ˇche_Êushrq
((
ˇche_m™agî
 *)c, d,Ñ,Ü)

	)

158 
	#CACHE_LRU_RW
 0

	)

159 
	#CACHE_LRU_RWO_ADAPTIVE
 1

	)

160 
	#CACHE_BGCLOCK_RW
 2

	)

161 
	#CACHE_BGCLOCK_RWO_ADAPTIVE
 3

	)

162 
	#CACHE_WORKLOAD_ANALYSIS
 4

	)

163 
	#CACHE_DISK_ONLY
 5

	)

164 
	#CACHE_SSD_ONLY
 6

	)

165 
	#CACHE_LRU_RW_ADAPTIVE
 7

	)

166 
	#CACHE_ZIPF
 8

	)

167 
	#CACHE_LRU_SELECTIVE
 9

	)

168 
	#CACHE_POLICY_NUM
 10

	)

171 
Ãu_›í
(
ˇche_m™agî
 *
c
,
ˇche_size
, 
ˇche_max
);

172 
Ãu_˛o£
(
ˇche_m™agî
 *
c
, 
¥öt
);

173 
Ãu_node
 *
Ãu_¥e£¨ch
(
ˇche_m™agî
 *
c
, 
blkno
);

174 
Ãu_node
 *
Ãu_£¨ch
(
ˇche_m™agî
 *
c
,
blkno
);

175 *
Ãu_ªmove
(
ˇche_m™agî
 *
c
, 
Ãu_node
 *
 
);

176 *
Ãu_Æloc
(
Ãu_node
 *
 
, 
blkno
);

177 
Ãu_ö£π
(
ˇche_m™agî
 *
c
,
Ãu_node
 *
 
);

178 *
Ãu_ª∂a˚
(
ˇche_m™agî
 *
c
, 
w©îm¨k
);

179 
Ãu_öc
(
ˇche_m™agî
 *
c
, 
öc_vÆ
);

180 
Ãu_dec
(
ˇche_m™agî
 *
c
, 
dec_vÆ
);

181 
Ãu_öô
(
ˇche_m™agî
 **
c
,*
«me
, 
size
,
max_sz
,
high
,
low
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_clock_cache.c

1 
	~<°dio.h
>

2 
	~"ˇche.h
"

3 
	~"ssd_utûs.h
"

5 
	$˛ock_›í
(
ˇche_m™agî
 *
c
,
ˇche_size
, 
ˇche_max
){

6 
i
;

8 
	`Œ_¸óã
(&(
c
->
cm_hód
));

10 
c
->
cm_hash
 = (
li°node
 **)
	`mÆloc
(÷i°nodê*Ë* 
HASH_NUM
);

11 if(
c
->
cm_hash
 =
NULL
){

12 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

13 
	`exô
(1);

15 
i
 = 0;ò< 
HASH_NUM
;i++){

16 
	`Œ_¸óã
(&
c
->
cm_hash
[
i
]);

19 
c
->
cm_de°age_±r
 = c->
cm_hód
;

20 
c
->
cm_ªf
 = 0;

21 
c
->
cm_hô
 = 0;

22 
c
->
cm_miss
 = 0;

23 
c
->
cm_size
 = 
ˇche_size
;

24 
c
->
cm_‰ì
 = 
ˇche_size
;

25 
c
->
cm_cou¡
 = 0;

26 
c
->
cm_max
 = 
ˇche_max
;

27 
	}
}

29 
	$˛ock_˛o£
(
ˇche_m™agî
 *
c
){

30 
li°node
 *
node
 = 
c
->
cm_hód
->
√xt
;

31 
˛ock_node
 *
˙
;

32 
i
;

34 
	`Ârötf
(
°dout
, " %†hôÑ©iÿ%f\n",
c
->
cm_«me
, ()c->
cm_hô
/c->
cm_ªf
);

36 
node
 !
c
->
cm_hód
 &&Çode){

37 
˙
 = (
˛ock_node
 *)
node
->
d©a
;

38 
	`‰ì
(
˙
);

39 
c
->
cm_‰ì
++;

40 
c
->
cm_cou¡
--;

41 
node
 =Çode->
√xt
;

43 if(
c
->
cm_‰ì
 !c->
cm_size
){

44 
	`Ârötf
(
°dîr
, " check ... \n");

46 
	`Œ_ªÀa£
(
c
->
cm_hód
);

48 
i
 = 0;ò< 
HASH_NUM
;i++){

49 
	`Œ_ªÀa£
(
c
->
cm_hash
[
i
]);

52 
	}
}

54 
	$˛ock_com∑ª_∑ge
(c⁄° *
a
,c⁄° *
b
){

55 if(()(((
˛ock_node
 *)
a
)->
˙_blkno
Ë=()
b
)

58 
	}
}

61 
li°node
 *
	$˛ock_£¨ch
(
ˇche_m™agî
 *
c
, 
blkno
){

62 
li°node
 *
node
;

63 
li°node
 *
hód
;

64 
˛ock_node
 *
˙
;

65 
c
->
cm_ªf
++;

67 
hód
 = 
c
->
cm_hash
[
blkno
%
HASH_NUM
];

68 
node
 = 
	`Œ_föd_node
(
hód
,(*)
blkno
, 
˛ock_com∑ª_∑ge
);

69 if(
node
){

70 
c
->
cm_hô
++;

72 
˙
 = (
˛ock_node
 *)
node
->
d©a
;

73 
˙
->
˙_ª˚ncy
 = 1;

74  
node
;

77 
c
->
cm_miss
++;

79  
NULL
;

80 
	}
}

82 
li°node
 *
	$˛ock_£À˘_vi˘im
(
ˇche_m™agî
 *
c
, 
li°node
 *
de°age_±r
){

83 
˛ock_node
 *
˙
;

87 if(
de°age_±r
 =
c
->
cm_hód
)

88 
de°age_±r
 = de°age_±r->
¥ev
;

90 
˙
 = (
˛ock_node
 *)(
de°age_±r
->
d©a
);

91 if(!
˙
->
˙_ª˚ncy
){

94 
˙
->
˙_ª˚ncy
 = 0;

95 
de°age_±r
 = de°age_±r->
¥ev
;

98  
de°age_±r
;

99 
	}
}

102 *
	$˛ock_ªmove
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªmove_±r
){

103 
˛ock_node
 *
˙
;

104 
li°node
 *
vi˘im
;

106 
˙
 = (
˛ock_node
 *)
ªmove_±r
->
d©a
;

109 
	`Œ_ªÀa£_node
(
c
->
cm_hód
, 
˙
->
˙_node
);

112 
	`Œ_ªÀa£_node
(
c
->
cm_hash
[
˙
->
˙_blkno
%
HASH_NUM
], cn->
˙_hash
);

114 
c
->
cm_‰ì
++;

115 
c
->
cm_cou¡
--;

117 
˙
->
˙_node
 = 
NULL
;

118 
˙
->
˙_hash
 = 
NULL
;

120  (*)
˙
;

122 
	}
}

125 *
	$˛ock_Æloc
(
˛ock_node
 *
˙
, 
blkno
){

127 if(
˙
 =
NULL
){

128 
˙
 = (
˛ock_node
 *)
	`mÆloc
((clock_node));

129 if(
˙
 =
NULL
){

130 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

131 
	`exô
(1);

133 
	`mem£t
(
˙
, 0x00, (
˛ock_node
));

136 
˙
->
˙_blkno
 = 
blkno
;

137 
˙
->
˙_ª˚ncy
 = 1;

140  
˙
;

141 
	}
}

144 
	$˛ock_ö£π
(
ˇche_m™agî
 *
c
,
˛ock_node
 *
˙
){

147 
˙
->
˙_node
 = (
li°node
 *)
	`Œ_ö£π_©_√xt
(
c
->
cm_hód
, c->
cm_de°age_±r
,(*)cn);

148 
c
->
cm_‰ì
--;

149 
c
->
cm_cou¡
++;

152 
˙
->
˙_hash
 = (
li°node
 *)
	`Œ_ö£π_©_hód
(
c
->
cm_hash
[(˙->
˙_blkno
)%
HASH_NUM
],(*) cn);

154 
	}
}

158 
li°node
 *
	$˛ock_ª∂a˚
(
ˇche_m™agî
 *
c
){

159 
li°node
 *
de°age_±r
;

160 
li°node
 *
ªmove_±r
;

161 
li°node
 *
vi˘im
 = 
NULL
;

163 if(
c
->
cm_‰ì
 < 1){

164 
de°age_±r
 = 
c
->
cm_de°age_±r
;

165 
de°age_±r
 = 
	`˛ock_£À˘_vi˘im
(
c
, destage_ptr);

167 
ªmove_±r
 = 
de°age_±r
;

168 
c
->
cm_de°age_±r
 = 
de°age_±r
->
¥ev
;

169 
vi˘im
 = 
	`CACHE_REMOVE
(
c
, 
ªmove_±r
);

172  
vi˘im
;

173 
	}
}

176 
	$˛ock_öc
(
ˇche_m™agî
 *
c
, 
öc_vÆ
){

177 if((
c
->
cm_size
+
öc_vÆ
Ë< (c->
cm_max
)){

178 
c
->
cm_size
+=
öc_vÆ
;

179 
c
->
cm_‰ì
+=
öc_vÆ
;

180  
öc_vÆ
;

184 
	}
}

186 
	$˛ock_dec
(
ˇche_m™agî
 *
c
, 
dec_vÆ
){

187 if((
c
->
cm_size
-
dec_vÆ
) > 0){

188 
c
->
cm_size
-=
dec_vÆ
;

189 
c
->
cm_‰ì
-=
dec_vÆ
;

190  
dec_vÆ
;

194 
	}
}

196 
	$˛ock_öô
(
ˇche_m™agî
 **
c
,*
«me
, 
size
,
max_sz
){

197 *
c
 = (
ˇche_m™agî
 *)
	`mÆloc
((cache_manager));

198 if(*
c
 =
NULL
){

199 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

200 
	`exô
(1);

202 
	`mem£t
(*
c
, 0x00, (
ˇche_m™agî
));

204 (*
c
)->
ˇche_›í
 = 
˛ock_›í
;

205 (*
c
)->
ˇche_˛o£
 = 
˛ock_˛o£
;

206 (*
c
)->
ˇche_£¨ch
 = 
˛ock_£¨ch
;

207 (*
c
)->
ˇche_ª∂a˚
 = 
˛ock_ª∂a˚
;

208 (*
c
)->
ˇche_ªmove
 = 
˛ock_ªmove
;

209 (*
c
)->
ˇche_ö£π
 = 
˛ock_ö£π
;

210 (*
c
)->
ˇche_öc
 = 
˛ock_öc
;

211 (*
c
)->
ˇche_dec
 = 
˛ock_dec
;

212 (*
c
)->
ˇche_Æloc
 = 
˛ock_Æloc
;

214 
	`CACHE_OPEN
((*
c
), 
size
, 
max_sz
);

216 (*
c
)->
cm_«me
 = (*)
	`mÆloc
(
	`°æí
(
«me
)+1);

217 
	`°r˝y
((*
c
)->
cm_«me
, 
«me
);

219 
	}
}

221 
	$˛ock_maö
(){

222 
ˇche_m™agî
 *
˛ock_m™agî
;

223 
i
;

225 
	`˛ock_öô
(&
˛ock_m™agî
,"CLOCK", 500, 500);

227 
i
 =0;i < 1000000;i++){

228 
li°node
 *
node
;

229 
blkno
 = 
	`RND
(700);

231 
node
 = 
	`CACHE_SEARCH
(
˛ock_m™agî
, 
blkno
);

232 if(!
node
){

233 
˛ock_node
 *
˙
 = 
NULL
;

234 
˙
 = 
	`CACHE_REPLACE
(
˛ock_m™agî
, 0);

235 
˙
 = 
	`CACHE_ALLOC
(
˛ock_m™agî
, cn, 
blkno
);

236 
	`CACHE_INSERT
(
˛ock_m™agî
, 
˙
);

240 
	`CACHE_CLOSE
(
˛ock_m™agî
);

243 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_ghost_cache.c

1 
	~<°dio.h
>

2 
	~"ˇche.h
"

3 
	~"ssd_utûs.h
"

6 
	$gho°_›í
(
ˇche_m™agî
 *
c
,
ˇche_size
,
ˇche_max
){

7 
i
;

9 
	`Œ_¸óã
(&(
c
->
cm_hód
));

11 
c
->
cm_hash
 = (
li°node
 **)
	`mÆloc
(÷i°nodê*Ë* 
HASH_NUM
);

12 if(
c
->
cm_hash
 =
NULL
){

13 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

14 
	`exô
(1);

16 
i
 = 0;ò< 
HASH_NUM
;i++){

17 
	`Œ_¸óã
(&
c
->
cm_hash
[
i
]);

20 
c
->
cm_de°age_±r
 = c->
cm_hód
;

21 
c
->
cm_ªf
 = 0;

22 
c
->
cm_hô
 = 0;

23 
c
->
cm_miss
 = 0;

24 
c
->
cm_size
 = 
ˇche_size
;

25 
c
->
cm_‰ì
 = 
ˇche_size
;

26 
c
->
cm_cou¡
 = 0;

27 
c
->
cm_max
 = 
ˇche_max
;

28 
	}
}

30 
	$gho°_˛o£
(
ˇche_m™agî
 *
c
){

31 
li°node
 *
node
 = 
c
->
cm_hód
->
√xt
;

32 
gho°_node
 *
˙
;

33 
i
;

35 
	`Ârötf
(
°dout
, " %†hôÑ©iÿ%f\n",
c
->
cm_«me
, ()c->
cm_hô
/c->
cm_ªf
);

37 
node
 !
c
->
cm_hód
 &&Çode){

38 
˙
 = (
gho°_node
 *)
node
->
d©a
;

39 
	`‰ì
(
˙
);

40 
c
->
cm_‰ì
++;

41 
c
->
cm_cou¡
--;

42 
node
 =Çode->
√xt
;

44 if(
c
->
cm_‰ì
 !c->
cm_size
){

45 
	`Ârötf
(
°dîr
, " check ... \n");

47 
	`Œ_ªÀa£
(
c
->
cm_hód
);

49 
i
 = 0;ò< 
HASH_NUM
;i++){

50 
	`Œ_ªÀa£
(
c
->
cm_hash
[
i
]);

53 
	}
}

55 
	$gho°_com∑ª_∑ge
(c⁄° *
a
,c⁄° *
b
){

56 if(()(((
gho°_node
 *)
a
)->
gn_blkno
Ë=()
b
)

59 
	}
}

62 
li°node
 *
	$gho°_£¨ch
(
ˇche_m™agî
 *
c
, 
blkno
){

63 
li°node
 *
node
;

64 
li°node
 *
hód
;

65 
gho°_node
 *
gn
;

66 
c
->
cm_ªf
++;

68 
hód
 = 
c
->
cm_hash
[
blkno
%
HASH_NUM
];

69 
node
 = 
	`Œ_föd_node
(
hód
, (*)
blkno
, 
gho°_com∑ª_∑ge
);

70 if(
node
){

71 
c
->
cm_hô
++;

72  
node
;

74 
c
->
cm_miss
--;

76  
NULL
;

77 
	}
}

80 *
	$gho°_ªmove
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªmove_±r
){

81 
gho°_node
 *
gn
;

83 
gn
 = (
gho°_node
 *)
ªmove_±r
->
d©a
;

86 
	`Œ_ªÀa£_node
(
c
->
cm_hód
, 
gn
->
gn_node
);

89 
	`Œ_ªÀa£_node
(
c
->
cm_hash
[
gn
->
gn_blkno
%
HASH_NUM
], gn->
gn_hash
);

91 
gn
->
gn_node
 = 
NULL
;

92 
gn
->
gn_hash
 = 
NULL
;

95 
c
->
cm_‰ì
++;

96 
c
->
cm_cou¡
--;

98  (*)
gn
;

99 
	}
}

103 
	$gho°_ö£π
(
ˇche_m™agî
 *
c
,
gho°_node
 *
gn
){

106 
gn
->
gn_node
 = 
	`Œ_ö£π_©_√xt
(
c
->
cm_hód
, c->
cm_de°age_±r
,(*)gn);

107 
c
->
cm_‰ì
--;

108 
c
->
cm_cou¡
++;

111 
gn
->
gn_hash
 = 
	`Œ_ö£π_©_hód
(
c
->
cm_hash
[(gn->
gn_blkno
)%
HASH_NUM
],(*)gn);

114 
	}
}

116 
	$gho°_öc
(
ˇche_m™agî
 *
c
,
öc_vÆ
){

117 if((
c
->
cm_size
+
öc_vÆ
Ë< (c->
cm_max
)){

118 
c
->
cm_size
+=
öc_vÆ
;

119 
c
->
cm_‰ì
+=
öc_vÆ
;

120  
öc_vÆ
;

124 
	}
}

127 
	$gho°_dec
(
ˇche_m™agî
 *
c
,
dec_vÆ
){

128 if((
c
->
cm_size
-
dec_vÆ
) > 0){

129 
c
->
cm_size
-=
dec_vÆ
;

130 
c
->
cm_‰ì
-=
dec_vÆ
;

131  
dec_vÆ
;

135 
	}
}

138 *
	$gho°_Æloc
(
gho°_node
 *
gn
, 
blkno
){

140 if(
gn
 =
NULL
){

141 
gn
 = (
gho°_node
 *)
	`mÆloc
((ghost_node));

142 if(
gn
 =
NULL
){

143 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

144 
	`exô
(1);

146 
	`mem£t
(
gn
, 0x00, (
gho°_node
));

149 
gn
->
gn_blkno
 = 
blkno
;

151  
gn
;

152 
	}
}

155 
li°node
 *
	$gho°_ª∂a˚
(
ˇche_m™agî
 *
c
){

156 
li°node
 *
ªmove_±r
;

157 *
vi˘im
 = 
NULL
;

159 if(
c
->
cm_‰ì
 < 1){

160 
ªmove_±r
 = 
c
->
cm_hód
->
¥ev
;

161 
c
->
cm_de°age_±r
 = c->
cm_hód
;

162 
vi˘im
 = 
	`CACHE_REMOVE
(
c
, 
ªmove_±r
);

163 
	`‰ì
(
vi˘im
);

166  
NULL
;

167 
	}
}

169 
	$gho°_öô
(
ˇche_m™agî
 **
c
,*
«me
, 
size
, 
max_sz
){

170 *
c
 = (
ˇche_m™agî
 *)
	`mÆloc
((cache_manager));

171 if(*
c
 =
NULL
){

172 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

173 
	`exô
(1);

175 
	`mem£t
(*
c
, 0x00, (
ˇche_m™agî
));

178 (*
c
)->
ˇche_›í
 = 
gho°_›í
;

179 (*
c
)->
ˇche_˛o£
 = 
gho°_˛o£
;

180 (*
c
)->
ˇche_£¨ch
 = 
gho°_£¨ch
;

181 (*
c
)->
ˇche_ª∂a˚
 = 
gho°_ª∂a˚
;

182 (*
c
)->
ˇche_ªmove
 = 
gho°_ªmove
;

183 (*
c
)->
ˇche_ö£π
 = 
gho°_ö£π
;

184 (*
c
)->
ˇche_öc
 = 
gho°_öc
;

185 (*
c
)->
ˇche_dec
 = 
gho°_dec
;

186 (*
c
)->
ˇche_Æloc
 = 
gho°_Æloc
;

188 
	`CACHE_OPEN
((*
c
), 
size
, 
max_sz
);

190 (*
c
)->
cm_«me
 = (*)
	`mÆloc
(
	`°æí
(
«me
)+1);

191 
	`°r˝y
((*
c
)->
cm_«me
, 
«me
);

193 
	}
}

196 
	$gho°_maö
(){

197 
ˇche_m™agî
 *
gho°_m™agî
;

198 
i
;

200 
	`gho°_öô
(&
gho°_m™agî
, "GHOST", 500, 500);

203 
i
 =0;i < 1000000;i++){

204 
li°node
 *
node
;

205 
blkno
 = 
	`RND
(700);

207 
node
 = 
	`CACHE_SEARCH
(
gho°_m™agî
, 
blkno
);

208 if(!
node
){

209 
gho°_node
 *
gn
;

210 
	`CACHE_REPLACE
(
gho°_m™agî
, 0);

211 
gn
 = 
	`CACHE_ALLOC
(
gho°_m™agî
, 
NULL
, 
blkno
);

212 
	`CACHE_INSERT
(
gho°_m™agî
, 
gn
);

218 
	`CACHE_CLOSE
(
gho°_m™agî
);

220 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_lru.c

1 
	~<°dio.h
>

2 
	~<°dlib.h
>

3 
	~"disksim_f˛_ˇche.h
"

4 
	~"../ssdmodñ/ssd_utûs.h
"

7 
	$Ãu_›í
(
ˇche_m™agî
 *
c
,
ˇche_size
, 
ˇche_max
){

8 
i
;

11 
	`INIT_LIST_HEAD
 ( &
c
->
cm_hód
 );

12 
	`INIT_LIST_HEAD
 ( &
c
->
cm_dúty_hód
 );

14 
c
->
cm_hash
 = (
hli°_hód
 *)
	`mÆloc
((hli°_hódË* 
HASH_NUM
);

15 if(
c
->
cm_hash
 =
NULL
){

16 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

17 
	`exô
(1);

19 
i
 = 0;ò< 
HASH_NUM
;i++){

20 
	`INIT_HLIST_HEAD
 ( &
c
->
cm_hash
[
i
] );

23 
c
->
cm_de°age_±r
 = &c->
cm_hód
;

24 
c
->
cm_ªf
 = 0;

25 
c
->
cm_hô
 = 0;

26 
c
->
cm_miss
 = 0;

27 
c
->
cm_size
 = 
ˇche_size
;

28 
c
->
cm_‰ì
 = 
ˇche_size
;

29 
c
->
cm_cou¡
 = 0;

30 
c
->
cm_max
 = 
ˇche_max
;

32 
c
->
cm_dúty_cou¡
 = 0;

34 
	}
}

36 
	$Ãu_˛o£
(
ˇche_m™agî
 *
c
, 
¥öt
){

37 
li°_hód
 *
hód
 = &
c
->
cm_hód
;

38 
li°_hód
 *
±r
;

39 
Ãu_node
 *
 
;

41 
i
;

42 
tŸÆ
 = 0;

43 
ªad_cou¡
 = 0;

44 
wrôe_cou¡
 = 0;

46 i‡–
¥öt
 ) {

47 
	`Ârötf
(
°dout
, " %†hôÑ©iÿ%f\n",
c
->
cm_«me
, ()c->
cm_hô
/c->
cm_ªf
);

48 
	`Ârötf
(
°dout
, " %†De°agêCou¡ = %d\n",
c
->
cm_«me
, c->
cm_de°age_cou¡
);

49 
	`Ârötf
(
°dout
, " %†SègêCou¡ = %d\n",
c
->
cm_«me
, c->
cm_°age_cou¡
);

50 
	`Ârötf
(
°dout
, " %†Dúty Cou¡ = %d \n",
c
->
cm_«me
, c->
cm_dúty_cou¡
 );

51 
	`Ârötf
(
°dout
, " %†Li° Cou¡ = %d \n", 
c
->
cm_«me
, c->
cm_cou¡
 );

56 
	`li°_f‹_óch
 ( 
±r
, 
hód
 ) {

57 
 
 = (
Ãu_node
 *Ë
	`li°_íåy
 ( 
±r
, Ãu_node, 
˙_li°
 );

59 
tŸÆ
++;

60 if(
 
->
˙_ªad
)

61 
ªad_cou¡
++;

62 if(
 
->
˙_dúty
)

63 
wrôe_cou¡
++;

65 
c
->
cm_‰ì
++;

66 
c
->
cm_cou¡
--;

69  !
	`li°_em±y
 ( 
hód
 ) ) {

70 
±r
 = 
hód
->
√xt
;

71 
 
 = (
Ãu_node
 *Ë
	`li°_íåy
 ( 
±r
, Ãu_node, 
˙_li°
 );

73 
	`li°_dñ
 ( & 
 
->
˙_li°
 );

74 i‡–
 
->
˙_dúty
 )

75 
	`li°_dñ
 ( & 
 
->
˙_dúty_li°
 );

77 
	`hli°_dñ
 ( & 
 
->
˙_hash
 );

79 
	`‰ì
(
 
);

82 
node
 !
c
->
cm_hód
 &&Çode){

83 
 
 = (
Ãu_node
 *)
node
->
d©a
;

85 
tŸÆ
++;

86 if(
 
->
˙_ªad
)

87 
ªad_cou¡
++;

88 if(
 
->
˙_dúty
)

89 
wrôe_cou¡
++;

91 
	`‰ì
(
 
);

92 
c
->
cm_‰ì
++;

93 
c
->
cm_cou¡
--;

94 
node
 =Çode->
√xt
;

103 
	`ASSERT
 ( 
c
->
cm_‰ì
 =c->
cm_size
 );

104 if(
c
->
cm_‰ì
 !c->
cm_size
){

105 
	`Ârötf
(
°dîr
, " check ... \n");

108 
	`ASSERT
 ( 
	`li°_em±y
 ( &
c
->
cm_hód
 ) );

111 
i
 = 0;ò< 
HASH_NUM
;i++){

112 
	`ASSERT
 ( 
	`hli°_em±y
 ( &
c
->
cm_hash
[
i
] ) );

115 
	}
}

117 
	$com∑ª_blkno
(c⁄° *
a
,c⁄° *
b
){

118 if(()
a
 > ()
b
)

120 if(()
a
 < ()
b
)

123 
	}
}

125 
	$Ãu_ªÀa£_ªqli°
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªq_li°
){

127 
	`Œ_gë_size
(
ªq_li°
)){

128 
	`Œ_ªÀa£_èû
(
ªq_li°
);

130 
	}
}

132 
	$Ãu_com∑ª_∑ge
(c⁄° *
a
,c⁄° *
b
){

133 if(()(((
Ãu_node
 *)
a
)->
˙_blkno
Ë=()
b
)

136 
	}
}

140 
Ãu_node
 *
	$Ãu_¥e£¨ch
(
ˇche_m™agî
 *
c
, 
blkno
){

141 
hli°_node
 *
node
;

142 
hli°_hód
 *
hód
;

143 
Ãu_node
 *
 
;

145 
hód
 = &
c
->
cm_hash
[
blkno
%
HASH_NUM
];

146 
	`hli°_f‹_óch
 ( 
node
, 
hód
 ) {

147 
 
 = 
	`hli°_íåy
–
node
, 
Ãu_node
, 
˙_hash
 );

149 i‡–
 
->
˙_blkno
 =
blkno
 )

150  
 
;

153  
NULL
;

154 
	}
}

157 
Ãu_node
 *
	$Ãu_£¨ch
(
ˇche_m™agî
 *
c
,
blkno
){

158 
Ãu_node
 *
 
;

160 
c
->
cm_ªf
++;

163 
 
 = 
	`Ãu_¥e£¨ch
 ( 
c
, 
blkno
 );

165 if(
 
){

166 
c
->
cm_hô
++;

168 
 
->
˙_ª˚ncy
 = 1;

169 
 
->
˙_‰equícy
++;

170  
 
;

172 
c
->
cm_miss
++;

175  
NULL
;

176 
	}
}

179 *
	$Ãu_ªmove
(
ˇche_m™agî
 *
c
, 
Ãu_node
 *
 
 ) {

181 
	`li°_dñ
 ( &
 
->
˙_li°
 );

183 i‡–
 
->
˙_dúty
 )

184 
	`li°_dñ
 ( &
 
->
˙_dúty_li°
 );

186 
	`hli°_dñ
 ( &
 
->
˙_hash
 );

188 
c
->
cm_‰ì
++;

189 
c
->
cm_cou¡
--;

191  (*)
 
;

192 
	}
}

195 *
	$Ãu_Æloc
(
Ãu_node
 *
 
, 
blkno
){

197 if(
 
 =
NULL
){

198 
 
 = (
Ãu_node
 *)
	`mÆloc
((lru_node));

199 if(
 
 =
NULL
){

200 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

201 
	`exô
(1);

205 
	`mem£t
(
 
, 0x00, (
Ãu_node
));

207 
 
->
˙_blkno
 = 
blkno
;

208 
 
->
˙_ssd_blk
 = -1;

209 
 
->
˙_‰equícy
 = 0;

211  
 
;

212 
	}
}

215 
	$Ãu_ö£π
(
ˇche_m™agî
 *
c
,
Ãu_node
 *
 
){

220 
	`li°_add
–&
 
->
˙_li°
, &
c
->
cm_hód
 );

222 i‡–
 
->
˙_dúty
 )

223 
	`li°_add
–&
 
->
˙_dúty_li°
, &
c
->
cm_dúty_hód
);

225 
	`hli°_add_hód
–&
 
->
˙_hash
, &
c
->
cm_hash
[÷n->
˙_blkno
Ë% 
HASH_NUM
] ) ;

227 
c
->
cm_‰ì
--;

228 
c
->
cm_cou¡
++;

233 
	}
}

238 *
	$Ãu_ª∂a˚
(
ˇche_m™agî
 *
c
, 
w©îm¨k
){

239 
li°_hód
 *
ªmove_±r
;

240 
Ãu_node
 *
vi˘im
 = 
NULL
;

242 if(
c
->
cm_‰ì
 < 
w©îm¨k
+1){

243 
ªmove_±r
 = (
li°_hód
 *)(&
c
->
cm_hód
)->
¥ev
;

245 i‡–!
	`li°_em±y
 (&
c
->
cm_hód
) ) {

246 
vi˘im
 = 
	`li°_íåy
 ( 
ªmove_±r
, 
Ãu_node
, 
˙_li°
 );

247 
vi˘im
 = 
	`CACHE_REMOVE
(
c
, victim);

253  
vi˘im
;

254 
	}
}

257 
	$Ãu_öc
(
ˇche_m™agî
 *
c
, 
öc_vÆ
){

259 if((
c
->
cm_size
+
öc_vÆ
Ë< (c->
cm_max
)){

260 
c
->
cm_size
+=
öc_vÆ
;

261 
c
->
cm_‰ì
+=
öc_vÆ
;

262  
öc_vÆ
;

266 
	}
}

268 
	$Ãu_dec
(
ˇche_m™agî
 *
c
, 
dec_vÆ
){

269 if((
c
->
cm_size
-
dec_vÆ
) > 0){

270 
c
->
cm_size
-=
dec_vÆ
;

271 
c
->
cm_‰ì
-=
dec_vÆ
;

273 if(
c
->
cm_size
 <= 1024)

274 
c
 = c;

275  
dec_vÆ
;

279 
	}
}

281 
	$Ãu_öô
(
ˇche_m™agî
 **
c
,*
«me
, 
size
,
max_sz
,
high
,
low
){

282 *
c
 = (
ˇche_m™agî
 *)
	`mÆloc
((cache_manager));

283 if(*
c
 =
NULL
){

284 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

285 
	`exô
(1);

287 
	`mem£t
(*
c
, 0x00, (
ˇche_m™agî
));

289 (*
c
)->
ˇche_›í
 = 
Ãu_›í
;

290 (*
c
)->
ˇche_˛o£
 = 
Ãu_˛o£
;

291 (*
c
)->
ˇche_¥e£¨ch
 = 
Ãu_¥e£¨ch
;

292 (*
c
)->
ˇche_£¨ch
 = 
Ãu_£¨ch
;

293 (*
c
)->
ˇche_ª∂a˚
 = 
Ãu_ª∂a˚
;

294 (*
c
)->
ˇche_ªmove
 = 
Ãu_ªmove
;

295 (*
c
)->
ˇche_ö£π
 = 
Ãu_ö£π
;

296 (*
c
)->
ˇche_öc
 = 
Ãu_öc
;

297 (*
c
)->
ˇche_dec
 = 
Ãu_dec
;

298 (*
c
)->
ˇche_Æloc
 = 
Ãu_Æloc
;

300 
	`CACHE_OPEN
((*
c
), 
size
, 
max_sz
);

302 (*
c
)->
cm_«me
 = (*)
	`mÆloc
(
	`°æí
(
«me
)+1);

303 
	`°r˝y
((*
c
)->
cm_«me
, 
«me
);

305 (*
c
)->
cm_loww©î
 = 
low
;

306 (*
c
)->
cm_highw©î
 = 
high
;

307 
	}
}

310 
Ãu_node
 *
	$m_Ãu_ö£π
(
ˇche_m™agî
 **
Ãu_m™agî
, 
k
, 
blkno
){

311 
Ãu_node
 *
 
;

312 
j
;

314 
j
 = 
k
;j > 0;j--){

315 
Ãu_node
 *
vi˘im_ 
;

316 
vi˘im_ 
 = 
	`CACHE_REPLACE
(
Ãu_m™agî
[
j
], 0);

317 if(
vi˘im_ 
){

318 
	`‰ì
(
vi˘im_ 
);

321 
vi˘im_ 
 = 
	`CACHE_REPLACE
(
Ãu_m™agî
[
j
-1], 0);

322 if(
vi˘im_ 
){

323 
	`CACHE_INSERT
(
Ãu_m™agî
[
j
], 
vi˘im_ 
);

327 
 
 = 
	`CACHE_ALLOC
(
Ãu_m™agî
[0], 
NULL
, 
blkno
);

329 
	`CACHE_INSERT
(
Ãu_m™agî
[0], 
 
);

331  
 
;

332 
	}
}

341 
ˇche_m™agî
 **
	$mÃu_öô
(*
«me
,
Ãu_num
, 
tŸÆ_size
){

342 
ˇche_m™agî
 **
Ãu_m™agî
;

343 
°r
[128];

344 
i
;

345 
j
;

348 
Ãu_m™agî
 = (
ˇche_m™agî
 **)
	`mÆloc
((ˇche_m™agî *Ë* 
Ãu_num
);

349 if(
Ãu_m™agî
 =
NULL
){

350 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

351 
	`exô
(1);

353 
	`mem£t
(
Ãu_m™agî
, 0x00, (
ˇche_m™agî
 *Ë* 
Ãu_num
);

356 if(
tŸÆ_size
%
Ãu_num
){

357 
	`Ârötf
(
°dîr
, "Ñemaödî o‡tŸÆ %d /Ürunum %dÉxi°s\n", 
tŸÆ_size
, 
Ãu_num
);

359 
i
 = 0;ò< 
Ãu_num
;i++){

360 
	`•rötf
(
°r
,"%s%d", 
«me
, 
i
);

361 
	`Ãu_öô
(&
Ãu_m™agî
[
i
],
°r
, 
tŸÆ_size
/
Ãu_num
,Åotal_size/lru_num, 1, 0);

364  
Ãu_m™agî
;

365 
	}
}

367 
	$mÃu_exô
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
){

368 
i
;

372 
i
 = 0;ò< 
Ãu_num
;i++){

375 
	`CACHE_CLOSE
(
Ãu_m™agî
[
i
], 0);

379 
	}
}

382 
	$mÃu_ªmove
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
, 
blkno
){

383 
li°node
 *
node
 = 
NULL
;

384 
Ãu_node
 *
 
;

385 
j
;

387 
j
 = 0;j < 
Ãu_num
;j++){

388 
node
 = 
	`CACHE_SEARCH
(
Ãu_m™agî
[
j
], 
blkno
);

389 if(
node
){

396 if(
node
){

397 
 
 = 
	`CACHE_REMOVE
(
Ãu_m™agî
[
j
], 
node
);

398 
	`‰ì
(
 
);

401 
	}
}

405 
li°node
 *
	$mÃu_£¨ch
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
, 
blkno
, 
ö£π
,
hô
, *
hô_posôi⁄
){

406 
li°node
 *
node
 = 
NULL
;

407 
Ãu_node
 *
 
;

408 
j
;

410 
j
 = 0;j < 
Ãu_num
;j++){

411 
node
 = 
	`CACHE_SEARCH
(
Ãu_m™agî
[
j
], 
blkno
);

412 if(
node
){

413 *
hô_posôi⁄
 = 
j
;

418 if(
node
){

419 
 
 =(
Ãu_node
 *Ë
node
->
d©a
;

420 if(
 
->
˙_‰equícy
 > 1)

421 
 
 =Ün;

425 if(!
hô
){

426 
Ãu_m™agî
[0]->
cm_ªf
--;

427 if(
node
){

428 
Ãu_m™agî
[
j
]->
cm_hô
--;

432 if(!
ö£π
){

433  
node
;

436 if(!
node
){

437 
 
 = 
	`m_Ãu_ö£π
(
Ãu_m™agî
, 
Ãu_num
 - 1, 
blkno
);

439 
 
 = 
	`CACHE_REMOVE
(
Ãu_m™agî
[
j
], 
node
);

440 
	`‰ì
(
 
);

441 
 
 = 
	`m_Ãu_ö£π
(
Ãu_m™agî
, 
j
, 
blkno
);

444  
node
;

445 
	}
}

453 
	$Ãu_maö2
(){

454 
ˇche_m™agî
 **
mÃu_m™agî
;

455 
°r
[128];

456 
i
;

457 
j
;

458 
Ãu_num
 = 10;

460 
mÃu_m™agî
 = 
	`mÃu_öô
("MLRU", 
Ãu_num
, 500);

462 
i
 =0;i < 1000000;i++){

463 
Ãu_node
 *
 
 = 
NULL
, *
 _√w
 = NULL;

464 
li°node
 *
node
;

465 
blkno
 = 
	`RND
(700);

467 
	`mÃu_£¨ch
(
mÃu_m™agî
, 
Ãu_num
, 
blkno
, 1, 1, 
NULL
);

470 
	`mÃu_exô
(
mÃu_m™agî
, 
Ãu_num
);

474 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_map.c

10 
	~"disksim_iosim.h
"

11 
	~"moduÀs/moduÀs.h
"

12 
	~"disksim_f˛.h
"

13 
	~"disksim_ioqueue.h
"

14 
	~"disksim_f˛_ˇche.h
"

15 
	~"disksim_f˛_m≠.h
"

17 *
	gªvî£_m≠
;

18 
	gªvî£_‰ì
 = 0;

19 
	gªvî£_u£d
 = 0;

20 
	gªvî£_Æloc
 = 0;

21 
	gªvî£_max_∑ges
 = 0;

22 
li°node
 *
	gªvî£_‰ìq
;

25 
	$ªvî£_gë_blk
(
ssdblk
){

26  
ªvî£_m≠
[
ssdblk
];

27 
	}
}

29 
	$ªvî£_m≠_¸óã
(
max
){

30 
i
;

32 
ªvî£_max_∑ges
 = 
max
;

34 
ªvî£_m≠
 = (*)
	`mÆloc
((Ë* 
ªvî£_max_∑ges
);

35 if(
ªvî£_m≠
 =
NULL
){

36 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

37 
	`exô
(0);

40 
i
 = 0;ò< 
ªvî£_max_∑ges
;i++){

41 
ªvî£_m≠
[
i
] = -1;

43 
ªvî£_u£d
 = 0;

44 
ªvî£_‰ì
 = 
ªvî£_max_∑ges
-1;

45 
ªvî£_Æloc
 = 1;

47 
	`Ârötf
(
°dout
, " Revî£ M≠ AŒoˇti⁄ = %.2fKB\n", ()()*
ªvî£_max_∑ges
/1024);

49 
	`Œ_¸óã
(&
ªvî£_‰ìq
);

50 
	}
}

55 
	$ªvî£_m≠_Æloc_blk
(
hdd_blk
){

56 
i
;

57 
Æloc_blk
 = -1;

60 if(
	`Œ_gë_size
(
ªvî£_‰ìq
)){

61 
ªvî£_Æloc
 = ()
	`Œ_gë_èû
(
ªvî£_‰ìq
);

62 
	`Œ_ªÀa£_èû
(
ªvî£_‰ìq
);

65 
i
 = 1;ò< 
ªvî£_max_∑ges
;i++){

67 if(
ªvî£_m≠
[
ªvî£_Æloc
] == -1){

68 
Æloc_blk
 = 
ªvî£_Æloc
;

72 
ªvî£_Æloc
++;

73 if(
ªvî£_Æloc
 =
ªvî£_max_∑ges
)

74 
ªvî£_Æloc
 = 1;

78 if(
Æloc_blk
 > 0){

79 
ªvî£_‰ì
--;

80 if(
ªvî£_‰ì
 < 0){

81 
	`Ârötf
(
°dîr
, " checkÑeverse_map_alloc_blk \n");

82 
ªvî£_‰ì
 =Ñeverse_free;

84 
ªvî£_u£d
++;

85 
ªvî£_m≠
[
ªvî£_Æloc
] = 
hdd_blk
;

87 
	`ASSERT
 ( 
Æloc_blk
 != -1 );

89 if(
Æloc_blk
 == -1){

100 
	`exô
(0);

102 if(
ªvî£_‰ì
 == 0){

103 
ªvî£_‰ì
 =Ñeverse_free;

110  
Æloc_blk
;

111 
	}
}

114 
	$ªvî£_m≠_check_sync
(
hdd_blk
){

118 
	}
}

121 
	$ªvî£_m≠_ªÀa£_blk
(
ssd_blk
){

122 
i
;

125 if(
ssd_blk
 < 1 || ssd_blk >
ªvî£_max_∑ges
){

126 
	`Ârötf
(
°dîr
, " invÆid ssd blknÿ%d \n", 
ssd_blk
);

136 
ªvî£_‰ì
++;

137 
ªvî£_u£d
--;

138 
ªvî£_m≠
[
ssd_blk
] = -1;

139 
ªvî£_Æloc
 = 
ssd_blk
;

141 
	`Œ_ö£π_©_hód
(
ªvî£_‰ìq
, (*)
ssd_blk
);

143  
ssd_blk
;

144 
	}
}

147 
	$ªvî£_m≠_‰ì
(){

148 
	`‰ì
(
ªvî£_m≠
);

149 
	`Œ_ªÀa£
(
ªvî£_‰ìq
);

150 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_map.h

12 #i‚de‡
_DISKSIM_FCL_MAP_H


13 
	#_DISKSIM_FCL_MAP_H


	)

16 
ªvî£_gë_blk
(
ssdblk
);

17 
ªvî£_m≠_¸óã
(
max
);

18 
ªvî£_m≠_Æloc_blk
(
hdd_blk
);

19 
ªvî£_m≠_ªÀa£_blk
(
ssd_blk
);

20 
ªvî£_m≠_‰ì
();

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_rw_cache.c

1 
	~<°dio.h
>

2 
	~"ˇche.h
"

3 
	~"ssd_utûs.h
"

4 
	~"disksim_öãrÁ˚.h
"

5 
	~"disksim_h±ø˚.h
"

6 
	~"wow_drivî.h
"

8 
	#PAGE
 4096

	)

11 
	#READ_REQ_RATE
 (()
rc_ªad
/()
rc_tŸÆ
)

	)

12 
	#WRITE_REQ_RATE
 (()
rc_wrôe
/()
rc_tŸÆ
)

	)

14 
	#RS_SERVICE_RATE
 (()
ƒ_£rvi˚d_rs
/()
rc_tŸÆ
)

	)

15 
	#WS_SERVICE_RATE
 (()
ƒ_£rvi˚d_ws
/()
rc_tŸÆ
)

	)

17 
	#UP
 1

	)

18 
	#DOWN
 0

	)

21 
	#MAX_DIRECTION
 8

	)

22 
	#R1U0
 0

	)

23 
	#R1U1
 1

	)

24 
	#R0U1
 2

	)

25 
	#R_U1
 3

	)

26 
	#R_U0
 4

	)

27 
	#R_U_
 5

	)

28 
	#R0U_
 6

	)

29 
	#R1U_
 7

	)

31 
	#DIR0
 
R1U0


	)

32 
	#DIR1
 
R1U1


	)

33 
	#DIR2
 
R0U1


	)

34 
	#DIR3
 
R_U1


	)

35 
	#DIR4
 
R_U0


	)

36 
	#DIR5
 
R_U_


	)

37 
	#DIR6
 
R0U_


	)

38 
	#DIR7
 
R1U_


	)

41 
ˇche_m™agî
 **
	gW_HIT_TRACKER
, **
	gR_HIT_TRACKER
;

42 
ˇche_m™agî
 **
	gHIT_TRACKER
;

43 
ˇche_m™agî
 *
	gR_CLOCK
, *
	gW_CLOCK
;

45 
	gg_GHOST_HIT
 = 0;

46 
	gHIT_TRACKER_NUM
;

49 
	gR_P_INC
 = 256;

50 
	gU_INC
 = 256;

51 
	gRESIZE_PERIOD
 = 0;

52 
	g™ti_tŸÆ_co°
 = 0.0;

56 
	gSSD_MAX_PAGES
 = 512*1024;

57 
	gHDD_MAX_PAGES
 = 3*1024*1024;

58 
	gSSD_USABLE_PAGES
 = 1024 * 1024;

60 
	gDRAM_MAX_PAGES
 = 8*1024;

62 
	grc_ªad
 = 0;

63 
	grc_wrôe_ö_ªad
 = 0;

64 
	grc_wrôe
 = 0;

65 
	grc_ªad_ö_wrôe
 = 0;

66 
	grc_tŸÆ
 = 0;

68 
	gƒ_£rvi˚d_rs
 = 0;

69 
	gƒ_£rvi˚d_ws
 = 0;

71 
	gS_READ
 = 0;

72 
	gS_WRITE
 = 0;

73 
	gS_TOTAL
 = 0;

74 
	gR_VALUE
 = 50;

76 *
	gªvî£_m≠
;

77 
	gªvî£_‰ì
 = 0;

78 
	gªvî£_u£d
 = 0;

79 
	gªvî£_Æloc
 = 0;

80 
	gªvî£_max_∑ges
 = 0;

81 
li°node
 *
	gªvî£_‰ìq
;

83 
now
;

87 
	gHDD_CRPOS
 = 4400;

88 
	gHDD_CWPOS
 = 4900;

89 
	gHDD_BANDWIDTH
 = 72;

91 
	gSSD_PROG
 = 200;

92 
	gSSD_ERASE
 = 1500;

93 
	gSSD_READ
 = 25;

94 
	gSSD_NP
 = 64;

95 
	gSSD_BUS
 = 1000;

98 
	gHDD_COUNT_W
 = 0;

99 
	gHDD_COUNT_R
 = 0;

100 
	gHDD_TOTALCOST_W
 = 0.0;

101 
	gHDD_TOTALCOST_R
 = 0.0;

103 
	gSSD_COUNT_W
 = 0;

104 
	gSSD_COUNT_R
 = 0;

105 
	gSSD_TOTALCOST_W
 = 0.0;

106 
	gSSD_TOTALCOST_R
 = 0.0;

108 
	gSSD_COUNT_PREDICT_R
 = 0;

109 
	gSSD_COUNT_PREDICT_W
 = 0;

110 
	gSSD_TOTALCOST_PREDICT_W
 = 0.0;

111 
	gSSD_TOTALCOST_PREDICT_R
 = 0.0;

113 
	gDESTAGE_TIME
 = 0.0;

114 
	gDESTAGE_SSD_READ
 = 0.0;

115 
	gDESTAGE_HDD_WRITE
 = 0.0;

117 
	gSTAGE_TIME
 = 0.0;

118 
	gSTAGE_SSD_WRITE
 = 0.0;

119 
	gSTAGE_HDD_READ
 = 0.0;

121 
	gSSD_READ_TIME
 = 0.0;

122 
	gSSD_WRITE_TIME
 = 0.0;

125 
FCM_REQ_FLAG
;

127 
ˇche_m™agî
 *
	gdøm_ˇche
;

128 
ˇche_m™agî
 *
	g£q_dëe˘‹
;

131 
	gSEQ_COUNT
 = 32;

133 
°©_upd©e
 (
°©gí
 *
°©±r
, 
vÆue
);

134 
	gu_èbÀ
[1000];

137 
ˇlc_tŸÆ_co°
–
ˇche_m™agî
 **
W_HIT_TRACKER
,

138 
ˇche_m™agî
 **
R_HIT_TRACKER
,

139 
åackî_num
,

140 
ˇche_size
,

141 
r_p_øã
,

142 
dúe˘i⁄
,

143 
u_sˇÀ
,

144 
r_sˇÀ
,

145 
u£_dúe˘i⁄


147 
Ãu_Êush_ªqli°
(
ˇche_m™agî
 *
c
, 
devno
, 
rw
, 
li°node
 *
Qli°
,
åim
);

150 
	$SSD_GC
(
u
){

151  (()
u
*
SSD_NP
*(
SSD_PROG
+
SSD_READ
Ë+ ()
SSD_ERASE
);

152 
	}
}

154 
	$SSD_PW
(
u
){

156  (()
	`SSD_GC
(
u
)/((()1-u)*
SSD_NP
Ë+ ()
SSD_PROG
 + 
SSD_BUS
);

157 
	}
}

160 
	$HDD_COST
(
rw
){

161 
co°
;

163 if(
rw
 =
READ
){

164 
co°
 = ()(()
HDD_CRPOS
 + ()
PAGE
/(1024*1024)/
HDD_BANDWIDTH
*1000000);

167 
co°
 = ()(()
HDD_CWPOS
 + ()
PAGE
/(1024*1024)/
HDD_BANDWIDTH
*1000000);

171  
co°
;

172 
	}
}

174 
	$rw_£t_∑øms
(
ssd_t
 *
curssd
){

175 
SSD_PROG
 = 
curssd
->
∑øms
.
∑ge_wrôe_œãncy
*1000;

176 
SSD_READ
 = 
curssd
->
∑øms
.
∑ge_ªad_œãncy
*1000;

177 
SSD_ERASE
 = 
curssd
->
∑øms
.
block_îa£_œãncy
*1000;

178 
SSD_NP
 = 
curssd
->
∑øms
.
∑ges_≥r_block
;

179 
SSD_BUS
 = 8 * (
SSD_BYTES_PER_SECTOR
Ë* 
curssd
->
∑øms
.
chù_x„r_œãncy
 * 1000;

180 
	}
}

183 
	$ssd_¥edi˘_utû2
(
diskUéz
){

184  
u_èbÀ
[()(
diskUéz
*1000)];

185 
	}
}

189 
	$ssd_¥edi˘_utû
(
diskUéz
){

190 
thªshﬁd
 = 1e-9;

191 
i
, 
max
;

193 
u1
, 
u2
, 
u
;

194 
disku1
, 
disku2
, 
disku
;

197 
i
 = 0;

198 
max
 = 10000;

199 
disku1
 = 
u1
 = 0;

200 
disku2
 = 
u2
 = 1;

201 
u2
 - 
u1
 > 
thªshﬁd
) {

202 
u
 = (
u1
+
u2
)/2;

204 
disku
 = (
u
 - 1.0Ë/ 
	`log
(u);

205 i‡(
diskUéz
 > 
disku
) {

206 
u1
 = 
u
;

207 
disku1
 = 
disku
;

209 
u2
 = 
u
;

210 
disku2
 = 
disku
;

213 i‡(
i
++ > 
max
) {

214 
	`¥ötf
("C™nŸ föd sﬁuti⁄: %lf", 
diskUéz
);

215 
	`exô
(1);

220  ()(
u1
+
u2
)/()2;

221 
	}
}

225 
	$make_uèbÀ
(){

226 
i
;

228 
i
 = 0;i < 1000;i++){

229 
u_èbÀ
[
i
] = 
	`ssd_¥edi˘_utû
(()i/1000);

232 
	}
}

235 
	$ˇlc_ªad_co°
(
tŸÆ
, 
ˇche_size
, 
hô_øtio
){

236 
co°
;

237 
u
;

238 
pw
;

240 
u
 = 
	`ssd_¥edi˘_utû
(()
ˇche_size
/
tŸÆ
);

242 
u
 = 
	`ssd_¥edi˘_utû2
(()
ˇche_size
/
tŸÆ
);

244 
pw
 = 
	`SSD_PW
(
u
);

246 
co°
 = 
hô_øtio
 * (
SSD_READ
 + 
SSD_BUS
Ë+ (1-hô_øtioË* (
	`HDD_COST
(
READ
Ë+ 
pw
);

248  
co°
;

249 
	}
}

252 
	$ˇlc_ªad_gc_co°
(
tŸÆ
, 
ˇche_size
, 
hô_øtio
){

253 
co°
;

254 
u
;

255 
pw
;

257 
u
 = 
	`ssd_¥edi˘_utû2
(()
ˇche_size
/
tŸÆ
);

259 
pw
 = 
	`SSD_PW
(
u
);

261 
co°
 = (1-
hô_øtio
)*(
pw
);

263  
co°
;

264 
	}
}

269 
	$ˇlc_wrôe_gc_co°
(
tŸÆ
, 
ˇche_size
, 
hô_øtio
, 
rhô_øtio_ö_wrôe
){

270 
co°
;

271 
u
;

272 
pw
;

273 
Cwh
;

276 
u
 = 
	`ssd_¥edi˘_utû
(()
ˇche_size
/
tŸÆ
);

278 
u
 = 
	`ssd_¥edi˘_utû2
(()
ˇche_size
/
tŸÆ
);

281 
pw
 = 
	`SSD_PW
(
u
);

283 
Cwh
 = (1-
rhô_øtio_ö_wrôe
Ë* (
pw
);

284 
co°
 = 
hô_øtio
 * 
Cwh
 + ()(1-hô_øtioË* (
pw
);

286  
co°
;

287 
	}
}

291 
	$ˇlc_wrôe_co°
(
tŸÆ
, 
ˇche_size
, 
hô_øtio
, 
rhô_øtio_ö_wrôe
){

292 
co°
;

293 
u
;

294 
pw
;

295 
Cwh
;

298 
u
 = 
	`ssd_¥edi˘_utû
(()
ˇche_size
/
tŸÆ
);

300 
u
 = 
	`ssd_¥edi˘_utû2
(()
ˇche_size
/
tŸÆ
);

303 
pw
 = 
	`SSD_PW
(
u
);

306 
Cwh
 = (1-
rhô_øtio_ö_wrôe
Ë* (
pw
Ë+Ñhô_øtio_ö_wrôê* (
SSD_READ
 + 
SSD_BUS
);

307 
co°
 = 
hô_øtio
 * 
Cwh
 + ()(1-hô_øtioË* (
	`HDD_COST
(
WRITE
Ë+ (
SSD_READ
 + 
SSD_BUS
Ë+ 
pw
);

309  
co°
;

310 
	}
}

312 
	$s‹t_fun˘i⁄
(c⁄° *
a
,c⁄° *
b
){

313 if(*(*)
a
 < *(*)
b
)

315 if(*(*)
a
 =*(*)
b
)

319 
	}
}

323 
	$move_to_dúe˘i⁄
(*
u
, *
r
, 
dúe˘i⁄
, 
u_sˇÀ
, 
r_sˇÀ
){

325 if(
dúe˘i⁄
 =
R1U0
){

326 (*
r
Ë+(
R_P_INC
 * 
r_sˇÀ
);

327 }if(
dúe˘i⁄
 =
R1U1
){

328 (*
r
Ë+(
R_P_INC
 * 
r_sˇÀ
);

329 (*
u
Ë+(
U_INC
 * 
u_sˇÀ
);

330 }if(
dúe˘i⁄
 =
R0U1
){

331 (*
u
Ë+(
U_INC
 * 
u_sˇÀ
);

332 }if(
dúe˘i⁄
 =
R_U1
){

333 (*
r
Ë-(
R_P_INC
 * 
r_sˇÀ
);

334 (*
u
Ë+(
U_INC
 * 
u_sˇÀ
);

335 }if(
dúe˘i⁄
 =
R_U0
){

336 (*
r
Ë-(
R_P_INC
 * 
r_sˇÀ
);

337 }if(
dúe˘i⁄
 =
R_U_
){

338 (*
r
Ë-(
R_P_INC
 * 
r_sˇÀ
);

339 (*
u
Ë-(
U_INC
 * 
u_sˇÀ
);

340 }if(
dúe˘i⁄
 =
R0U_
){

341 (*
u
Ë-(
U_INC
 * 
u_sˇÀ
);

342 }if(
dúe˘i⁄
 =
R1U_
){

343 (*
r
Ë+(
R_P_INC
 * 
r_sˇÀ
);

344 (*
u
Ë-(
U_INC
 * 
u_sˇÀ
);

347 
	}
}

349 
Wow_Max_High_W©î
;

351 
	$ˇlc_rw_∑πôi⁄_size
(
ˇche_size
, 
r_p_øã
, *
r_sz
,*
w_sz
,
u_öc
, 
r_öc
){

352 
u_sz
;

353 
ªmaö
 = 0;

354 
u_sz
 = 
ˇche_size
 + 
u_öc
;

359 
r_p_øã
 +
r_öc
;

360 *
r_sz
 = 
r_p_øã
 * 
u_sz
 / 100;

361 *
w_sz
 = (100-
r_p_øã
Ë* 
u_sz
 / 100;

364 
ªmaö
 = 
u_sz
 - (*
r_sz
 + *
w_sz
);

365 if(
ªmaö
)

366 *
r_sz
 +
ªmaö
;

372 if(
u_sz
 > 
SSD_MAX_PAGES
 || u_sz <=0){

373 
	`Ârötf
(
°dout
, " invÆid d©®sizê%d \n", 
u_sz
);

374 
	`fÊush
(
°dout
);

378 if(
r_p_øã
 >= 100 ||Ñ_p_rate <= 0){

379 
	`Ârötf
(
°dout
, " invÆidÑódÑ©ê%d \n", 
r_p_øã
);

380 
	`fÊush
(
°dout
);

385 
	}
}

387 
	$¥öt_hô_øtio
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
,
is_ªad
){

388 
j
;

389 
tŸÆ1
, 
tŸÆ2
 = 0;

390 
wödow
;

391 
ödex
;

392 
co°
;

394 
wödow
 = 
SSD_MAX_PAGES
/
Ãu_num
;

395 if(
is_ªad
){

400 
ödex
 = 
S_TOTAL
/
wödow
;

401 if(
S_TOTAL
%
wödow
)

402 
ödex
++;

408 
ödex
 = 
S_TOTAL
/
wödow
;

409 if(
S_TOTAL
%
wödow
)

410 
ödex
++;

413 
j
 = 0;j < 
Ãu_num
;j++){

414 
tŸÆ1
 = 
tŸÆ2
;

415 
tŸÆ2
 +
Ãu_m™agî
[
j
]->
cm_hô
;

418 
co°
 = ()
	`ˇlc_tŸÆ_co°
(
W_HIT_TRACKER
, 
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
,

419 
SSD_MAX_PAGES
/
HIT_TRACKER_NUM
*(
j
+1),

420 ()
R_VALUE
, 0, 0, 0,0);

422 if(
is_ªad
)

423 if(
j
 =
ödex
){

424 
	`¥ötf
("R %d = %.5f, MG = %.5‡C = %.3‡[*]\n", 
j
+1, ()
tŸÆ2
/
rc_ªad
, (ÈŸÆ2/rc_ªad - ()
tŸÆ1
/rc_read,

425 
co°
);

427 
	`¥ötf
("R %d = %.5f, MG = %.5‡C = %.3‡\n", 
j
+1, ()
tŸÆ2
/
rc_ªad
, (ÈŸÆ2/rc_ªad - ()
tŸÆ1
/rc_read,

428 
co°
);

431 if(
j
 =
ödex
){

432 
	`¥ötf
("W %d = %.5f, MG = %.5‡C = %.3‡[*]\n", 
j
+1, ()
tŸÆ2
/
rc_wrôe
, (ÈŸÆ2/rc_wrôê- ()
tŸÆ1
/rc_write,

433 
co°
);

435 
	`¥ötf
("W %d = %.5f, MG = %.5f, C = %.3f\n", 
j
+1, ()
tŸÆ2
/
rc_wrôe
, (ÈŸÆ2/rc_wrôê- ()
tŸÆ1
/rc_write,

436 
co°
);

442 
	}
}

445 
	$¥edi˘_hô_øtio
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
, 
size
,
max_∑ges
,
is_ªad
){

446 
j
;

447 
tŸÆ1
 = 0, 
tŸÆ2
 = 0;

448 
rhô1
 = 0, 
rhô2
 = 0;

449 
ödex
 =0;

450 
wödow
;

451 
h_wödow
;

452 
r_wödow
;

453 
n
;

454 
hô
;

456 
wödow
 = 
max_∑ges
/
Ãu_num
;

457 
ödex
 = 
size
/
wödow
;

458 if(
size
%
wödow
)

459 
ödex
++;

461 
j
 = 0;j < 
ödex
;j++){

462 
tŸÆ1
 = 
tŸÆ2
;

463 
rhô1
 = 
rhô2
;

465 if(
is_ªad
 =
READ
)

466 
tŸÆ2
 +
Ãu_m™agî
[
j
]->
cm_hô
;

467 if(
is_ªad
 =
WRITE
)

468 
tŸÆ2
 +(
Ãu_m™agî
[
j
]->
cm_hô
);

469 if(
is_ªad
 =
READWRITE
){

470 
tŸÆ2
 +()
Ãu_m™agî
[
j
]->
cm_hô
;

471 
rhô2
 +()
Ãu_m™agî
[
j
]->
cm_ªad_hô
;

472 if(
Ãu_m™agî
[
j
]->
cm_hô
 <Üru_m™agî[j]->
cm_ªad_hô
)

473 
j
 = j;

478 
n
 = ()(
size
%
wödow
)/(()window/10);

479 
h_wödow
 =()(
tŸÆ2
 - 
tŸÆ1
)/10;

486 if(
is_ªad
 =
READWRITE
){

488 if(
tŸÆ1
 != 0.0)

489 
rhô1
/=
tŸÆ1
;

491 
rhô1
 = 0.0;

494 if(
tŸÆ2
 != 0.0)

495 
rhô2
/=
tŸÆ2
;

497 
rhô2
 = 0.0;

499 
h_wödow
 = ()(
rhô2
-
rhô1
)/10;

500 
tŸÆ1
 = 
rhô1
;

504 if(
is_ªad
 =
READ
)

505 
hô
 = ()(
tŸÆ1
 + 
h_wödow
 * 
n
)/
Ãu_m™agî
[0]->
cm_ªf
;

506 if(
is_ªad
 =
WRITE
)

507 
hô
 = ()(
tŸÆ1
 + 
h_wödow
 * 
n
)/(
Ãu_m™agî
[0]->
cm_ªf
);

508 if(
is_ªad
 =
READWRITE
){

509 
hô
 = ()(
tŸÆ1
 + 
h_wödow
 * 
n
);

511 if(
hô
 < 0.0 || hit > 1.0){

512 
hô
 = hit;

517  
hô
;

518 
	}
}

520 
	$¥edi˘_hô_cou¡
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
, 
size
,
max_∑ges
,
is_ªad
){

521 
j
;

522 
tŸÆ1
 = 0, 
tŸÆ2
 = 0;

523 
rhô1
 = 0, 
rhô2
 = 0;

524 
ödex
 =0;

525 
wödow
;

526 
h_wödow
;

527 
r_wödow
;

528 
n
;

529 
hô
;

531 
wödow
 = 
max_∑ges
/
Ãu_num
;

532 
ödex
 = 
size
/
wödow
;

533 if(
size
%
wödow
)

534 
ödex
++;

536 
j
 = 0;j < 
ödex
;j++){

537 
tŸÆ1
 = 
tŸÆ2
;

538 
rhô1
 = 
rhô2
;

540 if(
is_ªad
 =
READ
)

541 
tŸÆ2
 +
Ãu_m™agî
[
j
]->
cm_hô
;

542 if(
is_ªad
 =
WRITE
)

543 
tŸÆ2
 +(
Ãu_m™agî
[
j
]->
cm_hô
);

544 if(
is_ªad
 =
READWRITE
){

545 
tŸÆ2
 +()
Ãu_m™agî
[
j
]->
cm_hô
;

546 
rhô2
 +()
Ãu_m™agî
[
j
]->
cm_ªad_hô
;

547 if(
Ãu_m™agî
[
j
]->
cm_hô
 <Üru_m™agî[j]->
cm_ªad_hô
)

548 
j
 = j;

553 
n
 = ()(
size
%
wödow
)/(()window/10);

554 
h_wödow
 =()(
tŸÆ2
 - 
tŸÆ1
)/10;

561 if(
is_ªad
 =
READWRITE
){

563 if(
tŸÆ1
 != 0.0)

564 
rhô1
/=
tŸÆ1
;

566 
rhô1
 = 0.0;

569 if(
tŸÆ2
 != 0.0)

570 
rhô2
/=
tŸÆ2
;

572 
rhô2
 = 0.0;

574 
h_wödow
 = ()(
rhô2
-
rhô1
)/10;

575 
tŸÆ1
 = 
rhô1
;

579 if(
is_ªad
 =
READ
)

580 
hô
 = ()(
tŸÆ1
 + 
h_wödow
 * 
n
);

581 if(
is_ªad
 =
WRITE
)

582 
hô
 = ()(
tŸÆ1
 + 
h_wödow
 * 
n
);

583 if(
is_ªad
 =
READWRITE
){

584 
hô
 = ()(
tŸÆ1
 + 
h_wödow
 * 
n
);

586 if(
hô
 < 0.0 || hit > 1.0){

587 
hô
 = hit;

592  
hô
;

593 
	}
}

595 
	$ˇlc_wrôe⁄ly_co°
(
ˇche_m™agî
 **
HIT_TRACKER
,

596 
åackî_num
,

597 
ˇche_size


599 
w_hô
;

601 
w_co°
;

604 
t_size
;

605 
w_size
;

606 
r_size
;

607 
u_öc
 = 0, 
r_öc
 = 0;

612 
	`ˇlc_rw_∑πôi⁄_size
(
ˇche_size
, 0, &
r_size
, &
w_size
, 
u_öc
, 
r_öc
);

615 
t_size
 = 
w_size
 + 
r_size
;

617 
w_hô
 = ()
	`¥edi˘_hô_øtio
(
W_HIT_TRACKER
, 
åackî_num
, 
w_size
, 
SSD_MAX_PAGES
, 
WRITE
);

619 
w_co°
 = 
	`ˇlc_wrôe_co°
(
SSD_MAX_PAGES
, 
t_size
, 
w_hô
, 0.0);

625  
w_co°
;

626 
	}
}

629 
	$ˇlc_ªad⁄ly_co°
(
ˇche_m™agî
 **
HIT_TRACKER
,

630 
åackî_num
,

631 
ˇche_size


633 
w_hô
;

634 
r_hô
;

635 
w_co°
;

636 
r_co°
;

637 
c_co°
;

638 
t_size
;

639 
w_size
;

640 
r_size
;

641 
u_öc
 = 0, 
r_öc
 = 0;

646 
	`ˇlc_rw_∑πôi⁄_size
(
ˇche_size
, 100, &
r_size
, &
w_size
, 
u_öc
, 
r_öc
);

649 
t_size
 = 
w_size
 + 
r_size
;

652 
r_hô
 = ()
	`¥edi˘_hô_øtio
(
R_HIT_TRACKER
, 
åackî_num
, 
r_size
, 
SSD_MAX_PAGES
, 
READ
);

654 
r_co°
 = 
	`ˇlc_ªad_co°
(
SSD_MAX_PAGES
, 
t_size
, 
r_hô
);

659  
r_co°
;

660 
	}
}

664 
	$ˇlc_tŸÆ_co°
–
ˇche_m™agî
 **
W_HIT_TRACKER
,

665 
ˇche_m™agî
 **
R_HIT_TRACKER
,

666 
åackî_num
,

667 
ˇche_size
,

668 
r_p_øã
,

669 
dúe˘i⁄
,

670 
u_sˇÀ
,

671 
r_sˇÀ
,

672 
u£_dúe˘i⁄


674 
w_hô
;

675 
rhô_øtio_ö_wrôe
;

676 
r_hô
;

677 
w_co°
;

678 
r_co°
;

679 
c_co°
;

680 
r_øã
;

681 
t_size
;

682 
w_size
;

683 
r_size
;

684 
w_cou¡
 = 0, 
r_cou¡
 = 0;

685 
u_öc
 = 0, 
r_öc
 = 0;

687 if(
u£_dúe˘i⁄
)

688 
	`move_to_dúe˘i⁄
(&
u_öc
, &
r_öc
, 
dúe˘i⁄
, 
u_sˇÀ
, 
r_sˇÀ
);

690 if(
	`ˇlc_rw_∑πôi⁄_size
(
ˇche_size
, 
r_p_øã
, &
r_size
, &
w_size
, 
u_öc
, 
r_öc
) < 0)

693 
t_size
 = 
w_size
 + 
r_size
;

698 if(
W_CLOCK
->
cm_pﬁicy
 =
CACHE_LRU_RWO_ADAPTIVE
){

699 
w_hô
 = ()
	`¥edi˘_hô_øtio
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
w_size
, 
SSD_MAX_PAGES
, 
WRITE
);

700 
rhô_øtio_ö_wrôe
 = ()
	`¥edi˘_hô_øtio
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
w_size
, 
SSD_MAX_PAGES
, 
READWRITE
);

701 
r_hô
 = ()
	`¥edi˘_hô_øtio
(
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
r_size
, 
SSD_MAX_PAGES
, 
READ
);

703 
w_hô
 = ()
	`¥edi˘_hô_øtio
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
w_size
, 
SSD_USABLE_PAGES
, 
WRITE
);

704 
rhô_øtio_ö_wrôe
 = ()
	`¥edi˘_hô_øtio
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
w_size
, 
SSD_USABLE_PAGES
, 
READWRITE
);

705 
r_hô
 = ()
	`¥edi˘_hô_øtio
(
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
r_size
, 
SSD_USABLE_PAGES
, 
READ
);

710 
w_co°
 = 
	`ˇlc_wrôe_co°
(
SSD_MAX_PAGES
, 
t_size
, 
w_hô
, 
rhô_øtio_ö_wrôe
);

711 
r_co°
 = 
	`ˇlc_ªad_co°
(
SSD_MAX_PAGES
, 
t_size
, 
r_hô
);

719 
r_øã
 = 
READ_REQ_RATE
;

725 
c_co°
 = 
r_co°
 * 
r_øã
 + 
w_co°
 * (1 -Ñ_rate);

729 
	`fÊush
(
°dout
);

733  
c_co°
;

734 
	}
}

738 
	$ˇlc_gc_tŸÆ_co°
–
ˇche_m™agî
 **
W_HIT_TRACKER
,

739 
ˇche_m™agî
 **
R_HIT_TRACKER
,

740 
åackî_num
,

741 
ˇche_size
,

742 
r_p_øã
,

743 
dúe˘i⁄
,

744 
u_sˇÀ
,

745 
r_sˇÀ
,

746 
u£_dúe˘i⁄


748 
w_hô
;

749 
rhô_øtio_ö_wrôe
;

750 
r_hô
;

751 
w_co°
;

752 
r_co°
;

753 
c_co°
;

754 
r_øã
;

755 
t_size
;

756 
w_size
;

757 
r_size
;

758 
w_cou¡
 = 0, 
r_cou¡
 = 0;

759 
u_öc
 = 0, 
r_öc
 = 0;

761 if(
u£_dúe˘i⁄
)

762 
	`move_to_dúe˘i⁄
(&
u_öc
, &
r_öc
, 
dúe˘i⁄
, 
u_sˇÀ
, 
r_sˇÀ
);

764 if(
	`ˇlc_rw_∑πôi⁄_size
(
ˇche_size
, 
r_p_øã
, &
r_size
, &
w_size
, 
u_öc
, 
r_öc
) < 0)

767 
t_size
 = 
w_size
 + 
r_size
;

770 if(
W_CLOCK
->
cm_pﬁicy
 =
CACHE_LRU_RWO_ADAPTIVE
){

771 
w_hô
 = ()
	`¥edi˘_hô_øtio
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
w_size
, 
SSD_MAX_PAGES
, 
WRITE
);

772 
rhô_øtio_ö_wrôe
 = ()
	`¥edi˘_hô_øtio
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
w_size
, 
SSD_MAX_PAGES
, 
READWRITE
);

773 
r_hô
 = ()
	`¥edi˘_hô_øtio
(
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
r_size
, 
SSD_MAX_PAGES
, 
READ
);

775 
w_hô
 = ()
	`¥edi˘_hô_øtio
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
w_size
, 
SSD_USABLE_PAGES
, 
WRITE
);

776 
rhô_øtio_ö_wrôe
 = ()
	`¥edi˘_hô_øtio
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
w_size
, 
SSD_USABLE_PAGES
, 
READWRITE
);

777 
r_hô
 = ()
	`¥edi˘_hô_øtio
(
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
r_size
, 
SSD_USABLE_PAGES
, 
READ
);

782 
w_co°
 = 
	`ˇlc_wrôe_gc_co°
(
SSD_MAX_PAGES
, 
t_size
, 
w_hô
, 
rhô_øtio_ö_wrôe
);

783 
r_co°
 = 
	`ˇlc_ªad_gc_co°
(
SSD_MAX_PAGES
, 
t_size
, 
r_hô
);

787 
r_øã
 = 
READ_REQ_RATE
;

793 
c_co°
 = 
r_co°
 * 
r_øã
 + 
w_co°
 * (1 -Ñ_rate);

797 
	`fÊush
(
°dout
);

801  
c_co°
;

802 
	}
}

807 
	gªsize_cou¡
 = 0;

809 
	$adju°_afcm_ˇche_size
(
ˇche_m™agî
 **
w_åackî
,

810 
ˇche_m™agî
 **
r_åackî
,

811 
åackî_num
,

812 
u_sˇÀ
,

813 
r_sˇÀ
)

815 
co°
[
MAX_DIRECTION
];

816 
gaö
[
MAX_DIRECTION
];

817 
cur_co°
;

818 
max_gaö
;

819 *
globÆ_co°
;

820 
mö_co°
;

821 
mö_i
,
mö_j
;

822 
mö_dúe˘i⁄
 = 0;

823 
i
, 
j
;

824 
r_°ï
;

825 
°ï
;

826 
èrgë_tŸÆ
;

827 
max_°ï
 = 
SSD_MAX_PAGES
/
HIT_TRACKER_NUM
;

828 
√w_s_wrôe
 = 0, 
√w_s_ªad
 = 0;

831 
cur_co°
 = 
	`ˇlc_tŸÆ_co°
(
w_åackî
, 
r_åackî
, 
åackî_num
, 
S_TOTAL
, 
R_VALUE
, 
MAX_DIRECTION
, 
u_sˇÀ
, 
r_sˇÀ
, 1);

832 
i
 = 0;ò< 
MAX_DIRECTION
;i++){

833 
co°
[
i
] = 
	`ˇlc_tŸÆ_co°
(
w_åackî
, 
r_åackî
, 
åackî_num
,
S_TOTAL
, 
R_VALUE
, i, 
u_sˇÀ
, 
r_sˇÀ
, 1);

834 
gaö
[
i
] = 
cur_co°
 - 
co°
[i];

837 
mö_dúe˘i⁄
 = -1;

838 
max_gaö
 = 0.0;

839 if(
gaö
[0] > 0){

840 
max_gaö
 = 
gaö
[0];

841 
mö_dúe˘i⁄
 = 0;

844 
i
 = 1;i< 
MAX_DIRECTION
;i++){

845 if(
max_gaö
 < 
gaö
[
i
]){

846 
max_gaö
 = 
gaö
[
i
];

847 
mö_dúe˘i⁄
 = 
i
;

852 if(
mö_dúe˘i⁄
 >= 0){

853 
	`move_to_dúe˘i⁄
(&
S_TOTAL
, &
R_VALUE
, 
mö_dúe˘i⁄
, 
u_sˇÀ
, 
r_sˇÀ
);

854 
	`ˇlc_rw_∑πôi⁄_size
(
S_TOTAL
, 
R_VALUE
, &
S_READ
, &
S_WRITE
, 0, 0);

862 
r_°ï
 = 
HIT_TRACKER_NUM
;

864 
r_°ï
 *= 2;

868 
globÆ_co°
 = (*)
	`mÆloc
((Ë* 
åackî_num
 * 
r_°ï
);

869 
	`mem£t
(
globÆ_co°
, 0x00, (Ë* 
åackî_num
 * 
r_°ï
);

872 
i
 = 1;ò< 
HIT_TRACKER_NUM
; i++){

873 
j
 = 1;j < 
r_°ï
;j++){

875 
globÆ_co°
[
i
*
r_°ï
 + 
j
] = 
	`ˇlc_tŸÆ_co°
(
w_åackî
, 
r_åackî
, 
HIT_TRACKER_NUM
,

876 
SSD_MAX_PAGES
/
HIT_TRACKER_NUM
*
i
,

877 ()
j
*100/
r_°ï
,

880 
globÆ_co°
[
i
*
r_°ï
 + 
j
] = 
	`ˇlc_gc_tŸÆ_co°
(
w_åackî
, 
r_åackî
, 
HIT_TRACKER_NUM
,

881 
SSD_MAX_PAGES
/
HIT_TRACKER_NUM
*
i
,

882 ()
j
*100/
r_°ï
,

886 if(
i
 =1 && 
j
 == 1){

887 
mö_co°
 = 
globÆ_co°
[
i
*
r_°ï
 + 
j
];

888 
mö_i
 = 0;

889 
mö_j
 = 0;

891 if(
mö_co°
 > 
globÆ_co°
[
i
*
r_°ï
 + 
j
]){

893 
mö_co°
 = 
globÆ_co°
[
i
*
r_°ï
 + 
j
];

894 
mö_i
 = 
i
;

895 
mö_j
 = 
j
;

902 
	`‰ì
(
globÆ_co°
);

903 if(
mö_i
 == 15)

904 
mö_i
 = min_i;

907 
R_VALUE
 = ()(
mö_j
)*100/
r_°ï
;

909 if(
HIT_TRACKER_NUM
 < 16){

910 
èrgë_tŸÆ
 =(
mö_i
)*(
SSD_MAX_PAGES
/
HIT_TRACKER_NUM
);

911 
èrgë_tŸÆ
 +(
SSD_MAX_PAGES
/16);

913 
èrgë_tŸÆ
 =(
mö_i
)*(
SSD_MAX_PAGES
/
HIT_TRACKER_NUM
);

915 
	`Ârötf
(
°dout
, " O±imÆ u = %f,Ñ = %f\n", ()
èrgë_tŸÆ
/
SSD_MAX_PAGES
, ()
mö_j
/
r_°ï
);

933 if(
S_TOTAL
-
max_°ï
 > 
èrgë_tŸÆ
){

934 
èrgë_tŸÆ
 = 
S_TOTAL
 - 
max_°ï
/2;

935 
èrgë_tŸÆ
 = 
S_TOTAL
 - 
max_°ï
;

936 
	`Ârötf
(
°dout
, " *Conducting smoothingálgorithm .. \n");

939 
S_TOTAL
 = 
èrgë_tŸÆ
;

941 
ªsize_cou¡
++;

943 if(
S_TOTAL
 > 
Wow_Max_High_W©î
){

945 
S_TOTAL
 = 
Wow_Max_High_W©î
 -1;

958 
	`ˇlc_rw_∑πôi⁄_size
(
S_TOTAL
, 
R_VALUE
, &
√w_s_ªad
, &
√w_s_wrôe
, 0, 0);

967 if(
S_WRITE
-
max_°ï
 > 
√w_s_wrôe
){

968 
√w_s_wrôe
 = 
S_WRITE
 - 
max_°ï
;

969 
√w_s_ªad
 = 
S_TOTAL
 - 
√w_s_wrôe
;

970 
	`Ârötf
(
°dout
, " Conducting smoothingálgorithm .. \n");

973 if(
√w_s_wrôe
 < 1024)

974 
√w_s_wrôe
 = 2048;

976 
√w_s_ªad
 = 
S_TOTAL
 - 
√w_s_wrôe
;

979 
S_READ
 = 
√w_s_ªad
;

980 
S_WRITE
 = 
√w_s_wrôe
;

996  
mö_dúe˘i⁄
;

997 
	}
}

1001 
	$adju°_fcmrw_ˇche_size
(
ˇche_m™agî
 **
w_åackî
,

1002 
ˇche_m™agî
 **
r_åackî
,

1003 
åackî_num
,

1004 
u_sˇÀ
,

1005 
r_sˇÀ
)

1007 
i
;

1008 
max
;

1009 
w_diff
;

1010 
èrgë_wrôe
 = 0, 
èrgë_ªad
 = 0;

1011 
wö
 = 0;

1012 
max_hô
 = 0;

1013 
max_pos
 = 0;

1015 
max
 = 
SSD_USABLE_PAGES
/(
SSD_MAX_PAGES
/
åackî_num
);

1016 
wö
 = 
SSD_MAX_PAGES
/
åackî_num
;

1018 
i
 = 1;ò< 
max
;i++){

1019 
whô
 = 
	`¥edi˘_hô_øtio
(
w_åackî
, 
åackî_num
, (
SSD_MAX_PAGES
/åackî_numË* 
i
, SSD_MAX_PAGES, 0);

1020 
rhô
 = 
	`¥edi˘_hô_øtio
(
r_åackî
, 
åackî_num
, (
SSD_MAX_PAGES
/åackî_numË* (
max
-
i
), SSD_MAX_PAGES, 0);

1022 if(
whô
 + 
rhô
 > 
max_hô
){

1023 
max_hô
 = 
whô
+
rhô
;

1024 
max_pos
 = 
i
;

1028 
èrgë_wrôe
 = ()
SSD_USABLE_PAGES
 * (()
max_pos
/
max
);

1029 
èrgë_ªad
 = 
SSD_USABLE_PAGES
 - 
èrgë_wrôe
;

1031 
èrgë_wrôe
 = ()
SSD_USABLE_PAGES
 * (1 - 
READ_REQ_RATE
);

1032 if(
èrgë_wrôe
 < 1024)

1033 
èrgë_wrôe
 = 2048;

1035 
èrgë_ªad
 = 
SSD_USABLE_PAGES
 - 
èrgë_wrôe
;

1037 if(
èrgë_ªad
 < 1024){

1038 
èrgë_ªad
 = 1024;

1040 
èrgë_wrôe
 = 
SSD_USABLE_PAGES
 - 
èrgë_ªad
;

1046 if(
S_WRITE
-
U_INC
 > 
èrgë_wrôe
){

1047 
S_WRITE
 -
U_INC
;

1048 
S_READ
 = 
SSD_USABLE_PAGES
 - 
S_WRITE
;

1050 
S_WRITE
 = 
èrgë_wrôe
;

1051 
S_READ
 = 
èrgë_ªad
;

1060 
	}
}

1063 
	$adju°_fcmrw_ˇche_size
(
ˇche_m™agî
 **
w_åackî
,

1064 
ˇche_m™agî
 **
r_åackî
,

1065 
åackî_num
,

1066 
u_sˇÀ
,

1067 
r_sˇÀ
)

1071 *
globÆ_co°
;

1072 
mö_co°
;

1073 
mö_j
;

1074 
mö_dúe˘i⁄
 = 0;

1075 
j
;

1076 
r_°ï
;

1077 
°ï
;

1078 
√w_s_ªad
 = 0, 
√w_s_wrôe
 = 0;

1079 
max_°ï
 = 0;

1080 
ªsize_c⁄du˘ed
 = 0;

1081 
cur_wrôe_‰ì
 = 
W_CLOCK
->
cm_‰ì
;

1082 
cur_ªad_‰ì
 = 
R_CLOCK
->
cm_‰ì
;

1083 
mö_ªad_size
 = 0;

1094 
ªsize_c⁄du˘ed
 = 1;

1099 
r_°ï
 = 
SSD_MAX_PAGES
/
R_P_INC
;

1102 
r_°ï
 *= 2;

1104 
max_°ï
 = 
SSD_USABLE_PAGES
/
r_°ï
;

1105 
mö_ªad_size
 = 
SSD_USABLE_PAGES
/
r_°ï
;

1108 
globÆ_co°
 = (*)
	`mÆloc
((Ë* 
r_°ï
);

1109 
	`mem£t
(
globÆ_co°
, 0x00, (Ë* 
r_°ï
);

1114 
j
 = 1;j < 
r_°ï
;j++){

1115 
globÆ_co°
[
j
] = 
	`ˇlc_tŸÆ_co°
(
w_åackî
, 
r_åackî
, 
HIT_TRACKER_NUM
,

1116 
SSD_USABLE_PAGES
,

1117 ()
j
*100/
r_°ï
,

1122 if(
j
 == 1){

1123 
mö_co°
 = 
globÆ_co°
[
j
];

1125 
mö_j
 = 1;

1127 if(
mö_co°
 > 
globÆ_co°
[
j
]){

1129 
mö_co°
 = 
globÆ_co°
[
j
];

1131 
mö_j
 = 
j
;

1137 
	`‰ì
(
globÆ_co°
);

1140 
R_VALUE
 = ()(
mö_j
)*100/
r_°ï
;

1141 
S_TOTAL
 = 
SSD_USABLE_PAGES
;

1145 
	`Ârötf
(
°dout
, " Ród %.2f, Wrôê%.2f,ÅŸÆ %f\n", ()
R_CLOCK
->
cm_cou¡
/
SSD_MAX_PAGES
, ()
W_CLOCK
->cm_count/SSD_MAX_PAGES,

1146 ()
R_CLOCK
->
cm_cou¡
/
SSD_MAX_PAGES
 + ()
W_CLOCK
->cm_count/SSD_MAX_PAGES);

1148 
ªsize_cou¡
++;

1149 
	`ˇlc_rw_∑πôi⁄_size
(
S_TOTAL
, 
R_VALUE
, &
√w_s_ªad
, &
√w_s_wrôe
, 0, 0);

1153 #ifde‡
TEST


1154 if(
cur_ªad_‰ì
 && 
cur_wrôe_‰ì
 >= 1024){

1156 
√w_s_wrôe
 = ()
SSD_USABLE_PAGES
 * (1 - 
READ_REQ_RATE
);

1159 
√w_s_wrôe
 =Çew_s_write;

1160 if(
cur_wrôe_‰ì
 >= 1024){

1161 
cur_wrôe_‰ì
 = cur_write_free;

1163 if(
cur_ªad_‰ì
)

1164 
cur_ªad_‰ì
 = cur_read_free;

1167 
	`Ârötf
(
°dout
, "*O±imÆ Ród R©ê%.2f, simïÀ = %.2‡\n", 
R_VALUE
, 
READ_REQ_RATE
*100);

1168 
	`Ârötf
(
ouçutfûe
, "*O±imÆ Ród R©ê%.2f, simïÀ = %.2‡\n", 
R_VALUE
, 
READ_REQ_RATE
*100);

1171 if(
√w_s_wrôe
 < 1024)

1172 
√w_s_wrôe
 = 2048;

1174 
√w_s_ªad
 = 
SSD_USABLE_PAGES
 - 
√w_s_wrôe
;

1176 if(
√w_s_ªad
 < 
mö_ªad_size
){

1177 
√w_s_ªad
 = 
mö_ªad_size
;

1179 
√w_s_wrôe
 = 
SSD_USABLE_PAGES
 - 
√w_s_ªad
;

1183 if(
S_WRITE
-
max_°ï
 > 
√w_s_wrôe
){

1184 
√w_s_wrôe
 = 
S_WRITE
 - 
max_°ï
;

1185 
√w_s_ªad
 = 
S_TOTAL
 - 
√w_s_wrôe
;

1186 
	`Ârötf
(
°dout
, " Conducting smoothingálgorithm Write.. \n");

1197 if(
√w_s_wrôe
 < 1024)

1198 
√w_s_wrôe
 = 2048;

1200 
√w_s_ªad
 = 
SSD_USABLE_PAGES
 - 
√w_s_wrôe
;

1203 #ifde‡
TEST


1204 if(
cur_wrôe_‰ì
 <1024 || 
cur_ªad_‰ì
 <= 0){

1206 
S_WRITE
 = 
√w_s_wrôe
;

1207 
S_READ
 = 
√w_s_ªad
;

1209 #ifde‡
TEST


1211 
	`¥ötf
("Ço change cache size ... \n");

1221 
	`¥ötf_wrôe⁄ly_co°_èbÀ
(
ˇche_m™agî
 **
w_åackî
,

1222 
ˇche_m™agî
 **
r_åackî
,

1223 
åackî_num


1226 
co°
[
MAX_DIRECTION
];

1227 
gaö
[
MAX_DIRECTION
];

1228 
cur_co°
;

1229 
max_gaö
;

1230 *
globÆ_co°
;

1231 
mö_co°
;

1232 
mö_i
 = 0,
mö_j
 = 0;

1233 
max_co°
;

1234 
max_i
 = 0, 
max_j
 = 0;

1235 
mö_dúe˘i⁄
;

1236 
i
;

1238 
u_sˇÀ
 = 1;

1239 
r_sˇÀ
 = 1;

1243 
	`Ârötf
(
ouçutfûe
, "\n Write Only Cost Table ... \n");

1250 
globÆ_co°
 = (*)
	`mÆloc
((Ë* 
åackî_num
);

1251 
	`mem£t
(
globÆ_co°
, 0x00, (Ë* 
åackî_num
);

1254 
i
 = 1;ò< 
åackî_num
; i++){

1256 
globÆ_co°
[
i
] = 
	`ˇlc_wrôe⁄ly_co°
(
w_åackî
, 
åackî_num
,

1257 
SSD_MAX_PAGES
/
åackî_num
*
i
);

1259 
	`Ârötf
(
ouçutfûe
, "%d %f\n", 
i
*100/
åackî_num
, 
globÆ_co°
[i]/1000);

1261 if(
i
 == 1){

1262 
mö_co°
 = 
globÆ_co°
[
i
];

1263 
mö_i
 = 0;

1264 
mö_j
 = 0;

1265 
max_co°
 = 
mö_co°
;

1266 
max_i
 = 
mö_i
;

1267 
max_j
 = 
mö_j
;

1270 if(
mö_co°
 > 
globÆ_co°
[
i
]){

1271 
mö_co°
 = 
globÆ_co°
[
i
];

1272 
mö_i
 = 
i
;

1275 if(
max_co°
 < 
globÆ_co°
[
i
]){

1276 
max_co°
 = 
globÆ_co°
[
i
];

1277 
max_i
 = 
i
;

1283 
	`Ârötf
(
ouçutfûe
, "\n");

1285 
	`Ârötf
(
ouçutfûe
, " Mö utû = %d, MöÑódÑ©iÿ%d, Mö co° %f\n\n", 
mö_i
*100/
åackî_num
, 
mö_j
*100/åackî_num, 
mö_co°
);

1286 
	`Ârötf
(
ouçutfûe
, " Max utû = %d, MaxÑódÑ©iÿ%d, Max co° %f\n\n", 
max_i
*100/
åackî_num
, 
max_j
*100/åackî_num, 
max_co°
);

1289 
i
 = 1;ò< 
åackî_num
; i++){

1291 
globÆ_co°
[
i
] = 
	`ˇlc_wrôe⁄ly_co°
(
w_åackî
, 
åackî_num
,

1292 
SSD_MAX_PAGES
/
åackî_num
*
i
);

1294 
	`Ârötf
(
ouçutfûe
, "%d %f\n", 
i
*100/
åackî_num
, 
globÆ_co°
[i]/
mö_co°
);

1298 
	`Ârötf
(
ouçutfûe
, "\n");

1300 
	`‰ì
(
globÆ_co°
);

1305 
	`¥ötf_ªad⁄ly_co°_èbÀ
(
ˇche_m™agî
 **
w_åackî
,

1306 
ˇche_m™agî
 **
r_åackî
,

1307 
åackî_num


1310 
co°
[
MAX_DIRECTION
];

1311 
gaö
[
MAX_DIRECTION
];

1312 
cur_co°
;

1313 
max_gaö
;

1314 *
globÆ_co°
;

1315 
mö_co°
;

1316 
mö_i
 = 0,
mö_j
 = 0;

1317 
max_co°
;

1318 
max_i
 = 0, 
max_j
 = 0;

1319 
mö_dúe˘i⁄
;

1320 
i
;

1322 
u_sˇÀ
 = 1;

1323 
r_sˇÀ
 = 1;

1327 
	`Ârötf
(
ouçutfûe
, "\n Read Only Cost Table ... \n");

1334 
globÆ_co°
 = (*)
	`mÆloc
((Ë* 
åackî_num
);

1335 
	`mem£t
(
globÆ_co°
, 0x00, (Ë* 
åackî_num
);

1338 
i
 = 1;ò< 
åackî_num
; i++){

1340 
globÆ_co°
[
i
] = 
	`ˇlc_ªad⁄ly_co°
(
r_åackî
, 
åackî_num
,

1341 
SSD_MAX_PAGES
/
åackî_num
*
i
);

1343 
	`Ârötf
(
ouçutfûe
, "%d %f\n", 
i
*100/
åackî_num
, 
globÆ_co°
[i]/1000);

1345 if(
i
 == 1){

1346 
mö_co°
 = 
globÆ_co°
[
i
];

1347 
mö_i
 = 0;

1348 
mö_j
 = 0;

1349 
max_co°
 = 
mö_co°
;

1350 
max_i
 = 
mö_i
;

1351 
max_j
 = 
mö_j
;

1354 if(
mö_co°
 > 
globÆ_co°
[
i
]){

1355 
mö_co°
 = 
globÆ_co°
[
i
];

1356 
mö_i
 = 
i
;

1359 if(
max_co°
 < 
globÆ_co°
[
i
]){

1360 
max_co°
 = 
globÆ_co°
[
i
];

1361 
max_i
 = 
i
;

1367 
	`Ârötf
(
ouçutfûe
, "\n");

1369 
	`Ârötf
(
ouçutfûe
, " Mö utû = %d, MöÑódÑ©iÿ%d, Mö co° %f\n\n", 
mö_i
*100/
åackî_num
, 
mö_j
*100/åackî_num, 
mö_co°
);

1370 
	`Ârötf
(
ouçutfûe
, " Max utû = %d, MaxÑódÑ©iÿ%d, Max co° %f\n\n", 
max_i
*100/
åackî_num
, 
max_j
*100/åackî_num, 
max_co°
);

1373 
i
 = 1;ò< 
åackî_num
; i++){

1375 
globÆ_co°
[
i
] = 
	`ˇlc_ªad⁄ly_co°
(
r_åackî
, 
åackî_num
,

1376 
SSD_MAX_PAGES
/
åackî_num
*
i
);

1378 
	`Ârötf
(
ouçutfûe
, "%d %f\n", 
i
*100/
åackî_num
, 
globÆ_co°
[i]/
mö_co°
);

1382 
	`Ârötf
(
ouçutfûe
, "\n");

1384 
	`‰ì
(
globÆ_co°
);

1389 
	`¥ötf_co°_èbÀ
(
ˇche_m™agî
 **
w_åackî
,

1390 
ˇche_m™agî
 **
r_åackî
,

1391 
åackî_num


1394 
co°
[
MAX_DIRECTION
];

1395 
gaö
[
MAX_DIRECTION
];

1396 
cur_co°
;

1397 
max_gaö
;

1398 *
globÆ_co°
;

1399 
mö_co°
;

1400 
mö_i
 = 0,
mö_j
 = 0;

1401 
max_co°
;

1402 
max_i
 = 0, 
max_j
 = 0;

1403 
mö_dúe˘i⁄
;

1404 
i
, 
j
;

1405 
r_°ï
;

1406 
u_sˇÀ
 = 1;

1407 
r_sˇÀ
 = 1;

1411 
	`Ârötf
(
ouçutfûe
, "\n Expected Cost Table ... \n");

1415 
r_°ï
 = 
åackî_num
;

1419 
globÆ_co°
 = (*)
	`mÆloc
((Ë* 
åackî_num
 * 
r_°ï
);

1420 
	`mem£t
(
globÆ_co°
, 0x00, (Ë* 
åackî_num
 * 
r_°ï
);

1423 
i
 = 1;ò< 
åackî_num
; i++){

1424 
j
 = 1;j < 
r_°ï
;j++){

1425 
globÆ_co°
[
i
*
r_°ï
 + 
j
] = 
	`ˇlc_tŸÆ_co°
(
w_åackî
, 
r_åackî
, 
åackî_num
,

1426 
SSD_MAX_PAGES
/
åackî_num
*
i
,

1428 ()
j
*100/
r_°ï
,

1431 
	`Ârötf
(
ouçutfûe
, "%d %d %f\n", 
i
*100/
åackî_num
, 
j
*100/
r_°ï
, 
globÆ_co°
[i*r_step + j]);

1433 if(
i
 =1 && 
j
 == 1){

1434 
mö_co°
 = 
globÆ_co°
[
i
*
r_°ï
 + 
j
];

1435 
mö_i
 = 0;

1436 
mö_j
 = 0;

1437 
max_co°
 = 
mö_co°
;

1438 
max_i
 = 
mö_i
;

1439 
max_j
 = 
mö_j
;

1442 if(
mö_co°
 > 
globÆ_co°
[
i
*
r_°ï
 + 
j
]){

1443 
mö_co°
 = 
globÆ_co°
[
i
*
r_°ï
 + 
j
];

1444 
mö_i
 = 
i
;

1445 
mö_j
 = 
j
;

1447 if(
max_co°
 < 
globÆ_co°
[
i
*
r_°ï
 + 
j
]){

1448 
max_co°
 = 
globÆ_co°
[
i
*
r_°ï
 + 
j
];

1449 
max_i
 = 
i
;

1450 
max_j
 = 
j
;

1455 
	`Ârötf
(
ouçutfûe
, "\n");

1458 
	`Ârötf
(
ouçutfûe
, " Mö utû = %d, MöÑódÑ©iÿ%d, Mö co° %f\n\n", 
mö_i
*100/
åackî_num
, 
mö_j
*100/
r_°ï
, 
mö_co°
);

1459 
	`Ârötf
(
ouçutfûe
, " Max utû = %d, MaxÑódÑ©iÿ%d, Max co° %f\n\n", 
max_i
*100/
åackî_num
, 
max_j
*100/
r_°ï
, 
max_co°
);

1461 
	`Ârötf
(
°dout
, " Mö utû = %d, MöÑódÑ©iÿ%d, Mö co° %f\n\n", 
mö_i
*100/
åackî_num
, 
mö_j
*100/
r_°ï
, 
mö_co°
);

1462 
	`Ârötf
(
°dout
, " Max utû = %d, MaxÑódÑ©iÿ%d, Max co° %f\n\n", 
max_i
*100/
åackî_num
, 
max_j
*100/
r_°ï
, 
max_co°
);

1464 
i
 = 1;ò< 
åackî_num
; i++){

1465 
j
 = 1;j < 
r_°ï
;j++){

1466 
globÆ_co°
[
i
*
r_°ï
 + 
j
] = 
	`ˇlc_tŸÆ_co°
(
w_åackî
, 
r_åackî
, 
åackî_num
,

1467 
SSD_MAX_PAGES
/
åackî_num
*
i
,

1469 ()
j
*100/
r_°ï
,

1472 
	`Ârötf
(
ouçutfûe
, "%d %d %f\n", 
i
*100/
åackî_num
, 
j
*100/
r_°ï
, 
globÆ_co°
[i*r_°ï + j]/
mö_co°
);

1474 
	`Ârötf
(
ouçutfûe
, "\n");

1477 
	`‰ì
(
globÆ_co°
);

1482 
	`deˇy_hô_åackî
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
){

1483 
i
 = 0;

1485 
i
 = 0;ò< 
Ãu_num
;i++){

1486 
Ãu_m™agî
[
i
]->
cm_hô
/=2;

1487 
Ãu_m™agî
[
i
]->
cm_ªad_hô
/=2;

1488 
Ãu_m™agî
[
i
]->
cm_ªf
 /= 2;

1489 
Ãu_m™agî
[
i
]->
cm_ªad_ªf
 /= 2;

1492 
	`upd©e_hô_åackî
(
ˇche_m™agî
 **
Ãu_m™agî
,
Ãu_num
, 
blkno
,
is_ªad
){

1493 
hô_posôi⁄
 = -1;

1494 
li°node
 *
node
;

1495 
Ãu_node
 *
 
;

1497 
node
 = 
	`mÃu_£¨ch
(
Ãu_m™agî
, 
Ãu_num
, 
blkno
, 1, 1, &
hô_posôi⁄
);

1500 if(
is_ªad
){

1501 if(
hô_posôi⁄
 > 
S_READ
/(
SSD_MAX_PAGES
/
Ãu_num
))

1502 
g_GHOST_HIT
 = 1;

1504 
g_GHOST_HIT
 = 0;

1506 if(
node
){

1507 
Ãu_m™agî
[
hô_posôi⁄
]->
cm_ªad_hô
++;

1508 
Ãu_m™agî
[0]->
cm_ªad_ªf
++;

1511 if(
hô_posôi⁄
 > 
S_WRITE
/(
SSD_MAX_PAGES
/
Ãu_num
))

1512 
g_GHOST_HIT
 = 1;

1514 
g_GHOST_HIT
 = 0;

1517  
hô_posôi⁄
;

1521 
	`ªvî£_gë_blk
(
ssdblk
){

1522  
ªvî£_m≠
[
ssdblk
];

1525 
	`ªvî£_m≠_¸óã
(
max
){

1526 
i
;

1528 
ªvî£_max_∑ges
 = 
max
;

1530 
ªvî£_m≠
 = (*)
	`mÆloc
((Ë* 
ªvî£_max_∑ges
);

1531 if(
ªvî£_m≠
 =
NULL
){

1532 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

1533 
	`exô
(0);

1536 
i
 = 0;ò< 
ªvî£_max_∑ges
;i++){

1537 
ªvî£_m≠
[
i
] = -1;

1539 
ªvî£_u£d
 = 0;

1540 
ªvî£_‰ì
 = 
ªvî£_max_∑ges
-1;

1541 
ªvî£_Æloc
 = 1;

1543 
	`Ârötf
(
°dout
, " Revî£ M≠ AŒoˇti⁄ = %fKB\n", ()()*
ªvî£_max_∑ges
/1024);

1545 
	`Œ_¸óã
(&
ªvî£_‰ìq
);

1551 
	`ªvî£_m≠_Æloc_blk
(
hdd_blk
){

1552 
i
;

1553 
Æloc_blk
 = -1;

1556 if(
	`Œ_gë_size
(
ªvî£_‰ìq
)){

1557 
ªvî£_Æloc
 = ()
	`Œ_gë_èû
(
ªvî£_‰ìq
);

1558 
	`Œ_ªÀa£_èû
(
ªvî£_‰ìq
);

1561 
i
 = 1;ò< 
ªvî£_max_∑ges
;i++){

1563 if(
ªvî£_m≠
[
ªvî£_Æloc
] == -1){

1564 
Æloc_blk
 = 
ªvî£_Æloc
;

1568 
ªvî£_Æloc
++;

1569 if(
ªvî£_Æloc
 =
ªvî£_max_∑ges
)

1570 
ªvî£_Æloc
 = 1;

1574 if(
Æloc_blk
 > 0){

1575 
ªvî£_‰ì
--;

1576 if(
ªvî£_‰ì
 < 0){

1577 
	`Ârötf
(
°dîr
, " checkÑeverse_map_alloc_blk \n");

1578 
ªvî£_‰ì
 =Ñeverse_free;

1580 
ªvî£_u£d
++;

1581 
ªvî£_m≠
[
ªvî£_Æloc
] = 
hdd_blk
;

1583 if(
Æloc_blk
 == -1){

1584 
	`Ârötf
(
°dîr
, " Cannotállocate block .. \n");

1585 
	`Ârötf
(
°dîr
, " SSD UßbÀ Page†%d \n", 
SSD_USABLE_PAGES
);

1586 
	`Ârötf
(
°dîr
, " Revî£ maxÖage†%d\n", 
ªvî£_max_∑ges
);

1587 
	`Ârötf
(
°dîr
, " S_Ród = %d, S_Wrôê%d,ÅŸÆ = %d \n", 
S_READ
, 
S_WRITE
, S_READ + S_WRITE);

1588 
	`Ârötf
(
°dîr
, " R_CLOCK cou¡ = %d, W_CLOCK cou¡ = %d,ÅŸÆ = %d\n", 
R_CLOCK
->
cm_cou¡
, 
W_CLOCK
->cm_count, R_CLOCK->cm_count+W_CLOCK->cm_count);

1589 
	`Ârötf
(
°dîr
, " R_CLOCK fªê%d, W_CLOCK fªê%d\n", 
R_CLOCK
->
cm_‰ì
, 
W_CLOCK
->cm_free);

1590 
	`Ârötf
(
°dîr
, " R_CLOCK sizê%d, W_CLOCK sizê%d\n", 
R_CLOCK
->
cm_size
, 
W_CLOCK
->cm_size);

1591 
	`Ârötf
(
°dîr
, " HDD WQ = %d, HDD RQ = %d\n", 
	`Œ_gë_size
(
W_CLOCK
->
cm_hddwq
),Ül_gë_size(W_CLOCK->
cm_hddrq
));

1592 
	`Ârötf
(
°dîr
, " SSD WQ = %d, SSD RQ = %d\n", 
	`Œ_gë_size
(
W_CLOCK
->
cm_ssdwq
),Ül_gë_size(W_CLOCK->
cm_ssdrq
));

1594 
	`exô
(0);

1596 if(
ªvî£_‰ì
 == 0){

1597 
ªvî£_‰ì
 =Ñeverse_free;

1602  
Æloc_blk
;

1606 
	`ªvî£_m≠_check_sync
(
hdd_blk
){

1613 
	`ªvî£_m≠_ªÀa£_blk
(
ssd_blk
){

1614 
i
;

1617 if(
ssd_blk
 < 1 || ssd_blk >
ªvî£_max_∑ges
){

1618 
	`Ârötf
(
°dîr
, " invÆid ssd blknÿ%d \n", 
ssd_blk
);

1628 
ªvî£_‰ì
++;

1629 
ªvî£_u£d
--;

1630 
ªvî£_m≠
[
ssd_blk
] = -1;

1631 
ªvî£_Æloc
 = 
ssd_blk
;

1633 
	`Œ_ö£π_©_hód
(
ªvî£_‰ìq
, (*)
ssd_blk
);

1635  
ssd_blk
;

1639 
	`ªvî£_m≠_‰ì
(){

1640 
	`‰ì
(
ªvî£_m≠
);

1641 
	`Œ_ªÀa£
(
ªvî£_‰ìq
);

1644 
	`mósuª_avg_iŸime
(
devno
, 
rw
, 
now
, 
ãmp
, 
cou¡
){

1645 
diff
 = (
now
-
ãmp
)/
cou¡
;

1647 if(
DISK
 =
devno
){

1648 if(
rw
 =
READ
){

1649 
HDD_COUNT_R
++;

1650 
HDD_TOTALCOST_R
+
diff
;

1652 
HDD_COUNT_W
++;

1653 
HDD_TOTALCOST_W
+
diff
;

1657 if(
SSD
 =
devno
){

1658 if(
rw
 =
READ
){

1659 
SSD_COUNT_R
++;

1660 
SSD_TOTALCOST_R
+
diff
;

1662 
SSD_COUNT_PREDICT_R
++;

1663 
SSD_TOTALCOST_PREDICT_R
 +()(
SSD_READ
 + 
SSD_BUS
)/1000;

1665 
SSD_COUNT_W
++;

1666 
SSD_TOTALCOST_W
+
diff
;

1668 
SSD_COUNT_PREDICT_W
++;

1669 
SSD_TOTALCOST_PREDICT_W
+()
	`SSD_PW
(
	`ssd_¥edi˘_utû
(()
S_TOTAL
/
SSD_MAX_PAGES
))/1000;

1675 if((
SSD_COUNT_W
 + 
SSD_COUNT_R
) % 8192 == 0)

1676 
	`¥ötf
(" SSD R %.3f(Predicted = %f), W %.3f(Predicted = %f), Disk R %.3f, W %.3f \n",

1677 
SSD_TOTALCOST_R
/
SSD_COUNT_R
,

1678 
SSD_TOTALCOST_PREDICT_R
/
SSD_COUNT_PREDICT_R
,

1679 
SSD_TOTALCOST_W
/
SSD_COUNT_W
,

1680 
SSD_TOTALCOST_PREDICT_W
/
SSD_COUNT_PREDICT_W
,

1681 
HDD_TOTALCOST_R
/
HDD_COUNT_R
,

1682 
HDD_TOTALCOST_W
/
HDD_COUNT_W
);

1687 
	`rw_issue_ªq
(
devno
, 
blk
, 
rw
){

1688 
disksim_ªque°
 
r
;

1689 
ãmp
 = 
now
;

1691 
	`wow_make_ªque°
(&
r
, 
now
, 
devno
, 
rw
, 
blk
*
BLOCK2SECTOR
, BLOCK2SECTOR);

1692 
	`wow_issue_ªque°
(&
r
);

1696 
	`Ãu_ssd_ªad
(
ˇche_m™agî
 *
c
, 
devno
, 
rw
, 
li°node
 *
Qli°
,
åim
){

1697 
ãmp
 = 
now
;

1699 
	`Ãu_Êush_ªqli°
(
c
, 
devno
, 
rw
, 
Qli°
, 
åim
);

1701 
SSD_READ_TIME
 +(
now
-
ãmp
);

1704 
	`Ãu_ssd_wrôe
(
ˇche_m™agî
 *
c
, 
devno
, 
rw
, 
li°node
 *
Qli°
,
åim
){

1705 
ãmp
 = 
now
;

1706 
	`Ãu_Êush_ªqli°
(
c
, 
devno
, 
rw
, 
Qli°
, 
åim
);

1708 
SSD_WRITE_TIME
 +(
now
-
ãmp
);

1710 
	`Ãu_°age
(
ˇche_m™agî
 *
˛ock
){

1711 
ãmp
 = 
now
;

1712 
ãmp2
;

1714 
	`Ãu_Êush_ªqli°
(
˛ock
, 
DISK
, 
READ
, clock->
cm_hddrq
, 0);

1715 
STAGE_HDD_READ
 +(
now
-
ãmp
);

1716 
ãmp2
 = 
now
;

1717 
	`Ãu_Êush_ªqli°
(
˛ock
, 
SSD
, 
WRITE
, clock->
cm_ssdwq
, 0);

1718 
STAGE_SSD_WRITE
 +(
now
-
ãmp2
);

1720 
STAGE_TIME
 +(
now
-
ãmp
);

1723 
	`Ãu_de°age
(
ˇche_m™agî
 *
˛ock
){

1724 
ãmp
 = 
now
;

1725 
ãmp2
;

1727 
	`Ãu_Êush_ªqli°
(
˛ock
, 
SSD
, 
READ
, clock->
cm_ssdrq
, 1);

1728 
DESTAGE_SSD_READ
 +(
now
-
ãmp
);

1730 
ãmp2
 = 
now
;

1731 
	`Ãu_Êush_ªqli°
(
˛ock
, 
DISK
, 
WRITE
, clock->
cm_hddwq
, 0);

1732 
DESTAGE_HDD_WRITE
 +(
now
-
ãmp2
);

1734 
DESTAGE_TIME
 +(
now
-
ãmp
);

1738 
	`£¨ch_døm_ˇche
(
ˇche_m™agî
 *
d_ˇche
, 
blkno
, 
is_ªad
){

1739 
Ãu_node
 *
 
 = 
NULL
;

1740 
li°node
 *
døm_node
;

1741 
døm_hô
 = 0;

1742 
døm_node
 = 
	`CACHE_SEARCH
(
d_ˇche
, 
blkno
);

1743 if(!
døm_node
){

1744 
 
 = 
	`CACHE_REPLACE
(
d_ˇche
, 0);

1745 
 
 = 
	`CACHE_ALLOC
(
d_ˇche
,Ün, 
blkno
);

1746 
	`CACHE_INSERT
(
d_ˇche
, 
 
);

1748 
 
 = 
	`CACHE_REMOVE
(
d_ˇche
, 
døm_node
);

1749 
	`CACHE_INSERT
(
d_ˇche
, 
 
);

1750 
døm_hô
 = 1;

1751 if(
is_ªad
 =
READ
)

1752 
is_ªad
 = is_read;

1756 
døm_hô
 = 0;

1757  
døm_hô
;

1760 
	`rw_ª∂a˚mít
(
ˇche_m™agî
 *
Êash_ˇche
,
is_ªad
){

1761 
cou¡
;

1762 
˛ock_node
 *
˙
 = 
NULL
;

1765 
cou¡
 = 
Êash_ˇche
->
cm_highw©î
;

1766 
Êash_ˇche
->
cm_‰ì
 < fœsh_ˇche->
cm_highw©î
 && 
cou¡
){

1767 
˙
 = 
	`CACHE_REPLACE
(
Êash_ˇche
, fœsh_ˇche->
cm_highw©î
);

1771 if(
˙
 && cn->
˙_ssd_blk
 > 0){

1777 if(
˙
->
˙_dúty
){

1778 
	`CACHE_MAKERQ
(
Êash_ˇche
, fœsh_ˇche->
cm_ssdrq
, 
NULL
, 
˙
->
˙_ssd_blk
);

1779 
	`CACHE_MAKERQ
(
Êash_ˇche
, fœsh_ˇche->
cm_hddwq
, 
NULL
, 
	`ªvî£_gë_blk
(
˙
->
˙_ssd_blk
));

1780 
	`£¨ch_døm_ˇche
(
døm_ˇche
, 
	`ªvî£_gë_blk
(
˙
->
˙_ssd_blk
), 
is_ªad
);

1781 
Êash_ˇche
->
cm_de°age_cou¡
++;

1783 
	`ssd_åim_comm™d
(
SSD
, 
˙
->
˙_ssd_blk
 * 
BLOCK2SECTOR
);

1785 
	`ªvî£_m≠_ªÀa£_blk
(
˙
->
˙_ssd_blk
);

1786 
	`‰ì
(
˙
);

1788 if(
Êash_ˇche
->
cm_cou¡
 == 0)

1797 
	`rw_make_ªq
(
ˇche_m™agî
 *
Êash_ˇche
, 
blkno
, 
is_ªad
,
døm_hô
, 
£q_io
){

1798 
˛ock_node
 *
˙
 = 
NULL
;

1799 
li°node
 *
node
 = 
NULL
;

1800 
is_ad≠tive
;

1802 
is_ad≠tive
 = (
Êash_ˇche
->
cm_pﬁicy
 =
CACHE_LRU_RWO_ADAPTIVE
 || fœsh_ˇche->cm_pﬁicy =
CACHE_LRU_RW_ADAPTIVE
 || fœsh_ˇche->cm_pﬁicy =
CACHE_BGCLOCK_RWO_ADAPTIVE
);

1804 
node
 = 
	`CACHE_SEARCH
(
Êash_ˇche
, 
blkno
);

1805 if(
£q_io
){

1806 if(
node
){

1808 
˙
 = 
	`CACHE_REMOVE
(
Êash_ˇche
, 
node
);

1809 
	`ssd_åim_comm™d
(
SSD
, 
˙
->
˙_ssd_blk
 * 
BLOCK2SECTOR
);

1810 
	`ªvî£_m≠_ªÀa£_blk
(
˙
->
˙_ssd_blk
);

1811 
	`‰ì
(
˙
);

1814 if(
is_ªad
){

1815 
	`CACHE_MAKERQ
(
Êash_ˇche
, fœsh_ˇche->
cm_hddrq
, 
NULL
, 
blkno
);

1817 
	`CACHE_MAKERQ
(
Êash_ˇche
, fœsh_ˇche->
cm_hddwq
, 
NULL
, 
blkno
);

1827 if(!
node
){

1829 if(
Êash_ˇche
->
cm_‰ì
 <Êash_ˇche->
cm_loww©î
){

1830 
cou¡
;

1831 if(
is_ªad
 && !
is_ad≠tive
){

1832 
	`Ãu_°age
(
Êash_ˇche
);

1833 
	`Ãu_ssd_ªad
(
Êash_ˇche
, 
SSD
, 
READ
, fœsh_ˇche->
cm_ssdrq
, 0);

1836 if(
is_ad≠tive
){

1837 if(
is_ªad
){

1838 
R_CLOCK
->
cm_‰ì
 =0 && 
W_CLOCK
->cm_‰ì > 1024 && W_CLOCK->
cm_size
 > 2048){

1839 
	`CACHE_INC
(
R_CLOCK
, 1);

1840 
	`CACHE_DEC
(
W_CLOCK
, 1);

1843 
W_CLOCK
->
cm_‰ì
 =0 && 
R_CLOCK
->cm_free > 0){

1844 
	`CACHE_INC
(
W_CLOCK
, 1);

1845 
	`CACHE_DEC
(
R_CLOCK
, 1);

1850 
	`rw_ª∂a˚mít
(
Êash_ˇche
, 
is_ªad
);

1853 if(
is_ªad
 && !
is_ad≠tive
){

1854 
	`Ãu_de°age
(
Êash_ˇche
);

1858 
˙
 = 
	`CACHE_REPLACE
(
Êash_ˇche
, fœsh_ˇche->
cm_loww©î
);

1859 if(
˙
 && cn->
˙_ssd_blk
 > 0){

1861 if(
˙
->
˙_dúty
){

1862 
	`CACHE_MAKERQ
(
Êash_ˇche
, fœsh_ˇche->
cm_ssdrq
, 
NULL
, 
˙
->
˙_ssd_blk
);

1863 
	`CACHE_MAKERQ
(
Êash_ˇche
, fœsh_ˇche->
cm_hddwq
, 
NULL
, 
	`ªvî£_gë_blk
(
˙
->
˙_ssd_blk
));

1864 
	`£¨ch_døm_ˇche
(
døm_ˇche
, 
	`ªvî£_gë_blk
(
˙
->
˙_ssd_blk
), 
is_ªad
);

1865 
Êash_ˇche
->
cm_de°age_cou¡
++;

1867 
	`ªvî£_m≠_ªÀa£_blk
(
˙
->
˙_ssd_blk
);

1870 
˙
 = 
	`CACHE_ALLOC
(
Êash_ˇche
, cn, 
blkno
);

1871 
˙
->
˙_ssd_blk
 = 
	`ªvî£_m≠_Æloc_blk
(
blkno
);

1889 
	`CACHE_INSERT
(
Êash_ˇche
, 
˙
);

1892 if(
is_ªad
){

1893 
	`CACHE_MAKERQ
(
Êash_ˇche
, fœsh_ˇche->
cm_hddrq
, 
NULL
, 
blkno
);

1894 
	`CACHE_MAKERQ
(
Êash_ˇche
, fœsh_ˇche->
cm_ssdwq
, 
NULL
, 
˙
->
˙_ssd_blk
);

1895 
Êash_ˇche
->
cm_°age_cou¡
++;

1897 
døm_hô
 = 1;

1901 
˙
 = (
˛ock_node
 *)
node
->
d©a
;

1903 
˙
 = 
	`CACHE_REMOVE
(
Êash_ˇche
, 
node
);

1904 
	`CACHE_INSERT
(
Êash_ˇche
, 
˙
);

1907 if(
is_ªad
){

1908 if(!
døm_hô
){

1909 
	`CACHE_MAKERQ
(
Êash_ˇche
, fœsh_ˇche->
cm_ssdrq
, 
NULL
, 
˙
->
˙_ssd_blk
);

1911 
˙
->
˙_ªad
 = 1;

1912 if(
˙
->
˙_dúty
){

1913 
˙
 = cn;

1916 
	`CACHE_MAKERQ
(
Êash_ˇche
, fœsh_ˇche->
cm_ssdwq
, 
NULL
, 
˙
->
˙_ssd_blk
);

1917 
˙
->
˙_dúty
 = 1;

1918 if(
˙
->
˙_ªad
)

1919 
˙
 = cn;

1923 
	`¥öt_°©i°ic_öf‹m©i⁄
(
FILE
 *
ouçut
){

1931 
	`ªsize_rw_ˇche_size
(
ˇche_m™agî
 *
r_˛ock
, ˇche_m™agî *
w_˛ock
){

1932 
r_diff
;

1933 
w_diff
;

1934 
r_diff2
;

1935 
w_diff2
;

1937 if(
S_WRITE
 =
w_˛ock
->
cm_size


1938 && 
S_READ
 =
r_˛ock
->
cm_size
)

1942 if(
S_READ
 + 
S_WRITE
 > 
Wow_Max_High_W©î
)

1945 
r_diff
 = 
S_READ
 - 
r_˛ock
->
cm_size
;

1946 
w_diff
 = 
S_WRITE
 - 
w_˛ock
->
cm_size
;

1949 
r_diff2
 = 
S_READ
 - 
r_˛ock
->
cm_cou¡
;

1950 
w_diff2
 = 
S_WRITE
 - 
w_˛ock
->
cm_cou¡
;

1951 if(
r_diff
 > 0){

1952 
	`Ãu_öc
(
r_˛ock
, 
r_diff
);

1953 }if(
r_diff
 < 0){

1954 
	`Ãu_dec
(
r_˛ock
, -
r_diff
);

1957 if(
w_diff
 > 0){

1958 
	`Ãu_öc
(
w_˛ock
, 
w_diff
);

1959 }if(
w_diff
 < 0){

1960 
	`Ãu_dec
(
w_˛ock
, -
w_diff
);

1962 if(
w_˛ock
->
cm_‰ì
 < 0)

1963 
w_˛ock
 = w_clock;

1965 if(
r_diff2
 < 0 || 
w_diff2
 < 0)

1966 
r_diff2
 =Ñ_diff2;

1968 
	`¥ötf
("Ñ_dif‡%fMB, w_dif‡%fMB\n", ()
r_diff
/256, ()
w_diff
/256);

1969 
	`¥ötf
("Ñ_diff2 = %fMB, w_diff2 = %fMB\n", ()
r_diff2
/256, ()
w_diff2
/256);

1970 
	`Ârötf
(
ouçutfûe
, "Ñ_diff2 = %fMB, w_diff2 = %fMB\n", ()
r_diff2
/256, ()
w_diff2
/256);

1976 
	`ad≠tive_gí_ªq_wôh_bg˛ock
(
ˇche_m™agî
 *
r_˛ock
, ˇche_m™agî *
w_˛ock
, 
i‹eq_evít
 *
ªq
, 
blkno
,
døm_hô
,
£q_io
){

1977 
li°node
 *
node
, *
gnode
;

1978 
Ãu_node
 *
 
;

1979 
bgÃu_node
 *
bn
;

1980 
li°node
 *
node2
;

1983 if(!(
ªq
->
Êags
 & 
READ
)){

1984 
rc_wrôe
++;

1986 if(!
£q_io
){

1987 
node
 = 
	`CACHE_PRESEARCH
(
r_˛ock
, 
blkno
);

1988 if(
node
){

1989 
 
 = 
	`CACHE_REMOVE
(
r_˛ock
, 
node
);

1990 
gnode
 = 
	`CACHE_SEARCH
(
w_˛ock
, 
blkno
);

1992 if(
gnode
 =
NULL
){

1994 
bn
 = 
	`CACHE_ALLOC
(
w_˛ock
, 
NULL
, 
blkno
/
GRP2BLK
);

1995 
	`CACHE_INSERT
(
w_˛ock
, 
bn
);

1997 
bn
 = (
bgÃu_node
 *)
gnode
->
d©a
;

2000 
 
 = 
	`bg˛ock_ö£π_block_to_group
(
w_˛ock
, 
bn
, 
blkno
,Ün);

2003 
	`upd©e_hô_åackî
(
W_HIT_TRACKER
,
HIT_TRACKER_NUM
, 
blkno
, 
ªq
->
Êags
);

2006 
	`bg˛ock_make_ªq
(
w_˛ock
, 
blkno
, 
ªq
->
Êags
, 
døm_hô
, 
£q_io
);

2010 }if(
ªq
->
Êags
 & 
READ
){

2011 
gho°_hô
;

2012 
rc_ªad
++;

2015 if(!
£q_io
){

2016 
	`upd©e_hô_åackî
(
R_HIT_TRACKER
,
HIT_TRACKER_NUM
, 
blkno
, 
ªq
->
Êags
);

2018 if(
	`CACHE_PRESEARCH
(
w_˛ock
, 
blkno
)){

2019 
	`bg˛ock_make_ªq
(
w_˛ock
, 
blkno
, 
ªq
->
Êags
, 
døm_hô
, 
£q_io
);

2021 
	`rw_make_ªq
(
r_˛ock
, 
blkno
, 
ªq
->
Êags
, 
døm_hô
, 
£q_io
);

2030 
	`gí_ªq_wôh_bg˛ock
(
ˇche_m™agî
 *
˛ock
, 
i‹eq_evít
 *
ªq
, 
blkno
,
døm_hô
, 
£q_io
){

2031 
li°node
 *
node
, *
gnode
;

2032 
Ãu_node
 *
 
;

2033 
bgÃu_node
 *
bn
;

2034 
li°node
 *
node2
;

2037 if(!(
ªq
->
Êags
 & 
READ
)){

2038 
	`bg˛ock_make_ªq
(
˛ock
, 
blkno
, 
ªq
->
Êags
, 
døm_hô
, 
£q_io
);

2039 
rc_wrôe
++;

2041 }if(
ªq
->
Êags
 & 
READ
){

2042 
	`bg˛ock_make_ªq
(
˛ock
, 
blkno
, 
ªq
->
Êags
, 
døm_hô
, 
£q_io
);

2043 
rc_ªad
++;

2050 if(
	`mÃu_£¨ch
(
W_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 0, 0, &
hô_posôi⁄
)){

2051 
	`upd©e_hô_åackî
(
W_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2053 
	`upd©e_hô_åackî
(
R_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2057 
node
 = 
	`mÃu_£¨ch
(
R_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 0, 0, &
hô_posôi⁄
);

2058 if(
node
){

2059 
	`mÃu_ªmove
(
R_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
);

2061 
	`upd©e_hô_åackî
(
W_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2064 
	`ad≠tive_gí_ªq
(
ˇche_m™agî
 *
r_˛ock
, ˇche_m™agî *
w_˛ock
, 
i‹eq_evít
 *
ªq
, 
blkno
, 
døm_hô
, 
£q_io
, 
£À˘ive
){

2065 
li°node
 *
node
;

2066 
Ãu_node
 *
˙
;

2067 
li°node
 *
node2
;

2068 
ãmp
;

2071 if(!(
ªq
->
Êags
 & 
READ
)){

2072 
rc_wrôe
++;

2073 
ƒ_£rvi˚d_ws
++;

2075 if(!
£q_io
){

2076 
node
 = 
	`CACHE_PRESEARCH
(
r_˛ock
, 
blkno
);

2077 if(
node
){

2078 
˙
 = 
	`CACHE_REMOVE
(
r_˛ock
, 
node
);

2079 
	`CACHE_INSERT
(
w_˛ock
, 
˙
);

2080 
rc_wrôe_ö_ªad
++;

2083 
node
 = 
	`mÃu_£¨ch
(
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
blkno
, 0, 0, &
ãmp
);

2084 if(
node
){

2085 
	`mÃu_ªmove
(
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
blkno
);

2087 
	`upd©e_hô_åackî
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
blkno
, 
ªq
->
Êags
);

2090 
	`rw_make_ªq
(
w_˛ock
, 
blkno
, 
ªq
->
Êags
, 
døm_hô
, 
£q_io
);

2096 }if(
ªq
->
Êags
 & 
READ
){

2097 
gho°_hô
 = 0;

2101 if(
	`CACHE_PRESEARCH
(
w_˛ock
, 
blkno
)){

2102 
rc_wrôe
++;

2103 
rc_ªad_ö_wrôe
++;

2104 
ƒ_£rvi˚d_ws
++;

2105 if(!
£q_io
){

2106 
	`upd©e_hô_åackî
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
blkno
, 
ªq
->
Êags
);

2108 
	`rw_make_ªq
(
w_˛ock
, 
blkno
, 
ªq
->
Êags
, 
døm_hô
, 
£q_io
);

2110 if(!
£q_io
){

2111 
gho°_hô
 = 
	`upd©e_hô_åackî
(
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 
blkno
, 
ªq
->
Êags
);

2113 
rc_ªad
++;

2114 
ƒ_£rvi˚d_rs
++;

2117 if(
£À˘ive
){

2118 if(
gho°_hô
 != -1){

2119 
	`rw_make_ªq
(
r_˛ock
, 
blkno
, 
ªq
->
Êags
, 
døm_hô
, 
£q_io
);

2121 
	`CACHE_MAKERQ
(
r_˛ock
,Ñ_˛ock->
cm_hddrq
, 
NULL
, 
blkno
);

2124 
	`rw_make_ªq
(
r_˛ock
, 
blkno
, 
ªq
->
Êags
, 
døm_hô
, 
£q_io
);

2131 
	`öô_rw_ˇche_size
(){

2132 
wödow
 = 
SSD_MAX_PAGES
/
HIT_TRACKER_NUM
;

2133 
r
, 
w
;

2135 
r
 = 
R_CLOCK
->
cm_cou¡
/
wödow
;

2136 if(
R_CLOCK
->
cm_cou¡
 % 
wödow
)

2137 
r
++;

2139 
w
 = 
W_CLOCK
->
cm_cou¡
/
wödow
;

2140 if(
W_CLOCK
->
cm_cou¡
 % 
wödow
)

2141 
w
++;

2144 
S_TOTAL
 = 
r
 * 
wödow
 + 
w
 * window;

2145 
R_VALUE
 = ()
r
 * 
wödow
 * 100 / 
S_TOTAL
;

2147 
	`ˇlc_rw_∑πôi⁄_size
(
S_TOTAL
, 
R_VALUE
, &
S_READ
, &
S_WRITE
, 0, 0);

2150 
	`com∑ª_blkno
(c⁄° *
a
,c⁄° *
b
){

2157  *(*)
a
 - *(*)
b
;

2162 
	`Ãu_s‹t_ªqli°
(
li°node
 *
Qli°
){

2163 
li°node
 *
node
;

2164 *
a
;

2165 
i
, 
cou¡
;

2166 
cou¡
 = 
	`Œ_gë_size
(
Qli°
);

2168 
a
 = 
	`mÆloc
((Ë* 
cou¡
);

2169 if(
a
 =
NULL
){

2170 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

2171 
	`exô
(1);

2174 
	`mem£t
(
a
, 0x00, (Ë* 
cou¡
);

2176 
i
 = 0;

2177 
node
 = 
Qli°
->
√xt
;

2178 
node
 !
Qli°
){

2179 
a
[
i
++] = ()
node
->
d©a
;

2180 
	`NODE_NEXT
(
node
);

2183 
	`qs‹t
(
a
, 
cou¡
, (), 
com∑ª_blkno
);

2185 
	`Œ_gë_size
(
Qli°
)){

2186 
	`Œ_ªÀa£_èû
(
Qli°
);

2189 
i
 = 0;ò< 
cou¡
;i++){

2190 
	`Œ_ö£π_©_hód
(
Qli°
,(*)
a
[
i
]);

2193 
	`‰ì
(
a
);

2197 
	`Ãu_Êush_ªqli°
(
ˇche_m™agî
 *
c
, 
devno
, 
rw
, 
li°node
 *
Qli°
,
åim
){

2198 
disksim_ªque°
 
r
;

2199 
SysTime
 
cuºTime
 = 
now
;

2200 
SysTime
 
ãmp
 = 
now
;

2201 
li°node
 *
rq
;

2202 
i
, 
rq_cou¡
;

2204 
rq_cou¡
 = 
	`Œ_gë_size
(
Qli°
);

2206 if(
rq_cou¡
 == 0)

2210 if(
rq_cou¡
 > 1){

2211 
	`Ãu_s‹t_ªqli°
(
Qli°
);

2214 
	`wow_öô_ªque°
(&
r
);

2215 
rq
 = 
Qli°
->
¥ev
;

2217 
i
 = 0;ò< 
rq_cou¡
;i++){

2218 
blk
 = ()
rq
->
d©a
;

2222 
blk
 *
BLOCK2SECTOR
;

2224 if(!
r
.
blkno
){

2225 
	`wow_make_ªque°
(&
r
, 
cuºTime
, 
devno
, 
rw
, 
blk
, 
BLOCK2SECTOR
);

2226 }if(
r
.
blkno
 +Ñ.
byãcou¡
/
SECTOR
 =
blk
){

2227 
r
.
byãcou¡
 +
BLOCK
;

2228 if(
r
.
byãcou¡
 >
MAX_REQ_BYTES
){

2229 
	`wow_issue_ªque°
(&
r
);

2230 
	`wow_öô_ªque°
(&
r
);

2232 }if(
r
.
blkno
 +Ñ.
byãcou¡
/
SECTOR
!
blk
){

2233 
	`wow_issue_ªque°
(&
r
);

2234 
	`wow_make_ªque°
(&
r
, 
cuºTime
, 
devno
, 
rw
, 
blk
, 
BLOCK2SECTOR
);

2237 
	`NODE_PREV
(
rq
);

2239 if(
r
.
byãcou¡
)

2240 
	`wow_issue_ªque°
(&
r
);

2243 
	`mósuª_avg_iŸime
(
devno
, 
rw
, 
now
, 
ãmp
, 
rq_cou¡
);

2246 if(
åim
){

2248 
rq
 = 
Qli°
->
¥ev
;

2249 
i
 = 0;ò< 
rq_cou¡
;i++){

2250 
blk
 = ()
rq
->
d©a
;

2255 
	`ssd_åim_comm™d
(
SSD
, 
blk
 * 
BLOCK2SECTOR
);

2257 
	`NODE_PREV
(
rq
);

2262 
	`CACHE_RELEASERQ
(
c
, 
Qli°
);

2265 
	`¥öt_hô_øtio_curve
(
ˇche_m™agî
 **
Ãu_m™agî
, 
ªf
, 
Ãu_num
, 
FILE
 *
Â
){

2266 
i
;

2267 
hô
 = 0;

2268 
¥ev_hô
 = 0;

2269 
	`Ârötf
(
Â
, " Printf Hit Ratio Curve\n");

2270 
	`Ârötf
(
Â
, "# Index Hit Ratio Marginal Gain\n");

2271 
i
 = 0;ò< 
Ãu_num
;i++){

2272 
¥ev_hô
 = 
hô
;

2273 
hô
 +
Ãu_m™agî
[
i
]->
cm_hô
;

2274 
	`Ârötf
(
Â
, " %d %.3f %.3f %.3f %d\n",

2275 (
i
+1)*100/
Ãu_num
,

2276 ()
hô
*100/
ªf
,

2277 ()
hô
*100/
ªf
-()
¥ev_hô
*100/ref,

2278 ()
Ãu_m™agî
[
i
]->
cm_hô
/
ªf
,

2279 
Ãu_m™agî
[
i
]->
cm_hô
);

2285 
Wow_HDD_Max_Pages
;

2286 
	#BITSIZE
 29

	)

2287 
	`make_key
(
blkno
, 
devno
){

2288 
ãmp
 = 
devno
 << 
BITSIZE
;

2289 
d
 = ~0;

2290 
blkno
 &(
d
>>2);

2293  
blkno
 + 
ãmp
;

2295 
	`w‹klﬂd_simuœti⁄
(*
fûíame
,
ˇche_size
,
hdd_max
, 
ssd_max
, 
bgÃu
, 
åackî_num
){

2296 
FILE
 *
åa˚fûe

NULL
;

2297 
i‹eq_evít
 
ªq
;

2298 
disksim_ªque°
 
r
;

2299 
i
;

2300 
‹g_hdd_∑ges
 = 
hdd_max
;

2301 
tŸ_wrôe_byãs
 = 0.0;

2302 
tŸ_ªad_byãs
 = 0.0;

2303 
tŸ_wrôe_cou¡
 = 0;

2304 
tŸ_ªad_cou¡
 = 0;

2305 
öãr_¨rivÆ
 = 0.0;

2306 
öãr_cou¡
 = 0;

2307 
¨rivÆ_time
 = 0.0;

2310 
SSD_MAX_PAGES
 = 
ssd_max
;

2311 
HDD_MAX_PAGES
 = 268435456;

2312 
HDD_MAX_PAGES
 = 35913728;

2313 
Wow_HDD_Max_Pages
 = 
HDD_MAX_PAGES
;

2315 
	`wow_wss_öô
(
HDD_MAX_PAGES
);

2317 
™ti_tŸÆ_co°
 = 0.0;

2318 #ifde‡
__löux__


2319 
åa˚fûe
 = 
	`f›í64
(
fûíame
, "r");

2321 
åa˚fûe
 = 
	`f›í
(
fûíame
, "r");

2323 if(
åa˚fûe
 =
NULL
){

2324 
	`Ârötf
(
°dîr
," C™nŸ o≥¿fûê%s\n", 
fûíame
);

2325 
	`Ârötf
(
ouçutfûe
," C™nŸ o≥¿fûê%s\n", 
fûíame
);

2326 
	`exô
(1);

2328 
S_TOTAL
 = 
ˇche_size
;

2329 
R_HIT_TRACKER
 = (
ˇche_m™agî
 **)
	`mÃu_öô
("R_HIT_TRACKER", 
åackî_num
, 
SSD_MAX_PAGES
);

2330 
W_HIT_TRACKER
 = (
ˇche_m™agî
 **)
	`mÃu_öô
("W_HIT_TRACKER", 
åackî_num
, 
SSD_MAX_PAGES
);

2331 
HIT_TRACKER
 = (
ˇche_m™agî
 **)
	`mÃu_öô
("HIT_TRACKER", 
åackî_num
, 
SSD_MAX_PAGES
);

2335 
i
 = 0;;i++){

2336 
blkno
;

2337 
num
, 
j
;

2338 
cou¡
;

2339 
∑ge_cou¡
;

2340 
SysTime
 
¥ev_now
 = 
now
;

2342 if(
	`iŸø˚_ascii_gë_i‹eq_evít
(
åa˚fûe
, &
ªq
Ë=
NULL
){

2347 if(
ªq
.
Êags
 =
READ
){

2348 
tŸ_ªad_byãs
 +
ªq
.
bcou¡
;

2349 
tŸ_ªad_cou¡
++;

2351 
tŸ_wrôe_byãs
 +
ªq
.
bcou¡
;

2352 
tŸ_wrôe_cou¡
++;

2356 
öãr_¨rivÆ
 +(
ªq
.
time
 - 
¨rivÆ_time
);

2357 
öãr_cou¡
++;

2358 
¨rivÆ_time
 = 
ªq
.
time
;

2365 
RólTime
 = 
ªq
.
time
;

2368 
blkno
 = (
ªq
.blkno/
BLOCK2SECTOR
)%
HDD_MAX_PAGES
;

2369 
num
 = 
ªq
.
bcou¡
/
BLOCK2SECTOR
;

2370 if(
ªq
.
bcou¡
%
BLOCK2SECTOR
)

2371 
num
++;

2373 
blkno
 = 
	`make_key
(blkno, 
ªq
.
devno
);

2378 
j
 = 0;j < 
num
;j++){

2379 
hô_posôi⁄
 = -1;

2381 
rc_tŸÆ
++;

2382 if(
ªq
.
Êags
 =
READ
){

2383 
rc_ªad
++;

2385 if(
	`mÃu_£¨ch
(
W_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 0, 0, &
hô_posôi⁄
)){

2386 
rc_ªad_ö_wrôe
++;

2387 
	`upd©e_hô_åackî
(
W_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2389 
	`upd©e_hô_åackî
(
R_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2395 
li°node
 *
node
;

2396 
rc_wrôe
++;

2398 
node
 = 
	`mÃu_£¨ch
(
R_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 0, 0, &
hô_posôi⁄
);

2399 if(
node
){

2400 
	`mÃu_ªmove
(
R_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
);

2402 
	`upd©e_hô_åackî
(
W_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2405 
	`upd©e_hô_åackî
(
HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2409 if(
i
 % 50000 == 0){

2410 
	`Ârötf
(
°dout
, "\¿Ród %dÜöe†... \n", 
i
);

2411 
	`fÊush
(
°dout
);

2415 
cou¡
 = 
num
 / (
MAX_REQ_BYTES
/
PAGE
);

2416 if(
num
 % (
MAX_REQ_BYTES
/
PAGE
)){

2417 
cou¡
++;

2421 
j
 = 0;j < 
cou¡
;j++){

2422 
ªq_cou¡
;

2424 if(
num
 >(
MAX_REQ_BYTES
/
PAGE
)){

2425 
ªq_cou¡
 = (
MAX_REQ_BYTES
/
PAGE
);

2427 
ªq_cou¡
 = 
num
;

2429 
num
 -
ªq_cou¡
;

2431 
	`wow_make_ªque°
(&
r
, 
now
, 
DISK
, 
ªq
.
Êags
, (
blkno
%(
‹g_hdd_∑ges
-
MAX_REQ_BYTES
/
PAGE
))*
BLOCK2SECTOR
, 
ªq_cou¡
*BLOCK2SECTOR);

2432 
	`wow_issue_ªque°
(&
r
);

2434 
blkno
 +(
MAX_REQ_BYTES
/
PAGE
);

2446 
	`Ârötf
(
ouçutfûe
, " Syssim: TŸÆ Reque° Cou¡ = %d %.3f MB\n", 
rc_tŸÆ
, ()rc_total/256);

2447 
	`Ârötf
(
ouçutfûe
, " Syssim: TŸÆ Reque° Cou¡‘ód) = %d %.3f MB\n", 
rc_ªad
, ()rc_read/256);

2448 
	`Ârötf
(
ouçutfûe
, " Syssim: TŸÆ Reque° Cou¡(wrôe) = %d %.3f MB\n", 
rc_wrôe
, ()rc_write/256);

2449 
	`Ârötf
(
ouçutfûe
, " Syssim: TŸÆ Reque° Cou¡‘ód i¿wrôñru) = %d %.3f MB)\n", 
rc_ªad_ö_wrôe
, ()rc_read_in_write/256);

2450 
	`Ârötf
(
ouçutfûe
, " Syssim: TŸÆ Reque° Cou¡(wrôêöÑódÃu) = %d %.3f MB)\n", 
rc_wrôe_ö_ªad
, ()rc_write_in_read/256);

2451 
	`Ârötf
(
ouçutfûe
, " Syssim: Avg Ród Req Size = %‡KB\n", ()
SECTOR
*
tŸ_ªad_byãs
/
tŸ_ªad_cou¡
/1024);

2452 
	`Ârötf
(
ouçutfûe
, " Syssim: Avg WrôêReq Size = %‡KB\n", ()
SECTOR
*
tŸ_wrôe_byãs
/
tŸ_wrôe_cou¡
/1024);

2453 
	`Ârötf
(
ouçutfûe
, " Syssim: I¡îáºivÆÅime = %‡ms\n", ()
öãr_¨rivÆ
/
öãr_cou¡
);

2455 
	`Ârötf
(
ouçutfûe
, " syssim: Ród Re„ªn˚ R©io = %.2f\n", ()
rc_ªad
/
rc_tŸÆ
);

2458 
	`¥ötf_co°_èbÀ
(
W_HIT_TRACKER
, 
R_HIT_TRACKER
, 
åackî_num
);

2460 
	`Ârötf
(
ouçutfûe
, "\n Tracked Hit Ratio Curve ... \n");

2461 
	`¥öt_hô_øtio_curve
(
HIT_TRACKER
, HIT_TRACKER[0]->
cm_ªf
, 
åackî_num
, 
ouçutfûe
);

2462 
	`Ârötf
(
ouçutfûe
, "\n Read Tracked Hit Ratio Curve ... \n");

2463 
	`¥öt_hô_øtio_curve
(
R_HIT_TRACKER
, R_HIT_TRACKER[0]->
cm_ªf
, 
åackî_num
, 
ouçutfûe
);

2464 
	`Ârötf
(
ouçutfûe
, "\n Write Tracked Hit Ratio Curve ... \n");

2465 
	`¥öt_hô_øtio_curve
(
W_HIT_TRACKER
, W_HIT_TRACKER[0]->
cm_ªf
, 
åackî_num
, 
ouçutfûe
);

2467 
	`mÃu_exô
(
R_HIT_TRACKER
, 
åackî_num
);

2468 
	`mÃu_exô
(
W_HIT_TRACKER
, 
åackî_num
);

2469 
	`mÃu_exô
(
HIT_TRACKER
, 
åackî_num
);

2470 
	`f˛o£
(
åa˚fûe
);

2476 
	`zùf_maö
(
ˇche_m™agî
 **
Ãu_m™agî
, 
N
, 
N2
, 
thëa
);

2477 
	`zùf_simuœti⁄
(*
fûíame
,
ˇche_size
,
hdd_max
, 
ssd_max
, 
bgÃu
){

2478 
FILE
 *
åa˚fûe

NULL
;

2479 
i‹eq_evít
 
ªq
;

2480 
disksim_ªque°
 
r
;

2481 
i
;

2482 
åackî_num
 = 64;

2483 
‹g_hdd_∑ges
 = 
hdd_max
;

2484 
thëa
;

2486 
SSD_MAX_PAGES
 = 
ssd_max
;

2487 
HDD_MAX_PAGES
 = 268435456;

2488 
HDD_MAX_PAGES
 = 35913728;

2490 
Wow_HDD_Max_Pages
 = 
HDD_MAX_PAGES
;

2492 
	`wow_wss_öô
(
HDD_MAX_PAGES
);

2494 
™ti_tŸÆ_co°
 = 0.0;

2495 #ifde‡
__löux__


2496 
åa˚fûe
 = 
	`f›í64
(
fûíame
, "r");

2498 
åa˚fûe
 = 
	`f›í
(
fûíame
, "r");

2500 if(
åa˚fûe
 =
NULL
){

2501 
	`Ârötf
(
°dîr
," C™nŸ o≥¿fûê%s\n", 
fûíame
);

2502 
	`Ârötf
(
ouçutfûe
," C™nŸ o≥¿fûê%s\n", 
fûíame
);

2503 
	`exô
(1);

2505 
S_TOTAL
 = 
ˇche_size
;

2506 
R_HIT_TRACKER
 = (
ˇche_m™agî
 **)
	`mÃu_öô
("R_HIT_TRACKER", 
åackî_num
, 
SSD_MAX_PAGES
);

2507 
W_HIT_TRACKER
 = (
ˇche_m™agî
 **)
	`mÃu_öô
("W_HIT_TRACKER", 
åackî_num
, 
SSD_MAX_PAGES
);

2508 
HIT_TRACKER
 = (
ˇche_m™agî
 **)
	`mÃu_öô
("HIT_TRACKER", 
åackî_num
, 
SSD_MAX_PAGES
);

2512 
i
 = 0; ;i++){

2513 
blkno
;

2514 
num
, 
j
;

2515 
cou¡
;

2516 
∑ge_cou¡
;

2517 
SysTime
 
¥ev_now
 = 
now
;

2519 if(
	`iŸø˚_ascii_gë_i‹eq_evít
(
åa˚fûe
, &
ªq
Ë=
NULL
){

2524 
RólTime
 = 
ªq
.
time
;

2527 
blkno
 = (
ªq
.blkno/
BLOCK2SECTOR
)%
HDD_MAX_PAGES
;

2528 
num
 = 
ªq
.
bcou¡
/
BLOCK2SECTOR
;

2529 if(
ªq
.
bcou¡
%
BLOCK2SECTOR
)

2530 
num
++;

2535 
j
 = 0;j < 
num
;j++){

2536 
hô_posôi⁄
 = -1;

2537 
	`wow_wss_ª‰esh
(
blkno
+
j
, 
ªq
.
Êags
);

2538 
rc_tŸÆ
++;

2539 if(
ªq
.
Êags
 =
READ
){

2540 
rc_ªad
++;

2542 if(
	`mÃu_£¨ch
(
W_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 0, 0, &
hô_posôi⁄
)){

2543 
	`upd©e_hô_åackî
(
W_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2545 
	`upd©e_hô_åackî
(
R_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2551 
li°node
 *
node
;

2552 
rc_wrôe
++;

2554 
node
 = 
	`mÃu_£¨ch
(
R_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 0, 0, &
hô_posôi⁄
);

2555 if(
node
){

2556 
	`mÃu_ªmove
(
R_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
);

2558 
	`upd©e_hô_åackî
(
W_HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2561 
	`upd©e_hô_åackî
(
HIT_TRACKER
, 
åackî_num
, 
blkno
+
j
, 
ªq
.
Êags
);

2565 if(
i
 % 50000 == 0){

2566 
	`Ârötf
(
°dout
, "\¿Ród %dÜöe†... \n", 
i
);

2567 
	`fÊush
(
°dout
);

2571 
cou¡
 = 
num
 / (
MAX_REQ_BYTES
/
PAGE
);

2572 if(
num
 % (
MAX_REQ_BYTES
/
PAGE
)){

2573 
cou¡
++;

2579 
thëa
 = 0.1;

2580 
	`zùf_maö
(
W_HIT_TRACKER
, 
åackî_num
,Åøckî_num * 1, ()
thëa
);

2582 
i
=0; i < 
åackî_num
; i++){

2583 
W_HIT_TRACKER
[
i
]->
cm_ªad_hô
 = ()W_HIT_TRACKER[i]->
cm_hô
*0.1;

2589 
thëa
 = 0.3;

2590 
	`zùf_maö
(
R_HIT_TRACKER
, 
åackî_num
,Åøckî_num * 1.5, ()
thëa
);

2592 
	`¥ötf_ªad⁄ly_co°_èbÀ
(
W_HIT_TRACKER
, 
R_HIT_TRACKER
, 
åackî_num
);

2593 
	`¥ötf_wrôe⁄ly_co°_èbÀ
(
W_HIT_TRACKER
, 
R_HIT_TRACKER
, 
åackî_num
);

2594 
rc_ªad
 = 60;

2595 
rc_wrôe
 = 40;

2596 
rc_tŸÆ
 = 
rc_ªad
 + 
rc_wrôe
;

2597 
	`¥ötf_co°_èbÀ
(
W_HIT_TRACKER
, 
R_HIT_TRACKER
, 
åackî_num
);

2604 
	`Ârötf
(
ouçutfûe
, "\n Read Tracked Hit Ratio Curve ... \n");

2605 
	`¥öt_hô_øtio_curve
(
R_HIT_TRACKER
, R_HIT_TRACKER[0]->
cm_ªf
, 
åackî_num
, 
ouçutfûe
);

2606 
	`Ârötf
(
ouçutfûe
, "\n Write Tracked Hit Ratio Curve ... \n");

2607 
	`¥öt_hô_øtio_curve
(
W_HIT_TRACKER
, W_HIT_TRACKER[0]->
cm_ªf
, 
åackî_num
, 
ouçutfûe
);

2609 
	`mÃu_exô
(
R_HIT_TRACKER
, 
åackî_num
);

2610 
	`mÃu_exô
(
W_HIT_TRACKER
, 
åackî_num
);

2611 
	`mÃu_exô
(
HIT_TRACKER
, 
åackî_num
);

2612 
	`f˛o£
(
åa˚fûe
);

2618 
	`ssd_simuœti⁄
(*
fûíame
,
ˇche_size
,
hdd_max
, 
ssd_max
, 
ssd_t
 *
ssd
){

2621 
FILE
 *
åa˚fûe

NULL
;

2622 
i‹eq_evít
 
ªq
;

2623 
i
;

2626 
SSD_MAX_PAGES
 = 
ssd_max
;

2627 
HDD_MAX_PAGES
 = 
hdd_max
;

2629 
™ti_tŸÆ_co°
 = 0.0;

2630 #ifde‡
__löux__


2631 
åa˚fûe
 = 
	`f›í64
(
fûíame
, "r");

2633 
åa˚fûe
 = 
	`f›í
(
fûíame
, "r");

2635 if(
åa˚fûe
 =
NULL
){

2636 
	`Ârötf
(
°dîr
," C™nŸ o≥¿fûê%s\n", 
fûíame
);

2637 
	`exô
(1);

2639 
S_TOTAL
 = 
ˇche_size
;

2642 
	`Ãu_öô
(&
døm_ˇche
, "DRAM_CACHE", 
DRAM_MAX_PAGES
, DRAM_MAX_PAGES, 1, 0);

2644 
	`ªvî£_m≠_¸óã
(
ˇche_size
);

2648 
i
 = 0;ò< 
S_TOTAL
;i++){

2649 
	`CACHE_MAKERQ
(
døm_ˇche
, døm_ˇche->
cm_ssdwq
, 
NULL
, 
i
);

2650 
	`Ãu_ssd_wrôe
(
døm_ˇche
, 
SSD
, 
WRITE
, døm_ˇche->
cm_ssdwq
, 0);

2663 
	`Ârötf
(
°dout
, " Init SSD \n");

2664 
	`Ârötf
(
ouçutfûe
, " Init SSD \n");

2665 
	`fÊush
(
°dout
);

2666 
	`fÊush
(
ouçutfûe
);

2668 
now
 = 0.0;

2669 
SSD_WRITE_TIME
 = 0.0;

2670 
i
 = 0; i < 
ssd
->
∑øms
.
√Àmíts
; i ++) {

2671 
ssd_ñemít_°©
 *
°©
 = &(
ssd
->
ñemíts
[
i
].stat);

2672 
°©
->
num_˛ón
 = 0;

2676 
i
 = 0; ;i++){

2677 
blkno
;

2678 
num
, 
j
;

2679 
£q_io
 = 0;

2680 
SysTime
 
¥ev_now
 = 
now
;

2682 if(
	`iŸø˚_ascii_gë_i‹eq_evít
(
åa˚fûe
, &
ªq
Ë=
NULL
){

2686 
blkno
 = (
ªq
.blkno/
BLOCK2SECTOR
);

2687 
num
 = 
ªq
.
bcou¡
/
BLOCK2SECTOR
;

2688 if(
ªq
.
bcou¡
%
BLOCK2SECTOR
)

2689 
num
++;

2691 if(
num
 >
SEQ_COUNT
)

2692 
£q_io
 = 1;

2694 
j
 = 0;j < 
num
;j++){

2695 
døm_hô
 = 0;

2696 
b
 = (
blkno
+ 
j
Ë% 
S_TOTAL
;

2700 
døm_hô
 = 
	`£¨ch_døm_ˇche
(
døm_ˇche
, 
b
, 
ªq
.
Êags
);

2703 if(
ªq
.
Êags
 =
READ
){

2704 if(!
døm_hô
){

2705 
	`CACHE_MAKERQ
(
døm_ˇche
, døm_ˇche->
cm_ssdrq
, 
NULL
, 
b
);

2708 
	`CACHE_MAKERQ
(
døm_ˇche
, døm_ˇche->
cm_ssdwq
, 
NULL
, 
b
);

2713 if(
ªq
.
Êags
 =
READ
){

2715 
	`Ãu_°age
(
døm_ˇche
);

2718 
	`Ãu_ssd_ªad
(
døm_ˇche
, 
SSD
, 
READ
, døm_ˇche->
cm_ssdrq
, 0);

2721 
	`Ãu_de°age
(
døm_ˇche
);

2724 
	`Ãu_ssd_wrôe
(
døm_ˇche
, 
SSD
, 
WRITE
, døm_ˇche->
cm_ssdwq
, 0);

2727 if(
i
 % 50000 == 0){

2728 
	`Ârötf
(
°dout
, "\¿Ród %dÜöe†... \n", 
i
);

2729 
	`fÊush
(
°dout
);

2732 
	`°©_upd©e
 (&
cuºssd
->
°©
.
ª•⁄£°©s
,()(
now
 - 
¥ev_now
));

2738 
	`Ârötf
(
°dout
, " %d TŸÆ Co° = %.2f£c,ávg Co° = %.2fus\n", 
ˇche_size
, 
™ti_tŸÆ_co°
/1000000,á¡i_tŸÆ_co°/
i
);

2743 
	`Ârötf
(
ouçutfûe
, " Syssim : Executi⁄ Timê= %f\n", 
now
);

2745 
	`Ârötf
(
ouçutfûe
, " Syssim : Døm Hô R©iÿ= %f\n", 
	`CACHE_HIT
(
døm_ˇche
));

2746 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêCou¡ = %d\n", 
døm_ˇche
->
cm_°age_cou¡
);

2747 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêCou¡ = %d\n", 
døm_ˇche
->
cm_de°age_cou¡
);

2748 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Ród Time = %f\n", 
SSD_READ_TIME
);

2749 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD WrôêTime = %f\n", 
SSD_WRITE_TIME
);

2750 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêTime = %f\n", 
STAGE_TIME
);

2751 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêTime = %f\n", 
DESTAGE_TIME
);

2752 
	`Ârötf
(
ouçutfûe
, " Syssim : Disk Ród = %.3f\n", 
HDD_TOTALCOST_R
/
HDD_COUNT_R
);

2753 
	`Ârötf
(
ouçutfûe
, " Syssim : Disk Wrôe = %.3f\n", 
HDD_TOTALCOST_W
/
HDD_COUNT_W
);

2754 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Ród = %.3f\n", 
SSD_TOTALCOST_R
/
SSD_COUNT_R
);

2755 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Wrôe = %.3f\n", 
SSD_TOTALCOST_W
/
SSD_COUNT_W
);

2760 
	`ªvî£_m≠_‰ì
();

2761 
	`f˛o£
(
åa˚fûe
);

2762 
	`CACHE_CLOSE
(
døm_ˇche
);

2768 
	`disk_simuœti⁄
(*
fûíame
,
ˇche_size
,
hdd_max
, 
ssd_max
, 
bgÃu
){

2771 
FILE
 *
åa˚fûe

NULL
;

2772 
i‹eq_evít
 
ªq
;

2773 
i
;

2776 
SSD_MAX_PAGES
 = 
ssd_max
;

2777 
HDD_MAX_PAGES
 = 
hdd_max
;

2779 
™ti_tŸÆ_co°
 = 0.0;

2780 #ifde‡
__löux__


2781 
åa˚fûe
 = 
	`f›í64
(
fûíame
, "r");

2783 
åa˚fûe
 = 
	`f›í
(
fûíame
, "r");

2785 if(
åa˚fûe
 =
NULL
){

2786 
	`Ârötf
(
°dîr
," C™nŸ o≥¿fûê%s\n", 
fûíame
);

2787 
	`exô
(1);

2789 
S_TOTAL
 = 
ˇche_size
;

2798 
	`Ãu_öô
(&
døm_ˇche
, "DRAM_CACHE", 
DRAM_MAX_PAGES
, DRAM_MAX_PAGES, 1, 0);

2800 
	`ªvî£_m≠_¸óã
(
ˇche_size
);

2802 
i
 = 0; ;i++){

2803 
blkno
;

2804 
num
, 
j
;

2805 
£q_io
 = 0;

2806 
SysTime
 
¥ev_now
 = 
now
;

2808 if(
	`iŸø˚_ascii_gë_i‹eq_evít
(
åa˚fûe
, &
ªq
Ë=
NULL
){

2812 
blkno
 = (
ªq
.blkno/
BLOCK2SECTOR
)%
HDD_MAX_PAGES
;

2813 
num
 = 
ªq
.
bcou¡
/
BLOCK2SECTOR
;

2814 if(
ªq
.
bcou¡
%
BLOCK2SECTOR
)

2815 
num
++;

2817 if(
num
 >
SEQ_COUNT
)

2818 
£q_io
 = 1;

2820 
j
 = 0;j < 
num
;j++){

2821 
døm_hô
 = 0;

2825 
døm_hô
 = 
	`£¨ch_døm_ˇche
(
døm_ˇche
, 
blkno
 + 
j
, 
ªq
.
Êags
);

2828 if(
ªq
.
Êags
 =
READ
){

2829 if(!
døm_hô
){

2830 
	`CACHE_MAKERQ
(
døm_ˇche
, døm_ˇche->
cm_hddrq
, 
NULL
, 
blkno
 + 
j
);

2833 
	`CACHE_MAKERQ
(
døm_ˇche
, døm_ˇche->
cm_hddwq
, 
NULL
, 
blkno
 + 
j
);

2838 if(
ªq
.
Êags
 =
READ
){

2840 
	`Ãu_°age
(
døm_ˇche
);

2843 
	`Ãu_ssd_ªad
(
døm_ˇche
, 
SSD
, 
READ
, døm_ˇche->
cm_ssdrq
, 0);

2846 
	`Ãu_de°age
(
døm_ˇche
);

2849 
	`Ãu_ssd_wrôe
(
døm_ˇche
, 
SSD
, 
WRITE
, døm_ˇche->
cm_ssdwq
, 0);

2852 if(
i
 % 50000 == 0){

2853 
	`Ârötf
(
°dout
, "\¿Ród %dÜöe†... \n", 
i
);

2854 
	`fÊush
(
°dout
);

2856 
	`°©_upd©e
 (&
cuºssd
->
°©
.
ª•⁄£°©s
, ()(
now
 - 
¥ev_now
));

2861 
	`Ârötf
(
°dout
, " %d TŸÆ Co° = %.2f£c,ávg Co° = %.2fus\n", 
ˇche_size
, 
™ti_tŸÆ_co°
/1000000,á¡i_tŸÆ_co°/
i
);

2866 
	`Ârötf
(
ouçutfûe
, " Syssim : Executi⁄ Timê= %f\n", 
now
);

2867 
	`Ârötf
(
ouçutfûe
, " Syssim : Fœsh Hô R©iÿ= %f\n", 
	`CACHE_HIT
(
døm_ˇche
));

2868 
	`Ârötf
(
ouçutfûe
, " Syssim : Døm Hô R©iÿ= %f\n", 
	`CACHE_HIT
(
døm_ˇche
));

2869 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêCou¡ = %d\n", 
døm_ˇche
->
cm_°age_cou¡
);

2870 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêCou¡ = %d\n", 
døm_ˇche
->
cm_de°age_cou¡
);

2871 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Ród Time = %f\n", 
SSD_READ_TIME
);

2872 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD WrôêTime = %f\n", 
SSD_WRITE_TIME
);

2873 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêTime = %f\n", 
STAGE_TIME
);

2874 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêTime = %f\n", 
DESTAGE_TIME
);

2875 
	`Ârötf
(
ouçutfûe
, " Syssim : Disk Ród = %.3f\n", 
HDD_TOTALCOST_R
/
HDD_COUNT_R
);

2876 
	`Ârötf
(
ouçutfûe
, " Syssim : Disk Wrôe = %.3f\n", 
HDD_TOTALCOST_W
/
HDD_COUNT_W
);

2877 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Ród = %.3f\n", 
SSD_TOTALCOST_R
/
SSD_COUNT_R
);

2878 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Wrôe = %.3f\n", 
SSD_TOTALCOST_W
/
SSD_COUNT_W
);

2883 
	`ªvî£_m≠_‰ì
();

2884 
	`f˛o£
(
åa˚fûe
);

2885 
	`CACHE_CLOSE
(
døm_ˇche
);

3129 
	`rw_simuœti⁄
(*
fûíame
,
ˇche_size
,
hdd_max
, 
ssd_max
, 
bgÃu
){

3130 
ˇche_m™agî
 *
Êash_ˇche
;

3132 
FILE
 *
åa˚fûe

NULL
;

3133 
i‹eq_evít
 
ªq
;

3134 
i
;

3135 
öc
 = 32768;

3137 
SSD_MAX_PAGES
 = 
ssd_max
;

3138 
HDD_MAX_PAGES
 = 
hdd_max
;

3140 
™ti_tŸÆ_co°
 = 0.0;

3141 #ifde‡
__löux__


3142 
åa˚fûe
 = 
	`f›í64
(
fûíame
, "r");

3144 
åa˚fûe
 = 
	`f›í
(
fûíame
, "r");

3147 if(
åa˚fûe
 =
NULL
){

3148 
	`Ârötf
(
°dîr
," C™nŸ o≥¿fûê%s\n", 
fûíame
);

3149 
	`exô
(1);

3153 
SSD_USABLE_PAGES
 = 
S_TOTAL
 = 
ˇche_size
-1;

3156 if(
S_TOTAL
+
öc
 > 
SSD_MAX_PAGES
){

3157 
öc
 = 8192;

3158 
SSD_USABLE_PAGES
 -
öc
;

3159 
S_TOTAL
 -
öc
;

3160 
Wow_Max_High_W©î
 -
öc
;

3162 
öc
 = 0;

3165 
	`ªvî£_m≠_¸óã
(
S_TOTAL
+
öc
);

3166 
	`¥ötf
(" Max = %d, S∑ª Page†%d \n", 
SSD_USABLE_PAGES
, 
öc
);

3172 if(!
bgÃu
){

3173 
	`Ãu_öô
(&
Êash_ˇche
,"LRU", 
S_TOTAL
-1, 
SSD_MAX_PAGES
, 1024, 0);

3174 
Êash_ˇche
->
cm_pﬁicy
 = 
CACHE_LRU_RW
;

3176 
	`bg˛ock_öô
(&
Êash_ˇche
,"BGCLOCK", 
S_TOTAL
-1, 
SSD_MAX_PAGES
-1, 1024, 0);

3177 
W_CLOCK
->
cm_pﬁicy
 =
CACHE_BGCLOCK_RW
;

3180 
	`Ãu_öô
(&
døm_ˇche
, "DRAM_CACHE", 
DRAM_MAX_PAGES
, DRAM_MAX_PAGES, 1, 0);

3193 
i
 = 0;;i++){

3194 
blkno
;

3195 
num
, 
j
;

3196 
£q_io
 = 0;

3197 
SysTime
 
¥ev_now
 = 
now
;

3198 
SysTime
 
¥ev_°age
 = 
STAGE_TIME
;

3199 
SysTime
 
¥ev_de°age
 = 
DESTAGE_TIME
;

3200 
SysTime
 
¥ev_ssd_ªad
 = 
SSD_READ_TIME
;

3201 
SysTime
 
¥ev_ssd_wrôe
 = 
SSD_WRITE_TIME
;

3202 
SysTime
 
¥ev_gc0
 = 
cuºssd
->
ñemíts
[0].
°©
.
tŸ_˛ón_time
;

3204 
SysTime
 
cuº_gc0
;

3208 if(
	`iŸø˚_ascii_gë_i‹eq_evít
(
åa˚fûe
, &
ªq
Ë=
NULL
){

3214 
blkno
 = (
ªq
.blkno/
BLOCK2SECTOR
)%
HDD_MAX_PAGES
;

3215 
num
 = 
ªq
.
bcou¡
/
BLOCK2SECTOR
;

3216 if(
ªq
.
bcou¡
%
BLOCK2SECTOR
)

3217 
num
++;

3219 if(
num
 >
SEQ_COUNT
)

3220 
£q_io
 = 1;

3222 
j
 = 0;j < 
num
;j++){

3223 
døm_hô
 = 0;

3227 
døm_hô
 = 
	`£¨ch_døm_ˇche
(
døm_ˇche
, 
blkno
 + 
j
, 
ªq
.
Êags
);

3229 if(!
bgÃu
){

3230 
	`rw_make_ªq
(
Êash_ˇche
, 
blkno
 + 
j
, 
ªq
.
Êags
, 
døm_hô
, 
£q_io
);

3232 
	`gí_ªq_wôh_bg˛ock
(
Êash_ˇche
, &
ªq
, 
blkno
 + 
j
, 
døm_hô
, 
£q_io
);

3236 if(
ªq
.
Êags
 =
READ
){

3237 
FCM_REQ_FLAG
 = 
WRITE
;

3239 
	`Ãu_°age
(
Êash_ˇche
);

3242 
	`Ãu_ssd_ªad
(
Êash_ˇche
, 
SSD
, 
READ
, fœsh_ˇche->
cm_ssdrq
, 0);

3244 
FCM_REQ_FLAG
 = 
WRITE
;

3246 
	`Ãu_de°age
(
Êash_ˇche
);

3249 
	`Ãu_ssd_wrôe
(
Êash_ˇche
, 
SSD
, 
WRITE
, fœsh_ˇche->
cm_ssdwq
, 0);

3254 if(
i
 && i % 50000 == 0){

3255 
	`Ârötf
(
°dout
, "\n FP-FCL: Cur Read %dÜines hit = %.2f(%.2fMB)Ñes = %.3fms... \n",

3256 
i
, 
	`CACHE_HIT
(
Êash_ˇche
), ()Êash_ˇche->
cm_cou¡
/256,

3257 ()
cuºssd
->
°©
.
ª•⁄£°©s
.
runvÆ
/cuºssd->°©.ª•⁄£°©s.
cou¡
);

3258 
	`Ârötf
(
°dout
, " A˘uÆ Page†%d, Idó»Page†%d\n", 
Êash_ˇche
->
cm_cou¡
, 
ˇche_size
);

3259 
	`fÊush
(
°dout
);

3262 
	`°©_upd©e
 (&
cuºssd
->
°©
.
ª•⁄£°©s
,()(
now
 - 
¥ev_now
));

3264 
cuº_gc0
 = 
cuºssd
->
ñemíts
[0].
°©
.
tŸ_˛ón_time
;

3273 if(0 && 
Êash_ˇche
->
cm_ªf
){

3274 
	`wow_ª•⁄£_åackög
(

3275 
now
,

3276 ()(
now
 - 
¥ev_now
),

3277 ()(
STAGE_TIME
 - 
¥ev_°age
),

3278 ()(
DESTAGE_TIME
 - 
¥ev_de°age
),

3279 ()(
SSD_READ_TIME
 - 
¥ev_ssd_ªad
),

3280 ()(
SSD_WRITE_TIME
 - 
¥ev_ssd_wrôe
),

3281 ()(
cuº_gc0
 - 
¥ev_gc0
),

3282 
SSD_MAX_PAGES
,

3283 
Êash_ˇche
->
cm_cou¡
,

3284 
Êash_ˇche
->
cm_cou¡
,

3285 
S_TOTAL
,

3286 
S_TOTAL
,

3287 
Êash_ˇche
->
cm_hô
*100/Êash_ˇche->
cm_ªf
,

3289 ()
cuºssd
->
°©
.
ª•⁄£°©s
.
runvÆ
/cuºssd->°©.ª•⁄£°©s.
cou¡


3298 
	`Ârötf
(
°dout
, " %d TŸÆ Co° = %.2f£c,ávg Co° = %.2fus\n", 
ˇche_size
, 
™ti_tŸÆ_co°
/1000000,á¡i_tŸÆ_co°/
i
);

3303 
	`Ârötf
(
ouçutfûe
, " Syssim : Executi⁄ Timê= %f\n", 
now
);

3305 
	`Ârötf
(
ouçutfûe
, " Syssim : TŸÆ Hô R©iÿ= %.3f\n", 
	`CACHE_HIT
(
Êash_ˇche
));

3306 
	`Ârötf
(
ouçutfûe
, " Syssim : Døm Hô R©iÿ= %f\n", 
	`CACHE_HIT
(
døm_ˇche
));

3307 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêCou¡ = %d\n", 
Êash_ˇche
->
cm_°age_cou¡
);

3308 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêCou¡ = %d\n", 
Êash_ˇche
->
cm_de°age_cou¡
);

3309 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Ród Time = %f\n", 
SSD_READ_TIME
);

3310 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD WrôêTime = %f\n", 
SSD_WRITE_TIME
);

3311 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêTime = %f\n", 
STAGE_TIME
);

3312 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêTime = %f\n", 
DESTAGE_TIME
);

3313 
	`Ârötf
(
ouçutfûe
, " Syssim : Disk Ród = %.3f\n", 
HDD_TOTALCOST_R
/
HDD_COUNT_R
);

3314 
	`Ârötf
(
ouçutfûe
, " Syssim : Disk Wrôe = %.3f\n", 
HDD_TOTALCOST_W
/
HDD_COUNT_W
);

3315 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Ród = %.3f\n", 
SSD_TOTALCOST_R
/
SSD_COUNT_R
);

3316 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Wrôe = %.3f\n", 
SSD_TOTALCOST_W
/
SSD_COUNT_W
);

3323 
	`CACHE_CLOSE
(
Êash_ˇche
);

3324 
	`ªvî£_m≠_‰ì
();

3325 
	`f˛o£
(
åa˚fûe
);

3326 
	`CACHE_CLOSE
(
døm_ˇche
);

3332 
	`¥öt_dúty_øã
(
ˇche_m™agî
 *
c
, 
r_size
, 
w_size
, 
FILE
 *
Â
){

3333 
li°node
 *
node
 = 
c
->
cm_hód
->
√xt
;

3334 
Ãu_node
 *
 
;

3335 
i
;

3336 
tŸÆ
 = 0;

3337 
ªad_cou¡
 = 0;

3338 
wrôe_cou¡
 = 0;

3339 
˛ón_size
 = 0;

3340 
dúty_size
 = 0;

3341 
tŸÆ_size
 = 
r_size
 + 
w_size
;

3343 
node
 !
c
->
cm_hód
 &&Çode){

3344 
 
 = (
Ãu_node
 *)
node
->
d©a
;

3346 
tŸÆ
++;

3347 if(
 
->
˙_ªad
)

3348 
ªad_cou¡
++;

3349 if(
 
->
˙_dúty
)

3350 
wrôe_cou¡
++;

3352 
node
 =Çode->
√xt
;

3355 
dúty_size
 = ()
w_size
 * ((()
wrôe_cou¡
-
ªad_cou¡
)/
tŸÆ
);

3356 
˛ón_size
 = ()
w_size
 * (()
ªad_cou¡
/
tŸÆ
);

3358 
	`Ârötf
(
Â
, " Syssim: Ród CachêR©ê%.2‡(%.3fMB)\n", ()
r_size
/
SSD_MAX_PAGES
, ()r_size/256);

3359 
	`Ârötf
(
Â
, " Syssim: WrôêCachêR©ê%.2‡(%.3fMB)\n", ()
dúty_size
/
SSD_MAX_PAGES
, ()dirty_size/256);

3360 
	`Ârötf
(
Â
, " Syssim: RW CachêR©ê%.2‡(%.3fMB)\n", ()
˛ón_size
/
SSD_MAX_PAGES
, ()clean_size/256);

3361 
	`Ârötf
(
Â
, " Syssim: Ovî CachêR©ê%.2‡(%.3fMB)\n", ()(
SSD_MAX_PAGES
-
tŸÆ_size
)/SSD_MAX_PAGES, ()(SSD_MAX_PAGES-total_size)/256);

3363 
	`Ârötf
(
Â
, " LRU cÀ™Ñ©ê%f\n", ()
ªad_cou¡
/
tŸÆ
);

3364 
	`Ârötf
(
Â
, " LRU dútyÑ©ê%f\n", ()
wrôe_cou¡
/
tŸÆ
);

3374 
	`ad≠tive_simuœti⁄
(*
fûíame
,
åackî_num
, 
ˇche_size
,
HDD_MAX
, 
SSD_MAX
,
bgÃu
, 
adj_ovî¥ov
, 
£À˘ive
){

3375 
li°node
 *
node
;

3376 
˛ock_node
 *
˙
;

3377 
FILE
 *
åa˚fûe

NULL
;

3378 
i‹eq_evít
 
ªq
;

3379 
i
;

3380 
adj_cou¡
 = 0;

3381 
£q_dëe˘ed
 = 0;

3382 
£q_dëe˘ed_cou¡
 = 0;

3383 
£q_dëe˘ed_cou¡2
 = 0;

3384 *
ãmp
[4];

3385 
ã°blk
 = 0;

3386 
™ti_tŸÆ_co°
 = 0.0;

3388 
SSD_MAX_PAGES
 = 
SSD_MAX
;

3389 
HDD_MAX_PAGES
 = 
HDD_MAX
;

3390 #i‚de‡
__löux__


3392 
Wow_HDD_Max_Pages
 = 
HDD_MAX_PAGES
;

3395 
SSD_USABLE_PAGES
 = 
ˇche_size
-2;

3400 if(
adj_ovî¥ov
)

3401 
	`ªvî£_m≠_¸óã
(
ˇche_size
);

3403 
öc
 = 32768;

3404 if(
ˇche_size
+
öc
 > 
SSD_MAX_PAGES
){

3405 
öc
 = -(4096+2048);

3406 
SSD_USABLE_PAGES
 +
öc
;

3407 
Wow_Max_High_W©î
 +
öc
;

3409 
	`ªvî£_m≠_¸óã
(
ˇche_size
+
öc
);

3412 
	`¥ötf
(" Max = %d, S∑ª Page†%d \n", 
SSD_USABLE_PAGES
, 
öc
);

3417 
S_TOTAL
 = 
SSD_USABLE_PAGES
;

3418 
R_VALUE
 = ()50;

3419 
	`ˇlc_rw_∑πôi⁄_size
(
S_TOTAL
, 
R_VALUE
, &
S_READ
, &
S_WRITE
, 0, 0);

3421 
	`Ãu_öô
(&
R_CLOCK
,"R_CLOCK", 
S_READ
-1, 
SSD_MAX_PAGES
-1, 1, 0);

3422 if(
bgÃu
){

3423 
	`bg˛ock_öô
(&
W_CLOCK
,"W_CLOCK", 
S_WRITE
-1, 
SSD_MAX_PAGES
-1, 1024, 0);

3424 
R_CLOCK
->
cm_pﬁicy
 = 
W_CLOCK
->cm_pﬁicy = 
CACHE_BGCLOCK_RWO_ADAPTIVE
;

3426 
	`Ãu_öô
(&
W_CLOCK
,"W_CLOCK", 
S_WRITE
-1, 
SSD_MAX_PAGES
-1, 1024, 0);

3427 if(
adj_ovî¥ov
)

3428 
R_CLOCK
->
cm_pﬁicy
 = 
W_CLOCK
->cm_pﬁicy = 
CACHE_LRU_RWO_ADAPTIVE
;

3430 
R_CLOCK
->
cm_pﬁicy
 = 
W_CLOCK
->cm_pﬁicy = 
CACHE_LRU_RW_ADAPTIVE
;

3435 
	`Ãu_öô
(&
døm_ˇche
, "DRAM_CACHE", 
DRAM_MAX_PAGES
, DRAM_MAX_PAGES, 1, 0);

3436 
	`£q_dëe˘_öô
(&
£q_dëe˘‹
,"SEQ_DETECTOR", 
SEQ_COUNT
, SEQ_COUNT, 1, 0);

3439 if(!
RESIZE_PERIOD
){

3440 
RESIZE_PERIOD
 = 
SSD_MAX_PAGES
/
åackî_num
;

3442 
HIT_TRACKER_NUM
 = 
åackî_num
;

3444 if(
adj_ovî¥ov
){

3445 
W_HIT_TRACKER
 = (
ˇche_m™agî
 **)
	`mÃu_öô
("W_HIT_TRACKER", 
HIT_TRACKER_NUM
, 
SSD_MAX_PAGES
);

3446 
R_HIT_TRACKER
 = (
ˇche_m™agî
 **)
	`mÃu_öô
("R_HIT_TRACKER", 
HIT_TRACKER_NUM
, 
SSD_MAX_PAGES
);

3448 
W_HIT_TRACKER
 = (
ˇche_m™agî
 **)
	`mÃu_öô
("W_HIT_TRACKER", 
HIT_TRACKER_NUM
, 
SSD_USABLE_PAGES
);

3449 
R_HIT_TRACKER
 = (
ˇche_m™agî
 **)
	`mÃu_öô
("R_HIT_TRACKER", 
HIT_TRACKER_NUM
, 
SSD_USABLE_PAGES
);

3453 
U_INC
 = 
SSD_MAX_PAGES
/
åackî_num
;

3454 
R_P_INC
 = 
U_INC
;

3455 
	`Ârötf
(
°dout
, "ResizêPîiod = %d \n", 
RESIZE_PERIOD
);

3456 
	`Ârötf
(
°dout
, "Hô R©iÿTøckî Wödow Cou¡ = %d\n", 
HIT_TRACKER_NUM
);

3457 
	`Ârötf
(
°dout
, "U sã∞%d, R sã∞%d\n", 
U_INC
, 
R_P_INC
);

3459 
	`Ârötf
(
ouçutfûe
, "ResizêPîiod = %d \n", 
RESIZE_PERIOD
);

3460 
	`Ârötf
(
ouçutfûe
, "Hô R©iÿTøckî Wödow Cou¡ = %d\n", 
HIT_TRACKER_NUM
);

3463 #ifde‡
__löux__


3464 
åa˚fûe
 = 
	`f›í64
(
fûíame
, "r");

3466 
åa˚fûe
 = 
	`f›í
(
fûíame
, "r");

3468 if(
åa˚fûe
 =
NULL
){

3469 
	`Ârötf
(
°dîr
," C™nŸ o≥¿fûê%s\n", 
fûíame
);

3470 
	`exô
(1);

3473 
ãmp
[0] = 
W_CLOCK
->
cm_ssdwq
;

3474 
ãmp
[1] = 
W_CLOCK
->
cm_ssdrq
;

3475 
ãmp
[2] = 
W_CLOCK
->
cm_hddwq
;

3476 
ãmp
[3] = 
W_CLOCK
->
cm_hddrq
;

3478 
W_CLOCK
->
cm_ssdwq
 = 
R_CLOCK
->cm_ssdwq;

3479 
W_CLOCK
->
cm_ssdrq
 = 
R_CLOCK
->cm_ssdrq;

3480 
W_CLOCK
->
cm_hddwq
 = 
R_CLOCK
->cm_hddwq;

3481 
W_CLOCK
->
cm_hddrq
 = 
R_CLOCK
->cm_hddrq;

3484 
	`make_uèbÀ
();

3486 
i
 = 0;;i++){

3487 
blkno
;

3488 
num
, 
j
;

3489 
ªs
;

3490 
£q_io
 = 0;

3491 
SysTime
 
¥ev_now
 = 
now
;

3492 
SysTime
 
¥ev_°age
 = 
STAGE_TIME
;

3493 
SysTime
 
¥ev_de°age
 = 
DESTAGE_TIME
;

3494 
SysTime
 
¥ev_ssd_ªad
 = 
SSD_READ_TIME
;

3495 
SysTime
 
¥ev_ssd_wrôe
 = 
SSD_WRITE_TIME
;

3496 
SysTime
 
¥ev_gc0
 = 
cuºssd
->
ñemíts
[0].
°©
.
tŸ_˛ón_time
;

3498 
SysTime
 
cuº_gc0
;

3501 if(
	`iŸø˚_ascii_gë_i‹eq_evít
(
åa˚fûe
, &
ªq
Ë=
NULL
){

3514 
blkno
 = (
ªq
.blkno/
BLOCK2SECTOR
)%
HDD_MAX_PAGES
;

3515 
num
 = 
ªq
.
bcou¡
/
BLOCK2SECTOR
;

3516 if(
ªq
.
bcou¡
%
BLOCK2SECTOR
)

3517 
num
++;

3520 #ifde‡
SEQ_TEST


3521 
blkno
 = 
ã°blk
++;

3522 
num
 = 1;

3525 if(
num
 >
SEQ_COUNT
 && SEQ_COUNT > 0){

3526 
£q_io
 = 1;

3527 
£q_dëe˘ed_cou¡
++;

3530 
£q_io
 = 0;

3533 
j
 = 0;j < 
num
;j++){

3534 
døm_hô
 = 0;

3535 
bno
 = 
blkno
+
j
;

3536 
rc_tŸÆ
++;

3538 
g_GHOST_HIT
 = 0;

3542 if(
adj_ovî¥ov
){

3551 if(!
£q_dëe˘ed
){

3552 
døm_hô
 = 
	`£¨ch_døm_ˇche
(
døm_ˇche
, 
bno
, 
ªq
.
Êags
);

3553 if(
bgÃu
)

3554 
	`ad≠tive_gí_ªq_wôh_bg˛ock
(
R_CLOCK
, 
W_CLOCK
, &
ªq
, 
bno
, 
døm_hô
, 
£q_io
);

3556 
	`ad≠tive_gí_ªq
(
R_CLOCK
, 
W_CLOCK
, &
ªq
, 
bno
, 
døm_hô
, 
£q_io
, 
£À˘ive
);

3559 
g_GHOST_HIT
 = 0;

3561 if((
rc_tŸÆ
/()
RESIZE_PERIOD
Ë=(
adj_cou¡
+1Ë|| (
g_GHOST_HIT
 && !
£q_io
)){

3562 if(!
g_GHOST_HIT
)

3563 
adj_cou¡
++;

3565 if(
adj_ovî¥ov
){

3566 
	`adju°_afcm_ˇche_size
(
W_HIT_TRACKER
, 
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 1, 1);

3568 
	`adju°_fcmrw_ˇche_size
(
W_HIT_TRACKER
, 
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
, 1, 1);

3570 
	`ªsize_rw_ˇche_size
(
R_CLOCK
, 
W_CLOCK
);

3572 if(
adj_ovî¥ov
){

3573 
	`deˇy_hô_åackî
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
);

3574 
	`deˇy_hô_åackî
(
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
);

3577 if(
adj_cou¡
 % 2 == 0){

3583 if(
R_CLOCK
->
cm_cou¡
 + 
W_CLOCK
->cm_cou¡ !
ªvî£_u£d
){

3584 
	`Ârötf
(
°dîr
, " countÉrror \n");

3587 if(
ªq
.
Êags
 =
READ
){

3588 
FCM_REQ_FLAG
 = 
READ
;

3590 
	`Ãu_°age
(
R_CLOCK
);

3593 
	`Ãu_ssd_ªad
(
R_CLOCK
, 
SSD
, 
READ
, R_CLOCK->
cm_ssdrq
, 0);

3595 
FCM_REQ_FLAG
 = 
WRITE
;

3597 
	`Ãu_de°age
(
W_CLOCK
);

3600 
	`Ãu_ssd_wrôe
(
W_CLOCK
, 
SSD
, 
WRITE
, W_CLOCK->
cm_ssdwq
, 0);

3607 if(
W_CLOCK
->
cm_‰ì
 < 0){

3608 
	`rw_ª∂a˚mít
(
W_CLOCK
, 0);

3609 
	`Ãu_de°age
(
W_CLOCK
);

3613 if(
R_CLOCK
->
cm_‰ì
 < 0){

3614 
	`rw_ª∂a˚mít
(
R_CLOCK
, 0);

3620 if(
i
 && i % 50000 == 0){

3621 if(
adj_ovî¥ov
){

3622 
	`Ârötf
(
°dout
, "\n OP-FCL: Cur Read %dÜinesÑhit = %.2f(%.2fMB), whit = %.2f(%.2fMB)... \n",

3623 
i
, 
	`CACHE_HIT
(
R_CLOCK
), ()R_CLOCK->
cm_cou¡
/256, CACHE_HIT(
W_CLOCK
), ()W_CLOCK->cm_count/256);

3625 
	`Ârötf
(
°dout
, "\n RW-FCL: Cur Read %dÜinesÑhit = %.2f(%.2fMB), whit = %.2f(%.2fMB) %d... \n",

3626 
i
, 
	`CACHE_HIT
(
R_CLOCK
), ()R_CLOCK->
cm_cou¡
/256, CACHE_HIT(
W_CLOCK
), ()W_CLOCK->cm_count/256, R_CLOCK->cm_count+W_CLOCK->cm_count);

3629 
	`Ârötf
(
°dout
, " A˘uÆ Page†%d, Idó»Page†%d\n", 
W_CLOCK
->
cm_cou¡
+
R_CLOCK
->cm_cou¡, 
S_READ
+
S_WRITE
);

3631 
	`Ârötf
(
°dout
, " Rec Read %dÜinesÑhit = %.2f(%.2fMB), whit = %.2f(%.2fMB)... \n",

3632 
i
, 
	`CACHE_HIT
(
R_CLOCK
), ()
S_READ
/256, CACHE_HIT(
W_CLOCK
), ()
S_WRITE
/256);

3633 
	`Ârötf
(
°dout
, " TŸÆ hô = %.3f, RódÑ©ê%.3f, Wrôêøã = %.3‡\n", ()(
W_CLOCK
->
cm_hô
+
R_CLOCK
->cm_hô)/
rc_tŸÆ
, ()
rc_ªad
/rc_tŸÆ, ()
rc_wrôe
/rc_total);

3635 
	`Ârötf
(
°dout
, " Re•⁄£ Timê=%.3fm†\n", ()
cuºssd
->
°©
.
ª•⁄£°©s
.
runvÆ
/cuºssd->°©.ª•⁄£°©s.
cou¡
);

3636 
	`fÊush
(
°dout
);

3642 
	`°©_upd©e
 (&
cuºssd
->
°©
.
ª•⁄£°©s
,()(
now
 - 
¥ev_now
));

3644 
cuº_gc0
 = 
cuºssd
->
ñemíts
[0].
°©
.
tŸ_˛ón_time
;

3648 if(
R_CLOCK
->
cm_ªf
 && 
W_CLOCK
->cm_ª‡&& W_CLOCK->
cm_pﬁicy
 =
CACHE_LRU_RWO_ADAPTIVE
){

3649 
	`wow_ª•⁄£_åackög
(
now
, ()“ow - 
¥ev_now
),

3650 ()(
STAGE_TIME
 - 
¥ev_°age
),

3651 ()(
DESTAGE_TIME
 - 
¥ev_de°age
),

3652 ()(
SSD_READ_TIME
 - 
¥ev_ssd_ªad
),

3653 ()(
SSD_WRITE_TIME
 - 
¥ev_ssd_wrôe
),

3654 ()(
cuº_gc0
 - 
¥ev_gc0
),

3655 
SSD_MAX_PAGES
,

3656 
S_READ
,

3657 
S_WRITE
,

3658 
R_CLOCK
->
cm_cou¡
,

3659 
W_CLOCK
->
cm_cou¡
,

3660 
R_CLOCK
->
cm_hô
*100/(R_CLOCK->
cm_ªf
),

3661 
W_CLOCK
->
cm_hô
*100/(W_CLOCK->
cm_ªf
),

3662 ()
cuºssd
->
°©
.
ª•⁄£°©s
.
runvÆ
/cuºssd->°©.ª•⁄£°©s.
cou¡


3668 
	`Ârötf
(
ouçutfûe
, " Syssim : Executi⁄ Timê= %f\n", 
now
);

3669 
	`Ârötf
(
ouçutfûe
, " Syssim : Døm Hô R©iÿ= %f\n", 
	`CACHE_HIT
(
døm_ˇche
));

3670 
	`Ârötf
(
ouçutfûe
, " Syssim : Fœsh Hô R©iÿRHô R©iÿ= %f\n", 
	`CACHE_HIT
(
R_CLOCK
));

3671 
	`Ârötf
(
ouçutfûe
, " Syssim : Fœsh Hô R©iÿWHô R©iÿ= %f\n", 
	`CACHE_HIT
(
W_CLOCK
));

3672 
	`Ârötf
(
ouçutfûe
, " Syssim : TŸÆ Hô R©iÿ= %.3f\n", ()(
R_CLOCK
->
cm_hô
 + 
W_CLOCK
->cm_hô)/
rc_tŸÆ
);

3676 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêCou¡ = %d\n", 
R_CLOCK
->
cm_°age_cou¡
 + 
W_CLOCK
->cm_stage_count);

3677 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêCou¡ = %d\n", 
R_CLOCK
->
cm_de°age_cou¡
 +
W_CLOCK
->cm_destage_count);

3678 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Ród Time = %f\n", 
SSD_READ_TIME
);

3679 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD WrôêTime = %f\n", 
SSD_WRITE_TIME
);

3680 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêTime = %f\n", 
STAGE_TIME
);

3681 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêTimêSSD WRITE = %f\n", 
STAGE_SSD_WRITE
);

3682 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêTimêHDD_READ = %f\n", 
STAGE_HDD_READ
);

3683 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêTime = %f\n", 
DESTAGE_TIME
);

3684 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêTimêSSD READ = %f\n", 
DESTAGE_SSD_READ
);

3685 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêTimêHDD WRITE = %f\n", 
DESTAGE_HDD_WRITE
);

3688 
	`Ârötf
(
ouçutfûe
, " Syssim : Utûiz©i⁄ = %f\n", ()(
R_CLOCK
->
cm_cou¡
+
W_CLOCK
->cm_cou¡)/
SSD_MAX_PAGES
);

3689 
	`Ârötf
(
ouçutfûe
, " Syssim : Ród P¨tôi⁄ R©iÿ%f\n", 
R_VALUE
);

3690 
	`Ârötf
(
ouçutfûe
, " Syssim : Disk Ród = %.3f\n", 
HDD_TOTALCOST_R
/
HDD_COUNT_R
);

3691 
	`Ârötf
(
ouçutfûe
, " Syssim : Disk Wrôe = %.3f\n", 
HDD_TOTALCOST_W
/
HDD_COUNT_W
);

3692 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Ród = %.3f\n", 
SSD_TOTALCOST_R
/
SSD_COUNT_R
);

3693 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Wrôe = %.3f\n", 
SSD_TOTALCOST_W
/
SSD_COUNT_W
);

3694 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Ród (Pªdi˘edË= %.3f\n", 
SSD_TOTALCOST_PREDICT_R
/
SSD_COUNT_PREDICT_R
);

3695 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Wrôê(Pªdi˘ed)= %.3f\n", 
SSD_TOTALCOST_PREDICT_W
/
SSD_COUNT_PREDICT_W
);

3697 
	`Ârötf
(
ouçutfûe
, " Syssim : Ród Req R©io = %f\n", ()
rc_ªad
/
rc_tŸÆ
);

3698 
	`Ârötf
(
ouçutfûe
, " Syssim : WrôêReq R©io = %f\n", ()
rc_wrôe
/
rc_tŸÆ
);

3700 
	`Ârötf
(
ouçutfûe
, " Syssim : I/OÑ©ê£rvi˚d i¿Ród S∑˚ = %f\n", 
RS_SERVICE_RATE
);

3701 
	`Ârötf
(
ouçutfûe
, " Syssim : I/OÑ©ê£rvi˚d i¿WrôêS∑˚ = %f\n", 
WS_SERVICE_RATE
);

3704 
	`Ârötf
(
ouçutfûe
, " Syssim : Seq dëe˘ed cou¡ = %d\n", 
£q_dëe˘ed_cou¡
);

3705 
	`Ârötf
(
ouçutfûe
, " Syssim : Seq dëe˘ed cou¡2 = %d\n", 
£q_dëe˘ed_cou¡2
);

3706 
	`Ârötf
(
ouçutfûe
, " Syssim: TŸÆ Reque° Cou¡ = %d (%.3fMB)\n", 
rc_tŸÆ
, ()rc_total/256);

3707 
	`Ârötf
(
ouçutfûe
, " Syssim: TŸÆ Reque° Cou¡‘ód) = %d (%.3fMB)\n", 
rc_ªad
, ()rc_read/256);

3708 
	`Ârötf
(
ouçutfûe
, " Syssim: TŸÆ Reque° Cou¡(wrôe) = %d (%.3fMB)\n", 
rc_wrôe
, ()rc_write/256);

3709 
	`Ârötf
(
ouçutfûe
, " Syssim: TŸÆ Reque° Cou¡‘ód i¿wrôñru) = %d (%.3fMBË%f\n", 
rc_ªad_ö_wrôe
, (Ïc_ªad_ö_wrôe/256, (Ïc_ªad_ö_wrôe/
rc_ªad
);

3710 
	`Ârötf
(
ouçutfûe
, " Syssim: TŸÆ Reque° Cou¡(wrôêöÑódÃu) = %d (%.3fMBË%f\n", 
rc_wrôe_ö_ªad
, (Ïc_wrôe_ö_ªad/256, (Ïc_wrôe_ö_ªad/
rc_wrôe
);

3711 
	`Ârötf
(
ouçutfûe
, " Syssim: *Idó»utûiz©i⁄ = %.2f\n", ()
S_TOTAL
/
SSD_MAX_PAGES
);

3717 
W_CLOCK
->
cm_ssdwq
 = 
ãmp
[0];

3718 
W_CLOCK
->
cm_ssdrq

ãmp
[1];

3719 
W_CLOCK
->
cm_hddwq
 = 
ãmp
[2];

3720 
W_CLOCK
->
cm_hddrq
 = 
ãmp
[3];

3723 
	`mÃu_exô
(
W_HIT_TRACKER
, 
HIT_TRACKER_NUM
);

3724 
	`mÃu_exô
(
R_HIT_TRACKER
, 
HIT_TRACKER_NUM
);

3727 
	`¥öt_dúty_øã
(
W_CLOCK
, 
R_CLOCK
->
cm_cou¡
, W_CLOCK->cm_cou¡, 
ouçutfûe
);

3728 
	`¥öt_dúty_øã
(
W_CLOCK
, 
R_CLOCK
->
cm_cou¡
, W_CLOCK->cm_cou¡, 
°dout
);

3730 
	`Ârötf
(
ouçutfûe
, "\n Read Tracked Hit Ratio Curve ... \n");

3731 
	`¥öt_hô_øtio_curve
(
R_HIT_TRACKER
, R_HIT_TRACKER[0]->
cm_ªf
, 
HIT_TRACKER_NUM
, 
ouçutfûe
);

3732 
	`Ârötf
(
ouçutfûe
, "\n Write Tracked Hit Ratio Curve ... \n");

3733 
	`¥öt_hô_øtio_curve
(
W_HIT_TRACKER
, W_HIT_TRACKER[0]->
cm_ªf
, 
HIT_TRACKER_NUM
, 
ouçutfûe
);

3735 
	`CACHE_CLOSE
(
R_CLOCK
);

3736 
	`CACHE_CLOSE
(
W_CLOCK
);

3737 
	`CACHE_CLOSE
(
døm_ˇche
);

3738 
	`CACHE_CLOSE
(
£q_dëe˘‹
);

3739 
	`ªvî£_m≠_‰ì
();

3740 
	`f˛o£
(
åa˚fûe
);

3747 
	`wow_simuœti⁄
(*
fûíame
,
åackî_num
, 
ˇche_size
,
HDD_MAX
, 
SSD_MAX
){

3748 
li°node
 *
node
;

3749 
˛ock_node
 *
˙
;

3750 
FILE
 *
åa˚fûe

NULL
;

3751 
i‹eq_evít
 
ªq
;

3752 
i
;

3753 
™ti_tŸÆ_co°
 = 0.0;

3756 
	`¥ötf
(" Start WOW Simulation ... \n");

3757 
	`fÊush
(
°dout
);

3759 
SSD_MAX_PAGES
 = 
SSD_MAX
;

3760 
HDD_MAX_PAGES
 = 
HDD_MAX
;

3762 
S_TOTAL
 = 
ˇche_size
;

3764 
	`bg˛ock_öô
(&
W_CLOCK
,"W_CLOCK", 
S_TOTAL
-1, 
SSD_MAX_PAGES
-1, 1024, 0);

3765 
W_CLOCK
->
cm_pﬁicy
 =
CACHE_BGCLOCK_RW
;

3767 
	`ªvî£_m≠_¸óã
(
ˇche_size
);

3769 #ifde‡
__löux__


3770 
åa˚fûe
 = 
	`f›í64
(
fûíame
, "r");

3772 
åa˚fûe
 = 
	`f›í
(
fûíame
, "r");

3774 if(
åa˚fûe
 =
NULL
){

3775 
	`Ârötf
(
°dîr
," C™nŸ o≥¿fûê%s\n", 
fûíame
);

3776 
	`Ârötf
(
ouçutfûe
," C™nŸ o≥¿fûê%s\n", 
fûíame
);

3777 
	`exô
(1);

3781 
i
 = 0;;i++){

3782 
blkno
;

3783 
num
, 
j
;

3784 
ªs
;

3785 
£q_io
;

3786 if(
	`iŸø˚_ascii_gë_i‹eq_evít
(
åa˚fûe
, &
ªq
Ë=
NULL
){

3790 
blkno
 = (
ªq
.blkno/
BLOCK2SECTOR
)%
HDD_MAX_PAGES
;

3791 
num
 = 
ªq
.
bcou¡
/
BLOCK2SECTOR
;

3792 if(
ªq
.
bcou¡
%
BLOCK2SECTOR
)

3793 
num
++;

3795 if(
num
 >
SEQ_COUNT
)

3796 
£q_io
 = 1;

3797 
j
 = 0;j < 
num
;j++){

3798 
rc_tŸÆ
++;

3800 
	`gí_ªq_wôh_bg˛ock
(
W_CLOCK
, &
ªq
, 
blkno
 + 
j
,0, 
£q_io
);

3803 if(
W_CLOCK
->
cm_cou¡
 !
ªvî£_u£d
){

3804 
	`Ârötf
(
°dîr
, " countÉrror \n");

3807 if(
ªq
.
Êags
 =
READ
){

3809 
	`Ãu_°age
(
W_CLOCK
);

3812 
	`Ãu_ssd_ªad
(
W_CLOCK
, 
SSD
, 
READ
, W_CLOCK->
cm_ssdrq
, 0);

3815 
	`Ãu_de°age
(
W_CLOCK
);

3818 
	`Ãu_ssd_wrôe
(
W_CLOCK
, 
SSD
, 
WRITE
, W_CLOCK->
cm_ssdwq
, 0);

3823 
	`Ârötf
(
ouçutfûe
, " Syssim : Executi⁄ Timê= %f\n", 
now
);

3824 
	`Ârötf
(
ouçutfûe
, " Syssim : Hô R©iÿ= %f\n", 
	`CACHE_HIT
(
W_CLOCK
));

3825 
	`Ârötf
(
ouçutfûe
, " Syssim : SègêCou¡ = %d\n", 
W_CLOCK
->
cm_°age_cou¡
);

3826 
	`Ârötf
(
ouçutfûe
, " Syssim : De°agêCou¡ = %d\n", 
W_CLOCK
->
cm_de°age_cou¡
);

3827 
	`Ârötf
(
ouçutfûe
, " Syssim : Disk Ród = %.3f\n", 
HDD_TOTALCOST_R
/
HDD_COUNT_R
);

3828 
	`Ârötf
(
ouçutfûe
, " Syssim : Disk Wrôe = %.3f\n", 
HDD_TOTALCOST_W
/
HDD_COUNT_W
);

3829 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Ród = %.3f\n", 
SSD_TOTALCOST_R
/
SSD_COUNT_R
);

3830 
	`Ârötf
(
ouçutfûe
, " Syssim : SSD Wrôe = %.3f\n", 
SSD_TOTALCOST_W
/
SSD_COUNT_W
);

3832 
	`CACHE_CLOSE
(
W_CLOCK
);

3833 
	`ªvî£_m≠_‰ì
();

3834 
	`f˛o£
(
åa˚fûe
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_seq_detect.c

1 
	~<°dio.h
>

2 
	~"ˇche.h
"

3 
	~"ssd_utûs.h
"

4 
	~"wow_drivî.h
"

7 
SEQ_COUNT
;

10 
£q_dëe˘_evi˘_blocks
(
ˇche_m™agî
 *
c
, 
£q_node
 *
bn
);

13 
	$£q_dëe˘_›í
(
ˇche_m™agî
 *
c
,
ˇche_size
, 
ˇche_max
){

14 
i
;

16 
	`Œ_¸óã
(&(
c
->
cm_hód
));

18 
c
->
cm_hash
 = (
li°node
 **)
	`mÆloc
(÷i°nodê*Ë* 
HASH_NUM
);

19 if(
c
->
cm_hash
 =
NULL
){

20 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

21 
	`exô
(1);

23 
i
 = 0;ò< 
HASH_NUM
;i++){

24 
	`Œ_¸óã
(&
c
->
cm_hash
[
i
]);

27 
	`Œ_¸óã
(&
c
->
cm_hddrq
);

28 
	`Œ_¸óã
(&
c
->
cm_hddwq
);

29 
	`Œ_¸óã
(&
c
->
cm_ssdrq
);

30 
	`Œ_¸óã
(&
c
->
cm_ssdwq
);

33 
c
->
cm_de°age_±r
 = c->
cm_hód
;

34 
c
->
cm_ªf
 = 0;

35 
c
->
cm_hô
 = 0;

36 
c
->
cm_miss
 = 0;

37 
c
->
cm_size
 = 
ˇche_size
;

38 
c
->
cm_‰ì
 = 
ˇche_size
;

39 
c
->
cm_cou¡
 = 0;

40 
c
->
cm_max
 = 
ˇche_max
;

42 
	}
}

44 
	$£q_dëe˘_˛o£
(
ˇche_m™agî
 *
c
){

45 
li°node
 *
node
 = 
c
->
cm_hód
->
√xt
;

46 
£q_node
 *
bn
;

47 
i
;

51 
node
 !
c
->
cm_hód
 &&Çode){

52 
bn
 = (
£q_node
 *)
node
->
d©a
;

54 
	`£q_dëe˘_evi˘_blocks
(
c
, (
£q_node
 *)
bn
);

56 
	`‰ì
(
bn
);

59 
c
->
cm_groupcou¡
--;

60 
node
 =Çode->
√xt
;

62 if(
c
->
cm_groupcou¡
 != 0){

63 
	`Ârötf
(
°dîr
, " check ... \n");

65 
	`Œ_ªÀa£
(
c
->
cm_hód
);

67 
i
 = 0;ò< 
HASH_NUM
;i++){

68 
	`Œ_ªÀa£
(
c
->
cm_hash
[
i
]);

71 
	}
}

73 
	$com∑ª_hdd
(c⁄° *
a
,c⁄° *
b
){

74 if(((
Ãu_node
 *)
a
)->
˙_blkno
 > ((Ãu_nodê*)
b
)->cn_blkno)

76 if(((
Ãu_node
 *)
a
)->
˙_blkno
 < ((Ãu_nodê*)
b
)->cn_blkno)

79 
	}
}

81 
	$com∑ª_hdd2
(c⁄° *
a
,c⁄° *
b
){

82 if(((
Ãu_node
 *)
a
)->
˙_blkno
 =()
b
)

86 
	}
}

89 
	$£q_dëe˘_com∑ª_gno
(c⁄° *
a
,c⁄° *
b
){

90 if(()(((
£q_node
 *)
a
)->
sq_no
Ë=()
b
)

93 
	}
}

98 
li°node
 *
	$£q_dëe˘_¥e£¨ch
(
ˇche_m™agî
 *
c
, 
blkno
){

99 
£q_node
 *
bn
 = 
NULL
;

100 
Ãu_node
 *
 
 = 
NULL
;

101 
li°node
 *
gnode
, *
node
;

102 
grou≤o
 = 
blkno
/
SEQ_COUNT
;

103 
group_Æloc
 = 0, 
node_Æloc
 = 0;

107 
gnode
 = 
	`CACHE_SEARCH
(
c
, 
blkno
);

108 if(
gnode
){

109 
bn
 = (
£q_node
 *)
gnode
->
d©a
;

115 
node
 = 
	`Œ_föd_node
(
bn
->
sq_block_hash
[
blkno
%
BG_HASH_NUM
], (*)blkno, 
com∑ª_hdd2
);

116 if(
node
){

119 
node_Æloc
 = 0;

120 
group_Æloc
 = 0;

122 
 
 = (
Ãu_node
 *)
node
->
d©a
;

123  (
li°node
 *)
 
;

126 
node_Æloc
 = 1;

130 
group_Æloc
 = 1;

131 
node_Æloc
 = 1;

134  
NULL
;

135 
	}
}

137 
li°node
 *
	$£q_dëe˘_£¨ch
(
ˇche_m™agî
 *
c
, 
blkno
){

138 
li°node
 *
gnode
;

139 
li°node
 *
hód
;

140 
grou≤o
 = 
blkno
/
SEQ_COUNT
;

142 
hód
 = 
c
->
cm_hash
[
grou≤o
%
HASH_NUM
];

143 
gnode
 = 
	`Œ_föd_node
(
hód
,(*)
grou≤o
, 
£q_dëe˘_com∑ª_gno
);

144 if(
gnode
){

145  
gnode
;

148  
NULL
;

149 
	}
}

153 *
	$£q_dëe˘_ªmove
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªmove_±r
){

154 
£q_node
 *
bn
;

155 
li°node
 *
vi˘im
;

157 
bn
 = (
£q_node
 *)
ªmove_±r
->
d©a
;

160 
	`Œ_ªÀa£_node
(
c
->
cm_hód
, 
bn
->
sq_node
);

163 
	`Œ_ªÀa£_node
(
c
->
cm_hash
[
bn
->
sq_no
%
HASH_NUM
], bn->
sq_hash
);

170 
c
->
cm_groupcou¡
--;

172 
bn
->
sq_node
 = 
NULL
;

173 
bn
->
sq_hash
 = 
NULL
;

175  (*)
bn
;

177 
	}
}

180 *
	$£q_dëe˘_Æloc
(
£q_node
 *
bn
, 
grou≤o
){

181 
i
;

183 if(
bn
 =
NULL
){

184 
bn
 = (
£q_node
 *)
	`mÆloc
((seq_node));

185 if(
bn
 =
NULL
){

186 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

187 
	`exô
(1);

189 
	`mem£t
(
bn
, 0x00, (
£q_node
));

192 
bn
->
sq_no
 = 
grou≤o
;

195 
	`Œ_¸óã
(&
bn
->
sq_block_li°
);

197 
i
 = 0;ò<
BG_HASH_NUM
;i++){

198 
	`Œ_¸óã
(&
bn
->
sq_block_hash
[
i
]);

201  
bn
;

202 
	}
}

206 
Ãu_node
 *
	$£q_dëe˘_ö£π_block_to_group
(
ˇche_m™agî
 *
c
, 
£q_node
 *
bn
,
blk
, 
Ãu_node
 *
 
){

209 if(
 
 =
NULL
){

210 
 
 = (
Ãu_node
 *)
	`Ãu_Æloc
(
NULL
, 
blk
);

214 
 
->
˙_node
 = 
	`Œ_ö£π_©_s‹t
(
bn
->
sq_block_li°
,Ün, 
com∑ª_hdd
);

215 
bn
->
sq_block_cou¡
++;

216 
 
->
˙_hash
 = 
	`Œ_ö£π_©_èû
(
bn
->
sq_block_hash
[
blk
%
BG_HASH_NUM
],Ün);

218 
c
->
cm_‰ì
--;

219 
c
->
cm_cou¡
++;

221  
 
;

222 
	}
}

224 
	$£q_dëe˘_ö£π
(
ˇche_m™agî
 *
c
,
£q_node
 *
bn
){

227 
bn
->
sq_node
 = (
li°node
 *)
	`Œ_ö£π_©_√xt
(
c
->
cm_hód
, c->
cm_de°age_±r
,(*)bn);

229 
c
->
cm_groupcou¡
++;

232 
bn
->
sq_hash
 = (
li°node
 *)
	`Œ_ö£π_©_hód
(
c
->
cm_hash
[(bn->
sq_no
)%
HASH_NUM
],(*)bn);

234 
	}
}

238 
	$£q_dëe˘_evi˘_blocks
(
ˇche_m™agî
 *
c
, 
£q_node
 *
bn
){

239 
Ãu_node
 *
 
;

240 
li°node
 *
node
;

241 
i
;

243 
node
 = 
bn
->
sq_block_li°
->
¥ev
;

245 
bn
->
sq_block_cou¡
){

246 
 
 = (
Ãu_node
 *)
node
->
d©a
;

248 if(
 
->
˙_dúty
){

251 
c
->
cm_de°age_cou¡
++;

255 
	`‰ì
(
 
);

257 
bn
->
sq_block_cou¡
--;

258 
c
->
cm_‰ì
++;

259 
c
->
cm_cou¡
--;

260 
	`NODE_PREV
(
node
);

264 
	`Œ_ªÀa£
(
bn
->
sq_block_li°
);

266 
i
 = 0;ò< 
BG_HASH_NUM
;i++){

267 
	`Œ_ªÀa£
(
bn
->
sq_block_hash
[
i
]);

270 
	}
}

272 
	$£q_dëe˘_make_£q_ªq
(
ˇche_m™agî
 *
c
, ˇche_m™agî *
r_˛ock
, ˇche_m™agî *
w_˛ock
, 
£q_node
 *
bn
){

273 
Ãu_node
 *
 
;

274 
Ãu_node
 *
rm_node
;

275 
li°node
 *
node
;

276 
li°node
 *
Ãu_li°
;

277 
i
;

279 
node
 = 
bn
->
sq_block_li°
->
¥ev
;

280 if(
bn
->
sq_dúty_cou¡
!0 && bn->sq_dúty_cou¡ !
SEQ_COUNT
)

281 
bn
 = bn;

282 
bn
->
sq_block_cou¡
){

283 
blkno
;

284 
 
 = (
Ãu_node
 *)
node
->
d©a
;

286 
blkno
 = 
 
->
˙_blkno
;

289 if(!
bn
->
sq_dúty_cou¡
){

292 
Ãu_li°
 = 
	`CACHE_PRESEARCH
(
r_˛ock
, 
blkno
);

293 if(
Ãu_li°
){

294 
rm_node
 = 
	`CACHE_REMOVE
(
r_˛ock
, 
Ãu_li°
);

295 
	`ªvî£_m≠_ªÀa£_blk
(
rm_node
->
˙_ssd_blk
);

296 
	`ssd_åim_comm™d
(
SSD
, 
rm_node
->
˙_ssd_blk
 * 
BLOCK2SECTOR
);

297 
	`‰ì
(
rm_node
);

299 
	`CACHE_MAKERQ
(
r_˛ock
,Ñ_˛ock->
cm_hddrq
, 
NULL
, 
blkno
);

304 
Ãu_li°
 = 
	`CACHE_PRESEARCH
(
w_˛ock
, 
blkno
);

305 if(
Ãu_li°
){

307 
rm_node
 = 
	`CACHE_REMOVE
(
w_˛ock
, 
Ãu_li°
);

309 
	`CACHE_MAKERQ
(
w_˛ock
, w_˛ock->
cm_ssdrq
, 
NULL
, 
rm_node
->
˙_ssd_blk
);

310 
	`CACHE_MAKERQ
(
w_˛ock
, w_˛ock->
cm_hddwq
, 
NULL
, 
	`ªvî£_gë_blk
(
rm_node
->
˙_ssd_blk
));

312 
	`ªvî£_m≠_ªÀa£_blk
(
rm_node
->
˙_ssd_blk
);

313 
	`‰ì
(
rm_node
);

316 
	`CACHE_MAKERQ
(
w_˛ock
, w_˛ock->
cm_hddwq
, 
NULL
, 
blkno
);

322 
	`‰ì
(
 
);

324 
bn
->
sq_block_cou¡
--;

325 
c
->
cm_‰ì
++;

326 
c
->
cm_cou¡
--;

327 
	`NODE_PREV
(
node
);

333 
	`Œ_ªÀa£
(
bn
->
sq_block_li°
);

335 
i
 = 0;ò< 
BG_HASH_NUM
;i++){

336 
	`Œ_ªÀa£
(
bn
->
sq_block_hash
[
i
]);

339 
	}
}

343 
li°node
 *
	$£q_dëe˘_ª∂a˚
(
ˇche_m™agî
 *
c
, 
w©îm¨k
){

344 
li°node
 *
de°age_±r
;

345 
li°node
 *
ªmove_±r
;

346 
£q_node
 *
vi˘im
 = 
NULL
;

348 if(
c
->
cm_‰ì
 < 
w©îm¨k
 + 1){

349 
ªmove_±r
 = 
c
->
cm_hód
->
¥ev
;

350 
c
->
cm_de°age_±r
 = c->
cm_hód
;

351 
vi˘im
 = 
	`CACHE_REMOVE
(
c
, 
ªmove_±r
);

352 
	`£q_dëe˘_evi˘_blocks
(
c
, (
£q_node
 *)
vi˘im
);

354 
	`‰ì
(
vi˘im
);

355 
vi˘im
 = 
NULL
;

358  (
li°node
 *)
vi˘im
;

359 
	}
}

362 
	$£q_dëe˘_öc
(
ˇche_m™agî
 *
c
, 
öc_vÆ
){

364 if((
c
->
cm_size
+
öc_vÆ
Ë< (c->
cm_max
)){

365 
c
->
cm_size
+=
öc_vÆ
;

366 
c
->
cm_‰ì
+=
öc_vÆ
;

367  
öc_vÆ
;

371 
	}
}

373 
	$£q_dëe˘_dec
(
ˇche_m™agî
 *
c
, 
dec_vÆ
){

374 if((
c
->
cm_size
-
dec_vÆ
) > 0){

375 
c
->
cm_size
-=
dec_vÆ
;

376 
c
->
cm_‰ì
-=
dec_vÆ
;

377  
dec_vÆ
;

384 
	}
}

385 
	$£q_dëe˘_make_ªqli°
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªq_li°
, 
Rb_node
 *
rbåì
, 
blk
){

386 
	`Œ_ö£π_©_èû
(
ªq_li°
, (*)
blk
);

387 
	}
}

388 
	$£q_dëe˘_ªÀa£_ªqli°
(
ˇche_m™agî
 *
c
, 
li°node
 *
ªq_li°
){

390 
	`Œ_gë_size
(
ªq_li°
)){

391 
	`Œ_ªÀa£_èû
(
ªq_li°
);

393 
	}
}

396 
	$£q_dëe˘_öô
(
ˇche_m™agî
 **
c
,*
«me
, 
size
,
max_sz
, 
high
, 
low
){

397 *
c
 = (
ˇche_m™agî
 *)
	`mÆloc
((cache_manager));

398 if(*
c
 =
NULL
){

399 
	`Ârötf
(
°dîr
, " MÆlo¯Eº‹ %†%d \n",
__FUNCTION__
,
__LINE__
);

400 
	`exô
(1);

402 
	`mem£t
(*
c
, 0x00, (
ˇche_m™agî
));

404 (*
c
)->
ˇche_›í
 = 
£q_dëe˘_›í
;

405 (*
c
)->
ˇche_˛o£
 = 
£q_dëe˘_˛o£
;

406 (*
c
)->
ˇche_¥e£¨ch
 = 
£q_dëe˘_¥e£¨ch
;

407 (*
c
)->
ˇche_£¨ch
 = 
£q_dëe˘_£¨ch
;

408 (*
c
)->
ˇche_ª∂a˚
 = 
£q_dëe˘_ª∂a˚
;

409 (*
c
)->
ˇche_ªmove
 = 
£q_dëe˘_ªmove
;

410 (*
c
)->
ˇche_ö£π
 = 
£q_dëe˘_ö£π
;

411 (*
c
)->
ˇche_öc
 = 
£q_dëe˘_öc
;

412 (*
c
)->
ˇche_dec
 = 
£q_dëe˘_dec
;

413 (*
c
)->
ˇche_Æloc
 = 
£q_dëe˘_Æloc
;

414 (*
c
)->
ˇche_makîq
 = 
£q_dëe˘_make_ªqli°
;

415 (*
c
)->
ˇche_ªÀa£rq
 = 
£q_dëe˘_ªÀa£_ªqli°
;

417 
	`CACHE_OPEN
((*
c
), 
size
, 
max_sz
);

419 (*
c
)->
cm_«me
 = (*)
	`mÆloc
(
	`°æí
(
«me
)+1);

420 
	`°r˝y
((*
c
)->
cm_«me
, 
«me
);

423 (*
c
)->
cm_highw©î
 = 
high
;

424 (*
c
)->
cm_loww©î
 = 
low
;

425 
	}
}

429 
	$£q_dëe˘_make_ªq
(
ˇche_m™agî
 *
c
, ˇche_m™agî *
r_˛ock
, ˇche_m™agî *
w_˛ock
, 
blkno
, 
is_ªad
, 
ªq_time
){

430 
£q_node
 *
bn
 = 
NULL
;

431 
Ãu_node
 *
 
 = 
NULL
;

432 
li°node
 *
gnode
, *
node
;

433 
grou≤o
 = 
blkno
/
SEQ_COUNT
;

434 
group_Æloc
 = 0, 
node_Æloc
 = 0;

436 
c
->
cm_ªf
++;

438 
gnode
 = 
	`CACHE_SEARCH
(
c
, 
blkno
);

439 if(
gnode
){

440 
bn
 = (
£q_node
 *)
gnode
->
d©a
;

442 
bn
->
sq_ªf
++;

444 
bn
 = 
	`CACHE_REMOVE
(
c
, 
gnode
);

445 
	`CACHE_INSERT
(
c
, 
bn
);

447 
node
 = 
	`Œ_föd_node
(
bn
->
sq_block_hash
[
blkno
%
BG_HASH_NUM
], (*)blkno, 
com∑ª_hdd2
);

448 if(
node
){

450 
c
->
cm_hô
++;

451 
node_Æloc
 = 0;

452 
group_Æloc
 = 0;

454 
bn
->
sq_hô
++;

456 
 
 = (
Ãu_node
 *)
node
->
d©a
;

457 if(!
is_ªad
){

458 if(!
 
->
˙_dúty
){

459 
bn
->
sq_dúty_cou¡
++;

460 
 
->
˙_dúty
 = 1;

467 
node_Æloc
 = 1;

471 
group_Æloc
 = 1;

472 
node_Æloc
 = 1;

475 if(
node_Æloc
){

476 if(
c
->
cm_‰ì
 <c->
cm_loww©î
){

477 
c
->
cm_‰ì
 < c->
cm_highw©î
){

478 
	`CACHE_REPLACE
(
c
, c->
cm_highw©î
);

482 if(
group_Æloc
){

484 
bn
 = 
	`CACHE_ALLOC
(
c
, 
NULL
, 
grou≤o
);

485 
bn
->
sq_ªf
++;

486 
bn
->
sq_°¨t_time
 = 
ªq_time
;

487 
	`CACHE_INSERT
(
c
, 
bn
);

489 
 
 = 
	`£q_dëe˘_ö£π_block_to_group
(
c
, 
bn
, 
blkno
, 
NULL
);

490 if(!
is_ªad
){

491 
 
->
˙_dúty
 = 1;

492 
bn
->
sq_dúty_cou¡
++;

494 if(
bn
->
sq_block_cou¡
 =
SEQ_COUNT
 && (bn->
sq_dúty_cou¡
 == SEQ_COUNT || bn->sq_dirty_count == 0)){

498 if((
 
->
˙_blkno
+1Ë% (
SEQ_COUNT
) != 0)

512 #i‚de‡
__löux


513 
	`¥ötf
(" Sequítü»Dëe˘ed block(%.3fËhôÑ©iÿ%d, hô %d,Ñe‡%d, max = %d\n", 
ªq_time
 - 
bn
->
sq_°¨t_time
, bn->
sq_hô
*100/bn->
sq_ªf
, bn->sq_hô, bn->sq_ªf, 
SEQ_COUNT
);

516 if(
is_ªad
){

518 
	`Ãu_°age
(
r_˛ock
);

521 
	`Ãu_ssd_ªad
(
r_˛ock
, 
SSD
, 
READ
,Ñ_˛ock->
cm_ssdrq
, 0);

524 
	`Ãu_de°age
(
w_˛ock
);

527 
	`Ãu_ssd_wrôe
(
w_˛ock
, 
SSD
, 
WRITE
, w_˛ock->
cm_ssdwq
, 0);

532 
bn
 = 
	`CACHE_REMOVE
(
c
, bn->
sq_node
);

534 if(
ªq_time
 - 
bn
->
sq_°¨t_time
 < 5000)

535 
ªq_time
 =Ñeq_time;

540 
	`£q_dëe˘_make_£q_ªq
(
c
, 
r_˛ock
, 
w_˛ock
, (
£q_node
 *)
bn
);

541 
	`‰ì
(
bn
);

549 
	}
}

550 
	$£q_dëe˘_maö
(){

551 
ˇche_m™agî
 *
£q_dëe˘‹
;

552 
blkno
 = 
	`RND
(700000);

553 
i
;

556 
	`£q_dëe˘_öô
(&
£q_dëe˘‹
,"SEQ_DETECTOR", 50000, 50000, 1024, 0);

558 
i
 =0;i < 1000000;i++){

559 
blkno
 = 
	`RND
(700000);

564 
	`CACHE_CLOSE
(
£q_dëe˘‹
);

567 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_wow_driver.c

44 
	~<°dio.h
>

45 
	~<°dlib.h
>

46 
	~<sys/ty≥s.h
>

47 
	~<sys/°©.h
>

48 
	~<m©h.h
>

49 
	~<˘y≥.h
>

51 
	~"ssd.h
"

52 
	~"ssd_˛ón.h
"

53 
	~"ªd_bœck_åì.h
"

54 
	~"disksim_öãrÁ˚.h
"

55 
	~"disksim_ønd48.h
"

56 
	~"disksim_globÆ.h
"

57 
	~"disksim_iŸø˚.h
"

58 
	~"disksim_h±ø˚.h
"

59 
	~"disksim_öãrÁ˚_¥iv©e.h
"

60 
	~"ssd_utûs.h
"

61 
	~"wow_drivî.h
"

62 
	~"ˇche.h
"

64 
disksim_öãrÁ˚
 *
	gdisksim_öf
;

65 
SysTime
 
	gnow
 = 0;

66 
SysTime
 
	gRólTime
 = 0.0;

67 
SysTime
 
	g√xt_evít
 = -1;

68 
	gcom∂ëed
 = 0;

69 
Sèt
 
	g°
;

72 
	gg_De°agePå
 = 0;

78 
li°node
 *
	gªq_SSD_WQli°
;

79 
li°node
 *
	gªq_SSD_RQli°
;

80 
li°node
 *
	gªq_HDD_WQli°
;

81 
li°node
 *
	gªq_HDD_RQli°
;

84 
	govî¥ovisi⁄_øã
 = 0.80;

85 
	gPages_Pî_Group
 = 1024;

86 
	gWow_HDD_Max_Pages
;

87 
	gWow_SSD_Max_Pages
;

88 
	gWow_HDD_Num_Groups
;

89 
	gWow_Fªe_Fœsh_Cou¡
;

90 
	gWow_Occu∑ncy_Êash_cou¡
;

91 
	gWow_High_W©î
 = 0;

92 
	gWow_Low_W©î
 = 0;

94 
	gWow_Max_High_W©î
 = 0;

96 
	gWow_U£_NARP
 = 0;

98 
	gwow_hô
 = 0;

99 
	gwow_ªf
 = 0;

100 
	gwow_de°age_cou¡
 = 0;

101 
	gwow_°age_cou¡
 = 0;

102 
	gwow_ªad_hô
 = 1;

103 
	gwow_ªad_ªf
 = 1;

104 
	gwow_wrôe_hô
 = 0;

105 
	gwow_wrôe_ªf
 = 0;

112 
	gWow_WSS_Re‰esh_Pîiod
 = 0;

116 *
	gws_bôm≠_globÆ
 = 
NULL
;

117 *
	gws_bôm≠_globÆ_rd
 = 
NULL
;

118 *
	gws_bôm≠_globÆ_wr
 = 
NULL
;

119 
	gws_cou¡_globÆ
 = 0;

120 
	gws_cou¡_globÆ_rd
 = 0;

121 
	gws_cou¡_globÆ_wr
 = 0;

123 *
	gws_bôm≠_loˇl
 = 
NULL
;

124 *
	gws_bôm≠_loˇl_rd
 = 
NULL
;

125 *
	gws_bôm≠_loˇl_wr
 = 
NULL
;

126 
	gws_cou¡_loˇl
 = 0;

127 
	gws_cou¡_loˇl_rd
 = 0;

128 
	gws_cou¡_loˇl_wr
 =0;

142 
ssd_t
 *
	gcuºssd
;

145 
FILE
 *
	gª•⁄£_Â
;

146 
	gª•⁄£_cou¡
 = 0;

147 
	gª•⁄£_°r
[256];

150 
	$wow_‰eq_curve_öô
(*
p
,
size
){

151 
	`mem£t
(
p
, 0x00, (Ë* 
size
);

152 
	}
}

153 
	$wow_‰eq_curve_Æloc
(**
p
, 
size
){

155 *
p
 = (*)
	`mÆloc
((Ë* 
size
);

156 if(*
p
 =
NULL
){

157 
	`Ârötf
(
°dîr
, "Error: mallocÅo ws hit curve\n");

158 
	`exô
(1);

162 
	`wow_‰eq_curve_öô
(*
p
, 
size
);

163 
	`¥ötf
(" Fªquícy CurvêAŒo¯%.‡Kbyãs\n", ()()*
size
/1024);

166 
	}
}

171 
	$wow_ws_Æloc
(**
bôm≠
, 
size
){

172 
byãs_to_Æloc
;

174 
byãs_to_Æloc
 = 
size
 / (() * 8);

175 i‡(!(*
bôm≠
 = (*)
	`mÆloc
(
byãs_to_Æloc
))) {

176 
	`Ârötf
(
°dîr
, "Error: mallocÅo free_blocks in ssd_element_metadata_init failed\n");

177 
	`Ârötf
(
°dîr
, "AŒoˇti⁄ sizê%d\n", 
byãs_to_Æloc
);

178 
	`exô
(1);

180 
	`bzîo
(*
bôm≠
, 
byãs_to_Æloc
);

182 
	`¥ötf
(" TŸÆ WSS = %fGB\n", ()
size
*4096/1024/1024/1024);

183 
	`¥ötf
(" WSS AŒo¯bôm≠ = %.‡Kbyãs\n", ()
byãs_to_Æloc
/1024);

184 
	}
}

186 
	$wow_ws_öô
(*
bôm≠
,*
cou¡
, 
max
){

187 
byãs_to_Æloc
;

189 
byãs_to_Æloc
 = 
max
 / (() * 8);

195 
	`bzîo
(
bôm≠
, 
byãs_to_Æloc
);

198 
i
;

200 
i
 = 0;ò< 
max
;i++){

201 
	`ssd_˛ór_bô
(
bôm≠
, 
i
);

204 *
cou¡
 = 0;

205 
	}
}

208 
group_t
 *
	$wow_Æloc_grou±
(){

209 
group_t
 *
g
;

210 
i
;

212 
g
 = (
group_t
 *)
	`mÆloc
((group_t));

213 if(
g
 =
NULL
){

214 
	`Ârötf
(
°dîr
, " mallocÉrror \n");

215  
NULL
;

218 
	`mem£t
(
g
, 0x00, (
group_t
));

220  
g
;

221 
	}
}

232 
	$wow_‰eq_curve_check
(*
p
, 
blk
){

233 if(
blk
 >
Wow_HDD_Max_Pages
)

234 
blk
 = blk;

235 
p
[
blk
%
Wow_HDD_Max_Pages
]++;

236 
	}
}

241 
	$wow_wss_check
(*
bôm≠
,*
cou¡
, 
blk
){

242 if(!
	`ssd_bô_⁄
(
bôm≠
, 
blk
)){

243 
	`ssd_£t_bô
(
bôm≠
, 
blk
);

244 (*
cou¡
)++;

246 
	}
}

248 
	$wow_wss_‰ì
(*
bôm≠
){

249 if(
bôm≠
)

250 
	`‰ì
(
bôm≠
);

251 
	}
}

254 
	$wow_£t_w©îm¨k
(
high
,
low
){

256 if(
high
 <
Wow_Max_High_W©î
){

257 
Wow_High_W©î
 = 
high
;

258 
Wow_Low_W©î
 = 
low
;

264 
	}
}

265 
	$wow_wss_öô
(
max_size
){

266 
	`wow_ws_Æloc
(&
ws_bôm≠_globÆ
, 
max_size
);

267 
	`wow_ws_öô
(
ws_bôm≠_globÆ
, &
ws_cou¡_globÆ
, 
max_size
);

270 
	`wow_ws_Æloc
(&
ws_bôm≠_globÆ_rd
, 
max_size
);

271 
	`wow_ws_öô
(
ws_bôm≠_globÆ_rd
, &
ws_cou¡_globÆ_rd
, 
max_size
);

274 
	`wow_ws_Æloc
(&
ws_bôm≠_globÆ_wr
, 
max_size
);

275 
	`wow_ws_öô
(
ws_bôm≠_globÆ_wr
, &
ws_cou¡_globÆ_wr
, 
max_size
);

278 
	`wow_ws_Æloc
(&
ws_bôm≠_loˇl
, 
max_size
);

279 
	`wow_ws_öô
(
ws_bôm≠_loˇl
, &
ws_cou¡_loˇl
, 
max_size
);

282 
	`wow_ws_Æloc
(&
ws_bôm≠_loˇl_rd
, 
max_size
);

283 
	`wow_ws_öô
(
ws_bôm≠_loˇl_rd
, &
ws_cou¡_loˇl_rd
, 
max_size
);

286 
	`wow_ws_Æloc
(&
ws_bôm≠_loˇl_wr
, 
max_size
);

287 
	`wow_ws_öô
(
ws_bôm≠_loˇl_wr
, &
ws_cou¡_loˇl_wr
, 
max_size
);

288 
	}
}

290 
	$wow_öô
(
öôül_utû
){

291 
group_t
 *
g
;

292 
i
;

293 
ußbÀ_∑ges
 = 0;

294 
cuºssd
 = 
	`gëssd
 (
SSD
);

310 if(
öôül_utû
 == 0.0){

311 
Wow_SSD_Max_Pages
 = 
	`ssd_ñem_exp‹t_size2
(
cuºssd
);

314 
max_∑ges
 = 
	`ssd_ñem_exp‹t_size2
(
cuºssd
);

315 
	`¥ötf
(" S≥¯SSD sizê%.3fMB\n", ()
max_∑ges
*4/1024);

316 
Wow_SSD_Max_Pages
 = 
	`ssd_gë_numbî_of_blocks
(0)/(
BLOCK2SECTOR
);

317 
Wow_SSD_Max_Pages
 *
öôül_utû
;

319 if(
max_∑ges
 < 
Wow_SSD_Max_Pages
){

320 
Wow_SSD_Max_Pages
 = 
max_∑ges
;

321 
	`¥ötf
(" SSDÖage†(%dËex˚ed†maxÖage†(%d)\n",
Wow_SSD_Max_Pages
, 
max_∑ges
);

322 
	`exô
(0);

325 
Wow_Max_High_W©î
 = 
Wow_SSD_Max_Pages
;

326 
Wow_SSD_Max_Pages
 = 
	`ssd_gë_numbî_of_blocks
(0)/(
BLOCK2SECTOR
);;

328 
	`Ârötf
(
°dout
, " Max CachêSSD sizê%.2fGB, %.2fMB\n", ()
Wow_Max_High_W©î
*4/1024/1024, ()Wow_Max_High_Water*4/1024);

329 
	`Ârötf
(
°dout
, " Physiˇ»SSD sizê%.2fGB, %.2fMB\n", ()
Wow_SSD_Max_Pages
*4/1024/1024, ()Wow_SSD_Max_Pages*4/1024);

332 
Wow_WSS_Re‰esh_Pîiod
 = 
Wow_SSD_Max_Pages
;

334 #ifde‡
DISK


335 
Wow_HDD_Max_Pages
 = 
	`devi˚_gë_numbî_of_blocks
(
DISK
)/
BLOCK2SECTOR
;

337 
Wow_HDD_Max_Pages
 = 
Wow_Num_Page
;

340 
Wow_HDD_Max_Pages
 -(Wow_HDD_Max_Page†% 
Pages_Pî_Group
);

341 
	`Ârötf
(
°dout
," TŸÆ HDD Sizê%.2fGB\n", ()
Wow_HDD_Max_Pages
*4/1024/1024);

367 
g_De°agePå
 = 0;

375 
	`wow_‰eq_curve_Æloc
(&
ws_‰eq_curve_globÆ
, 
Wow_HDD_Max_Pages
);

376 
	`wow_‰eq_curve_Æloc
(&
ws_‰eq_curve_globÆ_rd
, 
Wow_HDD_Max_Pages
);

377 
	`wow_‰eq_curve_Æloc
(&
ws_‰eq_curve_globÆ_wr
, 
Wow_HDD_Max_Pages
);

380 
	`wow_‰eq_curve_Æloc
(&
ws_‰eq_curve_loˇl
, 
Wow_HDD_Max_Pages
);

381 
	`wow_‰eq_curve_Æloc
(&
ws_‰eq_curve_loˇl_rd
, 
Wow_HDD_Max_Pages
);

382 
	`wow_‰eq_curve_Æloc
(&
ws_‰eq_curve_loˇl_wr
, 
Wow_HDD_Max_Pages
);

385 
	`Ârötf
(
ouçutfûe
, "\n\n");

387 
	`fÊush
(
°dout
);

388 
	}
}

391 
	$wow_‰ì
(){

392 
i
;

402 if(!
ws_cou¡_globÆ
)

406 
	`wow_wss_‰ì
(
ws_bôm≠_globÆ
);

407 
	`wow_wss_‰ì
(
ws_bôm≠_globÆ_rd
);

408 
	`wow_wss_‰ì
(
ws_bôm≠_globÆ_wr
);

409 
	`wow_wss_‰ì
(
ws_bôm≠_loˇl
);

410 
	`wow_wss_‰ì
(
ws_bôm≠_loˇl_rd
);

411 
	`wow_wss_‰ì
(
ws_bôm≠_loˇl_wr
);

423 
	}
}

426 
	$Œ_com∑ª_ssd
(c⁄° *
a
,c⁄° *
b
){

427 if(((
∑ge_t
 *)
a
)->
Êash_blkno
 > (’age_à*)
b
)->flash_blkno)

429 if(((
∑ge_t
 *)
a
)->
Êash_blkno
 < (’age_à*)
b
)->flash_blkno)

432 
	}
}

434 
	$Œ_com∑ª_hdd
(c⁄° *
a
,c⁄° *
b
){

435 if(((
∑ge_t
 *)
a
)->
disk_blkno
 > (’age_à*)
b
)->disk_blkno)

437 if(((
∑ge_t
 *)
a
)->
disk_blkno
 < (’age_à*)
b
)->disk_blkno)

440 
	}
}

443 
	$Œ_com∑ª_grou≤o
(c⁄° *
a
,c⁄° *
b
){

444 if(()((
group_t
 *)
a
)->
grou≤o
 > ()((group_à*)
b
)->groupno)

446 if(()((
group_t
 *)
a
)->
grou≤o
 < ()((group_à*)
b
)->groupno)

449 
	}
}

452 
	$Œ_com∑ª_group
(c⁄° *
a
,c⁄° *
b
){

453 if(()((
group_t
 *)
a
)->
grou≤o
 =()
b
)

456 
	}
}

458 
	$Œ_com∑ª_∑ge
(c⁄° *
a
,c⁄° *
b
){

459 if(()((
∑ge_t
 *)
a
)->
disk_blkno
 =()
b
)

462 
	}
}

465 
∑ge_t
 *
	$wow_Æloc_∑ge
(
disk
, 
Êash
){

466 
∑ge_t
 *
pg
;

467 
pg
 = (
∑ge_t
 *)
	`mÆloc
((page_t));

469 
	`mem£t
(
pg
, 0x00, (
∑ge_t
));

470 
pg
->
disk_blkno
 = 
disk
;

471 
pg
->
Êash_blkno
 = 
Êash
;

473  
pg
;

474 
	}
}

479 
	$wow_ªÀa£_Êash∑ge
(
Êash
){

481 
Wow_Occu∑ncy_Êash_cou¡
--;

487 
	`ssd_åim_comm™d
(
SSD
, 
Êash
 * 
BLOCK2SECTOR
);

488 
	}
}

492 
	$wow_de°age_Æl_∑ges
(
group_t
 *
g
){

493 
li°node
 *
ãmp
 = 
g
->
∑ge_li°
->
¥ev
;

494 
∑ge_t
 *
pg
;

495 
cou¡
 = 
g
->
∑gecou¡
;

496 
li°node
 *
Qli°
;

497 
i
;

499 
wow_de°age_cou¡
 +
cou¡
;

501 
	`Œ_¸óã
(&
ªq_HDD_WQli°
);

502 
Qli°
 = 
ªq_HDD_WQli°
;

504 
cou¡
){

505 
pg
 = 
ãmp
->
d©a
;

507 if(
pg
->
dúty
)

508 
	`wow_ö£π_∑ge_to_ªqli°
(
Qli°
, 
pg
, 
Œ_com∑ª_hdd
);

510 
	`NODE_PREV
(
ãmp
);

511 
cou¡
--;

513 if(
g
->
∑gecou¡
){

514 
	`wow_Êush_ªq_Qli°
(
SSD
, 
Qli°
, 
READ
);

515 
	`wow_Êush_ªq_Qli°
(
DISK
, 
Qli°
, 
WRITE
);

518 
ãmp
 = 
g
->
∑ge_li°
->
¥ev
;

519 
g
->
∑gecou¡
){

521 
pg
 = 
ãmp
->
d©a
;

522 
	`wow_ªÀa£_Êash∑ge
(
pg
->
Êash_blkno
);

524 
pg
->
dñëed
 = 1;

525 
	`‰ì
(
pg
);

526 
g
->
∑gecou¡
--;

528 
	`NODE_PREV
(
ãmp
);

531 
	`Œ_ªÀa£
(
g
->
∑ge_li°
);

533 
i
 = 0;ò< 
WOW_HASH_NUM
;i++){

534 
	`Œ_ªÀa£
(
g
->
∑ge_hash
[
i
]);

536 
	`Œ_ªÀa£
(
Qli°
);

539 
	}
}

540 
	$wow_ªÀa£_node_©_q
(
li°node
 *
node
, 
group_t
 *
g
){

541 
li°node
 *
ãmp
;

546 
	}
}

550 
	$wow_de°age_Æog‹ôhm
(){

551 
li°node
 *
node
;

552 
group_t
 *
g
;

591 
	}
}

597 
	$wow_gë_exåa_Êash∑ge
(*
Êash
){

598 
li°node
 *
ãmp
;

599 
group_t
 *
g
;

600 
tŸÆ
 = 0;

603 if(
Wow_Occu∑ncy_Êash_cou¡
 >
Wow_High_W©î
)

613  *
Êash
;

614 
	}
}

617 
	$wow_Æloc_Êash∑ge
(*
Êash
){

618 
Êag
 = 0;

620 *
Êash
 == 0){

621 *
Êash
 = 
	`wow_gë_exåa_Êash∑ge
(flash);

622 if(*
Êash
 == 0){

623 if(
	`Œ_gë_size
(
ªq_SSD_RQli°
) > 0)

624 
ªq_HDD_RQli°
 =Ñeq_HDD_RQlist;

625 
wow_°age_cou¡
 +
	`Œ_gë_size
(
ªq_HDD_RQli°
);

626 
	`wow_Êush_ªq_Qli°
(
DISK
, 
ªq_HDD_RQli°
, 
READ
);

627 
	`wow_Êush_ªq_Qli°
(
SSD
, 
ªq_SSD_WQli°
, 
WRITE
);

628 
	`wow_Êush_ªq_Qli°
(
SSD
, 
ªq_SSD_RQli°
, 
READ
);

630 
	`Œ_ªÀa£
(
ªq_SSD_WQli°
);

632 
	`wow_de°age_Æog‹ôhm
();

634 
	`Œ_¸óã
(&
ªq_SSD_WQli°
);

635 
	`Œ_¸óã
(&
ªq_HDD_RQli°
);

636 
	`Œ_¸óã
(&
ªq_SSD_RQli°
);

637 
Êag
 = 1;

641 if(*
Êash
 == 18305){

642 
Êag
 = flag;

645  
Êag
;

646 
	}
}

649 
	$wow_ö£π_group_to_q
(
group_t
 *
g
){

653 
	}
}

681 
∑ge_t
 *
	$wow_ö£π_∑ge_to_group
(
group_t
 *
g
, 
blk
, 
Êash
,
dúty
){

682 
∑ge_t
 *
pg
;

683 
pg
 = 
	`wow_Æloc_∑ge
(
blk
, 
Êash
);

684 
pg
->
dúty
 = dirty;

686 
	`Œ_ö£π_©_s‹t
(
g
->
∑ge_li°
, 
pg
, 
Œ_com∑ª_hdd
);

687 
g
->
∑gecou¡
++;

688 
	`Œ_ö£π_©_èû
(
g
->
∑ge_hash
[
blk
%
WOW_HASH_NUM
], 
pg
);

691  
pg
;

692 
	}
}

694 
wow_ö£π_∑ge_to_ªqli°
(
li°node
 *
ªq_li°
, 
∑ge_t
 *
pg
, (*
comp_func
) (const *,const *)){

695 
	`Œ_ö£π_©_s‹t
(
ªq_li°
, 
pg
, 
comp_func
);

696 
	}
}

698 
	$com∑ª_‰eq
(c⁄° *
a
,c⁄° *
b
){

700  *(*)
b
-*(*)
a
;

701 
	}
}

702 
rc_tŸÆ
, 
rc_ªad
, 
rc_wrôe
;

705 
	$wow_¥öt_‰eq_èbÀ
(
FILE
 *
Â
){

706 
i
;

707 
tŸÆ
 = 0;

708 
mega
 = 256;

709 
	`qs‹t
(
ws_‰eq_curve_globÆ
, 
Wow_HDD_Max_Pages
, (), 
com∑ª_‰eq
);

710 
	`qs‹t
(
ws_‰eq_curve_globÆ_rd
, 
Wow_HDD_Max_Pages
, (), 
com∑ª_‰eq
);

711 
	`qs‹t
(
ws_‰eq_curve_globÆ_wr
, 
Wow_HDD_Max_Pages
, (), 
com∑ª_‰eq
);

713 
	`Ârötf
(
Â
, " Syssim: Total Frequency Table \n");

714 
i
 = 0;ò<
Wow_SSD_Max_Pages
;i++){

715 
tŸÆ
 +
ws_‰eq_curve_globÆ
[
i
];

717 if(
i
 % (
mega
*1024/4) == 0){

718 
	`Ârötf
(
Â
, " %d %.3f\n", (
i
+1Ë* 100/ 
Wow_SSD_Max_Pages
, ()
tŸÆ
*100/
rc_tŸÆ
);

722 
tŸÆ
 = 0;

723 
	`Ârötf
(
Â
, " Syssim: Read Frequency Table \n");

724 
i
 = 0;ò<
Wow_SSD_Max_Pages
;i++){

725 
tŸÆ
 +
ws_‰eq_curve_globÆ_rd
[
i
];

727 if(
i
 % (
mega
*1024/4) == 0){

728 
	`Ârötf
(
Â
, " %d %.3f\n", (
i
+1Ë* 100/ 
Wow_SSD_Max_Pages
, ()
tŸÆ
*100/
rc_ªad
);

732 
tŸÆ
 = 0;

733 
	`Ârötf
(
Â
, " Syssim: Write Frequency Table \n");

734 
i
 = 0;ò<
Wow_SSD_Max_Pages
;i++){

735 
tŸÆ
 +
ws_‰eq_curve_globÆ_wr
[
i
];

737 if(
i
 % (
mega
*1024/4) == 0){

738 
	`Ârötf
(
Â
, " %d %.3f\n", (
i
+1Ë* 100/ 
Wow_SSD_Max_Pages
, ()
tŸÆ
*100/
rc_wrôe
);

741 
	}
}

744 
	$wow_¥öt_wss
(
FILE
 *
Â
){

745 
	`Ârötf
(
Â
, " Syssim: GlobÆ WSS AŒ = %.3f MB\n", ()
ws_cou¡_globÆ
*4/1024);

746 
	`Ârötf
(
Â
, " Syssim: GlobÆ WSS Ród = %.3f MB\n", ()
ws_cou¡_globÆ_rd
*4/1024);

747 
	`Ârötf
(
Â
, " Syssim: GlobÆ WSS Wrôe = %.3f MB\n", ()
ws_cou¡_globÆ_wr
*4/1024);

753 
	`Ârötf
(
Â
, "\n");

755 
	}
}

758 
	$wow_¥öt_wss2
(
FILE
 *
Â
){

759 
cou¡
 = 0;

761 if(
ˇche_pﬁicy
 !
CACHE_WORKLOAD_ANALYSIS
)

764 if(
cou¡
 ==0)

765 
	`Ârötf
(
Â
, "\n\n#No Global Global(R) Global(W) Local Local(R) Local(W)\n");

768 
	`Ârötf
(
Â
, "%d %.2f %.2f %.2f %.2f %.2f %.2f\n",

769 ++
cou¡
,

770 ()
ws_cou¡_globÆ
*4/1024/1024,

771 ()
ws_cou¡_globÆ_rd
*4/1024/1024,

772 ()
ws_cou¡_globÆ_wr
*4/1024/1024,

773 ()
ws_cou¡_loˇl
*4/1024/1024,

774 ()
ws_cou¡_loˇl_rd
*4/1024/1024,

775 ()
ws_cou¡_loˇl_wr
*4/1024/1024

782 
	}
}

785 
	gwss_¥öt_cou¡
 = 0;

786 
	gœ°_hour
 = 0.0;

790 
	$wow_wss_ª‰esh
(
blk
, 
rw
){

791 
cuº_hour
 = 0;

792 
	`wow_wss_check
(
ws_bôm≠_globÆ
, &
ws_cou¡_globÆ
, 
blk
);

793 
	`wow_wss_check
(
ws_bôm≠_loˇl
, &
ws_cou¡_loˇl
, 
blk
);

798 if(
rw
 =
READ
){

799 
	`wow_wss_check
(
ws_bôm≠_globÆ_rd
, &
ws_cou¡_globÆ_rd
, 
blk
);

800 
	`wow_wss_check
(
ws_bôm≠_loˇl_rd
, &
ws_cou¡_loˇl_rd
, 
blk
);

806 
	`wow_wss_check
(
ws_bôm≠_globÆ_wr
, &
ws_cou¡_globÆ_wr
, 
blk
);

807 
	`wow_wss_check
(
ws_bôm≠_loˇl_wr
, &
ws_cou¡_loˇl_wr
, 
blk
);

814 if(
rc_tŸÆ
 % (
Wow_WSS_Re‰esh_Pîiod
/4) != 0 ||Ñc_total == 0)

817 
cuº_hour
 = ()(()
RólTime
/(1000*60*60));

818 if(
cuº_hour
 <
œ°_hour
){

822 
œ°_hour
 = 
cuº_hour
;

825 
	`wow_¥öt_wss
(
°dout
);

826 
	`wow_¥öt_wss2
(
ouçutfûe
);

830 if(
Wow_U£_NARP
){

831 
	`wow_£t_w©îm¨k
(
ws_cou¡_loˇl
, ws_cou¡_loˇl-
Pages_Pî_Group
);

834 
	`fÊush
(
°dout
);

840 
	`wow_ws_öô
(
ws_bôm≠_loˇl
, &
ws_cou¡_loˇl
, 
Wow_HDD_Max_Pages
);

841 
	`wow_ws_öô
(
ws_bôm≠_loˇl_rd
, &
ws_cou¡_loˇl_rd
, 
Wow_HDD_Max_Pages
);

842 
	`wow_ws_öô
(
ws_bôm≠_loˇl_wr
, &
ws_cou¡_loˇl_wr
, 
Wow_HDD_Max_Pages
);

849 
	}
}

853 
	$wow_ª∂a˚mít_pﬁicy
(
blk
,
rw
){

854 
li°node
 *
node
 = 
NULL
;

855 
li°node
 *
hash
;

856 
group_t
 *
g
;

857 
∑ge_t
 *
pg
;

858 
gno
 = 
blk
/
Pages_Pî_Group
;

859 
Êash
 = 0;

861 
wow_ªf
++;

863 if(
rw
 =
READ
)

864 
wow_ªad_ªf
++;

866 
wow_wrôe_ªf
++;

868 
	`wow_wss_ª‰esh
(
blk
, 
rw
);

870 
Re°¨t
:;

874 if(
node
){

875 
g
 = 
node
->
d©a
;

879 
node
 = 
	`Œ_föd_node
(
g
->
∑ge_hash
[
blk
%
WOW_HASH_NUM
], (*)blk, 
Œ_com∑ª_∑ge
);

880 if(
node
){

885 
pg
 = 
node
->
d©a
;

886 
g
->
ª˚ncy
 = 1;

888 if(
rw
 =
WRITE
){

889 
pg
->
dúty
 = 
DIRTY
;

890 
	`wow_ö£π_∑ge_to_ªqli°
(
ªq_SSD_WQli°
, 
pg
, 
Œ_com∑ª_ssd
);

892 
	`wow_ö£π_∑ge_to_ªqli°
(
ªq_SSD_RQli°
, 
pg
, 
Œ_com∑ª_ssd
);

894 if(
rw
 =
READ
)

895 
wow_ªad_hô
++;

897 
wow_wrôe_hô
++;

899 
wow_hô
++;

903 if(
rw
 =
READ
){

904 
rw
 =Ñw;

906 if(
	`wow_Æloc_Êash∑ge
(&
Êash
)){

907 
Re°¨t
;

910 if(
rw
 =
WRITE
)

911 
pg
 = 
	`wow_ö£π_∑ge_to_group
(
g
, 
blk
, 
Êash
, 
DIRTY
);

913 
pg
 = 
	`wow_ö£π_∑ge_to_group
(
g
, 
blk
, 
Êash
, 
CLEAN
);

915 
	`wow_ö£π_∑ge_to_ªqli°
(
ªq_SSD_WQli°
, 
pg
, 
Œ_com∑ª_ssd
);

916 if(
rw
 =
READ
){

917 
	`wow_ö£π_∑ge_to_ªqli°
(
ªq_HDD_RQli°
, 
pg
, 
Œ_com∑ª_hdd
);

918 
	`wow_ö£π_∑ge_to_ªqli°
(
ªq_SSD_RQli°
, 
pg
, 
Œ_com∑ª_ssd
);

925 
	`wow_ö£π_group_to_q
(
g
);

926 
Re°¨t
;

931 
	}
}

945 
	$∑nic
(c⁄° *
s
)

947 
	`≥º‹
(
s
);

948 
	`exô
(1);

949 
	}
}

953 
	$add_°©i°ics
(
Sèt
 *
s
, 
x
)

955 
s
->
n
++;

956 
s
->
sum
 +
x
;

957 
s
->
sqr
 +
x
*x;

958 
	}
}

962 
	$¥öt_°©i°ics
(
Sèt
 *
s
, c⁄° *
tôÀ
)

964 
avg
, 
°d
;

966 
avg
 = 
s
->
sum
/s->
n
;

967 
°d
 = 
	`sqπ
((
s
->
sqr
 - 2*
avg
*s->
sum
 + s->
n
*avg*avg) / s->n);

968 
	`¥ötf
("%s:Ç=%dávîage=%‡°d. devüti⁄=%f\n", 
tôÀ
, 
s
->
n
, 
avg
, 
°d
);

969 
	}
}

978 
	$syssim_scheduÀ_ˇŒback
(
disksim_öãrÁ˚_ˇŒback_t
 
‚
,

979 
SysTime
 
t
,

980 *
˘x
)

982 
√xt_evít
 = 
t
;

983 
	}
}

990 
	$syssim_descheduÀ_ˇŒback
(
t
, *
˘x
)

992 
√xt_evít
 = -1;

993 
	}
}

997 
	$syssim_ªp‹t_com∂ëi⁄
(
SysTime
 
t
, 
disksim_ªque°
 *
r
, *
˘x
)

999 
com∂ëed
 = 1;

1000 
now
 = 
t
;

1001 
	`add_°©i°ics
(&
°
, 
t
 - 
r
->
°¨t
);

1002 
	}
}

1004 
i‹eq_evít
 * 
	$iŸø˚_ascii_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
i‹eq_evít
 *
√w
)

1006 
löe
[201];

1008 i‡(
	`fgës
(
löe
, 200, 
åa˚fûe
Ë=
NULL
) {

1009 
	`addt€xåaq
((
evít
 *Ë
√w
);

1010 (
NULL
);

1012 i‡(
	`ssˇnf
(
löe
, "%l‡%d %d %d %x\n", &
√w
->
time
, &√w->
devno
, &√w->
blkno
, &√w->
bcou¡
, &√w->
Êags
) != 5) {

1013 
	`Ârötf
(
°dîr
, "WrongÇumber ofárguments for I/OÅraceÉventÅype\n");

1014 
	`Ârötf
(
°dîr
, "löe: %s", 
löe
);

1017 i‡(
√w
->
Êags
 & 
ASYNCHRONOUS
) {

1018 
√w
->
Êags
 |“ew->Êag†& 
READ
Ë? 
TIME_LIMITED
 : 0;

1019 } i‡(
√w
->
Êags
 & 
SYNCHRONOUS
) {

1020 
√w
->
Êags
 |
TIME_CRITICAL
;

1023 
√w
->
buf
 = 0;

1024 
√w
->
›id
 = 0;

1025 
√w
->
bu¢o
 = 0;

1026 
√w
->
ˇu£
 = 0;

1027 (
√w
);

1028 
	}
}

1030 
	gªq_no
 = 0;

1031 
	gªq_wödow
 = 100000;

1032 
FILE
 *
	gåa˚_Â
;

1033 
	gfûíame
[100];

1035 
	$wow_issue_ªque°
(
disksim_ªque°
 *
r
){

1036 
i
;

1039 #ifde‡
__löux__


1046 
com∂ëed
 = 0;

1048 
	`disksim_öãrÁ˚_ªque°_¨rive
(
disksim_öf
, 
now
, 
r
);

1053 
√xt_evít
 >= 0) {

1054 
now
 = 
√xt_evít
;

1055 
√xt_evít
 = -1;

1056 
	`disksim_öãrÁ˚_öã∫Æ_evít
(
disksim_öf
, 
now
, 0);

1059 i‡(!
com∂ëed
) {

1060 
	`Ârötf
(
°dîr
,

1062 
	`exô
(1);

1068 if(
r
->
devno
 =
SSD
){

1072 
com∂ëed
 = 0;

1074 
	`disksim_öãrÁ˚_ªque°_¨rive
(
disksim_öf
, 
now
, 
r
);

1079 
√xt_evít
 >= 0) {

1080 
now
 = 
√xt_evít
;

1081 
√xt_evít
 = -1;

1082 
	`disksim_öãrÁ˚_öã∫Æ_evít
(
disksim_öf
, 
now
, 0);

1085 i‡(!
com∂ëed
) {

1086 
	`Ârötf
(
°dîr
,

1088 
	`exô
(1);

1091 
now
 += 2.0;

1098 #i‚de‡
__löux__


1123 
	}
}

1125 
	$wow_öô_ªque°
(
disksim_ªque°
 *
r
){

1126 
	`mem£t
(
r
, 0x00, (
disksim_ªque°
));

1128 
	}
}

1129 
	$wow_make_ªque°
(
disksim_ªque°
 *
r
,
SysTime
 
cuπime
, 
dev
, 
ªad
,
£˙o
, 
num
){

1130 
r
->
°¨t
 = 
cuπime
;

1131 
r
->
Êags
 = 
ªad
;

1132 
r
->
devno
 = 
dev
;

1133 
r
->
blkno
 = 
£˙o
;

1134 
r
->
byãcou¡
 = 
num
 * 
SECTOR
;

1135 
	}
}

1139 
	$wow_Êush_ªq_Qli°
(
devno
, 
li°node
 *
Qli°
,
rw
){

1140 
i
;

1141 
li°node
 *
rq
;

1142 
disksim_ªque°
 
r
;

1143 
SysTime
 
cuºTime
 = 
now
;

1145 if(
	`Œ_gë_size
(
Qli°
) == 0)

1148 
	`wow_öô_ªque°
(&
r
);

1149 
rq
 = 
Qli°
->
¥ev
;

1150 
i
 = 0;ò< 
	`Œ_gë_size
(
Qli°
);i++){

1151 
blk
;

1152 
∑ge_t
 *
pg
 = 
rq
->
d©a
;

1154 if(
devno
 =
SSD
)

1155 
blk
 = 
pg
->
Êash_blkno
;

1157 
blk
 = 
pg
->
disk_blkno
;

1159 if(!
pg
->
dúty
)

1160 
pg
 =Ög;

1161 if(
pg
->
dñëed
)

1162 
pg
 =Ög;

1163 if(
blk
 > 
Wow_HDD_Max_Pages
)

1164 
blk
 = blk;

1165 
blk
 *()
BLOCK2SECTOR
;

1168 if(!
r
.
blkno
){

1169 
	`wow_make_ªque°
(&
r
, 
cuºTime
, 
devno
, 
rw
, 
blk
, 
BLOCK2SECTOR
);

1170 }if(
r
.
blkno
 +Ñ.
byãcou¡
/
SECTOR
 =
blk
){

1171 
r
.
byãcou¡
 +
BLOCK
;

1172 if(
r
.
byãcou¡
 >
MAX_REQ_BYTES
){

1173 
	`wow_issue_ªque°
(&
r
);

1174 
	`wow_öô_ªque°
(&
r
);

1176 }if(
r
.
blkno
 +Ñ.
byãcou¡
/
SECTOR
!
blk
){

1177 
	`wow_issue_ªque°
(&
r
);

1178 
	`wow_make_ªque°
(&
r
, 
cuºTime
, 
devno
, 
rw
, 
blk
, 
BLOCK2SECTOR
);

1181 if(
rw
 =
WRITE
)

1182 
pg
->
dúty
 = 
CLEAN
;

1185 
	`NODE_PREV
(
rq
);

1187 if(
r
.
byãcou¡
)

1188 
	`wow_issue_ªque°
(&
r
);

1190 
	}
}

1195 
	#GIGA
 4

	)

1196 
	#REQ_SIZE
 (256*1024)

	)

1197 
	$gí_sy¡h
(){

1198 
i
;

1199 
öãøti⁄
 = ()
GIGA
 * 1024 * 1024 * 1024/
REQ_SIZE
;

1201 
blk
;

1202 
devno
 = 0;

1203 
dev_max_∑ges
;

1204 
disksim_ªque°
 
r
;

1205 
SysTime
 
°¨t_time
, 
íd_time
;

1208 
devno
 = 0;

1209 
dev_max_∑ges
 = 
Wow_HDD_Max_Pages
;

1211 
devno
 = 1;

1212 
dev_max_∑ges
 = 
Wow_SSD_Max_Pages
 * 90 / 100;

1215 
i
 = 0;ò< 
dev_max_∑ges
;i++){

1216 
blk
 = 
i
 * 
BLOCK2SECTOR
;

1217 
blk
 %(
dev_max_∑ges
-1);

1218 
	`wow_make_ªque°
(&
r
, 
now
, 
devno
, 
WRITE
, 
blk
, 
BLOCK2SECTOR
);

1219 
	`wow_issue_ªque°
(&
r
);

1223 
°¨t_time
 = 
now
;

1225 
i
 = 0;ò< 
öãøti⁄
;i++){

1226 
blk
 = 
i
 * (
REQ_SIZE
/
BLOCK
Ë* 
BLOCK2SECTOR
;

1227 
blk
 %
dev_max_∑ges
;

1228 
	`wow_make_ªque°
(&
r
, 
now
, 
devno
, 
WRITE
, 
blk
, (
REQ_SIZE
/
BLOCK
Ë* 
BLOCK2SECTOR
);

1229 
	`wow_issue_ªque°
(&
r
);

1231 
íd_time
 = 
now
;

1232 
	`Ârötf
(
°dout
, "SW Throughpuà%fMB\n", ()
GIGA
 *1024/((
íd_time
-
°¨t_time
)/1000));

1235 
°¨t_time
 = 
now
;

1237 
i
 = 0;ò< 
öãøti⁄
;i++){

1238 
blk
 = 
	`RND
(
dev_max_∑ges
/(
REQ_SIZE
/
BLOCK
));

1239 
blk
 *(
REQ_SIZE
/
BLOCK
);

1240 
blk
 %
dev_max_∑ges
;

1241 
blk
 *
BLOCK2SECTOR
;

1242 
	`wow_make_ªque°
(&
r
, 
now
, 
devno
, 
WRITE
, 
blk
, (
REQ_SIZE
/
BLOCK
Ë* 
BLOCK2SECTOR
);

1243 
	`wow_issue_ªque°
(&
r
);

1245 
íd_time
 = 
now
;

1246 
	`Ârötf
(
°dout
, "RW Throughpuà%fMB\n", ()
GIGA
 *1024/((
íd_time
-
°¨t_time
)/1000));

1249 
°¨t_time
 = 
now
;

1251 
i
 = 0;ò< 
öãøti⁄
;i++){

1252 
blk
 = 
i
 * (
REQ_SIZE
/
BLOCK
Ë* 
BLOCK2SECTOR
;

1253 
blk
 %
dev_max_∑ges
;

1254 
	`wow_make_ªque°
(&
r
, 
now
, 
devno
, 
READ
, 
blk
, (
REQ_SIZE
/
BLOCK
Ë* 
BLOCK2SECTOR
);

1255 
	`wow_issue_ªque°
(&
r
);

1257 
íd_time
 = 
now
;

1258 
	`Ârötf
(
°dout
, "SR Throughpuà%fMB\n", ()
GIGA
 *1024/((
íd_time
-
°¨t_time
)/1000));

1261 
°¨t_time
 = 
now
;

1263 
i
 = 0;ò< 
öãøti⁄
;i++){

1264 
blk
 = 
	`RND
(
dev_max_∑ges
/(
REQ_SIZE
/
BLOCK
));

1265 
blk
 *(
REQ_SIZE
/
BLOCK
);

1266 
blk
 %
dev_max_∑ges
;

1267 
blk
 *
BLOCK2SECTOR
;

1268 
	`wow_make_ªque°
(&
r
, 
now
, 
devno
, 
READ
, 
blk
, (
REQ_SIZE
/
BLOCK
Ë* 
BLOCK2SECTOR
);

1269 
	`wow_issue_ªque°
(&
r
);

1271 
íd_time
 = 
now
;

1272 
	`Ârötf
(
°dout
, "RR Throughpuà%fMB\n", ()
GIGA
 *1024/((
íd_time
-
°¨t_time
)/1000));

1274 
	}
}

1277 
	$wow_ª•⁄£_åackög
(
cuº_time
,

1278 
ª•⁄£_ms
,

1279 
°age
,

1280 
de°age
,

1281 
ssd_ªad
,

1282 
ssd_wrôe
,

1283 
gc_time
,

1284 
s_tŸÆ
,

1285 
s_sugge°ed_ªad
,

1286 
s_sugge°ed_wrôe
,

1287 
s_ªad
,

1288 
s_wrôe
,

1289 
ªad_hô
,

1290 
wrôe_hô
,

1291 
avg_ª•⁄£
){

1292 
mod
 = 512;

1293 
giga
 = 
Wow_SSD_Max_Pages
 / 256 / 1024;

1295 
ª•⁄£_cou¡
++;

1297 if(
ª•⁄£_cou¡
 % 
mod
 == 0){

1299 
	`Ârötf
(
ª•⁄£_Â
, "%f\t%d\t%.3f\t%.3f\t%.3f\t%.3f\t%.3f\t%.3f\t%.3f\t%.3f\t%.3f\t%.3f\t%.3f\t%.3f\t%f\t%f\t%.3f\n",

1300 
cuº_time
,

1301 
ª•⁄£_cou¡
,

1302 
ª•⁄£_ms
,

1303 
°age
,

1304 
de°age
,

1305 
ssd_ªad
,

1306 
ssd_wrôe
,

1307 
gc_time
,

1308 ()
giga
*((
s_sugge°ed_ªad
+
s_sugge°ed_wrôe
)*100/
s_tŸÆ
)/100,

1309 ()
giga
*((
s_sugge°ed_ªad
)*100/
s_tŸÆ
)/100,

1310 ()
giga
*((
s_ªad
+
s_wrôe
)*100/
s_tŸÆ
)/100,

1311 ()
giga
*((
s_ªad
)*100/
s_tŸÆ
)/100,

1312 ()
giga
*((
s_sugge°ed_wrôe
)*100/
s_tŸÆ
)/100,

1313 ()
giga
*((
s_sugge°ed_ªad
)*100/
s_tŸÆ
)/100,

1314 ()
giga
*((
s_wrôe
)*100/
s_tŸÆ
)/100,

1315 ()
giga
*((
s_ªad
)*100/
s_tŸÆ
)/100,

1316 
ªad_hô
,

1317 
wrôe_hô
,

1318 
avg_ª•⁄£


1323 
	`Ârötf
(
ª•⁄£_Â
, "%d\t", 
ª•⁄£_cou¡
);

1325 
	`Ârötf
(
ª•⁄£_Â
, "%f\t", 
cuº_time
);

1327 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", 
ª•⁄£_ms
);

1329 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", 
°age
);

1331 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", 
de°age
);

1333 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", 
ssd_ªad
);

1335 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", 
ssd_wrôe
);

1337 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", 
gc_time
);

1339 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", ()
giga
*((
s_sugge°ed_ªad
+
s_sugge°ed_wrôe
)*100/
s_tŸÆ
)/100);

1341 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", ()
giga
*((
s_sugge°ed_ªad
)*100/
s_tŸÆ
)/100);

1343 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", ()
giga
*((
s_ªad
+
s_wrôe
)*100/
s_tŸÆ
)/100);

1345 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", ()
giga
*((
s_ªad
)*100/
s_tŸÆ
)/100);

1347 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", ()
giga
*((
s_sugge°ed_wrôe
)*100/
s_tŸÆ
)/100);

1349 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", ()
giga
*((
s_sugge°ed_ªad
)*100/
s_tŸÆ
)/100);

1351 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", ()
giga
*((
s_wrôe
)*100/
s_tŸÆ
)/100);

1353 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\t", ()
giga
*((
s_ªad
)*100/
s_tŸÆ
)/100);

1355 
	`Ârötf
(
ª•⁄£_Â
, "%f\t", 
ªad_hô
);

1357 
	`Ârötf
(
ª•⁄£_Â
, "%f\t", 
wrôe_hô
);

1359 
	`Ârötf
(
ª•⁄£_Â
, "%.3f\n", 
avg_ª•⁄£
);

1362 
	`fÊush
(
ª•⁄£_Â
);

1363 if(
ª•⁄£_cou¡
 % (
mod
 * 100) == 0)

1364 
	`Ârötf
(
°dout
, " Avg Re•⁄£ = %.3fms\n", 
avg_ª•⁄£
);

1366 if(
ª•⁄£_ms
 == 0.0)

1367 
ª•⁄£_ms
 =Ñesponse_ms;

1369 
	}
}

1371 
	gˇche_pﬁicy
;

1373 
RESIZE_PERIOD
;

1378 
	$exåa˘_m≠pög
(){

1380 
i
;

1381 
m≠pög_ãmp
;

1382 
≥r˚¡
;

1383 
FILE
 *
åa˚fûe
;

1386 
	`¥ötf
(" StartÅesting... \n");

1390 
m≠pög_ãmp
 = 5000;

1391 
©œs_size
 = (
Wow_HDD_Max_Pages
 + 
m≠pög_ãmp
Ë* (
BLOCK
/
SECTOR
);

1393 if(
©œs_¨øy
 =
NULL
){

1394 
size
 = 0;

1396 
size
 = 
©œs_size
 * ();

1398 
©œs_¨øy
 = (*)
	`mÆloc
(
size
);

1399 if(
©œs_¨øy
 =
NULL
){

1400 
	`¥ötf
("mallocÉrror \n");

1401 
	`fÊush
(
°dout
);

1402 
	`exô
(0);

1404 
	`mem£t
(
©œs_¨øy
, 0x00, 
size
);

1409 
	`¥ötf
(" Max Se˘‹†%d, Max Page†%d\n", 
Wow_HDD_Max_Pages
 * (
BLOCK
/
SECTOR
), Wow_HDD_Max_Pages);

1410 
	`¥ötf
(" fûêsizê%d\n", 
©œs_size
 * ());

1412 
	`fÊush
(
°dout
);

1414 
≥r˚¡
 = 
Wow_HDD_Max_Pages
 / 100;

1416 
i
 = 0;ò< 
Wow_HDD_Max_Pages
;i++){

1419 
disksim_ªque°
 
r
;

1420 
r
.
devno
 = 0;

1421 
r
.
blkno
 = 
i
 * (
BLOCK
/
SECTOR
);

1422 
r
.
byãcou¡
 = 4096;

1423 
r
.
Êags
 = 
WRITE
;

1424 
	`wow_issue_ªque°
(&
r
);

1426 if(
i
 % 
≥r˚¡
 == 0 && i > 0){

1427 
	`¥ötf
("ˇcuœtög %d%% \n", (
i
/
≥r˚¡
));

1428 
	`fÊush
(
°dout
);

1434 
m≠pög_Â
 = 
	`f›í
(
MAPPING_FILE
, "w");

1435 if(
m≠pög_Â
 =
NULL
){

1436 
	`¥ötf
(" c™nŸ o≥¿fûê%s\n", 
MAPPING_FILE
);

1437 
	`fÊush
(
°dout
);

1438 
	`exô
(0);

1442 
≥r˚¡
 = 
©œs_size
/100;

1444 
i
 = 0;ò< 
©œs_size
;i++){

1447 
	`fwrôe
(&
©œs_¨øy
[
i
], (), 1, 
m≠pög_Â
);

1449 if(
i
 % 
≥r˚¡
 == 0 && i > 0){

1450 
	`¥ötf
("wrôêfûê%d%% \n", (
i
/
≥r˚¡
));

1451 
	`fÊush
(
°dout
);

1456 
	`f˛o£
(
m≠pög_Â
);

1461 
m≠pög_Â
 = 
	`f›í
(
MAPPING_FILE
, "r");

1462 if(
m≠pög_Â
 =
NULL
){

1463 
	`¥ötf
(" c™nŸ o≥¿fûê%s\n", 
MAPPING_FILE
);

1464 
	`fÊush
(
°dout
);

1465 
	`exô
(0);

1469 
≥r˚¡
 = 
©œs_size
/100;

1471 
i
 = 0;ò< 
©œs_size
;i++){

1472 
ã°_vÆ
 = 0;

1476 
	`‰ód
(&
ã°_vÆ
, (), 1, 
m≠pög_Â
);

1478 if(
ã°_vÆ
 !
©œs_¨øy
[
i
]){

1479 
	`¥ötf
(" Vîifiˇti⁄Éº‹ :Åe° = %d,áéas_¨øy = %d\n", 
ã°_vÆ
, 
©œs_¨øy
[
i
]);

1480 
	`fÊush
(
°dout
);

1483 if(
i
 % 
≥r˚¡
 == 0 && i > 0){

1484 
	`¥ötf
("vîifiˇti⁄ %d%% \n", (
i
/
≥r˚¡
));

1485 
	`fÊush
(
°dout
);

1488 
	`f˛o£
(
m≠pög_Â
);

1492 
	`‰ì
(
©œs_¨øy
);

1494 
	`exô
(0);

1496 
	}
}

1498 
	$u£_©œs_m≠pög
(){

1500 
i
;

1501 
m≠pög_ãmp
;

1502 
≥r˚¡
;

1503 
FILE
 *
åa˚fûe
;

1508 
m≠pög_Â
 = 
	`f›í
(
MAPPING_FILE
, "r");

1509 if(
m≠pög_Â
 =
NULL
){

1510 
	`¥ötf
(" c™nŸ o≥¿fûê%s\n", 
MAPPING_FILE
);

1511 
	`fÊush
(
°dout
);

1512 
	`exô
(0);

1518 
m≠pög_ãmp
 = 5000;

1519 
©œs_size
 = (
Wow_HDD_Max_Pages
 + 
m≠pög_ãmp
Ë* (
BLOCK
/
SECTOR
);

1520 
	`¥ötf
(" Max Se˘‹†%d, Max Page†%d\n", 
Wow_HDD_Max_Pages
 * (
BLOCK
/
SECTOR
), Wow_HDD_Max_Pages);

1521 
	`¥ötf
(" fûêsizê%d\n", 
©œs_size
 * ());

1522 
	`¥ötf
(" Using Mapping File \n");

1523 
	`fÊush
(
°dout
);

1526 if(
©œs_¨øy
 =
NULL
){

1527 
size
 = 0;

1529 
size
 = 
©œs_size
 * ();

1531 
©œs_¨øy
 = (*)
	`mÆloc
(
size
);

1532 if(
©œs_¨øy
 =
NULL
){

1533 
	`¥ötf
("mallocÉrror \n");

1534 
	`fÊush
(
°dout
);

1535 
	`exô
(0);

1537 
	`mem£t
(
©œs_¨øy
, 0x00, 
size
);

1541 
	`¥ötf
(" Read Mapping File \n");

1542 
	`fÊush
(
°dout
);

1543 
≥r˚¡
 = 
©œs_size
/100;

1544 
i
 = 0;ò< 
©œs_size
;i++){

1545 
ã°_vÆ
 = 0;

1548 
	`‰ód
(&
ã°_vÆ
, (), 1, 
m≠pög_Â
);

1554 
©œs_¨øy
[
i
] = 
ã°_vÆ
;

1556 if(
i
 % 
≥r˚¡
 == 0 && i > 0){

1557 
	`¥ötf
("vîifiˇti⁄ %d%% \n", (
i
/
≥r˚¡
));

1558 
	`fÊush
(
°dout
);

1564 
	`¥ötf
(" Write Test \n");

1565 
	`fÊush
(
°dout
);

1567 
≥r˚¡
 = 
Wow_HDD_Max_Pages
 / 100;

1568 
i
 = 0;ò< 
Wow_HDD_Max_Pages
;i++){

1571 
disksim_ªque°
 
r
;

1572 
r
.
devno
 = 0;

1573 
r
.
blkno
 = 
i
 * (
BLOCK
/
SECTOR
);

1574 
r
.
byãcou¡
 = 4096;

1575 
r
.
Êags
 = 
WRITE
;

1576 
	`wow_issue_ªque°
(&
r
);

1578 if(
i
 % 
≥r˚¡
 == 0 && i > 0){

1579 
	`¥ötf
("ˇcuœtög %d%% \n", (
i
/
≥r˚¡
));

1580 
	`fÊush
(
°dout
);

1589 
	}
}

1603 
	$maö
(
¨gc
, *
¨gv
[])

1605 
i
 = 0;

1606 
j
 = 0;

1607 
n£˘‹s
;

1608 
cou¡
;

1609 
tŸÆ_îa£s
 = 0;

1610 
tŸÆ_blocks
 = 0;

1611 
åack_num
 = 16;

1612 
îa£_avg
 = 0.0;

1614 
run_squ¨es
 = 0.0;

1615 
tŸÆ_îa£
 = 0;

1616 
°©
 
buf
;

1617 
disksim_ªque°
 
r
;

1618 
li°node
 *
rq
;

1619 
≥r˚¡
 = 0;

1620 
öôül_utû
 = 0.1;

1621 
SEQ_COUNT
;

1622 
i‹eq_evít
 
ªq
;

1624 
m≠pög_ãmp
;

1626 #ifde‡
USE_ERASE_FP


1627 
FILE
 *
îa£_Â
;

1629 
îa£_°r
[256];

1630 
debug_cou¡
 = 0;

1631 
°©gí
 
sy°em_ª•⁄£
;

1637 
åack_num
 = 16;

1639 i‡(
¨gc
 < 6 ||árgc > 9) {

1640 
	`Ârötf
(
°dîr
, "usage: %s <param file> <output file> <#sectors>\n",

1641 
¨gv
[0]);

1642 
	`exô
(1);

1645 
disksim_öf
 = 
	`disksim_öãrÁ˚_öôülize
(
¨gv
[1],

1646 
¨gv
[2],

1647 
syssim_ªp‹t_com∂ëi⁄
,

1648 
syssim_scheduÀ_ˇŒback
,

1649 
syssim_descheduÀ_ˇŒback
,

1656 
	`DISKSIM_§™d48
(1);

1658 
ˇche_pﬁicy
 = 
	`©oi
(
¨gv
[5]);

1659 if(
ˇche_pﬁicy
 >
CACHE_POLICY_NUM
){

1660 
	`Ârötf
(
°dout
, " Invalid Argument ... \n");

1663 i‡(
	`°©
(
¨gv
[1], &
buf
) < 0)

1664 
	`∑nic
(
¨gv
[1]);

1669 
öôül_utû
 = 0.0;

1672 if(
¨gc
 >8 && 
	`©oi
(
¨gv
[7]) > 0){

1673 
SEQ_COUNT
 = 
	`©oi
(
¨gv
[7]);

1674 
	`Ârötf
(
ouçutfûe
, " Seq Dëe˘i⁄ Sizê%dKB\n", 
SEQ_COUNT
 * 4);

1675 
	`Ârötf
(
°dout
, " Seq Dëe˘i⁄ Sizê%dKB\n", 
SEQ_COUNT
 * 4);

1678 if(
¨gc
 >9 && 
	`©oi
(
¨gv
[8]) > 0){

1679 
åack_num
 = 
	`©oi
(
¨gv
[8]);

1683 
	`wow_öô
(
öôül_utû
);

1684 
	`rw_£t_∑øms
(
cuºssd
);

1686 
	`¥ötf
(" hdd co° %dus\n", 
	`HDD_COST
());

1688 
	`•rötf
(
ª•⁄£_°r
,"%s.ª•⁄£", 
¨gv
[2]);

1689 
ª•⁄£_cou¡
 = 0;

1691 
ª•⁄£_Â
 = 
	`f›í
(
ª•⁄£_°r
, "w");

1692 if(
ª•⁄£_Â
 =
NULL
){

1693 
	`Ârötf
(
°dout
, "ˇ¬Ÿ o≥¿fûê%s\n", 
ª•⁄£_°r
);

1694 
	`exô
(0);

1697 
	`•rötf
(
îa£_°r
, "%s.îa£", 
¨gv
[2]);

1698 #ifde‡
USE_ERASE_FP


1699 
îa£_Â
 = 
	`f›í
(
îa£_°r
, "w");

1700 if(
îa£_Â
 =
NULL
){

1701 
	`Ârötf
(
°dout
, "ˇ¬Ÿ o≥¿fûê%s\n", 
îa£_°r
);

1702 
	`exô
(0);

1705 
	`Ârötf
(
°dout
, " O≥¿åa˚ fûê%s\n", 
¨gv
[4]);

1718 if(
¨gc
 >8 && 
	`©oi
(
¨gv
[6]) > 0){

1719 
sˇÀ
 = 0.0;

1720 
≥riod
 = 
	`©oi
(
¨gv
[6]);

1726 if(
sˇÀ
 <= 0.0)

1727 
sˇÀ
 = 1.0;

1729 
RESIZE_PERIOD
 = 
Wow_SSD_Max_Pages
 / 
≥riod
;

1734 if(
ˇche_pﬁicy
 =
CACHE_LRU_RW
){

1738 
	`Ârötf
(
°dout
, " FCM ... \n");

1739 
	`Ârötf
(
ouçutfûe
, " FCM ... \n");

1740 
	`fÊush
(
°dout
);

1742 
	`rw_simuœti⁄
(
¨gv
[4], 
Wow_Max_High_W©î
, 
Wow_HDD_Max_Pages
, 
Wow_SSD_Max_Pages
, 0);

1743 }if(
ˇche_pﬁicy
 =
CACHE_LRU_RWO_ADAPTIVE
){

1744 
	`Ârötf
(
°dout
, " AFCM ... \n");

1745 
	`Ârötf
(
ouçutfûe
, " AFCM ... \n");

1746 
	`fÊush
(
°dout
);

1747 #i‚de‡
__löux__


1748 
Wow_HDD_Max_Pages
 = 268435456/8;

1756 
	`Ârötf
(
°dout
 , " Syssim: ResizêPîiod = %d\n", 
RESIZE_PERIOD
);

1757 
	`Ârötf
(
ouçutfûe
, " Syssim: ResizêPîiod = %d\n", 
RESIZE_PERIOD
);

1758 
	`Ârötf
(
°dout
, " Syssim: HôÅøckögÖªcisi⁄ = %d\n", 
åack_num
);

1759 
	`Ârötf
(
ouçutfûe
, " Syssim: HôÅøckögÖªcisi⁄ = %d\n", 
åack_num
);

1760 
	`fÊush
(
°dout
);

1762 
	`ad≠tive_simuœti⁄
(
¨gv
[4], 
åack_num
, 
Wow_Max_High_W©î
, 
Wow_HDD_Max_Pages
, 
Wow_SSD_Max_Pages
, 0, 1, 0);

1765 }if(
ˇche_pﬁicy
 =
CACHE_LRU_SELECTIVE
){

1767 
	`Ârötf
(
°dout
, " Selective AFCM ... \n");

1768 
	`Ârötf
(
ouçutfûe
, " Selective AFCM ... \n");

1770 #i‚de‡
__löux__


1771 
Wow_HDD_Max_Pages
 = 268435456/8;

1779 
	`Ârötf
(
°dout
 , " Syssim: ResizêPîiod = %d\n", 
RESIZE_PERIOD
);

1780 
	`Ârötf
(
ouçutfûe
, " Syssim: ResizêPîiod = %d\n", 
RESIZE_PERIOD
);

1781 
	`Ârötf
(
°dout
, " Syssim: HôÅøckögÖªcisi⁄ = %d\n", 
åack_num
);

1782 
	`Ârötf
(
ouçutfûe
, " Syssim: HôÅøckögÖªcisi⁄ = %d\n", 
åack_num
);

1784 
	`ad≠tive_simuœti⁄
(
¨gv
[4], 
åack_num
, 
Wow_Max_High_W©î
, 
Wow_HDD_Max_Pages
, 
Wow_SSD_Max_Pages
, 0, 1, 1);

1787 }if(
ˇche_pﬁicy
 =
CACHE_BGCLOCK_RW
){

1788 
	`Ârötf
(
°dout
, " Block Group Clock Replacement ... \n");

1789 
	`Ârötf
(
ouçutfûe
, " Block Group Clock Replacement ... \n");

1791 
	`rw_simuœti⁄
(
¨gv
[4], 
Wow_Max_High_W©î
, 
Wow_HDD_Max_Pages
, 
Wow_SSD_Max_Pages
, 1);

1792 }if(
ˇche_pﬁicy
 =
CACHE_BGCLOCK_RWO_ADAPTIVE
){

1793 
	`Ârötf
(
°dout
, " Block Group Write Clockánd LRU Read Replacement ... \n");

1794 
	`Ârötf
(
ouçutfûe
, " Block Group Write Clockánd LRU Read Replacement ... \n");

1795 
	`ad≠tive_simuœti⁄
(
¨gv
[4], 
åack_num
, 
Wow_Max_High_W©î
, 
Wow_HDD_Max_Pages
, 
Wow_SSD_Max_Pages
, 1, 1, 0);

1796 }if(
ˇche_pﬁicy
 =
CACHE_WORKLOAD_ANALYSIS
){

1797 
	`Ârötf
(
°dout
, " Syssim: HôÅøckögÖªcisi⁄ = %d\n", 
åack_num
);

1798 
	`Ârötf
(
ouçutfûe
, " Syssim: HôÅøckögÖªcisi⁄ = %d\n", 
åack_num
);

1800 
	`Ârötf
(
°dout
, " I/O directlyÅoÅhe disk for workloadánalysis ... \n");

1801 
	`Ârötf
(
ouçutfûe
, " I/O directlyÅoÅhe disk for workloadánalysis ... \n");

1802 
	`w‹klﬂd_simuœti⁄
(
¨gv
[4], 
Wow_Max_High_W©î
, 
Wow_HDD_Max_Pages
, 
Wow_SSD_Max_Pages
, 0, 
åack_num
);

1803 }if(
ˇche_pﬁicy
 =
CACHE_DISK_ONLY
){

1804 
	`Ârötf
(
°dout
, " DISK Only Simulation ... \n");

1805 
	`Ârötf
(
ouçutfûe
, " DISK Only Simulation ... \n");

1807 
	`disk_simuœti⁄
(
¨gv
[4], 
Wow_Max_High_W©î
, 
Wow_HDD_Max_Pages
, 
Wow_SSD_Max_Pages
, 0);

1808 }if(
ˇche_pﬁicy
 =
CACHE_SSD_ONLY
){

1809 
	`Ârötf
(
°dout
, " SSD Only Simulation ... \n");

1810 
	`Ârötf
(
ouçutfûe
, " SSD Only Simulation ... \n");

1812 
	`ssd_simuœti⁄
(
¨gv
[4], 
Wow_Max_High_W©î
, 
Wow_HDD_Max_Pages
, 
Wow_SSD_Max_Pages
, 
cuºssd
);

1813 }if(
ˇche_pﬁicy
 =
CACHE_LRU_RW_ADAPTIVE
){

1815 #i‚de‡
__löux__


1816 
Wow_HDD_Max_Pages
 = 35913728;

1818 
	`Ârötf
(
°dout
, " FCM(RW) ... \n");

1819 
	`Ârötf
(
ouçutfûe
, " FCM(RW) ... \n");

1820 
	`fÊush
(
°dout
);

1822 
	`ad≠tive_simuœti⁄
(
¨gv
[4], 
åack_num
, 
Wow_Max_High_W©î
, 
Wow_HDD_Max_Pages
, 
Wow_SSD_Max_Pages
, 0, 0, 0);

1823 }if(
ˇche_pﬁicy
 =
CACHE_ZIPF
){

1824 
	`Ârötf
(
°dout
, " Zipf Simulation ... \n");

1825 
	`Ârötf
(
ouçutfûe
, " Zipf Simulation ... \n");

1826 
	`zùf_simuœti⁄
(
¨gv
[4], 
Wow_Max_High_W©î
, 
Wow_HDD_Max_Pages
, 
Wow_SSD_Max_Pages
, 0);

1830 
	`°©_¥öt
(&
cuºssd
->
°©
.
ª•⁄£°©s
, "NANDCACHE: ");

1832 #ifde‡
USE_ERASE_FP


1833 
	`Ârötf
(
îa£_Â
," #Print Erase Count \n");

1834 
	`Ârötf
(
îa£_Â
," #logicalBlock EraseCount CummCount \n");

1836 
i
 = 0; i < 
cuºssd
->
∑øms
.
√Àmíts
; i ++) {

1837 
ssd_ñemít_°©
 *
°©
 = &(
cuºssd
->
ñemíts
[
i
].stat);

1838 
ssd_ñemít_mëad©a
 *
mëa
 = &(
cuºssd
->
ñemíts
[
i
].
mëad©a
);

1839 
block_mëad©a
 *
block
 = 
mëa
->
block_ußge
;

1841 
tŸÆ_îa£
 +
°©
->
num_˛ón
;

1843 
j
 = 0;j < 
cuºssd
->
∑øms
.
blocks_≥r_ñemít
;j++){

1844 
n
 = 
SSD_MAX_ERASURES
 - 
block
[
j
].
ªm_li„time
;

1845 
tŸÆ_îa£s
 +(
n
);

1846 #ifde‡
USE_ERASE_FP


1847 
	`Ârötf
(
îa£_Â
, "%d %d %d\n",
i
*
cuºssd
->
∑øms
.
blocks_≥r_ñemít
+
j
,

1848 
n
, 
tŸÆ_îa£s
);

1850 
run_squ¨es
 +()(
n
 *Ç);

1855 
tŸÆ_blocks
 = 
cuºssd
->
∑øms
.
√Àmíts
 * cuºssd->∑øms.
blocks_≥r_ñemít
;

1856 
îa£_avg
 = ()
tŸÆ_îa£
/()
tŸÆ_blocks
;

1857 
run_squ¨es
 =Ñun_squ¨e†/ (Ë
tŸÆ_blocks
 - (
îa£_avg
*erase_avg);

1858 
run_squ¨es
 = (run_squ¨e†> 0.0Ë? 
	`sqπ
(run_squares) : 0.0;

1860 
	`Ârötf
(
ouçutfûe
, "Syssim TŸÆ Eø£†Cou¡ = %Œd\n",
tŸÆ_îa£
);

1861 
	`Ârötf
(
ouçutfûe
, "Syssim TŸÆ Eø£†Avg. = %f\n",
îa£_avg
);

1862 
	`Ârötf
(
ouçutfûe
, "Syssim TŸÆ Eø£†Std. = %f\n",
run_squ¨es
);

1863 #ifde‡
USE_ERASE_FP


1864 
	`Ârötf
(
îa£_Â
, "Syssim TŸÆ Eø£†Cou¡ = %Œd\n",
tŸÆ_îa£
);

1865 
	`Ârötf
(
îa£_Â
, "Syssim TŸÆ Eø£†Avg. = %f\n",
îa£_avg
);

1866 
	`Ârötf
(
îa£_Â
, "Syssim TŸÆ Eø£†Std. = %f\n",
run_squ¨es
);

1867 
	`f˛o£
(
îa£_Â
);

1870 
	`wow_¥öt_wss
(
ouçutfûe
);

1875 
	`f˛o£
(
ª•⁄£_Â
);

1877 
	`disksim_öãrÁ˚_shutdown
(
disksim_öf
, 
now
);

1879 
	`¥ötf
(" Simulation was successfully done\n");

1890 
	`exô
(0);

1891 
	}
}

1901 
	$wowmaö
(
¨gc
, *
¨gv
[])

1903 
i
 = 0;

1904 
n£˘‹s
;

1905 
cou¡
;

1906 
tŸÆ_îa£
 = 0;

1907 
°©
 
buf
;

1908 
disksim_ªque°
 
r
;

1909 
li°node
 *
rq
;

1911 
i‹eq_evít
 
ªq
;

1912 
FILE
 *
åa˚fûe
;

1913 
debug_cou¡
 = 0;

1915 i‡(
¨gc
 != 6) {

1916 
	`Ârötf
(
°dîr
, "usage: %s <param file> <output file> <#sectors>\n",

1917 
¨gv
[0]);

1918 
	`exô
(1);

1921 
disksim_öf
 = 
	`disksim_öãrÁ˚_öôülize
(
¨gv
[1],

1922 
¨gv
[2],

1923 
syssim_ªp‹t_com∂ëi⁄
,

1924 
syssim_scheduÀ_ˇŒback
,

1925 
syssim_descheduÀ_ˇŒback
,

1931 
	`DISKSIM_§™d48
(1);

1934 #ifde‡
__löux__


1935 
åa˚fûe
 = 
	`f›í64
(
¨gv
[4], "r");

1937 
åa˚fûe
 = 
	`f›í
(
¨gv
[4], "r");

1940 
Wow_U£_NARP
 = 
	`©oi
(
¨gv
[5]);

1941 if(
Wow_U£_NARP
 != 0 && Wow_Use_NARP != 1){

1942 
	`Ârötf
(
°dout
, " Invalid Argument ... \n");

1946 if(
Wow_U£_NARP
){

1947 
	`Ârötf
(
°dout
, " NARP On !! \n");

1949 
	`Ârötf
(
°dout
, " NARP Off !! \n");

1952 if(
åa˚fûe
 =
NULL
){

1953 
	`Ârötf
(
°dout
," c™nŸ o≥¿åa˚ fûê%s\n", 
¨gv
[4]);

1956 i‡(
	`°©
(
¨gv
[1], &
buf
) < 0)

1957 
	`∑nic
(
¨gv
[1]);

1965 
	`gí_sy¡h
();

1974 
Êush
 = 0;

1975 
rw
 = 0;

1977 
	`Œ_¸óã
(&
ªq_SSD_WQli°
);

1978 
	`Œ_¸óã
(&
ªq_HDD_RQli°
);

1979 
	`Œ_¸óã
(&
ªq_SSD_RQli°
);

1981 if(
	`iŸø˚_ascii_gë_i‹eq_evít
(
åa˚fûe
, &
ªq
Ë=
NULL
){

1984 if(
ªq
.
Êags
 & 
READ
){

1990 
rw
 = 
ªq
.
Êags
;

1992 
cou¡
 = 
ªq
.
bcou¡
 / 
BLOCK2SECTOR
;

1993 if(
ªq
.
bcou¡
 % 
BLOCK2SECTOR
){

1994 
cou¡
++;

2001 
wow_°age_cou¡
 +
	`Œ_gë_size
(
ªq_HDD_RQli°
);

2002 
	`wow_Êush_ªq_Qli°
(
DISK
, 
ªq_HDD_RQli°
, 
READ
);

2003 
	`wow_Êush_ªq_Qli°
(
SSD
, 
ªq_SSD_WQli°
, 
WRITE
);

2004 
	`wow_Êush_ªq_Qli°
(
SSD
, 
ªq_SSD_RQli°
, 
READ
);

2005 
	`Œ_ªÀa£
(
ªq_SSD_WQli°
);

2006 
	`Œ_ªÀa£
(
ªq_SSD_RQli°
);

2007 
	`Œ_ªÀa£
(
ªq_HDD_RQli°
);

2009 
debug_cou¡
++;

2010 if(
debug_cou¡
 == 125)

2011 
debug_cou¡
 = debug_count;

2014 
i
 = 0; i < 
cuºssd
->
∑øms
.
√Àmíts
; i ++) {

2015 
ssd_ñemít_°©
 *
°©
 = &(
cuºssd
->
ñemíts
[
i
].stat);

2016 
tŸÆ_îa£
 +
°©
->
num_˛ón
;

2019 
	`Ârötf
(
ouçutfûe
, "\n############### Syssim Result ################\n");

2020 
	`Ârötf
(
ouçutfûe
, "Syssim Executi⁄ Time = %f\n", 
now
);

2021 
	`Ârötf
(
ouçutfûe
, "Syssim TŸÆ Hô R©io = %f (%Œd/%Œd)\n",()
wow_hô
/()
wow_ªf
, wow_hit, wow_ref);

2022 
	`Ârötf
(
ouçutfûe
, "Syssim Ród Hô R©io = %f (%Œd/%Œd)\n",()
wow_ªad_hô
/()
wow_ªad_ªf
,wow_read_hit,wow_read_ref);

2023 
	`Ârötf
(
ouçutfûe
, "Syssim WrôêHô R©io = %f (%Œd/%Œd)\n",()
wow_wrôe_hô
/()
wow_wrôe_ªf
,wow_write_hit,wow_write_ref);

2024 
	`Ârötf
(
ouçutfûe
, "Syssim TŸÆ Eø£s = %Œd\n",
tŸÆ_îa£
);

2025 
	`Ârötf
(
ouçutfûe
, "Syssim De°agêCou¡ = %Œd\n", 
wow_de°age_cou¡
);

2026 
	`Ârötf
(
ouçutfûe
, "Syssim SègêCou¡ = %Œd\n", 
wow_°age_cou¡
);

2028 
	`Ârötf
(
ouçutfûe
, "Syssim W‹kög Së Sizê%.2fGB\n", ()
ws_cou¡_globÆ
*4/1024/1024);

2029 
	`Ârötf
(
ouçutfûe
, "Syssim Ref/WSS = %.3f\n", ()
wow_ªf
/
ws_cou¡_globÆ
);

2030 
	`Ârötf
(
ouçutfûe
, "\n");

2035 
	`disksim_öãrÁ˚_shutdown
(
disksim_öf
, 
now
);

2037 
	`¥öt_°©i°ics
(&
°
, "ÑesponseÅime");

2038 
	`¥ötf
(" Executi⁄Åimê%f\n", 
now
);

2039 
	`¥ötf
(" Simulation was successfully done\n");

2042 
	`wow_‰ì
();

2044 
	`Œ_ªÀa£
(
ªq_SSD_WQli°
);

2046 
	`f˛o£
(
åa˚fûe
);

2048 
	`exô
(0);

2049 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_wow_driver.h

32 #i‚de‡
_WOW_DRIVER_H


33 
	#_WOW_DRIVER_H


	)

34 
	~"disksim_öãrÁ˚.h
"

43 
	tSysTime
;

56 
	#BLOCK
 4096

	)

57 
	#SECTOR
 512

	)

58 
	#BLOCK2SECTOR
 (
BLOCK
/
SECTOR
)

	)

60 #ifde‡
__löux__


61 
	#MAX_REQ_BYTES
 (256*1024)

	)

63 
	#MAX_REQ_BYTES
 (128*1024)

	)

66 
	#MAX_STAGE_COUNT
 1024

	)

67 
	#MAX_DESTAGE_COUNT
 
MAX_STAGE_COUNT


	)

73 
	#CLEAN
 0

	)

74 
	#DIRTY
 1

	)

76 
	#SSD
 1

	)

77 
	#DISK
 0

	)

80 
	#NODE_NEXT
(
n
Ë{¿n->
√xt
;}

	)

81 
	#NODE_PREV
(
n
Ë{¿n->
¥ev
;}

	)

83 
	#WOW_HASH_NUM
 1024

	)

88 
	mdisk_blkno
;

89 
	mÊash_blkno
;

90 
	mdúty
;

91 
	mdñëed
;

92 }
	t∑ge_t
;

95 
	mªsidít
;

96 
	mª˚ncy
;

97 
	mgrou≤o
;

98 
	m∑gecou¡
;

99 
li°node
 *
	m∑ge_li°
;

100 
li°node
 *
	m∑ge_hash
[
WOW_HASH_NUM
];

101 }
	tgroup_t
;

105 
	mn
;

106 
	msum
;

107 
	msqr
;

108 } 
	tSèt
;

110 
ssd_t
 *
cuºssd
;

112 
ˇche_pﬁicy
;

113 
SysTime
 
RólTime
;

117 
wow_ª•⁄£_åackög
(
cuº_time
,

118 
ª•⁄£_ms
,

119 
°age
,

120 
de°age
,

121 
ssd_ªad
,

122 
ssd_wrôe
,

123 
gc_time
,

124 
s_tŸÆ
,

125 
s_sugge°ed_ªad
,

126 
s_sugge°ed_wrôe
,

127 
s_ªad
,

128 
s_wrôe
,

129 
ªad_hô
,

130 
wrôe_hô
,

131 
avg_ª•⁄£
);

134 
syssim_scheduÀ_ˇŒback
(
disksim_öãrÁ˚_ˇŒback_t
, 
SysTime
 
t
, *);

135 
syssim_ªp‹t_com∂ëi⁄
(
SysTime
 
t
, 
disksim_ªque°
 *
r
, *);

136 
syssim_descheduÀ_ˇŒback
(, *);

142 
wow_Êush_ªq_Qli°
(
devno
, 
li°node
 *
Qli°
, 
rw
);

143 
wow_ö£π_∑ge_to_ªqli°
(
li°node
 *
ªq_li°
, 
∑ge_t
 *
pg
, (*
comp_func
)(c⁄° *
a
,c⁄° *
b
));

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_global.h

101 #i‚de‡
DISKSIM_GLOBAL_H


102 
	#DISKSIM_GLOBAL_H


	)

104 
	~"disksim_ønd48.h
"

105 
	~"disksim_mÆloc.h
"

106 
	~"disksim_bô°rög.h
"

107 
	~"ölöe.h
"

109 
	~<sys/ty≥s.h
>

110 
	~<°dio.h
>

112 #ifde‡
_WIN32


113 
	#u_öt
 

	)

114 
	#u_öt64_t
 
__öt64


	)

118 #i‚de‡
_WIN32


119 
	#u_öt32_t
 

	)

120 
	#öt32_t
 

	)

122 
	#u_öt32_t
 

	)

123 
	#öt32_t
 

	)

126 #i‚de‡
_WIN32


127 
	#SUPPORT_CHECKPOINTS


	)

130 
	~<°dlib.h
>

131 
	~<°rög.h
>

132 
	~<m©h.h
>

133 
	~<time.h
>

135 
	#DISKSIM_time
(Ë
	`time
(
NULL
)

	)

137 #i‚de‡
MAXINT


138 
	#MAXINT
 0x7FFFFFFF

	)

141 
	~"disksim_as£πlib.h
"

143 #ifde‡
__˝lu•lus


145 
	tu_öt
;

148 
	#ALLOCSIZE
 8192

	)

150 #i‚de‡
TRUE


151 
	#TRUE
 1

	)

153 #i‚de‡
FALSE


154 
	#FALSE
 0

	)

157 
	#BITS_PER_INT_MASK
 0x0000001F

	)

158 
	#INV_BITS_PER_INT_MASK
 0xFFFFFFE0

	)

160 
	#_BIG_ENDIAN
 1

	)

161 
	#_LITTLE_ENDIAN
 2

	)

165 
	#ASCII
 1

	)

166 
	#HPL
 2

	)

167 
	#DEC
 3

	)

168 
	#VALIDATE
 4

	)

169 
	#RAW
 5

	)

170 
	#ATABUS
 6

	)

171 
	#IPEAK
 7

	)

172 
	#POSTGRES
 8

	)

173 
	#EMCSYMM
 9

	)

174 
	#EMCBACKEND
 10

	)

175 
	#BATCH
 11

	)

176 
	#DEFAULT
 
ASCII


	)

180 
	#MILLI
 1000

	)

181 
	#MICRO
 1000000

	)

182 
	#NANO
 1000000000

	)

184 
	#SECONDS_PER_MINUTE
 60

	)

185 
	#SECONDS_PER_HOUR
 3600

	)

186 
	#SECONDS_PER_DAY
 86400

	)

190 
	~"disksim_ªqÊags.h
"

192 
	#WRITE
 
DISKSIM_WRITE


	)

193 
	#READ
 
DISKSIM_READ


	)

194 
	#TIME_CRITICAL
 
DISKSIM_TIME_CRITICAL


	)

195 
	#TIME_LIMITED
 
DISKSIM_TIME_LIMITED


	)

196 
	#TIMED_OUT
 
DISKSIM_TIMED_OUT


	)

197 
	#HALF_OUT
 
DISKSIM_HALF_OUT


	)

198 
	#MAPPED
 
DISKSIM_MAPPED


	)

199 
	#READ_AFTR_WRITE
 
DISKSIM_READ_AFTR_WRITE


	)

200 
	#SYNCHRONOUS
 
DISKSIM_SYNC


	)

201 
	#ASYNCHRONOUS
 
DISKSIM_ASYNC


	)

202 
	#IO_FLAG_PAGEIO
 
DISKSIM_IO_FLAG_PAGEIO


	)

203 
	#SEQ
 
DISKSIM_SEQ


	)

204 
	#LOCAL
 
DISKSIM_LOCAL


	)

205 
	#BATCH_COMPLETE
 
DISKSIM_BATCH_COMPLETE


	)

209 
	#NULL_EVENT
 0

	)

210 
	#PF_MIN_EVENT
 1

	)

211 
	#PF_MAX_EVENT
 97

	)

212 
	#INTR_EVENT
 98

	)

213 
	#INTEND_EVENT
 99

	)

214 
	#IO_MIN_EVENT
 100

	)

218 
	#IO_MAX_EVENT
 122

219 
	#TIMER_EXPIRED
 123

	)

220 
	#CHECKPOINT
 124

	)

221 
	#STOP_SIM
 125

	)

222 
	#EXIT_DISKSIM
 126

	)

226 
	#IO_MAX_EVENT
 120

	)

227 
	#TIMER_EXPIRED
 121

	)

228 
	#CHECKPOINT
 122

	)

229 
	#STOP_SIM
 123

	)

230 
	#EXIT_DISKSIM
 124

	)

233 
	#MEMS_MIN_EVENT
 200

	)

234 
	#MEMS_MAX_EVENT
 220

	)

235 
	#SSD_MIN_EVENT
 300

	)

236 
	#SSD_MAX_EVENT
 320

	)

240 
	#CLOCK_INTERRUPT
 100

	)

241 
	#SUBCLOCK_INTERRUPT
 101

	)

242 
	#IO_INTERRUPT
 102

	)

243 
	#CPUSWAP_INTERRUPT
 103

	)

245 
	#MSECS_PER_MIN
 60000

	)

252 
	#DISKSIM_TIME_THRESHOLD
 0.0013

	)

255 
u_öt32_t
 
vÆue
;

256 
byã
[4];

257 } 
	tötch¨
;

259 
	#SèticAs£π
(
c
ËcË0: (c):

	)

261 
	sfoo
 {

262 
time
;

263 
ty≥
;

264 
ev
 *
√xt
;

265 
ev
 *
¥ev
;

266 
ãmp
;

267 } 
	tfoo
;

274 
	#DISKSIM_EVENT_SIZE
 200

275 
	#DISKSIM_EVENT_SPACESIZE
 (
DISKSIM_EVENT_SIZE
 - (
foo
))

	)

278 
	#FCL_EVENT_MAX
 6

	)

280 
	sev
 {

281 
time
;

282 
ty≥
;

283 
ev
 *
√xt
;

284 
ev
 *
¥ev
;

285 
ãmp
;

286 
•a˚
[
DISKSIM_EVENT_SPACESIZE
];

287 } 
	tevít
;

289 
	si‹eq_ev
 {

290 
time
;

291 
ty≥
;

292 
i‹eq_ev
 *
√xt
;

293 
i‹eq_ev
 *
¥ev
;

294 
bcou¡
;

295 
blkno
;

296 
u_öt
 
Êags
;

297 
u_öt
 
bu¢o
;

298 
u_öt
 
¶Ÿno
;

299 
devno
;

300 
›id
;

301 *
buf
;

302 
ˇu£
;

303 
ãmpöt1
;

304 
ãmpöt2
;

305 *
ãmµå1
;

306 *
ãmµå2
;

310 *
f˛_∑ª¡
;

311 
f˛_evít_num
;

312 
f˛_evít_±r
;

313 
f˛_evít_cou¡
[
FCL_EVENT_MAX
];

314 
i‹eq_ev
 *
f˛_evít_li°
[
FCL_EVENT_MAX
];

315 
i‹eq_ev
 *
f˛_evít_√xt
;

317 *
f˛_com∂ëe_li°
;

318 *
f˛_a˘ive_li°
;

319 *
f˛_öa˘ive_li°
;

320 *
f˛_≥ndög_li°
;

322 *
mems_¶ed
;

323 *
mems_ªqöfo
;

324 
ssd_ñem_num
;

325 
ssd_g™g_num
 ;

326 
°¨t_time
;

327 
b©chno
;

328 
b©ch_com∂ëe
;

329 
b©ch_size
;

330 
i‹eq_ev
 *
b©ch_√xt
;

331 
i‹eq_ev
 *
b©ch_¥ev
;

332 } 
	ti‹eq_evít
;

334 
	stimî_ev
 {

335 
time
;

336 
ty≥
;

337 
timî_ev
 *
√xt
;

338 
timî_ev
 *
¥ev
;

339 (**
func
)(
timî_ev
 *);

340 
vÆ
;

341 *
±r
;

342 } 
	ttimî_evít
;

344 
	söå_ev
 {

345 
time
;

346 
ty≥
;

347 
öå_ev
 * 
√xt
;

348 
öå_ev
 * 
¥ev
;

349 
ve˘‹
;

350 
ﬁd°©e
;

351 
Êags
;

352 
evít
 *
evíéi°
;

353 
evít
 *
öf›å
;

354 
ru¡ime
;

355 } 
	töå_evít
;

361 
ˇchìvít
;

362 
ioq
;

363 
iosim_öfo
;

364 
devi˚_öfo
;

365 
disk_öfo
;

366 
sim∂edisk_öfo
;

367 
mems_öfo
;

368 
iodrivî_öfo
;

369 
busöfo
;

370 
˘Ãöfo
;

371 
pf_öfo
;

372 
sy¡hio_öfo
;

373 
iŸø˚_öfo
;

374 
ønd48_öfo
;

376 
evít
*(*
	tdisksim_iod⁄e_nŸify_t
)(
	ti‹eq_evít
 *, *
	t˘x
);

378 
	sdisksim
 {

379 * 
°¨èddr
;

380 
tŸÆÀngth
;

381 
cuºoff£t
;

382 
tŸÆªqs
;

383 
˛o£dios
;

384 
˛o£dthöktime
;

385 
w¨mup_io˙t
;

386 
w¨mu±ime
;

387 
timî_evít
 *
w¨mup_evít
;

388 
simtime
;

389 
checkpoöt_dißbÀ
;

390 
checkpoöt_io˙t
;

391 
checkpoöt_öãrvÆ
;

392 
evít
 *
checkpoöt_evít
;

393 
åa˚f‹m©
;

394 
ídün
;

395 
åa˚ídün
;

396 
åa˚hódî
;

397 
iŸø˚
;

398 
sy¡hgí
;

399 
exã∫Æ_c⁄åﬁ
;

401 
disksim_iod⁄e_nŸify_t
 
exã∫Æ_io_d⁄e_nŸify
;

402 *
nŸify_˘x
;

404 
FILE
 * 
∑rfûe
;

405 
FILE
 * 
iŸø˚fûe
;

406 
FILE
 * 
°©deffûe
;

407 
FILE
 * 
ouçutfûe
;

408 
FILE
 * 
outios
;

409 
iŸø˚fûíame
[256];

410 
ouçutfûíame
[256];

411 
outiosfûíame
[256];

412 
checkpoötfûíame
[256];

413 
Âos_t
 
iŸø˚fûïosôi⁄
;

414 
Âos_t
 
ouçutfûïosôi⁄
;

415 
Âos_t
 
outiosfûïosôi⁄
;

416 
evít
 *
ötq
;

417 
evít
 *
ötqhöt
;

418 
evít
 *
exåaq
;

419 
ötqÀn
;

420 
exåaqÀn
;

421 
°›_sim
;

422 
£edvÆ
;

423 
œ°phy°ime
;

427 (*
issuefunc_˘Ãsm¨t
Ë(*, 
i‹eq_evít
 *);

428 
ioq
 * (*
queueföd_˘Ãsm¨t
) (*, );

429 (*
wakeupfunc_˘Ãsm¨t
Ë(*, 
ˇchìvít
 *);

430 (*
d⁄efunc_˘Ãsm¨t_ªad
Ë(*, 
i‹eq_evít
 *);

431 (*
d⁄efunc_˘Ãsm¨t_wrôe
)(*, 
i‹eq_evít
 *);

432 (*
d⁄efunc_ˇchemem_em±y
Ë(*, 
i‹eq_evít
 *);

433 (*
d⁄efunc_ˇchedev_em±y
Ë(*, 
i‹eq_evít
 *);

434 (*
idÀw‹k_ˇchemem
) (*, );

435 (*
idÀw‹k_ˇchedev
) (*, );

436 (*
c⁄ˇtok_ˇchemem
) (*, , , , );

437 (*
íabÀmít_disk
Ë(
i‹eq_evít
 *);

438 (*
timîfunc_disksim
Ë(
timî_evít
 *);

439 (*
timîfunc_ioqueue
Ë(
timî_evít
 *);

440 (*
timîfunc_ˇchemem
Ë(
timî_evít
 *);

441 (*
timîfunc_ˇchedev
Ë(
timî_evít
 *);

444 
iosim_öfo
 *iosim_info;

445 
devi˚_öfo
 *
devi˚öfo
;

446 
disk_öfo
 *
disköfo
;

447 
sim∂edisk_öfo
 *
sim∂edisköfo
;

448 
mems_öfo
 *
memsöfo
;

449 
ssd_öfo
 *
ssdöfo
;

450 
iodrivî_öfo
 *iodriver_info;

451 
busöfo
 *businfo;

452 
˘Ãöfo
 *ctlrinfo;

453 
pf_öfo
 *pf_info;

454 
sy¡hio_öfo
 *synthio_info;

455 
iŸø˚_öfo
 *iotrace_info;

456 
ønd48_öfo
 *rand48_info;

458 **
ovîrides
;

459 
ovîrides_Àn
;

460 
vîbosôy
;

462 
åa˚pùes
[2];

463 íum { 
DISKSIM_MASTER
, 
DISKSIM_SLAVE
, 
DISKSIM_NONE
 } 
åa˚_mode
;

465 
FILE
 *
exe˘ø˚
;

466 *
exe˘ø˚_‚
;

468 } 
	tdisksim_t
;

470 
disksim_t
 *
disksim
;

473 
	#w¨mu±ime
 (
disksim
->
w¨mu±ime
)

	)

474 
	#simtime
 (
disksim
->
simtime
)

	)

475 
	#°©deffûe
 (
disksim
->
°©deffûe
)

	)

476 
	#ouçutfûe
 (
disksim
->
ouçutfûe
)

	)

477 
	#outios
 (
disksim
->
outios
)

	)

480 #i‚de‡
_WIN32


481 
	#mö
(
x
,
y
Ë((xË< (yË? (xË: (y))

	)

483 
	#max
(
x
,
y
Ë((xË< (yË? (yË: (x))

	)

486 
	#wøp
(
x
,
y
Ë((yË< (xË? 1 : 0)

	)

488 
	#diff
(
x
,
y
Ë((xË< (yË? (y)-(xË: (x)-(y))

	)

490 
	#roundu±omu…
(
vÆ
,
mu…
Ë((vÆË+ ((mu…Ë- (((vÆ)-1Ë% (mu…))Ë- 1)

	)

493 
	#bzîo
(
±r
,
size
Ë
	`mem£t
’å,0,size)

	)

498 
öå_ªque°
(
evít
 *
cuº
);

499 
öå_acknowÀdge
 (
evít
 *
öåp
);

504 
ª£t°©s
 ();

505 
disksim_sim°›
 ();

506 
disksim_ªgi°î_checkpoöt
 (
©simtime
);

507 
INLINE
 
addt€xåaq
 (
evít
 *
ãmp
);

508 
addli°t€xåaq
 (
evít
 **
hód±r
);

509 
INLINE
 
evít
 * 
gë‰omexåaq
 ();

510 
evít
 * 
evít_c›y
 (evíà*
‹ig
);

511 
INLINE
 
addtoötq
 (
evít
 *
ãmp
);

512 
INLINE
 
ªmove‰omötq
 (
evít
 *
cuº
);

513 
sˇ≈¨am_öt
 (*
∑æöe
, *
∑∫ame
, *
∑Ωå
, 
∑rchecks
, 
∑rmövÆ
, 
∑rmaxvÆ
);

514 
gë∑øm_öt
 (
FILE
 *
∑rfûe
, *
∑∫ame
, *
∑Ωå
, 
∑rchecks
, 
∑rmövÆ
, 
∑rmaxvÆ
);

515 
gë∑øm_doubÀ
 (
FILE
 *
∑rfûe
, *
∑∫ame
, *
∑Ωå
, 
∑rchecks
, 
∑rmövÆ
, 
∑rmaxvÆ
);

516 
gë∑øm_boﬁ
 (
FILE
 *
∑rfûe
, *
∑∫ame
, *
∑Ωå
);

517 
evít
 * 
io_d⁄e_nŸify
 (
i‹eq_evít
 *
cuº
);

524 
disksim_öôülize_disksim_°ru˘uª
 (
disksim
 *);

525 
disksim_lﬂd∑øms
(*
öputfûe
, 
sy¡hgí
);

526 
disksim_£tup_disksim
 (
¨gc
, **
¨gv
);

527 
disksim_£t_exã∫Æ_io_d⁄e_nŸify
 (
disksim_iod⁄e_nŸify_t
);

528 
disksim_˛ónup_™d_¥öt°©s
 ();

529 
disksim_˛ón°©s
 ();

530 
disksim_¥öt°©s2
 ();

531 
disksim_simuœã_evít
 ();

532 
disksim_ª°‹e_‰om_checkpoöt
 (*
fûíame
);

533 
disksim_run_simuœti⁄
 ();

535 
disksim_¥öt°©s
();

538 
disksim_˛ónup
();

540 
disksim_exe˘ø˚
(*
fmt
,...);

543 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/disksim_hptrace.h

101 #i‚de‡
HPTRACE_H


102 
	#HPTRACE_H


	)

137 
	#HPL_UNKNOWN
 0

	)

138 
	#HPL_SHORTIO
 1

	)

139 
	#HPL_LONGIO
 2

	)

140 
	#HPL_TEXTIO
 3

	)

141 
	#HPL_SUSPECTIO
 4

	)

142 
	#HPL_BREADFS
 5

	)

143 
	#HPL_BREADAFS
 6

	)

144 
	#HPL_BREADAAFS
 7

	)

145 
	#HPL_BDWRITEFS
 8

	)

146 
	#HPL_BWRITEFS
 9

	)

147 
	#HPL_CREATE_OPENFS
 10

	)

164 
	#HPL_WRITE
 0x00000000

	)

165 
	#HPL_READ
 0x00000001

	)

166 
	#HPL_DONE
 0x00000002

	)

167 
	#HPL_ERROR
 0x00000004

	)

168 
	#HPL_BUSY
 0x00000008

	)

170 
	#HPL_PHYS
 0x00000010

	)

171 
	#HPL_END_OF_DATA
 0x00000020

	)

172 
	#HPL_WANTED
 0x00000040

	)

173 
	#HPL_NDELAY
 0x00000080

	)

175 
	#HPL_ASYNC
 0x00000100

	)

176 
	#HPL_DELWRITE
 0x00000200

	)

177 
	#HPL_ORDWRI
 0x00000400

	)

178 
	#HPL_REWRITE
 0x00000800

	)

180 
	#HPL_PRIVATE
 0x00001000

	)

181 
	#HPL_WRITEV
 0x00002000

	)

182 
	#HPL_PFTIMEOUT
 0x00004000

	)

183 
	#HPL_CACHE
 0x00008000

	)

185 
	#HPL_INVAL
 0x00010000

	)

186 
	#HPL_LOCKED
 0x00020000

	)

187 
	#HPL_HEAD
 0x00040000

	)

188 
	#HPL_FSYSIO
 0x00080000

	)

190 
	#HPL_BAD
 0x00100000

	)

191 
	#HPL_CALL
 0x00200000

	)

192 
	#HPL_DUX_REM_REQ
 0x00400000

	)

193 
	#HPL_NOCACHE
 0x00800000

	)

195 
	#HPL_SYNC
 0x01000000

	)

196 
	#HPL_RAW
 0x02000000

	)

197 
	#HPL_NETBUF
 0x04000000

	)

200 
u_öt32_t
 
	msize
;

201 
u_öt32_t
 
	mid
;

202 
u_öt32_t
 
	m£c
;

203 
u_öt32_t
 
	mu£c
;

204 } 
	th∂_ªc‹d_id
;

207 
h∂_ªc‹d_id
 
	mªc_id
;

208 
u_öt32_t
 
	m°¨t
;

209 
u_öt32_t
 
	m°›
;

210 
u_öt32_t
 
	msize
;

211 
u_öt32_t
 
	m£˘no
;

212 
u_öt32_t
 
	mdevno
;

213 
u_öt32_t
 
	mdrivîty≥
;

214 
u_öt32_t
 
	mcy o
;

215 
u_öt32_t
 
	mioÊags
;

216 
u_öt32_t
 
	möfo
;

217 
u_öt32_t
 
	mqueuñí
;

218 
u_öt32_t
 
	msusÊags
;

219 
	m•a˚
[4];

220 } 
	th∂_sh‹t_i‹ec_ki
;

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_interface.c

137 
	~"disksim_globÆ.h
"

138 
	~"disksim_ioÁ˚.h
"

139 
	~"disksim_öãrÁ˚.h
"

140 
	~"disksim_disk.h
"

142 
	~"c⁄fig.h
"

144 
	~"disksim_öãrÁ˚_¥iv©e.h
"

166 
evít
 *

167 
	$disksim_öãrÁ˚_io_d⁄e_nŸify
 (
i‹eq_evít
 *
cuº
, *
˘x
)

169 
disksim_öãrÁ˚
 *
iÁ˚
 = (disksim_öãrÁ˚ *)
˘x
;

170 
disksim_ªque°
 *
ªq
 = (disksim_ªque° *Ë
cuº
->
buf
;

173 
iÁ˚
->
	`com∂ëe_‚
(
simtime
, 
ªq
, iÁ˚->
˘x
);

175 
	}
}

179 
	$disksim_öãrÁ˚_öôülize_œãncy
 (
disksim_öãrÁ˚
 *
iÁ˚
,

180 c⁄° *
pfûe
,

181 c⁄° *
ofûe
,

182 
œãncy_weight
,

183 *
∑ømvÆ
,

184 *
∑øm«me
,

185 
sy¡hio
,

186 *
sched_Æg
,

187 
ovî_¨gc
,

188 **
ovî_¨gv
)

190 **
¨gv
;

191 
¨gc
 = 6;

192 
i
 = 
¨gc
;

194 
¨gc
 +
ovî_¨gc
;

198 
	`disksim_öôülize_disksim_°ru˘uª
(
iÁ˚
->
disksim
);

200 if(
œãncy_weight
) {

201 
¨gc
 += 12;

204 
¨gv
 = 
	`ˇŒoc
(
¨gc
, (*));

206 if(
œãncy_weight
){

210 
¨gv
[
i
++] = "driver*";

211 
¨gv
[
i
++] = 
∑øm«me
;

212 
¨gv
[
i
++] = 
∑ømvÆ
;

219 
¨gv
[
i
++] = "driver*";

220 
¨gv
[
i
++] = "Scheduler:SchedulingÖolicy";

221 
¨gv
[
i
++] = 
sched_Æg
;

223 
¨gv
[
i
++] = "driver*";

224 
¨gv
[
i
++] = "Scheduler:SchedulingÖriority scheme";

225 
¨gv
[
i
++] = 
sched_Æg
;

227 
¨gv
[
i
++] = "driver*";

228 
¨gv
[
i
++] = "Scheduler:Timeout scheduling";

229 
¨gv
[
i
++] = 
sched_Æg
;

232 
	`mem˝y
(
¨gv
 + 
i
, 
ovî_¨gv
, 
ovî_¨gc
 * (*));

234 
¨gv
[0] = "disksim";

235 
¨gv
[1] = (*Ë
pfûe
;

236 
¨gv
[2] = (*Ë
ofûe
;

237 
¨gv
[3] = "external";

238 
¨gv
[4] = "0";

239 if(
sy¡hio
 == 1){

240 
¨gv
[5] = "1";

242 
¨gv
[5] = "0";

244 
	`disksim_£tup_disksim
 (
¨gc
, 
¨gv
);

250 
	`disksim_£t_exã∫Æ_io_d⁄e_nŸify
(
disksim_öãrÁ˚_io_d⁄e_nŸify
);

255 
	}
}

259 
disksim_öãrÁ˚
 *

260 
	$disksim_öãrÁ˚_öôülize
 (c⁄° *
pfûe
,

261 c⁄° *
ofûe
,

262 
disksim_öãrÁ˚_com∂ëe_t
 
comp
,

263 
disksim_öãrÁ˚_sched_t
 
sched
,

264 
disksim_öãrÁ˚_desched_t
 
desched
,

265 *
˘x
,

266 
¨gc
,

267 **
¨gv
)

269 
disksim_öãrÁ˚
 *
iÁ˚
 = 
	`ˇŒoc
(1, (disksim_interface));

270 
	`ddbg_as£π
(
iÁ˚
 != 0);

272 
iÁ˚
->
com∂ëe_‚
 = 
comp
;

273 
iÁ˚
->
sched_‚
 = 
sched
;

274 
iÁ˚
->
desched_‚
 = 
desched
;

275 
iÁ˚
->
˘x
 = ctx;

276 
iÁ˚
->
disksim
 = 
	`ˇŒoc
(1, (disksim));

278 
disksim
 = 
iÁ˚
->disksim;

281 
	`disksim_öãrÁ˚_öôülize_œãncy
(
iÁ˚
,

282 
pfûe
,

283 
ofûe
,

285 
NULL
,

286 
NULL
,

288 
NULL
,

289 
¨gc
,

290 
¨gv
);

292 
disksim
->
nŸify_˘x
 = 
iÁ˚
;

294  
iÁ˚
;

295 
	}
}

302 
	$disksim_öãrÁ˚_shutdown
 (
disksim_öãrÁ˚
 *
iÁ˚
,

303 
syssimtime
)

305 
cuπime
 = 
syssimtime
;

307 
disksim
 = 
iÁ˚
->disksim;

311 i‡((
cuπime
 + 0.0001Ë< 
simtime
) {

312 
	`Ârötf
 (
°dîr
, "exã∫ÆÅimêi†ahód o‡disksimÅime: %‡> %f\n", 
cuπime
, 
simtime
);

313 
	`exô
(1);

316 
simtime
 = 
cuπime
;

317 
	`disksim_¥öt°©s
 ();

320 
	}
}

329 
	$disksim_öãrÁ˚_dump_°©s
 (
disksim_öãrÁ˚
 *
iÁ˚
,

330 
syssimtime
)

332 
cuπime
 = 
syssimtime
;

334 
disksim
 = 
iÁ˚
->disksim;

338 i‡((
disksim
->
ötq
Ë&& (disksim->ötq->
time
 < 
cuπime
) && ((disksim->intq->time + 0.0001) >= curtime)) {

339 
cuπime
 = 
disksim
->
ötq
->
time
;

341 i‡(((
cuπime
 + 0.0001Ë< 
simtime
)

342 || ((
disksim
->
ötq
)

343 && (
disksim
->
ötq
->
time
 < 
cuπime
)))

345 
	`Ârötf
 (
°dîr
, "exã∫ÆÅimêi†mism©ched wôh disksimÅime: %‡vs. %‡(%f)\n", 
cuπime
, 
simtime
, ((
disksim
->
ötq
Ë? disksim->ötq->
time
 : 0.0));

346 
	`exô
 (1);

349 
simtime
 = 
cuπime
;

350 
	`disksim_˛ón°©s
();

351 
	`disksim_¥öt°©s
();

354 
	}
}

357 
	gevít_cou¡
 = 0;

364 
	$disksim_öãrÁ˚_öã∫Æ_evít
 (
disksim_öãrÁ˚
 *
iÁ˚
,

365 
syssimtime
,

366 *
junk
)

368 
cuπime
 = 
syssimtime
;

369 
disksim
 = 
iÁ˚
->disksim;

378 i‡(
disksim
->
ötq
 !
NULL


379 && (
disksim
->
ötq
->
time
 + 0.0001Ë< 
cuπime
)

381 
	`Ârötf
 (
°dîr
, "exã∫ÆÅimêi†ahód o‡disksimÅime: %‡> %f\n", 
cuπime
, 
disksim
->
ötq
->
time
);

382 
	`exô
 (1);

388 if(
disksim
->
ötq
 !
NULL
){

389 
	`ASSERT
 (
disksim
->
ötq
->
time
 >
simtime
);

392 (
disksim
->
ötq
 !
NULL
)

393 && (
disksim
->
ötq
->
time
 <(
cuπime
 + 0.0001)))

398 
	`disksim_simuœã_evít
(
evít_cou¡
++);

401 i‡(
disksim
->
ötq
 !
NULL
) {

406 
iÁ˚
->
	`sched_‚
(
disksim_öãrÁ˚_öã∫Æ_evít
,

407 
disksim
->
ötq
->
time
,

408 
iÁ˚
->
˘x
);

412 
	}
}

422 
	$disksim_öãrÁ˚_ªque°_¨rive
 (
disksim_öãrÁ˚
 *
iÁ˚
,

423 
syssimtime
,

424 
disksim_ªque°
 *
ªque°desc
)

426 
i‹eq_evít
 *
√w
;

428 
cuπime
 = 
syssimtime
;

429 
disksim
 = 
iÁ˚
->disksim;

431 
√w
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

433 
	`as£π
 (
√w
 !
NULL
);

434 
√w
->
ty≥
 = 
IO_REQUEST_ARRIVE
;

435 
√w
->
time
 = 
cuπime
;

436 
√w
->
bu¢o
 = 0;

437 
√w
->
devno
 = 
ªque°desc
->devno;

438 
√w
->
blkno
 = 
ªque°desc
->blkno;

439 
√w
->
Êags
 = 
ªque°desc
->flags;

440 
√w
->
bcou¡
 = 
ªque°desc
->
byãcou¡
 / 512;

441 
√w
->
b©chno
 = 
ªque°desc
->batchno;

442 
√w
->
b©ch_com∂ëe
 = 
ªque°desc
->batch_complete;

444 
√w
->
Êags
 |
TIME_CRITICAL
;

446 
√w
->
ˇu£
 = 0;

447 
√w
->
›id
 = 0;

448 
√w
->
buf
 = 
ªque°desc
;

450 
	`io_m≠_åa˚_ªque°
 (
√w
);

453 i‡(
disksim
->
ötq
) {

454 
iÁ˚
->
	`desched_‚
(0.0, iÁ˚->
˘x
);

456 
	`addtoötq
 ((
evít
 *)
√w
);

459 (
disksim
->
ötq
 !
NULL
)

460 && (
disksim
->
ötq
->
time
 <(
cuπime
 + 0.0001)))

462 
	`disksim_simuœã_evít
 (
evít_cou¡
++);

465 i‡(
disksim
->
ötq
) {

470 
iÁ˚
->
	`sched_‚
(
disksim_öãrÁ˚_öã∫Æ_evít
,

471 
disksim
->
ötq
->
time
,

472 
iÁ˚
->
˘x
);

474 
	}
}

479 
	$disksim_‰ì_disksim
(
disksim_öãrÁ˚
 *
iÁ˚
) {

480 
	`disksim_˛ónup
();

481 
	`‰ì
(
iÁ˚
->
disksim
);

482 
	`‰ì
(
iÁ˚
);

483 
	}
}

485 
	$disksim_time_to_m£c
(
x
Ë{  x; 
	}
}

486 
	$disksim_time_‰om_m£c
(
x
Ë{  x; 
	}
}

488 
dm_disk_if
 *

489 
	$disksim_gëdiskmodñ
(
disksim_öãrÁ˚
 *
i
, 
disknum
)

491  
i
->
disksim
->
disköfo
->
disks
[
disknum
]->
modñ
;

492 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_interface.h

32 #i‚de‡
_DISKSIM_INTERFACE_H


33 
	#_DISKSIM_INTERFACE_H


	)

35 #ifde‡
__˝lu•lus


41 
	~"disksim_ªqÊags.h
"

44 
	sdisksim_ªque°
 {

45 
Êags
;

46 
devno
;

47 
blkno
;

48 
byãcou¡
;

49 
°¨t
;

50 
b©chno
;

51 
b©ch_com∂ëe
;

52 *
ªq˘x
;

55 
disksim_öãrÁ˚
;

58 (*
disksim_öãrÁ˚_com∂ëe_t
)(
	ttime
,

59 
	tdisksim_ªque°
 *,

60 *
	t˘x
);

63 (*
disksim_öãrÁ˚_ˇŒback_t
)(
	tdisksim_öãrÁ˚
 *,

64 
	tt
,

65 *
	t˘x
);

70 (*
disksim_öãrÁ˚_sched_t
)(
	tdisksim_öãrÁ˚_ˇŒback_t
 
	t‚
,

72 *
	t˘x
);

75 (*
disksim_öãrÁ˚_desched_t
)(
	tt
, *
	t˘x
);

82 
disksim_öãrÁ˚
 *

83 
disksim_öãrÁ˚_öôülize
 (c⁄° *
pfûe
,

84 c⁄° *
ofûe
,

85 
disksim_öãrÁ˚_com∂ëe_t
,

86 
disksim_öãrÁ˚_sched_t
,

87 
disksim_öãrÁ˚_desched_t
,

88 *
˘x
,

89 
¨gc
,

90 **
¨gv
);

94 
disksim_öãrÁ˚_shutdown
 (
disksim_öãrÁ˚
 *,

95 
syssimtime
);

97 
disksim_öãrÁ˚_dump_°©s
 (
disksim_öãrÁ˚
 *,

98 
syssimtime
);

103 
disksim_öãrÁ˚_öã∫Æ_evít
 (
disksim_öãrÁ˚
 *,

104 
t
,

105 *
junk
);

109 
disksim_öãrÁ˚_ªque°_¨rive
 (
disksim_öãrÁ˚
 *,

110 
syssimtime
,

111 
disksim_ªque°
 *
ªque°desc
);

114 
disksim_‰ì_disksim
(
disksim_öãrÁ˚
 *
d
);

118 
disksim_time_to_m£c
();

119 
disksim_time_‰om_m£c
();

122 
dm_disk_if
 *

123 
disksim_gëdiskmodñ
(
disksim_öãrÁ˚
 *, );

125 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/disksim_interface_private.h

32 #i‚de‡
_DISKSIM_INTERFACE_PRIVATE_H


33 
	#_DISKSIM_INTERFACE_PRIVATE_H


	)

35 
	~"disksim_globÆ.h
"

36 
	~"disksim_öãrÁ˚.h
"

40 
	sdisksim_öãrÁ˚
 {

41 
disksim
 *
	mdisksim
;

42 
disksim_öãrÁ˚_com∂ëe_t
 
	mcom∂ëe_‚
;

43 
disksim_öãrÁ˚_sched_t
 
	msched_‚
;

44 
disksim_öãrÁ˚_desched_t
 
	mdesched_‚
;

45 *
	m˘x
;

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_intr.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_ioÁ˚.h
"

103 
	~"disksim_pfÁ˚.h
"

106 
	$öå_ªque°
 (
evít
 *
cuº
)

108 
öå_evít
 *
öåp
;

110 
	`SèticAs£π
 ((
öå_evít
Ë<
DISKSIM_EVENT_SIZE
);

111 i‡(
cuº
->
ty≥
 !
IO_INTERRUPT
) {

112 
	`io_ˇtch_°øy_evíts
((
i‹eq_evít
 *Ë
cuº
);

115 
öåp
 = (
öå_evít
 *Ë
	`gë‰omexåaq
();

116 
öåp
->
öf›å
 = 
cuº
;

117 
öåp
->
time
 = 
simtime
 + 
cuº
->time;

118 
öåp
->
ty≥
 = 
INTR_EVENT
;

119 
öåp
->
ve˘‹
 = 
cuº
->
ty≥
;

120 
öåp
->
evíéi°
 = 
NULL
;

121 
	`addtoötq
((
evít
 *)
öåp
);

122 
	}
}

125 
	$öå_acknowÀdge
 (
evít
 *
öåp
)

127 i‡(
disksim
->
sy¡hgí
) {

128 
	`pf_h™dÀ_öå_evít
 ((
öå_evít
 *)
öåp
, 0);

130 
	`io_öãºu±_¨rive
 ((
i‹eq_evít
 *)
öåp
);

132 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_iodriver.c

102 
	~"disksim_globÆ.h
"

103 
	~"disksim_°©.h
"

104 
	~"disksim_iosim.h
"

105 
	~"disksim_iŸø˚.h
"

106 
	~"disksim_iodrivî.h
"

107 
	~"disksim_log‹g.h
"

108 
	~"disksim_‹gÁ˚.h
"

109 
	~"disksim_ioqueue.h
"

110 
	~"disksim_bus.h
"

111 
	~"disksim_c⁄åﬁÀr.h
"

112 
	~"c⁄fig.h
"

114 
	~"moduÀs/moduÀs.h
"

117 *
	g°©desc_em±yqueue
 = "Empty queue delay";

118 *
	g°©desc_öôüã√xt
 = "InitiateÇext delay";

121 
iodrivî
 *
	$gëiodrivîby«me
(*
«me
, *
num
) {

122 
c
;

123 if(!
disksim
->
iodrivî_öfo
)  0;

125 
c
 = 0; c < 
numiodrivîs
; c++) {

126 if(
iodrivîs
[
c
])

127 if(!
	`°rcmp
(
iodrivîs
[
c
]->
«me
,Çame)) {

128 if(
num
Ë*num = 
c
;

129  
iodrivîs
[
c
];

134 
	}
}

137 
	$iodrivî_£nd_evít_down_∑th
 (
i‹eq_evít
 *
cuº
)

139 
ötch¨
 
bu¢o
;

140 
ötch¨
 
¶Ÿno
;

142 
bu¢o
.
vÆue
 = 
cuº
->busno;

143 
¶Ÿno
.
vÆue
 = 
cuº
->slotno;

144 
¶Ÿno
.
byã
[0] = slotno.byte[0] & 0x0F;

148 
	`bus_dñivî_evít
(
bu¢o
.
byã
[0], 
¶Ÿno
.byã[0], 
cuº
);

149 
	}
}

152 
	$iodrivî_øi£_¥i‹ôy
 (
iodrivîno
, 
›id
, 
devno
, 
blkno
, *
ch™
)

154 
	`log‹g_øi£_¥i‹ôy
(
sys‹gs
, 
numsys‹gs
, 
›id
, 
devno
, 
blkno
, 
ch™
);

156 
	}
}

159 
	$scheduÀ_disk_ac˚ss
 (
iodrivî
 *
cuºiodrivî
, 
i‹eq_evít
 *
cuº
)

161 
queue˘Ã
 = 
cuºiodrivî
->
devi˚s
[(
cuº
->
devno
)].queuectlr;

162 i‡(
queue˘Ã
 != -1) {

163 
cuºiodrivî
->
˘Ãs
[
queue˘Ã
].
numout°™dög
++;

165 
cuºiodrivî
->
devi˚s
[(
cuº
->
devno
)].
busy
 = 
TRUE
;

166 
	}
}

169 
	$check_£nd_out_ªque°
 (
iodrivî
 *
cuºiodrivî
, 
devno
)

171 
numout
;

173 i‡((
cuºiodrivî
->
c⁄°time
 =
IODRIVER_TRACED_QUEUE_TIMES
Ë|| (cuºiodrivî->c⁄°timê=
IODRIVER_TRACED_BOTH_TIMES
)) {

174 (
FALSE
);

176 
numout
 = 
	`ioqueue_gë_ªqout°™dög
(
cuºiodrivî
->
devi˚s
[
devno
].
queue
);

177 i‡(
cuºiodrivî
->
u£queue
 =
TRUE
) {

178 
queue˘Ã
 = 
cuºiodrivî
->
devi˚s
[
devno
].queuectlr;

179 i‡(
queue˘Ã
 != -1) {

180 
numout
 = 
cuºiodrivî
->
˘Ãs
[
queue˘Ã
].
numout°™dög
;

184 (
numout
 < 
cuºiodrivî
->
˘Ãs
[
queue˘Ã
].
maxout°™dög
);

186 (
numout
 < 
cuºiodrivî
->
devi˚s
[
devno
].
maxout°™dög
);

189 (!
numout
);

191 
	}
}

194 
i‹eq_evít
 * 
	$h™dÀ_√w_ªque°
 (
iodrivî
 *
cuºiodrivî
, 
i‹eq_evít
 *
cuº
)

196 
ioq
 *
queue
 = 
cuºiodrivî
->
devi˚s
[(
cuº
->
devno
)].queue;

197 
i‹eq_evít
 *
ªt
 = 
NULL
;

206 
	`ioqueue_add_√w_ªque°
(
queue
, 
cuº
);

207 i‡(
	`check_£nd_out_ªque°
(
cuºiodrivî
, 
cuº
->
devno
)) {

211 
ªt
 = 
	`ioqueue_gë_√xt_ªque°
(
queue
);

212 i‡(
ªt
 !
NULL
) {

213 
	`scheduÀ_disk_ac˚ss
(
cuºiodrivî
, 
ªt
);

214 
ªt
->
time
 = 
IODRIVER_IMMEDSCHED_TIME
 * 
cuºiodrivî
->
sˇÀ
;

217 (
ªt
);

218 
	}
}

221 
	$iodrivî_scheduÀ
 (
iodrivîno
, 
i‹eq_evít
 *
cuº
)

223 
˘Ã
 *
˘l
;

227 
	`ASSERT1
(
cuº
->
ty≥
 =
IO_ACCESS_ARRIVE
, "curr->type", curr->type);

229 i‡((
iodrivîs
[
iodrivîno
]->
c⁄°time
 != 0.0)

230 && (
iodrivîs
[
iodrivîno
]->
c⁄°time
 !
IODRIVER_TRACED_QUEUE_TIMES
))

232 
cuº
->
ty≥
 = 
IO_INTERRUPT
;

233 i‡(
iodrivîs
[
iodrivîno
]->
c⁄°time
 > 0.0) {

234 
cuº
->
time
 = 
iodrivîs
[
iodrivîno
]->
c⁄°time
;

237 
cuº
->
time
 = ((Ëcuº->
ãmpöt2
 / () 1000);

239 
cuº
->
ˇu£
 = 
COMPLETION
;

244 
	`Ârötf
 ( 
°dout
, " intrÑequest .. \n");

246 
	`öå_ªque°
((
evít
 *Ë
cuº
);

250 
˘l
 = 
iodrivîs
[
iodrivîno
]->
devi˚s
[(
cuº
->
devno
)].ctl;

252 i‡((
˘l
Ë&& (˘l->
Êags
 & 
DRIVER_C700
)) {

253 i‡((
˘l
->
≥ndio
)

254 && ((
cuº
->
devno
 !
˘l
->
≥ndio
->
√xt
->devno)

255 || (
cuº
->
›id
 !
˘l
->
≥ndio
->
√xt
->opid)

256 || (
cuº
->
blkno
 !
˘l
->
≥ndio
->
√xt
->blkno)))

258 
cuº
->
√xt
 = 
˘l
->
≥ndio
->next;

259 
˘l
->
≥ndio
->
√xt
 = 
cuº
;

260 
˘l
->
≥ndio
 = 
cuº
;

263 i‡(
˘l
->
≥ndio
 =
NULL
) {

264 
˘l
->
≥ndio
 = 
	`i‹eq_c›y
(
cuº
);

265 
˘l
->
≥ndio
->
√xt
 = ctl->pendio;

267 i‡(
˘l
->
Êags
 & 
DRIVER_CTLR_BUSY
) {

268 
	`addt€xåaq
((
evít
 *Ë
cuº
);

272 
cuº
->
bu¢o
 = 
iodrivîs
[
iodrivîno
]->
devi˚s
[(cuº->
devno
)].
bu•©h
.
vÆue
;

273 
cuº
->
¶Ÿno
 = 
iodrivîs
[
iodrivîno
]->
devi˚s
[(cuº->
devno
)].
¶Ÿ∑th
.
vÆue
;

274 i‡(
iodrivîs
[
iodrivîno
]->
devi˚s
[(
cuº
->
devno
)].
queue˘Ã
 != -1) {

275 
˘Ãno
 = 
iodrivîs
[
iodrivîno
]->
devi˚s
[(
cuº
->
devno
)].
queue˘Ã
;

276 
˘l
 = &
iodrivîs
[
iodrivîno
]->
˘Ãs
[
˘Ãno
];

277 i‡((
˘l
->
maxªqsize
Ë&& (
cuº
->
bcou¡
 > ctl->maxreqsize)) {

278 
i‹eq_evít
 *
tŸÆªq
 = 
	`i‹eq_c›y
(
cuº
);

282 
cuº
->
bcou¡
 = 
˘l
->
maxªqsize
;

283 i‡(
˘l
->
ovîsized
) {

284 
tŸÆªq
->
√xt
 = 
˘l
->
ovîsized
->next;

285 
˘l
->
ovîsized
->
√xt
 = 
tŸÆªq
;

287 
tŸÆªq
->
√xt
 =Åotalreq;

288 
˘l
->
ovîsized
 = 
tŸÆªq
;

292 
	`iodrivî_£nd_evít_down_∑th
(
cuº
);

296 
	}
}

299 
	$upd©e_iodrivî_°©i°ics
()

301 
	}
}

304 
	$iodrivî_check_c700_ba£d_°©us
 (
iodrivî
 *
cuºiodrivî
, 
devno
, 
ˇu£
, 
ty≥
, 
blkno
)

306 
˘Ã
 *
˘l
;

307 
i‹eq_evít
 *
tmp
;

309 
˘l
 = 
cuºiodrivî
->
devi˚s
[
devno
].ctl;

310 i‡((
˘l
 =
NULL
Ë|| (!(˘l->
Êags
 & 
DRIVER_C700
))) {

313 i‡(
ty≥
 =
IO_INTERRUPT_ARRIVE
) {

314 i‡(
˘l
->
≥ndio
 !
NULL
) {

315 
tmp
 = 
˘l
->
≥ndio
->
√xt
;

316 i‡((
tmp
->
devno
 =devnoË&& (tmp->
blkno
 == blkno)) {

317 i‡(
˘l
->
≥ndio
 =
tmp
) {

318 
˘l
->
≥ndio
 = 
NULL
;

320 
˘l
->
≥ndio
->
√xt
 = 
tmp
->next;

322 
	`addt€xåaq
((
evít
 *Ë
tmp
);

325 
ˇu£
) {

326 
COMPLETION
:

327 
DISCONNECT
:

328 
RECONNECT
:

329 
READY_TO_TRANSFER
:

330 
˘l
->
Êags
 |
DRIVER_CTLR_BUSY
;

333 
	`Ârötf
(
°dîr
, "Unknow¿öãºu± cau£áàiodrivî_check_c700_ba£d_°©u†- cau£ %d\n", 
ˇu£
);

334 
	`exô
(1);

337 
ˇu£
) {

338 
COMPLETION
:

339 
DISCONNECT
:

340 
˘l
->
Êags
 &~
DRIVER_CTLR_BUSY
;

341 i‡(
˘l
->
≥ndio
 !
NULL
) {

342 
tmp
 = 
	`i‹eq_c›y
(
˘l
->
≥ndio
->
√xt
);

343 
tmp
->
time
 = 
simtime
;

344 
	`addtoötq
((
evít
 *Ë
tmp
);

347 
RECONNECT
:

348 
READY_TO_TRANSFER
:

349 
˘l
->
Êags
 |
DRIVER_CTLR_BUSY
;

352 
	`Ârötf
(
°dîr
, "Unknow¿öãºu± cau£áàiodrivî_check_c700_ba£d_°©u†- cau£ %d\n", 
ˇu£
);

353 
	`exô
(1);

356 
	}
}

361 
	$iodrivî_add_to_öåp_evíéi°
 (
öå_evít
 *
öåp
, 
evít
 *
cuº
, 
sˇÀ
)

363 i‡(
cuº
) {

364 
evít
 *
tmp
 = 
öåp
->
evíéi°
;

365 
œ°ty≥
 = 
cuº
->
ty≥
;

366 
öåp
->
evíéi°
 = 
cuº
;

367 i‡(
cuº
->
ty≥
 =
IO_ACCESS_ARRIVE
) {

368 
cuº
->
time
 = 
IODRIVER_COMPLETION_RESPTOSCHED_TIME
;

369 } i‡(
cuº
->
ty≥
 =
IO_REQUEST_ARRIVE
) {

370 
cuº
->
time
 = 
IODRIVER_COMPLETION_RESPTOREQ_TIME
;

372 
cuº
->
time
 = 
IODRIVER_COMPLETION_RESPTOWAKEUP_TIME
;

374 
cuº
->
time
 *
sˇÀ
;

375 
cuº
->
√xt
) {

376 
cuº
 = cuº->
√xt
;

377 
cuº
->
time
 = 0.0;

379 
cuº
->
√xt
 = 
tmp
;

380 i‡(
œ°ty≥
 !
IO_REQUEST_ARRIVE
) {

381 
tmp
) {

382 i‡(
tmp
->
ty≥
 =
INTEND_EVENT
) {

383 
	`ASSERT
(
tmp
->
√xt
 =
NULL
);

384 
tmp
->
time
 = (
œ°ty≥
 =
IO_ACCESS_ARRIVE
Ë? 
IODRIVER_COMPLETION_SCHEDTOEND_TIME
 : 
IODRIVER_COMPLETION_WAKEUPTOEND_TIME
;

385 
tmp
->
time
 *
sˇÀ
;

386 } i‡(
tmp
->
ty≥
 !
IO_REQUEST_ARRIVE
) {

387 
tmp
->
time
 = (
œ°ty≥
 =
IO_ACCESS_ARRIVE
Ë? 
IODRIVER_COMPLETION_SCHEDTOWAKEUP_TIME
 : 0.0;

388 
œ°ty≥
 = 
tmp
->
ty≥
;

389 
tmp
->
time
 *
sˇÀ
;

391 
tmp
 =Åmp->
√xt
;

395 
	}
}

398 
	$iodrivî_ac˚ss_com∂ëe
 (
iodrivîno
, 
öå_evít
 *
öåp
)

400 
i
;

401 
numªqs
;

402 
i‹eq_evít
 *
tmp
;

403 
i‹eq_evít
 *
dñ
;

404 
i‹eq_evít
 *
ªq
;

405 
devno
;

406 
skù
 = 0;

407 
˘Ã
 *
˘l
 = 
NULL
;

409 i‡(
iodrivîs
[
iodrivîno
]->
ty≥
 =
STANDALONE
) {

410 
ªq
 = 
	`i‹eq_c›y
((
i‹eq_evít
 *Ë
öåp
->
öf›å
);

413 
ªq
 = (
i‹eq_evít
 *Ë
öåp
->
öf›å
;

417 
	`disksim_exe˘ø˚
("Request completion: simtime %f, devno %d, blkno %d,Åime %f\n",

418 
simtime
, 
ªq
->
devno
,Ñeq->
blkno
);

420 i‡(
iodrivîs
[
iodrivîno
]->
devi˚s
[(
ªq
->
devno
)].
queue˘Ã
 != -1)

422 
˘Ãno
 = 
iodrivîs
[
iodrivîno
]->
devi˚s
[(
ªq
->
devno
)].
queue˘Ã
;

423 
˘l
 = &
iodrivîs
[
iodrivîno
]->
˘Ãs
[
˘Ãno
];

424 
tmp
 = 
˘l
->
ovîsized
;

425 
numªqs
 = 1;

428 ((
numªqs
Ë|| (
tmp
 !
˘l
->
ovîsized
))

429 && (
tmp
)

430 && (
tmp
->
√xt
)

431 && ((
tmp
->
√xt
->
devno
 !
ªq
->devno)

432 || (
tmp
->
√xt
->
›id
 !
ªq
->opid)

433 || (
ªq
->
blkno
 < 
tmp
->
√xt
->blkno)

434 || (
ªq
->
blkno
 >(
tmp
->
√xt
->blknÿ+Åmp->√xt->
bcou¡
))))

439 
numªqs
 = 0;

440 
tmp
 =Åmp->
√xt
;

444 i‡((
tmp
)

445 && (
tmp
->
√xt
->
devno
 =
ªq
->devno)

446 && (
tmp
->
√xt
->
›id
 =
ªq
->opid)

447 && (
ªq
->
blkno
 >
tmp
->
√xt
->blkno)

448 && (
ªq
->
blkno
 < (
tmp
->
√xt
->blknÿ+Åmp->√xt->
bcou¡
)))

450 
	`Ârötf
 (
ouçutfûe
, "%f,Ö¨ào‡ovîsizedÑeque° com∂ëed: opid %d, blknÿ%d, bcou¡ %d, maxªqsizê%d\n", 
simtime
, 
ªq
->
›id
,Ñeq->
blkno
,Ñeq->
bcou¡
, 
˘l
->
maxªqsize
);

452 i‡((
ªq
->
blkno
 + 
˘l
->
maxªqsize
Ë< (
tmp
->
√xt
->blknÿ+Åmp->√xt->
bcou¡
))

454 
	`Ârötf
 (
ouçutfûe
, "moreÅo go\n");

455 
ªq
->
blkno
 +
˘l
->
maxªqsize
;

456 
ªq
->
bcou¡
 = 
	`mö
(
˘l
->
maxªqsize
,

457 (
tmp
->
√xt
->
blkno
 +Åmp->√xt->
bcou¡
 - 
ªq
->blkno));

458 
scheduÀ_√xt
;

461 
	`Ârötf
 (
ouçutfûe
, "done forÑeal\n");

463 
	`addt€xåaq
((
evít
 *Ë
ªq
);

464 
ªq
 = 
tmp
->
√xt
;

465 
tmp
->
√xt
 =Åmp->next->next;

467 i‡(
˘l
->
ovîsized
 =
ªq
) {

468 
˘l
->
ovîsized
 = (
ªq
 !ªq->
√xt
Ë?Ñeq->√xà: 
NULL
;

471 
ªq
->
√xt
 = 
NULL
;

479 
devno
 = 
ªq
->devno;

480 
ªq
 = 
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
iodrivîs
[
iodrivîno
]->
devi˚s
[
devno
].
queue
,Ñeq);

482 i‡(
˘l
) {

483 
˘l
->
numout°™dög
--;

487 i‡(
disksim
->
åa˚f‹m©
 =
VALIDATE
) {

488 
tmp
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

489 
	`io_vÆid©e_do_°©s1
();

490 
tmp
 = 
	`iŸø˚_vÆid©e_gë_i‹eq_evít
(
disksim
->
iŸø˚fûe
,Åmp);

491 i‡(
tmp
) {

492 
	`io_vÆid©e_do_°©s2
(
tmp
);

493 
tmp
->
ty≥
 = 
IO_REQUEST_ARRIVE
;

494 
	`addtoötq
((
evít
 *Ë
tmp
);

496 
	`disksim_exe˘ø˚
("Request issue: simtime %f, devno %d, blkno %d,Åime %f\n",

497 
simtime
, 
tmp
->
devno
,Åmp->
blkno
,Åmp->
time
);

500 
	`disksim_sim°›
();

503 i‡(
disksim
->
˛o£dios
) {

504 
tmp
 = (
i‹eq_evít
 *Ë
	`io_gë_√xt_exã∫Æ_evít
(
disksim
->
iŸø˚fûe
);

505 i‡(
tmp
) {

506 
	`io_usög_exã∫Æ_evít
 ((
evít
 *)
tmp
);

507 
tmp
->
time
 = 
simtime
 + 
disksim
->
˛o£dthöktime
;

508 
tmp
->
ty≥
 = 
IO_REQUEST_ARRIVE
;

509 
	`addtoötq
((
evít
 *Ë
tmp
);

511 
	`disksim_sim°›
();

517 
ªq
) {

518 
tmp
 = 
ªq
;

519 
ªq
 =Ñeq->
√xt
;

520 
tmp
->
√xt
 = 
NULL
;

521 
	`upd©e_iodrivî_°©i°ics
();

522 i‡((
numªqs
 = 
	`log‹g_m≠com∂ëe
(
sys‹gs
, 
numsys‹gs
, 
tmp
)Ë=
COMPLETE
) {

528 
i‹eq_evít
 *
ãmp
 = 
	`ioqueue_gë_•ecific_ªque°
 (
ovîÆlqueue
, 
tmp
);

529 
i‹eq_evít
 *
ãmp2
 = 
	`ioqueue_physiˇl_ac˚ss_d⁄e
 (
ovîÆlqueue
, 
ãmp
);

530 
	`ASSERT
 (
ãmp2
 !
NULL
);

532 i‡–
ãmp
->
devno
 == 0 ) {

533 
	`Ârötf
 ( 
°dout
, " Removêqueuêblknÿ%d, %∞\n", 
ãmp
->
blkno
,Åemp);

538 
ãmp
->
ty≥
 = 
IO_ACCESS_COMPLETE2
;

539 
	`addtoötq
((
evít
 *)
ãmp
);

541 
	`addt€xåaq
((
evít
 *)
ãmp
);

546 i‡(
iodrivîs
[
iodrivîno
]->
ty≥
 !
STANDALONE
) {

547 
	`iodrivî_add_to_öåp_evíéi°
(
öåp
,

548 
	`io_d⁄e_nŸify
(
tmp
),

549 
iodrivîs
[
iodrivîno
]->
sˇÀ
);

551 
	`io_d⁄e_nŸify
 (
tmp
);

554 i‡(
numªqs
 > 0) {

555 
i
 = 0; i < 
numªqs
; i++) {

556 
dñ
 = 
tmp
->
√xt
;

557 
tmp
->
√xt
 = 
dñ
->next;

558 
dñ
->
√xt
 = 
NULL
;

559 
dñ
->
ty≥
 = 
IO_REQUEST_ARRIVE
;

560 
dñ
->
Êags
 |
MAPPED
;

561 
skù
 |(
dñ
->
devno
 == devno);

563 i‡(
iodrivîs
[
iodrivîno
]->
ty≥
 =
STANDALONE
)

565 
dñ
->
time
 +
simtime
 + 0.0000000001;

566 
	`addtoötq
((
evít
 *Ë
dñ
);

569 
	`iodrivî_add_to_öåp_evíéi°
(
öåp
,

570 (
evít
 *Ë
dñ
,

571 
iodrivîs
[
iodrivîno
]->
sˇÀ
);

575 
	`addt€xåaq
((
evít
 *Ë
tmp
);

578 i‡((
iodrivîs
[
iodrivîno
]->
c⁄°time
 =
IODRIVER_TRACED_QUEUE_TIMES
)

579 || (
iodrivîs
[
iodrivîno
]->
c⁄°time
 =
IODRIVER_TRACED_BOTH_TIMES
))

581 i‡(
	`ioqueue_gë_numbî_ö_queue
(
iodrivîs
[
iodrivîno
]->
devi˚s
[
devno
].
queue
) > 0)

583 
iodrivîs
[
iodrivîno
]->
devi˚s
[
devno
].
Êag
 = 1;

584 
iodrivîs
[
iodrivîno
]->
devi˚s
[
devno
].
œ°evít
 = 
simtime
;

588 i‡(
skù
) {

598 
ªq
 = 
	`ioqueue_gë_√xt_ªque°
(
iodrivîs
[
iodrivîno
]->
devi˚s
[
devno
].
queue
);

604 
scheduÀ_√xt
:

605 i‡(
ªq
) {

606 
ªq
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

607 
ªq
->
√xt
 = 
NULL
;

609 i‡(
˘l
) {

610 
˘l
->
numout°™dög
++;

613 i‡(
iodrivîs
[
iodrivîno
]->
ty≥
 =
STANDALONE
) {

614 
ªq
->
time
 = 
simtime
;

615 
	`addtoötq
((
evít
 *Ë
ªq
);

618 
	`iodrivî_add_to_öåp_evíéi°
(
öåp
,

619 (
evít
 *Ë
ªq
,

620 
iodrivîs
[
iodrivîno
]->
sˇÀ
);

623 
	}
}

626 
	$iodrivî_ª•⁄d_to_devi˚
 (
iodrivîno
, 
öå_evít
 *
öåp
)

628 
i‹eq_evít
 *
ªq
 = 
NULL
;

629 
devno
;

630 
ˇu£
;

632 i‡((
iodrivîs
[
iodrivîno
]->
c⁄°time
 !0.0Ë&& (iodrivîs[iodrivîno]->c⁄°timê!
IODRIVER_TRACED_QUEUE_TIMES
)) {

633 i‡(
iodrivîs
[
iodrivîno
]->
ty≥
 =
STANDALONE
) {

634 
	`addt€xåaq
((
evít
 *Ë
öåp
->
öf›å
);

638 
ªq
 = (
i‹eq_evít
 *Ë
öåp
->
öf›å
;

642 
ªq
->
ty≥
 = 
IO_INTERRUPT_COMPLETE
;

643 
devno
 = 
ªq
->devno;

644 
ˇu£
 = 
ªq
->cause;

645 
ˇu£
) {

646 
COMPLETION
:

647 i‡(
iodrivîs
[
iodrivîno
]->
ty≥
 !
STANDALONE
) {

648 
ªq
 = 
	`i‹eq_c›y
((
i‹eq_evít
 *Ë
öåp
->
öf›å
);

650 
DISCONNECT
:

651 
RECONNECT
:

652 
	`iodrivî_£nd_evít_down_∑th
(
ªq
);

654 
READY_TO_TRANSFER
:

655 
	`addt€xåaq
((
evít
 *Ë
ªq
);

658 
	`Ârötf
(
°dîr
, "Unknow¿io_öãºu± cau£ - %d\n", 
ªq
->
ˇu£
);

659 
	`exô
(1);

661 
	`iodrivî_check_c700_ba£d_°©us
(
iodrivîs
[
iodrivîno
], 
devno
, 
ˇu£
, 
IO_INTERRUPT_COMPLETE
, 0);

662 
	}
}

665 
	$iodrivî_öãºu±_com∂ëe
 (
iodrivîno
, 
öå_evít
 *
öåp
)

674 i‡(
iodrivîs
[
iodrivîno
]->
ty≥
 =
STANDALONE
) {

675 i‡(((
i‹eq_evít
 *Ë
öåp
->
öf›å
)->
ˇu£
 =
COMPLETION
) {

676 
	`iodrivî_ac˚ss_com∂ëe
(
iodrivîno
, 
öåp
);

678 
	`iodrivî_ª•⁄d_to_devi˚
(
iodrivîno
, 
öåp
);

680 
	`addt€xåaq
((
evít
 *Ë
öåp
);

681 
	}
}

684 
	$iodrivî_gë_time_to_h™dÀ_öãºu±
 (
iodrivî
 *
cuºiodrivî
, 
ˇu£
, 
ªad
)

686 
ªtvÆ
 = 0.0;

687 i‡(
ˇu£
 =
DISCONNECT
) {

688 
ªtvÆ
 = (
ªad
Ë? 
IODRIVER_READ_DISCONNECT_TIME
 : 
IODRIVER_WRITE_DISCONNECT_TIME
;

689 } i‡(
ˇu£
 =
RECONNECT
) {

690 
ªtvÆ
 = 
IODRIVER_RECONNECT_TIME
;

691 } i‡(
ˇu£
 =
COMPLETION
) {

692 
ªtvÆ
 = (
IODRIVER_BASE_COMPLETION_TIME
 - 
IODRIVER_COMPLETION_RESPTODEV_TIME
) * () 5;

693 } i‡(
ˇu£
 !
READY_TO_TRANSFER
) {

694 
	`Ârötf
(
°dîr
, "Unknow¿öãºu±áàtime_to_h™dÀ_öãºu±: %d\n", 
ˇu£
);

695 
	`exô
(1);

697 (
cuºiodrivî
->
sˇÀ
 * 
ªtvÆ
);

698 
	}
}

701 
	$iodrivî_gë_time_to_ª•⁄d_to_devi˚
 (
iodrivî
 *
cuºiodrivî
, 
ˇu£
, 
fi·ho·ŸÆ
)

703 
ªtvÆ
;

704 i‡(
ˇu£
 =
COMPLETION
) {

705 
ªtvÆ
 = 
IODRIVER_COMPLETION_RESPTODEV_TIME
;

708 
ªtvÆ
 = 
fi·ho·ŸÆ
 * () 4;

710 (
cuºiodrivî
->
sˇÀ
 * 
ªtvÆ
);

711 
	}
}

714 
	$iodrivî_öãºu±_¨rive
 (
iodrivîno
, 
öå_evít
 *
öåp
)

716 
evít
 *
tmp
;

717 
i‹eq_evít
 *
öf›å
 = (i‹eq_evíà*Ë
öåp
->infoptr;

721 i‡((
iodrivîs
[
iodrivîno
]->
c⁄°time
 =0.0Ë|| (iodrivîs[iodrivîno]->c⁄°timê=
IODRIVER_TRACED_QUEUE_TIMES
)) {

722 
öåp
->
time
 = 
	`iodrivî_gë_time_to_h™dÀ_öãºu±
(
iodrivîs
[
iodrivîno
], 
öf›å
->
ˇu£
, (öf›å->
Êags
 & 
READ
));

723 
	`iodrivî_check_c700_ba£d_°©us
(
iodrivîs
[
iodrivîno
], 
öf›å
->
devno
, inf›å->
ˇu£
, 
IO_INTERRUPT_ARRIVE
, inf›å->
blkno
);

725 
öåp
->
time
 = 0.0;

727 i‡(
iodrivîs
[
iodrivîno
]->
ty≥
 =
STANDALONE
) {

728 
öåp
->
time
 +
simtime
;

729 
öåp
->
ty≥
 = 
IO_INTERRUPT_COMPLETE
;

730 
	`addtoötq
((
evít
 *Ë
öåp
);

732 
tmp
 = 
	`gë‰omexåaq
();

733 
öåp
->
time
 /= () 5;

734 
tmp
->
time
 = 
öåp
->time;

735 
tmp
->
ty≥
 = 
INTEND_EVENT
;

736 
tmp
->
√xt
 = 
NULL
;

737 ((
öå_evít
 *)
tmp
)->
ve˘‹
 = 
IO_INTERRUPT
;

738 
öåp
->
evíéi°
 = 
tmp
;

739 i‡(
öf›å
->
ˇu£
 =
COMPLETION
) {

740 
tmp
 = 
	`gë‰omexåaq
();

741 
tmp
->
time
 = 0.0;

745 
tmp
->
ty≥
 = 
IO_ACCESS_COMPLETE2
;

746 
	`¥ötf
 (" IO ACCESS Complete .. \n");

747 
tmp
->
√xt
 = 
öåp
->
evíéi°
;

748 ((
i‹eq_evít
 *)
tmp
)->
ãmµå1
 = 
öåp
;

749 
öåp
->
evíéi°
 = 
tmp
;

751 
tmp
 = 
	`gë‰omexåaq
();

752 
tmp
->
time
 = 
	`iodrivî_gë_time_to_ª•⁄d_to_devi˚
(
iodrivîs
[
iodrivîno
], 
öf›å
->
ˇu£
, 
öåp
->time);

753 
tmp
->
ty≥
 = 
IO_RESPOND_TO_DEVICE
;

754 
tmp
->
√xt
 = 
öåp
->
evíéi°
;

755 ((
i‹eq_evít
 *)
tmp
)->
ãmµå1
 = 
öåp
;

756 
öåp
->
evíéi°
 = 
tmp
;

758 
	}
}

761 
	$iodrivî_tick
 ()

763 
i
, 
j
;

764 
ªt
 = 0.0;

766 
i
 = 0; i < 
numiodrivîs
; i++) {

767 
j
 = 0; j < 
iodrivîs
[
i
]->
numdevi˚s
; j++) {

768 
ªt
 +
	`ioqueue_tick
(
iodrivîs
[
i
]->
devi˚s
[
j
].
queue
);

772 
	}
}

775 
evít
 * 
	$iodrivî_ªque°
 (
iodrivîno
, 
i‹eq_evít
 *
cuº
)

777 
i‹eq_evít
 *
ãmp
 = 
NULL
;

778 
i‹eq_evít
 *
ªt
 = 
NULL
;

779 
i‹eq_evít
 *
ªéi°
 = 
NULL
;

780 
numªqs
;

786 i‡(
outios
) {

787 
	`Ârötf
(
outios
, "%.6f\t%d\t%d\t%d\t%x\n", 
simtime
, 
cuº
->
devno
, cuº->
blkno
, cuº->
bcou¡
, cuº->
Êags
);

791 
	`Ârötf
 (
°dîr
, "E¡îed iodrivî_ªque° - simtimê%f, devnÿ%d, blknÿ%d, cau£ %d\n", 
simtime
, 
cuº
->
devno
, cuº->
blkno
, cuº->
ˇu£
);

795 
ªt
 = 
	`i‹eq_c›y
 (
cuº
);

796 
	`ioqueue_add_√w_ªque°
 (
ovîÆlqueue
, 
ªt
);

798 i‡–
ªt
->
devno
 == 0 )

799 
	`Ârötf
 ( 
°dout
, " Aºivê blknÿ%d, devnÿ%d \n", 
ªt
->
blkno
,Ñë->
devno
);

800 
ªt
 = 
NULL
;

802 
disksim
->
tŸÆªqs
++;

803 i‡((
disksim
->
checkpoöt_io˙t
 > 0Ë&& ((disksim->
tŸÆªqs
 % disksim->checkpoint_iocnt) == 0)) {

804 
	`disksim_ªgi°î_checkpoöt
 (
simtime
);

806 i‡(
disksim
->
tŸÆªqs
 =disksim->
w¨mup_io˙t
) {

807 
w¨mu±ime
 = 
simtime
;

808 
	`ª£t°©s
();

810 
numªqs
 = 
	`log‹g_m≠ªque°
(
sys‹gs
, 
numsys‹gs
, 
cuº
);

811 
ãmp
 = 
cuº
->
√xt
;

812 ; 
numªqs
>0;Çumreqs--) {

814 
	`ASSERT
(
cuº
 !
NULL
);

815 
cuº
->
√xt
 = 
NULL
;

816 i‡((
iodrivîs
[
iodrivîno
]->
c⁄°time
 =
IODRIVER_TRACED_QUEUE_TIMES
Ë|| (iodrivîs[iodrivîno]->c⁄°timê=
IODRIVER_TRACED_BOTH_TIMES
)) {

817 
ªt
 = 
	`i‹eq_c›y
(
cuº
);

818 
ªt
->
time
 = 
simtime
 + (Ëªt->
ãmpöt1
 / () 1000;

819 
ªt
->
ty≥
 = 
IO_TRACE_REQUEST_START
;

820 
	`addtoötq
((
evít
 *Ë
ªt
);

821 
ªt
 = 
NULL
;

822 i‡((
cuº
->
¶Ÿno
 =1Ë&& (
	`ioqueue_gë_numbî_ö_queue
(
iodrivîs
[
iodrivîno
]->
devi˚s
[(cuº->
devno
)].
queue
) == 0)) {

823 
iodrivîs
[(
iodrivîno
)]->
devi˚s
[(
cuº
->
devno
)].
Êag
 = 2;

824 
iodrivîs
[(
iodrivîno
)]->
devi˚s
[(
cuº
->
devno
)].
œ°evít
 = 
simtime
;

827 
ªt
 = 
	`h™dÀ_√w_ªque°
(
iodrivîs
[
iodrivîno
], 
cuº
);

829 i‡((
ªt
Ë&& (
iodrivîs
[
iodrivîno
]->
ty≥
 =
STANDALONE
Ë&& (ªt->
time
 == 0.0)) {

830 
ªt
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

831 
ªt
->
time
 = 
simtime
;

832 
	`iodrivî_scheduÀ
(
iodrivîno
, 
ªt
);

833 } i‡(
ªt
) {

834 
ªt
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

835 
ªt
->
√xt
 = 
ªéi°
;

836 
ªt
->
¥ev
 = 
NULL
;

837 
ªéi°
 = 
ªt
;

839 
cuº
 = 
ãmp
;

840 
ãmp
 = (ãmpË?Åemp->
√xt
 : 
NULL
;

842 i‡(
iodrivîs
[
iodrivîno
]->
ty≥
 =
STANDALONE
) {

843 
ªéi°
) {

844 
ªt
 = 
ªéi°
;

845 
ªéi°
 = 
ªt
->
√xt
;

846 
ªt
->
√xt
 = 
NULL
;

847 
ªt
->
time
 +
simtime
;

848 
	`addtoötq
((
evít
 *Ë
ªt
);

854 ((
evít
 *Ë
ªéi°
);

855 
	}
}

858 
	$iodrivî_åa˚_ªque°_°¨t
 (
iodrivîno
, 
i‹eq_evít
 *
cuº
)

860 
i‹eq_evít
 *
tmp
;

861 
devi˚
 *
cuºdev
 = &
iodrivîs
[
iodrivîno
]->
devi˚s
[(
cuº
->
devno
)];

862 
tdiff
 = 
simtime
 - 
cuºdev
->
œ°evít
;

864 i‡(
cuºdev
->
Êag
 == 1) {

865 
	`°©_upd©e
(&
öôüã√xt°©s
, 
tdiff
);

866 } i‡(
cuºdev
->
Êag
 == 2) {

867 
	`°©_upd©e
(&
em±yqueue°©s
, 
tdiff
);

869 
cuºdev
->
Êag
 = 0;

871 
tmp
 = 
	`ioqueue_gë_•ecific_ªque°
(
cuºdev
->
queue
, 
cuº
);

872 
	`addt€xåaq
((
evít
 *Ë
cuº
);

873 
	`ASSERT
(
tmp
 !
NULL
);

875 
	`scheduÀ_disk_ac˚ss
(
iodrivîs
[
iodrivîno
], 
tmp
);

876 
tmp
->
time
 = 
simtime
;

877 
tmp
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

878 
tmp
->
¶Ÿno
 = 0;

879 i‡(
tmp
->
time
 =
simtime
) {

880 
	`iodrivî_scheduÀ
(
iodrivîno
, 
tmp
);

882 
	`addtoötq
((
evít
 *Ë
tmp
);

884 
	}
}

887 
	$iodrivî_£t_˘l_to_devi˚
 (
iodrivîno
, 
devi˚
 * 
dev
)

889 
i
;

890 
˘Ã
 *
tmp
;

892 
dev
->
˘l
 = 
NULL
;

893 
i
=0; i < 
iodrivîs
[
iodrivîno
]->
num˘Ãs
; i++) {

894 
tmp
 = &
iodrivîs
[
iodrivîno
]->
˘Ãs
[
i
];

895 i‡((
tmp
->
¶Ÿ∑th
.
vÆue
 & 
dev
->slotpath.value) ==Åmp->slotpath.value) {

896 i‡((
tmp
->
bu•©h
.
vÆue
 & 
dev
->buspath.value) ==Åmp->buspath.value) {

897 i‡(
tmp
->
Êags
 & 
DRIVER_C700
) {

898 
dev
->
˘l
 = 
tmp
;

901 
dev
->
˘l
 = 
tmp
;

906 
	}
}

909 
	$gë_devi˚_maxout°™dög
 (
iodrivî
 *
cuºiodrivî
, 
devi˚
 * 
dev
)

911 
i‹eq_evít
 *
chk
 = (i‹eq_evíà*Ë
	`gë‰omexåaq
();

913 
chk
->
bu¢o
 = 
dev
->
bu•©h
.
vÆue
;

914 
chk
->
¶Ÿno
 = 
dev
->
¶Ÿ∑th
.
vÆue
;

915 
chk
->
devno
 = 
dev
->devno;

916 
chk
->
ty≥
 = 
IO_QLEN_MAXCHECK
;

917 
	`iodrivî_£nd_evít_down_∑th
(
chk
);

918 
dev
->
queue˘Ã
 = 
chk
->
ãmpöt1
;

919 
dev
->
maxout°™dög
 = (
chk
->
ãmpöt1
 =-1Ë? chk->
ãmpöt2
 : -1;

920 i‡(
chk
->
ãmpöt1
 != -1) {

921 
cuºiodrivî
->
˘Ãs
[
chk
->
ãmpöt1
].
maxout°™dög
 = chk->
ãmpöt2
;

922 
cuºiodrivî
->
˘Ãs
[
chk
->
ãmpöt1
].
maxªqsize
 = chk->
bcou¡
;

927 
	`addt€xåaq
((
evít
 *Ë
chk
);

928 
	}
}

932 
	$¥öt_∑ths_to_devi˚s
()

934 
i
,
j
;

936 
i
 = 0; i < 
numiodrivîs
; i++) {

937 
	`Ârötf
 (
ouçutfûe
, "I/O drivî #%d\n", 
i
);

938 
j
 = 0; j < 
iodrivîs
[
i
]->
numdevi˚s
; j++) {

939 
	`Ârötf
 (
ouçutfûe
, "Devi˚ #%d: bu•©h = %x, slŸ∑th = %x\n", 
j
, 
iodrivîs
[
i
]->
devi˚s
[j].
bu•©h
.
vÆue
, iodrivîs[i]->devi˚s[j].
¶Ÿ∑th
.value);

942 
	}
}

947 
	$¥öt_∑ths_to_˘Ãs
()

949 
i
,
j
;

951 
i
 = 0; i < 
numiodrivîs
; i++) {

952 
	`Ârötf
 (
ouçutfûe
, "I/O drivî #%d\n", 
i
);

953 
j
 = 0; j < 
iodrivîs
[
i
]->
num˘Ãs
; j++) {

954 
	`Ârötf
 (
ouçutfûe
, "C⁄åﬁÀ∏#%d: bu•©h = %x, slŸ∑th = %x\n", 
j
, 
iodrivîs
[
i
]->
˘Ãs
[j].
bu•©h
.
vÆue
, iodrivîs[i]->˘Ãs[j].
¶Ÿ∑th
.value);

957 
	}
}

963 
	$iodrivî_£tˇŒbacks
 ()

965 
	`ioqueue_£tˇŒbacks
();

966 
	}
}

969 
	$iodrivî_öôülize
 (
°™dÆ⁄e
)

971 
numdevs
;

972 
ioq
 * 
queue£t
[
MAXDEVICES
];

973 
i
, 
j
;

974 
iodrivî
 *
cuºiodrivî
;

977 
	`ASSERT1
(
numiodrivîs
 == 1, "numiodrivers",Çumiodrivers);

979 
	`ioqueue_öôülize
 (
ovîÆlqueue
, 0);

981 
i
 = 0; i < 
numiodrivîs
; i++) {

982 
cuºiodrivî
 = 
iodrivîs
[
i
];

983 
cuºiodrivî
->
ty≥
 = 
°™dÆ⁄e
;

984 i‡(
°™dÆ⁄e
 !
STANDALONE
) {

985 
cuºiodrivî
->
sˇÀ
 = 1.0;

987 
numdevs
 = 
	`c⁄åﬁÀr_gë_numc⁄åﬁÀrs
();

988 
cuºiodrivî
->
num˘Ãs
 = 
numdevs
;

989 
cuºiodrivî
->
˘Ãs
 = (
˘Ã
*Ë
	`DISKSIM_mÆloc
(
numdevs
 * ((ctlr)));

990 
	`ASSERT
(
cuºiodrivî
->
˘Ãs
 !
NULL
);

991 
j
=0; j < 
numdevs
; j++) {

992 
˘Ã
 *
cuº˘Ã
 = &
cuºiodrivî
->
˘Ãs
[
j
];

993 
cuº˘Ã
->
˘ o
 = 
j
;

994 
cuº˘Ã
->
Êags
 = 0;

995 i‡(
	`c⁄åﬁÀr_C700_ba£d
(
j
Ë=
TRUE
) {

999 
cuº˘Ã
->
Êags
 |
DRIVER_C700
;

1001 
cuº˘Ã
->
bu•©h
.
vÆue
 = 0;

1002 
cuº˘Ã
->
¶Ÿ∑th
.
vÆue
 = 0;

1003 
	`iosim_gë_∑th_to_c⁄åﬁÀr
(
i
, 
cuº˘Ã
->
˘ o
, &cuº˘Ã->
bu•©h
, &cuº˘Ã->
¶Ÿ∑th
);

1004 
cuº˘Ã
->
numout°™dög
 = 0;

1005 
cuº˘Ã
->
≥ndio
 = 
NULL
;

1006 
cuº˘Ã
->
ovîsized
 = 
NULL
;

1009 
numdevs
 = 
	`devi˚_gë_numdevi˚s
();

1010 
cuºiodrivî
->
numdevi˚s
 = 
numdevs
;

1011 
cuºiodrivî
->
devi˚s
 = (
devi˚
*Ë
	`DISKSIM_mÆloc
(
numdevs
 * ((device)));

1012 
	`ASSERT
(
cuºiodrivî
->
devi˚s
 !
NULL
);

1013 
j
 = 0; j < 
numdevs
; j++) {

1014 
devi˚
 *
cuºdev
 = &
cuºiodrivî
->
devi˚s
[
j
];

1015 
cuºdev
->
devno
 = 
j
;

1016 
cuºdev
->
busy
 = 
FALSE
;

1017 
cuºdev
->
Êag
 = 0;

1018 
cuºdev
->
queue
 = 
	`ioqueue_c›y
(
cuºiodrivî
->queue);

1019 
	`ioqueue_öôülize
(
cuºdev
->
queue
, 
j
);

1020 
queue£t
[
j
] = 
cuºdev
->
queue
;

1021 
cuºdev
->
bu•©h
.
vÆue
 = 0;

1022 
cuºdev
->
¶Ÿ∑th
.
vÆue
 = 0;

1023 
	`iosim_gë_∑th_to_devi˚
(
i
, 
cuºdev
->
devno
, &cuºdev->
bu•©h
, &cuºdev->
¶Ÿ∑th
);

1024 
	`iodrivî_£t_˘l_to_devi˚
(
i
, 
cuºdev
);

1025 
	`gë_devi˚_maxout°™dög
(
cuºiodrivî
, 
cuºdev
);

1027 
	`log‹g_öôülize
(
sys‹gs
, 
numsys‹gs
, 
queue£t
,

1028 
drv_¥öéoˇlôy°©s
,

1029 
drv_¥ötblockög°©s
,

1030 
drv_¥ötöãr„ª°©s
,

1031 
drv_¥öt°ªak°©s
,

1032 
drv_¥öt°amp°©s
,

1033 
drv_¥ötöèº°©s
,

1034 
drv_¥ötidÀ°©s
,

1035 
drv_¥ötsize°©s
);

1040 
	`°©_öôülize
(
°©deffûe
, 
°©desc_em±yqueue
, &
em±yqueue°©s
);

1041 
	`°©_öôülize
(
°©deffûe
, 
°©desc_öôüã√xt
, &
öôüã√xt°©s
);

1044 
	`¥öt_∑ths_to_devi˚s
();

1045 
	`¥öt_∑ths_to_˘Ãs
();

1048 
	}
}

1051 
	$iodrivî_ª£t°©s
()

1053 
i
, 
j
;

1054 
numdevs
 = 
	`devi˚_gë_numdevi˚s
();

1056 
	`ioqueue_ª£t°©s
(
ovîÆlqueue
);

1057 
i
=0; i<
numiodrivîs
; i++) {

1058 
j
=0; j<
numdevs
; j++) {

1059 
	`ioqueue_ª£t°©s
(
iodrivîs
[
i
]->
devi˚s
[
j
].
queue
);

1062 
	`log‹g_ª£t°©s
(
sys‹gs
, 
numsys‹gs
);

1063 
	`°©_ª£t
(&
em±yqueue°©s
);

1064 
	`°©_ª£t
(&
öôüã√xt°©s
);

1065 
	}
}

1070 
	$disksim_iodrivî_°©s_lﬂd∑øms
(
Õ_block
 *
b
) {

1072 i‡(
disksim
->
iodrivî_öfo
 =
NULL
) {

1073 
disksim
->
iodrivî_öfo
 = 
	`DISKSIM_mÆloc
 ((
iodrivî_öfo_t
));

1074 
	`bzîo
 ((*)
disksim
->
iodrivî_öfo
, (
iodrivî_öfo_t
));

1081 
	`Õ_lﬂd∑øms
(0, 
b
, &
disksim_iodrivî_°©s_mod
);

1084 
	}
}

1090 
iodrivî
 *
drivî_c›y
(iodrivî *
‹ig
);

1092 
	$add_drivî
(
iodrivî
 *
d
) {

1093 
c
, 
√wÀn
,
zîo˙t
;

1095 
c
 = 0; c < 
disksim
->
iodrivî_öfo
->
iodrivîs_Àn
; c++) {

1096 if(!
iodrivîs
[
c
]) {

1097 
iodrivîs
[
c
] = 
d
;

1102 
√wÀn
 = 
c
 ? 2*c : 2;

1103 
disksim
->
iodrivî_öfo
->
iodrivîs_Àn
 = 
√wÀn
;

1104 
iodrivîs
 = 
	`ªÆloc
(iodrivîs, 
√wÀn
 * (
iodrivî
 *));

1105 
zîo˙t
 = 
c
 ? c : 2;

1106 
	`bzîo
((
iodrivî
*)
iodrivîs
 + 
c
, 
zîo˙t
 * (iodriver *));

1108 
iodrivîs
[
c
] = 
d
;

1109 
numiodrivîs
++;

1110 
	}
}

1112 
iodrivî
 *
	$disksim_iodrivî_lﬂd∑øms
(
Õ_block
 *
b
) {

1113 
iodrivî
 *
ªsu…
;

1115 i‡(
disksim
->
iodrivî_öfo
 =
NULL
) {

1116 
disksim
->
iodrivî_öfo
 = 
	`mÆloc
 ((
iodrivî_öfo_t
));

1117 
	`bzîo
 ((*)
disksim
->
iodrivî_öfo
, (
iodrivî_öfo_t
));

1119 
ovîÆlqueue
 = 
	`ioqueue_¸óãdeÁu…queue
 ();

1121 
ªsu…
 = 
	`mÆloc
((
iodrivî
));

1122 
	`bzîo
(
ªsu…
, (
iodrivî
));

1124 
	`add_drivî
(
ªsu…
);

1128 
ªsu…
->
«me
 = 
	`°rdup
(
b
->name);

1131 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
disksim_iodrivî_mod
);

1133 
ªsu…
->
sˇÀ
 = 0.0;

1136  
ªsu…
;

1137 
	}
}

1140 
	$lﬂd_iodrivî_t›o
(
Õ_t›o•ec
 *
t
, 
Àn
) {

1141 
iodrivî
 *
id
;

1143 
	`as£π
(!
	`°rcmp
(
t
->
ty≥
, 
disksim_mods
[
DISKSIM_MOD_IODRIVER
]->
«me
));

1145 
id
 = 
	`gëiodrivîby«me
(
t
->
«me
, 0);

1146 if(!
id
) {

1147 
	`Ârötf
(
°dîr
, "***Éº‹:Çÿsuch iodrivî %s\n", 
t
->
«me
);

1151 if(
t
->
l
->
vÆues_Àn
 < 1) {

1152 
	`Ârötf
(
°dîr
, "***Érror: currently,Éxactly one bus must be connectedÅoá device driver.\n");

1155 if(
t
->
l
->
vÆues_Àn
 > 1) {

1156 if(
disksim
->
vîbosôy
 > 0)

1157 
	`Ârötf
(
°dîr
, "*** warning: currently, only one bus is supportedÖer device driver. I'm ignoringÅheÑest ofÅhe buses.\n");

1161 if(
t
->
l
->
vÆues
[0]->à!
TOPOSPEC
) {

1162 
	`Ârötf
(
°dîr
, "***Érror: bad bus spec for device driver.\n");

1167 if(
	`°rcmp
(
	`Õ_lookup_ba£_ty≥
(
t
->
l
->
vÆues
[0]->
v
.t.l[0].
ty≥
, 0),

1168 
disksim_mods
[
DISKSIM_MOD_BUS
]->
«me
))

1170 
	`Ârötf
(
°dîr
, "***Érror: mustáttach busesÅo device driver.\n");

1174 if(!
	`gëbusby«me
(
t
->
l
->
vÆues
[0]->
v
.t.l[0].
«me
, &
id
->
outbus
)) {

1175 
	`Ârötf
(
°dîr
, "***Érror:Ço such bus %s.\n",

1176 
t
->
l
->
vÆues
[0]->
v
.t.l[0].
«me
);

1180 
id
->
numoutbu£s
 = 1;

1184 
	`bus_£t_to_zîo_dïth
(
id
->
outbus
);

1187  
	`lﬂd_bus_t›o
(&
t
->
l
->
vÆues
[0]->
v
.t.l[0], 0);

1188 
	}
}

1191 
iodrivî
 *
	$drivî_c›y
(
iodrivî
 *
‹ig
) {

1192 
iodrivî
 *
ªsu…
 = 
	`mÆloc
((iodriver));

1193 
	`bzîo
(
ªsu…
, (
iodrivî
));

1194 
	`mem˝y
(
ªsu…
, 
‹ig
, (
iodrivî
));

1195 
ªsu…
->
queue
 = 
	`ioqueue_c›y
(
‹ig
->queue);

1196  
ªsu…
;

1197 
	}
}

1202 
	$iodrivî_lﬂd_log‹g
(
Õ_block
 *
b
) {

1203 
c
, 
√wÀn
, 
zîoOff
;

1205 
log‹g
 *
l
 = 0;

1207 
√wÀn
 = 
disksim
->
iodrivî_öfo
->
sys‹gs_Àn
 ?

1208 
disksim
->
iodrivî_öfo
->
sys‹gs_Àn
 * 2 : 2;

1209 
zîoOff
 = (
√wÀn
 == 2) ? 0 : (newlen / 2);

1212 
l
 = 
	`disksim_log‹g_lﬂd∑øms
(
b
);

1213 if(!
l
)  0;

1215 
c
 = 0; c < 
disksim
->
iodrivî_öfo
->
sys‹gs_Àn
; c++) {

1216 if(!
sys‹gs
[
c
]) {

1217 
found¶Ÿ
;

1221 
sys‹gs
 = 
	`ªÆloc
(sys‹gs, 
√wÀn
 * (
log‹g
 *));

1223 
	`bzîo
(
sys‹gs
 + 
zîoOff
,

1224 (
zîoOff
 ? 
numsys‹gs
 : 2Ë* (
log‹g
 *));

1226 
disksim
->
iodrivî_öfo
->
sys‹gs_Àn
 = 
√wÀn
;

1228 
found¶Ÿ
:

1229 
sys‹gs
[
c
] = 
l
;

1230 
	`log‹g_£t_¨øydisk
(
l
, 
c
);

1231 
numsys‹gs
++;

1234 
	}
}

1237 
	$iodrivî_¥öt°©s
()

1239 
i
;

1240 
j
;

1241 
ioq
 **
queue£t
;

1242 
£tsize
 = 0;

1243 
¥efix
[80];

1245 
	`Ârötf
 (
ouçutfûe
, "\nOVERALL I/O SYSTEM STATISTICS\n");

1246 
	`Ârötf
 (
ouçutfûe
, "-----------------------------\n\n");

1247 
	`•rötf
 (
¥efix
, "Overall I/O System ");

1248 
	`ioqueue_¥öt°©s
 (&
ovîÆlqueue
, 1, 
¥efix
);

1250 
	`Ârötf
 (
ouçutfûe
, "\nSYSTEM-LEVEL LOGORG STATISTICS\n");

1251 
	`Ârötf
 (
ouçutfûe
, "------------------------------\n\n");

1252 
	`•rötf
(
¥efix
, "System ");

1253 
	`log‹g_¥öt°©s
(
sys‹gs
, 
numsys‹gs
, 
¥efix
);

1255 
	`Ârötf
 (
ouçutfûe
, "\nIODRIVER STATISTICS\n");

1256 
	`Ârötf
 (
ouçutfûe
, "-------------------\n\n");

1257 
i
 = 0; i < 
numiodrivîs
; i++) {

1258 
£tsize
 +
iodrivîs
[
i
]->
numdevi˚s
;

1261 
queue£t
 = (
ioq
 **)
	`DISKSIM_mÆloc
(
£tsize
*(ioq *));

1263 
£tsize
 = 0;

1264 
i
 = 0; i < 
numiodrivîs
; i++) {

1265 
j
 = 0; j < 
iodrivîs
[
i
]->
numdevi˚s
; j++) {

1266 
queue£t
[
£tsize
] = 
iodrivîs
[
i
]->
devi˚s
[
j
].
queue
;

1267 
£tsize
++;

1270 
	`•rötf
(
¥efix
, "IOdriver ");

1271 i‡(
	`°©_gë_cou¡
(&
em±yqueue°©s
) > 0) {

1272 
	`°©_¥öt
(&
em±yqueue°©s
, 
¥efix
);

1274 i‡(
	`°©_gë_cou¡
(&
öôüã√xt°©s
) > 0) {

1275 
	`°©_¥öt
(&
öôüã√xt°©s
, 
¥efix
);

1277 
	`ioqueue_¥öt°©s
(
queue£t
, 
£tsize
, 
¥efix
);

1278 i‡((
drv_¥öçîdisk°©s
 =
TRUE
Ë&& ((
numiodrivîs
 > 1Ë|| (
iodrivîs
[0]->
numdevi˚s
 > 1))) {

1279 
i
 = 0; i < 
numiodrivîs
; i++) {

1280 
j
 = 0; j < 
iodrivîs
[
i
]->
numdevi˚s
; j++) {

1281 
	`Ârötf
 (
ouçutfûe
, "\nI/O Drivî #%d - Devi˚ #%d\n", 
i
, 
j
);

1282 
	`•rötf
(
¥efix
, "IOdrivî #%d devi˚ #%d ", 
i
, 
j
);

1283 
	`ioqueue_¥öt°©s
(&
iodrivîs
[
i
]->
devi˚s
[
j
].
queue
, 1, 
¥efix
);

1288 
	`‰ì
(
queue£t
);

1289 
	}
}

1292 
	$iodrivî_˛ón°©s
()

1294 
i
;

1295 
j
;

1297 
	`ioqueue_˛ón°©s
 (
ovîÆlqueue
);

1298 
	`log‹g_˛ón°©s
(
sys‹gs
, 
numsys‹gs
);

1299 
i
 = 0; i < 
numiodrivîs
; i++) {

1300 
j
 = 0; j < 
iodrivîs
[
i
]->
numdevi˚s
; j++) {

1301 
	`ioqueue_˛ón°©s
(
iodrivîs
[
i
]->
devi˚s
[
j
].
queue
);

1304 
	}
}

1307 
	$iodrivî_˛ónup
() {

1308 
i
;

1310 
i
 = 0; i < 
numiodrivîs
; i++) {

1313 
i
 = 0; i < 
numsys‹gs
; i++) {

1314 if(
sys‹gs
[
i
]) {

1315 
	`log‹g_˛ónup
(
sys‹gs
[
i
]);

1318 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_iodriver.h

101 #i‚de‡
DISKSIM_IODRIVER_H


102 
	#DISKSIM_IODRIVER_H


	)

104 
	~"c⁄fig.h
"

105 
	~"disksim_iosim.h
"

106 
	~"disksim_°©.h
"

111 
	#STANDALONE
 1

	)

118 
	#DRIVER_C700
 0x2

	)

119 
	#DRIVER_CTLR_BUSY
 0x4

	)

123 
	#IODRIVER_IMMEDSCHED_TIME
 0.0

	)

124 
	#IODRIVER_WRITE_DISCONNECT_TIME
 0.0

	)

125 
	#IODRIVER_READ_DISCONNECT_TIME
 0.0

	)

126 
	#IODRIVER_RECONNECT_TIME
 0.0

	)

127 
	#IODRIVER_BASE_COMPLETION_TIME
 0.0

	)

129 
	#IODRIVER_COMPLETION_RESPTODEV_TIME
 0.0

	)

130 
	#IODRIVER_COMPLETION_RESPTOSCHED_TIME
 0.0

	)

131 
	#IODRIVER_COMPLETION_SCHEDTOEND_TIME
 0.0

	)

132 
	#IODRIVER_COMPLETION_SCHEDTOWAKEUP_TIME
 0.0

	)

133 
	#IODRIVER_COMPLETION_WAKEUPTOEND_TIME
 0.0

	)

134 
	#IODRIVER_COMPLETION_RESPTOWAKEUP_TIME
 0.0

	)

135 
	#IODRIVER_COMPLETION_RESPTOREQ_TIME
 0.0

	)

139 
	#IODRIVER_TRACED_ACCESS_TIMES
 -1.0

	)

140 
	#IODRIVER_TRACED_QUEUE_TIMES
 -2.0

	)

141 
	#IODRIVER_TRACED_BOTH_TIMES
 -3.0

	)

144 
	siodrivî
 {

145 
	mty≥
;

146 
	mu£queue
;

147 
	mnumoutbu£s
;

148 
	moutbus
;

149 
	mc⁄°time
;

150 
	msˇÀ
;

151 
	mnumdevi˚s
;

152 
	mnum˘Ãs
;

153 
ioq
 * 
	mqueue
;

154 
devi˚
 * 
	mdevi˚s
;

155 
˘Ã
 * 
	m˘Ãs
;

156 *
	m«me
;

157 } 
	tiodrivî
;

160 
	siodrivî_öfo
 {

161 
	mnumiodrivîs
;

162 
iodrivî
 **
	miodrivîs
;

163 
	miodrivîs_Àn
;

164 
	mnumsys‹gs
;

165 
log‹g
 **
	msys‹gs
;

166 
	msys‹gs_Àn
;

167 
ioq
 *
	movîÆlqueue
;

168 
	mdrv_¥ötsize°©s
;

169 
	mdrv_¥öéoˇlôy°©s
;

170 
	mdrv_¥ötblockög°©s
;

171 
	mdrv_¥ötöãr„ª°©s
;

172 
	mdrv_¥ötqueue°©s
;

173 
	mdrv_¥öt¸ô°©s
;

174 
	mdrv_¥ötidÀ°©s
;

175 
	mdrv_¥ötöèº°©s
;

176 
	mdrv_¥öt°ªak°©s
;

177 
	mdrv_¥öt°amp°©s
;

178 
	mdrv_¥öçîdisk°©s
;

179 
°©gí
 
	mem±yqueue°©s
;

180 
°©gí
 
	möôüã√xt°©s
;

181 } 
	tiodrivî_öfo_t
;

185 
	#numiodrivîs
 (
disksim
->
iodrivî_öfo
->
numiodrivîs
)

	)

186 
	#iodrivîs
 (
disksim
->
iodrivî_öfo
->
iodrivîs
)

	)

187 
	#numsys‹gs
 (
disksim
->
iodrivî_öfo
->
numsys‹gs
)

	)

188 
	#sys‹gs
 (
disksim
->
iodrivî_öfo
->
sys‹gs
)

	)

189 
	#ovîÆlqueue
 (
disksim
->
iodrivî_öfo
->
ovîÆlqueue
)

	)

190 
	#drv_¥ötsize°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥ötsize°©s
)

	)

191 
	#drv_¥öéoˇlôy°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥öéoˇlôy°©s
)

	)

192 
	#drv_¥ötblockög°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥ötblockög°©s
)

	)

193 
	#drv_¥ötöãr„ª°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥ötöãr„ª°©s
)

	)

194 
	#drv_¥ötqueue°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥ötqueue°©s
)

	)

195 
	#drv_¥öt¸ô°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥öt¸ô°©s
)

	)

196 
	#drv_¥ötidÀ°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥ötidÀ°©s
)

	)

197 
	#drv_¥ötöèº°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥ötöèº°©s
)

	)

198 
	#drv_¥öt°ªak°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥öt°ªak°©s
)

	)

199 
	#drv_¥öt°amp°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥öt°amp°©s
)

	)

200 
	#drv_¥öçîdisk°©s
 (
disksim
->
iodrivî_öfo
->
drv_¥öçîdisk°©s
)

	)

201 
	#em±yqueue°©s
 (
disksim
->
iodrivî_öfo
->
em±yqueue°©s
)

	)

202 
	#öôüã√xt°©s
 (
disksim
->
iodrivî_öfo
->
öôüã√xt°©s
)

	)

209 
iodrivî_ªad_t›röts
 (
FILE
 *
∑rfûe
);

210 
iodrivî_ªad_•ecs
 (
FILE
 *
∑rfûe
);

211 
iodrivî_ªad_phys‹g
 (
FILE
 *
∑rfûe
);

212 
iodrivî_ªad_log‹g
 (
FILE
 *
∑rfûe
);

213 
iodrivî_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

214 
iodrivî_sys‹g_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

215 
iodrivî_£tˇŒbacks
 ();

216 
iodrivî_öôülize
 (
°™dÆ⁄e
);

217 
iodrivî_ª£t°©s
 ();

218 
iodrivî_¥öt°©s
 ();

219 
iodrivî_˛ón°©s
 ();

220 
evít
 * 
iodrivî_ªque°
 (
iodrivîno
, 
i‹eq_evít
 *
cuº
);

221 
iodrivî_scheduÀ
 (
iodrivîno
, 
i‹eq_evít
 *
cuº
);

222 
iodrivî_tick
 ();

223 
iodrivî_øi£_¥i‹ôy
 (
iodrivîno
, 
›id
, 
devno
, 
blkno
, *
ch™
);

224 
iodrivî_öãºu±_¨rive
 (
iodrivîno
, 
öå_evít
 *
öåp
);

225 
iodrivî_ac˚ss_com∂ëe
 (
iodrivîno
, 
öå_evít
 *
öåp
);

226 
iodrivî_ª•⁄d_to_devi˚
 (
iodrivîno
, 
öå_evít
 *
öåp
);

227 
iodrivî_öãºu±_com∂ëe
 (
iodrivîno
, 
öå_evít
 *
öåp
);

228 
iodrivî_åa˚_ªque°_°¨t
 (
iodrivîno
, 
i‹eq_evít
 *
cuº
);

230 
iodrivî_lﬂd_log‹g
(
Õ_block
 *
b
);

231 
lﬂd_iodrivî_t›o
(
Õ_t›o•ec
 *
t
, 
Àn
);

233 
iodrivî_˛ónup
();

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_ioface.h

101 #i‚de‡
DISKSIM_IOFACE_H


102 
	#DISKSIM_IOFACE_H


	)

104 
	~"disksim_globÆ.h
"

106 #ifde‡
__˝lu•lus


112 
	#IO_REQUEST_ARRIVE
 100

	)

116 
	#IOSIM
 1

	)

117 
	#IODRIVER
 2

	)

118 
	#SYSORG
 3

	)

119 
	#DEVICE
 4

	)

120 
	#CONTROLLER
 5

	)

121 
	#BUS
 6

	)

126 
io_ªad∑øms
 (
FILE
 *
∑rfûe
);

127 
io_¥öt°©s
 ();

128 
io_˛ón°©s
 ();

129 
io_ª£t°©s
 ();

130 
io_£tˇŒbacks
 ();

131 
io_öôülize
 (
°™dÆ⁄e
);

132 
io_öã∫Æ_evít
 (
i‹eq_evít
 *
cuº
);

133 
evít
 * 
io_gë_√xt_exã∫Æ_evít
 (
FILE
 *
åa˚fûe
);

134 
io_usög_exã∫Æ_evít
 (
evít
 *
cuº
);

135 
evít
 * 
io_ªque°
 (
i‹eq_evít
 *
cuº
);

136 
io_scheduÀ
 (
i‹eq_evít
 *
cuº
);

137 
io_tick
 ();

138 
io_øi£_¥i‹ôy
 (
›id
, 
devno
, 
blkno
, *
ch™
);

139 
io_öãºu±_¨rive
 (
i‹eq_evít
 *
öåp
);

140 
io_öãºu±_com∂ëe
 (
i‹eq_evít
 *
öåp
);

141 
io_ˇtch_°øy_evíts
 (
i‹eq_evít
 *
cuº
);

142 
io_∑øm_ovîride
 (
°ru˘ty≥
, *
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

143 
io_m≠_åa˚_ªque°
 (
i‹eq_evít
 *
ãmp
);

145 
iosim_öôülize_iosim_öfo
();

148 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/disksim_ioqueue.c

102 
	~"disksim_ioqueue.h
"

105 
	~"moduÀs/moduÀs.h
"

109 
	#READY_TO_GO
(
iobuÂå
,
queue
) ( \

110 ((
iobuÂå
)->
°©e
 =
WAITING
) && \

111 (((
queue
)->
íabÀmít
 =
NULL
Ë|| ((*(queue)->íabÀmít)((
iobuÂå
)->
iﬁi°
))) && \

112 (((
queue
)->
sched_Æg
 !
BATCH_FCFS
Ë|| (((queue)->sched_Æg =BATCH_FCFSË&& ((
iobuÂå
)->
b©ch_com∂ëe
 =
TRUE
))) \

113 )

	)

118 
	#IOQUEUE_CONCAT_READS
 1

	)

119 
	#IOQUEUE_CONCAT_WRITES
 2

	)

120 
	#IOQUEUE_CONCAT_BOTH
 3

	)

121 
	#IOQUEUE_SEQSTREAM_READS
 4

	)

122 
	#IOQUEUE_SEQSTREAM_WRITES
 8

	)

123 
	#IOQUEUE_SEQSTREAM_EITHER
 16

	)

127 
	#IOQUEUE_BASE
 1

	)

128 
	#IOQUEUE_TIMEOUT
 2

	)

129 
	#IOQUEUE_PRIORITY
 3

	)

133 
	#WAITING
 0

	)

134 
	#PENDING
 1

	)

138 
	#ALLEQUAL
 0

	)

139 
	#TWOQUEUE
 1

	)

143 
	#NOTIMEOUT
 0

	)

144 
	#BASETIMEOUT
 1

	)

145 
	#HALFTIMEOUT
 2

	)

149 
	#ASC
 1

	)

150 
	#DESC
 2

	)

153 *
	g°©desc_acc°©s
 = "PhysicaláccessÅime";

154 *
	g°©desc_qtime°©s
 = "QueueÅime";

155 *
	g°©desc_ouâime°©s
 = "ResponseÅime";

156 *
	g°©desc_öèº°©s
 = "Inter-arrivalÅime";

157 *
	g°©desc_ªadöèº°©s
 = "Read inter-arrival";

158 *
	g°©desc_wrôeöèº°©s
 = "Write inter-arrival";

159 *
	g°©desc_idÀ°©s
 = "IdleÖeriodÜength";

160 *
	g°©desc_öf›íÆty
 = "Sub-optimal mappingÖenalty";

161 *
	g°©desc_ªqsize°©s
 = "Request size";

162 *
	g°©desc_ªadsize°©s
 = "ReadÑequest size";

163 *
	g°©desc_wrôesize°©s
 = "WriteÑequest size";

164 *
	g°©desc_ö°queuñí
 = "Instantaneous queueÜength";

165 *
	g°©desc_b©chsize°©s
 = "Batch size";

167 
	$¥öt_b©ch_fcfs_queue
(
subqueue
 *
queue
)

169 
i
;

170 
iobuf
 *
tmp
;

172 
tmp
 = 
queue
->
li°
;

174 
	`¥ötf
("blkno, batchno, state, complete,Çext,Örev\n");

175 
	`¥ötf
("Üi°À¿%d\n", 
queue
->
li°Àn
);

176 
	`¥ötf
(" iobuf˙à%d\n", 
queue
->
iobuf˙t
);

178 
i
 = 0; i < 
queue
->
iobuf˙t
; i++) {

179 
	`¥ötf
(" %d %d %d %d %d %d\n",

180 
tmp
->
blkno
,

181 
tmp
->
b©chno
,

182 
tmp
->
°©e
,

183 
tmp
->
b©ch_com∂ëe
,

184 
tmp
->
√xt
->
blkno
,

185 
tmp
->
¥ev
->
blkno
);

187 i‡(
tmp
->
b©chno
 != -1) {

188 
i‹eq_evít
 *
evít_±r
 = 
tmp
->
b©ch_li°
;

190 
	`¥ötf
(" b©ch_sizê%d\n", 
tmp
->
b©ch_size
);

191 
evít_±r
 !
NULL
) {

192 
	`¥ötf
(" %d\n", 
evít_±r
->
blkno
);

193 
evít_±r
 =Évít_±r->
b©ch_√xt
;

196 
tmp
 =Åmp->
√xt
;

198 
	}
}

200 
	$ioqueue_¥öt_c⁄ã¡s
 (
ioqueue
 *
queue
)

202 
i
;

203 
iobuf
 *
tmp
;

205 
tmp
 = 
queue
->
ba£
.
li°
->
√xt
;

206 
	`Ârötf
 (
ouçutfûe
, "C⁄ã¡†o‡ba£ queue:Üi°À¿%d\n", 
queue
->
ba£
.
li°Àn
);

207 
i
 = 0; i < 
queue
->
ba£
.
iobuf˙t
; i++) {

208 
	`Ârötf
(
ouçutfûe
, "Sèã: %d, blkno: %d\n", 
tmp
->
°©e
,Åmp->
blkno
);

209 
tmp
 =Åmp->
√xt
;

212 
tmp
 = 
queue
->
timeout
.
li°
->
√xt
;

213 
	`Ârötf
(
ouçutfûe
, "C⁄ã¡†o‡timeouàqueue:Üi°À¿%d\n", 
queue
->
timeout
.
li°Àn
);

214 
i
 = 0; i < 
queue
->
timeout
.
iobuf˙t
; i++) {

215 
	`Ârötf
(
ouçutfûe
, "Sèã: %d, blkno: %d\n", 
tmp
->
°©e
,Åmp->
blkno
);

216 
tmp
 =Åmp->
√xt
;

219 
tmp
 = 
queue
->
¥i‹ôy
.
li°
->
√xt
;

220 
	`Ârötf
(
ouçutfûe
, "C⁄ã¡†o‡¥i‹ôy queue:Üi°À¿%d\n", 
queue
->
¥i‹ôy
.
li°Àn
);

221 
i
 = 0; i < 
queue
->
¥i‹ôy
.
iobuf˙t
; i++) {

222 
	`Ârötf
(
ouçutfûe
, "Sèã: %d, blkno: %d\n", 
tmp
->
°©e
,Åmp->
blkno
);

223 
tmp
 =Åmp->
√xt
;

225 
	}
}

228 
	$ioqueue_¥öt_subqueue_°©e
 (
subqueue
 *
queue
)

230 
i
;

231 
iobuf
 *
tmp
;

233 
tmp
 = 
queue
->
li°
->
√xt
;

234 
	`Ârötf
(
ouçutfûe
, "\nC⁄ã¡†o‡subqueue:Üi°À¿%d\n", 
queue
->
li°Àn
);

235 
	`Ârötf
(
ouçutfûe
, "Subqueuê°©e:Üa°blknÿ%d,Üa°cy ÿ%d,Üa°surÁ˚ %d, dú %d\n", 
queue
->
œ°blkno
, queue->
œ°cy o
, queue->
œ°surÁ˚
, queue->
dú
);

236 
i
 = 0; i < 
queue
->
iobuf˙t
; i++) {

237 
	`Ârötf
(
ouçutfûe
, "Sèã: %d, blkno: %d, cy ÿ%d, surÁ˚ %d\n", 
tmp
->
°©e
,Åmp->
blkno
,Åmp->
cylödî
,Åmp->
surÁ˚
);

238 
tmp
 =Åmp->
√xt
;

240 
	}
}

243 
	$ioqueue_gë_numbî_ö_queue
 (
ioqueue
 *
queue
)

245 (
queue
->
ba£
.
li°Àn
 + queue->
timeout
.li°À¿+ queue->
¥i‹ôy
.listlen);

246 
	}
}

249 
	$ioqueue_gë_numbî_≥ndög
 (
ioqueue
 *
queue
)

251 
num≥nd
 = 0;

253 
num≥nd
 +
queue
->
ba£
.
li°Àn
 - queue->ba£.
numout°™dög
;

254 
num≥nd
 +
queue
->
timeout
.
li°Àn
 - queue->timeout.
numout°™dög
;

255 
num≥nd
 +
queue
->
¥i‹ôy
.
li°Àn
 - queue->¥i‹ôy.
numout°™dög
;

256 (
num≥nd
);

257 
	}
}

260 
	$ioqueue_gë_ªqout°™dög
 (
ioqueue
 *
queue
)

262 
numout
 = 0;

264 
numout
 +
queue
->
ba£
.
ªqout°™dög
;

265 
numout
 +
queue
->
timeout
.
ªqout°™dög
;

266 
numout
 +
queue
->
¥i‹ôy
.
ªqout°™dög
;

267 (
numout
);

268 
	}
}

271 
	$ioqueue_gë_numbî_of_ªque°s
 (
ioqueue
 *
queue
)

273 
numªqs
 = 0;

275 
numªqs
 +
queue
->
ba£
.
numcom∂ëe
 + queue->ba£.
li°Àn
;

276 
numªqs
 +
queue
->
timeout
.
numcom∂ëe
 + queue->timeout.
li°Àn
;

277 
numªqs
 +
queue
->
¥i‹ôy
.
numcom∂ëe
 + queue->¥i‹ôy.
li°Àn
;

278 (
numªqs
);

279 
	}
}

282 
	$ioqueue_gë_numbî_of_ªque°s_öôüãd
 (
ioqueue
 *
queue
)

284 
numªqs
 = 0;

286 
numªqs
 +
queue
->
ba£
.
numcom∂ëe
 + queue->ba£.
numout°™dög
;

287 
numªqs
 +
queue
->
timeout
.
numcom∂ëe
 + queue->timeout.
numout°™dög
;

288 
numªqs
 +
queue
->
¥i‹ôy
.
numcom∂ëe
 + queue->¥i‹ôy.
numout°™dög
;

289 (
numªqs
);

290 
	}
}

293 
	$ioqueue_gë_di°
 (
ioqueue
 *
queue
, 
blkno
)

295 
œ°blkno
;

297 i‡(
queue
->
œ°subqueue
 =
IOQUEUE_BASE
) {

298 
œ°blkno
 = 
queue
->
ba£
.lastblkno;

299 } i‡(
queue
->
œ°subqueue
 =
IOQUEUE_TIMEOUT
) {

300 
œ°blkno
 = 
queue
->
timeout
.lastblkno;

301 } i‡(
queue
->
œ°subqueue
 =
IOQUEUE_PRIORITY
) {

302 
œ°blkno
 = 
queue
->
¥i‹ôy
.lastblkno;

304 
	`Ârötf
(
°dîr
, "Unknow¿queuêidítifiˇti⁄áàioqueue_gë_di° - %d\n", 
queue
->
œ°subqueue
);

305 
	`exô
(1);

307 (
	`abs
(
blkno
 - 
œ°blkno
));

308 
	}
}

312 
	$ioqueue_gë_cylödî_m≠pög
(
ioqueue
 *
queue
,

313 
iobuf
 *
cuº
,

314 
blkno
,

315 *
cyÕå
,

316 *
surÂå
,

317 
cylm≠ty≥
)

319 
cylm≠ty≥
 = (cylm≠ty≥ =-1Ë? 
queue
->cylmaptype : cylmaptype;

320 
cylm≠ty≥
) {

321 
MAP_NONE
:

322 *
cyÕå
 = 0;

323 *
surÂå
 = 0;

327 
MAP_IGNORESPARING
:

328 
MAP_ZONEONLY
:

329 
MAP_ADDSLIPS
:

330 
MAP_FULL
:

331 
	`devi˚_gë_m≠pög
(
cylm≠ty≥
,

332 
cuº
->
iﬁi°
->
devno
,

333 
blkno
,

334 
cyÕå
,

335 
surÂå
,

336 
NULL
);

340 
MAP_FROMTRACE
:

344 *
cyÕå
 = (Ë
cuº
->
iﬁi°
->
buf
;

345 *
surÂå
 = 0;

348 
MAP_AVGCYLMAP
:

349 *
cyÕå
 = 
blkno
 / 
queue
->
£˘≥rcyl
;

350 *
surÂå
 = 0;

354 
	`Ârötf
(
°dîr
, "Unknow¿cylödî m≠pögÅy≥: %d\n", 
queue
->
cylm≠ty≥
);

355 
	`exô
(1);

358 i‡((
cyÕå
 !
NULL
Ë&& (
surÂå
 != NULL)) {

364 
	}
}

367 
ioqueue_£t_c⁄ˇtok_fun˘i⁄
 (
ioqueue
 *
queue
, (**
c⁄ˇtok
)(*,,,,), *
c⁄ˇtok∑øm
)

369 
queue
->
c⁄ˇtok
 = concatok;

370 
queue
->
c⁄ˇtok∑øm
 = concatokparam;

371 
	}
}

374 
ioqueue_£t_idÀw‹k_fun˘i⁄
 (
ioqueue
 *
queue
, (**
idÀw‹k
)(*,), *
idÀw‹k∑øm
, 
idÀdñay
)

376 
queue
->
idÀw‹k
 = idlework;

377 
queue
->
idÀw‹k∑øm
 = idleworkparam;

378 
queue
->
idÀdñay
 = idledelay;

379 
queue
->
idÀdëe˘
 = 
NULL
;

380 
	}
}

383 
ioqueue_£t_íabÀmít_fun˘i⁄
 (
ioqueue
 *
queue
, (**
íabÀmít
)(
i‹eq_evít
 *))

385 
queue
->
ba£
.
íabÀmít
 =Énablement;

386 
queue
->
timeout
.
íabÀmít
 =Énablement;

387 
queue
->
¥i‹ôy
.
íabÀmít
 =Énablement;

388 
	}
}

391 
	$ioqueue_idÀdëe˘ed
 (
timî_evít
 *
timîeq
)

393 
ioqueue
 *
queue
 = (ioqueuê*Ë
timîeq
->
±r
;

395 
queue
->
idÀdëe˘
 = 
NULL
;

396 (*
queue
->
idÀw‹k
)(queue->
idÀw‹k∑øm
, queue->
devno
);

397 
	`addt€xåaq
((
evít
 *)
timîeq
);

398 
	}
}

401 
	$ioqueue_ª£t_idÀdëe˘î
 (
ioqueue
 *
queue
, 
timech™ge
)

403 
timî_evít
 *
idÀdëe˘
 = 
queue
->idledetect;

404 
li°Àn
 = 
queue
->
ba£
.li°À¿+ queue->
timeout
.li°À¿+ queue->
¥i‹ôy
.listlen;

406 i‡((
li°Àn
Ë|| ((
idÀdëe˘
Ë&& (!
timech™ge
))) {

409 i‡(
idÀdëe˘
) {

410 i‡(!(
	`ªmove‰omötq
((
evít
 *)
idÀdëe˘
))) {

411 
	`Ârötf
(
°dîr
, "existing idledetectÉventÇot on intq in ioqueue_reset_idledetecter\n");

412 
	`exô
(1);

415 
idÀdëe˘
 = (
timî_evít
 *Ë
	`gë‰omexåaq
();

416 
idÀdëe˘
->
ty≥
 = 
TIMER_EXPIRED
;

417 
idÀdëe˘
->
func
 = &
disksim
->
timîfunc_ioqueue
;

418 
idÀdëe˘
->
±r
 = 
queue
;

419 
queue
->
idÀdëe˘
 = idledetect;

421 
idÀdëe˘
->
time
 = 
simtime
 + 
queue
->
idÀdñay
;

422 
	`addtoötq
((
evít
 *)
idÀdëe˘
);

423 
	}
}

426 
	$ioqueue_upd©e_¨rivÆ_°©s
 (
ioqueue
 *
queue
, 
i‹eq_evít
 *
cuº
)

428 
tdiff
;

430 i‡(
queue
->
¥ötöèº°©s
) {

431 
tdiff
 = 
simtime
 - 
queue
->
œ°¨r
;

432 
queue
->
œ°¨r
 = 
simtime
;

433 
	`°©_upd©e
(&
queue
->
öèº°©s
, 
tdiff
);

434 i‡(
cuº
->
Êags
 & 
READ
) {

435 
tdiff
 = 
simtime
 - 
queue
->
œ°ªad
;

436 
queue
->
œ°ªad
 = 
simtime
;

437 
	`°©_upd©e
(&
queue
->
ªadöèº°©s
, 
tdiff
);

439 
tdiff
 = 
simtime
 - 
queue
->
œ°wrôe
;

440 
queue
->
œ°wrôe
 = 
simtime
;

441 
	`°©_upd©e
(&
queue
->
wrôeöèº°©s
, 
tdiff
);

444 i‡(
queue
->
¥ötsize°©s
) {

445 
	`°©_upd©e
(&
queue
->
ªqsize°©s
, (Ë
cuº
->
bcou¡
);

446 i‡(
cuº
->
Êags
 & 
READ
) {

447 
	`°©_upd©e
(&
queue
->
ªadsize°©s
, (Ë
cuº
->
bcou¡
);

449 
	`°©_upd©e
(&
queue
->
wrôesize°©s
, (Ë
cuº
->
bcou¡
);

452 i‡(
cuº
->
blkno
 =
queue
->
£qblkno
) {

453 i‡((
cuº
->
Êags
 & 
READ
Ë&& (
queue
->
£qÊags
 & READ)) {

454 
queue
->
£qªads
++;

455 } i‡(!(
cuº
->
Êags
 & 
READ
Ë&& !(
queue
->
£qÊags
 & READ)) {

456 
queue
->
£qwrôes
++;

459 
queue
->
£qblkno
 = 
cuº
->
blkno
 + cuº->
bcou¡
;

460 
queue
->
£qÊags
 = 
cuº
->
Êags
;

461 
	}
}

464 
	$ioqueue_upd©e_subqueue_°©i°ics
 (
subqueue
 *
queue
)

466 
tdiff
 = 
simtime
 - 
queue
->
œ°Æt
;

468 
queue
->
ru∆i°Àn
 +
tdiff
 * queue->
li°Àn
;

469 
queue
->
ruƒódÀn
 +
tdiff
 * queue->
ªadÀn
;

470 i‡(
queue
->
ªadÀn
 > queue->
maxªadÀn
) {

471 
queue
->
maxªadÀn
 = queue->
ªadÀn
;

473 i‡((
queue
->
li°Àn
 - queue->
ªadÀn
Ë> queue->
maxwrôñí
) {

474 
queue
->
maxwrôñí
 = queue->
li°Àn
 - queue->
ªadÀn
;

476 
queue
->
runout°™dög
 +
tdiff
 * queue->
numout°™dög
;

477 i‡(
queue
->
numout°™dög
 > queue->
maxout°™dög
) {

478 
queue
->
maxout°™dög
 = queue->
numout°™dög
;

480 i‡(
queue
->
li°Àn
 > queue->
maxli°Àn
) {

481 
queue
->
maxli°Àn
 = queue->
li°Àn
;

483 i‡((
queue
->
li°Àn
 - queue->
numout°™dög
Ë> queue->
maxqÀn
) {

484 
queue
->
maxqÀn
 = queue->
li°Àn
 - queue->
numout°™dög
;

486 
queue
->
œ°Æt
 = 
simtime
;

487 
	}
}

488 
ªmove_t•s
(
iobuf
 *
tmp
);

490 
	$ioqueue_ªmove_‰om_subqueue
 (
subqueue
 *
queue
, 
iobuf
 *
tmp
)

492 if(
queue
->
sched_Æg
 =
TSPS
){

493 
	`ªmove_t•s
(
tmp
);

496 i‡((
queue
->
li°
 =
tmp
Ë&& (tm∞=tmp->
√xt
)) {

497 
queue
->
li°
 = 
NULL
;

499 
tmp
->
√xt
->
¥ev
 =Åmp->prev;

500 
tmp
->
¥ev
->
√xt
 =Åmp->next;

501 i‡(
queue
->
li°
 =
tmp
) {

502 
queue
->
li°
 = 
tmp
->
¥ev
;

505 
tmp
->
√xt
 = 
NULL
;

506 
tmp
->
¥ev
 = 
NULL
;

507 
	}
}

509 
	$ioqueue_ªmove_‰om_b©ch_fcfs_subqueue
 (
subqueue
 *
queue
, 
iobuf
 *
tmp
, 
i‹eq_evít
 *
d⁄e
)

511 if(
queue
->
sched_Æg
 =
TSPS
){

512 
	`ªmove_t•s
(
tmp
);

515 i‡((
queue
->
li°
 =
tmp
Ë&& (tm∞=tmp->
√xt
)) {

516 
queue
->
li°
 = 
NULL
;

518 
tmp
->
√xt
->
¥ev
 =Åmp->prev;

519 
tmp
->
¥ev
->
√xt
 =Åmp->next;

520 i‡(
queue
->
li°
 =
tmp
) {

521 
queue
->
li°
 = 
tmp
->
¥ev
;

524 
tmp
->
√xt
 = 
NULL
;

525 
tmp
->
¥ev
 = 
NULL
;

526 
	}
}

528 
	$ioqueue_ö£π_b©ch_fcfs_to_queue
 (
subqueue
 *
queue
, 
iobuf
 *
√w_iobuf
)

530 
iobuf
 *
tmp
;

531 
iobuf
 *
fú°_ö_b©ch
 = 
NULL
;

532 
i‹eq_evít
 *
evít_±r
;

533 
i
;

537 
queue
->
iobuf˙t
--;

540 
queue
->
iobuf˙t
++;

543 i‡(
√w_iobuf
->
b©chno
 == -1) {

544 
√w_iobuf
->
√xt
 = 
queue
->
li°
->next;

545 
√w_iobuf
->
¥ev
 = 
queue
->
li°
;

546 
√w_iobuf
->
√xt
->
¥ev
 =Çew_iobuf;

547 
√w_iobuf
->
¥ev
->
√xt
 =Çew_iobuf;

548 
queue
->
li°
 = 
√w_iobuf
;

550 
√w_iobuf
->
b©ch_com∂ëe
 = 
TRUE
;

562 
tmp
 = 
queue
->
li°
;

564 
i
 = 0; i < (
queue
->
iobuf˙t
 - 1); i++) {

565 i‡(
tmp
->
b©chno
 =
√w_iobuf
->batchno) {

567 
evít_±r
 = 
tmp
->
b©ch_li°
;

569 
evít_±r
->
b©ch_√xt
 !
NULL
) {

570 
evít_±r
 =Évít_±r->
b©ch_√xt
;

573 
evít_±r
->
b©ch_√xt
 = 
√w_iobuf
->
iﬁi°
;

574 
evít_±r
->
b©ch_√xt
->
b©ch_¥ev
 =Évent_ptr;

575 
evít_±r
->
b©ch_√xt
->b©ch_√xà
NULL
;

577 i‡(
√w_iobuf
->
iﬁi°
->
b©ch_com∂ëe
 =
TRUE
) {

578 
tmp
->
b©ch_com∂ëe
 = 
TRUE
;

580 
tmp
->
b©ch_com∂ëe
 = 
FALSE
;

583 
tmp
->
b©ch_size
++;

584 
tmp
->
ªq˙t
++;

588 
queue
->
iobuf˙t
--;

589 
	`addt€xåaq
((
evít
 *)
√w_iobuf
);

596 
tmp
 =Åmp->
√xt
;

601 
√w_iobuf
->
√xt
 = 
queue
->
li°
->next;

602 
√w_iobuf
->
¥ev
 = 
queue
->
li°
;

603 
√w_iobuf
->
√xt
->
¥ev
 =Çew_iobuf;

604 
√w_iobuf
->
¥ev
->
√xt
 =Çew_iobuf;

605 
queue
->
li°
 = 
√w_iobuf
;

607 
√w_iobuf
->
b©ch_size
 = 1;

613 
	}
}

618 
	$ioqueue_ö£π_fcfs_to_queue
 (
subqueue
 *
queue
, 
iobuf
 *
ãmp
)

620 
ãmp
->
√xt
 = 
queue
->
li°
->next;

621 
ãmp
->
¥ev
 = 
queue
->
li°
;

622 
ãmp
->
√xt
->
¥ev
 =Åemp;

623 
ãmp
->
¥ev
->
√xt
 =Åemp;

624 
queue
->
li°
 = 
ãmp
;

625 
	}
}

630 
	$ioqueue_ö£π_‹dîed_to_queue
 (
subqueue
 *
queue
, 
iobuf
 *
ãmp
)

632 
iobuf
 *
hód
;

633 
iobuf
 *
run
;

635 
hód
 = 
queue
->
li°
->
√xt
;

637 i‡((
ãmp
->
cylödî
 < 
hód
->cylinder) ||

638 ((
ãmp
->
cylödî
 =
hód
->cylinder) &&

639 (
ãmp
->
surÁ˚
 < 
hód
->surface)) ||

640 ((
ãmp
->
cylödî
 =
hód
->cylinder) &&

641 (
ãmp
->
surÁ˚
 =
hód
->surface) &&

642 (
ãmp
->
blkno
 < 
hód
->blkno))) {

643 
queue
->
li°
->
√xt
 = 
ãmp
;

644 
ãmp
->
√xt
 = 
hód
;

645 
ãmp
->
¥ev
 = 
queue
->
li°
;

646 
hód
->
¥ev
 = 
ãmp
;

648 } i‡((
ãmp
->
cylödî
 > 
queue
->
li°
->cylinder) ||

649 ((
ãmp
->
cylödî
 =
queue
->
li°
->cylinder) &&

650 (
ãmp
->
surÁ˚
 > 
queue
->
li°
->surface)) ||

651 ((
ãmp
->
cylödî
 =
queue
->
li°
->cylinder) &&

652 (
ãmp
->
surÁ˚
 =
queue
->
li°
->surface) &&

653 (
ãmp
->
blkno
 >
queue
->
li°
->blkno))) {

654 
ãmp
->
√xt
 = 
hód
;

655 
ãmp
->
¥ev
 = 
queue
->
li°
;

656 
hód
->
¥ev
 = 
ãmp
;

657 
queue
->
li°
->
√xt
 = 
ãmp
;

658 
queue
->
li°
 = 
ãmp
;

660 
run
 = 
hód
;

661 (
ãmp
->
cylödî
 > 
run
->
√xt
->cylinder) ||

662 ((
ãmp
->
cylödî
 =
run
->
√xt
->cylinder) &&

663 (
ãmp
->
surÁ˚
 > 
run
->
√xt
->surface)) ||

664 ((
ãmp
->
cylödî
 =
run
->
√xt
->cylinder) &&

665 (
ãmp
->
surÁ˚
 =
run
->
√xt
->surface) &&

666 (
ãmp
->
blkno
 >
run
->
√xt
->blkno))) {

667 
run
 =Ñun->
√xt
;

669 
ãmp
->
√xt
 = 
run
->next;

670 
ãmp
->
¥ev
 = 
run
;

671 
ãmp
->
√xt
->
¥ev
 =Åemp;

672 
run
->
√xt
 = 
ãmp
;

674 
	}
}

677 
	$ioqueue_check_c⁄ˇt
 (
subqueue
 *
queue
, 
iobuf
 *
ªq1
, iobu‡*
ªq2
, 
c⁄ˇtmax
)

679 
i‹eq_evít
 *
tmp
;

680 
£qscheme
 = 
queue
->
bigqueue
->seqscheme;

681 (**
c⁄ˇtok
)(*,,,,Ë
queue
->
bigqueue
->concatok;

682 *
c⁄ˇtok∑øm
 = 
queue
->
bigqueue
->concatokparam;

684 i‡(
ªq1
->
√xt
 !
ªq2
) {

685 
	`Ârötf
(
°dîr
, "Non-adjacentÑequests sentÅo ioqueue_check_concat\n");

686 
	`exô
(1);

688 i‡(
ªq1
->
Êags
 & 
READ
) {

689 i‡(!(
£qscheme
 & 
IOQUEUE_CONCAT_READS
Ë|| !(
ªq2
->
Êags
 & 
READ
)) {

693 i‡(!(
£qscheme
 & 
IOQUEUE_CONCAT_WRITES
Ë|| (
ªq2
->
Êags
 & 
READ
)) {

697 i‡((
ªq1
 =
queue
->
li°
Ë|| (ªq1 =
ªq2
Ë|| !
	`READY_TO_GO
‘eq1,queueË|| !READY_TO_GO‘eq2,queueË|| (‘eq1->
blkno
 +Ñeq1->
tŸÆsize
Ë!ªq2->blknoË|| (‘eq1->tŸÆsizê+Ñeq2->tŸÆsizeË> 
c⁄ˇtmax
)) {

700 i‡(
c⁄ˇtok
) {

701 i‡((*
c⁄ˇtok
)(
c⁄ˇtok∑øm
, 
ªq1
->
blkno
,Ñeq1->
tŸÆsize
, 
ªq2
->blkno,Ñeq2->totalsize) == 0) {

705 
tmp
 = 
ªq1
->
iﬁi°
;

706 i‡(
tmp
 =
NULL
) {

707 
ªq1
->
iﬁi°
 = 
ªq2
->iolist;

709 
tmp
->
√xt
) {

710 
tmp
 =Åmp->
√xt
;

712 
tmp
->
√xt
 = 
ªq2
->
iﬁi°
;

714 
ªq1
->
√xt
 = 
ªq2
->next;

715 
ªq1
->
√xt
->
¥ev
 =Ñeq1;

716 
ªq1
->
ªq˙t
 +
ªq2
->reqcnt;

717 
ªq1
->
tŸÆsize
 +
ªq2
->totalsize;

718 i‡(
queue
->
li°
 =
ªq2
) {

719 
queue
->
li°
 = 
ªq1
;

721 
queue
->
iobuf˙t
--;

722 
	`addt€xåaq
((
evít
 *Ë
ªq2
);

724 
	}
}

727 
	$ioqueue_ö£π_√w_ªque°
 (
subqueue
 *
queue
, 
iobuf
 *
ãmp
)

729 
c⁄ˇtmax
;

733 
	`ioqueue_upd©e_subqueue_°©i°ics
(
queue
);

734 
queue
->
iobuf˙t
++;

735 
queue
->
li°Àn
++;

736 i‡(
ãmp
->
Êags
 & 
READ
) {

737 
queue
->
ªadÀn
++;

738 
queue
->
numªads
++;

740 
queue
->
numwrôes
++;

743 i‡(
queue
->
li°
 =
NULL
) {

744 
queue
->
li°
 = 
ãmp
;

745 
ãmp
->
√xt
 =Åemp;

746 
ãmp
->
¥ev
 =Åemp;

747 i‡((
queue
->
sched_Æg
 =
BATCH_FCFS
Ë&& (
ãmp
->
b©chno
 != -1)) {

748 
ãmp
->
b©ch_size
 = 1;

749 
ãmp
->
b©ch_li°
 =Åemp->
iﬁi°
;

752 i‡((
queue
->
sched_Æg
 =
FCFS
Ë|| (queue->sched_Æg =
PRI_VSCAN_LBN
)) {

753 
	`ioqueue_ö£π_fcfs_to_queue
(
queue
, 
ãmp
);

754 } i‡(
queue
->
sched_Æg
 =
BATCH_FCFS
) {

755 
	`ioqueue_ö£π_b©ch_fcfs_to_queue
(
queue
, 
ãmp
);

758 
	`ioqueue_ö£π_‹dîed_to_queue
(
queue
, 
ãmp
);

761 
c⁄ˇtmax
 = 
queue
->
bigqueue
->concatmax;

762 i‡(
c⁄ˇtmax
) {

763 
ãmp
 =Åemp->
¥ev
;

764 i‡(!(
	`ioqueue_check_c⁄ˇt
(
queue
, 
ãmp
,Åemp->
√xt
, 
c⁄ˇtmax
))) {

765 
ãmp
 =Åemp->
√xt
;

767 
	`ioqueue_check_c⁄ˇt
(
queue
, 
ãmp
,Åemp->
√xt
, 
c⁄ˇtmax
);

770 
	}
}

777 
	$ioqueue_£q°ªam_hód
 (
ioqueue
 *
queue
, 
iobuf
 *
li°hód
, iobu‡*
cuºít
)

779 
idiff
;

780 
ªt
 = 0;

782 i‡(!(
queue
->
£qscheme
 & (
IOQUEUE_SEQSTREAM_READS
|
IOQUEUE_SEQSTREAM_WRITES
|
IOQUEUE_SEQSTREAM_EITHER
))) {

785 
idiff
 = 
queue
->
£q°ªamdiff
;

786 i‡((
cuºít
 =
li°hód
Ë|| !
	`READY_TO_GO
(cuºít->
¥ev
,(&
queue
->
ba£
))) {

787 
ªt
 = 1;

789 i‡(
ªt
 == 0) {

790 i‡(
cuºít
->
Êags
 & 
READ
) {

791 i‡(
cuºít
->
¥ev
->
Êags
 & 
READ
) {

792 i‡(!(
queue
->
£qscheme
 & (
IOQUEUE_SEQSTREAM_READS
|
IOQUEUE_SEQSTREAM_EITHER
))) {

793 
ªt
 = 1;

796 i‡(!(
queue
->
£qscheme
 & 
IOQUEUE_SEQSTREAM_EITHER
)) {

797 
ªt
 = 1;

800 i‡((
cuºít
->
¥ev
->
blkno
 !cuºít->blknoË&& (((cuºít->¥ev->blknÿ+ cuºít->¥ev->
tŸÆsize
 + 
idiff
) < current->blkno))) {

801 
ªt
 = 1;

804 i‡(
cuºít
->
¥ev
->
Êags
 & 
READ
) {

805 i‡(!(
queue
->
£qscheme
 & 
IOQUEUE_SEQSTREAM_EITHER
)) {

806 
ªt
 = 1;

809 i‡(!(
queue
->
£qscheme
 & (
IOQUEUE_SEQSTREAM_WRITES
|
IOQUEUE_SEQSTREAM_EITHER
))) {

810 
ªt
 = 1;

813 i‡((
cuºít
->
¥ev
->
blkno
 !cuºít->blknoË&& ((cuºít->¥ev->blknÿ+ cuºít->¥ev->
tŸÆsize
) != current->blkno)) {

814 
ªt
 = 1;

818 (
ªt
);

819 
	}
}

824 
iobuf
 * 
	$ioqueue_gë_ªque°_‰om_fcfs_queue
 (
subqueue
 *
queue
)

826 
iobuf
 *
tmp
;

827 
i
;

829 
tmp
 = 
queue
->
li°
->
√xt
;

830 
i
 = 0; i < 
queue
->
iobuf˙t
; i++) {

831 i‡(
queue
->
f‹˚_absﬁuã_fcfs
) {

832 i‡(
tmp
->
°©e
 =
WAITING
) {

833 i‡(
	`READY_TO_GO
(
tmp
,
queue
)) {

834 (
tmp
);

836 (
NULL
);

840 i‡(
	`READY_TO_GO
(
tmp
,
queue
)) {

841 (
tmp
);

844 
tmp
 =Åmp->
√xt
;

846 (
NULL
);

847 
	}
}

852 
	$ioqueue_gë_¥i‹ôy_Àvñ
 (
ioqueue
 *ioqueue, 
iobuf
 *
ªq
)

854 
ªt
 = 0;

856 i‡(
ioqueue
->
¥i‹ôy_mix
 == 1) {

857 i‡((
ªq
->
Êags
 & 
TIME_CRITICAL
Ë|| (ªq->Êag†& 
READ
)) {

858 
ªt
 = 1;

860 } i‡(
ioqueue
->
¥i‹ôy_mix
 == 2) {

861 i‡(
ªq
->
Êags
 & 
TIME_CRITICAL
) {

862 
ªt
 = 2;

863 } i‡(
ªq
->
Êags
 & 
READ
) {

864 
ªt
 = 1;

866 } i‡(
ioqueue
->
¥i‹ôy_mix
 == 3) {

867 i‡(
ªq
->
Êags
 & 
READ
) {

868 
ªt
 = 2;

869 } i‡(
ªq
->
Êags
 & 
TIME_CRITICAL
) {

870 
ªt
 = 1;

872 } i‡(
ioqueue
->
¥i‹ôy_mix
 == 4) {

873 i‡(
ªq
->
Êags
 & 
TIME_CRITICAL
) {

874 
ªt
 = (
ªq
->
Êags
 & 
READ
) ? 2 : 3;

876 
ªt
 = (
ªq
->
Êags
 & 
READ
) ? 1 : 0;

878 } i‡(
ioqueue
->
¥i‹ôy_mix
 == 5) {

879 i‡(
ªq
->
Êags
 & 
READ
) {

880 
ªt
 = 1;

882 } i‡(
ioqueue
->
¥i‹ôy_mix
 == 6) {

883 i‡(
ªq
->
Êags
 & 
TIME_CRITICAL
) {

884 
ªt
 = 1;

887 (
ªt
);

888 
	}
}

891 
iobuf
 * 
	$ioqueue_gë_ªque°_‰om_¥i_lbn_vsˇn_queue
 (
subqueue
 *
queue
, 
numlbns
, 
vsˇn_vÆue
)

893 
schedÆg
;

894 
¥i‹ôy_Á˘‹
;

895 
age_Á˘‹
;

896 
iobuf
 *
tmp
;

897 
cuº_efÂri
 = 0, 
be°_efÂri
 = 0;

898 
iobuf
 *
ªt
 = 
NULL
;

899 
i
;

901 
schedÆg
 = 
queue
->
bigqueue
->
timeout
.
sched_Æg
;

902 
¥i‹ôy_Á˘‹
 = 
queue
->
bigqueue
->
¥i‹ôy
.
sched_Æg
;

903 
age_Á˘‹
 = 
queue
->
bigqueue
->
to_time
;

904 i‡(
schedÆg
 =
ELEVATOR_LBN
) {

905 
vsˇn_vÆue
 = 
numlbns
;

906 } i‡(
schedÆg
 =
SSTF_LBN
) {

907 
vsˇn_vÆue
 = 0;

909 
tmp
 = 
queue
->
li°
->
√xt
;

910 
i
 = 0; i < 
queue
->
iobuf˙t
; i++) {

911 i‡(
	`READY_TO_GO
(
tmp
,
queue
)) {

912 
cuº_efÂri
 = 
tmp
->
blkno
 - 
queue
->
œ°blkno
;

913 i‡(
schedÆg
 =
CYCLE_LBN
) {

914 i‡(
cuº_efÂri
 < 0) {

915 
cuº_efÂri
 +
numlbns
;

917 } i‡(
cuº_efÂri
) {

918 i‡(
cuº_efÂri
 < 0) {

919 
cuº_efÂri
 = -curr_effpri;

920 i‡(
queue
->
dú
 =
ASC
) {

921 
cuº_efÂri
 +
vsˇn_vÆue
;

924 i‡(
queue
->
dú
 =
DESC
) {

925 
cuº_efÂri
 +
vsˇn_vÆue
;

929 
cuº_efÂri
 = 
numlbns
 - curr_effpri;

930 
cuº_efÂri
 +(
¥i‹ôy_Á˘‹
 * 
numlbns
 * 
	`ioqueue_gë_¥i‹ôy_Àvñ
(
queue
->
bigqueue
, 
tmp
)) / 100;

931 
cuº_efÂri
 +(
age_Á˘‹
 * (Ë(
simtime
 - 
tmp
->
°¨âime
)) / 1280;

932 i‡((
ªt
 =
NULL
Ë|| (
cuº_efÂri
 > 
be°_efÂri
)) {

933 
ªt
 = 
tmp
;

934 
be°_efÂri
 = 
cuº_efÂri
;

937 
tmp
 =Åmp->
√xt
;

939 (
ªt
);

940 
	}
}

945 
iobuf
 * 
	$ioqueue_gë_ªque°_‰om_lbn_sˇn_queue
 (
subqueue
 *
queue
)

947 
iobuf
 *
ãmp
;

948 
iobuf
 *
°›
;

950 
ãmp
 = 
queue
->
li°
->
√xt
;

951 
°›
 = 
ãmp
;

952 i‡(
queue
->
œ°blkno
 > 
ãmp
->
blkno
) {

953 (
ãmp
->
√xt
 !
°›
Ë&& (
queue
->
œ°blkno
 >Åemp->√xt->
blkno
)) {

954 
ãmp
 =Åemp->
√xt
;

956 
ãmp
 =Åemp->
√xt
;

958 
°›
 = 
ãmp
;

959 (
ãmp
->
√xt
 !
°›
Ë&& !
	`READY_TO_GO
—emp,
queue
)) {

960 
ãmp
 =Åemp->
√xt
;

962 i‡((
ãmp
->
√xt
 =
°›
Ë&& !
	`READY_TO_GO
—emp,
queue
)) {

963 
ãmp
 = 
NULL
;

965 (
ãmp
);

966 
	}
}

971 
iobuf
 * 
	$ioqueue_gë_ªque°_‰om_lbn_vsˇn_queue
 (
subqueue
 *
queue
, 
vÆue
)

973 
iobuf
 *
ãmp
;

974 
iobuf
 *
hód
;

975 
iobuf
 *
t›
 = 
NULL
;

976 
iobuf
 *
bŸtom
 = 
NULL
;

977 
diff1
, 
diff2
;

978 
tmpdú
;

979 
iobuf
 *
be°bŸtom
;

981 
tmpdú
 = 
queue
->
dú
;

982 
ãmp
 = 
queue
->
li°
->
√xt
;

983 
hód
 = 
queue
->
li°
->
√xt
;

985 (
ãmp
->
√xt
 !
hód
Ë&& (
queue
->
œ°blkno
 >Åemp->√xt->
blkno
)) {

986 
ãmp
 =Åemp->
√xt
;

988 i‡(
ãmp
->
blkno
 < 
queue
->
œ°blkno
) {

989 
bŸtom
 = 
ãmp
;

990 (
bŸtom
 !
hód
Ë&& !
	`READY_TO_GO
(bŸtom,
queue
)) {

991 
bŸtom
 = bŸtom->
¥ev
;

993 i‡((
bŸtom
 =
hód
Ë&& !
	`READY_TO_GO
(bŸtom,
queue
)) {

994 
bŸtom
 = 
NULL
;

996 
be°bŸtom
 = 
bŸtom
;

997 (
bŸtom
 !
hód
Ë&& ((bŸtom->
¥ev
->
blkno
 =
be°bŸtom
->blknoË|| (!(
	`ioqueue_£q°ªam_hód
(
queue
->
bigqueue
, head, bottom))))) {

998 
bŸtom
 = bŸtom->
¥ev
;

999 
be°bŸtom
 = (
	`READY_TO_GO
(
bŸtom
,
queue
)) ? bottom : bestbottom;

1001 
bŸtom
 = 
be°bŸtom
;

1004 i‡(
ãmp
->
√xt
 !
hód
) {

1005 i‡(
ãmp
->
blkno
 >
queue
->
œ°blkno
) {

1006 
t›
 = 
ãmp
;

1008 
t›
 = 
ãmp
->
√xt
;

1010 (
t›
->
√xt
 !
hód
Ë&& !
	`READY_TO_GO
—›,
queue
)) {

1011 
t›
 =Å›->
√xt
;

1014 i‡((
t›
 =
NULL
Ë|| !
	`READY_TO_GO
—›,
queue
Ë|| (!(
	`ioqueue_£q°ªam_hód
(queue->
bigqueue
, 
hód
,Åop)))) {

1015 
ãmp
 = 
bŸtom
;

1016 } i‡((
bŸtom
 =
NULL
Ë|| !
	`READY_TO_GO
(bŸtom,
queue
)) {

1017 
ãmp
 = 
t›
;

1019 
diff1
 = 
	`diff
(
t›
->
blkno
, 
queue
->
œ°blkno
);

1020 
diff2
 = 
	`diff
(
queue
->
œ°blkno
, 
bŸtom
->
blkno
);

1021 i‡(
queue
->
dú
 =
ASC
) {

1022 
diff2
 = (diff2Ë? (diff2 + 
vÆue
) : diff2;

1024 
diff1
 = (diff1Ë? (diff1 + 
vÆue
) : diff1;

1026 i‡(
diff1
 < 
diff2
) {

1027 
ãmp
 = 
t›
;

1028 } i‡((
diff1
 > 
diff2
Ë|| (
queue
->
s°fupdown
)) {

1029 
ãmp
 = 
bŸtom
;

1031 
ãmp
 = 
t›
;

1033 i‡(
diff1
 =
diff2
) {

1034 
queue
->
s°fupdown
 = (queue->sstfupdown) ? 0 : 1;

1035 
queue
->
s°fupdown˙t
++;

1038 i‡(
ãmp
->
blkno
 !
queue
->
œ°blkno
) {

1039 
queue
->
dú
 = (
ãmp
->
blkno
 > queue->
œ°blkno
Ë? 
ASC
 : 
DESC
;

1041 
t›
 = (
ãmp
 =t›Ë? 
bŸtom
 :Åop;

1042 i‡((
t›
Ë&& 
	`READY_TO_GO
—›,
queue
)) {

1043 
cy o1
, 
cy o2
;

1044 
surÁ˚1
, 
surÁ˚2
;

1046 
	`ioqueue_gë_cylödî_m≠pög
(
queue
->
bigqueue
, 
ãmp
,Åemp->
blkno
, &
cy o1
, &
surÁ˚1
, 
MAP_FULL
);

1047 
	`ioqueue_gë_cylödî_m≠pög
(
queue
->
bigqueue
, 
t›
,Å›->
blkno
, &
cy o2
, &
surÁ˚2
, 
MAP_FULL
);

1048 
diff1
 = 
	`abs
(
cy o1
 - 
queue
->
›tcy o
);

1049 
diff2
 = 
	`abs
(
cy o2
 - 
queue
->
›tcy o
);

1050 i‡(((
tmpdú
 =
ASC
Ë&& (
ãmp
 !
bŸtom
)Ë|| (—mpdú =
DESC
) && (temp == bottom))) {

1051 i‡(
diff2
) {

1052 
diff2
 +(Ë(
queue
->
vsˇn_vÆue
 * (Ë
	`devi˚_gë_numcyls
(
ãmp
->
iﬁi°
->
devno
));

1054 } i‡(
diff1
) {

1055 i‡(
diff1
) {

1056 
diff1
 +(Ë(
queue
->
vsˇn_vÆue
 * (Ë
	`devi˚_gë_numcyls
(
ãmp
->
iﬁi°
->
devno
));

1059 i‡(
diff1
 > 
diff2
) {

1060 
	`°©_upd©e
(&
queue
->
öf›íÆty
, (Ë(
diff1
 - 
diff2
));

1064 } i‡((
diff1
 =
diff2
) && (diff1 == 0)) {

1065 i‡((
queue
->
›tsurÁ˚
 =
surÁ˚2
Ë&& (
surÁ˚1
 != surface2)) {

1066 
	`°©_upd©e
(&
queue
->
öf›íÆty
, () 0);

1070 (
ãmp
);

1071 
	}
}

1079 
iobuf
 *
	$ioqueue_idítify_ªque°_⁄_cylödî
 (
subqueue
 *
queue
)

1081 
iobuf
 *
ãmp
;

1082 
iobuf
 *
hód
;

1083 
iobuf
 *
cyl°›
;

1084 
iobuf
 *
surf°›
;

1086 
œ°cy o
;

1087 
œ°surÁ˚
;

1088 
œ°blkno
;

1090 
œ°cy o
 = 
queue
->lastcylno;

1091 
œ°surÁ˚
 = 
queue
->lastsurface;

1092 
œ°blkno
 = 
queue
->lastblkno;

1094 
hód
 = 
queue
->
li°
->
√xt
;

1095 
ãmp
 = 
hód
;

1097 i‡((
hód
->
cylödî
 < 
œ°cy o
Ë&& (œ°cy ÿ<
queue
->
li°
->cylinder)) {

1098 (
ãmp
->
√xt
 !
hód
Ë&& (
œ°cy o
 >Åemp->√xt->
cylödî
)) {

1099 
ãmp
 =Åemp->
√xt
;

1101 
ãmp
 =Åemp->
√xt
;

1104 i‡(
ãmp
->
cylödî
 !
œ°cy o
) {

1105 (
ãmp
);

1108 
cyl°›
 = 
ãmp
;

1110 (
ãmp
->
√xt
 !
hód
Ë&& (
œ°cy o
 =ãmp->√xt->
cylödî
Ë&& (
œ°surÁ˚
 >Åemp->
surÁ˚
)) {

1111 
ãmp
 =Åemp->
√xt
;

1114 i‡(
œ°surÁ˚
 > 
ãmp
->
surÁ˚
) {

1115 
ãmp
 = 
cyl°›
;

1117 } i‡(!
queue
->
surfovîf‹w
) {

1118 (
ãmp
->
√xt
 !
hód
Ë&& (
œ°cy o
 =ãmp->√xt->
cylödî
Ë&& (!
	`READY_TO_GO
—emp,
queue
Ë|| (ãmp->
blkno
 < 
œ°blkno
))) {

1119 
ãmp
 =Åemp->
√xt
;

1121 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (ãmp->
blkno
 >
œ°blkno
)) {

1122 (
ãmp
);

1124 
ãmp
 = 
cyl°›
;

1129 
surf°›
 = 
ãmp
;

1131 (
ãmp
->
√xt
 !
hód
Ë&& (
œ°cy o
 =ãmp->√xt->
cylödî
Ë&& (
œ°surÁ˚
 =ãmp->√xt->
surÁ˚
Ë&& (!
	`READY_TO_GO
—emp,
queue
Ë|| (ãmp->
blkno
 < 
œ°blkno
))) {

1132 
ãmp
 =Åemp->
√xt
;

1134 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (ãmp->
blkno
 >
œ°blkno
Ë&& (ãmp->
surÁ˚
 =
œ°surÁ˚
)) {

1135 (
ãmp
);

1138 
ãmp
 = 
surf°›
;

1140 (
ãmp
->
√xt
 !
hód
Ë&& (
œ°cy o
 =ãmp->√xt->
cylödî
Ë&& !
	`READY_TO_GO
—emp,
queue
)) {

1141 
ãmp
 =Åemp->
√xt
;

1143 i‡(
	`READY_TO_GO
(
ãmp
,
queue
)) {

1144 (
ãmp
);

1147 
ãmp
 = 
cyl°›
;

1152 i‡(!
	`READY_TO_GO
(
ãmp
,
queue
)) {

1153 !
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (ãmp->
√xt
 !
hód
Ë&& (ãmp->√xt->
cylödî
 =
œ°cy o
)) {

1154 
ãmp
 =Åemp->
√xt
;

1156 
ãmp
 =Åemp->
√xt
;

1158 (
ãmp
);

1159 
	}
}

1164 
iobuf
 * 
	$ioqueue_gë_ªque°_‰om_cyl_sˇn_queue
 (
subqueue
 *
queue
)

1166 
iobuf
 *
ãmp
;

1167 
iobuf
 *
°›
;

1169 
ãmp
 = 
queue
->
li°
->
√xt
;

1170 i‡(
queue
->
œ°cy o
 >
ãmp
->
cylödî
) {

1171 
ãmp
 = 
	`ioqueue_idítify_ªque°_⁄_cylödî
(
queue
);

1173 
°›
 = 
ãmp
;

1174 !
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (ãmp->
√xt
 !
°›
)) {

1175 
ãmp
 =Åemp->
√xt
;

1177 i‡((
ãmp
->
√xt
 =
°›
Ë&& !
	`READY_TO_GO
—emp,
queue
)) {

1178 
ãmp
 = 
NULL
;

1180 (
ãmp
);

1181 
	}
}

1186 
iobuf
 * 
	$ioqueue_gë_ªque°_‰om_cyl_vsˇn_queue
 (
subqueue
 *
queue
, 
vÆue
)

1188 
iobuf
 *
ãmp
;

1189 
iobuf
 *
hód
;

1190 
iobuf
 *
t›
 = 
NULL
;

1191 
iobuf
 *
bŸtom
 = 
NULL
;

1192 
iobuf
 *
bŸtom2
 = 
NULL
;

1193 
iobuf
 *
be°⁄e
;

1194 
diff1
, 
diff2
, 
diff3
;

1195 
tmpdú
;

1196 
cy o1
, 
cy o2
, 
cy o3
;

1197 
surÁ˚1
, 
surÁ˚2
, 
surÁ˚3
;

1199 
tmpdú
 = 
queue
->
dú
;

1200 
ãmp
 = 
queue
->
li°
->
√xt
;

1201 
hód
 = 
queue
->
li°
->
√xt
;

1203 
be°⁄e
 = 
	`ioqueue_idítify_ªque°_⁄_cylödî
(
queue
);

1204 i‡(!
	`READY_TO_GO
(
be°⁄e
,
queue
Ë|| (be°⁄e->
cylödî
 !queue->
œ°cy o
)) {

1205 
be°⁄e
 = 
NULL
;

1207 (
ãmp
->
√xt
 !
hód
Ë&& (
queue
->
œ°blkno
 >Åemp->√xt->
blkno
)) {

1208 
ãmp
 =Åemp->
√xt
;

1210 i‡(
ãmp
->
blkno
 < 
queue
->
œ°blkno
) {

1211 
bŸtom
 = 
ãmp
;

1212 (
bŸtom
 !
hód
Ë&& !
	`READY_TO_GO
(bŸtom,
queue
)) {

1213 
bŸtom
 = bŸtom->
¥ev
;

1215 
bŸtom2
 = 
ãmp
;

1216 i‡(
	`READY_TO_GO
(
bŸtom
,
queue
Ë&& (!
be°⁄e
)) {

1217 (
bŸtom
 !
hód
Ë&& (bŸtom->
¥ev
->
cylödî
 == bottom->cylinder)) {

1218 
bŸtom
 = bŸtom->
¥ev
;

1220 (
bŸtom
 !
ãmp
Ë&& !
	`READY_TO_GO
(bŸtom,
queue
)) {

1221 
bŸtom
 = bŸtom->
√xt
;

1225 i‡(
ãmp
->
√xt
 !
hód
) {

1226 
t›
 = (
ãmp
->
blkno
 >
queue
->
œ°blkno
Ë?Åem∞:Åemp->
√xt
;

1227 (
t›
->
√xt
 !
hód
Ë&& !
	`READY_TO_GO
—›,
queue
)) {

1228 
t›
 =Å›->
√xt
;

1231 i‡(!
be°⁄e
) {

1232 i‡((
t›
 =
NULL
Ë|| !
	`READY_TO_GO
—›,
queue
)) {

1233 
ãmp
 = 
bŸtom
;

1234 } i‡((
bŸtom
 =
NULL
Ë|| !
	`READY_TO_GO
(bŸtom,
queue
)) {

1235 
ãmp
 = 
t›
;

1237 
diff1
 = 
	`diff
(
t›
->
cylödî
, 
queue
->
œ°cy o
);

1238 
diff2
 = 
	`diff
(
queue
->
œ°cy o
, 
bŸtom
->
cylödî
);

1239 i‡(
queue
->
dú
 =
ASC
) {

1240 
diff2
 +
vÆue
;

1242 
diff1
 +
vÆue
;

1244 i‡(
diff1
 < 
diff2
) {

1245 
ãmp
 = 
t›
;

1246 } i‡((
diff1
 > 
diff2
Ë|| (
queue
->
s°fupdown
)) {

1247 
ãmp
 = 
bŸtom
;

1249 
ãmp
 = 
t›
;

1251 i‡(
diff1
 =
diff2
) {

1252 
queue
->
s°fupdown
 = (queue->sstfupdown) ? 0 : 1;

1253 
queue
->
s°fupdown˙t
++;

1257 
ãmp
 = 
be°⁄e
;

1259 i‡(
ãmp
->
cylödî
 !
queue
->
œ°cy o
) {

1260 
queue
->
dú
 = (
ãmp
->
cylödî
 > queue->
œ°cy o
Ë? 
ASC
 : 
DESC
;

1262 
	`ioqueue_gë_cylödî_m≠pög
(
queue
->
bigqueue
, 
ãmp
,Åemp->
blkno
, &
cy o1
, &
surÁ˚1
, 
MAP_FULL
);

1263 
diff1
 = 
	`abs
(
cy o1
 - 
queue
->
›tcy o
);

1264 i‡((
t›
 =
NULL
Ë|| !
	`READY_TO_GO
—›,
queue
)) {

1265 
t›
 = 
ãmp
;

1267 
	`ioqueue_gë_cylödî_m≠pög
(
queue
->
bigqueue
, 
t›
,Å›->
blkno
, &
cy o2
, &
surÁ˚2
, 
MAP_FULL
);

1268 
diff2
 = 
	`abs
(
cy o2
 - 
queue
->
›tcy o
);

1269 i‡((
bŸtom2
 =
NULL
Ë|| !
	`READY_TO_GO
(bŸtom2,
queue
)) {

1270 
bŸtom2
 = 
ãmp
;

1272 
	`ioqueue_gë_cylödî_m≠pög
(
queue
->
bigqueue
, 
bŸtom2
, bŸtom2->
blkno
, &
cy o3
, &
surÁ˚3
, 
MAP_FULL
);

1273 
diff3
 = 
	`abs
(
cy o3
 - 
queue
->
›tcy o
);

1274 i‡(
tmpdú
 =
ASC
) {

1275 
diff3
 = (diff3Ë? (diff3 + 
vÆue
) : diff3;

1276 
diff1
 = (
ãmp
->
cylödî
 < 
queue
->
œ°cy o
Ë? (diff1 + 
vÆue
) : diff1;

1278 
diff2
 = (diff2Ë? (diff2 + 
vÆue
) : diff2;

1279 
diff1
 = (
ãmp
->
cylödî
 > 
queue
->
œ°cy o
Ë? (diff1 + 
vÆue
) : diff1;

1281 i‡((
diff3
 < 
diff2
Ë|| ((!diff3Ë&& (
surÁ˚3
 =
queue
->
›tsurÁ˚
))) {

1282 
surÁ˚2
 = 
surÁ˚3
;

1283 
diff2
 = 
diff3
;

1285 i‡(
diff1
 > 
diff2
) {

1286 
	`°©_upd©e
(&
queue
->
öf›íÆty
, (Ë(
diff1
 - 
diff2
));

1290 } i‡((
diff1
 =
diff2
) && (diff1 == 0)) {

1291 i‡((
queue
->
›tsurÁ˚
 =
surÁ˚2
Ë&& (
surÁ˚1
 != surface2)) {

1292 
	`°©_upd©e
(&
queue
->
öf›íÆty
, () 0);

1295 (
ãmp
);

1296 
	}
}

1301 
iobuf
 *
	$ioqueue_gë_ªque°_‰om_›t_•tf_queue
 (
subqueue
 *
queue
, 
checkˇche
, 
ageweight
, 
pos⁄ly
)

1303 
i
;

1304 
iobuf
 *
ãmp
;

1305 
iobuf
 *
be°
 = 
NULL
;

1306 
i‹eq_evít
 *
ã°
;

1307 
mötime
 = 100000.0;

1308 
ªaddñay
;

1309 
wrôedñay
;

1310 
dñay
;

1311 
weight
;

1312 
ãmp_dñay
;

1313 
i‹eq_evít
 *
tmp
;

1315 
age
 = 0.0;

1319 
	`ASSERT
((
ageweight
 >= 0) && (ageweight <= 3));

1320 
ªaddñay
 = 
queue
->
bigqueue
->readdelay;

1321 
wrôedñay
 = 
queue
->
bigqueue
->writedelay;

1322 
weight
 = (Ë
queue
->
bigqueue
->
to_time
;

1323 
ã°
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1324 
ãmp
 = 
queue
->
li°
->
√xt
;

1328 
i
=0; i<
queue
->
li°Àn
; i++) {

1330 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (
	`ioqueue_£q°ªam_hód
(queue->
bigqueue
, queue->
li°
->
√xt
,Åemp))) {

1331 
ã°
->
blkno
 = 
ãmp
->blkno;

1332 
ã°
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

1333 
ã°
->
devno
 = 
ãmp
->
iﬁi°
->devno;

1334 
ã°
->
Êags
 = 
ãmp
->flags;

1335 
dñay
 = (
ãmp
->
Êags
 & 
READ
Ë? 
ªaddñay
 : 
wrôedñay
;

1336 
ã°
->
time
 = 
simtime
 + 
dñay
;

1337 i‡(
ageweight
) {

1338 
tmp
 = 
ãmp
->
iﬁi°
;

1339 
age
 = 
tmp
->
time
;

1340 
tmp
) {

1341 i‡(
tmp
->
time
 < 
age
) {

1342 
age
 = 
tmp
->
time
;

1344 
tmp
 =Åmp->
√xt
;

1346 
age
 = 
simtime
 -áge;

1348 i‡((
ageweight
 == 2) ||

1349 ((
ageweight
 == 3) &&

1350 (
ã°
->
Êags
 & (
TIME_CRITICAL
 | 
TIME_LIMITED
)))) {

1351 
dñay
 -
age
 * 
weight
 * () 0.001;

1353 i‡(
dñay
 < 
mötime
) {

1354 i‡(
pos⁄ly
) {

1355 
ãmp_dñay
 = 
	`devi˚_gë_£rvtime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

1357 
dñay
 +
ãmp_dñay
;

1359 
dñay
 +
	`devi˚_gë_ac˘ime
(
ã°
->
devno
,Åe°, (
mötime
 - delay));

1361 i‡(
ageweight
 == 1) {

1362 
dñay
 *(
weight
 - 
age
) / weight;

1368 i‡(
dñay
 < 
mötime
) {

1369 
be°
 = 
ãmp
;

1370 
mötime
 = 
dñay
;

1377 
ãmp
 =Åemp->
√xt
;

1379 
	`addt€xåaq
((
evít
 *Ë
ã°
);

1386 (
be°
);

1387 
	}
}

1392 
	$£rvi˚_time
(
cuºít_cyl
,

1393 
cuºít_£˘‹
,

1394 
cuºít_hód
,

1395 
èrgë_cyl
,

1396 
èrgë_£˘‹
,

1397 
èrgë_hód
,

1398 
ªad
,

1399 
blocks
,

1400 
disk
 *
cuºdisk
)

1402 
i
;

1403 
£ektime
 = 0.0;

1404 
rŸ©i⁄
 = 0.0;

1405 
x„r
 = 0.0;

1406 
cuºít_max_£˘‹s
 = 0;

1407 
èrgë_max_£˘‹s
 = 0;

1408 
cuºít_™gÀ
 = 0.0;

1409 
èrgë_™gÀ
 = 0.0;

1411 
≥riod
 = 
	`dm_time_ôod
(
cuºdisk
->
modñ
->
mech
->
	`dm_≥riod
(currdisk->model));

1415 
dm_mech_°©e
 
p1
, 
p2
;

1416 
uöt64_t
 
n£cs
;

1417 
p1
.
cyl
 = 
cuºít_cyl
;

1418 
p1
.
hód
 = 
cuºít_hód
;

1419 
p2
.
cyl
 = 
èrgë_cyl
;

1420 
p2
.
hód
 = 
èrgë_hód
;

1422 
n£cs
 = 
cuºdisk
->
modñ
->
mech
->
	`dm_£ek_time
(currdisk->model,

1423 &
p1
,

1424 &
p2
,

1425 
ªad
);

1426 
£ektime
 = 
	`dm_time_ôod
(
n£cs
);

1439 
èrgë_™gÀ
 = ()
èrgë_£˘‹
 / ()
èrgë_max_£˘‹s
;

1440 
cuºít_™gÀ
 = ()
cuºít_£˘‹
 / ()
cuºít_max_£˘‹s
;

1443 if(
èrgë_™gÀ
 < 
cuºít_™gÀ
){

1444 
èrgë_™gÀ
 += 1.0;

1449 
dm_mech_°©e
 
p1
, 
p2
;

1450 
uöt64_t
 
n£cs
;

1451 
p1
.
thëa
 = 
	`dm_™gÀ_dtoi
(
cuºít_™gÀ
);

1452 
p2
.
thëa
 = 
	`dm_™gÀ_dtoi
(
èrgë_™gÀ
);

1453 
n£cs
 = 
cuºdisk
->
modñ
->
mech
->
	`dm_rŸtime
(currdisk->model,

1454 
p1
.
thëa
,

1455 
p2
.
thëa
);

1456 
rŸ©i⁄
 = 
	`dm_time_ôod
(
n£cs
);

1459 
rŸ©i⁄
 < 
£ektime
){

1460 
rŸ©i⁄
 +
≥riod
;

1463 
x„r
 = (()
blocks
 / ()
èrgë_max_£˘‹s
Ë* 
≥riod
;

1467 (
x„r
 + 
rŸ©i⁄
);

1468 
	}
}

1470 
	#MAX_TSPS
 10

	)

1472 
	gmö_time
;

1473 
	gcuºít_hód
=0;

1474 
	gsched_cou¡
=0;

1476 
iobuf
 *
	gªque°s
[
MAX_TSPS
];

1478 
	$ªmove_t•s
(
iobuf
 *
tmp
){

1479 
i
;

1480 
iobuf
 *
ãmp
;

1482 
ãmp
 = 
tmp
;

1483 
i
=0;i<
sched_cou¡
;i++){

1484 if(
ªque°s
[
cuºít_hód
+
i
] =
ãmp
){

1485 if((
cuºít_hód
+
i
+1Ë< 
MAX_TSPS
){

1486 
ªque°s
[
cuºít_hód
+
i
] =Ñequests[current_head+i+1];

1487 
ãmp
 = 
ªque°s
[
cuºít_hód
+
i
+1];

1489 
ªque°s
[
cuºít_hód
+
i
] = 
NULL
;

1493 if(
sched_cou¡
 != 0){

1494 
sched_cou¡
--;

1496 
	}
}

1498 
	$ˇlc_•
(
iobuf
 **
¨øy
, 
subqueue
 *
queue
, 
checkˇche
, 
no_ªque°s
){

1499 
i
;

1500 
£˘‹
;

1501 
i‹eq_evít
 *
ã°
;

1502 
disk
 *
sögÀdisk
;

1504 
œ°_hód
 = 0;

1505 
iobuf
 *
ãmp
 = 
NULL
;

1506 
°¨t
 = 0;

1507 
acc_time
=0.0;

1508 
œ°_cylödî
 = 0;

1509 
œ°_£˘‹
 = 0;

1513 
sögÀdisk
 = 
	`gëdisk
(
queue
->
bigqueue
->
devno
);

1514 
ã°
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1515 
i
=0; i<
no_ªque°s
; i++) {

1516 
ãmp
 = 
¨øy
[
i
];

1521 
ã°
->
blkno
 = 
ãmp
->blkno;

1522 
ã°
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

1523 
ã°
->
devno
 = 
ãmp
->
iﬁi°
->devno;

1524 
ã°
->
Êags
 = 
ãmp
->flags;

1525 
ã°
->
time
 = 
simtime
;

1526 
	`devi˚_gë_m≠pög
(
queue
->
bigqueue
->
cylm≠ty≥
, 
ãmp
->
iﬁi°
->
devno
,Åemp->
blkno
, 
NULL
, NULL, &
£˘‹
);

1527 if(
°¨t
 == 0){

1528 
°¨t
 = 1;

1529 
acc_time
 = 
	`devi˚_gë_ac˘ime
(
ã°
->
devno
,Åest, 100000);

1531 
acc_time
 +
	`£rvi˚_time
(
œ°_cylödî
,

1532 
œ°_£˘‹
,

1533 
œ°_hód
,

1534 
ãmp
->
cylödî
,

1535 (Ë
£˘‹
,

1536 
ãmp
->
surÁ˚
,

1537 (
ãmp
->
Êags
 & 
READ
),

1538 
ãmp
->
tŸÆsize
,

1539 
sögÀdisk
);

1541 
œ°_£˘‹
 = 
£˘‹
;

1542 
œ°_cylödî
 = 
ãmp
->
cylödî
;

1543 
œ°_hód
 = 
ãmp
->
surÁ˚
;

1545 if(
acc_time
 < 
mö_time
){

1548 
i
=0; i<
MAX_TSPS
; i++) {

1549 if(
i
<
no_ªque°s
){

1551 
ªque°s
[
i
] = 
¨øy
[i];

1553 
ªque°s
[
i
] = 
NULL
;

1557 
mö_time
 = 
acc_time
;

1558 
sched_cou¡
 = 
no_ªque°s
;

1559 
cuºít_hód
 = 0;

1561 
	`addt€xåaq
((
evít
 *Ë
ã°
);

1562 
	}
}

1564 
	$≥rm
(
iobuf
 **
¨øy
,

1565 
m
,

1566 
subqueue
 *
queue
,

1567 
checkˇche
,

1568 
no_ªque°s
){

1569 
i
;

1570 
iobuf
 *
ãmp
;

1573 if(
m
 == 0){

1578 
	`ˇlc_•
(
¨øy
, 
queue
, 
checkˇche
, 
no_ªque°s
);

1580 
i
=0;i<
m
;i++){

1581 
ãmp
 = 
¨øy
[
i
];

1582 
¨øy
[
i
] =áºay[
m
-1];

1583 
¨øy
[
m
-1] = 
ãmp
;

1584 
	`≥rm
(
¨øy
,
m
-1,
queue
,
checkˇche
,
no_ªque°s
);

1585 
ãmp
 = 
¨øy
[
m
-1];

1586 
¨øy
[
m
-1] =áºay[
i
];

1587 
¨øy
[
i
] = 
ãmp
;

1590 
	}
}

1594 
iobuf
 *

1595 
	$ioqueue_gë_ªque°_‰om_›t_t•s_queue
(
subqueue
 *
queue
,

1596 
checkˇche
,

1597 
ageweight
,

1598 
pos⁄ly
)

1600 
i
;

1601 
iobuf
 *
ãmp
;

1602 
iobuf
 *
be°
 = 
NULL
;

1603 
i‹eq_evít
 *
ã°
;

1604 
acc_time
;

1623 
ªque°_cou¡
=0;

1624 
iobuf
 *
ã°_ªque°s
[
MAX_TSPS
];

1628 
	`ASSERT
((
ageweight
 >= 0) && (ageweight <= 3));

1640 if(
sched_cou¡
 != 0){

1641 if(
ªque°s
[
cuºít_hód
] !
NULL
){

1642 
be°
 = 
ªque°s
[
cuºít_hód
];

1643 
ã°
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1644 
ã°
->
blkno
 = 
be°
->blkno;

1645 
ã°
->
bcou¡
 = 
be°
->
tŸÆsize
;

1646 
ã°
->
devno
 = 
be°
->
iﬁi°
->devno;

1647 
ã°
->
Êags
 = 
be°
->flags;

1648 
ã°
->
time
 = 
simtime
;

1649 
acc_time
 = 
	`devi˚_gë_ac˘ime
(
ã°
->
devno
,Åest, 100000);

1650 
	`addt€xåaq
((
evít
 *Ë
ã°
);

1651 
cuºít_hód
++;

1652 
sched_cou¡
--;

1653 
	`Ârötf
 (
°dîr
, "2SelectedÑequest: %f, cylno %d, blkno %d,Ñead %d, devno %d\n",

1654 
acc_time
, 
be°
->
cylödî
, be°->
blkno
, (be°->
Êags
 & 
READ
), be°->
iﬁi°
->
devno
);

1655 (
be°
);

1657 
	`Ârötf
(
°dîr
,"ERROR:Ñequest NULL with count != 0\n");

1658 
	`ab‹t
();

1661 
ãmp
 = 
queue
->
li°
->
√xt
;

1665 
mö_time
 = 100000;

1666 
i
=0; i<
queue
->
li°Àn
; i++) {

1668 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (
	`ioqueue_£q°ªam_hód
(queue->
bigqueue
, queue->
li°
->
√xt
,Åemp))) {

1669 
ã°_ªque°s
[
ªque°_cou¡
] = 
ãmp
;

1670 
ªque°_cou¡
++;

1671 if(
ªque°_cou¡
 =
MAX_TSPS
){

1722 
ãmp
 =Åemp->
√xt
;

1724 if(
ªque°_cou¡
 !
MAX_TSPS
){

1725 
i
=
ªque°_cou¡
;i<
MAX_TSPS
;i++){

1726 
ã°_ªque°s
[
i
] = 
NULL
;

1741 
	`≥rm
(
ã°_ªque°s
,
ªque°_cou¡
,
queue
,
checkˇche
,request_count);

1742 
	`Ârötf
(
°dîr
,"sched cou¡ = %d\n",
sched_cou¡
);

1743 if(
sched_cou¡
 != 0){

1744 if(
ªque°s
[
cuºít_hód
] !
NULL
){

1745 
be°
 = 
ªque°s
[
cuºít_hód
];

1746 
ã°
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1747 
ã°
->
blkno
 = 
be°
->blkno;

1748 
ã°
->
bcou¡
 = 
be°
->
tŸÆsize
;

1749 
ã°
->
devno
 = 
be°
->
iﬁi°
->devno;

1750 
ã°
->
Êags
 = 
be°
->flags;

1751 
ã°
->
time
 = 
simtime
;

1752 
acc_time
 = 
	`devi˚_gë_ac˘ime
(
ã°
->
devno
,Åest, 100000);

1753 
	`addt€xåaq
((
evít
 *Ë
ã°
);

1754 
cuºít_hód
++;

1755 
sched_cou¡
--;

1757 
	`Ârötf
 (
°dîr
, "3SelectedÑequest: %f, cylno %d, blkno %d,Ñead %d, devno %d %f\n",

1758 
acc_time
, 
be°
->
cylödî
, be°->
blkno
, (be°->
Êags
 & 
READ
), be°->
iﬁi°
->
devno
, 
mö_time
);

1759 (
be°
);

1761 
	`Ârötf
(
°dîr
,"ERROR:Ñequest NULL with count != 0\n");

1762 
	`ab‹t
();

1765 
	`Ârötf
(
°dîr
,"ERROR: sched count = 0\n");

1766 
	`ab‹t
();

1768 
	`Ârötf
(
°dîr
, "blah\n");

1769 (
be°
);

1770 
	}
}

1772 
iobuf
 *
	$ioqueue_gë_ªque°_‰om_›t_•tf_rŸ_weight_queue
 (
subqueue
 *
queue
, 
checkˇche
, 
ageweight
, 
pos⁄ly
)

1774 
i
;

1775 
iobuf
 *
ãmp
;

1776 
i‹eq_evít
 *
ã°
;

1777 
ªaddñay
;

1778 
wrôedñay
;

1779 
dñay
;

1780 
weight
;

1781 
i‹eq_evít
 *
tmp
;

1783 
iobuf
 *
be°
 = 
NULL
;

1784 
mötime
 = 100000.0;

1785 
mösubåa˘
 = 0.0;

1786 
age
 = 0.0;

1787 
ãmp_dñay
 = 0.0;

1788 
ãmp_£ek
 = 0.0;

1792 
	`ASSERT
((
ageweight
 >= 0) && (ageweight <= 3));

1793 
ªaddñay
 = 
queue
->
bigqueue
->readdelay;

1794 
wrôedñay
 = 
queue
->
bigqueue
->writedelay;

1795 
weight
 = (Ë
queue
->
bigqueue
->
to_time
;

1796 
ã°
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1797 
ãmp
 = 
queue
->
li°
->
√xt
;

1798 
i
=0; i<
queue
->
li°Àn
; i++) {

1799 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (
	`ioqueue_£q°ªam_hód
(queue->
bigqueue
, queue->
li°
->
√xt
,Åemp))) {

1800 
ã°
->
blkno
 = 
ãmp
->blkno;

1801 
ã°
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

1802 
ã°
->
devno
 = 
ãmp
->
iﬁi°
->devno;

1803 
ã°
->
Êags
 = 
ãmp
->flags;

1804 
dñay
 = (
ãmp
->
Êags
 & 
READ
Ë? 
ªaddñay
 : 
wrôedñay
;

1805 
ã°
->
time
 = 
simtime
 + 
dñay
;

1806 i‡(
ageweight
) {

1807 
tmp
 = 
ãmp
->
iﬁi°
;

1808 
age
 = 
tmp
->
time
;

1809 
tmp
) {

1810 i‡(
tmp
->
time
 < 
age
) {

1811 
age
 = 
tmp
->
time
;

1813 
tmp
 =Åmp->
√xt
;

1815 
age
 = 
simtime
 -áge;

1817 i‡((
ageweight
 == 2) ||

1818 ((
ageweight
 == 3) &&

1819 (
ã°
->
Êags
 & (
TIME_CRITICAL
 | 
TIME_LIMITED
)))) {

1820 
dñay
 -
age
 * 
weight
 * () 0.001;

1822 i‡(
dñay
 < 
mötime
) {

1823 i‡(
pos⁄ly
) {

1824 
ãmp_dñay
 = 
	`devi˚_gë_£rvtime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

1825 
ãmp_£ek
 = 
	`devi˚_gë_£ektime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

1826 
dñay
 +
ãmp_dñay
;

1828 
dñay
 +
	`devi˚_gë_ac˘ime
(
ã°
->
devno
,Åe°, (
mötime
 - delay));

1830 i‡(
ageweight
 == 1) {

1831 
dñay
 *(
weight
 - 
age
) / weight;

1834 if((
ãmp_dñay
 - 
ãmp_£ek
) < 0.0)

1835 
	`Ârötf
(
°dîr
,"O›†dñayÇeg©ivê%f\n",
ãmp_dñay
-
ãmp_£ek
);

1837 i‡((
dñay
 - (
ãmp_dñay
 - 
ãmp_£ek
Ë* 
queue
->
bigqueue
->
œãncy_weight
Ë< (
mötime
 - 
mösubåa˘
)) {

1838 
be°
 = 
ãmp
;

1839 
mötime
 = 
dñay
;

1840 
mösubåa˘
 = (
ãmp_dñay
 - 
ãmp_£ek
Ë* 
queue
->
bigqueue
->
œãncy_weight
;

1844 
ãmp
 =Åemp->
√xt
;

1846 
	`addt€xåaq
((
evít
 *Ë
ã°
);

1852 (
be°
);

1853 
	}
}

1856 
iobuf
 *
	$ioqueue_gë_ªque°_‰om_›t_•tf_weight_queue
 (
subqueue
 *
queue
, 
checkˇche
, 
ageweight
, 
pos⁄ly
)

1858 
i
;

1859 
iobuf
 *
ãmp
;

1860 
i‹eq_evít
 *
ã°
;

1861 
ªaddñay
;

1862 
wrôedñay
;

1863 
weight
;

1864 
i‹eq_evít
 *
tmp
;

1866 
iobuf
 *
be°
 = 
NULL
;

1867 
iobuf
 *
be°2
 = 
NULL
;

1868 
mötime
 = 100000.0;

1869 
ãmp_mötime
 = 100000.0;

1870 
maxrŸ
 = 0.0;

1871 
dñay
 = 0.0;

1872 
age
 = 0.0;

1873 
ãmp_dñay
 = 0.0;

1874 
ãmp_£ek
 = 0.0;

1878 
	`ASSERT
((
ageweight
 >= 0) && (ageweight <= 3));

1880 
ªaddñay
 = 
queue
->
bigqueue
->readdelay;

1881 
wrôedñay
 = 
queue
->
bigqueue
->writedelay;

1882 
weight
 = (Ë
queue
->
bigqueue
->
to_time
;

1883 
ã°
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1884 
ãmp
 = 
queue
->
li°
->
√xt
;

1885 
i
=0; i<
queue
->
li°Àn
; i++) {

1886 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (
	`ioqueue_£q°ªam_hód
(queue->
bigqueue
, queue->
li°
->
√xt
,Åemp))) {

1887 
ã°
->
blkno
 = 
ãmp
->blkno;

1888 
ã°
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

1889 
ã°
->
devno
 = 
ãmp
->
iﬁi°
->devno;

1890 
ã°
->
Êags
 = 
ãmp
->flags;

1891 
dñay
 = (
ãmp
->
Êags
 & 
READ
Ë? 
ªaddñay
 : 
wrôedñay
;

1892 
ã°
->
time
 = 
simtime
 + 
dñay
;

1893 i‡(
ageweight
) {

1894 
tmp
 = 
ãmp
->
iﬁi°
;

1895 
age
 = 
tmp
->
time
;

1896 
tmp
) {

1897 i‡(
tmp
->
time
 < 
age
) {

1898 
age
 = 
tmp
->
time
;

1900 
tmp
 =Åmp->
√xt
;

1902 
age
 = 
simtime
 -áge;

1904 i‡((
ageweight
 == 2) ||

1905 ((
ageweight
 == 3) &&

1906 (
ã°
->
Êags
 & (
TIME_CRITICAL
 | 
TIME_LIMITED
)))) {

1907 
dñay
 -
age
 * 
weight
 * () 0.001;

1909 i‡(
dñay
 < 
mötime
) {

1910 i‡(
pos⁄ly
) {

1911 
ãmp_dñay
 = 
	`devi˚_gë_£rvtime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

1912 
dñay
 +
ãmp_dñay
;

1914 
dñay
 +
	`devi˚_gë_ac˘ime
(
ã°
->
devno
,Åe°, (
mötime
 - delay));

1916 i‡(
ageweight
 == 1) {

1917 
dñay
 *(
weight
 - 
age
) / weight;

1920 i‡(
dñay
 < 
ãmp_mötime
) {

1921 
ãmp_mötime
 = 
dñay
;

1922 
be°2
 = 
ãmp
;

1926 
ãmp
 =Åemp->
√xt
;

1928 
	`addt€xåaq
((
evít
 *Ë
ã°
);

1931 
ªaddñay
 = 
queue
->
bigqueue
->readdelay;

1932 
wrôedñay
 = 
queue
->
bigqueue
->writedelay;

1933 
weight
 = (Ë
queue
->
bigqueue
->
to_time
;

1934 
ã°
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1935 
ãmp
 = 
queue
->
li°
->
√xt
;

1936 
i
=0; i<
queue
->
li°Àn
; i++) {

1937 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (
	`ioqueue_£q°ªam_hód
(queue->
bigqueue
, queue->
li°
->
√xt
,Åemp))) {

1938 
ã°
->
blkno
 = 
ãmp
->blkno;

1939 
ã°
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

1940 
ã°
->
devno
 = 
ãmp
->
iﬁi°
->devno;

1941 
ã°
->
Êags
 = 
ãmp
->flags;

1942 
dñay
 = (
ãmp
->
Êags
 & 
READ
Ë? 
ªaddñay
 : 
wrôedñay
;

1943 
ã°
->
time
 = 
simtime
 + 
dñay
;

1944 i‡(
ageweight
) {

1945 
tmp
 = 
ãmp
->
iﬁi°
;

1946 
age
 = 
tmp
->
time
;

1947 
tmp
) {

1948 i‡(
tmp
->
time
 < 
age
) {

1949 
age
 = 
tmp
->
time
;

1951 
tmp
 =Åmp->
√xt
;

1953 
age
 = 
simtime
 -áge;

1955 i‡((
ageweight
 == 2) ||

1956 ((
ageweight
 == 3) &&

1957 (
ã°
->
Êags
 & (
TIME_CRITICAL
 | 
TIME_LIMITED
)))) {

1958 
dñay
 -
age
 * 
weight
 * () 0.001;

1960 i‡(
dñay
 < 
mötime
) {

1961 i‡(
pos⁄ly
) {

1962 
ãmp_dñay
 = 
	`devi˚_gë_£rvtime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

1963 
ãmp_£ek
 = 
	`devi˚_gë_£ektime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

1964 
dñay
 +
ãmp_dñay
;

1966 
dñay
 +
	`devi˚_gë_ac˘ime
(
ã°
->
devno
,Åe°, (
mötime
 - delay));

1968 i‡(
ageweight
 == 1) {

1969 
dñay
 *(
weight
 - 
age
) / weight;

1975 if((
ãmp_dñay
 - 
ãmp_£ek
) < 0.0)

1976 
	`Ârötf
(
°dîr
,"O›†dñayÇeg©ivê%f\n",
ãmp_dñay
-
ãmp_£ek
);

1978 i‡(
dñay
 <(
ãmp_mötime
 * (1+
queue
->
bigqueue
->
œãncy_weight
))) {

1979 if((
ãmp_dñay
 - 
ãmp_£ek
Ë>
maxrŸ
){

1980 
be°
 = 
ãmp
;

1981 
maxrŸ
 = 
ãmp_dñay
 - 
ãmp_£ek
;

1986 
ãmp
 =Åemp->
√xt
;

1988 
	`addt€xåaq
((
evít
 *Ë
ã°
);

1994 (
be°
);

1995 
	}
}

1997 
iobuf
 *
	$ioqueue_gë_ªque°_‰om_›t_•tf_£ek_weight_queue
 (
subqueue
 *
queue
, 
checkˇche
, 
ageweight
, 
pos⁄ly
)

1999 
i
;

2000 
iobuf
 *
ãmp
;

2001 
iobuf
 *
be°
 = 
NULL
;

2002 
iobuf
 *
be°2
 = 
NULL
;

2003 
i‹eq_evít
 *
ã°
;

2004 
mötime
 = 100000.0;

2005 
ãmp_mötime
 = 100000.0;

2006 
mö£ek
 = 100000.0;

2007 
ªaddñay
;

2008 
wrôedñay
;

2009 
dñay
 = 0.0;

2010 
age
 = 0.0;

2011 
weight
;

2013 
ãmp_dñay
 = 0.0;

2014 
ãmp_£ek
 = 0.0;

2016 
i‹eq_evít
 *
tmp
;

2018 
	`ASSERT
((
ageweight
 >= 0) && (ageweight <= 3));

2020 
ªaddñay
 = 
queue
->
bigqueue
->readdelay;

2021 
wrôedñay
 = 
queue
->
bigqueue
->writedelay;

2022 
weight
 = (Ë
queue
->
bigqueue
->
to_time
;

2023 
ã°
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

2024 
ãmp
 = 
queue
->
li°
->
√xt
;

2026 
i
=0; i<
queue
->
li°Àn
; i++) {

2027 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (
	`ioqueue_£q°ªam_hód
(queue->
bigqueue
, queue->
li°
->
√xt
,Åemp))) {

2028 
ã°
->
blkno
 = 
ãmp
->blkno;

2029 
ã°
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

2030 
ã°
->
devno
 = 
ãmp
->
iﬁi°
->devno;

2031 
ã°
->
Êags
 = 
ãmp
->flags;

2032 
dñay
 = (
ãmp
->
Êags
 & 
READ
Ë? 
ªaddñay
 : 
wrôedñay
;

2033 
ã°
->
time
 = 
simtime
 + 
dñay
;

2034 i‡(
ageweight
) {

2035 
tmp
 = 
ãmp
->
iﬁi°
;

2036 
age
 = 
tmp
->
time
;

2037 
tmp
) {

2038 i‡(
tmp
->
time
 < 
age
) {

2039 
age
 = 
tmp
->
time
;

2041 
tmp
 =Åmp->
√xt
;

2043 
age
 = 
simtime
 -áge;

2045 i‡((
ageweight
 == 2) ||

2046 ((
ageweight
 == 3) &&

2047 (
ã°
->
Êags
 & (
TIME_CRITICAL
 | 
TIME_LIMITED
)))) {

2048 
dñay
 -
age
 * 
weight
 * () 0.001;

2050 i‡(
dñay
 < 
mötime
) {

2051 i‡(
pos⁄ly
) {

2052 
ãmp_dñay
 = 
	`devi˚_gë_£rvtime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

2053 
ãmp_£ek
 = 
	`devi˚_gë_£ektime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

2054 
dñay
 +
ãmp_dñay
;

2056 
dñay
 +
	`devi˚_gë_ac˘ime
(
ã°
->
devno
,Åe°, (
mötime
 - delay));

2058 i‡(
ageweight
 == 1) {

2059 
dñay
 *(
weight
 - 
age
) / weight;

2066 i‡(
dñay
 < 
ãmp_mötime
) {

2067 
ãmp_mötime
 = 
dñay
;

2068 
be°2
 = 
ãmp
;

2070 i‡(
dñay
 <(
ãmp_mötime
 * (1+
queue
->
bigqueue
->
œãncy_weight
))) {

2071 if(
ãmp_£ek
 < 
mö£ek
){

2072 
be°
 = 
ãmp
;

2073 
mö£ek
 = 
ãmp_£ek
;

2078 
ãmp
 =Åemp->
√xt
;

2080 
	`addt€xåaq
((
evít
 *Ë
ã°
);

2083 
i
=0; i<
queue
->
li°Àn
; i++) {

2084 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (
	`ioqueue_£q°ªam_hód
(queue->
bigqueue
, queue->
li°
->
√xt
,Åemp))) {

2085 
ã°
->
blkno
 = 
ãmp
->blkno;

2086 
ã°
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

2087 
ã°
->
devno
 = 
ãmp
->
iﬁi°
->devno;

2088 
ã°
->
Êags
 = 
ãmp
->flags;

2089 
dñay
 = (
ãmp
->
Êags
 & 
READ
Ë? 
ªaddñay
 : 
wrôedñay
;

2090 
ã°
->
time
 = 
simtime
 + 
dñay
;

2091 i‡(
ageweight
) {

2092 
tmp
 = 
ãmp
->
iﬁi°
;

2093 
age
 = 
tmp
->
time
;

2094 
tmp
) {

2095 i‡(
tmp
->
time
 < 
age
) {

2096 
age
 = 
tmp
->
time
;

2098 
tmp
 =Åmp->
√xt
;

2100 
age
 = 
simtime
 -áge;

2102 i‡((
ageweight
 == 2) ||

2103 ((
ageweight
 == 3) &&

2104 (
ã°
->
Êags
 & (
TIME_CRITICAL
 | 
TIME_LIMITED
)))) {

2105 
dñay
 -
age
 * 
weight
 * () 0.001;

2107 i‡(
dñay
 < 
mötime
) {

2108 i‡(
pos⁄ly
) {

2109 
ãmp_dñay
 = 
	`devi˚_gë_£rvtime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

2111 
dñay
 +
ãmp_dñay
;

2113 
dñay
 +
	`devi˚_gë_ac˘ime
(
ã°
->
devno
,Åe°, (
mötime
 - delay));

2115 i‡(
ageweight
 == 1) {

2116 
dñay
 *(
weight
 - 
age
) / weight;

2123 i‡(
dñay
 < 
ãmp_mötime
) {

2124 
ãmp_mötime
 = 
dñay
;

2125 
be°2
 = 
ãmp
;

2129 
ãmp
 =Åemp->
√xt
;

2131 
	`addt€xåaq
((
evít
 *Ë
ã°
);

2133 
ªaddñay
 = 
queue
->
bigqueue
->readdelay;

2134 
wrôedñay
 = 
queue
->
bigqueue
->writedelay;

2135 
weight
 = (Ë
queue
->
bigqueue
->
to_time
;

2136 
ã°
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

2137 
ãmp
 = 
queue
->
li°
->
√xt
;

2138 
i
=0; i<
queue
->
li°Àn
; i++) {

2139 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (
	`ioqueue_£q°ªam_hód
(queue->
bigqueue
, queue->
li°
->
√xt
,Åemp))) {

2140 
ã°
->
blkno
 = 
ãmp
->blkno;

2141 
ã°
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

2142 
ã°
->
devno
 = 
ãmp
->
iﬁi°
->devno;

2143 
ã°
->
Êags
 = 
ãmp
->flags;

2144 
dñay
 = (
ãmp
->
Êags
 & 
READ
Ë? 
ªaddñay
 : 
wrôedñay
;

2145 
ã°
->
time
 = 
simtime
 + 
dñay
;

2146 i‡(
ageweight
) {

2147 
tmp
 = 
ãmp
->
iﬁi°
;

2148 
age
 = 
tmp
->
time
;

2149 
tmp
) {

2150 i‡(
tmp
->
time
 < 
age
) {

2151 
age
 = 
tmp
->
time
;

2153 
tmp
 =Åmp->
√xt
;

2155 
age
 = 
simtime
 -áge;

2157 i‡((
ageweight
 == 2) ||

2158 ((
ageweight
 == 3) &&

2159 (
ã°
->
Êags
 & (
TIME_CRITICAL
 | 
TIME_LIMITED
)))) {

2160 
dñay
 -
age
 * 
weight
 * () 0.001;

2162 i‡(
dñay
 < 
mötime
) {

2163 i‡(
pos⁄ly
) {

2164 
ãmp_dñay
 = 
	`devi˚_gë_£rvtime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

2165 
ãmp_£ek
 = 
	`devi˚_gë_£ektime
(
ã°
->
devno
,Åe°, 
checkˇche
, (
mötime
 - 
dñay
));

2167 
dñay
 +
ãmp_dñay
;

2169 
dñay
 +
	`devi˚_gë_ac˘ime
(
ã°
->
devno
,Åe°, (
mötime
 - delay));

2171 i‡(
ageweight
 == 1) {

2172 
dñay
 *(
weight
 - 
age
) / weight;

2178 if(
ãmp_£ek
 < 0.0)

2179 
	`Ârötf
(
°dîr
,"O›†dñayÇeg©ivê%f\n",
ãmp_dñay
-
ãmp_£ek
);

2181 i‡(
dñay
 <(
ãmp_mötime
 * (1+
queue
->
bigqueue
->
œãncy_weight
))) {

2182 if(
ãmp_£ek
 < 
mö£ek
){

2183 
be°
 = 
ãmp
;

2184 
mö£ek
 = 
ãmp_£ek
;

2189 
ãmp
 =Åemp->
√xt
;

2191 
	`addt€xåaq
((
evít
 *Ë
ã°
);

2198 (
be°
);

2199 
	}
}

2216 
iobuf
 *
	$ioqueue_gë_ªque°_‰om_sdf_queue
 (
subqueue
 *
queue
, 
exa˘
, 
dúe˘i⁄
) {

2218 
i
;

2219 
iobuf
 *
ãmp
;

2220 
iobuf
 *
be°
 = 
NULL
;

2221 
i‹eq_evít
 *
ã°
;

2223 
di°™˚
;

2224 
mö_di°™˚
 = 1000000;

2231 
ã°
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

2233 
ãmp
 = 
queue
->
li°
->
√xt
;

2234 
i
=0; i<
queue
->
li°Àn
; i++) {

2236 i‡(
	`READY_TO_GO
(
ãmp
,
queue
Ë&& (
	`ioqueue_£q°ªam_hód
(queue->
bigqueue
, queue->
li°
->
√xt
,Åemp))) {

2237 
ã°
->
blkno
 = 
ãmp
->blkno;

2238 
ã°
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

2239 
ã°
->
devno
 = 
ãmp
->
iﬁi°
->devno;

2240 
ã°
->
Êags
 = 
ãmp
->flags;

2242 i‡(
exa˘
) {

2243 
di°™˚
 = 
	`devi˚_gë_di°™˚
(
ã°
->
devno
,Åe°, -1, 
dúe˘i⁄
);

2246 
di°™˚
 = 
	`devi˚_gë_di°™˚
(
ã°
->
devno
,Åe°, 
queue
->
œ°blkno
, 
dúe˘i⁄
);

2251 i‡(
di°™˚
 < 
mö_di°™˚
) {

2252 
be°
 = 
ãmp
;

2253 
mö_di°™˚
 = 
di°™˚
;

2258 
ãmp
 =Åemp->
√xt
;

2261 
	`addt€xåaq
((
evít
 *Ë
ã°
);

2268 (
be°
);

2269 
	}
}

2274 
iobuf
 *
	$ioqueue_gë_ªque°_‰om_b©ch_fcfs_queue
(
subqueue
 *
queue
)

2276 
iobuf
 *
tmp
;

2277 
iobuf
 *
ªt
 = 
NULL
;

2278 
iobuf
 *
fú°_ö_b©ch
 = 
NULL
;

2279 
iobuf
 *
œ°_ö_b©ch
;

2280 
i
;

2281 
b©chno
;

2283 
	`¥ötf
("ioqueue_get_request_from_batch_fcfs_queue:: queue contents\n");

2284 
	`¥öt_b©ch_fcfs_queue
(
queue
);

2286 
tmp
 = 
queue
->
li°
->
√xt
;

2287 
i
 = 0; i < 
queue
->
iobuf˙t
; i++) {

2288 i‡(
	`READY_TO_GO
(
tmp
,
queue
)) {

2290  (
tmp
);

2292 
tmp
 =Åmp->
√xt
;

2295 
	`¥ötf
("ioqueue_get_request_from_batch_fcfs_queue::Çone ofÅheÑequests were READY_TO_GO\n");

2296 
	`¥öt_b©ch_fcfs_queue
(
queue
);

2298 (
NULL
);

2299 
	}
}

2302 
i‹eq_evít
 * 
	$ioqueue_show_√xt_ªque°_‰om_subqueue
 (
subqueue
 *
queue
)

2304 
iobuf
 *
ãmp
 = 0;

2305 
i‹eq_evít
 *
ªt
;

2308 
iobuf
 *
ãmp_sdf
 = 
NULL
;

2309 
iobuf
 *
ãmp_•tf
 = 
NULL
;

2312 
tmpdú
;

2314 
tmpdú
 = 
queue
->
dú
;

2315 i‡((
queue
->
iobuf˙t
 - queue->
ªqout°™dög
) == 0) {

2316 (
NULL
);

2317 } i‡(
queue
->
iobuf˙t
 == 1) {

2318 i‡(
	`READY_TO_GO
(
queue
->
li°
,queue)) {

2319 
ãmp
 = 
queue
->
li°
;

2321 
ãmp
 = 
NULL
;

2324 i‡(
queue
->
sched_Æg
 =
FCFS
) {

2325 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_fcfs_queue
(
queue
);

2326 } i‡(
queue
->
sched_Æg
 =
PRI_VSCAN_LBN
) {

2327 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_¥i_lbn_vsˇn_queue
(
queue
, 
	`devi˚_gë_numbî_of_blocks
(queue->
li°
->
devno
), queue->
vsˇn_cyls
);

2328 } i‡(
queue
->
sched_Æg
 =
ELEVATOR_LBN
) {

2329 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_lbn_vsˇn_queue
(
queue
, 
	`devi˚_gë_numbî_of_blocks
(queue->
li°
->
devno
));

2330 } i‡(
queue
->
sched_Æg
 =
CYCLE_LBN
) {

2331 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_lbn_sˇn_queue
(
queue
);

2332 } i‡(
queue
->
sched_Æg
 =
SSTF_LBN
) {

2333 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_lbn_vsˇn_queue
(
queue
, 0);

2334 } i‡(
queue
->
sched_Æg
 =
ELEVATOR_CYL
) {

2335 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_cyl_vsˇn_queue
(
queue
, 
	`devi˚_gë_numcyls
(queue->
li°
->
devno
));

2336 } i‡(
queue
->
sched_Æg
 =
CYCLE_CYL
) {

2337 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_cyl_sˇn_queue
(
queue
);

2338 } i‡(
queue
->
sched_Æg
 =
SSTF_CYL
) {

2339 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_cyl_vsˇn_queue
(
queue
, 0);

2340 } i‡(
queue
->
sched_Æg
 =
SPTF_ROT_OPT
) {

2341 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_rŸ_weight_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2342 } i‡(
queue
->
sched_Æg
 =
SPTF_ROT_WEIGHT
) {

2343 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_weight_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2344 } i‡(
queue
->
sched_Æg
 =
SPTF_SEEK_WEIGHT
) {

2345 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_£ek_weight_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2346 } i‡(
queue
->
sched_Æg
 =
TSPS
) {

2347 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_t•s_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2348 } i‡(
queue
->
sched_Æg
 =
SPTF_OPT
) {

2349 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2352 
ãmp_sdf
 = 
	`ioqueue_gë_ªque°_‰om_sdf_queue
(
queue
, 
FALSE
, FALSE);

2354 i‡((
ãmp_sdf
 !
NULL
Ë&& (
ãmp
 != NULL)) {

2356 
	`Ârötf
(
ouçutfûe
, "sptf_scheduler:: sptf = %d, sdf = %d\n",

2357 
ãmp
->
blkno
, 
ãmp_sdf
->blkno);

2359 i‡(
ãmp_sdf
->
blkno
 !
ãmp
->blkno) {

2360 
queue
->
num_•tf_sdf_dif„ª¡
++;

2362 
	`Ârötf
(
ouçutfûe
, "sptf scheduler:: sptf = %d, sdf = %d,Çum_different = %d\n",

2363 
ãmp
->
blkno
, 
ãmp_sdf
->blkno, 
queue
->
num_•tf_sdf_dif„ª¡
);

2368 } i‡(
queue
->
sched_Æg
 =
SPCTF_OPT
) {

2369 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
TRUE
, 0, TRUE);

2370 } i‡(
queue
->
sched_Æg
 =
SATF_OPT
) {

2371 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 0, 0, 
FALSE
);

2372 } i‡(
queue
->
sched_Æg
 =
WPTF_OPT
) {

2373 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 1, 
TRUE
);

2374 } i‡(
queue
->
sched_Æg
 =
WPCTF_OPT
) {

2375 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
TRUE
, 1, TRUE);

2376 } i‡(
queue
->
sched_Æg
 =
WATF_OPT
) {

2377 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 0, 1, 
FALSE
);

2378 } i‡(
queue
->
sched_Æg
 =
ASPTF_OPT
) {

2379 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 2, 
TRUE
);

2380 } i‡(
queue
->
sched_Æg
 =
ASPCTF_OPT
) {

2381 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
TRUE
, 2, TRUE);

2382 } i‡(
queue
->
sched_Æg
 =
PRI_ASPTF_OPT
) {

2383 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 3, 
TRUE
);

2384 } i‡(
queue
->
sched_Æg
 =
PRI_ASPCTF_OPT
) {

2385 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
TRUE
, 3, TRUE);

2386 } i‡(
queue
->
sched_Æg
 =
ASATF_OPT
) {

2387 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 0, 2, 
FALSE
);

2388 } i‡(
queue
->
sched_Æg
 =
VSCAN_LBN
) {

2389 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_lbn_vsˇn_queue
(
queue
, queue->
vsˇn_cyls
);

2390 } i‡(
queue
->
sched_Æg
 =
VSCAN_CYL
) {

2391 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_cyl_vsˇn_queue
(
queue
, queue->
vsˇn_cyls
);

2392 } i‡(
queue
->
sched_Æg
 =
SDF_APPROX
) {

2393 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_sdf_queue
(
queue
, 
FALSE
, FALSE);

2396 
ãmp_•tf
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2397 i‡((
ãmp_•tf
 !
NULL
Ë&& (
ãmp
 != NULL)) {

2398 i‡(
ãmp_•tf
->
blkno
 !
ãmp
->blkno) {

2399 
queue
->
num_•tf_sdf_dif„ª¡
++;

2408 } i‡(
queue
->
sched_Æg
 =
SDF_EXACT
) {

2409 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_sdf_queue
(
queue
, 
TRUE
, 
FALSE
);

2412 
ãmp_•tf
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2414 i‡((
ãmp_•tf
 !
NULL
Ë&& (
ãmp
 != NULL)) {

2415 i‡(
ãmp_•tf
->
blkno
 !
ãmp
->blkno) {

2416 
queue
->
num_•tf_sdf_dif„ª¡
++;

2427 
queue
->
dú
 = 
tmpdú
;

2428 i‡(
ãmp
 =
NULL
) {

2429 (
NULL
);

2430 } i‡(!
	`READY_TO_GO
(
ãmp
,
queue
)) {

2431 
	`Ârötf
(
°dîr
, "SelectedÑequest is !READY_TO_GO in show_next_request_from_subqueue\n");

2432 
	`exô
(1);

2434 
	`ASSERT
(
ãmp
->
iﬁi°
 !
NULL
);

2435 i‡(
ãmp
->
ªq˙t
 == 1) {

2436 
ªt
 = 
ãmp
->
iﬁi°
;

2437 } i‡(
ãmp
->
iob_un
.
≥nd
.
c⁄ˇt
) {

2438 
ªt
 = 
ãmp
->
iob_un
.
≥nd
.
c⁄ˇt
;

2440 
ªt
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

2441 
ãmp
->
iob_un
.
≥nd
.
c⁄ˇt
 = 
ªt
;

2442 
ªt
->
time
 = 
simtime
;

2443 
ªt
->
ty≥
 = 
ãmp
->
iﬁi°
->type;

2444 
ªt
->
√xt
 = 
NULL
;

2445 
ªt
->
¥ev
 = 
NULL
;

2446 
ªt
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

2447 
ªt
->
blkno
 = 
ãmp
->blkno;

2448 
ªt
->
Êags
 = 
ãmp
->flags;

2449 
ªt
->
bu¢o
 = 
ãmp
->
iﬁi°
->busno;

2450 
ªt
->
¶Ÿno
 = 
ãmp
->
iﬁi°
->slotno;

2451 
ªt
->
devno
 = 
ãmp
->
iﬁi°
->devno;

2452 
ªt
->
›id
 = 
ãmp
->opid;

2453 
ªt
->
buf
 = 
ãmp
->
iﬁi°
->buf;

2456 
queue
->
num_schedulög_decisi⁄s
++;

2458 (
ªt
);

2459 
	}
}

2462 
i‹eq_evít
 * 
	$ioqueue_gë_√xt_ªque°_‰om_subqueue
 (
subqueue
 *
queue
)

2464 
iobuf
 *
ãmp
 = 
NULL
;

2466 
iobuf
 *
ãmp_sdf
 = 
NULL
;

2467 
iobuf
 *
ãmp_•tf
 = 
NULL
;

2470 
i‹eq_evít
 *
ªt
;

2472 
	`ioqueue_upd©e_subqueue_°©i°ics
(
queue
);

2475 
	`ioqueue_¥öt_subqueue_°©e
(
queue
);

2478 i‡((
queue
->
iobuf˙t
 - queue->
ªqout°™dög
) == 0) {

2479 (
NULL
);

2480 } i‡(
queue
->
iobuf˙t
 == 1) {

2481 i‡(
	`READY_TO_GO
(
queue
->
li°
,queue)) {

2482 
ãmp
 = 
queue
->
li°
;

2483 
queue
->
sched_Æg
) {

2484 
ELEVATOR_LBN
:

2485 
PRI_VSCAN_LBN
:

2486 
VSCAN_LBN
:

2487 i‡(
queue
->
œ°blkno
 !
ãmp
->
blkno
) {

2488 
queue
->
dú
 = (queue->
œ°blkno
 < 
ãmp
->
blkno
Ë? 
ASC
 : 
DESC
;

2492 
ELEVATOR_CYL
:

2493 
VSCAN_CYL
:

2494 i‡(
queue
->
œ°cy o
 !
ãmp
->
cylödî
) {

2495 
queue
->
dú
 = (queue->
œ°cy o
 < 
ãmp
->
cylödî
Ë? 
ASC
 : 
DESC
;

2507 
ãmp
 = 
NULL
;

2511 i‡(
queue
->
sched_Æg
 =
FCFS
) {

2512 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_fcfs_queue
(
queue
);

2513 } i‡(
queue
->
sched_Æg
 =
PRI_VSCAN_LBN
) {

2514 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_¥i_lbn_vsˇn_queue
(
queue
, 
	`devi˚_gë_numbî_of_blocks
(queue->
li°
->
devno
), queue->
vsˇn_cyls
);

2515 } i‡(
queue
->
sched_Æg
 =
ELEVATOR_LBN
) {

2516 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_lbn_vsˇn_queue
(
queue
, 
	`devi˚_gë_numbî_of_blocks
(queue->
li°
->
devno
));

2517 } i‡(
queue
->
sched_Æg
 =
CYCLE_LBN
) {

2518 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_lbn_sˇn_queue
(
queue
);

2519 } i‡(
queue
->
sched_Æg
 =
SSTF_LBN
) {

2520 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_lbn_vsˇn_queue
(
queue
, 0);

2521 } i‡(
queue
->
sched_Æg
 =
ELEVATOR_CYL
) {

2522 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_cyl_vsˇn_queue
(
queue
, 
	`devi˚_gë_numcyls
(queue->
li°
->
devno
));

2523 } i‡(
queue
->
sched_Æg
 =
CYCLE_CYL
) {

2524 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_cyl_sˇn_queue
(
queue
);

2525 } i‡(
queue
->
sched_Æg
 =
SSTF_CYL
) {

2526 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_cyl_vsˇn_queue
(
queue
, 0);

2527 } i‡(
queue
->
sched_Æg
 =
SPTF_OPT
) {

2528 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2529 } i‡(
queue
->
sched_Æg
 =
SPTF_ROT_OPT
) {

2530 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_rŸ_weight_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2531 } i‡(
queue
->
sched_Æg
 =
SPTF_ROT_WEIGHT
) {

2532 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_weight_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2533 } i‡(
queue
->
sched_Æg
 =
SPTF_SEEK_WEIGHT
) {

2534 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_£ek_weight_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2536 } i‡(
queue
->
sched_Æg
 =
TSPS
) {

2537 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_t•s_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2540 
ãmp_sdf
 = 
	`ioqueue_gë_ªque°_‰om_sdf_queue
(
queue
, 
FALSE
, FALSE);

2543 i‡((
ãmp_sdf
 !
NULL
Ë&& (
ãmp
 != NULL)) {

2545 
	`Ârötf
(
ouçutfûe
, "sptf_scheduler:: sptf = %d, sdf = %d\n",

2546 
ãmp
->
blkno
, 
ãmp_sdf
->blkno);

2548 i‡(
ãmp_sdf
->
blkno
 !
ãmp
->blkno) {

2549 
queue
->
num_•tf_sdf_dif„ª¡
++;

2551 
	`Ârötf
(
ouçutfûe
, "sptf scheduler:: sptf = %d, sdf = %d,Çum_different = %d\n",

2552 
ãmp
->
blkno
, 
ãmp_sdf
->blkno, 
queue
->
num_•tf_sdf_dif„ª¡
);

2558 } i‡(
queue
->
sched_Æg
 =
SPCTF_OPT
) {

2559 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
TRUE
, 0, TRUE);

2560 } i‡(
queue
->
sched_Æg
 =
SATF_OPT
) {

2561 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 0, 0, 
FALSE
);

2562 } i‡(
queue
->
sched_Æg
 =
WPTF_OPT
) {

2563 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 1, 
TRUE
);

2564 } i‡(
queue
->
sched_Æg
 =
WPCTF_OPT
) {

2565 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
TRUE
, 1, TRUE);

2566 } i‡(
queue
->
sched_Æg
 =
WATF_OPT
) {

2567 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 0, 1, 
FALSE
);

2568 } i‡(
queue
->
sched_Æg
 =
ASPTF_OPT
) {

2569 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 2, 
TRUE
);

2570 } i‡(
queue
->
sched_Æg
 =
ASPCTF_OPT
) {

2571 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
TRUE
, 2, TRUE);

2572 } i‡(
queue
->
sched_Æg
 =
PRI_ASPTF_OPT
) {

2573 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 3, 
TRUE
);

2574 } i‡(
queue
->
sched_Æg
 =
PRI_ASPCTF_OPT
) {

2575 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
TRUE
, 3, TRUE);

2576 } i‡(
queue
->
sched_Æg
 =
ASATF_OPT
) {

2577 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 0, 2, 
FALSE
);

2578 } i‡(
queue
->
sched_Æg
 =
VSCAN_LBN
) {

2579 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_lbn_vsˇn_queue
(
queue
, queue->
vsˇn_cyls
);

2580 } i‡(
queue
->
sched_Æg
 =
VSCAN_CYL
) {

2581 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_cyl_vsˇn_queue
(
queue
, queue->
vsˇn_cyls
);

2582 } i‡(
queue
->
sched_Æg
 =
SDF_APPROX
) {

2583 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_sdf_queue
(
queue
, 
FALSE
, FALSE);

2586 
ãmp_•tf
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2588 i‡((
ãmp_•tf
 !
NULL
Ë&& (
ãmp
 != NULL)) {

2589 i‡(
ãmp_•tf
->
blkno
 !
ãmp
->blkno) {

2590 
queue
->
num_•tf_sdf_dif„ª¡
++;

2599 } i‡(
queue
->
sched_Æg
 =
SDF_EXACT
) {

2600 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_sdf_queue
(
queue
, 
TRUE
, 
FALSE
);

2603 
ãmp_•tf
 = 
	`ioqueue_gë_ªque°_‰om_›t_•tf_queue
(
queue
, 
FALSE
, 0, 
TRUE
);

2605 i‡((
ãmp_•tf
 !
NULL
Ë&& (
ãmp
 != NULL)) {

2606 i‡(
ãmp_•tf
->
blkno
 !
ãmp
->blkno) {

2607 
queue
->
num_•tf_sdf_dif„ª¡
++;

2615 } i‡(
queue
->
sched_Æg
 =
BATCH_FCFS
) {

2616 
ãmp
 = 
	`ioqueue_gë_ªque°_‰om_b©ch_fcfs_queue
(
queue
);

2620 i‡(
ãmp
 =
NULL
) {

2622 (
NULL
);

2623 } i‡(!
	`READY_TO_GO
(
ãmp
,
queue
)) {

2624 
	`Ârötf
(
°dîr
, "SelectedÑequest is !READY_TO_GO in get_next_request_from_subqueue\n");

2625 
	`exô
(1);

2630 
queue
->
sched_Æg
) {

2631 
ELEVATOR_LBN
:

2632 
CYCLE_LBN
:

2633 
PRI_VSCAN_LBN
:

2634 
ELEVATOR_CYL
:

2635 
CYCLE_CYL
:

2636 
queue
->
œ°blkno
 = 
ãmp
->
blkno
;

2639 
VSCAN_LBN
:

2640 
VSCAN_CYL
:

2641 i‡(
queue
->
vsˇn_cyls
 > 0) {

2642 
queue
->
œ°blkno
 = 
ãmp
->
blkno
;

2645 
SSTF_LBN
:

2646 i‡(
queue
->
sched_Æg
 !
VSCAN_CYL
) {

2647 
queue
->
œ°blkno
 = 
ãmp
->
blkno
 +Åemp->
tŸÆsize
;

2648 i‡(
queue
->
œ°blkno
 !
	`devi˚_gë_numbî_of_blocks
(
ãmp
->
iﬁi°
->
devno
)) {

2652 
BATCH_FCFS
:

2653 
	`°©_upd©e
(&
queue
->
bigqueue
->
b©chsize°©s
, 
ãmp
->
b©ch_size
);

2656 
queue
->
œ°blkno
 = 
ãmp
->
blkno
 +Åemp->
tŸÆsize
 - 1;

2659 
	`ioqueue_gë_cylödî_m≠pög
(
queue
->
bigqueue
, 
ãmp
, queue->
œ°blkno
, &queue->
œ°cy o
, &queue->
œ°surÁ˚
, -1);

2660 
	`ioqueue_gë_cylödî_m≠pög
(
queue
->
bigqueue
, 
ãmp
, queue->
œ°blkno
, &queue->
›tcy o
, &queue->
›tsurÁ˚
, 
MAP_FULL
);

2662 i‡(
ãmp
->
°¨âime
 == -1.0) {

2663 
ãmp
->
°¨âime
 = 
simtime
;

2665 
ªt
 = 
ãmp
->
iﬁi°
;

2666 
	`°©_upd©e
(&
queue
->
ö°queuñí
, ()(queue->
iobuf˙t
 - queue->
ªqout°™dög
));

2667 
queue
->
ªqout°™dög
++;

2668 
queue
->
numout°™dög
 +
ãmp
->
ªq˙t
;

2669 
ªt
) {

2670 
	`°©_upd©e
(&
queue
->
qtime°©s
, (
ãmp
->
°¨âime
 - 
ªt
->
time
));

2671 
ªt
 =Ñë->
√xt
;

2673 i‡(
ãmp
->
iﬁi°
 =
NULL
) {

2674 
	`Ârötf
(
°dîr
, "iobuf structure withÇo iolist chosenÅo be scheduled\n");

2675 
	`exô
(1);

2676 } i‡(
ãmp
->
ªq˙t
 == 1) {

2677 
ªt
 = 
ãmp
->
iﬁi°
;

2678 i‡(
ªt
->
√xt
) {

2679 
	`Ârötf
(
°dîr
, "MoreÅhan oneÑequest whenÅemp->reqcnt == 1\n");

2680 
	`exô
(1);

2682 
ãmp
->
iﬁi°
 = 
NULL
;

2683 
ãmp
->
iob_un
.
time
 = 
ªt
->time;

2684 } i‡(
ãmp
->
iob_un
.
≥nd
.
c⁄ˇt
) {

2685 
ªt
 = 
ãmp
->
iob_un
.
≥nd
.
c⁄ˇt
;

2686 
ãmp
->
iob_un
.
≥nd
.
c⁄ˇt
 = 
NULL
;

2687 } i‡(
queue
->
sched_Æg
 =
BATCH_FCFS
) {

2688 
ªt
 = 
ãmp
->
b©ch_li°
;

2690 
ªt
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

2691 
ªt
->
time
 = 
ãmp
->
°¨âime
;

2692 
ªt
->
ty≥
 = 
ãmp
->
iﬁi°
->type;

2693 
ªt
->
√xt
 = 
NULL
;

2694 
ªt
->
¥ev
 = 
NULL
;

2695 
ªt
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

2696 
ªt
->
blkno
 = 
ãmp
->blkno;

2697 
ªt
->
Êags
 = 
ãmp
->flags;

2698 
ªt
->
bu¢o
 = 
ãmp
->
iﬁi°
->busno;

2699 
ªt
->
¶Ÿno
 = 
ãmp
->
iﬁi°
->slotno;

2700 
ªt
->
devno
 = 
ãmp
->
iﬁi°
->devno;

2701 
ªt
->
›id
 = 
ãmp
->opid;

2702 
ªt
->
buf
 = 
ãmp
->
iﬁi°
->buf;

2704 
queue
->
cuºít
 = 
ãmp
;

2705 
ãmp
->
°©e
 = 
PENDING
;

2707 
queue
->
num_schedulög_decisi⁄s
++;

2709 (
ªt
);

2710 
	}
}

2713 
	$ioqueue_ªque°_m©ch
 (
i‹eq_evít
 *
w™ãd
, 
iobuf
 *
cuº
)

2715 
i‹eq_evít
 *
tmp
;

2719 i‡(
cuº
->
b©ch_li°
 !
NULL
) {

2720 
tmp
 = 
cuº
->
b©ch_li°
;

2721 
tmp
) {

2722 i‡((
tmp
->
blkno
 =
w™ãd
->blknoË&& (tmp->
›id
 == wanted->opid)) {

2725 
tmp
 =Åmp->
b©ch_√xt
;

2728 i‡((
cuº
->
blkno
 <
w™ãd
->blknoË&& ((cuº->blknÿ+ cuº->
tŸÆsize
) >= wanted->blkno)) {

2729 i‡((
cuº
->
blkno
 =
w™ãd
->blknoË&& (cuº->
›id
 =w™ãd->›idË&& ((cuº->
Êags
 & 
READ
) == (wanted->flags & READ))) {

2732 
tmp
 = 
cuº
->
iﬁi°
;

2733 
tmp
) {

2734 i‡((
tmp
->
blkno
 =
w™ãd
->blknoË&& (tmp->
›id
 == wanted->opid)) {

2737 
tmp
 =Åmp->
√xt
;

2742 
	}
}

2748 
i‹eq_evít
 * 
	$ioqueue_gë_•ecific_ªque°_‰om_subqueue
 (
subqueue
 *
queue
, 
i‹eq_evít
 *
w™ãd
)

2750 
iobuf
 *
ãmp
;

2751 
i‹eq_evít
 *
ªt
;

2753 
	`ioqueue_upd©e_subqueue_°©i°ics
(
queue
);

2754 i‡((
queue
->
iobuf˙t
 - queue->
ªqout°™dög
) == 0) {

2755 (
NULL
);

2757 
ãmp
 = 
queue
->
li°
;

2758 (
ãmp
->
√xt
 !
queue
->
li°
Ë&& (
	`ioqueue_ªque°_m©ch
(
w™ãd
,Åemp) == 0)) {

2759 
ãmp
 =Åemp->
√xt
;

2762 i‡(
	`ioqueue_ªque°_m©ch
(
w™ãd
, 
ãmp
) == 0) {

2763 (
NULL
);

2765 
	`ASSERT
(
	`READY_TO_GO
(
ãmp
,
queue
));

2767 
queue
->
sched_Æg
) {

2768 
ELEVATOR_LBN
:

2769 
CYCLE_LBN
:

2770 
PRI_VSCAN_LBN
:

2771 
ELEVATOR_CYL
:

2772 
CYCLE_CYL
:

2773 
queue
->
œ°blkno
 = 
ãmp
->
blkno
;

2776 
VSCAN_LBN
:

2777 
VSCAN_CYL
:

2778 i‡(
queue
->
vsˇn_cyls
 > 0) {

2779 
queue
->
œ°blkno
 = 
ãmp
->
blkno
;

2782 
SSTF_LBN
:

2783 i‡(
queue
->
sched_Æg
 !
VSCAN_CYL
) {

2784 
queue
->
œ°blkno
 = 
ãmp
->
blkno
 +Åemp->
tŸÆsize
;

2785 i‡(
queue
->
œ°blkno
 !
	`devi˚_gë_numbî_of_blocks
(
ãmp
->
iﬁi°
->
devno
)) {

2790 
BATCH_FCFS
:

2791 i‡(
ãmp
->
b©chno
 != -1) {

2792 
iobuf
 *
b©ch_±r
 = 
ãmp
;

2793 
b©ch_±r
->
b©chno
 =
ãmp
->batchno) {

2794 i‡(
b©ch_±r
->
°©e
 =
PENDING
) {

2797 i‡(
b©ch_±r
->
°¨âime
 == -1.0) {

2798 
b©ch_±r
->
°¨âime
 = 
simtime
;

2800 
queue
->
ªqout°™dög
++;

2801 
b©ch_±r
->
°©e
 = 
PENDING
;

2802 
b©ch_±r
 = b©ch_±r->
√xt
;

2807 
queue
->
œ°blkno
 = 
ãmp
->
blkno
 +Åemp->
tŸÆsize
 - 1;

2810 
	`ioqueue_gë_cylödî_m≠pög
(
queue
->
bigqueue
, 
ãmp
, queue->
œ°blkno
, &queue->
œ°cy o
, &queue->
œ°surÁ˚
, -1);

2811 i‡(
ãmp
->
°¨âime
 == -1.0) {

2812 
ãmp
->
°¨âime
 = 
simtime
;

2814 
ªt
 = 
ãmp
->
iﬁi°
;

2815 
	`°©_upd©e
(&
queue
->
ö°queuñí
, ()(queue->
iobuf˙t
 - queue->
ªqout°™dög
));

2816 
queue
->
ªqout°™dög
++;

2817 
queue
->
numout°™dög
 +
ãmp
->
ªq˙t
;

2818 
ªt
) {

2819 
	`°©_upd©e
(&
queue
->
qtime°©s
, (
ãmp
->
°¨âime
 - 
ªt
->
time
));

2820 
ªt
 =Ñë->
√xt
;

2822 
	`ASSERT
(
ãmp
->
iﬁi°
 !
NULL
);

2823 i‡(
ãmp
->
ªq˙t
 == 1) {

2824 
ªt
 = 
ãmp
->
iﬁi°
;

2825 
ãmp
->
iﬁi°
 = 
NULL
;

2826 
ãmp
->
iob_un
.
time
 = 
ªt
->time;

2827 } i‡(
ãmp
->
iob_un
.
≥nd
.
c⁄ˇt
) {

2828 
ªt
 = 
ãmp
->
iob_un
.
≥nd
.
c⁄ˇt
;

2829 
ãmp
->
iob_un
.
≥nd
.
c⁄ˇt
 = 
NULL
;

2831 
ªt
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

2832 
ªt
->
time
 = 
ãmp
->
°¨âime
;

2833 
ªt
->
ty≥
 = 
ãmp
->
iﬁi°
->type;

2834 
ªt
->
√xt
 = 
NULL
;

2835 
ªt
->
¥ev
 = 
NULL
;

2836 
ªt
->
bcou¡
 = 
ãmp
->
tŸÆsize
;

2837 
ªt
->
blkno
 = 
ãmp
->blkno;

2838 
ªt
->
Êags
 = 
ãmp
->flags;

2839 
ªt
->
bu¢o
 = 
ãmp
->
iﬁi°
->busno;

2840 
ªt
->
¶Ÿno
 = 
ãmp
->
iﬁi°
->slotno;

2841 
ªt
->
devno
 = 
ãmp
->
iﬁi°
->devno;

2842 
ªt
->
›id
 = 
ãmp
->opid;

2843 
ªt
->
buf
 = 
ãmp
->
iﬁi°
->buf;

2845 
queue
->
cuºít
 = 
ãmp
;

2846 
ãmp
->
°©e
 = 
PENDING
;

2847 (
ªt
);

2848 
	}
}

2851 
i‹eq_evít
 * 
	$ioqueue_£t_°¨âime_ö_subqueue
 (
subqueue
 *
queue
, 
i‹eq_evít
 *
èrgë
)

2853 
iobuf
 *
ãmp
 = 
queue
->
li°
;

2854 
i‹eq_evít
 *
ªt
;

2856 i‡((
queue
->
iobuf˙t
 - queue->
ªqout°™dög
) == 0) {

2857 (
NULL
);

2859 (
ãmp
->
√xt
 !
queue
->
li°
Ë&& (!
	`ioqueue_ªque°_m©ch
(
èrgë
,Åemp))) {

2860 
ãmp
 =Åemp->
√xt
;

2863 i‡(!
	`ioqueue_ªque°_m©ch
(
èrgë
, 
ãmp
)) {

2864 (
NULL
);

2866 
	`ASSERT
(
ãmp
->
°©e
 =
WAITING
);

2867 i‡(
ãmp
->
°¨âime
 == -1.0) {

2868 
ãmp
->
°¨âime
 = 
simtime
;

2870 
ªt
 = 
ãmp
->
iﬁi°
;

2871 (
ªt
);

2872 
	}
}

2875 
i‹eq_evít
 * 
	$ioqueue_ªmove_com∂ëed_ªque°
 (
subqueue
 *
queue
, 
i‹eq_evít
 *
d⁄e
)

2877 
iobuf
 *
tmp
;

2878 
iobuf
 *
èû
;

2879 
i‹eq_evít
 *
åv
;

2883 
	`ioqueue_upd©e_subqueue_°©i°ics
(
queue
);

2884 
tmp
 = 
queue
->
cuºít
;

2885 
	`ASSERT
 (
tmp
 !
NULL
);

2887 i‡((
tmp
->
°©e
 !
PENDING
Ë|| (
	`ioqueue_ªque°_m©ch
(
d⁄e
,Åmp) == 0)) {

2888 
tmp
 = 
queue
->
li°
->
√xt
;

2889 
èû
 = 
queue
->
li°
;

2890 (
tmp
 !
èû
Ë&& (
	`ioqueue_ªque°_m©ch
(
d⁄e
,Åmp) == 0)) {

2891 
tmp
 =Åmp->
√xt
;

2893 i‡((
tmp
->
°©e
 !
PENDING
Ë|| (
	`ioqueue_ªque°_m©ch
(
d⁄e
,Åmp) == 0)) {

2894 
	`Ârötf
(
°dîr
, "Com∂ëedÉvíànŸ foundÖídög i¿ioqueuê- blknÿ%d,Åmp->blknÿ%d,Åmp->tŸÆsizê%d, %d, %d, %d, %d\n", 
d⁄e
->
blkno
, 
tmp
->blkno,Åmp->
tŸÆsize
, (tm∞=
NULL
), d⁄e->
›id
,Åmp->›id, d⁄e->
bcou¡
);

2895 
	`Ârötf
(
°dîr
, "tmp->°©ê%d\n", 
tmp
->
°©e
);

2896 
	`as£π
(0);

2908 i‡(
tmp
->
ªq˙t
 == 1) {

2909 
	`ioqueue_ªmove_‰om_subqueue
(
queue
, 
tmp
);

2910 
åv
 = 
d⁄e
;

2911 
åv
->
bcou¡
 = 
tmp
->
tŸÆsize
;

2912 
åv
->
time
 = 
tmp
->
°¨âime
;

2913 
d⁄e
->
√xt
 = 
NULL
;

2914 
queue
->
iobuf˙t
--;

2915 
queue
->
ªqout°™dög
--;

2916 
queue
->
li°Àn
--;

2917 i‡(
tmp
->
Êags
 & 
READ
) {

2918 
queue
->
ªadÀn
--;

2920 
queue
->
numout°™dög
--;

2921 
queue
->
numcom∂ëe
++;

2922 
	`°©_upd©e
(&
queue
->
acc°©s
, (
simtime
 - 
tmp
->
°¨âime
));

2923 
disksim
->
œ°phy°ime
 = 
simtime
 - 
tmp
->
°¨âime
;

2924 
	`°©_upd©e
(&
queue
->
ouâime°©s
, (
simtime
 - 
tmp
->
iob_un
.
time
));

2926 i‡(
tmp
->
Êags
 & 
READ
) {

2927 i‡(
tmp
->
Êags
 & 
TIME_CRITICAL
) {

2928 
	`°©_upd©e
(&
queue
->
¸ôªad°©s
, (
simtime
 - 
tmp
->
iob_un
.
time
));

2930 
	`°©_upd©e
(&
queue
->
no¸ôªad°©s
, (
simtime
 - 
tmp
->
iob_un
.
time
));

2933 i‡(
tmp
->
Êags
 & 
TIME_CRITICAL
) {

2934 
	`°©_upd©e
(&
queue
->
¸ôwrôe°©s
, (
simtime
 - 
tmp
->
iob_un
.
time
));

2936 
	`°©_upd©e
(&
queue
->
no¸ôwrôe°©s
, (
simtime
 - 
tmp
->
iob_un
.
time
));

2940 i‡(
queue
->
sched_Æg
 =
BATCH_FCFS
) {

2941 
i‹eq_evít
 *
b©ch_±r
 = 
tmp
->
b©ch_li°
;

2943 
åv
 = 
d⁄e
;

2945 
b©ch_±r
 !
NULL
) {

2946 i‡((
b©ch_±r
->
blkno
 =
d⁄e
->blkno) &&

2947 (
b©ch_±r
->
›id
 =
d⁄e
->opid) &&

2948 ((
b©ch_±r
->
Êags
 & 
READ
Ë=(
d⁄e
->flags & READ))) {

2949 i‡(
tmp
->
b©ch_size
 == 1) {

2950 
tmp
->
b©ch_size
--;

2952 } i‡(
tmp
->
b©ch_li°
 =
b©ch_±r
) {

2953 
tmp
->
b©ch_li°
 = 
b©ch_±r
->
b©ch_√xt
;

2954 
b©ch_±r
->
b©ch_√xt
->
b©ch_¥ev
 = 
NULL
;

2955 
tmp
->
b©ch_size
--;

2958 
b©ch_±r
->
b©ch_¥ev
->
b©ch_√xt
 = batch_ptr->batch_next;

2959 i‡(
b©ch_±r
->
b©ch_√xt
 !
NULL
) {

2960 
b©ch_±r
->
b©ch_√xt
->
b©ch_¥ev
 = batch_ptr->batch_prev;

2962 
tmp
->
b©ch_size
--;

2966 
b©ch_±r
 = b©ch_±r->
b©ch_√xt
;

2969 
tmp
->
ªq˙t
--;

2970 
queue
->
ªqout°™dög
--;

2971 
queue
->
li°Àn
--;

2972 i‡(
åv
->
Êags
 & 
READ
) {

2973 
queue
->
ªadÀn
--;

2975 
queue
->
numout°™dög
--;

2976 
queue
->
numcom∂ëe
++;

2977 
	`°©_upd©e
(&
queue
->
acc°©s
, (
simtime
 - 
tmp
->
°¨âime
));

2978 
disksim
->
œ°phy°ime
 = 
simtime
 - 
tmp
->
°¨âime
;

2979 
	`°©_upd©e
(&
queue
->
ouâime°©s
, (
simtime
 - 
tmp
->
iob_un
.
time
));

2981 i‡(
tmp
->
Êags
 & 
READ
) {

2982 i‡(
tmp
->
Êags
 & 
TIME_CRITICAL
) {

2983 
	`°©_upd©e
(&
queue
->
¸ôªad°©s
, (
simtime
 - 
tmp
->
iob_un
.
time
));

2985 
	`°©_upd©e
(&
queue
->
no¸ôªad°©s
, (
simtime
 - 
tmp
->
iob_un
.
time
));

2988 i‡(
tmp
->
Êags
 & 
TIME_CRITICAL
) {

2989 
	`°©_upd©e
(&
queue
->
¸ôwrôe°©s
, (
simtime
 - 
tmp
->
iob_un
.
time
));

2991 
	`°©_upd©e
(&
queue
->
no¸ôwrôe°©s
, (
simtime
 - 
tmp
->
iob_un
.
time
));

2994 (
d⁄e
);

2996 
åv
 = 
tmp
->
iﬁi°
;

2997 
	`ioqueue_ªmove_‰om_subqueue
(
queue
, 
tmp
);

2998 
queue
->
iobuf˙t
--;

2999 
queue
->
ªqout°™dög
--;

3000 
queue
->
li°Àn
 -
tmp
->
ªq˙t
;

3001 i‡(
åv
->
Êags
 & 
READ
) {

3002 
queue
->
ªadÀn
 -
tmp
->
ªq˙t
;

3004 
queue
->
numout°™dög
 -
tmp
->
ªq˙t
;

3005 
queue
->
numcom∂ëe
 +
tmp
->
ªq˙t
;

3008 
åv
) {

3009 
	`°©_upd©e
(&
queue
->
acc°©s
, (
simtime
 - 
tmp
->
°¨âime
));

3010 
disksim
->
œ°phy°ime
 = 
simtime
 - 
tmp
->
°¨âime
;

3011 
	`°©_upd©e
(&
queue
->
ouâime°©s
, (
simtime
 - 
åv
->
time
));

3013 i‡(
åv
->
Êags
 & 
READ
) {

3014 i‡(
åv
->
Êags
 & 
TIME_CRITICAL
) {

3015 
	`°©_upd©e
(&
queue
->
¸ôªad°©s
, (
simtime
 - 
åv
->
time
));

3017 
	`°©_upd©e
(&
queue
->
no¸ôªad°©s
, (
simtime
 - 
åv
->
time
));

3020 i‡(
åv
->
Êags
 & 
TIME_CRITICAL
) {

3021 
	`°©_upd©e
(&
queue
->
¸ôwrôe°©s
, (
simtime
 - 
åv
->
time
));

3023 
	`°©_upd©e
(&
queue
->
no¸ôwrôe°©s
, (
simtime
 - 
åv
->
time
));

3026 
åv
 =Årv->
√xt
;

3028 
d⁄e
->
b©ch_√xt
 = 
NULL
;

3033 
åv
 = 
tmp
->
iﬁi°
;

3038 
	`addt€xåaq
((
evít
 *Ë
tmp
);

3042 (
åv
);

3043 
	}
}

3046 
i‹eq_evít
 *
	$ioqueue_gë_•ecific_ªque°
(
ioqueue
 *
queue
,

3047 
i‹eq_evít
 *
w™ãd
)

3049 
i‹eq_evít
 *
tmp
 = 
NULL
;

3056 if((
queue
->
¥i‹ôy
.
li°Àn
 - queue->¥i‹ôy.
numout°™dög
) > 0) {

3057 
tmp
 = 
	`ioqueue_gë_•ecific_ªque°_‰om_subqueue
(&
queue
->
¥i‹ôy
,

3058 
w™ãd
);

3059 
queue
->
œ°subqueue
 = 
IOQUEUE_PRIORITY
;

3062 i‡((
tmp
 =
NULL
) &&

3063 ((
queue
->
timeout
.
li°Àn
 - queue->timeout.
numout°™dög
) > 0)) {

3064 
tmp
 = 
	`ioqueue_gë_•ecific_ªque°_‰om_subqueue
(&
queue
->
timeout
, 
w™ãd
);

3065 
queue
->
œ°subqueue
 = 
IOQUEUE_TIMEOUT
;

3068 i‡((
tmp
 =
NULL
)

3069 && ((
queue
->
ba£
.
li°Àn
 - queue->ba£.
numout°™dög
) > 0)) {

3070 
tmp
 = 
	`ioqueue_gë_•ecific_ªque°_‰om_subqueue
(&
queue
->
ba£
, 
w™ãd
);

3071 
queue
->
œ°subqueue
 = 
IOQUEUE_BASE
;

3074 i‡(
tmp
) {

3075 
tmp
->
time
 = 0.0;

3082  
tmp
;

3083 
	}
}

3100 
i‹eq_evít
 * 
	$ioqueue_£t_°¨âime
 (
ioqueue
 *
queue
, 
i‹eq_evít
 *
èrgë
)

3102 
i‹eq_evít
 *
tmp
 = 
NULL
;

3108 
	`ASSERT
((
queue
->
£qscheme
 & 
IOQUEUE_CONCAT_BOTH
) == 0);

3110 i‡((
queue
->
¥i‹ôy
.
li°Àn
 - queue->¥i‹ôy.
numout°™dög
) > 0) {

3111 
tmp
 = 
	`ioqueue_£t_°¨âime_ö_subqueue
(&
queue
->
¥i‹ôy
, 
èrgë
);

3113 i‡(!
tmp
 && ((
queue
->
timeout
.
li°Àn
 - queue->timeout.
numout°™dög
) > 0)) {

3114 
tmp
 = 
	`ioqueue_£t_°¨âime_ö_subqueue
(&
queue
->
timeout
, 
èrgë
);

3116 i‡(!
tmp
 && ((
queue
->
ba£
.
li°Àn
 - queue->ba£.
numout°™dög
) > 0)) {

3117 
tmp
 = 
	`ioqueue_£t_°¨âime_ö_subqueue
(&
queue
->
ba£
, 
èrgë
);

3122 (
tmp
);

3123 
	}
}

3126 
i‹eq_evít
 * 
	$ioqueue_show_√xt_ªque°
 (
ioqueue
 *
queue
)

3128 
i‹eq_evít
 *
tmp
 = 
NULL
;

3134 i‡((
queue
->
¥i‹ôy
.
li°Àn
 - queue->¥i‹ôy.
numout°™dög
) > 0) {

3135 
tmp
 = 
	`ioqueue_show_√xt_ªque°_‰om_subqueue
(&
queue
->
¥i‹ôy
);

3137 i‡(!
tmp
 && ((
queue
->
timeout
.
li°Àn
 - queue->timeout.
numout°™dög
) > 0)) {

3138 
tmp
 = 
	`ioqueue_show_√xt_ªque°_‰om_subqueue
(&
queue
->
timeout
);

3140 i‡(!
tmp
 && ((
queue
->
ba£
.
li°Àn
 - queue->ba£.
numout°™dög
) > 0)) {

3141 
tmp
 = 
	`ioqueue_show_√xt_ªque°_‰om_subqueue
(&
queue
->
ba£
);

3146 (
tmp
);

3147 
	}
}

3150 
i‹eq_evít
 * 
	$ioqueue_gë_√xt_ªque°
 (
ioqueue
 *
queue
)

3152 
i‹eq_evít
 *
tmp
 = 
NULL
;

3157 i‡((
queue
->
¥i‹ôy
.
li°Àn
 - queue->¥i‹ôy.
numout°™dög
) > 0) {

3158 i‡((
tmp
 = 
	`ioqueue_gë_√xt_ªque°_‰om_subqueue
(&
queue
->
¥i‹ôy
))) {

3159 
queue
->
œ°subqueue
 = 
IOQUEUE_PRIORITY
;

3162 i‡(!
tmp
 && ((
queue
->
timeout
.
li°Àn
 - queue->timeout.
numout°™dög
) > 0)) {

3163 i‡((
tmp
 = 
	`ioqueue_gë_√xt_ªque°_‰om_subqueue
(&
queue
->
timeout
))) {

3164 
queue
->
œ°subqueue
 = 
IOQUEUE_TIMEOUT
;

3167 i‡(!
tmp
 && ((
queue
->
ba£
.
li°Àn
 - queue->ba£.
numout°™dög
) > 0)) {

3168 i‡((
tmp
 = 
	`ioqueue_gë_√xt_ªque°_‰om_subqueue
(&
queue
->
ba£
))) {

3169 
queue
->
œ°subqueue
 = 
IOQUEUE_BASE
;

3172 i‡(
tmp
) {

3173 
numout
 = 
queue
->
ba£
.
numout°™dög
 + queue->
timeout
.numout°™dög + queue->
¥i‹ôy
.numoutstanding;

3174 i‡(
numout
 > 
queue
->
maxout°™dög
) {

3175 
queue
->
maxout°™dög
 = 
numout
;

3177 
tmp
->
time
 = 0.0;

3182 (
tmp
);

3183 
	}
}

3186 
	$ioqueue_add_√w_ªque°
 (
ioqueue
 *
queue
, 
i‹eq_evít
 *
√w
)

3188 
iobuf
 *
tmp
;

3189 
li°Àn
;

3190 
qÀn
;

3191 
ªadÀn
;

3196 
√w
->
time
 = 
simtime
;

3197 
	`ioqueue_upd©e_¨rivÆ_°©s
(
queue
, 
√w
);

3198 
tmp
 = (
iobuf
 *Ë
	`gë‰omexåaq
();

3199 
	`SèticAs£π
 ((
iobuf
Ë<(
evít
));

3200 
tmp
->
°¨âime
 = -1.0;

3201 
tmp
->
°©e
 = 
WAITING
;

3202 
tmp
->
√xt
 = 
NULL
;

3203 
tmp
->
¥ev
 = 
NULL
;

3204 
tmp
->
tŸÆsize
 = 
√w
->
bcou¡
;

3205 
tmp
->
devno
 = 
√w
->devno;

3206 
tmp
->
blkno
 = 
√w
->blkno;

3207 
tmp
->
Êags
 = 
√w
->flags;

3208 
tmp
->
iﬁi°
 = 
√w
;

3209 
√w
->
√xt
 = 
NULL
;

3210 
tmp
->
iob_un
.
≥nd
.
waôtime
 = 0;

3211 
tmp
->
iob_un
.
≥nd
.
c⁄ˇt
 = 
NULL
;

3212 
tmp
->
ªq˙t
 = 1;

3213 
tmp
->
›id
 = 
√w
->opid;

3214 
tmp
->
b©chno
 = 
√w
->batchno;

3215 
tmp
->
b©ch_li°
 = 
NULL
;

3216 i‡(
tmp
->
b©chno
 == -1) {

3217 
tmp
->
b©ch_com∂ëe
 = 
TRUE
;

3219 
tmp
->
b©ch_com∂ëe
 = 
√w
->batch_complete;

3221 
queue
->
¥i_scheme
) {

3222 
ALLEQUAL
:

3223 i‡((
queue
->
ba£
.
sched_Æg
 =
ELEVATOR_LBN
) ||

3224 (
queue
->
ba£
.
sched_Æg
 =
CYCLE_LBN
) ||

3225 (
queue
->
ba£
.
sched_Æg
 =
SSTF_LBN
) ||

3226 (
queue
->
ba£
.
sched_Æg
 =
VSCAN_LBN
)) {

3227 
	`ioqueue_gë_cylödî_m≠pög
(
queue
, 
tmp
,Åmp->
blkno
, &tmp->
cylödî
, &tmp->
surÁ˚
, 
MAP_NONE
);

3229 
	`ioqueue_gë_cylödî_m≠pög
(
queue
, 
tmp
,Åmp->
blkno
, &tmp->
cylödî
, &tmp->
surÁ˚
, -1);

3231 
	`ioqueue_ö£π_√w_ªque°
(&
queue
->
ba£
, 
tmp
);

3233 
TWOQUEUE
:

3234 i‡(
√w
->
Êags
 & (
TIME_CRITICAL
|
TIME_LIMITED
)) {

3235 i‡((
queue
->
¥i‹ôy
.
sched_Æg
 =
ELEVATOR_LBN
) ||

3236 (
queue
->
¥i‹ôy
.
sched_Æg
 =
CYCLE_LBN
) ||

3237 (
queue
->
¥i‹ôy
.
sched_Æg
 =
SSTF_LBN
) ||

3238 (
queue
->
¥i‹ôy
.
sched_Æg
 =
VSCAN_LBN
)) {

3239 
	`ioqueue_gë_cylödî_m≠pög
(
queue
, 
tmp
,Åmp->
blkno
, &tmp->
cylödî
, &tmp->
surÁ˚
, 
MAP_NONE
);

3241 
	`ioqueue_gë_cylödî_m≠pög
(
queue
, 
tmp
,Åmp->
blkno
, &tmp->
cylödî
, &tmp->
surÁ˚
, -1);

3243 
	`ioqueue_ö£π_√w_ªque°
(&
queue
->
¥i‹ôy
, 
tmp
);

3245 i‡((
queue
->
ba£
.
sched_Æg
 =
ELEVATOR_LBN
) ||

3246 (
queue
->
ba£
.
sched_Æg
 =
CYCLE_LBN
) ||

3247 (
queue
->
ba£
.
sched_Æg
 =
SSTF_LBN
) ||

3248 (
queue
->
ba£
.
sched_Æg
 =
VSCAN_LBN
)) {

3249 
	`ioqueue_gë_cylödî_m≠pög
(
queue
, 
tmp
,Åmp->
blkno
, &tmp->
cylödî
, &tmp->
surÁ˚
, 
MAP_NONE
);

3251 
	`ioqueue_gë_cylödî_m≠pög
(
queue
, 
tmp
,Åmp->
blkno
, &tmp->
cylödî
, &tmp->
surÁ˚
, -1);

3253 
	`ioqueue_ö£π_√w_ªque°
(&
queue
->
ba£
, 
tmp
);

3257 
	`Ârötf
(
°dîr
, "UnknownÖriority scheme beingÉmployedát ioqueue_add_new_request\n");

3258 
	`exô
(1);

3260 
li°Àn
 = 
queue
->
ba£
.li°À¿+ queue->
timeout
.li°À¿+ queue->
¥i‹ôy
.listlen;

3261 
qÀn
 = 
li°Àn
 - (
queue
->
ba£
.
numout°™dög
 + queue->
timeout
.numout°™dög + queue->
¥i‹ôy
.numoutstanding);

3262 
ªadÀn
 = 
queue
->
ba£
.ªadÀ¿+ queue->
timeout
.ªadÀ¿+ queue->
¥i‹ôy
.readlen;

3263 
queue
->
maxli°Àn
 = 
	`max
(
li°Àn
, queue->maxlistlen);

3264 
queue
->
maxqÀn
 = 
	`max
(
qÀn
, queue->maxqlen);

3265 
queue
->
maxªadÀn
 = 
	`max
(
ªadÀn
, queue->maxreadlen);

3266 
queue
->
maxwrôñí
 = 
	`max
((
li°Àn
 - 
ªadÀn
), queue->maxwritelen);

3267 i‡(
li°Àn
 == 1) {

3268 
	`°©_upd©e
(&
queue
->
idÀ°©s
, (
simtime
 - queue->
idÀ°¨t
));

3270 
queue
->
idÀ°¨t
 = 
simtime
;

3271 i‡(
queue
->
idÀdëe˘
) {

3272 i‡(!(
	`ªmove‰omötq
((
evít
 *)
queue
->
idÀdëe˘
))) {

3273 
	`Ârötf
(
°dîr
, "existing idledetectÉventÇot on intq in ioqueue_add_new_request\n");

3274 
	`exô
(1);

3276 
	`addt€xåaq
((
evít
 *)
queue
->
idÀdëe˘
);

3277 
queue
->
idÀdëe˘
 = 
NULL
;

3283 
	}
}

3286 
	$ioqueue_øi£_¥i‹ôy_subqueue
 (
subqueue
 *
queue
, subqueuê*
¥i‹ôy
, 
›id
, 
¥i_scheme
)

3288 
°›
 = 
FALSE
;

3289 
iobuf
 *
tmp
;

3290 
i‹eq_evít
 *
åv
;

3291 
iobuf
 *
bump
;

3292 
found
 = 0;

3293 
io˙t
;

3297 
tmp
 = 
queue
->
li°
;

3298 i‡(
tmp
 =
NULL
) {

3299  (
FALSE
);

3301 
°›
 !
TRUE
) {

3302 
bump
 = 
NULL
;

3303 i‡((
tmp
->
iﬁi°
 =
NULL
Ë|| (tmp->
tŸÆsize
 =tmp->iﬁi°->
bcou¡
)) {

3304 i‡(
tmp
->
›id
 == opid) {

3305 
bump
 = 
tmp
;

3308 
åv
 = 
tmp
->
iﬁi°
;

3309 
åv
 !
NULL
) {

3310 i‡(
åv
->
›id
 == opid) {

3311 
bump
 = 
tmp
;

3313 
åv
 =Årv->
√xt
;

3316 
tmp
 =Åmp->
√xt
;

3317 i‡(
tmp
 =
queue
->
li°
) {

3318 
°›
 = 
TRUE
;

3320 i‡(
bump
) {

3324 i‡((
bump
->
°©e
 =
WAITING
Ë&& (
¥i_scheme
 !
ALLEQUAL
)) {

3325 
	`ioqueue_upd©e_subqueue_°©i°ics
(
queue
);

3326 
	`ioqueue_ªmove_‰om_subqueue
(
queue
, 
bump
);

3327 
	`ioqueue_ö£π_√w_ªque°
(
¥i‹ôy
, 
bump
);

3328 
found
 = 1;

3330 
found
 = (
bump
->
°©e
 =
WAITING
) ? 1 : 2;

3331 
bump
->
Êags
 |
TIME_CRITICAL
;

3332 
åv
 = 
bump
->
iﬁi°
;

3333 
åv
 !
NULL
) {

3334 i‡(
åv
->
›id
 == opid) {

3335 
åv
->
Êags
 |
TIME_CRITICAL
;

3337 
åv
 =Årv->
√xt
;

3339 i‡((
bump
->
°©e
 =
WAITING
Ë&& (
¥i_scheme
 !
ALLEQUAL
)) {

3340 
io˙t
 = 
bump
->
ªq˙t
;

3341 
¥i‹ôy
->
swôches
 +
io˙t
;

3342 
queue
->
iobuf˙t
--;

3343 
queue
->
li°Àn
 -
io˙t
;

3344 i‡(
bump
->
Êags
 & 
READ
) {

3345 
queue
->
ªadÀn
 -
io˙t
;

3346 
queue
->
numªads
 -
io˙t
;

3348 
queue
->
numwrôes
 -
io˙t
;

3357 (
found
);

3358 
	}
}

3361 
	$ioqueue_øi£_¥i‹ôy
 (
ioqueue
 *
queue
, 
›id
)

3363 
found
 = 0;

3365 
found
 = 
	`ioqueue_øi£_¥i‹ôy_subqueue
(&
queue
->
ba£
, &queue->
¥i‹ôy
, 
›id
, queue->
¥i_scheme
);

3366 i‡(
found
) {

3367 (
found
);

3369 
found
 = 
	`ioqueue_øi£_¥i‹ôy_subqueue
(&
queue
->
timeout
, &queue->
¥i‹ôy
, 
›id
, queue->
¥i_scheme
);

3370 (
found
);

3371 
	}
}

3374 
	$ioqueue_im∂emít_timeouts
 (
subqueue
 *
queue
, subqueuê*
timeout
, 
maxtime
, 
u_öt
 
Êag
)

3376 
iobuf
 *
tmp
;

3377 
iobuf
 *
d⁄e
;

3378 
i‹eq_evít
 *
åv
;

3379 
timeouts
 = 0;

3380 
io˙t
;

3382 i‡(
queue
->
li°
 =
NULL
) {

3385 
tmp
 = 
queue
->
li°
->
√xt
;

3386 
tmp
 !
queue
->
li°
) {

3387 
tmp
->
iob_un
.
≥nd
.
waôtime
++;

3391 i‡((
tmp
->
iob_un
.
≥nd
.
waôtime
 > 
maxtime
Ë&& (tmp->
°©e
 =
WAITING
)) {

3395 
d⁄e
 = 
tmp
;

3396 
tmp
 =Åmp->
√xt
;

3397 
	`ioqueue_upd©e_subqueue_°©i°ics
(
queue
);

3398 
	`ioqueue_ªmove_‰om_subqueue
(
queue
, 
d⁄e
);

3399 
	`ioqueue_ö£π_√w_ªque°
(
timeout
, 
d⁄e
);

3400 
d⁄e
->
Êags
 |
Êag
;

3401 
åv
 = 
d⁄e
->
iﬁi°
;

3402 
åv
 !
NULL
) {

3403 
åv
->
Êags
 |
Êag
;

3404 
åv
 =Årv->
√xt
;

3406 
io˙t
 = 
d⁄e
->
ªq˙t
;

3407 
queue
->
iobuf˙t
--;

3408 
queue
->
li°Àn
 -
io˙t
;

3409 i‡(
d⁄e
->
Êags
 & 
READ
) {

3410 
queue
->
numªads
 -
io˙t
;

3411 
queue
->
ªadÀn
 -
io˙t
;

3413 
queue
->
numwrôes
 -
io˙t
;

3415 
timeouts
 +
io˙t
;

3416 
timeout
->
swôches
 +
io˙t
;

3417 i‡(
queue
->
li°Àn
 == 0) {

3418 
tmp
 = 
NULL
;

3421 
tmp
 =Åmp->
√xt
;

3424 i‡(
tmp
 !
NULL
) {

3425 
tmp
->
iob_un
.
≥nd
.
waôtime
++;

3429 i‡((
tmp
->
iob_un
.
≥nd
.
waôtime
 > 
maxtime
Ë&& (tmp->
°©e
 =
WAITING
)) {

3433 
d⁄e
 = 
tmp
;

3434 
	`ioqueue_upd©e_subqueue_°©i°ics
(
queue
);

3435 
	`ioqueue_ªmove_‰om_subqueue
(
queue
, 
d⁄e
);

3436 
	`ioqueue_ö£π_√w_ªque°
(
timeout
, 
d⁄e
);

3437 
d⁄e
->
Êags
 |
Êag
;

3438 
åv
 = 
d⁄e
->
iﬁi°
;

3439 
åv
 !
NULL
) {

3440 
åv
->
Êags
 |
Êag
;

3441 
åv
 =Årv->
√xt
;

3443 
io˙t
 = 
d⁄e
->
ªq˙t
;

3444 
queue
->
iobuf˙t
--;

3445 
queue
->
li°Àn
 -
io˙t
;

3446 i‡(
d⁄e
->
Êags
 & 
READ
) {

3447 
queue
->
numªads
 -
io˙t
;

3448 
queue
->
ªadÀn
 -
io˙t
;

3450 
queue
->
numwrôes
 -
io˙t
;

3452 
timeouts
 +
io˙t
;

3453 
timeout
->
swôches
 +
io˙t
;

3456 (
timeouts
);

3457 
	}
}

3460 
	$ioqueue_tick
 (
ioqueue
 *
queue
)

3462 
timeouts
;

3463 
ªad˙t
;

3465 i‡(
queue
->
to_scheme
 =
BASETIMEOUT
) {

3466 i‡(
queue
->
¥i_scheme
 =
ALLEQUAL
) {

3470 
ªad˙t
 = 
queue
->
timeout
.
numªads
;

3471 
timeouts
 = 
	`ioqueue_im∂emít_timeouts
(&
queue
->
ba£
, &queue->
timeout
, queue->
to_time
, 
TIMED_OUT
);

3472 
queue
->
timeouts
 +=Åimeouts;

3473 
queue
->
timeouåóds
 +queue->
timeout
.
numªads
 - 
ªad˙t
;

3478 
ªad˙t
 = 
queue
->
¥i‹ôy
.
numªads
;

3479 
timeouts
 = 
	`ioqueue_im∂emít_timeouts
(&
queue
->
ba£
, &queue->
¥i‹ôy
, queue->
to_time
, 
TIMED_OUT
);

3480 
queue
->
timeouts
 +=Åimeouts;

3481 
queue
->
timeouåóds
 +queue->
¥i‹ôy
.
numªads
 - 
ªad˙t
;

3483 } i‡(
queue
->
to_scheme
 =
HALFTIMEOUT
) {

3487 
ªad˙t
 = 
queue
->
¥i‹ôy
.
numªads
;

3488 
timeouts
 = 
	`ioqueue_im∂emít_timeouts
(&
queue
->
timeout
, &queue->
¥i‹ôy
, queue->
to_time
, 
TIMED_OUT
);

3489 
queue
->
timeouts
 +=Åimeouts;

3490 
queue
->
timeouåóds
 +queue->
¥i‹ôy
.
numªads
 - 
ªad˙t
;

3494 
ªad˙t
 = 
queue
->
timeout
.
numªads
;

3495 
timeouts
 = 
	`ioqueue_im∂emít_timeouts
(&
queue
->
ba£
, &queue->
timeout
, (queue->
to_time
 / 2), 
HALF_OUT
);

3496 
queue
->
hÆfouts
 +
timeouts
;

3497 
queue
->
hÆfouåóds
 +queue->
timeout
.
numªads
 - 
ªad˙t
;

3500 
	}
}

3503 
	$ioqueue_˛obbî_ovîœps_subqueue
 (
subqueue
 *
queue
, 
i‹eq_evít
 *
ªt
, 
¨πimemax
)

3505 
iobuf
 *
tmp
;

3506 
i‹eq_evít
 *
d⁄e
;

3507 
ªad
 = 
ªt
->
Êags
 & 
READ
;

3508 (
tmp
 = 
queue
->
li°
)) {

3509 i‡((
tmp
->
°©e
 !
WAITING
Ë|| (tmp->
blkno
 !
ªt
->blknoË|| (tmp->
tŸÆsize
 !ªt->
bcou¡
Ë|| ((
ªad
Ë&& !—mp->
Êags
 & 
READ
)Ë|| (tmp->
iﬁi°
->
time
 > 
¨πimemax
)) {

3510 
tmp
 =Åmp->
√xt
;

3511 (
tmp
 !
queue
->
li°
Ë&& (—mp->
°©e
 !
WAITING
Ë|| (tmp->
blkno
 !
ªt
->blknoË|| (tmp->
tŸÆsize
 !ªt->
bcou¡
Ë|| ((
ªad
Ë&& !—mp->
Êags
 & 
READ
)Ë|| (tmp->
iﬁi°
->
time
 > 
¨πimemax
))) {

3512 
tmp
 =Åmp->
√xt
;

3514 i‡(
tmp
 =
queue
->
li°
) {

3518 
	`ASSERT
(
tmp
->
ªq˙t
 == 1);

3519 
d⁄e
 = 
	`ioqueue_gë_•ecific_ªque°_‰om_subqueue
(
queue
, 
tmp
->
iﬁi°
);

3520 
	`ASSERT
(
d⁄e
 !
NULL
);

3521 
d⁄e
 = 
	`ioqueue_ªmove_com∂ëed_ªque°
(
queue
, done);

3522 
	`ASSERT
(
d⁄e
->
√xt
 =
NULL
);

3523 
d⁄e
->
√xt
 = 
ªt
->next;

3524 
ªt
->
√xt
 = 
d⁄e
;

3525 
queue
->
bigqueue
->
ovîœpscombed
++;

3526 i‡(
d⁄e
->
Êags
 & 
READ
) {

3527 
queue
->
bigqueue
->
ovîœpscombed
++;

3530 
	}
}

3533 
i‹eq_evít
 * 
	$ioqueue_physiˇl_ac˚ss_d⁄e
 (
ioqueue
 *
queue
, 
i‹eq_evít
 *
cuº
)

3535 
i‹eq_evít
 *
ªt
;

3540 
queue
->
idÀ°¨t
 = 
simtime
;

3541 i‡((
queue
->
¥i_scheme
 !
ALLEQUAL
Ë&& ((
cuº
->
Êags
 & (
TIME_CRITICAL
|
TIME_LIMITED
)Ë|| ((queue->
to_scheme
 !
NOTIMEOUT
Ë&& (cuº->Êag†& 
TIMED_OUT
)))) {

3545 
ªt
 = 
	`ioqueue_ªmove_com∂ëed_ªque°
(&
queue
->
¥i‹ôy
, 
cuº
);

3546 } i‡((
queue
->
to_scheme
 !
NOTIMEOUT
Ë&& (
cuº
->
Êags
 & (
TIMED_OUT
|
HALF_OUT
))) {

3550 
ªt
 = 
	`ioqueue_ªmove_com∂ëed_ªque°
(&
queue
->
timeout
, 
cuº
);

3555 
ªt
 = 
	`ioqueue_ªmove_com∂ëed_ªque°
(&
queue
->
ba£
, 
cuº
);

3557 
	`ASSERT
(
ªt
 !
NULL
);

3558 i‡(
queue
->
combovîœps
) {

3559 
¨πimemax
 = (
queue
->
combovîœps
 =1Ë? 
simtime
 : 
ªt
->
time
;

3560 
	`ioqueue_˛obbî_ovîœps_subqueue
(&
queue
->
¥i‹ôy
, 
ªt
, 
¨πimemax
);

3561 
	`ioqueue_˛obbî_ovîœps_subqueue
(&
queue
->
timeout
, 
ªt
, 
¨πimemax
);

3562 
	`ioqueue_˛obbî_ovîœps_subqueue
(&
queue
->
ba£
, 
ªt
, 
¨πimemax
);

3564 i‡(
queue
->
idÀw‹k
) {

3565 
	`ioqueue_ª£t_idÀdëe˘î
(
queue
, 1);

3570 (
ªt
);

3571 
	}
}

3574 
	$ioqueue_subqueue_c›y
 (
subqueue
 *
queue
, subqueuê*
√w
)

3576 
√w
->
sched_Æg
 = 
queue
->sched_alg;

3577 
√w
->
surfovîf‹w
 = 
queue
->surfoverforw;

3578 
√w
->
f‹˚_absﬁuã_fcfs
 = 
queue
->force_absolute_fcfs;

3579 
√w
->
vsˇn_vÆue
 = 
queue
->vscan_value;

3580 
√w
->
li°
 = 
NULL
;

3581 
√w
->
cuºít
 = 
NULL
;

3582 
	}
}

3585 
ioqueue
 * 
	$ioqueue_c›y
 (
ioqueue
 *
queue
)

3587 
ioqueue
 *
√w
 = (ioqueuê*Ë
	`mÆloc
((ioqueue));

3588 
	`mem˝y
(
√w
, 
queue
, (
ioqueue
));

3590 
	`ioqueue_subqueue_c›y
(&
queue
->
ba£
, &
√w
->base);

3591 
	`ioqueue_subqueue_c›y
(&
queue
->
timeout
, &
√w
->timeout);

3592 
	`ioqueue_subqueue_c›y
(&
queue
->
¥i‹ôy
, &
√w
->priority);

3594  
√w
;

3595 
	}
}

3600 
	$ioqueue_subqueue_ª£t°©s
 (
subqueue
 *
queue
)

3602 
queue
->
numªads
 = 0;

3603 
queue
->
numwrôes
 = 0;

3604 
queue
->
swôches
 = 0;

3605 
queue
->
ruƒódÀn
 = 0.0;

3606 
queue
->
maxªadÀn
 = 0;

3607 
queue
->
maxwrôñí
 = 0;

3608 
queue
->
maxli°Àn
 = 0;

3609 
queue
->
ru∆i°Àn
 = 0.0;

3610 
queue
->
maxqÀn
 = 0;

3611 
queue
->
numcom∂ëe
 = 0;

3612 
queue
->
maxout°™dög
 = 0;

3613 
queue
->
runout°™dög
 = 0.0;

3614 
queue
->
s°fupdown˙t
 = 0;

3615 
queue
->
œ°Æt
 = 
simtime
;

3617 
queue
->
num_•tf_sdf_dif„ª¡
 = 0;

3619 
	`°©_ª£t
(&
queue
->
acc°©s
);

3620 
	`°©_ª£t
(&
queue
->
qtime°©s
);

3621 
	`°©_ª£t
(&
queue
->
ouâime°©s
);

3622 
	`°©_ª£t
(&
queue
->
¸ôªad°©s
);

3623 
	`°©_ª£t
(&
queue
->
no¸ôªad°©s
);

3624 
	`°©_ª£t
(&
queue
->
¸ôwrôe°©s
);

3625 
	`°©_ª£t
(&
queue
->
no¸ôwrôe°©s
);

3626 
	`°©_ª£t
(&
queue
->
ö°queuñí
);

3627 
	`°©_ª£t
(&
queue
->
öf›íÆty
);

3628 
	}
}

3631 
	$ioqueue_subqueue_öôülize
 (
subqueue
 *
queue
, 
devno
)

3633 
	`addli°t€xåaq
((
evít
 **)&
queue
->
li°
);

3634 
queue
->
íabÀmít
 = 
NULL
;

3635 
queue
->
dú
 = 
ASC
;

3636 
queue
->
œ°blkno
 = 0;

3637 
queue
->
œ°surÁ˚
 = 0;

3638 
queue
->
œ°cy o
 = 0;

3639 
queue
->
¥i‹
 = 0;

3640 
queue
->
s°fupdown
 = 0;

3641 
queue
->
cuºít
 = 
NULL
;

3642 
queue
->
ªadÀn
 = 0;

3643 
queue
->
iobuf˙t
 = 0;

3644 
queue
->
ªqout°™dög
 = 0;

3645 
queue
->
li°Àn
 = 0;

3646 
queue
->
numout°™dög
 = 0;

3647 
queue
->
vsˇn_vÆue
 = 0.2;

3649 
queue
->
num_•tf_sdf_dif„ª¡
 = 0;

3651 
	`°©_öôülize
(
°©deffûe
, 
°©desc_acc°©s
, &
queue
->
acc°©s
);

3652 
	`°©_öôülize
(
°©deffûe
, 
°©desc_qtime°©s
, &
queue
->
qtime°©s
);

3653 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ouâime°©s
, &
queue
->
ouâime°©s
);

3654 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ouâime°©s
, &
queue
->
¸ôªad°©s
);

3655 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ouâime°©s
, &
queue
->
no¸ôªad°©s
);

3656 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ouâime°©s
, &
queue
->
¸ôwrôe°©s
);

3657 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ouâime°©s
, &
queue
->
no¸ôwrôe°©s
);

3658 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ö°queuñí
, &
queue
->
ö°queuñí
);

3659 
	`°©_öôülize
(
°©deffûe
, 
°©desc_öf›íÆty
, &
queue
->
öf›íÆty
);

3661 i‡((
queue
->
sched_Æg
 =
VSCAN_LBN
Ë|| (queue->sched_Æg =
PRI_VSCAN_LBN
)) {

3666 
	}
}

3668 
	$ioqueue_ª£t°©s
 (
ioqueue
 *
queue
)

3670 
queue
->
timeouts
 = 0;

3671 
queue
->
timeouåóds
 = 0;

3672 
queue
->
hÆfouts
 = 0;

3673 
queue
->
hÆfouåóds
 = 0;

3674 
queue
->
idÀ°¨t
 = 
simtime
;

3675 
queue
->
maxli°Àn
 = 0;

3676 
queue
->
maxqÀn
 = 0;

3677 
queue
->
maxout°™dög
 = 0;

3678 
queue
->
maxªadÀn
 = 0;

3679 
queue
->
maxwrôñí
 = 0;

3680 
queue
->
ovîœpscombed
 = 0;

3681 
queue
->
ªadovîœpscombed
 = 0;

3682 
queue
->
£qªads
 = 0;

3683 
queue
->
£qwrôes
 = 0;

3684 
	`°©_ª£t
(&
queue
->
öèº°©s
);

3685 
	`°©_ª£t
(&
queue
->
ªadöèº°©s
);

3686 
	`°©_ª£t
(&
queue
->
wrôeöèº°©s
);

3687 
	`°©_ª£t
(&
queue
->
idÀ°©s
);

3688 
	`°©_ª£t
(&
queue
->
ªqsize°©s
);

3689 
	`°©_ª£t
(&
queue
->
ªadsize°©s
);

3690 
	`°©_ª£t
(&
queue
->
wrôesize°©s
);

3691 
	`°©_ª£t
(&
queue
->
b©chsize°©s
);

3692 
	`ioqueue_subqueue_ª£t°©s
(&
queue
->
ba£
);

3693 
	`ioqueue_subqueue_ª£t°©s
(&
queue
->
timeout
);

3694 
	`ioqueue_subqueue_ª£t°©s
(&
queue
->
¥i‹ôy
);

3695 
	}
}

3698 
	$ioqueue_£tˇŒbacks
 ()

3700 
disksim
->
timîfunc_ioqueue
 = 
ioqueue_idÀdëe˘ed
;

3701 
	}
}

3704 
	$ioqueue_öôülize
 (
ioqueue
 *
queue
, 
devno
)

3708 
	`SèticAs£π
 ((
iobuf
Ë<
DISKSIM_EVENT_SIZE
);

3709 
	`ioqueue_£tˇŒbacks
();

3710 
	`ioqueue_subqueue_öôülize
(&
queue
->
ba£
, 
devno
);

3711 
queue
->
ba£
.
bigqueue
 = queue;

3712 
	`ioqueue_subqueue_öôülize
(&
queue
->
timeout
, 
devno
);

3713 
queue
->
timeout
.
bigqueue
 = queue;

3714 
	`ioqueue_subqueue_öôülize
(&
queue
->
¥i‹ôy
, 
devno
);

3715 
queue
->
¥i‹ôy
.
bigqueue
 = queue;

3716 
queue
->
devno
 = devno;

3717 
queue
->
c⁄ˇtok
 = 
NULL
;

3718 
queue
->
idÀw‹k
 = 
NULL
;

3719 
queue
->
idÀdñay
 = 0.0;

3720 
queue
->
idÀdëe˘
 = 
NULL
;

3722 
queue
->
œ°subqueue
 = 
IOQUEUE_BASE
;

3723 
queue
->
œ°¨r
 = 0.0;

3724 
queue
->
œ°ªad
 = 0.0;

3725 
queue
->
œ°wrôe
 = 0.0;

3726 
queue
->
£qblkno
 = -1;

3727 
	`°©_öôülize
(
°©deffûe
, 
°©desc_öèº°©s
, &
queue
->
öèº°©s
);

3728 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ªadöèº°©s
, &
queue
->
ªadöèº°©s
);

3729 
	`°©_öôülize
(
°©deffûe
, 
°©desc_wrôeöèº°©s
, &
queue
->
wrôeöèº°©s
);

3730 
	`°©_öôülize
(
°©deffûe
, 
°©desc_idÀ°©s
, &
queue
->
idÀ°©s
);

3731 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ªqsize°©s
, &
queue
->
ªqsize°©s
);

3732 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ªadsize°©s
, &
queue
->
ªadsize°©s
);

3733 
	`°©_öôülize
(
°©deffûe
, 
°©desc_wrôesize°©s
, &
queue
->
wrôesize°©s
);

3734 
	`°©_öôülize
(
°©deffûe
, 
°©desc_b©chsize°©s
, &
queue
->
b©chsize°©s
);

3735 
	}
}

3738 
	$ioqueue_˛ón°©s
 (
ioqueue
 *
queue
)

3740 
çass
;

3742 
	`ioqueue_upd©e_subqueue_°©i°ics
(&
queue
->
ba£
);

3743 
	`ioqueue_upd©e_subqueue_°©i°ics
(&
queue
->
timeout
);

3744 
	`ioqueue_upd©e_subqueue_°©i°ics
(&
queue
->
¥i‹ôy
);

3745 i‡((
queue
->
ba£
.
li°Àn
 + queue->
timeout
.li°À¿+ queue->
¥i‹ôy
.listlen) == 0) {

3746 
çass
 = 
simtime
 - 
queue
->
idÀ°¨t
;

3747 
	`°©_upd©e
(&
queue
->
idÀ°©s
, 
çass
);

3749 
queue
->
idÀ°¨t
 = 
simtime
;

3750 
	}
}

3753 
ioqueue
 * 
	$ioqueue_¸óãdeÁu…queue
 ()

3755 
ioqueue
 * 
queue
 = (ioqueuê*Ë
	`mÆloc
((ioqueue));

3756 
	`bzîo
(
queue
, (
ioqueue
));

3758 
queue
->
¥ötqueue°©s
 = 1;

3759 
queue
->
¥öt¸ô°©s
 = 1;

3760 
queue
->
¥ötidÀ°©s
 = 1;

3761 
queue
->
¥ötöèº°©s
 = 1;

3762 
queue
->
¥ötsize°©s
 = 1;

3763 
queue
->
¥i‹ôy_mix
 = 1;

3775 
queue
->
ba£
.
sched_Æg
 = 
FCFS
;

3776 
queue
->
cylm≠ty≥
 = 
MAP_NONE
;

3785 
queue
->
timeout
.
sched_Æg
 = 
FCFS
;

3787 
queue
->
¥i‹ôy
.
sched_Æg
 = 
FCFS
;

3789 (
queue
);

3790 
	}
}

3798 
ioq
 *
	$disksim_ioqueue_lﬂd∑øms
(
Õ_block
 *
b
,

3799 
¥ötqueue°©s
,

3800 
¥öt¸ô°©s
,

3801 
¥ötidÀ°©s
,

3802 
¥ötöèº°©s
,

3803 
¥ötsize°©s
)

3805 
ioq
 *
ªsu…
;

3807 
ªsu…
 = 
	`mÆloc
((
ioqueue
));

3808 
	`bzîo
(
ªsu…
, (
ioqueue
));

3810 
ªsu…
->
¥ötqueue°©s
 =Örintqueuestats;

3811 
ªsu…
->
¥öt¸ô°©s
 =Örintcritstats;

3812 
ªsu…
->
¥ötidÀ°©s
 =Örintidlestats;

3813 
ªsu…
->
¥ötöèº°©s
 =Örintintarrstats;

3814 
ªsu…
->
¥ötsize°©s
 =Örintsizestats;

3816 
ªsu…
->
¥i‹ôy_mix
 = 1;

3818 if(
b
->
«me
Ë
ªsu…
->«mê
	`°rdup
(b->name);

3824 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
disksim_ioqueue_mod
);

3826  
ªsu…
;

3827 
	}
}

3829 
	$ioqueue_¥ötqueue°©s
 (
ioqueue
 **
£t
, 
£tsize
, *
¥efix
)

3831 
maxli°Àn
 = 0.0;

3832 
maxqÀn
 = 0.0;

3833 
maxªadÀn
 = 0.0;

3834 
maxwrôñí
 = 0.0;

3835 
ru∆i°Àn
 = 0.0;

3836 
runout°™dög
 = 0.0;

3837 
ruƒódÀn
 = 0.0;

3838 
runwrôñí
 = 0.0;

3839 
li°Àn
 = 0;

3840 
numout°™dög
 = 0;

3841 
numcom∂ëe
 = 0;

3842 
i
;

3844 
°©gí
 ** 
°©£t
;

3845 
°©£t
 = (
°©gí
 **Ë
	`DISKSIM_mÆloc
 (3*
£tsize
*(statgen *));

3846 
	`ASSERT
 (
°©£t
 !
NULL
);

3848 
i
=0; i<
£tsize
; i++) {

3849 i‡(
£t
[
i
]->
¥ötqueue°©s
 =
FALSE
)

3852 i‡(
£t
[
i
]->
maxli°Àn
 > maxlistlen)

3853 
maxli°Àn
 = 
£t
[
i
]->maxlistlen;

3854 i‡(
£t
[
i
]->
maxqÀn
 > maxqlen)

3855 
maxqÀn
 = 
£t
[
i
]->maxqlen;

3856 i‡(
£t
[
i
]->
maxªadÀn
 > maxreadlen)

3857 
maxªadÀn
 = 
£t
[
i
]->maxreadlen;

3858 i‡(
£t
[
i
]->
maxwrôñí
 > maxwritelen)

3859 
maxwrôñí
 = 
£t
[
i
]->maxwritelen;

3860 
numcom∂ëe
 +
£t
[
i
]->
ba£
.numcom∂ëê+ së[i]->
timeout
.numcom∂ëê+ së[i]->
¥i‹ôy
.numcomplete;

3861 
ru∆i°Àn
 +
£t
[
i
]->
ba£
.ru∆i°À¿+ së[i]->
timeout
.ru∆i°À¿+ së[i]->
¥i‹ôy
.runlistlen;

3862 
runout°™dög
 +
£t
[
i
]->
ba£
.runout°™dög + së[i]->
timeout
.runout°™dög + së[i]->
¥i‹ôy
.runoutstanding;

3863 
li°Àn
 +
£t
[
i
]->
ba£
.li°À¿+ së[i]->
timeout
.li°À¿+ së[i]->
¥i‹ôy
.listlen;

3864 
numout°™dög
 +
£t
[
i
]->
ba£
.numout°™dög + së[i]->
timeout
.numout°™dög + së[i]->
¥i‹ôy
.numoutstanding;

3865 
ruƒódÀn
 +
£t
[
i
]->
ba£
.ruƒódÀ¿+ së[i]->
timeout
.ruƒódÀ¿+ së[i]->
¥i‹ôy
.runreadlen;

3867 
runwrôñí
 = 
ru∆i°Àn
 - 
ruƒódÀn
;

3869 
	`Ârötf
(
ouçutfûe
, "%§u∆i°Àn: %f\n", 
¥efix
, 
ru∆i°Àn
);

3870 
	`Ârötf
(
ouçutfûe
, "%§unout°™dög: %f\n", 
¥efix
, 
runout°™dög
);

3871 
	`Ârötf
(
ouçutfûe
, "%ssimtime: %f\n", 
¥efix
, 
simtime
);

3872 
	`Ârötf
(
ouçutfûe
, "%sw¨mu±ime: %f\n", 
¥efix
, 
w¨mu±ime
);

3873 
	`Ârötf
(
ouçutfûe
, "%s£tsize: %d\n", 
¥efix
, 
£tsize
);

3875 
	`Ârötf
(
ouçutfûe
, "%sAvîagê#Ñeque°s: %f\n", 
¥efix
, (
ru∆i°Àn
/((
simtime
 - 
w¨mu±ime
Ë* (Ë
£tsize
)));

3876 
	`Ârötf
(
ouçutfûe
, "%sMaximum #Ñeque°s: %d\n", 
¥efix
, 
maxli°Àn
);

3877 
	`Ârötf
(
ouçutfûe
, "%sEnd #Ñeque°s: %d\n", 
¥efix
, 
li°Àn
);

3878 
	`Ârötf
(
ouçutfûe
, "%sAvîagêqueuêÀngth: %f\n", 
¥efix
, ((
ru∆i°Àn
 - 
runout°™dög
)/((
simtime
 - 
w¨mu±ime
Ë* (Ë
£tsize
)));

3879 
	`Ârötf
(
ouçutfûe
, "%sMaximum queuêÀngth: %d\n", 
¥efix
, 
maxqÀn
);

3880 
	`Ârötf
(
ouçutfûe
, "%sEnd queuedÑeque°s: %d\n", 
¥efix
, (
li°Àn
 - 
numout°™dög
));

3882 
i
=0; i<
£tsize
; i++) {

3883 
°©£t
[(3*
i
)] = &
£t
[i]->
ba£
.
qtime°©s
;

3884 
°©£t
[((3*
i
)+1)] = &
£t
[i]->
¥i‹ôy
.
qtime°©s
;

3885 
°©£t
[((3*
i
)+2)] = &
£t
[i]->
timeout
.
qtime°©s
;

3887 
	`°©_¥öt_£t
(
°©£t
, (3*
£tsize
), 
¥efix
);

3889 
	`Ârötf
 (
ouçutfûe
, "%sAvg #ÑódÑeque°s: %f\n", 
¥efix
, (
ruƒódÀn
 / ((
simtime
 - 
w¨mu±ime
Ë* (Ë
£tsize
)));

3890 
	`Ârötf
 (
ouçutfûe
, "%sMax #ÑódÑeque°s: %d\n", 
¥efix
, 
maxªadÀn
);

3891 
	`Ârötf
 (
ouçutfûe
, "%sAvg # wrôêªque°s: %f\n", 
¥efix
, (
runwrôñí
 / ((
simtime
 - 
w¨mu±ime
Ë* (Ë
£tsize
)));

3892 
	`Ârötf
 (
ouçutfûe
, "%sMax # wrôêªque°s: %d\n", 
¥efix
, 
maxwrôñí
);

3894 
i
=0; i<
£tsize
; i++) {

3895 
°©£t
[(3*
i
)] = &
£t
[i]->
ba£
.
acc°©s
;

3896 
°©£t
[((3*
i
)+1)] = &
£t
[i]->
¥i‹ôy
.
acc°©s
;

3897 
°©£t
[((3*
i
)+2)] = &
£t
[i]->
timeout
.
acc°©s
;

3899 
	`°©_¥öt_£t
(
°©£t
, (3*
£tsize
), 
¥efix
);

3901 
i
=0; i<
£tsize
; i++) {

3902 
°©£t
[
i
] = &
£t
[i]->
b©chsize°©s
;

3904 
	`Ârötf
 (
ouçutfûe
, "%sNumbî o‡b©ches: %d\n", 
¥efix
, 
	`°©_gë_cou¡_£t
(
°©£t
, 
£tsize
));

3905 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

3906 
	`‰ì
(
°©£t
);

3907 
	}
}

3910 
	$ioqueue_¥ötöèº°©s
 (
ioqueue
 **
£t
, 
£tsize
, *
¥efix
)

3912 
i
;

3913 
°©gí
 ** 
°©£t
;

3915 
°©£t
 = (
°©gí
 **Ë
	`DISKSIM_mÆloc
 (
£tsize
*(statgen *));

3916 
	`ASSERT
 (
°©£t
 !
NULL
);

3918 
i
=0; i<
£tsize
; i++) {

3919 
°©£t
[
i
] = &
£t
[i]->
öèº°©s
;

3920 i‡(
£t
[
i
]->
¥ötidÀ°©s
 =
FALSE
) {

3924 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

3926 
i
=0; i<
£tsize
; i++) {

3927 
°©£t
[
i
] = &
£t
[i]->
ªadöèº°©s
;

3929 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

3931 
i
=0; i<
£tsize
; i++) {

3932 
°©£t
[
i
] = &
£t
[i]->
wrôeöèº°©s
;

3934 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

3935 
	`‰ì
(
°©£t
);

3936 
	}
}

3939 
	$ioqueue_¥ötsize°©s
 (
ioqueue
 **
£t
, 
£tsize
, *
¥efix
)

3941 
i
;

3942 
°©gí
 ** 
°©£t
;

3944 
°©£t
 = (
°©gí
 **Ë
	`DISKSIM_mÆloc
 (
£tsize
*(statgen *));

3945 
	`ASSERT
 (
°©£t
 !
NULL
);

3947 
i
=0; i<
£tsize
; i++) {

3948 
°©£t
[
i
] = &
£t
[i]->
ªqsize°©s
;

3949 i‡(
£t
[
i
]->
¥ötsize°©s
 =
FALSE
) {

3953 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

3955 
i
=0; i<
£tsize
; i++) {

3956 
°©£t
[
i
] = &
£t
[i]->
ªadsize°©s
;

3958 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

3960 
i
=0; i<
£tsize
; i++) {

3961 
°©£t
[
i
] = &
£t
[i]->
wrôesize°©s
;

3963 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

3964 
	`‰ì
(
°©£t
);

3965 
	}
}

3968 
	$ioqueue_¥ötidÀ°©s
 (
ioqueue
 **
£t
, 
£tsize
, *
¥efix
)

3970 
i
;

3971 
°©gí
 ** 
°©£t
;

3973 
°©£t
 = (
°©gí
 **Ë
	`DISKSIM_mÆloc
 (
£tsize
*(statgen *));

3974 
	`ASSERT
 (
°©£t
 !
NULL
);

3976 
i
=0; i<
£tsize
; i++) {

3977 
°©£t
[
i
] = &
£t
[i]->
idÀ°©s
;

3978 i‡(
£t
[
i
]->
¥ötidÀ°©s
 =
FALSE
) {

3982 
	`Ârötf
 (
ouçutfûe
, "%sNumbî o‡idÀÖîiods: %d\n", 
¥efix
, 
	`°©_gë_cou¡_£t
(
°©£t
, 
£tsize
));

3983 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

3984 
	`‰ì
(
°©£t
);

3985 
	}
}

3988 
	$ioqueue_¥öt¸ô°©s
 (
subqueue
 **
£t
, 
£tsize
, *
¥efix
, 
numªqs
)

3990 
¥efix2
[256];

3991 
˙t
;

3992 
i
;

3993 
°©gí
 ** 
°©£t
;

3995 
°©£t
 = (
°©gí
 **Ë
	`DISKSIM_mÆloc
 (
£tsize
*(statgen *));

3996 
	`ASSERT
 (
°©£t
 !
NULL
);

4000 
i
=0; i<
£tsize
; i++) {

4001 
°©£t
[
i
] = &
£t
[i]->
¸ôªad°©s
;

4003 
˙t
 = 
	`°©_gë_cou¡_£t
(
°©£t
, 
£tsize
);

4004 
	`Ârötf
 (
ouçutfûe
, "%sCrôiˇ»Róds: \t%6d \t%f\n", 
¥efix
, 
˙t
, ((Ë˙à/ (Ë
	`max
(
numªqs
,1)));

4005 
	`•rötf
(
¥efix2
, "%sCrôiˇ»Ród ", 
¥efix
);

4006 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix2
);

4008 
i
=0; i<
£tsize
; i++) {

4009 
°©£t
[
i
] = &
£t
[i]->
no¸ôªad°©s
;

4011 
˙t
 = 
	`°©_gë_cou¡_£t
(
°©£t
, 
£tsize
);

4012 
	`Ârötf
 (
ouçutfûe
, "%sN⁄-Crôiˇ»Róds: \t%6d \t%f\n", 
¥efix
, 
˙t
, ((Ë˙à/ (Ë
	`max
(
numªqs
,1)));

4013 
	`•rötf
(
¥efix2
, "%sN⁄-Crôiˇ»Ród ", 
¥efix
);

4014 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix2
);

4016 
i
=0; i<
£tsize
; i++) {

4017 
°©£t
[
i
] = &
£t
[i]->
¸ôwrôe°©s
;

4019 
˙t
 = 
	`°©_gë_cou¡_£t
(
°©£t
, 
£tsize
);

4020 
	`Ârötf
 (
ouçutfûe
, "%sCrôiˇ»Wrôes: \t%6d \t%f\n", 
¥efix
, 
˙t
, ((Ë˙à/ (Ë
	`max
(
numªqs
,1)));

4021 
	`•rötf
(
¥efix2
, "%sCrôiˇ»Wrôê", 
¥efix
);

4022 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix2
);

4024 
i
=0; i<
£tsize
; i++) {

4025 
°©£t
[
i
] = &
£t
[i]->
no¸ôwrôe°©s
;

4027 
˙t
 = 
	`°©_gë_cou¡_£t
(
°©£t
, 
£tsize
);

4028 
	`Ârötf
 (
ouçutfûe
, "%sN⁄-Crôiˇ»Wrôes: \t%6d \t%f\n", 
¥efix
, 
˙t
, ((Ë˙à/ (Ë
	`max
(
numªqs
,1)));

4029 
	`•rötf
(
¥efix2
, "%sN⁄-Crôiˇ»Wrôê", 
¥efix
);

4030 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix2
);

4031 
	`‰ì
(
°©£t
);

4032 
	}
}

4035 
	$ioqueue_subqueue_¥öt°©s
 (
subqueue
 **
£t
, 
£tsize
, *
¥efix
, 
¥öt¸ô°©s
)

4037 
numcom∂ëe
 = 0;

4038 
maxli°Àn
 = 0;

4039 
li°Àn
 = 0;

4040 
maxqÀn
 = 0;

4041 
numout°™dög
 = 0;

4042 
numªqs
 = 0;

4043 
ru∆i°Àn
 = 0.0;

4044 
runout°™dög
 = 0.0;

4045 
i
;

4046 
°©gí
 ** 
°©£t
;

4048 
°©£t
 = (
°©gí
 **Ë
	`DISKSIM_mÆloc
 (
£tsize
*(statgen *));

4049 
	`ASSERT
 (
°©£t
 !
NULL
);

4051 
i
=0; i<
£tsize
; i++) {

4052 
numªqs
 +
£t
[
i
]->
numªads
 + së[i]->
numwrôes
;

4053 
numcom∂ëe
 +
£t
[
i
]->numcomplete;

4054 
ru∆i°Àn
 +
£t
[
i
]->runlistlen;

4055 
runout°™dög
 +
£t
[
i
]->runoutstanding;

4056 
li°Àn
 +
£t
[
i
]->listlen;

4057 
numout°™dög
 +
£t
[
i
]->numoutstanding;

4058 i‡(
£t
[
i
]->
maxqÀn
 > maxqlen) {

4059 
maxqÀn
 = 
£t
[
i
]->maxqlen;

4061 i‡(
£t
[
i
]->
maxli°Àn
 > maxlistlen) {

4062 
maxli°Àn
 = 
£t
[
i
]->maxlistlen;

4066 i‡(
maxli°Àn
 == 0) {

4070 
i
=0; i<
£tsize
; i++) {

4071 
°©£t
[
i
] = &
£t
[i]->
ouâime°©s
;

4073 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

4075 i‡(
¥öt¸ô°©s
) {

4076 
	`ioqueue_¥öt¸ô°©s
 (
£t
, 
£tsize
, 
¥efix
, 
numªqs
);

4079 
	`Ârötf
(
ouçutfûe
, "%sAvîagê#Ñeque°s: %f\n", 
¥efix
, (
ru∆i°Àn
/((
simtime
 - 
w¨mu±ime
Ë* (Ë
£tsize
)));

4080 
	`Ârötf
(
ouçutfûe
, "%sMaximum #Ñeque°s: %d\n", 
¥efix
, 
maxli°Àn
);

4081 
	`Ârötf
(
ouçutfûe
, "%sEnd #Ñeque°s: %d\n", 
¥efix
, 
li°Àn
);

4082 
	`Ârötf
(
ouçutfûe
, "%sAvîagêqueuêÀngth: %f\n", 
¥efix
, ((
ru∆i°Àn
 - 
runout°™dög
)/((
simtime
 - 
w¨mu±ime
Ë* (Ë
£tsize
)));

4083 
	`Ârötf
(
ouçutfûe
, "%sMaximum queuêÀngth: %d\n", 
¥efix
, 
maxqÀn
);

4084 
	`Ârötf
(
ouçutfûe
, "%sEnd queuedÑeque°s: %d\n", 
¥efix
, (
li°Àn
 - 
numout°™dög
));

4086 
i
=0; i<
£tsize
; i++) {

4087 
°©£t
[
i
] = &
£t
[i]->
qtime°©s
;

4089 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

4091 
i
=0; i<
£tsize
; i++) {

4092 
°©£t
[
i
] = &
£t
[i]->
acc°©s
;

4094 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

4095 
	`‰ì
(
°©£t
);

4096 
	}
}

4099 
	$ioqueue_¥öt°©s
 (
ioqueue
 **
£t
, 
£tsize
, *
sour˚°r
)

4101 
to_scheme
 = 0;

4102 
¥i_scheme
 = 0;

4103 
numcom∂ëe
 = 0;

4104 
i
;

4105 
numªads
 = 0;

4106 
numwrôes
 = 0;

4107 
numªqs
 = 0;

4108 
£qªads
 = 0;

4109 
£qwrôes
 = 0;

4110 
¥öt¸ô°©s
 = 1;

4111 
idÀtime
 = 0.0;

4112 
subcheck
 = 0;

4113 
swôches
 = 0;

4114 
timeouts
 = 0;

4115 
hÆfouts
 = 0;

4116 
ovîœpscombed
 = 0;

4117 
ªadovîœpscombed
 = 0;

4119 
ba£_num_•tf_sdf_dif„ª¡
 = 0;

4120 
timeout_num_•tf_sdf_dif„ª¡
 = 0;

4121 
¥i‹ôy_num_•tf_sdf_dif„ª¡
 = 0;

4123 
ba£_num_schedulög_decisi⁄s
 = 0;

4124 
timeout_num_schedulög_decisi⁄s
 = 0;

4125 
¥i‹ôy_num_schedulög_decisi⁄s
 = 0;

4127 
¥efix
[80];

4128 
subqueue
 ** 
sub£t
;

4129 
°©gí
 ** 
°©£t
;

4131 
sub£t
 = (
subqueue
 **Ë
	`DISKSIM_mÆloc
 (3*
£tsize
*(subqueue *));

4132 
°©£t
 = (
°©gí
 **Ë
	`DISKSIM_mÆloc
 (3*
£tsize
*(statgen *));

4133 
	`ASSERT
 ((
sub£t
 !
NULL
Ë&& (
°©£t
 != NULL));

4135 
i
=0; i<
£tsize
; i++) {

4137 i‡(
£t
[
i
]->
¥ötqueue°©s
 =
FALSE
)

4140 i‡((
£t
[
i
]->
to_scheme
 !
NOTIMEOUT
Ë|| (£t[i]->
¥i_scheme
 !
ALLEQUAL
)) {

4141 
to_scheme
 = 
£t
[
i
]->to_scheme;

4142 
¥i_scheme
 = 
£t
[
i
]->pri_scheme;

4143 
subcheck
 = 1;

4146 
°©£t
[(3*
i
)] = &
£t
[i]->
ba£
.
ouâime°©s
;

4147 
°©£t
[((3*
i
)+1)] = &
£t
[i]->
timeout
.
ouâime°©s
;

4148 
°©£t
[((3*
i
)+2)] = &
£t
[i]->
¥i‹ôy
.
ouâime°©s
;

4150 
¥öt¸ô°©s
 &
£t
[
i
]->printcritstats;

4151 
numªads
 +
£t
[
i
]->
ba£
.numªad†+ së[i]->
timeout
.numªad†+ së[i]->
¥i‹ôy
.numreads;

4155 
numwrôes
 +
£t
[
i
]->
ba£
.numwrôe†+ së[i]->
timeout
.numwrôe†+ së[i]->
¥i‹ôy
.numwrites;

4160 
£qªads
 +
£t
[
i
]->seqreads;

4161 
£qwrôes
 +
£t
[
i
]->seqwrites;

4162 
idÀtime
 +
	`°©_gë_runvÆ
(&
£t
[
i
]->
idÀ°©s
);

4163 
ovîœpscombed
 +
£t
[
i
]->overlapscombed;

4164 
ªadovîœpscombed
 +
£t
[
i
]->readoverlapscombed;

4166 
ba£_num_•tf_sdf_dif„ª¡
 +
£t
[
i
]->
ba£
.
num_•tf_sdf_dif„ª¡
;

4167 
ba£_num_schedulög_decisi⁄s
 +
£t
[
i
]->
ba£
.
num_schedulög_decisi⁄s
;

4168 
timeout_num_•tf_sdf_dif„ª¡
 +
£t
[
i
]->
timeout
.
num_•tf_sdf_dif„ª¡
;

4169 
timeout_num_schedulög_decisi⁄s
 +
£t
[
i
]->
timeout
.
num_schedulög_decisi⁄s
;

4170 
¥i‹ôy_num_•tf_sdf_dif„ª¡
 +
£t
[
i
]->
¥i‹ôy
.
num_•tf_sdf_dif„ª¡
;

4171 
¥i‹ôy_num_schedulög_decisi⁄s
 +
£t
[
i
]->
¥i‹ôy
.
num_schedulög_decisi⁄s
;

4174 
numªqs
 = (Ë(
numªads
 + 
numwrôes
);

4175 
idÀtime
 /(Ë
£tsize
;

4177 
numcom∂ëe
 = 
	`°©_gë_cou¡_£t
(
°©£t
, (3*
£tsize
));

4179 
	`Ârötf
(
ouçutfûe
, "%sTŸÆ Reque°†h™dÀd:\t%d\n", 
sour˚°r
, 
numcom∂ëe
);

4180 
	`Ârötf
(
ouçutfûe
, "%sReque°†≥∏£c⁄d: \t%f\n", 
sour˚°r
, (()1000 * ()
numcom∂ëe
 / (
simtime
 - 
w¨mu±ime
)));

4181 
	`Ârötf
(
ouçutfûe
, "%sCom∂ëñy idÀÅime: \t%‡ \t%f\n", 
sour˚°r
, 
idÀtime
, (idÀtimê/ (
simtime
 - 
w¨mu±ime
)));

4183 
	`°©_¥öt_£t
(
°©£t
, (3*
£tsize
), 
sour˚°r
);

4185 
	`Ârötf
(
ouçutfûe
, "%sOvîœp†comböed: \t%d\t%f\n", 
sour˚°r
, 
ovîœpscombed
, ((Ëovîœpscombed / (Ë
	`max
(
numcom∂ëe
,1)));

4186 
	`Ârötf
(
ouçutfûe
, "%sRód ovîœp†comböed:\t%d\t%f\t%f\n", 
sour˚°r
, 
ªadovîœpscombed
, ((Ëªadovîœpscombed / (Ë
	`max
(
ovîœpscombed
,1)), ((Ëªadovîœpscombed / (Ëmax(
numªads
,1)));

4188 i‡(
¥öt¸ô°©s
) {

4189 
i
=0; i<
£tsize
; i++) {

4190 
sub£t
[(3*
i
)] = &
£t
[i]->
ba£
;

4191 
sub£t
[((3*
i
)+1)] = &
£t
[i]->
timeout
;

4192 
sub£t
[((3*
i
)+2)] = &
£t
[i]->
¥i‹ôy
;

4194 
	`ioqueue_¥öt¸ô°©s
 (
sub£t
, (3*
£tsize
), 
sour˚°r
, 
numªqs
);

4197 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡ªads: %6d \t%f\n", 
sour˚°r
, 
numªads
, ((Ënumªad†/ 
	`max
(
numªqs
,1)));

4198 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡wrôes: %6d \t%f\n", 
sour˚°r
, 
numwrôes
, ((Ënumwrôe†/ 
	`max
(
numªqs
,1)));

4199 
	`Ârötf
(
ouçutfûe
, "%sSequítü»ªads: %6d \t%‡ \t%f\n", 
sour˚°r
, 
£qªads
, ((Ë£qªad†/ (Ë
	`max
(
numªads
,1)), ((Ë£qªad†/ max(
numªqs
,1)));

4200 
	`Ârötf
(
ouçutfûe
, "%sSequítü»wrôes: %6d \t%‡ \t%f\n", 
sour˚°r
, 
£qwrôes
, ((Ë£qwrôe†/ (Ë
	`max
(
numwrôes
,1)), ((Ë£qwrôe†/ max(
numªqs
,1)));

4202 
	`Ârötf
(
ouçutfûe
, "%sBase SPTF/SDF Different: %6d / %6d \t%f\n",

4203 
sour˚°r
, 
ba£_num_•tf_sdf_dif„ª¡
, 
ba£_num_schedulög_decisi⁄s
,

4204 ((Ë
ba£_num_•tf_sdf_dif„ª¡
 / (Ë
	`max
(
ba£_num_schedulög_decisi⁄s
, 1)));

4205 
	`Ârötf
(
ouçutfûe
, "%sTimeout SPTF/SDF Different: %6d / %6d \t%f\n",

4206 
sour˚°r
, 
timeout_num_•tf_sdf_dif„ª¡
, 
timeout_num_schedulög_decisi⁄s
,

4207 ((Ë
timeout_num_•tf_sdf_dif„ª¡
 / (Ë
	`max
(
timeout_num_schedulög_decisi⁄s
, 1)));

4208 
	`Ârötf
(
ouçutfûe
, "%sPriority SPTF/SDF Different: %6d / %6d \t%f\n",

4209 
sour˚°r
, 
¥i‹ôy_num_•tf_sdf_dif„ª¡
, 
¥i‹ôy_num_schedulög_decisi⁄s
,

4210 ((Ë
¥i‹ôy_num_•tf_sdf_dif„ª¡
 / (Ë
	`max
(
¥i‹ôy_num_schedulög_decisi⁄s
, 1)));

4212 
	`ioqueue_¥ötqueue°©s
(
£t
, 
£tsize
, 
sour˚°r
);

4213 
	`ioqueue_¥ötöèº°©s
(
£t
, 
£tsize
, 
sour˚°r
);

4214 
	`ioqueue_¥ötidÀ°©s
(
£t
, 
£tsize
, 
sour˚°r
);

4215 
	`ioqueue_¥ötsize°©s
(
£t
, 
£tsize
, 
sour˚°r
);

4217 
i
=0; i<
£tsize
; i++) {

4218 
°©£t
[(3*
i
)] = &
£t
[i]->
ba£
.
ö°queuñí
;

4219 
°©£t
[((3*
i
)+1)] = &
£t
[i]->
timeout
.
ö°queuñí
;

4220 
°©£t
[((3*
i
)+2)] = &
£t
[i]->
¥i‹ôy
.
ö°queuñí
;

4222 
	`°©_¥öt_£t
(
°©£t
, (3*
£tsize
), 
sour˚°r
);

4223 
i
=0; i<
£tsize
; i++) {

4224 
°©£t
[(3*
i
)] = &
£t
[i]->
ba£
.
öf›íÆty
;

4225 
°©£t
[((3*
i
)+1)] = &
£t
[i]->
timeout
.
öf›íÆty
;

4226 
°©£t
[((3*
i
)+2)] = &
£t
[i]->
¥i‹ôy
.
öf›íÆty
;

4228 
	`°©_¥öt_£t
(
°©£t
, (3*
£tsize
), 
sour˚°r
);

4229 i‡(
subcheck
) {

4230 
	`Ârötf
 (
ouçutfûe
, "%sBa£ queuê°©i°ics\n", 
sour˚°r
);

4231 
i
=0; i<
£tsize
; i++) {

4232 
sub£t
[
i
] = &
£t
[i]->
ba£
;

4234 
	`•rötf
(
¥efix
, "%sba£ ", 
sour˚°r
);

4235 
	`ioqueue_subqueue_¥öt°©s
(
sub£t
, 
£tsize
, 
¥efix
, 
¥öt¸ô°©s
);

4236 i‡(
to_scheme
 !
NOTIMEOUT
) {

4237 
	`Ârötf
 (
ouçutfûe
, "%sTimeouàqueuê°©i°ics\n", 
sour˚°r
);

4238 
swôches
 = 0;

4239 
i
=0; i<
£tsize
; i++) {

4240 
sub£t
[
i
] = &
£t
[i]->
timeout
;

4241 
swôches
 +
£t
[
i
]->
timeout
.switches;

4242 
timeouts
 +
£t
[
i
]->timeouts;

4243 
hÆfouts
 +
£t
[
i
]->halfouts;

4245 
	`•rötf
(
¥efix
, "%°imeouà", 
sour˚°r
);

4246 
	`Ârötf
 (
ouçutfûe
, "%sReque°†swôchedÅÿtimeouàqueue: %d\n", 
sour˚°r
, 
swôches
);

4247 
	`Ârötf
(
ouçutfûe
, "%sTimed ouàªque°s: %d\n", 
sour˚°r
, 
timeouts
);

4248 
	`Ârötf
(
ouçutfûe
, "%sHÆfwayÅimed ouàªque°s: %d\n", 
sour˚°r
, 
hÆfouts
);

4249 
	`ioqueue_subqueue_¥öt°©s
(
sub£t
, 
£tsize
, 
¥efix
, 
¥öt¸ô°©s
);

4251 i‡(
¥i_scheme
 !
ALLEQUAL
) {

4252 
	`Ârötf
(
ouçutfûe
, "%sPri‹ôy queuê°©i°ics\n", 
sour˚°r
);

4253 
swôches
 = 0;

4254 
i
=0; i<
£tsize
; i++) {

4255 
sub£t
[
i
] = &
£t
[i]->
¥i‹ôy
;

4256 
swôches
 +
£t
[
i
]->
¥i‹ôy
.switches;

4258 
	`•rötf
(
¥efix
, "%•ri‹ôy ", 
sour˚°r
);

4259 
	`Ârötf
 (
ouçutfûe
, "%sReque°†swôchedÅÿ¥i‹ôy queue: %d\n", 
sour˚°r
, 
swôches
);

4260 
	`ioqueue_subqueue_¥öt°©s
(
sub£t
, 
£tsize
, 
¥efix
, 
¥öt¸ô°©s
);

4264 
	`‰ì
(
sub£t
);

4265 
	`‰ì
(
°©£t
);

4266 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_ioqueue.h

101 #i‚de‡
DISKSIM_IOQUEUE_H


102 
	#DISKSIM_IOQUEUE_H


	)

104 
	~"disksim_globÆ.h
"

105 
	~"disksim_iosim.h
"

106 
	~"disksim_°©.h
"

107 
	~"disksim_disk.h
"

108 
	~"c⁄fig.h
"

111 
	gioq
;

112 
ioqueue_£tˇŒbacks
 ();

113 
ioqueue_öôülize
 (
ioq
 *
queue
, 
devno
);

114 
ioqueue_ª£t°©s
 (
ioq
 *
queue
);

115 
ioqueue_¥öt°©s
 (
ioq
 **
£t
, 
£tsize
, *
sour˚°r
);

116 
ioqueue_˛ón°©s
 (
ioq
 *
queue
);

117 
ioq
 * 
ioqueue_¸óãdeÁu…queue
 ();

118 
ioq
 * 
ioqueue_ªad∑øms
 (
FILE
 *
∑rfûe
, 
¥ötqueue°©s
, 
¥öt¸ô°©s
, 
¥ötidÀ°©s
, 
¥ötöèº°©s
, 
¥ötsize°©s
);

119 
ioqueue_∑øm_ovîride
 (
ioq
 *
queue
, *
∑øm«me
, *
∑ømvÆ
);

120 
ioq
 * 
ioqueue_c›y
 (ioq *
queue
);

121 
ioqueue_tick
 (
ioq
 *
queue
);

122 
ioqueue_øi£_¥i‹ôy
 (
ioq
 *
queue
, 
›id
);

123 
ioqueue_add_√w_ªque°
 (
ioq
 *
queue
, 
i‹eq_evít
 *
√w
);

124 
i‹eq_evít
 * 
ioqueue_gë_√xt_ªque°
 (
ioq
 *
queue
);

125 
i‹eq_evít
 * 
ioqueue_show_√xt_ªque°
 (
ioq
 *
queue
);

126 
i‹eq_evít
 * 
ioqueue_£t_°¨âime
 (
ioq
 *
queue
, i‹eq_evíà*
èrgë
);

127 
i‹eq_evít
 * 
ioqueue_gë_•ecific_ªque°
 (
ioq
 *
queue
, i‹eq_evíà*
w™ãd
);

128 
i‹eq_evít
 * 
ioqueue_physiˇl_ac˚ss_d⁄e
 (
ioq
 *
queue
, i‹eq_evíà*
cuº
);

129 
ioqueue_gë_numbî_≥ndög
 (
ioq
 *
queue
);

130 
ioqueue_gë_numbî_ö_queue
 (
ioq
 *
queue
);

131 
ioqueue_gë_numbî_of_ªque°s
 (
ioq
 *
queue
);

132 
ioqueue_gë_numbî_of_ªque°s_öôüãd
 (
ioq
 *
queue
);

133 
ioqueue_gë_ªqout°™dög
 (
ioq
 *
queue
);

134 
ioqueue_gë_di°
 (
ioq
 *
queue
, 
blkno
);

135 
ioqueue_£t_c⁄ˇtok_fun˘i⁄
 (
ioq
 *
queue
, (**
c⁄ˇtok
)(*,,,,), *
c⁄ˇtok∑øm
);

136 
	`ioqueue_£t_idÀw‹k_fun˘i⁄
 (
ioq
 *
queue
, (**
idÀw‹k
)(*,), *
idÀw‹k∑øm
, 
idÀdñay
);

137 
	`ioqueue_£t_íabÀmít_fun˘i⁄
 (
ioq
 *
queue
, (**
íabÀmít
)(
i‹eq_evít
 *));

138 
	`ioqueue_ª£t_idÀdëe˘î
 (
ioq
 *
queue
, 
timech™ge
);

139 
	`ioqueue_¥öt_c⁄ã¡s
 (
ioq
 *
queue
);

144 
	#MINSCHED
 1

	)

145 
	#FCFS
 1

	)

146 
	#ELEVATOR_LBN
 2

	)

147 
	#CYCLE_LBN
 3

	)

148 
	#SSTF_LBN
 4

	)

149 
	#ELEVATOR_CYL
 5

	)

150 
	#CYCLE_CYL
 6

	)

151 
	#SSTF_CYL
 7

	)

152 
	#SPTF_OPT
 8

	)

153 
	#SPCTF_OPT
 9

	)

154 
	#SATF_OPT
 10

	)

155 
	#WPTF_OPT
 11

	)

156 
	#WPCTF_OPT
 12

	)

157 
	#WATF_OPT
 13

	)

158 
	#ASPTF_OPT
 14

	)

159 
	#ASPCTF_OPT
 15

	)

160 
	#ASATF_OPT
 16

	)

161 
	#VSCAN_LBN
 17

	)

162 
	#VSCAN_CYL
 18

	)

163 
	#PRI_VSCAN_LBN
 19

	)

164 
	#PRI_ASPTF_OPT
 20

	)

165 
	#PRI_ASPCTF_OPT
 21

	)

166 
	#SDF_APPROX
 22

	)

167 
	#SDF_EXACT
 23

	)

168 
	#SPTF_ROT_OPT
 24

	)

169 
	#SPTF_ROT_WEIGHT
 25

	)

170 
	#SPTF_SEEK_WEIGHT
 26

	)

171 
	#TSPS
 27

	)

172 
	#BATCH_FCFS
 28

	)

173 
	#MAXSCHED
 28

	)

176 
	siob
 {

177 
°¨âime
;

178 
°©e
;

179 
iob
 *
√xt
;

180 
iob
 *
¥ev
;

181 
tŸÆsize
;

182 
devno
;

183 
blkno
;

184 
Êags
;

185 
b©chno
;

186 
b©ch_size
;

187 
b©ch_com∂ëe
;

190 
waôtime
;

191 
i‹eq_evít
 *
c⁄ˇt
;

192 } 
≥nd
;

193 
time
;

194 } 
iob_un
;

195 
i‹eq_evít
 *
iﬁi°
;

196 
i‹eq_evít
 *
b©ch_li°
;

197 
ªq˙t
;

198 
cylödî
;

199 
surÁ˚
;

200 
›id
;

201 } 
	tiobuf
;

203 
ioq
;

205 
	ssubq
 {

206 
ioq
 * 
bigqueue
;

207 
sched_Æg
;

208 
surfovîf‹w
;

209 
f‹˚_absﬁuã_fcfs
;

210 (**
íabÀmít
)(
i‹eq_evít
 *);

211 
iobuf
 * 
li°
;

212 
iobuf
 * 
cuºít
;

213 
¥i‹
;

214 
dú
;

215 
vsˇn_vÆue
;

216 
vsˇn_cyls
;

217 
u_öt
 
œ°blkno
;

218 
œ°surÁ˚
;

219 
œ°cy o
;

220 
›tcy o
;

221 
›tsurÁ˚
;

222 
s°fupdown
;

223 
s°fupdown˙t
;

224 
numªads
;

225 
numwrôes
;

226 
swôches
;

227 
maxqÀn
;

228 
œ°Æt
;

229 
li°Àn
;

230 
iobuf˙t
;

231 
maxli°Àn
;

232 
ru∆i°Àn
;

233 
ªadÀn
;

234 
maxªadÀn
;

235 
ruƒódÀn
;

236 
maxwrôñí
;

237 
numcom∂ëe
;

238 
ªqout°™dög
;

239 
numout°™dög
;

240 
maxout°™dög
;

241 
runout°™dög
;

242 
num_•tf_sdf_dif„ª¡
;

243 
num_schedulög_decisi⁄s
;

244 
°©gí
 
ouâime°©s
;

245 
°©gí
 
¸ôªad°©s
;

246 
°©gí
 
¸ôwrôe°©s
;

247 
°©gí
 
no¸ôªad°©s
;

248 
°©gí
 
no¸ôwrôe°©s
;

249 
°©gí
 
qtime°©s
;

250 
°©gí
 
acc°©s
;

251 
°©gí
 
ö°queuñí
;

252 
°©gí
 
öf›íÆty
;

253 } 
	tsubqueue
;

255 
	sioq
 {

256 
subqueue
 
ba£
;

257 
subqueue
 
timeout
;

258 
subqueue
 
¥i‹ôy
;

259 
devno
;

260 (**
idÀw‹k
)(*,);

261 * 
idÀw‹k∑øm
;

262 
idÀdñay
;

263 
timî_evít
 *
idÀdëe˘
;

264 (**
cﬂÀs˚ok
)(*,,,,);

265 * 
cﬂÀs˚ok∑øm
;

266 (**
c⁄ˇtok
)(*,,,,);

267 * 
c⁄ˇtok∑øm
;

268 
c⁄ˇtmax
;

269 
combovîœps
;

270 
£qscheme
;

271 
£q°ªamdiff
;

272 
to_scheme
;

273 
to_time
;

274 
¥i_scheme
;

275 
¥i‹ôy_mix
;

276 
cylm≠ty≥
;

277 
wrôedñay
;

278 
ªaddñay
;

279 
£˘≥rcyl
;

280 
œ°subqueue
;

281 
timeouts
;

282 
timeouåóds
;

283 
hÆfouts
;

284 
hÆfouåóds
;

285 
idÀ°¨t
;

286 
œ°¨r
;

287 
œ°ªad
;

288 
œ°wrôe
;

289 
œãncy_weight
;

290 
°©gí
 
idÀ°©s
;

291 
°©gí
 
öèº°©s
;

292 
°©gí
 
ªadöèº°©s
;

293 
°©gí
 
wrôeöèº°©s
;

294 
°©gí
 
ªqsize°©s
;

295 
°©gí
 
ªadsize°©s
;

296 
°©gí
 
wrôesize°©s
;

297 
°©gí
 
b©chsize°©s
;

298 
numb©ches
;

299 
maxli°Àn
;

300 
maxqÀn
;

301 
maxout°™dög
;

302 
maxªadÀn
;

303 
maxwrôñí
;

304 
ovîœpscombed
;

305 
ªadovîœpscombed
;

306 
£qblkno
;

307 
£qÊags
;

308 
£qªads
;

309 
£qwrôes
;

310 
¥ötqueue°©s
;

311 
¥öt¸ô°©s
;

312 
¥ötidÀ°©s
;

313 
¥ötöèº°©s
;

314 
¥ötsize°©s
;

315 *
«me
;

316 } 
	tioqueue
;

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_iosim.c

102 
	~"disksim_iosim.h
"

104 
	~"moduÀs/moduÀs.h
"

110 
	$iosim_öôülize_iosim_öfo
 ()

112 
disksim
->
iosim_öfo
 = 
	`DISKSIM_mÆloc
 ((
iosim_öfo_t
));

113 
	`bzîo
 ((*)
disksim
->
iosim_öfo
, (
iosim_öfo_t
));

116 
iosˇÀ
 = 1.0;

117 
œ°_ªque°_¨rive
 = 0.0;

121 
c⁄°öèºtime
 = 0.0;

122 
	}
}

125 
i‹eq_evít
 * 
	$i‹eq_c›y
 (
i‹eq_evít
 *
ﬁd
)

127 
i‹eq_evít
 *
√w
 = (i‹eq_evíà*Ë
	`gë‰omexåaq
();

128 
	`memmove
 ((*)
√w
, (*)
ﬁd
, (
i‹eq_evít
));

130 (
√w
);

131 
	}
}

134 
	$i‹eq_com∑ª
 (
i‹eq_evít
 *
fú°
, i‹eq_evíà*
£c⁄d
)

136 
diff
 = 0;

137 
diff
 |
fú°
->
time
 !
£c⁄d
->time;

138 
diff
 |
fú°
->
ty≥
 !
£c⁄d
->type;

141 
diff
 |
fú°
->
bcou¡
 !
£c⁄d
->bcount;

142 
diff
 |
fú°
->
blkno
 !
£c⁄d
->blkno;

143 
diff
 |
fú°
->
Êags
 !
£c⁄d
->flags;

144 
diff
 |
fú°
->
bu¢o
 !
£c⁄d
->busno;

145 
diff
 |
fú°
->
¶Ÿno
 !
£c⁄d
->slotno;

146 
diff
 |
fú°
->
devno
 !
£c⁄d
->devno;

147 
diff
 |
fú°
->
›id
 !
£c⁄d
->opid;

148 
diff
 |
fú°
->
buf
 !
£c⁄d
->buf;

149 
diff
 |
fú°
->
ˇu£
 !
£c⁄d
->cause;

150 
diff
 |
fú°
->
ãmpöt1
 !
£c⁄d
->tempint1;

151 
diff
 |
fú°
->
ãmpöt2
 !
£c⁄d
->tempint2;

152 
diff
 |
fú°
->
ãmµå1
 !
£c⁄d
->tempptr1;

153 
diff
 |
fú°
->
ãmµå2
 !
£c⁄d
->tempptr2;

154 (
diff
);

155 
	}
}

158 
	$io_ˇtch_°øy_evíts
 (
i‹eq_evít
 *
cuº
)

160 
cuº
->
ty≥
) {

161 
DEVICE_DATA_TRANSFER_COMPLETE
:

162 
cuº
->
time
 = 
	`devi˚_gë_blkå™°ime
(curr);

163 
cuº
->
time
 = 
simtime
 + (cuº->timê* (Ëcuº->
bcou¡
);

164 
	`addtoötq
((
evít
 *Ë
cuº
);

168 
	`Ârötf
(
°dîr
, "UnknownÉventÅypeát io_catch_stray_events\n");

169 
	`exô
(1);

171 
	}
}

176 
evít
 * 
	$io_ªque°
 (
i‹eq_evít
 *
cuº
)

178 
cuº
->
ty≥
 = 
IO_REQUEST_ARRIVE
;

179 
	`f˛_ªque°_¨rive
 (
cuº
);

181  
NULL
;

182 
	}
}

184 
evít
 * 
	$io_ªque°
 (
i‹eq_evít
 *
cuº
)

186 
cuº
->
ty≥
 = 
IO_REQUEST_ARRIVE
;

187  (
	`iodrivî_ªque°
(0, 
cuº
));

188 
	}
}

191 
	$io_scheduÀ
 (
i‹eq_evít
 *
cuº
)

193 
cuº
->
ty≥
 = 
IO_ACCESS_ARRIVE
;

194 
	`iodrivî_scheduÀ
(0, 
cuº
);

195 
	}
}

198 
	$io_tick
()

200  (
	`iodrivî_tick
());

201 
	}
}

204 
	$io_øi£_¥i‹ôy
 (
›id
, 
devno
, 
blkno
, *
ch™
)

206  (
	`iodrivî_øi£_¥i‹ôy
(0, 
›id
, 
devno
, 
blkno
, 
ch™
));

207 
	}
}

210 
	$io_öãºu±_¨rive
 (
i‹eq_evít
 *
öåp
)

212 
öåp
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

213 
	`iodrivî_öãºu±_¨rive
 (0, (
öå_evít
 *)
öåp
);

214 
	}
}

217 
	$io_öãºu±_com∂ëe
 (
i‹eq_evít
 *
öåp
)

219 
öåp
->
ty≥
 = 
IO_INTERRUPT_COMPLETE
;

220 
	`iodrivî_öãºu±_com∂ëe
 (0, (
öå_evít
 *)
öåp
);

221 
	}
}

224 
	$io_öã∫Æ_evít
(
i‹eq_evít
 *
cuº
)

226 
	`ASSERT
(
cuº
 !
NULL
);

232 
cuº
->
ty≥
) {

235 
IO_REQUEST_ARRIVE
:

236 
	`f˛_ªque°_¨rive
 (
cuº
);

239 
IO_REQUEST_ARRIVE2
:

240 
	`iodrivî_ªque°
(0, 
cuº
);

243 
IO_ACCESS_ARRIVE
:

245 
	`iodrivî_scheduÀ
(0, 
cuº
);

248 
IO_INTERRUPT_ARRIVE
:

249 
	`iodrivî_öãºu±_¨rive
(0, (
öå_evít
 *Ë
cuº
);

252 
IO_RESPOND_TO_DEVICE
:

253 
	`iodrivî_ª•⁄d_to_devi˚
(0, (
öå_evít
 *Ë
cuº
->
ãmµå1
);

254 
	`addt€xåaq
((
evít
 *Ë
cuº
);

257 
IO_ACCESS_COMPLETE
:

261 
	`iodrivî_ac˚ss_com∂ëe
(0, (
öå_evít
 *Ë
cuº
->
ãmµå1
);

262 
	`addt€xåaq
((
evít
 *Ë
cuº
);

266 
IO_ACCESS_COMPLETE2
:

271 
	`f˛_ªque°_com∂ëe
 (
cuº
);

275 
IO_INTERRUPT_COMPLETE
:

276 
	`iodrivî_öãºu±_com∂ëe
(0, (
öå_evít
 *Ë
cuº
);

279 
DEVICE_OVERHEAD_COMPLETE
:

280 
DEVICE_ACCESS_COMPLETE
:

281 
DEVICE_DATA_TRANSFER_COMPLETE
:

282 
DEVICE_PREPARE_FOR_DATA_TRANSFER
:

283 
DEVICE_BUFFER_SEEKDONE
:

284 
DEVICE_BUFFER_TRACKACC_DONE
:

285 
DEVICE_BUFFER_SECTOR_DONE
:

286 
DEVICE_GOT_REMAPPED_SECTOR
:

287 
DEVICE_GOTO_REMAPPED_SECTOR
:

288 
MEMS_SLED_SCHEDULE
:

289 
MEMS_SLED_SEEK
:

290 
MEMS_SLED_SERVO
:

291 
MEMS_SLED_DATA
:

292 
MEMS_SLED_UPDATE
:

293 
MEMS_BUS_INITIATE
:

294 
MEMS_BUS_TRANSFER
:

295 
MEMS_BUS_UPDATE
:

296 
SSD_CLEAN_ELEMENT
:

297 
SSD_CLEAN_GANG
:

298 
	`devi˚_evít_¨rive
(
cuº
);

301 
BUS_OWNERSHIP_GRANTED
:

302 
BUS_DELAY_COMPLETE
:

303 
	`bus_evít_¨rive
(
cuº
);

306 
CONTROLLER_DATA_TRANSFER_COMPLETE
:

307 
	`c⁄åﬁÀr_evít_¨rive
(
cuº
->
ãmpöt2
, curr);

310 
TIMESTAMP_LOGORG
:

311 
	`log‹g_time°amp
(
cuº
);

314 
IO_TRACE_REQUEST_START
:

315 
	`iodrivî_åa˚_ªque°_°¨t
(0, 
cuº
);

319 
	`Ârötf
(
°dîr
, "UnknownÉventÅypeÖassedÅo io_internal_events\n");

320 
	`exô
(1);

325 
	}
}

328 
	$iosim_gë_∑th_to_c⁄åﬁÀr
 (
iodrivîno
, 
˘ o
, 
ötch¨
 *
bu•©h
, i¡ch¨ *
¶Ÿ∑th
)

330 
dïth
;

331 
cuºbus
;

332 
ö¶Ÿno
;

333 
out¶Ÿno
;

334 
ma°î
;

336 
dïth
 = 
	`c⁄åﬁÀr_gë_dïth
(
˘ o
);

337 
cuºbus
 = 
	`c⁄åﬁÀr_gë_öbus
(
˘ o
);

338 
ö¶Ÿno
 = (Ë
	`c⁄åﬁÀr_gë_¶Ÿno
(
˘ o
);

339 
ma°î
 = 
	`c⁄åﬁÀr_gë_bus_ma°î
(
cuºbus
);

340 
dïth
 > 0) {

344 
out¶Ÿno
 = (Ë
	`c⁄åﬁÀr_gë_out¶Ÿ
(
ma°î
, 
cuºbus
);

345 
bu•©h
->
byã
[
dïth
] = (Ë
cuºbus
;

346 
¶Ÿ∑th
->
byã
[
dïth
] = (
ö¶Ÿno
 & 0x0FË| (
out¶Ÿno
 << 4);

347 
dïth
--;

348 
dïth
--;

349 
cuºbus
 = 
	`c⁄åﬁÀr_gë_öbus
(
ma°î
);

350 
ö¶Ÿno
 = (Ë
	`c⁄åﬁÀr_gë_¶Ÿno
(
ma°î
);

351 
ma°î
 = 
	`c⁄åﬁÀr_gë_bus_ma°î
(
cuºbus
);

353 
	`ASSERT1
((
ma°î
 !-1Ë|| (
dïth
 <0), "cuºbus", 
cuºbus
);

355 
out¶Ÿno
 = (Ë
iodrivîno
;

356 
bu•©h
->
byã
[
dïth
] = 
cuºbus
;

357 
¶Ÿ∑th
->
byã
[
dïth
] = (
ö¶Ÿno
 & 0x0FË| (
out¶Ÿno
 << 4);

358 
	}
}

361 
	$iosim_gë_∑th_to_devi˚
 (
iodrivîno
, 
devno
, 
ötch¨
 *
bu•©h
, i¡ch¨ *
¶Ÿ∑th
)

363 
dïth
;

364 
cuºbus
;

365 
ö¶Ÿno
;

366 
out¶Ÿno
;

367 
ma°î
;

369 
dïth
 = 
	`devi˚_gë_dïth
(
devno
);

370 
cuºbus
 = 
	`devi˚_gë_öbus
(
devno
);

371 
ö¶Ÿno
 = (Ë
	`devi˚_gë_¶Ÿno
(
devno
);

372 
ma°î
 = 
	`c⁄åﬁÀr_gë_bus_ma°î
(
cuºbus
);

373 
dïth
 > 0) {

377 
out¶Ÿno
 = (Ë
	`c⁄åﬁÀr_gë_out¶Ÿ
(
ma°î
, 
cuºbus
);

378 
bu•©h
->
byã
[
dïth
] = (Ë
cuºbus
;

379 
¶Ÿ∑th
->
byã
[
dïth
] = (
ö¶Ÿno
 & 0x0FË| (
out¶Ÿno
 << 4);

380 
dïth
--;

381 
cuºbus
 = 
	`c⁄åﬁÀr_gë_öbus
(
ma°î
);

382 
ö¶Ÿno
 = (Ë
	`c⁄åﬁÀr_gë_¶Ÿno
(
ma°î
);

383 
ma°î
 = 
	`c⁄åﬁÀr_gë_bus_ma°î
(
cuºbus
);

385 
	`ASSERT1
((
ma°î
 !-1Ë|| (
dïth
 <0), "cuºbus", 
cuºbus
);

387 
out¶Ÿno
 = (Ë
iodrivîno
;

388 
bu•©h
->
byã
[
dïth
] = 
cuºbus
;

389 
¶Ÿ∑th
->
byã
[
dïth
] = (
ö¶Ÿno
 & 0x0FË| (
out¶Ÿno
 << 4);

390 
	}
}

395 
	$iosim_lﬂd_m≠
(
Õ_block
 *
b
, 
n
) {

396 
c
;

397 
i
 = 0;

398 *
s
 = 0;

402 
	`Õ_lﬂd∑øms
((*)
n
, 
b
, &
disksim_iom≠_mod
);

404 i‡(
åa˚m≠2
[
n
] == 512) {

405 
åa˚m≠2
[
n
] = 0;

407 i‡(
åa˚m≠2
[
n
] > 512) {

408 
åa˚m≠2
[
n
] = -(tracemap2[n] / 512);

411 
åa˚m≠2
[
n
] = 512 /Åracemap2[n];

416 
	}
}

418 
	$iosim_lﬂd_m≠pögs
(
Õ_li°
 *
l
) {

419 
c
;

420 
m≠no
 = 0;

422 if(
l
->
vÆues_Àn
 > 
TRACEMAPPINGS
) {

423 
	`Ârötf
(
°dîr
, "***Érror:Åoo many io mappings.\n");

427 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

428 if(!
l
->
vÆues
[
c
]) ;

430 if(
l
->
vÆues
[
c
]->
t
 =
BLOCK
) {

431 
	`as£π
(
	`iosim_lﬂd_m≠
(
l
->
vÆues
[
c
]->
v
.
b
, 
m≠no
));

432 
åa˚m≠pögs
++;

435 
m≠no
++;

439 
	}
}

441 
	$disksim_iom≠_lﬂd∑øms
(
Õ_block
 *
b
) {

442 
	`ddbg_as£π2
(0, "this isá dummyánd isn't supposedÅo be called");

444 
	}
}

447 
	$disksim_iosim_lﬂd∑øms
(
Õ_block
 *
b
) {

449 if(!
disksim
->
iosim_öfo
)

450 
	`iosim_öôülize_iosim_öfo
();

453 
	`Õ_lﬂd∑øms
(0, 
b
, &
disksim_iosim_mod
);

457 
	}
}

464 
	$io_ªad∑øms
 (
FILE
 *
∑rfûe
)

466 
	`ddbg_as£π
(0);

513 
	}
}

516 
	$io_vÆid©e_do_°©s1
 ()

518 
i
;

520 i‡(
åa˚°©s2
 =
NULL
) {

521 
åa˚°©s2
 = (
°©gí
 *)
	`DISKSIM_mÆloc
((statgen));

522 
åa˚°©s3
 = (
°©gí
 *)
	`DISKSIM_mÆloc
((statgen));

523 
åa˚°©s4
 = (
°©gí
 *)
	`DISKSIM_mÆloc
((statgen));

524 
åa˚°©s5
 = (
°©gí
 *)
	`DISKSIM_mÆloc
((statgen));

526 
	`°©_öôülize
(
°©deffûe
, 
°©desc_åa˚acc°©s
, 
åa˚°©s2
);

527 
	`°©_öôülize
(
°©deffûe
, 
°©desc_åa˚accdiff°©s
, 
åa˚°©s3
);

528 
	`°©_öôülize
(
°©deffûe
, 
°©desc_åa˚accwrôe°©s
, 
åa˚°©s4
);

529 
	`°©_öôülize
(
°©deffûe
, 
°©desc_åa˚accdiffwrôe°©s
, 
åa˚°©s5
);

530 
i
=0; i<10; i++) {

531 
vÆid©ebuf
[
i
] = 0;

534 
	`°©_upd©e
(
åa˚°©s3
, (
vÆid©e_œ°£rv
 - 
disksim
->
œ°phy°ime
));

535 i‡(!
vÆid©e_œ°ªad
) {

536 
	`°©_upd©e
(
åa˚°©s5
, (
vÆid©e_œ°£rv
 - 
disksim
->
œ°phy°ime
));

539 
	}
}

542 
	$io_vÆid©e_do_°©s2
 (
i‹eq_evít
 *
√w
)

544 
	`°©_upd©e
(
åa˚°©s2
, 
vÆid©e_œ°£rv
);

545 i‡(
√w
->
Êags
 =
WRITE
) {

546 
	`°©_upd©e
(
åa˚°©s4
, 
vÆid©e_œ°£rv
);

548 i‡(
	`°rcmp
(
vÆid©e_bufÁ˘i⁄
, "Doub") == 0) {

549 
vÆid©ebuf
[0]++;

550 } i‡(
	`°rcmp
(
vÆid©e_bufÁ˘i⁄
, "Trip") == 0) {

551 
vÆid©ebuf
[1]++;

552 } i‡(
	`°rcmp
(
vÆid©e_bufÁ˘i⁄
, "Miss") == 0) {

553 
vÆid©ebuf
[2]++;

554 } i‡(
	`°rcmp
(
vÆid©e_bufÁ˘i⁄
, "Hit") == 0) {

555 
vÆid©ebuf
[3]++;

557 
	`Ârötf
(
°dîr
, "Uƒecognized bufÁ˘i⁄ i¿vÆid©êåa˚: %s\n", 
vÆid©e_bufÁ˘i⁄
);

558 
	`exô
(1);

560 
	}
}

563 
	$io_h∂_do_°©s1
 ()

565 
i
;

567 i‡(
åa˚°©s
 =
NULL
) {

568 
åa˚°©s
 = (
°©gí
 *)
	`DISKSIM_mÆloc
(
åa˚m≠pögs
 * (statgen));

569 
åa˚°©s1
 = (
°©gí
 *)
	`DISKSIM_mÆloc
(
åa˚m≠pögs
 * (statgen));

570 
åa˚°©s2
 = (
°©gí
 *)
	`DISKSIM_mÆloc
(
åa˚m≠pögs
 * (statgen));

571 
åa˚°©s3
 = (
°©gí
 *)
	`DISKSIM_mÆloc
(
åa˚m≠pögs
 * (statgen));

572 
åa˚°©s4
 = (
°©gí
 *)
	`DISKSIM_mÆloc
(
åa˚m≠pögs
 * (statgen));

574 
i
=0; i<
åa˚m≠pögs
; i++) {

575 
	`°©_öôülize
(
°©deffûe
, 
°©desc_åa˚queue°©s
, &
åa˚°©s
[
i
]);

576 
	`°©_öôülize
(
°©deffûe
, 
°©desc_åa˚ª•°©s
, &
åa˚°©s1
[
i
]);

577 
	`°©_öôülize
(
°©deffûe
, 
°©desc_åa˚acc°©s
, &
åa˚°©s2
[
i
]);

578 
	`°©_öôülize
(
°©deffûe
, 
°©desc_åa˚qÀn°©s
, &
åa˚°©s3
[
i
]);

579 
	`°©_öôülize
(
°©deffûe
, 
°©desc_åa˚noq°©s
, &
åa˚°©s4
[
i
]);

582 
	}
}

585 
	$io_m≠_åa˚_ªque°
 (
i‹eq_evít
 *
ãmp
)

587 
i
;

589 
i
=0; i<
åa˚m≠pögs
; i++) {

590 i‡(
ãmp
->
devno
 =
åa˚m≠
[
i
]) {

591 
ãmp
->
devno
 = 
åa˚m≠1
[
i
];

592 i‡(
åa˚m≠2
[
i
]) {

593 i‡(
åa˚m≠2
[
i
] < 1) {

594 
ãmp
->
blkno
 *-
åa˚m≠2
[
i
];

596 i‡(
ãmp
->
blkno
 % 
åa˚m≠2
[
i
]) {

597 
	`Ârötf
(
°dîr
, "SmÆ»£˘‹ sizêdisk usög odd se˘‹Çumbî: %d\n", 
ãmp
->
blkno
);

598 
	`exô
(1);

603 
ãmp
->
blkno
 /
åa˚m≠2
[
i
];

606 
ãmp
->
bcou¡
 *
åa˚m≠3
[
i
];

607 
ãmp
->
blkno
 +
åa˚m≠4
[
i
];

608 i‡(
åa˚°©s
) {

609 
	`°©_upd©e
(&
åa˚°©s
[
i
], ((Ë
ãmp
->
ãmpöt1
 / () 1000));

610 
	`°©_upd©e
(&
åa˚°©s1
[
i
],((Ë(
ãmp
->
ãmpöt1
 +Åemp->
ãmpöt2
) / () 1000));

611 
	`°©_upd©e
(&
åa˚°©s2
[
i
],((Ë
ãmp
->
ãmpöt2
 / () 1000));

612 
	`°©_upd©e
(&
åa˚°©s3
[
i
], (Ë
ãmp
->
¶Ÿno
);

613 i‡(
ãmp
->
¶Ÿno
 == 1) {

614 
	`°©_upd©e
(&
åa˚°©s4
[
i
], ((Ë
ãmp
->
ãmpöt1
 / () 1000));

624 
	}
}

627 
evít
 * 
	$io_gë_√xt_exã∫Æ_evít
 (
FILE
 *
iŸø˚fûe
)

629 
i‹eq_evít
 *
ãmp
;

631 
	`ASSERT
(
io_extq
 =
NULL
);

635 
ãmp
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

637 
disksim
->
åa˚f‹m©
) {

638 
VALIDATE
: 
	`io_vÆid©e_do_°©s1
();

640 
HPL
: 
	`io_h∂_do_°©s1
();

644 
ãmp
 = 
	`iŸø˚_gë_i‹eq_evít
(
iŸø˚fûe
, 
disksim
->
åa˚f‹m©
,Åemp);

645 i‡(
ãmp
) {

646 
disksim
->
åa˚f‹m©
) {

647 
VALIDATE
: 
	`io_vÆid©e_do_°©s2
 (
ãmp
);

650 
ãmp
->
ty≥
 = 
IO_REQUEST_ARRIVE
;

652 i‡(
c⁄°öèºtime
 > 0.0) {

653 
ãmp
->
time
 = 
œ°_ªque°_¨rive
 + 
c⁄°öèºtime
;

654 
œ°_ªque°_¨rive
 = 
ãmp
->
time
;

656 
ãmp
->
time
 = (ãmp->timê* 
iosˇÀ
Ë+ 
åa˚ba£time
;

657 i‡((
ãmp
->
time
 < 
simtime
Ë&& (!
disksim
->
˛o£dios
)) {

658 
	`Ârötf
(
°dîr
, "Tø˚Évíà≠≥¨†ouào‡timê‹dî i¿åa˚ - simtimê%f,Åimê%f\n", 
simtime
, 
ãmp
->
time
);

659 
	`Ârötf
(
°dîr
, "iosˇÀ %f,Åø˚ba£timê%f\n", 
iosˇÀ
, 
åa˚ba£time
);

660 
	`Ârötf
(
°dîr
, "devnÿ%d, blknÿ%d, bcou¡ %d, fœg†%d\n", 
ãmp
->
devno
,Åemp->
blkno
,Åemp->
bcou¡
,Åemp->
Êags
);

661 
	`exô
(1);

663 i‡(
åa˚m≠pögs
) {

664 
	`io_m≠_åa˚_ªque°
(
ãmp
);

666 
io_extq
 = (
evít
 *)
ãmp
;

667 
io_extq_ty≥
 = 
ãmp
->
ty≥
;

672  ((
evít
 *)
ãmp
);

673 
	}
}

676 
	$io_usög_exã∫Æ_evít
 (
evít
 *
cuº
)

678 i‡(
io_extq
 =
cuº
) {

679 
cuº
->
ty≥
 = 
io_extq_ty≥
;

680 
io_extq
 = 
NULL
;

684 
	}
}

687 
	$io_¥öt°©s
()

689 
i
;

690 
˙t
 = 0;

691 
¥efix
[80];

693 
	`Ârötf
 (
ouçutfûe
, "\nSTORAGE SUBSYSTEM STATISTICS\n");

694 
	`Ârötf
 (
ouçutfûe
, "----------------------------\n");

696 
	`iŸø˚_¥öt°©s
 (
ouçutfûe
);

698 i‡((
åa˚°©s
Ë&& (
PRINTTRACESTATS
)) {

700 
i
=0; i<
åa˚m≠pögs
; i++) {

701 
	`•rötf
(
¥efix
, "M≠≥d disk #%d ", 
i
);

702 
	`°©_¥öt
(&
åa˚°©s
[
i
], 
¥efix
);

703 
	`°©_¥öt
(&
åa˚°©s1
[
i
], 
¥efix
);

704 
	`°©_¥öt
(&
åa˚°©s2
[
i
], 
¥efix
);

705 
	`°©_¥öt
(&
åa˚°©s3
[
i
], 
¥efix
);

706 
	`°©_¥öt
(&
åa˚°©s4
[
i
], 
¥efix
);

708 } i‡((
åa˚°©s2
Ë&& (
PRINTTRACESTATS
)) {

710 
	`Ârötf
 (
ouçutfûe
, "\n");

711 
	`°©_¥öt
(
åa˚°©s2
, "VALIDATE ");

712 
	`°©_¥öt
(
åa˚°©s3
, "VALIDATE ");

713 
	`°©_¥öt
(
åa˚°©s5
, "VALIDATE ");

714 
i
=0; i<10; i++) {

715 
˙t
 +
vÆid©ebuf
[
i
];

717 
	`Ârötf
 (
ouçutfûe
, "VALIDATE doubÀ disc⁄√˘s: %5d \t%f\n", 
vÆid©ebuf
[0], ((ËvÆid©ebuf[0] / (Ë
˙t
));

718 
	`Ârötf
 (
ouçutfûe
, "VALIDATEÅrùÀ disc⁄√˘s: %5d \t%f\n", 
vÆid©ebuf
[1], ((ËvÆid©ebuf[1] / (Ë
˙t
));

719 
	`Ârötf
 (
ouçutfûe
, "VALIDATEÑód buf„∏hôs: %5d \t%f\n", 
vÆid©ebuf
[3], ((ËvÆid©ebuf[3] / (Ë
˙t
));

720 
	`Ârötf
 (
ouçutfûe
, "VALIDATE buf„∏mis£s: %5d \t%f\n", 
vÆid©ebuf
[2], ((ËvÆid©ebuf[2] / (Ë
˙t
));

723 
	`iodrivî_¥öt°©s
();

724 
	`devi˚_¥öt°©s
();

725 
	`c⁄åﬁÀr_¥öt°©s
();

726 
	`bus_¥öt°©s
();

727 
	}
}

732 
	$io_£tˇŒbacks
 ()

734 
	`devi˚_£tˇŒbacks
 ();

735 
	`bus_£tˇŒbacks
 ();

736 
	`c⁄åﬁÀr_£tˇŒbacks
 ();

737 
	`iodrivî_£tˇŒbacks
 ();

738 
	}
}

741 
	$io_öôülize
 (
°™dÆ⁄e
)

743 i‡(
disksim
->
iosim_öfo
 =
NULL
) {

744 
	`iosim_öôülize_iosim_öfo
 ();

747 
	`bus_£t_dïths
();

750 
	`SèticAs£π
 ((
i‹eq_evít
Ë<
DISKSIM_EVENT_SIZE
);

751 
	`devi˚_öôülize
();

752 
	`bus_öôülize
();

753 
	`c⁄åﬁÀr_öôülize
();

754 
	`iodrivî_öôülize
(
°™dÆ⁄e
);

755 
	}
}

758 
	$io_ª£t°©s
()

760 
	`iodrivî_ª£t°©s
();

761 
	`devi˚_ª£t°©s
();

762 
	`bus_ª£t°©s
();

763 
	`c⁄åﬁÀr_ª£t°©s
();

764 
	}
}

767 
	$io_˛ón°©s
()

769 
	`iodrivî_˛ón°©s
();

770 
	`devi˚_˛ón°©s
();

771 
	`bus_˛ón°©s
();

772 
	`c⁄åﬁÀr_˛ón°©s
();

773 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_iosim.h

101 #i‚de‡
DISKSIM_IOSIM_H


102 
	#DISKSIM_IOSIM_H


	)

105 
	~"disksim_ioÁ˚.h
"

110 
	#MAXDEVICES
 100

	)

111 
	#MAXDEPTH
 4

	)

112 
	#MAXINBUSES
 1

	)

113 
	#MAXOUTBUSES
 4

	)

114 
	#MAXSLOTS
 15

	)

115 
	#MAXLOGORGS
 100

	)

118 
	~"disksim_devi˚.h
"

124 
	#IO_ACCESS_ARRIVE
 101

	)

125 
	#IO_INTERRUPT_ARRIVE
 102

	)

126 
	#IO_RESPOND_TO_DEVICE
 103

	)

127 
	#IO_ACCESS_COMPLETE
 104

	)

128 
	#IO_INTERRUPT_COMPLETE
 105

	)

129 
	#DEVICE_OVERHEAD_COMPLETE
 106

	)

130 
	#DEVICE_ACCESS_COMPLETE
 107

	)

131 
	#DEVICE_PREPARE_FOR_DATA_TRANSFER
 108

	)

132 
	#DEVICE_DATA_TRANSFER_COMPLETE
 109

	)

133 
	#DEVICE_BUFFER_SEEKDONE
 110

	)

134 
	#DEVICE_BUFFER_TRACKACC_DONE
 111

	)

135 
	#DEVICE_BUFFER_SECTOR_DONE
 112

	)

136 
	#DEVICE_GOT_REMAPPED_SECTOR
 113

	)

137 
	#DEVICE_GOTO_REMAPPED_SECTOR
 114

	)

138 
	#BUS_OWNERSHIP_GRANTED
 115

	)

139 
	#BUS_DELAY_COMPLETE
 116

	)

140 
	#CONTROLLER_DATA_TRANSFER_COMPLETE
 117

	)

141 
	#TIMESTAMP_LOGORG
 118

	)

142 
	#IO_TRACE_REQUEST_START
 119

	)

143 
	#IO_QLEN_MAXCHECK
 120

	)

146 
	#IO_REQUEST_ARRIVE2
 121

	)

147 
	#IO_ACCESS_COMPLETE2
 122

	)

153 
	#MEMS_SLED_SCHEDULE
 201

	)

154 
	#MEMS_SLED_SEEK
 202

	)

155 
	#MEMS_SLED_SERVO
 203

	)

156 
	#MEMS_SLED_DATA
 204

	)

157 
	#MEMS_SLED_UPDATE
 205

	)

158 
	#MEMS_BUS_INITIATE
 206

	)

159 
	#MEMS_BUS_TRANSFER
 207

	)

160 
	#MEMS_BUS_UPDATE
 208

	)

164 
	#SSD_CLEAN_ELEMENT
 301

	)

165 
	#SSD_CLEAN_GANG
 302

	)

170 
	mCOMPLETION
 = -1,

171 
	mRECONNECT
 = -2,

172 
	mDISCONNECT
 = -3,

173 
	mREADY_TO_TRANSFER
 = -4

174 } 
	tdisksim_öt_t
;

176 #i‚de‡
IOFACE_H


180 
	#IODRIVER
 2

	)

181 
	#DEVICE
 4

	)

182 
	#CONTROLLER
 5

	)

188 
	#DISKACCESS
 1

	)

189 
	#DISKACCTIME
 2

	)

190 
	#DISKPOS
 3

	)

191 
	#DISKPOSTIME
 4

	)

192 
	#DISKSEEK
 5

	)

193 
	#DISKSEEKTIME
 6

	)

194 
	#DISKSERVTIME
 7

	)

216 
	m˘ o
;

217 
	mÊags
;

218 
ötch¨
 
	m¶Ÿ∑th
;

219 
ötch¨
 
	mbu•©h
;

220 
	mmaxout°™dög
;

221 
	mnumout°™dög
;

222 
	mmaxªqsize
;

223 
i‹eq_evít
 *
	m≥ndio
;

224 
i‹eq_evít
 *
	movîsized
;

225 } 
	t˘Ã
;

229 
	mœ°evít
;

230 
	mÊag
;

231 
	mdevno
;

232 
	mbusy
;

233 
ötch¨
 
	m¶Ÿ∑th
;

234 
ötch¨
 
	mbu•©h
;

235 
	mmaxout°™dög
;

236 
	mqueue˘Ã
;

237 
˘Ã
 *
	m˘l
;

238 
ioq
 *
	mqueue
;

239 } 
	tdevi˚
;

244 
io_vÆid©e_do_°©s1
 ();

245 
io_vÆid©e_do_°©s2
 (
i‹eq_evít
 *
√w
);

246 
i‹eq_evít
 * 
i‹eq_c›y
 (i‹eq_evíà*
ﬁd
);

247 
i‹eq_com∑ª
 (
i‹eq_evít
 *
fú°
, i‹eq_evíà*
£c⁄d
);

248 
iosim_gë_∑th_to_c⁄åﬁÀr
 (
iodrivîno
, 
˘ o
, 
ötch¨
 *
bu•©h
, i¡ch¨ *
¶Ÿ∑th
);

249 
iosim_gë_∑th_to_devi˚
 (
iodrivîno
, 
devno
, 
ötch¨
 *
bu•©h
, i¡ch¨ *
¶Ÿ∑th
);

253 
	~"disksim_globÆ.h
"

254 
	~"disksim_ioÁ˚.h
"

255 
	~"disksim_‹gÁ˚.h
"

256 
	~"disksim_iŸø˚.h
"

257 
	~"disksim_°©.h
"

258 
	~"disksim_iodrivî.h
"

259 
	~"disksim_bus.h
"

260 
	~"disksim_c⁄åﬁÀr.h
"

261 
	~"c⁄fig.h
"

263 
	#TRACEMAPPINGS
 
MAXDEVICES


	)

265 
	#PRINTTRACESTATS
 
TRUE


	)

269 *
	g°©desc_åa˚queue°©s
 = "Trace queueÅime";

270 *
	g°©desc_åa˚ª•°©s
 = "TraceÑesponseÅime";

271 *
	g°©desc_åa˚acc°©s
 = "TraceáccessÅime";

272 *
	g°©desc_åa˚qÀn°©s
 = "Trace queueÜength";

273 *
	g°©desc_åa˚noq°©s
 = "TraceÇon-queueÅime";

274 *
	g°©desc_åa˚accdiff°©s
 = "Traceáccess diffÅime";

275 *
	g°©desc_åa˚accwrôe°©s
 = "Trace writeáccessÅime";

276 *
	g°©desc_åa˚accdiffwrôe°©s
 = "Trace writeáccess diffÅime";

279 
	siosim_öfo
 {

280 
evít
 * 
	mio_extq
;

281 
	mio_extqÀn
;

282 
	mio_extq_ty≥
;

283 
	miosˇÀ
;

284 
	mœ°_ªque°_¨rive
;

285 
	mc⁄°öèºtime
;

286 
	mvÆid©ebuf
[10];

287 
	måa˚m≠pögs
;

288 
	måa˚m≠
[
TRACEMAPPINGS
];

289 
	måa˚m≠1
[
TRACEMAPPINGS
];

290 
	måa˚m≠2
[
TRACEMAPPINGS
];

291 
	måa˚m≠3
[
TRACEMAPPINGS
];

292 
	måa˚m≠4
[
TRACEMAPPINGS
];

293 
°©gí
 *
	måa˚°©s
;

294 
°©gí
 *
	måa˚°©s1
;

295 
°©gí
 *
	måa˚°©s2
;

296 
°©gí
 *
	måa˚°©s3
;

297 
°©gí
 *
	måa˚°©s4
;

298 
°©gí
 *
	måa˚°©s5
;

299 } 
	tiosim_öfo_t
;

303 
	#io_extq
 (
disksim
->
iosim_öfo
->
io_extq
)

	)

304 
	#io_extqÀn
 (
disksim
->
iosim_öfo
->
io_extqÀn
)

	)

305 
	#io_extq_ty≥
 (
disksim
->
iosim_öfo
->
io_extq_ty≥
)

	)

306 
	#iosˇÀ
 (
disksim
->
iosim_öfo
->
iosˇÀ
)

	)

307 
	#œ°_ªque°_¨rive
 (
disksim
->
iosim_öfo
->
œ°_ªque°_¨rive
)

	)

308 
	#c⁄°öèºtime
 (
disksim
->
iosim_öfo
->
c⁄°öèºtime
)

	)

309 
	#vÆid©ebuf
 (
disksim
->
iosim_öfo
->
vÆid©ebuf
)

	)

310 
	#åa˚m≠pögs
 (
disksim
->
iosim_öfo
->
åa˚m≠pögs
)

	)

311 
	#åa˚m≠
 (
disksim
->
iosim_öfo
->
åa˚m≠
)

	)

312 
	#åa˚m≠1
 (
disksim
->
iosim_öfo
->
åa˚m≠1
)

	)

313 
	#åa˚m≠2
 (
disksim
->
iosim_öfo
->
åa˚m≠2
)

	)

314 
	#åa˚m≠3
 (
disksim
->
iosim_öfo
->
åa˚m≠3
)

	)

315 
	#åa˚m≠4
 (
disksim
->
iosim_öfo
->
åa˚m≠4
)

	)

316 
	#åa˚°©s
 (
disksim
->
iosim_öfo
->
åa˚°©s
)

	)

317 
	#åa˚°©s1
 (
disksim
->
iosim_öfo
->
åa˚°©s1
)

	)

318 
	#åa˚°©s2
 (
disksim
->
iosim_öfo
->
åa˚°©s2
)

	)

319 
	#åa˚°©s3
 (
disksim
->
iosim_öfo
->
åa˚°©s3
)

	)

320 
	#åa˚°©s4
 (
disksim
->
iosim_öfo
->
åa˚°©s4
)

	)

321 
	#åa˚°©s5
 (
disksim
->
iosim_öfo
->
åa˚°©s5
)

	)

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_iotrace.c

101 
	~"c⁄fig.h
"

103 
	~"disksim_globÆ.h
"

104 
	~"disksim_h±ø˚.h
"

105 
	~"disksim_iŸø˚.h
"

108 
	$iŸø˚_öôülize_iŸø˚_öfo
 ()

110 
disksim
->
iŸø˚_öfo
 = 
	`DISKSIM_mÆloc
 ((
iŸø˚_öfo_t
));

111 
	`bzîo
 ((*)
disksim
->
iŸø˚_öfo
, (
iŸø˚_öfo_t
));

113 
åa˚ba£time
 = 0.0;

114 
fú°io
 = 
TRUE
;

115 
œ°time
 = 0.0;

116 
ba£bigtime
 = -1;

117 
ba£smÆ…ime
 = -1;

118 
ba£simtime
 = 0.0;

119 
vÆid©e_œ°£rv
 = 0.0;

120 
vÆid©e_√xtöãr
 = 0.0;

121 
accumuœãd_evít_time
 = 0.0;

122 
œ°ac˚s°ime
 = 0.0;

123 
	}
}

126 
	$iŸø˚_£t_f‹m©
 (*
f‹m©«me
)

128 i‡(
disksim
->
iŸø˚_öfo
 =
NULL
) {

129 
	`iŸø˚_öôülize_iŸø˚_öfo
();

132 
disksim
->
åa˚ídün
 = 
_LITTLE_ENDIAN
;

133 
disksim
->
åa˚hódî
 = 
TRUE
;

134 i‡(
	`°rcmp
(
f‹m©«me
, "0") == 0) {

135 
disksim
->
åa˚f‹m©
 = 
DEFAULT
;

136 } i‡(
	`°rcmp
(
f‹m©«me
, "ascii") == 0) {

138 
disksim
->
åa˚f‹m©
 = 
ASCII
;

139 } i‡(
	`°rcmp
(
f‹m©«me
, "raw") == 0) {

141 
disksim
->
åa˚f‹m©
 = 
RAW
;

142 } i‡(
	`°rcmp
(
f‹m©«me
, "validate") == 0) {

144 
disksim
->
åa˚f‹m©
 = 
VALIDATE
;

145 } i‡(
	`°rcmp
(
f‹m©«me
, "hpl") == 0) {

147 
disksim
->
åa˚f‹m©
 = 
HPL
;

148 
disksim
->
åa˚ídün
 = 
_BIG_ENDIAN
;

149 } i‡(
	`°rcmp
(
f‹m©«me
, "hpl2") == 0) {

152 
disksim
->
åa˚f‹m©
 = 
HPL
;

153 
disksim
->
åa˚ídün
 = 
_BIG_ENDIAN
;

154 
disksim
->
åa˚hódî
 = 
FALSE
;

155 } i‡(
	`°rcmp
(
f‹m©«me
, "dec") == 0) {

157 
disksim
->
åa˚f‹m©
 = 
DEC
;

158 } i‡(
	`°rcmp
(
f‹m©«me
, "emcsymm") == 0) {

160 
disksim
->
åa˚f‹m©
 = 
EMCSYMM
;

161 } i‡(
	`°rcmp
(
f‹m©«me
, "emcbackend") == 0) {

164 
disksim
->
åa˚f‹m©
 = 
EMCBACKEND
;

165 } i‡(
	`°rcmp
(
f‹m©«me
, "batch") == 0) {

167 
disksim
->
åa˚f‹m©
 = 
BATCH
;

169 
	`Ârötf
(
°dîr
, "Unknow¿åa˚ f‹m© - %s\n", 
f‹m©«me
);

170 
	`exô
(1);

172 
	}
}

175 
	$iŸø˚_ªad_•a˚
 (
FILE
 *
åa˚fûe
, *
•a˚±r
, 
•a˚size
)

177 i‡(
	`‰ód
(
•a˚±r
, 
•a˚size
, 1, 
åa˚fûe
) != 1) {

181 
	}
}

184 
	$iŸø˚_ªad_ch¨
 (
FILE
 *
åa˚fûe
, *
ch¨±r
)

186 
	`SèticAs£π
 (() == 1);

187 i‡(
	`‰ód
(
ch¨±r
, (), 1, 
åa˚fûe
) != 1) {

191 
	}
}

194 
	$iŸø˚_ªad_sh‹t
 (
FILE
 *
åa˚fûe
, *
sh‹çå
)

196 
	`SèticAs£π
 (() == 2);

197 i‡(
	`‰ód
(
sh‹çå
, (), 1, 
åa˚fûe
) != 1) {

200 i‡(
disksim
->
ídün
 !disksim->
åa˚ídün
) {

201 *
sh‹çå
 = ((*shortptr) << 8) + (((*shortptr) >> 8) & 0xFF);

204 
	}
}

207 
	$iŸø˚_ªad_öt32
 (
FILE
 *
åa˚fûe
, 
öt32_t
 *
ötP
)

209 
i
;

210 
ötch¨
 
sw≠vÆ
;

211 
ötch¨
 
ötch¨vÆ
;

213 
	`SèticAs£π
 (() == 4);

214 i‡(
	`‰ód
(&
ötch¨vÆ
.
vÆue
, (), 1, 
åa˚fûe
) != 1) {

217 i‡(
disksim
->
ídün
 !disksim->
åa˚ídün
) {

218 
i
=0; i<(); i++) {

219 
sw≠vÆ
.
byã
[
i
] = 
ötch¨vÆ
.byte[(() - i - 1)];

224 
ötch¨vÆ
.
vÆue
 = 
sw≠vÆ
.value;

226 *
ötP
 = 
ötch¨vÆ
.
vÆue
;

228 
	}
}

231 
	#iŸø˚_ªad_Êﬂt
(
a
, 
b
Ë
	`iŸø˚_ªad_öt32
◊, b)

	)

234 
i‹eq_evít
 * 
	$iŸø˚_vÆid©e_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
i‹eq_evít
 *
√w
)

236 
löe
[201];

237 
rw
;

238 
£rvtime
;

240 i‡(
	`fgës
(
löe
, 200, 
åa˚fûe
Ë=
NULL
) {

241 
	`addt€xåaq
((
evít
 *Ë
√w
);

242 (
NULL
);

244 
√w
->
time
 = 
simtime
 + (
vÆid©e_√xtöãr
 / () 1000);

245 i‡(
	`ssˇnf
(
löe
, "%c %s %d %d %lf %lf\n",

246 &
rw
,

247 
vÆid©e_bufÁ˘i⁄
,

248 &
√w
->
blkno
,

249 &
√w
->
bcou¡
,

250 &
£rvtime
,

251 &
vÆid©e_√xtöãr
) != 6)

253 
	`Ârötf
(
°dîr
, "WrongÇumber ofárguments for I/OÅraceÉventÅype\n");

254 
	`ddbg_as£π
(0);

256 
vÆid©e_œ°£rv
 = 
£rvtime
 / () 1000;

257 i‡(
rw
 == 'R') {

258 
√w
->
Êags
 = 
READ
;

259 } i‡(
rw
 == 'W') {

260 
√w
->
Êags
 = 
WRITE
;

262 
	`Ârötf
(
°dîr
, "InvÆid R/W vÆue: %c\n", 
rw
);

263 
	`exô
(1);

265 
√w
->
devno
 = 0;

266 
√w
->
buf
 = 0;

267 
√w
->
›id
 = 0;

268 
√w
->
ˇu£
 = 0;

269 
√w
->
bu¢o
 = 0;

270 
√w
->
ãmpöt2
 = 0;

271 
√w
->
ãmpöt1
 = 0;

272 
vÆid©e_œ°blkno
 = 
√w
->
blkno
;

273 
vÆid©e_œ°bcou¡
 = 
√w
->
bcou¡
;

274 
vÆid©e_œ°ªad
 = 
√w
->
Êags
 & 
READ
;

275 (
√w
);

276 
	}
}

279 
i‹eq_evít
 * 
	$iŸø˚_dec_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
i‹eq_evít
 *
√w
)

281 
	`as£π
 ("removed for distribution" == 0);

282 
	`iŸø˚_ªad_•a˚
 (
åa˚fûe
, 
NULL
, 0);

283  (
NULL
);

284 
	}
}

287 
	$iŸø˚_h∂_§t_c⁄vît_Êags
 (
i‹eq_evít
 *
cuº
)

289 
Êags
;

291 
Êags
 = 
cuº
->flags;

292 
cuº
->
Êags
 = 0;

293 i‡(
Êags
 & 
HPL_READ
) {

294 
cuº
->
Êags
 |
READ
;

295 
h¥óds
++;

297 
hpwrôes
++;

299 i‡(!(
Êags
 & 
HPL_ASYNC
)) {

300 
cuº
->
Êags
 |
TIME_CRITICAL
;

301 i‡(
cuº
->
Êags
 & 
READ
) {

302 
syn¸óds
++;

304 
syncwrôes
++;

307 i‡(
Êags
 & 
HPL_ASYNC
) {

308 i‡(
cuº
->
Êags
 & 
READ
) {

309 
cuº
->
Êags
 |
TIME_LIMITED
;

310 
asyn¸óds
++;

312 
asyncwrôes
++;

315 
	}
}

318 
i‹eq_evít
 * 
	$iŸø˚_h∂_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
i‹eq_evít
 *
√w
)

320 
öt32_t
 
size
;

321 
öt32_t
 
id
;

322 
öt32_t
 
£c
;

323 
öt32_t
 
u£c
;

324 
öt32_t
 
vÆ
;

325 
öt32_t
 
junköt
;

326 
Áûuª
 = 0;

328 
TRUE
) {

329 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
size
);

330 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
id
);

331 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
£c
);

332 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
u£c
);

333 i‡(
Áûuª
) {

334 
	`addt€xåaq
((
evít
 *Ë
√w
);

335 (
NULL
);

337 i‡(((
id
 >> 16) < 1) || ((id >> 16) > 4)) {

338 
	`Ârötf
(
°dîr
, "Eº‹ i¿åa˚ f‹m© - id %x\n", 
id
);

339 
	`exô
(1);

341 i‡(((
id
 & 0xFFFFË!
HPL_SHORTIO
Ë&& ((id & 0xFFFFË!
HPL_SUSPECTIO
)) {

342 
	`Ârötf
(
°dîr
, "U√x≥˘edÑec‹dÅy≥ - %x\n", 
id
);

343 
	`exô
(1);

345 
√w
->
time
 = (Ë
£c
 * (Ë
MILLI
;

346 
√w
->
time
 +(Ë
u£c
 / (Ë
MILLI
;

348 i‡((
disksim
->
åa˚hódî
 =
FALSE
Ë&& (
√w
->
time
 == 0.0)) {

349 
åa˚ba£time
 = 
simtime
;

352 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

353 
√w
->
ãmpöt1
 = 
vÆ
;

354 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

355 
√w
->
ãmpöt2
 = 
vÆ
;

356 
√w
->
ãmpöt2
 -√w->
ãmpöt1
;

357 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

358 
√w
->
bcou¡
 = 
vÆ
;

359 i‡(
√w
->
bcou¡
 & 0x000001FF) {

360 
	`Ârötf
(
°dîr
, "HPLÑeque° f‹Ç⁄-512B mu…ùÀ size: %d\n", 
√w
->
bcou¡
);

361 
	`exô
(1);

363 
√w
->
bcou¡
 =Çew->bcount >> 9;

364 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

365 
√w
->
blkno
 = 
vÆ
;

366 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

367 
√w
->
devno
 = (
vÆ
 >> 8) & 0xFF;

368 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

369 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

373 
√w
->
buf
 = (*Ë
vÆ
;

374 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

375 
√w
->
Êags
 = 
vÆ
;

376 
	`iŸø˚_h∂_§t_c⁄vît_Êags
(
√w
);

377 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
junköt
);

378 
size
 -13 * (
öt32_t
);

379 i‡((
id
 >> 16) == 4) {

380 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

381 
√w
->
¶Ÿno
 = 
vÆ
;

382 
size
 -(
öt32_t
);

384 i‡((
id
 & 0xFFFFË=
HPL_SUSPECTIO
) {

385 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
junköt
);

386 
size
 -(
öt32_t
);

388 i‡(
Áûuª
) {

389 
	`addt€xåaq
((
evít
 *Ë
√w
);

390 (
NULL
);

392 i‡(
size
) {

393 
	`Ârötf
(
°dîr
, "Unm©ched sizêf‹Ñec‹d - %d\n", 
size
);

394 
	`exô
(1);

396 
√w
->
ˇu£
 = 0;

397 
√w
->
›id
 = 0;

398 
√w
->
bu¢o
 = 0;

399 i‡((
id
 & 0xFFFFË=
HPL_SHORTIO
) {

400 (
√w
);

403 
	}
}

406 
	$iŸø˚_m⁄th_c⁄vît
 (*
m⁄th°r
, 
yór
)

408 i‡(
	`°rcmp
(
m⁄th°r
, "Jan") == 0) {

410 } i‡(
	`°rcmp
(
m⁄th°r
, "Feb") == 0) {

412 } i‡(
	`°rcmp
(
m⁄th°r
, "Mar") == 0) {

413 ((
yór
 % 4) ? 59 : 60);

414 } i‡(
	`°rcmp
(
m⁄th°r
, "Apr") == 0) {

415 ((
yór
 % 4) ? 90 : 91);

416 } i‡(
	`°rcmp
(
m⁄th°r
, "May") == 0) {

417 ((
yór
 % 4) ? 120 : 121);

418 } i‡(
	`°rcmp
(
m⁄th°r
, "Jun") == 0) {

419 ((
yór
 % 4) ? 151 : 152);

420 } i‡(
	`°rcmp
(
m⁄th°r
, "Jul") == 0) {

421 ((
yór
 % 4) ? 181 : 182);

422 } i‡(
	`°rcmp
(
m⁄th°r
, "Aug") == 0) {

423 ((
yór
 % 4) ? 212 : 213);

424 } i‡(
	`°rcmp
(
m⁄th°r
, "Sep") == 0) {

425 ((
yór
 % 4) ? 243 : 244);

426 } i‡(
	`°rcmp
(
m⁄th°r
, "Oct") == 0) {

427 ((
yór
 % 4) ? 273 : 274);

428 } i‡(
	`°rcmp
(
m⁄th°r
, "Nov") == 0) {

429 ((
yór
 % 4) ? 304 : 305);

430 } i‡(
	`°rcmp
(
m⁄th°r
, "Dec") == 0) {

431 ((
yór
 % 4) ? 334 : 335);

433 
	`as£π
(0);

435 
	}
}

438 
	$iŸø˚_øw_gë_húe°ime
 (
bigtime
, 
smÆ…ime
)

440 
l‹e°icks
;

441 
smÆl
, 
tu∫ovîs
;

442 
smÆ…icks
;

444 i‡(
ba£bigtime
 == -1) {

445 
ba£bigtime
 = 
bigtime
;

446 
ba£smÆ…ime
 = 
smÆ…ime
;

447 
ba£simtime
 = 0.0;

449 
smÆl
 = (
ba£smÆ…ime
 - 
smÆ…ime
) & 0xFFFF;

450 
l‹e°icks
 = (
bigtime
 - 
ba£bigtime
Ë* 11932 - 
smÆl
;

451 
tu∫ovîs
 = (Ë(((Ë
l‹e°icks
 / () 65536) + () 0.5);

452 
smÆ…icks
 = 
tu∫ovîs
 * 65536 + 
smÆl
;

453 
ba£bigtime
 = 
bigtime
;

454 
ba£smÆ…ime
 = 
smÆ…ime
;

455 
ba£simtime
 +(Ë
smÆ…icks
 * () 0.000838574;

457 (
ba£simtime
);

458 
	}
}

463 
i‹eq_evít
 * 
	$iŸø˚_øw_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
i‹eq_evít
 *
√w
)

465 
bigtime
;

466 
smÆl
;

467 
smÆ…ime
;

468 
Áûuª
 = 0;

469 
‹dî
, 
¸ô
;

470 
schedtime
, 
d⁄ëime
;

471 
öt32_t
 
vÆ
;

473 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

474 
bigtime
 = 
vÆ
;

475 
Áûuª
 |
	`iŸø˚_ªad_sh‹t
(
åa˚fûe
, &
smÆl
);

476 
smÆ…ime
 = ((Ë
smÆl
) & 0xFFFF;

477 
√w
->
time
 = 
	`iŸø˚_øw_gë_húe°ime
(
bigtime
, 
smÆ…ime
);

478 
Áûuª
 |
	`iŸø˚_ªad_sh‹t
(
åa˚fûe
, &
smÆl
);

479 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

480 
bigtime
 = 
vÆ
;

481 
smÆ…ime
 = ((Ë
smÆl
) & 0xFFFF;

482 
schedtime
 = 
	`iŸø˚_øw_gë_húe°ime
(
bigtime
, 
smÆ…ime
);

483 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

484 
bigtime
 = 
vÆ
;

485 
Áûuª
 |
	`iŸø˚_ªad_sh‹t
(
åa˚fûe
, &
smÆl
);

486 
smÆ…ime
 = ((Ë
smÆl
) & 0xFFFF;

487 
d⁄ëime
 = 
	`iŸø˚_øw_gë_húe°ime
(
bigtime
, 
smÆ…ime
);

488 
Áûuª
 |
	`iŸø˚_ªad_ch¨
(
åa˚fûe
, &
‹dî
);

489 
Áûuª
 |
	`iŸø˚_ªad_ch¨
(
åa˚fûe
, &
¸ô
);

490 i‡(
¸ô
) {

491 
√w
->
Êags
 |
TIME_CRITICAL
;

493 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

494 
√w
->
bcou¡
 = 
vÆ
 >> 9;

495 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

496 
√w
->
blkno
 = 
vÆ
;

497 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

498 
√w
->
devno
 = 
vÆ
;

499 
Áûuª
 |
	`iŸø˚_ªad_öt32
(
åa˚fûe
, &
vÆ
);

500 
√w
->
Êags
 = 
vÆ
 & 
READ
;

501 
√w
->
ˇu£
 = 0;

502 
√w
->
buf
 = 0;

503 
√w
->
›id
 = 0;

504 
√w
->
bu¢o
 = 0;

505 
√w
->
ãmpöt1
 = ()((
schedtime
 -Çew->
time
) * () 1000);

506 
√w
->
ãmpöt2
 = ()((
d⁄ëime
 - 
schedtime
) * () 1000);

507 i‡(
Áûuª
) {

508 
	`addt€xåaq
((
evít
 *Ë
√w
);

509 
√w
 = 
NULL
;

511 (
√w
);

512 
	}
}

515 
i‹eq_evít
 * 
	$iŸø˚_emcsymm_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
i‹eq_evít
 *
√w
)

517 
löe
[201];

518 
›î©i⁄
[15];

519 
dúe˘‹
;

521 i‡(
	`fgës
(
löe
, 200, 
åa˚fûe
Ë=
NULL
) {

522 
	`addt€xåaq
((
evít
 *Ë
√w
);

523 (
NULL
);

525 i‡(
	`ssˇnf
(
löe
, "%l‡%†%x %x %d %d\n", &
√w
->
time
, 
›î©i⁄
, &
dúe˘‹
, &√w->
devno
, &√w->
blkno
, &√w->
bcou¡
) != 6) {

526 
	`Ârötf
(
°dîr
, "WrongÇumber ofárguments for I/OÅraceÉventÅype\n");

527 
	`Ârötf
(
°dîr
, "löe: %s", 
löe
);

528 
	`ddbg_as£π
(0);

530 i‡(!
	`°rˇ£cmp
(
›î©i⁄
,"Read")) {

531 
√w
->
Êags
 = 
READ
;

532 } i‡(!
	`°rˇ£cmp
(
›î©i⁄
,"Write")) {

533 
√w
->
Êags
 = 
WRITE
;

535 
	`Ârötf
(
°dîr
, "Unknow¿›î©i⁄: %†ö iŸø˚Évít\n",
›î©i⁄
);

536 
	`Ârötf
(
°dîr
, "löe: %s", 
löe
);

537 
	`exô
(1);

539 
√w
->
buf
 = 0;

540 
√w
->
›id
 = 0;

541 
√w
->
bu¢o
 = 0;

542 
√w
->
ˇu£
 = 0;

543 (
√w
);

544 
	}
}

546 
i‹eq_evít
 * 
	$iŸø˚_emcbackíd_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
i‹eq_evít
 *
√w
)

548 
löe
[201];

549 
›î©i⁄
[15];

550 
dúe˘‹
;

551 
bus
[2];

552 
disk
, 
hy≥r
;

554 i‡(
	`fgës
(
löe
, 200, 
åa˚fûe
Ë=
NULL
) {

555 
	`addt€xåaq
((
evít
 *Ë
√w
);

556 (
NULL
);

559 i‡(
	`ssˇnf
(
löe
, "%lf %s %x %x %d %d %s %d %d\n",

560 &
√w
->
time
, 
›î©i⁄
, &
dúe˘‹
, &
hy≥r
, &√w->
blkno
, &√w->
bcou¡
, 
bus
, &
disk
, &√w->
devno
) != 9) {

561 
	`Ârötf
(
°dîr
, "WrongÇumber ofárguments for I/OÅraceÉventÅype\n");

562 
	`Ârötf
(
°dîr
, "löe: %s", 
löe
);

563 
	`exô
(0);

565 i‡(!
	`°rˇ£cmp
(
›î©i⁄
,"Read")) {

566 
√w
->
Êags
 = 
READ
;

567 } i‡(!
	`°rˇ£cmp
(
›î©i⁄
,"Write")) {

568 
√w
->
Êags
 = 
WRITE
;

570 
	`Ârötf
(
°dîr
, "Unknow¿›î©i⁄: %†ö iŸø˚Évít\n",
›î©i⁄
);

571 
	`Ârötf
(
°dîr
, "löe: %s", 
löe
);

572 
	`exô
(0);

575 
√w
->
time
 *= 1000.0;

577 
√w
->
buf
 = 0;

578 
√w
->
›id
 = 0;

579 
√w
->
bu¢o
 = 0;

580 
√w
->
ˇu£
 = 0;

581 (
√w
);

582 
	}
}

585 
i‹eq_evít
 * 
	$iŸø˚_ascii_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
i‹eq_evít
 *
√w
)

587 
löe
[201];

589 i‡(
	`fgës
(
löe
, 200, 
åa˚fûe
Ë=
NULL
) {

590 
	`addt€xåaq
((
evít
 *Ë
√w
);

591 (
NULL
);

593 i‡(
	`ssˇnf
(
löe
, "%l‡%d %d %d %x\n", &
√w
->
time
, &√w->
devno
, &√w->
blkno
, &√w->
bcou¡
, &√w->
Êags
) != 5) {

594 
	`Ârötf
(
°dîr
, "WrongÇumber ofárguments for I/OÅraceÉventÅype\n");

595 
	`Ârötf
(
°dîr
, "löe: %s", 
löe
);

596 
	`ddbg_as£π
(0);

598 i‡(
√w
->
Êags
 & 
ASYNCHRONOUS
) {

599 
√w
->
Êags
 |“ew->Êag†& 
READ
Ë? 
TIME_LIMITED
 : 0;

600 } i‡(
√w
->
Êags
 & 
SYNCHRONOUS
) {

601 
√w
->
Êags
 |
TIME_CRITICAL
;

605 
√w
->
Êags
 = 
WRITE
;

607 
√w
->
buf
 = 0;

608 
√w
->
›id
 = 0;

609 
√w
->
bu¢o
 = 0;

610 
√w
->
ˇu£
 = 0;

611 (
√w
);

612 
	}
}

614 
i‹eq_evít
 * 
	$iŸø˚_b©ch_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
i‹eq_evít
 *
√w
)

616 
löe
[201];

618 i‡(
	`fgës
(
löe
, 200, 
åa˚fûe
Ë=
NULL
) {

619 
	`addt€xåaq
((
evít
 *Ë
√w
);

620 (
NULL
);

622 i‡(
	`ssˇnf
(
löe
, "%l‡%d %d %d %x %d\n", &
√w
->
time
, &√w->
devno
, &√w->
blkno
, &√w->
bcou¡
, &√w->
Êags
, &√w->
b©chno
) != 6) {

623 
	`Ârötf
(
°dîr
, "WrongÇumber ofárguments for I/OÅraceÉventÅype\n");

624 
	`Ârötf
(
°dîr
, "löe: %s", 
löe
);

625 
	`ddbg_as£π
(0);

627 i‡(
√w
->
Êags
 & 
ASYNCHRONOUS
) {

628 
√w
->
Êags
 |“ew->Êag†& 
READ
Ë? 
TIME_LIMITED
 : 0;

629 } i‡(
√w
->
Êags
 & 
SYNCHRONOUS
) {

630 
√w
->
Êags
 |
TIME_CRITICAL
;

632 i‡(
√w
->
Êags
 & 
BATCH_COMPLETE
) {

633 
√w
->
b©ch_com∂ëe
 = 1;

635 
√w
->
b©ch_com∂ëe
 = 0;

638 
√w
->
buf
 = 0;

639 
√w
->
›id
 = 0;

640 
√w
->
bu¢o
 = 0;

641 
√w
->
ˇu£
 = 0;

642 (
√w
);

643 
	}
}

646 
i‹eq_evít
 * 
	$iŸø˚_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
åa˚f‹m©
, 
i‹eq_evít
 *
ãmp
)

648 
åa˚f‹m©
) {

650 
ASCII
:

651 
ãmp
 = 
	`iŸø˚_ascii_gë_i‹eq_evít
(
åa˚fûe
,Åemp);

654 
RAW
:

655 
ãmp
 = 
	`iŸø˚_øw_gë_i‹eq_evít
(
åa˚fûe
,Åemp);

658 
HPL
:

659 
ãmp
 = 
	`iŸø˚_h∂_gë_i‹eq_evít
(
åa˚fûe
,Åemp);

662 
DEC
:

663 
ãmp
 = 
	`iŸø˚_dec_gë_i‹eq_evít
(
åa˚fûe
,Åemp);

666 
VALIDATE
:

667 
ãmp
 = 
	`iŸø˚_vÆid©e_gë_i‹eq_evít
(
åa˚fûe
,Åemp);

670 
EMCSYMM
:

671 
ãmp
 = 
	`iŸø˚_emcsymm_gë_i‹eq_evít
(
åa˚fûe
,Åemp);

674 
EMCBACKEND
:

675 
ãmp
 = 
	`iŸø˚_emcbackíd_gë_i‹eq_evít
(
åa˚fûe
,Åemp);

678 
BATCH
:

679 
ãmp
 = 
	`iŸø˚_b©ch_gë_i‹eq_evít
(
åa˚fûe
,Åemp);

683 
	`Ârötf
(
°dîr
, "Unknow¿åa˚f‹m© i¿iŸø˚_gë_i‹eq_evíà- %d\n", 
åa˚f‹m©
);

684 
	`exô
(1);

687  ((
i‹eq_evít
 *)
ãmp
);

688 
	}
}

691 
	$iŸø˚_h∂_§t_åa˚fûe_°¨t
 (*
åa˚d©e
)

693 
¸≠
[40];

694 
m⁄th°r
[40];

695 
day
;

696 
hour
;

697 
möuã
;

698 
£c⁄d
;

699 
yór
;

701 i‡(
	`ssˇnf
(
åa˚d©e
, "%s\t\"%†%†%d %d:%d:%d %d\";\n", 
¸≠
, cøp, 
m⁄th°r
, &
day
, &
hour
, &
möuã
, &
£c⁄d
, &
yór
) != 8) {

702 
	`Ârötf
(
°dîr
, "F‹m©ÖrobÀm wôh 'åa˚d©e'Üöêö HPLÅø˚ - %s\n", 
åa˚d©e
);

703 
	`exô
(1);

705 i‡(
ba£yór
 == 0) {

706 
ba£yór
 = 
yór
;

708 
day
 = day + 
	`iŸø˚_m⁄th_c⁄vît
(
m⁄th°r
, 
yór
);

709 i‡(
yór
 !
ba£yór
) {

710 
day
 +(
ba£yór
 % 4) ? 365 : 366;

712 i‡(
ba£day
 == 0) {

713 
ba£day
 = 
day
;

715 
£c⁄d
 = sec⁄d + (60 * 
möuã
Ë+ (3600 * 
hour
Ë+ (86400 * (
day
 - 
ba£day
));

716 i‡(
ba££c⁄d
 == 0) {

717 
ba££c⁄d
 = 
£c⁄d
;

719 
£c⁄d
 -
ba££c⁄d
;

720 
åa˚ba£time
 +(Ë1000 * (Ë
£c⁄d
;

721 
	}
}

724 
	$iŸø˚_h∂_öôülize_fûe
 (
FILE
 *
åa˚fûe
, 
¥öt_åa˚fûe_hódî
)

726 
Àâî
 = '0';

727 
löe
[201];

728 
löëy≥
[40];

730 i‡(
disksim
->
åa˚hódî
 =
FALSE
) {

734 i‡(
	`fgës
(
löe
, 200, 
åa˚fûe
Ë=
NULL
) {

735 
	`Ârötf
(
°dîr
, "No 'tracedate'Üine in HPLÅrace\n");

736 
	`exô
(1);

738 
	`ssˇnf
(
löe
, "%s", 
löëy≥
);

739 i‡(
	`°rcmp
(
löëy≥
, "tracedate") == 0) {

743 
	`iŸø˚_h∂_§t_åa˚fûe_°¨t
(
löe
);

744 
Àâî
 != 0x0C) {

745 i‡(
	`fsˇnf
(
åa˚fûe
, "%c", &
Àâî
) != 1) {

746 
	`Ârötf
(
°dîr
, "End of header informationÇever found -Énd of file\n");

747 
	`exô
(1);

749 i‡((
¥öt_åa˚fûe_hódî
Ë&& (
Àâî
 != 0x0C)) {

750 
	`¥ötf
("%c", 
Àâî
);

753 
	}
}

756 
	$iŸø˚_öôülize_fûe
 (
FILE
 *
åa˚fûe
, 
åa˚f‹m©
, 
¥öt_åa˚fûe_hódî
)

758 i‡(
åa˚f‹m©
 =
HPL
) {

759 
	`iŸø˚_h∂_öôülize_fûe
(
åa˚fûe
, 
¥öt_åa˚fûe_hódî
);

761 
	}
}

764 
	$iŸø˚_¥öt°©s
 (
FILE
 *
outfûe
)

766 i‡(
disksim
->
iŸø˚_öfo
 =
NULL
) {

769 i‡(
h¥óds
 | 
hpwrôes
) {

770 
	`Ârötf
 (
outfûe
, "\n");

771 
	`Ârötf
(
outfûe
, "TŸÆÑóds: \t%d\t%5.2f\n", 
h¥óds
, ((Ëh¥ód†/ (Ë(h¥ód†+ 
hpwrôes
)));

772 
	`Ârötf
(
outfûe
, "TŸÆ wrôes: \t%d\t%5.2f\n", 
hpwrôes
, ((Ëhpwrôe†/ (Ë(
h¥óds
 + hpwrites)));

773 
	`Ârötf
(
outfûe
, "Syn¯Róds: \t%d\t%5.2f\t%5.2f\n", 
syn¸óds
, ((Ësyn¸ód†/ (Ë(
h¥óds
 + 
hpwrôes
)), (() syncreads / () hpreads));

774 
	`Ârötf
(
outfûe
, "Syn¯Wrôes: \t%d\t%5.2f\t%5.2f\n", 
syncwrôes
, ((Ësyncwrôe†/ (Ë(
h¥óds
 + 
hpwrôes
)), (() syncwrites / () hpwrites));

775 
	`Ârötf
(
outfûe
, "Asyn¯Róds: \t%d\t%5.2f\t%5.2f\n", 
asyn¸óds
, ((Ëasyn¸ód†/ (Ë(
h¥óds
 + 
hpwrôes
)), (()ásyncreads / () hpreads));

776 
	`Ârötf
(
outfûe
, "Asyn¯Wrôes:\t%d\t%5.2f\t%5.2f\n", 
asyncwrôes
, ((Ëasyncwrôe†/ (Ë(
h¥óds
 + 
hpwrôes
)), (()ásyncwrites / () hpwrites));

778 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_iotrace.h

58 #i‚de‡
DISKSIM_IOTRACE_H


59 
	#DISKSIM_IOTRACE_H


	)

65 
	siŸø˚_öfo
 {

66 
	måa˚ba£time
;

67 
	msyn¸óds
;

68 
	msyncwrôes
;

69 
	masyn¸óds
;

70 
	masyncwrôes
;

71 
	mh¥óds
;

72 
	mhpwrôes
;

73 
	mfú°io
;

74 
	mba£highsh‹t
;

75 
	mba£highsh‹t2
;

76 
	mœ°time1
;

77 
	mœ°time
;

78 
	mba£yór
;

79 
	mba£day
;

80 
	mba££c⁄d
;

81 
	mba£bigtime
;

82 
	mba£smÆ…ime
;

83 
	mba£simtime
;

84 
	mvÆid©e_œ°£rv
;

85 
	mvÆid©e_œ°blkno
;

86 
	mvÆid©e_œ°bcou¡
;

87 
	mvÆid©e_œ°ªad
;

88 
	mvÆid©e_√xtöãr
;

89 
	mvÆid©e_bufÁ˘i⁄
[20];

90 
	maccumuœãd_evít_time
;

91 
	mœ°ac˚s°ime
;

92 } 
	tiŸø˚_öfo_t
;

96 
	#åa˚ba£time
 (
disksim
->
iŸø˚_öfo
->
åa˚ba£time
)

	)

97 
	#syn¸óds
 (
disksim
->
iŸø˚_öfo
->
syn¸óds
)

	)

98 
	#syncwrôes
 (
disksim
->
iŸø˚_öfo
->
syncwrôes
)

	)

99 
	#asyn¸óds
 (
disksim
->
iŸø˚_öfo
->
asyn¸óds
)

	)

100 
	#asyncwrôes
 (
disksim
->
iŸø˚_öfo
->
asyncwrôes
)

	)

101 
	#h¥óds
 (
disksim
->
iŸø˚_öfo
->
h¥óds
)

	)

102 
	#hpwrôes
 (
disksim
->
iŸø˚_öfo
->
hpwrôes
)

	)

103 
	#fú°io
 (
disksim
->
iŸø˚_öfo
->
fú°io
)

	)

104 
	#ba£highsh‹t
 (
disksim
->
iŸø˚_öfo
->
ba£highsh‹t
)

	)

105 
	#ba£highsh‹t2
 (
disksim
->
iŸø˚_öfo
->
ba£highsh‹t2
)

	)

106 
	#œ°time1
 (
disksim
->
iŸø˚_öfo
->
œ°time1
)

	)

107 
	#œ°time
 (
disksim
->
iŸø˚_öfo
->
œ°time
)

	)

108 
	#ba£yór
 (
disksim
->
iŸø˚_öfo
->
ba£yór
)

	)

109 
	#ba£day
 (
disksim
->
iŸø˚_öfo
->
ba£day
)

	)

110 
	#ba££c⁄d
 (
disksim
->
iŸø˚_öfo
->
ba££c⁄d
)

	)

111 
	#ba£bigtime
 (
disksim
->
iŸø˚_öfo
->
ba£bigtime
)

	)

112 
	#ba£smÆ…ime
 (
disksim
->
iŸø˚_öfo
->
ba£smÆ…ime
)

	)

113 
	#ba£simtime
 (
disksim
->
iŸø˚_öfo
->
ba£simtime
)

	)

114 
	#vÆid©e_œ°£rv
 (
disksim
->
iŸø˚_öfo
->
vÆid©e_œ°£rv
)

	)

115 
	#vÆid©e_œ°blkno
 (
disksim
->
iŸø˚_öfo
->
vÆid©e_œ°blkno
)

	)

116 
	#vÆid©e_œ°bcou¡
 (
disksim
->
iŸø˚_öfo
->
vÆid©e_œ°bcou¡
)

	)

117 
	#vÆid©e_œ°ªad
 (
disksim
->
iŸø˚_öfo
->
vÆid©e_œ°ªad
)

	)

118 
	#vÆid©e_√xtöãr
 (
disksim
->
iŸø˚_öfo
->
vÆid©e_√xtöãr
)

	)

119 
	#vÆid©e_bufÁ˘i⁄
 (
disksim
->
iŸø˚_öfo
->
vÆid©e_bufÁ˘i⁄
)

	)

120 
	#accumuœãd_evít_time
 (
disksim
->
iŸø˚_öfo
->
accumuœãd_evít_time
)

	)

121 
	#œ°ac˚s°ime
 (
disksim
->
iŸø˚_öfo
->
œ°ac˚s°ime
)

	)

126 
iŸø˚_£t_f‹m©
 (*
f‹m©«me
);

127 
iŸø˚_öôülize_fûe
 (
FILE
 *
åa˚fûe
, 
åa˚f‹m©
, 
¥öt_åa˚fûe_hódî
);

128 
i‹eq_evít
 * 
iŸø˚_gë_i‹eq_evít
 (
FILE
 *
åa˚fûe
, 
åa˚f‹m©
, i‹eq_evíà*
ãmp
);

129 
i‹eq_evít
 * 
iŸø˚_vÆid©e_gë_i‹eq_evít
(
FILE
 *
åa˚fûe
, i‹eq_evíà*
√w
);

130 
iŸø˚_¥öt°©s
 (
FILE
 *
outfûe
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_loadparams.c

35 
	~"c⁄fig.h
"

36 
	~"disksim_globÆ.h
"

37 
	~"disksim_iodrivî.h
"

38 
	~"disksim_disk.h
"

40 
	~"moduÀs/moduÀs.h
"

42 
	~<lib∑øm/lib∑øm.h
>

44 
	~<diskmodñ/moduÀs/moduÀs.h
>

45 
	~<memsmodñ/moduÀs/moduÀs.h
>

47 
	~<ssdmodñ/moduÀs/moduÀs.h
>

49 
	~<°dio.h
>

53 
	$disksim_t›ﬁﬂdî
(
Õ_t›o•ec
 *
ts
, 
Àn
) {

54 
rv
 = 
	`lﬂd_iodrivî_t›o
(
ts
, 
Àn
);

55 
	`ddbg_as£π2
(
rv
 != 0, "TopospecÜoad failed!");

56 
	}
}

59 
	$disksim_lﬂd∑øms
(*
öputfûe
, 
sy¡hgí
) {

60 
rv
;

61 
c
;

62 
Õ_ét
 **
éts
;

63 
éts_Àn
;

66 
c
 = 0; c <
DISKSIM_MAX_MODULE
; c++) {

67 
	`Õ_ªgi°î_moduÀ
(
disksim_mods
[
c
]);

71 
c
 = 0; c <
DM_MAX_MODULE
; c++) {

72 
	`Õ_ªgi°î_moduÀ
(
dm_mods
[
c
]);

76 
c
 = 0; c <
MEMSMODEL_MAX_MODULE
; c++) {

77 
	`Õ_ªgi°î_moduÀ
(
memsmodñ_mods
[
c
]);

81 
c
 = 0; c <
SSDMODEL_MAX_MODULE
; c++) {

82 
	`Õ_ªgi°î_moduÀ
(
ssdmodñ_mods
[
c
]);

85 
	`Õ_ªgi°î_t›ﬁﬂdî
(
disksim_t›ﬁﬂdî
);

90 
disksim
->
∑rfûe
 = 
	`f›í
(
öputfûe
,"r");

91 
	`ddbg_as£π2
(
disksim
->
∑rfûe
 !
NULL
,

93 
öputfûe
));

95 
	`Õ_öô_ty≥tbl
();

97 
rv
 = 
	`Õ_lﬂdfûe
(
disksim
->
∑rfûe
,

98 &
éts
,

99 &
éts_Àn
,

100 
öputfûe
,

101 
disksim
->
ovîrides
,

102 
disksim
->
ovîrides_Àn
);

104 
	`Õ_u≈¨£_éts
(
éts
, 
éts_Àn
, 
ouçutfûe
, 
öputfûe
);

106 
	`Õ_ö°™tüã
("Global", "Global");

107 
	`Õ_ö°™tüã
("Stats", "Stats");

110 
c
 = 0; c < 
Õ_ty≥tbl_Àn
; c++) {

111 if(
Õ_ty≥tbl
[
c
] !0 && (Õ_ty≥tbl[c]->
•ec
 != 0)) {

112 if(!
	`°rcmp
(
	`Õ_lookup_ba£_ty≥
(
Õ_ty≥tbl
[
c
]->
sub
, 0), "disksim_logorg")) {

113 
	`iodrivî_lﬂd_log‹g
(
Õ_ty≥tbl
[
c
]->
•ec
);

116 if(!
	`°rcmp
(
	`Õ_lookup_ba£_ty≥
(
Õ_ty≥tbl
[
c
]->
sub
, 0), "disksim_syncset")) {

117 
	`disk_lﬂd_sync£ts
(
Õ_ty≥tbl
[
c
]->
•ec
);

123 if(
sy¡hgí
) {

124 
	`Õ_ö°™tüã
("Proc", "Proc");

125 
	`Õ_ö°™tüã
("Synthio", "Synthio");

129 
	`f˛o£
(
disksim
->
∑rfûe
);

130  
rv
;

131 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_logorg.c

101 
	~<î∫o.h
>

102 
	~<°rög.h
>

104 
	~"disksim_log‹g.h
"

105 
	~"moduÀs/moduÀs.h
"

107 
	#MAX_QUEUE_LENGTH
 10000

	)

111 *
	g°©desc_öèº
 = "Inter-arrivalÅime";

112 *
	g°©desc_ªadöèº
 = "Read inter-arrival";

113 *
	g°©desc_wrôeöèº
 = "Write inter-arrival";

114 *
	g°©desc_ªqsize
 = "Request size";

115 *
	g°©desc_ªadsize
 = "ReadÑequest size";

116 *
	g°©desc_wrôesize
 = "WriteÑequest size";

117 *
	g°©desc_idÀs
 = "IdleÖeriodÜength";

118 *
	g°©desc_ª•time
 = "ResponseÅime";

119 *
	g°©desc_°ªak
 = "StreakÜength";

120 *
	g°©desc_loˇlôy
 = "Inter-request distance";

123 
	$log‹g_ovîœp
 (
log‹g
 *
cuºlog‹g
, 
devno
, 
i‹eq_evít
 *
cuº
, 
blk•î∑π
)

125 
ˇlc
;

127 
ˇlc
 = 
cuº
->
blkno
 - 
cuºlog‹g
->
devs
[
devno
].
°¨tblkno
;

128 i‡((
ˇlc
 >0Ë&& (ˇl¯< 
blk•î∑π
)) {

129 
cuº
->
devno
 = devno;

130 
cuº
->
blkno
 = 
ˇlc
;

131 (
TRUE
);

133 (
FALSE
);

134 
	}
}

137 
	$log‹g_°ªak°©
 (
log‹g
 *
cuºlog‹g
, 
diskno
)

139 
œ°
 = 
cuºlog‹g
->
œ°diskac˚s£d
;

140 
log‹gdev
 *
devs
 = 
cuºlog‹g
->devs;

142 i‡(
cuºlog‹g
->
¥öt°ªak°©s
 =
FALSE
) {

146 
	`ASSERT1
((
diskno
 >0Ë&& (disknÿ<
cuºlog‹g
->
a˘uÆnumdisks
), "diskno", diskno);

147 i‡(
diskno
 =
œ°
) {

148 i‡(
diskno
 !
cuºlog‹g
->
a˘uÆnumdisks
) {

149 
devs
[
diskno
].
cur°ªak
++;

153 i‡(
œ°
 !
cuºlog‹g
->
a˘uÆnumdisks
) {

154 
	`°©_upd©e
(&
devs
[
œ°
].
°ªak°©s
, (Ëdevs[œ°].
cur°ªak
);

155 
devs
[
œ°
].
cur°ªak
 = 0;

157 
cuºlog‹g
->
œ°diskac˚s£d
 = 
diskno
;

158 i‡(
diskno
 !
cuºlog‹g
->
a˘uÆnumdisks
) {

159 
devs
[
diskno
].
cur°ªak
 = 1;

161 
	}
}

164 
	$log‹g_upd©e_öèº_°©s
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
)

166 
tdiff
;

168 i‡(
cuºlog‹g
->
¥ötöèº°©s
 =
FALSE
) {

172 
tdiff
 = 
simtime
 - 
cuºlog‹g
->
°©
.
œ°¨r
;

173 
	`°©_upd©e
(&
cuºlog‹g
->
°©
.
öèº°©s
, 
tdiff
);

174 
cuºlog‹g
->
°©
.
œ°¨r
 = 
simtime
;

175 i‡(
cuº
->
Êags
 & 
READ
) {

176 
tdiff
 = 
simtime
 - 
cuºlog‹g
->
°©
.
œ°ªad
;

177 
	`°©_upd©e
(&
cuºlog‹g
->
°©
.
ªadöèº°©s
, 
tdiff
);

178 
cuºlog‹g
->
°©
.
œ°ªad
 = 
simtime
;

180 
tdiff
 = 
simtime
 - 
cuºlog‹g
->
°©
.
œ°wrôe
;

181 
	`°©_upd©e
(&
cuºlog‹g
->
°©
.
wrôeöèº°©s
, 
tdiff
);

182 
cuºlog‹g
->
°©
.
œ°wrôe
 = 
simtime
;

184 
	}
}

187 
	$log‹g_upd©e_öãr„ª_°©s
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
)

189 
i
;

190 
fú°
;

191 *
œ°ªq
 = 
cuºlog‹g
->
°©
.lastreq;

192 
diffblkno
;

194 i‡(
cuºlog‹g
->
¥ötöãr„ª°©s
 =
FALSE
) {

198 
fú°
 = 
	`°©_gë_cou¡
(&
cuºlog‹g
->
°©
.
öèº°©s
Ë% 
INTERFEREMAX
;

199 
fú°
 = (
INTERFEREMAX
 - first) % INTERFEREMAX;

200 
i
=0; i<
INTERFEREMAX
; i++) {

201 i‡(
cuº
->
devno
 =
œ°ªq
[(((
i
+
fú°
)%
INTERFEREMAX
) << 1)]) {

202 
diffblkno
 = 
cuº
->
blkno
 - 
œ°ªq
[((((
i
+
fú°
)%
INTERFEREMAX
) << 1) + 1)];

203 i‡(!
diffblkno
) {

204 
cuºlog‹g
->
°©
.
ötdi°
[(
i
*
INTDISTMAX
)]++;

205 
i
 = -1;

210 i‡(
i
 != -1) {

211 
i
=0; i<
INTERFEREMAX
; i++) {

212 i‡(
cuº
->
devno
 =
œ°ªq
[(((
i
+
fú°
)%
INTERFEREMAX
) << 1)]) {

213 
diffblkno
 = 
cuº
->
blkno
 - 
œ°ªq
[((((
i
+
fú°
)%
INTERFEREMAX
) << 1) + 1)];

214 i‡((
diffblkno
 <= 64) && (diffblkno >= -64)) {

215 i‡(
diffblkno
 < 0) {

216 i‡(
diffblkno
 >= -4) {

217 
cuºlog‹g
->
°©
.
ötdi°
[((
i
*
INTDISTMAX
)+1)]++;

218 } i‡(
diffblkno
 >= -8) {

219 
cuºlog‹g
->
°©
.
ötdi°
[((
i
*
INTDISTMAX
)+2)]++;

220 } i‡(
diffblkno
 >= -16) {

221 
cuºlog‹g
->
°©
.
ötdi°
[((
i
*
INTDISTMAX
)+3)]++;

222 } i‡(
diffblkno
 >= -64) {

223 
cuºlog‹g
->
°©
.
ötdi°
[((
i
*
INTDISTMAX
)+4)]++;

226 i‡(
diffblkno
 <= 8) {

227 
cuºlog‹g
->
°©
.
ötdi°
[((
i
*
INTDISTMAX
)+5)]++;

228 } i‡(
diffblkno
 <= 16) {

229 
cuºlog‹g
->
°©
.
ötdi°
[((
i
*
INTDISTMAX
)+6)]++;

230 } i‡(
diffblkno
 <= 64) {

231 
cuºlog‹g
->
°©
.
ötdi°
[((
i
*
INTDISTMAX
)+7)]++;

239 
fú°
 = ((fú° - 1Ë% 
INTERFEREMAX
) << 1;

241 if(
fú°
 >= 0) {

242 
œ°ªq
[
fú°
] = 
cuº
->
devno
;

243 
œ°ªq
[(
fú°
 + 1)] = 
cuº
->
blkno
 + cuº->
bcou¡
;

245 
	}
}

248 
	$log‹g_upd©e_blockög_°©s
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
)

250 
i
;

251 
maxvÆ
;

253 i‡(
cuºlog‹g
->
¥ötblockög°©s
 =
FALSE
) {

257 
maxvÆ
 = 
	`mö
(
BLOCKINGMAX
, 
cuº
->
bcou¡
);

258 
i
=0; i<
maxvÆ
; i++) {

259 i‡((
cuº
->
bcou¡
 % (
i
+1)) == 0) {

260 
cuºlog‹g
->
°©
.
blocked
[
i
]++;

263 
maxvÆ
 = 
	`mö
(
BLOCKINGMAX
, 
cuº
->
blkno
);

264 
i
=0; i<
maxvÆ
; i++) {

265 i‡((
cuº
->
blkno
 % (
i
+1)) == 0) {

266 
cuºlog‹g
->
°©
.
Æig√d
[
i
]++;

269 
	}
}

272 
	$log‹g_numoutdi°
 (
numout
, *
di°
)

274 
i
 = 
	`mö
(
numout
, 9);

275 
	`ASSERT
(
numout
 >= 0);

276 
di°
[
i
]++;

277 
	}
}

280 
	$log‹g_diffdi°
 (
mydiff
, *
di°
)

282 
i
;

284 i‡(
mydiff
 < () 0.5) {

285 
i
 = 0;

286 } i‡(
mydiff
 < () 1.0) {

287 
i
 = 1;

288 } i‡(
mydiff
 < () 1.5) {

289 
i
 = 2;

290 } i‡(
mydiff
 < () 2.0) {

291 
i
 = 3;

292 } i‡(
mydiff
 < () 2.5) {

293 
i
 = 4;

294 } i‡(
mydiff
 < () 3.0) {

295 
i
 = 5;

296 } i‡(
mydiff
 < () 4.0) {

297 
i
 = 6;

298 } i‡(
mydiff
 < () 5.0) {

299 
i
 = 7;

300 } i‡(
mydiff
 < () 6.0) {

301 
i
 = 8;

303 
i
 = 9;

305 
di°
[
i
]++;

306 
	}
}

309 
	$log‹g_m≠ªque°_upd©e_°©s
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
out°™d
 *
ªq
, 
numªqs
)

311 
i
;

312 
i‹eq_evít
 *
ãmp
;

313 
gí
;

314 
çass
;

315 
log‹gdev
 *
cuºdev
;

316 
‹gdevno
 = 
cuº
->
devno
 - 
cuºlog‹g
->
devs
[0].devno;

320 
cuºdev
 = &
cuºlog‹g
->
devs
[
‹gdevno
];

321 
	`log‹g_upd©e_öãr„ª_°©s
(
cuºlog‹g
, 
cuº
);

322 
	`log‹g_upd©e_öèº_°©s
(
cuºlog‹g
, 
cuº
);

323 
	`log‹g_upd©e_blockög_°©s
(
cuºlog‹g
, 
cuº
);

325 i‡(
cuºlog‹g
->
¥ötsize°©s
) {

326 
	`°©_upd©e
(&
cuºlog‹g
->
°©
.
size°©s
, (Ë
cuº
->
bcou¡
);

327 i‡(
cuº
->
Êags
 & 
READ
) {

328 
	`°©_upd©e
(&
cuºlog‹g
->
°©
.
ªadsize°©s
, (Ë
cuº
->
bcou¡
);

330 
	`°©_upd©e
(&
cuºlog‹g
->
°©
.
wrôesize°©s
, (Ë
cuº
->
bcou¡
);

333 i‡(
cuº
->
Êags
 & 
TIME_CRITICAL
) {

334 i‡(
cuº
->
Êags
 & 
READ
) {

335 
cuºlog‹g
->
°©
.
¸ôªads
++;

337 
cuºlog‹g
->
°©
.
¸ôwrôes
++;

340 
	`°©_upd©e
(&
cuºdev
->
loˇlôy°©s
, (Ë(cuºdev->
œ°blkno
 - 
cuº
->
blkno
));

341 i‡((
cuº
->
blkno
 > 
cuºdev
->
œ°blkno
Ë&& (cuº->blknÿ<cuºdev->
œ°blkno2
)) {

342 i‡(
cuº
->
Êags
 & 
READ
) {

343 
cuºdev
->
öåóds
++;

345 
cuºdev
->
ötwrôes
++;

348 
cuºdev
->
œ°blkno2
 = 
cuº
->
blkno
 + cuº->
bcou¡
 + 16;

349 i‡(
cuº
->
blkno
 =
cuºdev
->
œ°blkno
) {

350 i‡(
cuº
->
Êags
 & 
READ
) {

351 
cuºdev
->
£qªads
++;

353 
cuºdev
->
£qwrôes
++;

356 
cuºdev
->
œ°blkno
 = 
cuº
->
blkno
 + cuº->
bcou¡
;

357 
gí
 = 
cuº
->
ˇu£
;

358 i‡(
cuº
->
Êags
 & 
SEQ
) {

359 i‡(
cuº
->
Êags
 & 
READ
) {

360 
cuºlog‹g
->
°©
.
£qªads
++;

362 
cuºlog‹g
->
°©
.
£qwrôes
++;

364 i‡(
cuºlog‹g
->
°©
.
gís
[
gí
] !
cuº
->
devno
) {

365 
cuºlog‹g
->
°©
.
£qdiskswôches
++;

366 
cuº
->
Êags
 &~
SEQ
;

369 i‡(
cuº
->
Êags
 & 
LOCAL
) {

370 
cuºlog‹g
->
°©
.
numloˇl
++;

371 i‡(
cuºlog‹g
->
°©
.
gís
[
gí
] !
cuº
->
devno
) {

372 
cuºlog‹g
->
°©
.
locdiskswôches
++;

373 
cuº
->
Êags
 &~
LOCAL
;

376 
cuºlog‹g
->
°©
.
gís
[
gí
] = 
cuº
->
devno
;

377 
	`log‹g_°ªak°©
(
cuºlog‹g
, 
‹gdevno
);

381 
ãmp
 = 
cuº
;

382 
i
=0; i<
numªqs
; i++) {

383 
cuºlog‹g
->
devs
[(
ãmp
->
devno
 - cuºlog‹g->devs[0].devno)].
numout
++;

384 
ãmp
 =Åemp->
√xt
;

387 i‡(
cuºlog‹g
->
°©
.
out°™dög
 > 0) {

388 
cuºlog‹g
->
°©
.
n⁄zîoouâime
 +
simtime
 - cuºlog‹g->°©.
ouâime
;

390 
çass
 = 
simtime
 - 
cuºlog‹g
->
°©
.
idÀ°¨t
;

391 
	`°©_upd©e
(&
cuºlog‹g
->
°©
.
idÀ°©s
, 
çass
);

393 
cuºlog‹g
->
°©
.
idÀ°¨t
 = 
simtime
;

394 
cuºlog‹g
->
°©
.
runouâime
 +(Ëcuºlog‹g->°©.
out°™dög
 * (
simtime
 - cuºlog‹g->°©.
ouâime
);

395 
cuºlog‹g
->
°©
.
out°™dög
++;

396 i‡(
cuºlog‹g
->
°©
.
out°™dög
 >
MAX_QUEUE_LENGTH
) {

397 
	`Ârötf
(
°dîr
,"St›pög simuœti⁄ beˇu£ o‡ßtuøti⁄: simtimê%f,ÅŸÆªq†%d\n", 
simtime
, 
disksim
->
tŸÆªqs
);

398 
	`fÊush
(
°dîr
);

399 
	`Ârötf
 (
ouçutfûe
, "St›pög simuœti⁄ beˇu£ o‡ßtuøti⁄: simtimê%f,ÅŸÆªq†%d\n", 
simtime
, 
disksim
->
tŸÆªqs
);

400 
	`Ârötf
 (
ouçutfûe
, "œ°Ñeque°: dev=%d, blk=%d, c¡=%d, %d (R==1)\n",
cuº
->
devno
, cuº->
blkno
, cuº->
bcou¡
, (cuº->
Êags
 & 
READ
));

401 
	`disksim_sim°›
();

403 i‡(
ªq
->
Êags
 & 
READ
) {

404 
cuºlog‹g
->
°©
.
ªadout°™dög
++;

406 i‡(
cuºlog‹g
->
°©
.
out°™dög
 > cuºlog‹g->°©.
maxout°™dög
) {

407 
cuºlog‹g
->
°©
.
maxout°™dög
 = cuºlog‹g->°©.
out°™dög
;

409 
cuºlog‹g
->
°©
.
ouâime
 = 
simtime
;

413 
	}
}

416 
	$log‹g_m≠com∂ëe_upd©e_°©s
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
out°™d
 *
ªq
)

418 
	`°©_upd©e
(&
cuºlog‹g
->
°©
.
ª•time°©s
, (
simtime
 - 
ªq
->
¨πime
));

419 
cuºlog‹g
->
°©
.
n⁄zîoouâime
 +
simtime
 - cuºlog‹g->°©.
ouâime
;

420 
cuºlog‹g
->
°©
.
runouâime
 +cuºlog‹g->°©.
out°™dög
 * (
simtime
 - cuºlog‹g->°©.
ouâime
);

421 
cuºlog‹g
->
°©
.
out°™dög
--;

422 i‡(
ªq
->
Êags
 & 
READ
) {

423 
cuºlog‹g
->
°©
.
ªadout°™dög
--;

425 
cuºlog‹g
->
°©
.
ouâime
 = 
simtime
;

426 
	}
}

429 
	$log‹g_time°amp
 (
i‹eq_evít
 *
cuº
)

431 
log‹g
 *
cuºlog‹g
 = (log‹g *Ë
cuº
->
ãmµå1
;

432 
avgqÀn
 = 0.0;

433 
avgdiff
 = 0.0;

434 
maxqÀn
 = 0;

435 
maxdiff
 = 0.0;

436 
i
;

437 
ˇlc
;

439 
cuº
->
time
 +
cuºlog‹g
->
°ampöãrvÆ
;

440 i‡(
cuº
->
time
 > 
cuºlog‹g
->
°amp°›
) {

441 
	`addt€xåaq
((
evít
 *Ë
cuº
);

443 
	`addtoötq
((
evít
 *Ë
cuº
);

445 
ˇlc
 = (Ë
cuºlog‹g
->
a˘uÆnumdisks
;

446 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

447 
	`log‹g_numoutdi°
(
cuºlog‹g
->
devs
[
i
].
numout
, cuºlog‹g->devs[i].
di°numout
);

448 i‡(
cuºlog‹g
->
°ampfûe
) {

449 
	`Ârötf
(
cuºlog‹g
->
°ampfûe
, "%d ", cuºlog‹g->
devs
[
i
].
numout
);

451 
avgqÀn
 +(Ë
cuºlog‹g
->
devs
[
i
].
numout
;

452 i‡(
cuºlog‹g
->
devs
[
i
].
numout
 > 
maxqÀn
) {

453 
maxqÀn
 = 
cuºlog‹g
->
devs
[
i
].
numout
;

456 i‡(
cuºlog‹g
->
°ampfûe
) {

457 
	`Ârötf
(
cuºlog‹g
->
°ampfûe
, "\n");

459 
avgqÀn
 =ávgqÀ¿/ 
ˇlc
;

460 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

461 i‡(
avgqÀn
 > (Ë
cuºlog‹g
->
devs
[
i
].
numout
) {

462 
avgdiff
 +(
avgqÀn
 - (Ë
cuºlog‹g
->
devs
[
i
].
numout
);

464 
avgdiff
 +((Ë
cuºlog‹g
->
devs
[
i
].
numout
 - 
avgqÀn
);

466 
maxdiff
 +(Ë(
maxqÀn
 - 
cuºlog‹g
->
devs
[
i
].
numout
);

468 
	`log‹g_diffdi°
((
avgdiff
 / 
ˇlc
), 
cuºlog‹g
->
°©
.
di°avgdiff
);

469 
	`log‹g_diffdi°
((
maxdiff
 / 
ˇlc
), 
cuºlog‹g
->
°©
.
di°maxdiff
);

470 
	}
}

473 
	$log‹g_add√wtoout°™dq
 (
log‹g
 *
cuºlog‹g
, 
out°™d
 *
ãmp
)

475 
out°™d
 *
run
 = 
NULL
;

477 
ãmp
->
√xt
 = 
NULL
;

478 
run
 = 
cuºlog‹g
->
hashout°™d
[(
ãmp
->
›id
 % 
HASH_OUTSTAND
)];

479 i‡(
run
 =
NULL
) {

480 
cuºlog‹g
->
hashout°™d
[(
ãmp
->
›id
 % 
HASH_OUTSTAND
)] =Åemp;

482 
run
->
√xt
 !
NULL
)

483 
run
 =Ñun->
√xt
;

484 
run
->
√xt
 = 
ãmp
;

486 
cuºlog‹g
->
out°™dqÀn
++;

487 
	}
}

490 
	$log‹g_addtoout°™dq
 (
log‹g
 *
cuºlog‹g
, 
out°™d
 *
ãmp
)

492 
ãmp
->
√xt
 = 
cuºlog‹g
->
hashout°™d
[—emp->
›id
 % 
HASH_OUTSTAND
)];

493 
cuºlog‹g
->
hashout°™d
[(
ãmp
->
›id
 % 
HASH_OUTSTAND
)] =Åemp;

494 
cuºlog‹g
->
out°™dqÀn
++;

495 
	}
}

498 
out°™d
 *
	$log‹g_show_buf_‰om_out°™dq
 (
log‹g
 *
cuºlog‹g
, *
buf
, 
›id
)

500 
i
;

501 
out°™d
 *
tmp
;

503 
i
=0; i<
HASH_OUTSTAND
; i++) {

504 
tmp
 = 
cuºlog‹g
->
hashout°™d
[
i
];

505 (
tmp
Ë&& (—mp->
buf
 !bufË|| ((
›id
 !-1Ë&& (tmp->
ªq›id
 != opid)))) {

506 
tmp
 =Åmp->
√xt
;

508 i‡(
tmp
) {

509 (
tmp
);

512 (
NULL
);

513 
	}
}

516 
out°™d
 * 
	$log‹g_gë‰omout°™dq
 (
log‹g
 *
cuºlog‹g
, 
ªque°no
)

518 
out°™d
 *
ãmp
 = 
NULL
;

519 
out°™d
 *
hﬁd
 = 
NULL
;

520 
i
;

522 i‡(
ªque°no
 == -1) {

523 
i
=0; i<
HASH_OUTSTAND
; i++) {

524 i‡(
cuºlog‹g
->
hashout°™d
[
i
] !
NULL
) {

525 
ãmp
 = 
cuºlog‹g
->
hashout°™d
[
i
];

526 
cuºlog‹g
->
hashout°™d
[
i
] = 
ãmp
->
√xt
;

527 
cuºlog‹g
->
out°™dqÀn
--;

528 (
ãmp
);

533 
ãmp
 = 
cuºlog‹g
->
hashout°™d
[(
ªque°no
 % 
HASH_OUTSTAND
)];

534 i‡(
ãmp
 =
NULL
)

535 (
NULL
);

536 i‡(
ãmp
->
›id
 =
ªque°no
) {

537 
cuºlog‹g
->
out°™dqÀn
--;

538 
cuºlog‹g
->
hashout°™d
[(
ªque°no
 % 
HASH_OUTSTAND
)] = 
ãmp
->
√xt
;

540 
ãmp
->
√xt
 !
NULL
) {

541 i‡(
ãmp
->
√xt
->
›id
 =
ªque°no
) {

542 
hﬁd
 = 
ãmp
->
√xt
;

543 
ãmp
->
√xt
 =Åemp->next->next;

544 
cuºlog‹g
->
out°™dqÀn
--;

545 (
hﬁd
);

547 
ãmp
 =Åemp->
√xt
;

549 
ãmp
 = 
NULL
;

551 (
ãmp
);

552 
	}
}

555 
	$log‹g_m≠idól
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
)

557 
cuº
->
devno
 = 
cuºlog‹g
->
idó o
;

558 
cuº
->
blkno
 = -1;

559 
cuºlog‹g
->
idó o
 = (cuºlog‹g->idó ÿ+ 1Ë% cuºlog‹g->
numdisks
;

560 
cuº
->
√xt
 = curr;

561 
	}
}

564 
	$log‹g_m≠øndom
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
)

566 
cuº
->
devno
 = ()(()
cuºlog‹g
->
numdisks
 * 
	`DISKSIM_dønd48
());

567 
cuº
->
blkno
 = -1;

568 
cuº
->
√xt
 = curr;

569 
	}
}

572 
	$log‹g_m≠öãæóved
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
)

574 
numdisks
;

575 
blkno
;

576 
i
;

577 
i‹eq_evít
 *
ãmp
;

579 
numdisks
 = 
cuºlog‹g
->numdisks;

580 
blkno
 = 
cuº
->blknÿ/ 
numdisks
;

581 
cuº
->
bcou¡
 +cuº->
blkno
 - (blknÿ* 
numdisks
);

582 
cuº
->
bcou¡
 = (cuº->bcou¡ + 
numdisks
 - 1) /Çumdisks;

583 
cuº
->
blkno
 = blkno;

584 
cuº
->
devno
 = 0;

585 
ãmp
 = 
cuº
;

586 
i
 = 1; i < 
numdisks
; i++) {

587 
ãmp
->
√xt
 = 
	`i‹eq_c›y
(
cuº
);

588 
ãmp
->
√xt
->
devno
 = 
i
;

589 
ãmp
 =Åemp->
√xt
;

591 
ãmp
->
√xt
 = 
cuº
;

592 (
numdisks
);

593 
	}
}

596 
	$log‹g_m≠°rùed
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
)

598 
numdisks
;

599 
°rùeunô
;

600 
unôno
;

601 
°rùío
;

602 
ªqsize
;

603 
num°rùes
 = 2;

604 
numªqs
 = 1;

605 
°¨t¶›
;

606 
devno
;

607 
°¨tdevno
;

608 
i‹eq_evít
 *
√wªq
;

609 
i‹eq_evít
 *
ãmp
;

610 
blkno
;

611 
i
;

612 
œ°
 = 
FALSE
;

614 
numdisks
 = 
cuºlog‹g
->numdisks;

615 
°rùeunô
 = 
cuºlog‹g
->stripeunit;

617 
ãmp
 = 
cuº
;

618 i‡(
cuºlog‹g
->
addrby∑πs
) {

619 
cuº
->
blkno
 = (cuº->
devno
 * 
cuºlog‹g
->
blk•î∑π
) + curr->blkno;

621 i‡(
°rùeunô
 == 0) {

622 (
	`log‹g_m≠öãæóved
(
cuºlog‹g
, 
cuº
));

624 
unôno
 = 
cuº
->
blkno
 / 
°rùeunô
;

625 
°rùío
 = 
unôno
 / 
numdisks
;

626 i‡(
°rùío
 =
cuºlog‹g
->
numfuŒ
) {

627 
œ°
 = 
TRUE
;

628 
°rùeunô
 = 
cuºlog‹g
->
blk•î∑π
 - (cuºlog‹g->
numfuŒ
 * stripeunit);

629 
unôno
 = 
°rùío
 * 
numdisks
;

630 
unôno
 +(
cuº
->
blkno
 - (unônÿ* 
cuºlog‹g
->
°rùeunô
)) / stripeunit;

631 
cuº
->
blkno
 -
°rùío
 * 
numdisks
 * 
cuºlog‹g
->
°rùeunô
;

633 
devno
 = 
unôno
 % 
numdisks
;

634 
cuº
->
devno
 = devno;

635 
cuº
->
blkno
 = cuº->blknÿ% 
°rùeunô
;

636 
°¨t¶›
 = 
°rùeunô
 - 
cuº
->
blkno
;

637 
cuº
->
blkno
 +
°rùío
 * 
cuºlog‹g
->
°rùeunô
;

638 i‡(
°¨t¶›
 < 
cuº
->
bcou¡
) {

639 
blkno
 = 
°rùío
 * 
cuºlog‹g
->
°rùeunô
;

640 
i
=0; i<
numdisks
; i++) {

641 
cuºlog‹g
->
sizes
[
i
] = 0;

643 
cuºlog‹g
->
sizes
[
devno
] = 
°¨t¶›
;

644 
ªqsize
 = 
cuº
->
bcou¡
 - 
°¨t¶›
;

648 
°¨tdevno
 = 
devno
;

649 
devno
++;

650 i‡(
devno
 =
numdisks
) {

651 
devno
 = 0;

652 
°rùío
++;

653 i‡(
°rùío
 =
cuºlog‹g
->
numfuŒ
) {

654 
°rùeunô
 = 
cuºlog‹g
->
blk•î∑π
 - (
°rùío
 * stripeunit);

657 
ªqsize
 > 
°rùeunô
) {

658 
cuºlog‹g
->
sizes
[
devno
] +
°rùeunô
;

659 
num°rùes
++;

660 
devno
++;

661 
ªqsize
 -
°rùeunô
;

662 i‡(
devno
 =
numdisks
) {

663 
devno
 = 0;

664 
°rùío
++;

665 i‡(
°rùío
 =
cuºlog‹g
->
numfuŒ
) {

666 
°rùeunô
 = 
cuºlog‹g
->
blk•î∑π
 - (
°rùío
 * stripeunit);

670 
cuºlog‹g
->
sizes
[
devno
] +
ªqsize
;

671 
cuº
->
bcou¡
 = 
cuºlog‹g
->
sizes
[
°¨tdevno
];

672 
numªqs
 = 
	`mö
(
num°rùes
, 
numdisks
);

673 
i
 = (
°¨tdevno
 + 1); i < (°¨tdevnÿ+ 
numªqs
); i++) {

674 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

675 
√wªq
->
devno
 = 
i
 % 
numdisks
;

676 
√wªq
->
time
 = 
cuº
->time;

677 
√wªq
->
blkno
 = blknÿ+ (
	`wøp
(
°¨tdevno
,Çewªq->
devno
Ë* 
cuºlog‹g
->
°rùeunô
);

678 
√wªq
->
bu¢o
 = 
cuº
->busno & 0x0000FFFF;

679 
√wªq
->
bcou¡
 = 
cuºlog‹g
->
sizes
[(
i
 % 
numdisks
)];

680 
√wªq
->
Êags
 = 
cuº
->flags;

681 
√wªq
->
√xt
 = 
NULL
;

682 
√wªq
->
¥ev
 = 
NULL
;

683 
√wªq
->
ty≥
 = 
cuº
->type;

684 
√wªq
->
›id
 = 
cuº
->opid;

685 
√wªq
->
buf
 = 
cuº
->buf;

686 
ãmp
->
√xt
 = 
√wªq
;

687 
ãmp
 = 
√wªq
;

690 
ãmp
->
√xt
 = 
cuº
;

691 (
numªqs
);

692 
	}
}

695 
	$log‹g_m≠ªque°
 (
log‹g
 **
log‹gs
, 
numlog‹gs
, 
i‹eq_evít
 *
cuº
)

697 
numªqs
 = 1;

698 
m≠ty≥
;

699 
ªdu¡y≥
;

700 
log‹gno
 = -1;

701 
i
, 
j
;

702 
out°™d
 *
ªq
 = 
NULL
;

703 
i‹eq_evít
 *
ãmp
;

704 
‹gdevno
;

710 
	`ASSERT1
((
numlog‹gs
 >1Ë&& (numlog‹g†< 
MAXLOGORGS
), "numlogorgs",Çumlogorgs);

712 i‡(
cuº
->
Êags
 & 
MAPPED
) {

713 
cuº
->
Êags
 &~
MAPPED
;

714 
cuº
->
√xt
 = 
NULL
;

717 
ªq
 = (
out°™d
 *Ë
	`gë‰omexåaq
();

718 
	`ASSERT
 (
ªq
 !
NULL
);

719 
ªq
->
¨πime
 = 
simtime
;

720 
ªq
->
bcou¡
 = 
cuº
->bcount;

721 
ªq
->
blkno
 = 
cuº
->blkno;

722 
ªq
->
devno
 = 
cuº
->devno;

723 
ªq
->
Êags
 = 
cuº
->flags;

724 
ªq
->
bu¢o
 = 
cuº
->busno;

725 
ªq
->
buf
 = 
cuº
->buf;

726 
ªq
->
ªq›id
 = 
cuº
->
›id
;

727 
ªq
->
dïíd
 = 
NULL
;

729 
i
 = 0; i < 
numlog‹gs
; i++) {

731 i‡(!
log‹gs
[
i
]->
addrby∑πs
) {

732 i‡((
cuº
->
devno
 =
log‹gs
[
i
]->
¨øydisk
)

733 && ((
cuº
->
blkno
 + cuº->
bcou¡
) <

734 (
log‹gs
[
i
]->
blk•î∑π
 *Üog‹gs[i]->
numdisks
))

735 && (
cuº
->
blkno
 >= 0))

738 
log‹gno
 = 
i
;

745 
j
 = 0; j < 
log‹gs
[
i
]->
a˘uÆnumdisks
; j++) {

746 i‡(
cuº
->
devno
 =
log‹gs
[
i
]->
devs
[
j
].devno) {

747 if(
	`log‹g_ovîœp
(
log‹gs
[
i
], 
j
, 
cuº
,Üog‹gs[i]->
blk•î∑π
)) {

748 
log‹gno
 = 
i
;

753 i‡(
log‹gno
 != -1) {

760 i‡(
log‹gno
 == -1) {

761 
	`Ârötf
 (
°dîr
, "u√x≥˘edÑeque°Üoˇti⁄: devnÿ%x, blknÿ%d, bcou¡ %d\n", 
cuº
->
devno
, cuº->
blkno
, cuº->
bcou¡
);

763 
	`ASSERT
(
log‹gno
 != -1);

764 
m≠ty≥
 = 
log‹gs
[
log‹gno
]->maptype;

765 
ªdu¡y≥
 = 
log‹gs
[
log‹gno
]->reduntype;

767 
cuº
->
›id
 = 
log‹gs
[
log‹gno
]->opid;

768 
ªq
->
›id
 = 
log‹gs
[
log‹gno
]->opid;

769 
cuº
->
√xt
 = 
NULL
;

770 
cuº
->
¥ev
 = 
NULL
;

772 i‡(
m≠ty≥
 =
ASIS
) {

773 
cuº
->
√xt
 = curr;

775 i‡(
m≠ty≥
 =
IDEAL
) {

776 
	`log‹g_m≠idól
(
log‹gs
[
log‹gno
], 
cuº
);

778 i‡(
m≠ty≥
 =
RANDOM
) {

779 
	`log‹g_m≠øndom
(
log‹gs
[
log‹gno
], 
cuº
);

781 i‡(
m≠ty≥
 =
STRIPED
) {

782 
numªqs
 = 
	`log‹g_m≠°rùed
(
log‹gs
[
log‹gno
], 
cuº
);

784 
	`Ârötf
(
°dîr
, "Unknow¿m≠ty≥ i¿u£áàlog‹g_m≠ªque° - %d\n", 
m≠ty≥
);

785 
	`exô
(1);

788 i‡(
ªdu¡y≥
 =
NO_REDUN
) {

790 i‡(
ªdu¡y≥
 =
SHADOWED
) {

791 
numªqs
 = 
	`log‹g_shadowed
(
log‹gs
[
log‹gno
], 
cuº
,Çumreqs);

793 i‡(
ªdu¡y≥
 =
PARITY_DISK
) {

794 
numªqs
 = 
	`log‹g_∑rôy_disk
(
log‹gs
[
log‹gno
], 
cuº
,Çumreqs);

796 i‡(
ªdu¡y≥
 =
PARITY_ROTATED
) {

797 
numªqs
 = 
	`log‹g_∑rôy_rŸ©e
(
log‹gs
[
log‹gno
], 
cuº
,Çumreqs);

799 i‡(
ªdu¡y≥
 =
PARITY_TABLE
) {

800 
numªqs
 = 
	`log‹g_∑rôy_èbÀ
(
log‹gs
[
log‹gno
], 
cuº
,Çumreqs);

803 
	`Ârötf
(
°dîr
, "Unknow¿ªdu¡y≥ i¿u£áàlog‹g_m≠ªque° - %d\n", 
ªdu¡y≥
);

804 
	`exô
(1);

809 
‹gdevno
 = 
cuº
->
devno
;

810 
ªq
->
dïíd
 = (
dïíds
 *Ë
cuº
->
¥ev
;

811 
cuº
->
blkno
 +
log‹gs
[
log‹gno
]->
devs
[
‹gdevno
].
°¨tblkno
;

812 
cuº
->
devno
 = 
log‹gs
[
log‹gno
]->
devs
[
‹gdevno
].devno;

813 
ãmp
 = 
cuº
->
√xt
;

814 
i
 = 1;

815 
ãmp
 !
cuº
) {

816 
ãmp
->
blkno
 +
log‹gs
[
log‹gno
]->
devs
[—emp->
devno
)].
°¨tblkno
;

817 
ãmp
->
devno
 = 
log‹gs
[
log‹gno
]->
devs
[(temp->devno)].devno;

818 
ãmp
->
›id
 = 
cuº
->opid;

819 
ãmp
 =Åemp->
√xt
;

820 
i
++;

822 
ªq
->
numªqs
 =Çumreqs;

823 
	`log‹g_add√wtoout°™dq
(
log‹gs
[
log‹gno
], 
ªq
);

824 
log‹gs
[
log‹gno
]->
›id
++;

825 
	`log‹g_m≠ªque°_upd©e_°©s
(
log‹gs
[
log‹gno
], 
cuº
, 
ªq
, 
i
);

829 (
i
);

830 
	}
}

833 
	$log‹g_m≠com∂ëe
 (
log‹g
 **
log‹gs
, 
numlog‹gs
, 
i‹eq_evít
 *
cuº
)

835 
out°™d
 *
ªq
;

836 
i
, 
j
;

837 
log‹gno
 = -1;

838 
ªt
 = 
NOT_COMPLETE
;

839 
i‹eq_evít
 *
ãmp
;

843 i‡((
numlog‹gs
 < 1Ë|| (numlog‹g†>
MAXLOGORGS
)) {

844 
	`Ârötf
(
°dîr
, "BadÇumbî o‡log‹g†©Üog‹g_m≠com∂ëe: %d\n", 
numlog‹gs
);

845 
	`exô
(1);

847 
i
 = 0; i < 
numlog‹gs
; i++) {

848 
j
 = 0; j < 
log‹gs
[
i
]->
a˘uÆnumdisks
; j++) {

849 i‡(
cuº
->
devno
 =
log‹gs
[
i
]->
devs
[
j
].devno) {

850 i‡(
	`log‹g_ovîœp
(
log‹gs
[
i
], 
j
, 
cuº
,Üog‹gs[i]->
a˘uÆblk•î∑π
Ë=
TRUE
) {

851 
log‹gno
 = 
i
;

856 i‡(
log‹gno
 != -1)

859 i‡(
log‹gno
 == -1) {

860 
	`Ârötf
(
°dîr
, "logorg_mapcompleteÉntered forÇon-logorgedÑequest\n");

861 
	`exô
(1);

864 i‡(
cuº
->
Êags
 & 
READ
) {

865 
log‹gs
[
log‹gno
]->
°©
.
ªads
++;

867 
log‹gs
[
log‹gno
]->
°©
.
idÀ°¨t
 = 
simtime
;

868 
log‹gs
[
log‹gno
]->
devs
[
cuº
->
devno
].
numout
--;

869 
ªq
 = 
	`log‹g_gë‰omout°™dq
(
log‹gs
[
log‹gno
], 
cuº
->
›id
);

870 
	`ASSERT
(
ªq
 !
NULL
);

871 
ªq
->
numªqs
--;

872 i‡(
ªq
->
dïíd
) {

873 
ªt
 = 
	`log‹g_check_dïídícõs
(
log‹gs
[
log‹gno
], 
ªq
, 
cuº
);

874 
ãmp
 = 
cuº
->
√xt
;

875 
i
 = 0; i < 
ªt
; i++) {

876 
ãmp
->
blkno
 +
log‹gs
[
log‹gno
]->
devs
[—emp->
devno
)].
°¨tblkno
;

877 
ãmp
->
devno
 = 
log‹gs
[
log‹gno
]->
devs
[(temp->devno)].devno;

878 
ãmp
 =Åemp->
√xt
;

880 i‡(
ªt
 == 0) {

881 
ªt
 = 
NOT_COMPLETE
;

885 
cuº
->
blkno
 +
log‹gs
[
log‹gno
]->
devs
[(cuº->
devno
)].
°¨tblkno
;

886 
cuº
->
devno
 = 
log‹gs
[
log‹gno
]->
devs
[(curr->devno)].devno;

887 i‡(
ªq
->
numªqs
) {

888 
	`log‹g_addtoout°™dq
(
log‹gs
[
log‹gno
], 
ªq
);

889 (
ªt
);

895 
	`log‹g_m≠com∂ëe_upd©e_°©s
(
log‹gs
[
log‹gno
], 
cuº
, 
ªq
);

896 
cuº
->
bcou¡
 = 
ªq
->bcount;

897 
cuº
->
blkno
 = 
ªq
->blkno;

898 
cuº
->
Êags
 = 
ªq
->flags;

899 
cuº
->
bu¢o
 = 
ªq
->busno;

900 
cuº
->
devno
 = 
ªq
->devno;

901 
cuº
->
›id
 = 
ªq
->
ªq›id
;

902 
cuº
->
buf
 = 
ªq
->buf;

903 
	`addt€xåaq
((
evít
 *Ë
ªq
);

904 (
COMPLETE
);

909 
	}
}

912 
	$log‹g_øi£_¥i‹ôy
 (
log‹g
 **
log‹gs
, 
numlog‹gs
, 
›id
, 
devno
, 
blkno
, *
buf
)

914 
i
, 
j
;

915 
log‹gno
 = -1;

916 
ˇlc
;

917 
out°™d
 *
tmp
;

918 
found
 = 0;

922 
	`ASSERT
((
numlog‹gs
 >1Ë&& (numlog‹g†< 
MAXLOGORGS
));

923 
i
 = 0; i < 
numlog‹gs
; i++) {

924 i‡(!
log‹gs
[
i
]->
addrby∑πs
) {

925 i‡(
devno
 =
log‹gs
[
i
]->
¨øydisk
) {

926 
log‹gno
 = 
i
;

931 
j
 = 0; j < 
log‹gs
[
i
]->
a˘uÆnumdisks
; j++) {

932 i‡(
devno
 =
log‹gs
[
i
]->
devs
[
j
].devno) {

933 
ˇlc
 = 
blkno
 - 
log‹gs
[
i
]->
devs
[
devno
].
°¨tblkno
;

934 i‡((
ˇlc
 >0Ë&& (ˇl¯< 
log‹gs
[
i
]->
blk•î∑π
)) {

935 
log‹gno
 = 
i
;

940 i‡(
log‹gno
 != -1) {

945 
	`ASSERT
(
log‹gno
 != -1);

946 
tmp
 = 
	`log‹g_show_buf_‰om_out°™dq
(
log‹gs
[
log‹gno
], 
buf
, 
›id
);

947 i‡(
tmp
) {

948 
i
=0; i<
log‹gs
[
log‹gno
]->
a˘uÆnumdisks
; i++) {

949 
found
 = 
	`ioqueue_øi£_¥i‹ôy
(
log‹gs
[
log‹gno
]->
devs
[
i
].
queue
, 
tmp
->
›id
);

955 
	}
}

958 
	$log‹g_po°∑ss_≥r
(
log‹g
 *
cuºlog‹g
, 
‹gno
)

961 
i
, 
j
;

970 
cuºlog‹g
->
blk•î∑π
 = 
	`devi˚_gë_numbî_of_blocks
(cuºlog‹g->
devs
[0].
devno
);

971 
cuºlog‹g
->
a˘uÆblk•î∑π
 = cuºlog‹g->
blk•î∑π
;

981 i‡((
cuºlog‹g
->
°rùeunô
 < 0) ||

982 (
cuºlog‹g
->
°rùeunô
 > cuºlog‹g->
blk•î∑π
)) {

983 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ 'Såùêunô (ö se˘‹s)': %d (<0 || >%d)", 
cuºlog‹g
->
°rùeunô
, cuºlog‹g->
blk•î∑π
);

986 i‡((
cuºlog‹g
->
∑rôyunô
 < 0) ||

987 (
cuºlog‹g
->
∑rôyunô
 > cuºlog‹g->
blk•î∑π
)) {

988 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ 'P¨ôy såùêunô': %d", 
cuºlog‹g
->
°rùeunô
);

991 i‡(
cuºlog‹g
->
m≠ty≥
 =
ASIS
) {

992 i‡(!
cuºlog‹g
->
addrby∑πs
) {

993 
	`Ârötf
(
°dîr
, "Can't have ASIS organization withárrayáddressing\n");

994 
	`exô
(1);

1000 
cuºlog‹g
->
sizes
 = 
NULL
;

1001 
cuºlog‹g
->
ªdunsizes
 = 
NULL
;

1002 
cuºlog‹g
->
°©
.
blocked
 = 
NULL
;

1003 
cuºlog‹g
->
°©
.
Æig√d
 = 
NULL
;

1004 
cuºlog‹g
->
°©
.
œ°ªq
 = 
NULL
;

1005 
cuºlog‹g
->
°©
.
ötdi°
 = 
NULL
;

1007 i‡((
cuºlog‹g
->
°rùeunô
 < 0) ||

1008 (
cuºlog‹g
->
°rùeunô
 > cuºlog‹g->
blk•î∑π
)) {

1009 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ såùeunôáàlog‹g_po°∑ss_≥r: %d\n", 
cuºlog‹g
->
°rùeunô
);

1010 
	`exô
(1);

1013 i‡((
cuºlog‹g
->
∑rôyunô
 < 1) ||

1014 (
cuºlog‹g
->
∑rôyunô
 > cuºlog‹g->
blk•î∑π
)) {

1015 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹Ö¨ôy såùêunô - %d\n", 
cuºlog‹g
->
∑rôyunô
);

1016 
	`exô
(1);

1019 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

1020 
cuºlog‹g
->
devs
[
i
].
£qªads
 = 0;

1021 
cuºlog‹g
->
devs
[
i
].
£qwrôes
 = 0;

1022 
cuºlog‹g
->
devs
[
i
].
öåóds
 = 0;

1023 
cuºlog‹g
->
devs
[
i
].
ötwrôes
 = 0;

1024 
j
=0; j<10; j++) {

1025 
cuºlog‹g
->
devs
[
i
].
di°numout
[
j
] = 0;

1027 
	`°©_ª£t
(&
cuºlog‹g
->
devs
[
i
].
°ªak°©s
);

1028 
	`°©_ª£t
(&
cuºlog‹g
->
devs
[
i
].
loˇlôy°©s
);

1030 
	}
}

1033 
	$log‹g_po°∑ss
(
log‹g
 **
log‹gs
, 
numlog‹gs
)

1035 
i
;

1037 
i
 = 0; i < 
numlog‹gs
; i++) {

1038 if(
log‹gs
[
i
]Ë
	`log‹g_po°∑ss_≥r
(logorgs[i], i);

1040 
	}
}

1046 
	$log‹g_ª£t°©s
 (
log‹g
 **
log‹gs
, 
numlog‹gs
)

1048 
i
, 
j
;

1050 
i
=0; i<
numlog‹gs
; i++) {

1051 
log‹gs
[
i
]->
°©
.
maxout°™dög
 = 0;

1052 
log‹gs
[
i
]->
°©
.
n⁄zîoouâime
 = 0.0;

1053 
log‹gs
[
i
]->
°©
.
runouâime
 = 0.0;

1054 
log‹gs
[
i
]->
°©
.
ouâime
 = 
simtime
;

1055 
log‹gs
[
i
]->
°©
.
ªads
 = 0;

1056 
log‹gs
[
i
]->
°©
.
idÀ°¨t
 = 
simtime
;

1057 
j
=0; j<10; j++) {

1058 
log‹gs
[
i
]->
°©
.
di°avgdiff
[
j
] = 0;

1059 
log‹gs
[
i
]->
°©
.
di°maxdiff
[
j
] = 0;

1061 
log‹gs
[
i
]->
°©
.
¸ôªads
 = 0;

1062 
log‹gs
[
i
]->
°©
.
¸ôwrôes
 = 0;

1063 
log‹gs
[
i
]->
°©
.
£qªads
 = 0;

1064 
log‹gs
[
i
]->
°©
.
£qwrôes
 = 0;

1065 
log‹gs
[
i
]->
°©
.
numloˇl
 = 0;

1066 
log‹gs
[
i
]->
°©
.
£qdiskswôches
 = 0;

1067 
log‹gs
[
i
]->
°©
.
locdiskswôches
 = 0;

1068 i‡(
log‹gs
[
i
]->
°©
.
ötdi°
) {

1069 
j
=0; j<(
INTERFEREMAX
*
INTDISTMAX
); j++) {

1070 
log‹gs
[
i
]->
°©
.
ötdi°
[
j
] = 0;

1073 i‡(
log‹gs
[
i
]->
°©
.
blocked
) {

1074 
j
=0; j<
BLOCKINGMAX
; j++) {

1075 
log‹gs
[
i
]->
°©
.
blocked
[
j
] = 0;

1076 
log‹gs
[
i
]->
°©
.
Æig√d
[
j
] = 0;

1092 
	`°©_ª£t
(&
log‹gs
[
i
]->
°©
.
öèº°©s
);

1093 
	`°©_ª£t
(&
log‹gs
[
i
]->
°©
.
ªadöèº°©s
);

1094 
	`°©_ª£t
(&
log‹gs
[
i
]->
°©
.
wrôeöèº°©s
);

1095 
	`°©_ª£t
(&
log‹gs
[
i
]->
°©
.
size°©s
);

1096 
	`°©_ª£t
(&
log‹gs
[
i
]->
°©
.
ªadsize°©s
);

1097 
	`°©_ª£t
(&
log‹gs
[
i
]->
°©
.
wrôesize°©s
);

1098 
	`°©_ª£t
(&
log‹gs
[
i
]->
°©
.
idÀ°©s
);

1099 
	`°©_ª£t
(&
log‹gs
[
i
]->
°©
.
ª•time°©s
);

1101 
	}
}

1104 
	$log‹g_öôülize
 (
log‹g
 **
log‹gs
,

1105 
numlog‹gs
,

1106 
ioq
 **
queue£t
,

1107 
¥öéoˇlôy°©s
,

1108 
¥ötblockög°©s
,

1109 
¥ötöãr„ª°©s
,

1110 
¥öt°ªak°©s
,

1111 
¥öt°amp°©s
,

1112 
¥ötöèº°©s
,

1113 
¥ötidÀ°©s
,

1114 
¥ötsize°©s
)

1116 
i
, 
j
, 
k
;

1120 
	`SèticAs£π
 ((
dïíds
Ë<
DISKSIM_EVENT_SIZE
);

1121 
	`SèticAs£π
 ((
out°™d
Ë<
DISKSIM_EVENT_SIZE
);

1123 
	`log‹g_po°∑ss
 (
log‹gs
, 
numlog‹gs
);

1125 
i
 = 0; i < 
numlog‹gs
; i++) {

1127 
log‹gs
[
i
]->
¥öéoˇlôy°©s
 =Örintlocalitystats;

1128 
log‹gs
[
i
]->
¥ötblockög°©s
 =Örintblockingstats;

1129 
log‹gs
[
i
]->
¥ötöãr„ª°©s
 =Örintinterferestats;

1130 
log‹gs
[
i
]->
¥ötidÀ°©s
 =Örintidlestats;

1131 
log‹gs
[
i
]->
¥ötöèº°©s
 =Örintintarrstats;

1132 
log‹gs
[
i
]->
¥öt°ªak°©s
 =Örintstreakstats;

1133 
log‹gs
[
i
]->
¥öt°amp°©s
 =Örintstampstats;

1134 
log‹gs
[
i
]->
¥ötsize°©s
 =Örintsizestats;

1136 i‡(
log‹gs
[
i
]->
ªdu¡y≥
 =
SHADOWED
) {

1137 i‡((
log‹gs
[
i
]->
numdisks
 %Üog‹gs[i]->
c›õs
) != 0) {

1138 
	`Ârötf
(
°dîr
, "Number of devicesÇot multiple ofÇumber of copies\n");

1139 
	`exô
(1);

1141 
log‹gs
[
i
]->
numdisks
 =Üog‹gs[i]->numdisk†/Üog‹gs[i]->
c›õs
;

1143 i‡(
log‹gs
[
i
]->
ªdu¡y≥
 =
PARITY_DISK
) {

1144 i‡((
log‹gs
[
i
]->
m≠ty≥
 =
STRIPED
) &&

1145 (
log‹gs
[
i
]->
°rùeunô
 != 0))

1147 
log‹gs
[
i
]->
m≠ty≥
 = 
ASIS
;

1148 
	`log‹g_¸óã_èbÀ
(
log‹gs
[
i
]);

1149 
log‹gs
[
i
]->
ªdu¡y≥
 = 
PARITY_TABLE
;

1151 
log‹gs
[
i
]->
numdisks
--;

1153 i‡((
log‹gs
[
i
]->
ªdu¡y≥
 =
PARITY_ROTATED
) &&

1154 (
	`log‹g_èbuœr_rŸty≥
(
log‹gs
[
i
]->
m≠ty≥
,

1155 
log‹gs
[
i
]->
ªdu¡y≥
,

1156 
log‹gs
[
i
]->
rŸty≥
,

1157 
log‹gs
[
i
]->
°rùeunô
)))

1159 
	`log‹g_¸óã_èbÀ
(
log‹gs
[
i
]);

1160 
log‹gs
[
i
]->
m≠ty≥
 = 
ASIS
;

1161 
log‹gs
[
i
]->
ªdu¡y≥
 = 
PARITY_TABLE
;

1162 
log‹gs
[
i
]->
blk•î∑π
 =

1164 
log‹gs
[
i
]->
blk•î∑π
 *

1165 (Ë(
log‹gs
[
i
]->
numdisks
 - 1) /

1166 (Ë
log‹gs
[
i
]->
numdisks
);

1169 i‡(
log‹gs
[
i
]->
ªdu¡y≥
 =
PARITY_ROTATED
) {

1170 
log‹gs
[
i
]->
blk•î∑π
 =

1173 
log‹gs
[
i
]->
blk•î∑π
 *

1174 (Ë(
log‹gs
[
i
]->
numdisks
 - 1) /

1175 (Ë
log‹gs
[
i
]->
numdisks
)

1176 - 
log‹gs
[
i
]->
∑rôyunô
;

1179 
log‹gs
[
i
]->
›id
 = 0;

1180 
log‹gs
[
i
]->
idó o
 = 0;

1181 
log‹gs
[
i
]->
ªdu¡oggÀ
 = 0;

1182 
log‹gs
[
i
]->
œ°diskac˚s£d
 =Üog‹gs[i]->
a˘uÆnumdisks
;

1184 
log‹gs
[
i
]->
out°™dqÀn
 != 0) {

1185 
	`addt€xåaq
((
evít
 *Ë
	`log‹g_gë‰omout°™dq
(
log‹gs
[
i
], -1));

1188 i‡((
log‹gs
[
i
]->
m≠ty≥
 =
STRIPED
Ë&& (log‹gs[i]->
°rùeunô
)) {

1189 
log‹gs
[
i
]->
numfuŒ
 =Üog‹gs[i]->
blk•î∑π
 /

1190 
log‹gs
[
i
]->
°rùeunô
;

1192 i‡(
log‹gs
[
i
]->
ªdu¡y≥
 =
PARITY_ROTATED
) {

1193 
log‹gs
[
i
]->
numfuŒ
 =Üog‹gs[i]->
a˘uÆblk•î∑π
 /

1194 
log‹gs
[
i
]->
∑rôyunô
;

1196 i‡(
log‹gs
[
i
]->
ªdu¡y≥
 =
PARITY_TABLE
) {

1197 
log‹gs
[
i
]->
numfuŒ
 =Üog‹gs[i]->
a˘uÆblk•î∑π
 /

1198 
log‹gs
[
i
]->
°rùeunô
;

1199 
log‹gs
[
i
]->
numfuŒ
 *log‹gs[i]->
°rùeunô
;

1202 
log‹gs
[
i
]->
numfuŒ
 = 0;

1205 
log‹gs
[
i
]->
sizes
 =

1206 
	`DISKSIM_mÆloc
(
log‹gs
[
i
]->
a˘uÆnumdisks
 * ());

1208 
log‹gs
[
i
]->
ªdunsizes
 =

1209 
	`DISKSIM_mÆloc
(
log‹gs
[
i
]->
a˘uÆnumdisks
 * ());

1211 i‡(
log‹gs
[
i
]->
¥ötöãr„ª°©s
) {

1212 
log‹gs
[
i
]->
°©
.
œ°ªq
 =

1213 
	`DISKSIM_mÆloc
(2 * 
INTERFEREMAX
*());

1215 
j
=0; j<(2*
INTERFEREMAX
); j++) {

1216 
log‹gs
[
i
]->
°©
.
œ°ªq
[
j
] = 0;

1219 
log‹gs
[
i
]->
°©
.
ötdi°
 =

1220 
	`DISKSIM_mÆloc
(
INTERFEREMAX
*
INTDISTMAX
*());

1222 i‡(
log‹gs
[
i
]->
¥ötblockög°©s
) {

1223 
log‹gs
[
i
]->
°©
.
blocked
 = 
	`DISKSIM_mÆloc
(
BLOCKINGMAX
*());

1224 
log‹gs
[
i
]->
°©
.
Æig√d
 = 
	`DISKSIM_mÆloc
(
BLOCKINGMAX
*());

1226 
log‹gs
[
i
]->
°©
.
out°™dög
 = 0;

1227 
log‹gs
[
i
]->
°©
.
ªadout°™dög
 = 0;

1229 
	`°©_öôülize
(
°©deffûe
, 
°©desc_öèº
,

1230 &
log‹gs
[
i
]->
°©
.
öèº°©s
);

1231 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ªadöèº
,

1232 &
log‹gs
[
i
]->
°©
.
ªadöèº°©s
);

1233 
	`°©_öôülize
(
°©deffûe
, 
°©desc_wrôeöèº
,

1234 &
log‹gs
[
i
]->
°©
.
wrôeöèº°©s
);

1235 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ªqsize
,

1236 &
log‹gs
[
i
]->
°©
.
size°©s
);

1237 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ªadsize
,

1238 &
log‹gs
[
i
]->
°©
.
ªadsize°©s
);

1239 
	`°©_öôülize
(
°©deffûe
, 
°©desc_wrôesize
,

1240 &
log‹gs
[
i
]->
°©
.
wrôesize°©s
);

1241 
	`°©_öôülize
(
°©deffûe
, 
°©desc_idÀs
,

1242 &
log‹gs
[
i
]->
°©
.
idÀ°©s
);

1243 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ª•time
,

1244 &
log‹gs
[
i
]->
°©
.
ª•time°©s
);

1246 
log‹gs
[
i
]->
°©
.
œ°¨r
 = 0.0;

1247 
log‹gs
[
i
]->
°©
.
œ°ªad
 = 0.0;

1248 
log‹gs
[
i
]->
°©
.
œ°wrôe
 = 0.0;

1250 
j
=0; j<
NUMGENS
; j++) {

1251 
log‹gs
[
i
]->
°©
.
gís
[
j
] = -1;

1254 
k
=0; k<
log‹gs
[
i
]->
a˘uÆnumdisks
; k++) {

1255 
log‹gs
[
i
]->
devs
[
k
].
queue
 = 
queue£t
[log‹gs[i]->devs[k].
devno
];

1256 
log‹gs
[
i
]->
devs
[
k
].
œ°blkno
 = -1;

1257 
log‹gs
[
i
]->
devs
[
k
].
œ°blkno2
 = -1;

1258 
log‹gs
[
i
]->
devs
[
k
].
numout
 = 0;

1259 
log‹gs
[
i
]->
devs
[
k
].
cur°ªak
 = 0;

1260 
	`°©_öôülize
(
°©deffûe
, 
°©desc_°ªak
,

1261 &
log‹gs
[
i
]->
devs
[
k
].
°ªak°©s
);

1262 
	`°©_öôülize
(
°©deffûe
, 
°©desc_loˇlôy
,

1263 &
log‹gs
[
i
]->
devs
[
k
].
loˇlôy°©s
);

1266 i‡(
log‹gs
[
i
]->
°ampöãrvÆ
 != 0.0) {

1267 
i‹eq_evít
 *
tmp
 = (i‹eq_evíà*Ë
	`gë‰omexåaq
();

1268 
tmp
->
time
 = 
log‹gs
[
i
]->
°amp°¨t
;

1269 
tmp
->
ty≥
 = 
TIMESTAMP_LOGORG
;

1270 
tmp
->
ãmµå1
 = 
log‹gs
[
i
];

1271 
	`addtoötq
((
evít
 *Ë
tmp
);

1275 
	`log‹g_ª£t°©s
(
log‹gs
, 
numlog‹gs
);

1276 
	}
}

1279 
	$log‹g_˛ón°©s
 (
log‹g
 **
log‹gs
, 
numlog‹gs
)

1281 
i
;

1282 
çass
;

1284 
i
=0; i<
numlog‹gs
; i++) {

1285 
	`log‹g_°ªak°©
(
log‹gs
[
i
],Üog‹gs[i]->
a˘uÆnumdisks
);

1286 i‡(
log‹gs
[
i
]->
°©
.
out°™dög
 > 0) {

1287 
log‹gs
[
i
]->
°©
.
n⁄zîoouâime
 +
simtime
 -Üog‹gs[i]->°©.
ouâime
;

1289 
çass
 = 
simtime
 - 
log‹gs
[
i
]->
°©
.
idÀ°¨t
;

1290 
	`°©_upd©e
(&
log‹gs
[
i
]->
°©
.
idÀ°©s
, 
çass
);

1292 
log‹gs
[
i
]->
°©
.
idÀ°¨t
 = 
simtime
;

1293 
log‹gs
[
i
]->
°©
.
runouâime
 +(Ëlog‹gs[i]->°©.
out°™dög
 * (
simtime
 -Üog‹gs[i]->°©.
ouâime
);

1294 
log‹gs
[
i
]->
°©
.
ouâime
 = 
simtime
;

1296 
	}
}

1299 
	$log‹g_¥öåeqtime°©s
 (
log‹g
 *
cuºlog‹g
, *
¥efix
)

1301 
tmp1
, 
tmp2
;

1303 
tmp1
 = 
	`°©_gë_cou¡
(&
cuºlog‹g
->
°©
.
öèº°©s
);

1304 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡ªque°s: %d\n", 
¥efix
, 
tmp1
);

1305 
tmp2
 = 
	`°©_gë_cou¡
(&
cuºlog‹g
->
°©
.
ªadöèº°©s
);

1307 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡ªadÑeque°s: %d \t%f\n", 
¥efix
, 
tmp2
, ((Ëtmp2 / (Ë
	`max
(1,
tmp1
)));

1309 
tmp1
 = 
	`°©_gë_cou¡
(&
cuºlog‹g
->
°©
.
ª•time°©s
Ë+ cuºlog‹g->°©.
out°™dög
;

1310 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡ac˚s£s: %d\n", 
¥efix
, 
tmp1
);

1311 
tmp2
 = 
cuºlog‹g
->
°©
.
ªads
 + cuºlog‹g->°©.
ªadout°™dög
;

1312 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡ªadác˚s£s: %d \t%f\n", 
¥efix
, 
tmp2
, ((Ëtmp2 / (Ë
	`max
(1,
tmp1
)));

1314 
	`Ârötf
(
ouçutfûe
, "%sAvîagêout°™dög: %f\n", 
¥efix
, (
cuºlog‹g
->
°©
.
runouâime
 / (
simtime
 - 
w¨mu±ime
)));

1315 
	`Ârötf
(
ouçutfûe
, "%sMaximum out°™dög: %d\n", 
¥efix
, 
cuºlog‹g
->
°©
.
maxout°™dög
);

1316 i‡(
cuºlog‹g
->
°©
.
n⁄zîoouâime
 == 0.0) {

1317 
	`Ârötf
(
ouçutfûe
, "%sAvgÇ⁄zîÿout°™dög:Ç⁄e\n", 
¥efix
);

1319 
	`Ârötf
(
ouçutfûe
, "%sAvgÇ⁄zîÿout°™dög: %f\n", 
¥efix
, (
cuºlog‹g
->
°©
.
runouâime
 / cuºlog‹g->°©.
n⁄zîoouâime
));

1321 
	`Ârötf
(
ouçutfûe
, "%sCom∂ëñy idÀÅime: %f\n", 
¥efix
, (
simtime
 - 
w¨mu±ime
 - 
cuºlog‹g
->
°©
.
n⁄zîoouâime
));

1322 
	`°©_¥öt
(&
cuºlog‹g
->
°©
.
ª•time°©s
, 
¥efix
);

1323 
	}
}

1326 
	$log‹g_¥öéoˇlôy°©s
 (
log‹g
 *
cuºlog‹g
, *
¥efix
)

1328 
i
;

1329 
£qªads
 = 0;

1330 
£qwrôes
 = 0;

1331 
öåóds
 = 0;

1332 
ötwrôes
 = 0;

1333 
numªqs
;

1334 
numªads
;

1335 
numwrôes
;

1336 
°©gí
 * 
°©£t
[
MAXDEVICES
];

1338 i‡(
cuºlog‹g
->
¥öéoˇlôy°©s
) {

1339 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

1340 
£qªads
 +
cuºlog‹g
->
devs
[
i
].seqreads;

1341 
£qwrôes
 +
cuºlog‹g
->
devs
[
i
].seqwrites;

1342 
öåóds
 +
cuºlog‹g
->
devs
[
i
].intreads;

1343 
ötwrôes
 +
cuºlog‹g
->
devs
[
i
].intwrites;

1344 
°©£t
[
i
] = &
cuºlog‹g
->
devs
[i].
loˇlôy°©s
;

1346 
numªqs
 = 
	`°©_gë_cou¡
(&
cuºlog‹g
->
°©
.
öèº°©s
);

1347 
numªads
 = 
	`°©_gë_cou¡
(&
cuºlog‹g
->
°©
.
ªadöèº°©s
);

1348 
numwrôes
 = 
	`°©_gë_cou¡
(&
cuºlog‹g
->
°©
.
wrôeöèº°©s
);

1350 
	`°©_¥öt_£t
(
°©£t
, 
cuºlog‹g
->
a˘uÆnumdisks
, 
¥efix
);

1351 
	`Ârötf
(
ouçutfûe
, "%sSequítü»ªads: %4d\t%f\t%f\n", 
¥efix
, 
£qªads
, ((Ë£qªad†/ (Ë
	`max
(
numªqs
,1)), ((Ë£qªad†/ (Ëmax(
numªads
,1)));

1352 
	`Ârötf
(
ouçutfûe
, "%sSequítü»wrôes: %4d\t%f\t%f\n", 
¥efix
, 
£qwrôes
, ((Ë£qwrôe†/ (Ë
	`max
(
numªqs
,1)), ((Ë£qwrôe†/ (Ëmax(
numwrôes
,1)));

1353 
	`Ârötf
(
ouçutfûe
, "%sI¡îÀavedÑóds: %4d\t%f\t%f\n", 
¥efix
, 
öåóds
, ((Ëöåód†/ (Ë
	`max
(
numªqs
,1)), ((Ëöåód†/ (Ëmax(
numªads
,1)));

1354 
	`Ârötf
(
ouçutfûe
, "%sI¡îÀaved wrôes: %4d\t%f\t%f\n", 
¥efix
, 
ötwrôes
, ((Ëötwrôe†/ (Ë
	`max
(
numªqs
,1)), ((Ëötwrôe†/ (Ëmax(
numwrôes
,1)));

1356 
	`Ârötf
(
ouçutfûe
, "%sLogiˇ»£quítü»ªads: %4d\t%f\t%f\n", 
¥efix
, 
cuºlog‹g
->
°©
.
£qªads
, ((Ëcuºlog‹g->°©.£qªad†/ (Ë
	`max
(
numªqs
,1)), ((Ëcuºlog‹g->°©.£qªad†/ (Ëmax(
numªads
,1)));

1357 
	`Ârötf
(
ouçutfûe
, "%sLogiˇ»£quítü»wrôes: %4d\t%f\t%f\n", 
¥efix
, 
cuºlog‹g
->
°©
.
£qwrôes
, ((Ëcuºlog‹g->°©.£qwrôe†/ (Ë
	`max
(
numªqs
,1)), ((Ëcuºlog‹g->°©.£qwrôe†/ (Ëmax(
numwrôes
,1)));

1358 
£qªads
 = 
cuºlog‹g
->
°©
.£qªad†+ cuºlog‹g->°©.
£qwrôes
;

1359 
	`Ârötf
(
ouçutfûe
, "%sSequítü»disk swôches: %4d\t%f\n", 
¥efix
, 
cuºlog‹g
->
°©
.
£qdiskswôches
, ((Ëcuºlog‹g->°©.£qdiskswôche†/ (Ë
	`max
(
£qªads
,1)));

1360 
	`Ârötf
(
ouçutfûe
, "%sLogiˇ»loˇ»ac˚s£s: %4d\t%f\n", 
¥efix
, 
cuºlog‹g
->
°©
.
numloˇl
, ((Ëcuºlog‹g->°©.numloˇ»/ (Ë
	`max
(
numªqs
,1)));

1361 
	`Ârötf
(
ouçutfûe
, "%sLoˇ»disk swi˘hes: %4d\t%f\n", 
¥efix
, 
cuºlog‹g
->
°©
.
locdiskswôches
, ((Ëcuºlog‹g->°©.locdiskswôche†/ (Ë
	`max
(cuºlog‹g->°©.
numloˇl
,1)));

1363 
	}
}

1366 
	$log‹g_¥ötöãr„ª°©s
 (
log‹g
 *
cuºlog‹g
, *
¥efix
)

1368 
i
;

1369 
‰ac
;

1370 
ªq˙t
;

1371 *
ötdi°
;

1372 
loˇloff
[
INTDISTMAX
];

1374 i‡(
cuºlog‹g
->
¥ötöãr„ª°©s
 =
FALSE
) {

1378 
loˇloff
[1] = -4;

1379 
loˇloff
[2] = -8;

1380 
loˇloff
[3] = -16;

1381 
loˇloff
[4] = -64;

1382 
loˇloff
[5] = 8;

1383 
loˇloff
[6] = 16;

1384 
loˇloff
[7] = 64;

1385 
ötdi°
 = 
cuºlog‹g
->
°©
.intdist;

1386 
ªq˙t
 = (Ë
	`°©_gë_cou¡
(&
cuºlog‹g
->
°©
.
öèº°©s
);

1387 
i
=0; i<(
INTERFEREMAX
*
INTDISTMAX
); i+=INTDISTMAX) {

1388 
‰ac
 = (Ë
ötdi°
[
i
] / 
ªq˙t
;

1389 i‡(
‰ac
 >= 0.002) {

1390 
	`Ârötf
 (
ouçutfûe
, "%sSequítü»°ï %2d: %6d \t%f\n", 
¥efix
, (
i
/
INTDISTMAX
), 
ötdi°
[i], 
‰ac
);

1393 
i
=0; i<(
INTERFEREMAX
*
INTDISTMAX
); i++) {

1394 i‡(
i
 % 
INTDISTMAX
) {

1395 
‰ac
 = (Ë
ötdi°
[
i
] / 
ªq˙t
;

1396 i‡(
‰ac
 >= 0.002) {

1397 
	`Ârötf
 (
ouçutfûe
, "%sLoˇ»(%3dË°ï %2d: %6d \t%f\n", 
¥efix
, 
loˇloff
[(
i
 % 
INTDISTMAX
)], (i/INTDISTMAX), 
ötdi°
[i], 
‰ac
);

1401 
	}
}

1404 
	$log‹g_¥ötblockög°©s
 (
log‹g
 *
cuºlog‹g
, *
¥efix
)

1406 
i
;

1407 
‰ac
;

1408 
ªq˙t
;

1410 i‡(
cuºlog‹g
->
¥ötblockög°©s
 =
FALSE
) {

1414 
ªq˙t
 = (Ë
	`°©_gë_cou¡
(&
cuºlog‹g
->
°©
.
öèº°©s
);

1415 
	`Ârötf
(
ouçutfûe
, "%sBlockög sèti°ics\n", 
¥efix
);

1416 
i
=0; i<
BLOCKINGMAX
; i++) {

1417 
‰ac
 = (Ë
cuºlog‹g
->
°©
.
blocked
[
i
] / 
ªq˙t
;

1418 i‡(
‰ac
 >= () 0.01) {

1419 
	`Ârötf
(
ouçutfûe
, "%sBlockög fa˘‹: %3d \t%6d \t%f\n", 
¥efix
, (
i
+1), 
cuºlog‹g
->
°©
.
blocked
[i], 
‰ac
);

1422 
	`Ârötf
(
ouçutfûe
, "%sAlignmíà°©i°ics\n", 
¥efix
);

1423 
i
=0; i<
BLOCKINGMAX
; i++) {

1424 
‰ac
 = (Ë
cuºlog‹g
->
°©
.
Æig√d
[
i
] / 
ªq˙t
;

1425 i‡(
‰ac
 >= () 0.1) {

1426 
	`Ârötf
(
ouçutfûe
, "%sAlignmíàÁ˘‹: %3d \t%6d \t%f\n", 
¥efix
, (
i
+1), 
cuºlog‹g
->
°©
.
Æig√d
[i], 
‰ac
);

1429 
	}
}

1432 
	$log‹g_¥öt°amp°©s
 (
log‹g
 *
cuºlog‹g
, *
¥efix
)

1434 
i
, 
j
;

1435 
di°numout
[10];

1437 i‡(
cuºlog‹g
->
¥öt°amp°©s
 =
FALSE
)

1440 
i
=0; i<10; i++) {

1441 
di°numout
[
i
] = 0;

1443 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

1444 
j
=0; j<10; j++) {

1445 
di°numout
[
j
] +
cuºlog‹g
->
devs
[
i
].distnumout[j];

1448 
	`Ârötf
(
ouçutfûe
, "%sTime°am≥d # out°™dög di°ributi⁄ (öãrvÆ = %f)\n", 
¥efix
, 
cuºlog‹g
->
°ampöãrvÆ
);

1449 
	`Ârötf
(
ouçutfûe
, " 0 1 2 3 4 5 6 7 8 9+\n");

1450 
	`Ârötf
(
ouçutfûe
, "%6d %6d %6d %6d %6d %6d %6d %6d %6d %6d\n",

1451 
di°numout
[0], distnumout[1], distnumout[2], distnumout[3],

1452 
di°numout
[4], distnumout[5], distnumout[6], distnumout[7],

1453 
di°numout
[8], distnumout[9]);

1454 
	`Ârötf
(
ouçutfûe
, "%sTime°am≥dávg # out°™dög dif„ªn˚ di°ributi⁄\n", 
¥efix
);

1455 
	`Ârötf
(
ouçutfûe
, " <.5 <1 <1.5 <2 <2.5 <3 <4 <5 <6 6+\n");

1456 
	`Ârötf
(
ouçutfûe
, "%6d %6d %6d %6d %6d %6d %6d %6d %6d %6d\n",

1457 
cuºlog‹g
->
°©
.
di°avgdiff
[0], currlogorg->stat.distavgdiff[1],

1458 
cuºlog‹g
->
°©
.
di°avgdiff
[2], currlogorg->stat.distavgdiff[3],

1459 
cuºlog‹g
->
°©
.
di°avgdiff
[4], currlogorg->stat.distavgdiff[5],

1460 
cuºlog‹g
->
°©
.
di°avgdiff
[6], currlogorg->stat.distavgdiff[7],

1461 
cuºlog‹g
->
°©
.
di°avgdiff
[8], currlogorg->stat.distavgdiff[9]);

1462 
	`Ârötf
(
ouçutfûe
, "%sTime°am≥d max # out°™dög dif„ªn˚ di°ributi⁄\n", 
¥efix
);

1463 
	`Ârötf
(
ouçutfûe
, " <.5 <1 <1.5 <2 <2.5 <3 <4 <5 <6 6+\n");

1464 
	`Ârötf
(
ouçutfûe
, "%6d %6d %6d %6d %6d %6d %6d %6d %6d %6d\n",

1465 
cuºlog‹g
->
°©
.
di°maxdiff
[0], currlogorg->stat.distmaxdiff[1],

1466 
cuºlog‹g
->
°©
.
di°maxdiff
[2], currlogorg->stat.distmaxdiff[3],

1467 
cuºlog‹g
->
°©
.
di°maxdiff
[4], currlogorg->stat.distmaxdiff[5],

1468 
cuºlog‹g
->
°©
.
di°maxdiff
[6], currlogorg->stat.distmaxdiff[7],

1469 
cuºlog‹g
->
°©
.
di°maxdiff
[8], currlogorg->stat.distmaxdiff[9]);

1470 
	}
}

1473 
	$log‹g_¥öt°©s
 (
log‹g
 **
log‹gs
, 
numlog‹gs
, *
sour˚°r
)

1475 
i
, 
j
;

1476 
a˘uÆnumdisks
;

1477 
°©gí
 * 
°©£t
[
MAXDEVICES
];

1478 
£t
[
MAXDEVICES
];

1479 
¥efix
[80];

1481 
i
 = 0; i < 
numlog‹gs
; i++) {

1482 
	`Ârötf
 (
ouçutfûe
, "%sLogiˇ»Org™iz©i⁄ #%d\n", 
sour˚°r
, 
i
);

1483 
	`•rötf
(
¥efix
, "%¶og‹g #%d ", 
sour˚°r
, 
i
);

1484 
a˘uÆnumdisks
 = 
log‹gs
[
i
]->actualnumdisks;

1485 
	`log‹g_¥öåeqtime°©s
(
log‹gs
[
i
], 
¥efix
);

1486 
	`Ârötf
 (
ouçutfûe
, "%sTime-¸ôiˇ»ªads: %d\n", 
¥efix
, 
log‹gs
[
i
]->
°©
.
¸ôªads
);

1487 
	`Ârötf
 (
ouçutfûe
, "%sTime-¸ôiˇ»wrôes: %d\n", 
¥efix
, 
log‹gs
[
i
]->
°©
.
¸ôwrôes
);

1488 
	`log‹g_¥öéoˇlôy°©s
(
log‹gs
[
i
], 
¥efix
);

1489 
	`log‹g_¥ötöãr„ª°©s
(
log‹gs
[
i
], 
¥efix
);

1490 
	`log‹g_¥ötblockög°©s
(
log‹gs
[
i
], 
¥efix
);

1492 i‡(
log‹gs
[
i
]->
¥ötöèº°©s
) {

1493 
	`°©_¥öt
(&
log‹gs
[
i
]->
°©
.
öèº°©s
, 
¥efix
);

1494 
	`°©_¥öt
(&
log‹gs
[
i
]->
°©
.
ªadöèº°©s
, 
¥efix
);

1495 
	`°©_¥öt
(&
log‹gs
[
i
]->
°©
.
wrôeöèº°©s
, 
¥efix
);

1498 i‡(
log‹gs
[
i
]->
¥öt°ªak°©s
) {

1499 
j
 = 0; j < 
a˘uÆnumdisks
; j++) {

1500 
°©£t
[
j
] = &
log‹gs
[
i
]->
devs
[j].
°ªak°©s
;

1502 
	`Ârötf
 (
ouçutfûe
, "%sNumbî o‡°ªaks:\t\t%d\n", 
¥efix
, 
	`°©_gë_cou¡_£t
(
°©£t
, 
a˘uÆnumdisks
));

1503 
	`°©_¥öt_£t
(
°©£t
, 
a˘uÆnumdisks
, 
¥efix
);

1506 
	`log‹g_¥öt°amp°©s
(
log‹gs
[
i
], 
¥efix
);

1508 i‡(
log‹gs
[
i
]->
¥ötsize°©s
) {

1509 
	`°©_¥öt
(&
log‹gs
[
i
]->
°©
.
size°©s
, 
¥efix
);

1510 
	`°©_¥öt
(&
log‹gs
[
i
]->
°©
.
ªadsize°©s
, 
¥efix
);

1511 
	`°©_¥öt
(&
log‹gs
[
i
]->
°©
.
wrôesize°©s
, 
¥efix
);

1514 i‡(
log‹gs
[
i
]->
¥ötidÀ°©s
) {

1515 
	`Ârötf
 (
ouçutfûe
, "%sNumbî o‡idÀÖîiods: %d\n", 
¥efix
, 
	`°©_gë_cou¡
(&
log‹gs
[
i
]->
°©
.
idÀ°©s
));

1516 
	`°©_¥öt
(&
log‹gs
[
i
]->
°©
.
idÀ°©s
, 
¥efix
);

1519 
j
 = 0; j < 
a˘uÆnumdisks
; j++) {

1520 
£t
[
j
] = 
log‹gs
[
i
]->
devs
[j].
devno
;

1522 
	`devi˚_¥öt£t°©s
(
£t
, 
a˘uÆnumdisks
, 
¥efix
);

1523 i‡((
i
+1Ë< 
numlog‹gs
) {

1524 
	`Ârötf
 (
ouçutfûe
, "\n");

1527 
	}
}

1529 
	$log‹g_di°n
(
log‹g
 *
ªsu…
, *
s
) {

1530 if(!
	`°rcmp
(
s
, "Asis")) {

1531 
ªsu…
->
m≠ty≥
 = 
ASIS
;

1533 if(!
	`°rcmp
(
s
, "Striped")) {

1534 
ªsu…
->
m≠ty≥
 = 
STRIPED
;

1536 if(!
	`°rcmp
(
s
, "Random")) {

1537 
	`Ârötf
(
°dîr
, "*** warning: RandomÜogorg distribution is only "

1541 
ªsu…
->
m≠ty≥
 = 
RANDOM
;

1543 if(!
	`°rcmp
(
s
, "Ideal")) {

1544 
ªsu…
->
m≠ty≥
 = 
IDEAL
;

1547 
	`Ârötf
(
°dîr
, "***Éº‹: %†i†nŸá vÆidárgumíàf‹Üog‹gáddªssög mode\n", 
s
);

1551 
	}
}

1553 
	$log‹g_addr
(
log‹g
 *
ªsu…
, *
s
) {

1554 if(!
	`°rcmp
(
s
, "Parts")) {

1555 
ªsu…
->
addrby∑πs
 = 
TRUE
;

1557 if(!
	`°rcmp
(
s
, "Array")) {

1558 
ªsu…
->
addrby∑πs
 = 
FALSE
;

1561 
	`Ârötf
(
°dîr
, "***Éº‹: %†i†nŸá vÆidárgumíàf‹Üog‹g di°ributi⁄ scheme\n", 
s
);

1565 
	}
}

1567 
	$log‹g_ªdun
(
log‹g
 *
ªsu…
, *
s
) {

1568 if(!
	`°rcmp
(
s
, "Noredun")) {

1569 
ªsu…
->
ªdu¡y≥
 = 
NO_REDUN
;

1571 if(!
	`°rcmp
(
s
, "Shadowed")) {

1572 
ªsu…
->
ªdu¡y≥
 = 
SHADOWED
;

1574 if(!
	`°rcmp
(
s
, "Parity_disk")) {

1575 
ªsu…
->
ªdu¡y≥
 = 
PARITY_DISK
;

1577 if(!
	`°rcmp
(
s
, "Parity_rotated")) {

1578 
ªsu…
->
ªdu¡y≥
 = 
PARITY_ROTATED
;

1581 
	`Ârötf
(
°dîr
, "***Éº‹: %†i†nŸá vÆidárgumíàf‹Üog‹gÑedund™cy scheme\n", 
s
);

1585 
	}
}

1588 
	$gëlog‹gdevs
(
log‹g
 *
ªsu…
, 
Õ_li°
 *
l
) {

1589 
c
, 
j
;

1590 
devno
, 
devty≥
;

1591 
¶Ÿ
 = 0;

1593 
ªsu…
->
devs
 = 
	`mÆloc
(
l
->
vÆues_Àn
 * (
log‹gdev
));

1594 
	`bzîo
(
ªsu…
->
devs
, 
l
->
vÆues_Àn
 * (
log‹gdev
));

1596 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

1597 if(!
l
->
vÆues
[
c
]) ;

1599 if(
l
->
vÆues
[
c
]->
t
 !
S
) {

1600 
	`Ârötf
(
°dîr
, "***Érror: badÜogorg member device spec.\n");

1603 if(!
	`gëdevby«me
(
l
->
vÆues
[
c
]->
v
.
s
, &
devno
, 0, &
devty≥
)) {

1604 
	`Ârötf
(
°dîr
, "***Érror: badÜogorg member device spec:Ço such device.\n");

1614 
ªsu…
->
devs
[
¶Ÿ
].
devno
 = devno;

1615 
ªsu…
->
devs
[
¶Ÿ
].
°¨tblkno
 = 0;

1617 
ªsu…
->
devs
[
¶Ÿ
].
£qªads
 = 0;

1618 
ªsu…
->
devs
[
¶Ÿ
].
£qwrôes
 = 0;

1619 
ªsu…
->
devs
[
¶Ÿ
].
öåóds
 = 0;

1620 
ªsu…
->
devs
[
¶Ÿ
].
ötwrôes
 = 0;

1621 
j
=0; j<10; j++) {

1622 
ªsu…
->
devs
[
¶Ÿ
].
di°numout
[
j
] = 0;

1624 
	`°©_ª£t
(&
ªsu…
->
devs
[
¶Ÿ
].
°ªak°©s
);

1625 
	`°©_ª£t
(&
ªsu…
->
devs
[
¶Ÿ
].
loˇlôy°©s
);

1627 
¶Ÿ
++;

1631 
ªsu…
->
a˘uÆnumdisks
 = 
¶Ÿ
;

1634 
ªsu…
->
numdisks
 = 
¶Ÿ
;

1638 
	}
}

1643 
log‹g
 *
	$disksim_log‹g_lﬂd∑øms
(
Õ_block
 *
b
)

1645 
c
;

1646 
log‹g
 *
ªsu…
;

1650 
ªsu…
 = 
	`mÆloc
((
log‹g
));

1651 
	`bzîo
(
ªsu…
, (
log‹g
));

1654 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
disksim_log‹g_mod
);

1656 
ªsu…
->
«me
 = 
	`°rdup
(
b
->name);

1659 
ªsu…
->
rmwpoöt
 = (Ë‘esu…->rmwpoöà* (Ëªsu…->
a˘uÆnumdisks
);

1662 if(
ªsu…
->
°ampfûe
) {

1663 
	`f˛o£
(
ªsu…
->
°ampfûe
);

1665 
ªsu…
->
°ampfûe
 = 
NULL
;

1668  
ªsu…
;

1669 
	}
}

1675 
INLINE
 
	$log‹g_£t_¨øydisk
(
log‹g
 *
l
, 
n
) {

1676 
l
->
¨øydisk
 = 
n
;

1677 
	}
}

1680 
log‹g
 *
	$gëlog‹gby«me
(
log‹g
 **
log‹gs
,

1681 
numlog‹gs
,

1682 *
«me
,

1683 *
n
)

1685 
c
;

1687 
c
 = 0; c < 
numlog‹gs
; c++) {

1688 if(
log‹gs
[
c
] == 0) ;

1690 if(!
	`°rcmp
(
log‹gs
[
c
]->
«me
,Çame)) {

1691 if(
n
 != 0) {

1692 *
n
 = 
c
;

1695  
log‹gs
[
c
];

1701 
	}
}

1704 
	$log‹g_˛ónup
(
log‹g
 *
l
) {

1705 if(
l
->
°ampfûe
) {

1706 
	`f˛o£
(
l
->
°ampfûe
);

1707 
l
->
°ampfûe
 = 
NULL
;

1709 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_logorg.h

101 #i‚de‡
DISKSIM_LOGORG_H


102 
	#DISKSIM_LOGORG_H


	)

104 
	~"disksim_globÆ.h
"

105 
	~"disksim_°©.h
"

106 
	~"disksim_iosim.h
"

107 
	~"disksim_‹gÁ˚.h
"

108 
	~"disksim_ioqueue.h
"

109 
	~"c⁄fig.h
"

114 
	#ASIS
 1

	)

115 
	#IDEAL
 2

	)

116 
	#RANDOM
 3

	)

117 
	#STRIPED
 4

	)

121 
	#NO_REDUN
 1

	)

122 
	#SHADOWED
 2

	)

123 
	#PARITY_DISK
 3

	)

124 
	#PARITY_ROTATED
 4

	)

125 
	#PARITY_TABLE
 5

	)

129 
	#SHADOW_PRIMARY
 1

	)

130 
	#SHADOW_RANDOM
 2

	)

131 
	#SHADOW_ROUNDROBIN
 3

	)

132 
	#SHADOW_SHORTDIST
 4

	)

133 
	#SHADOW_SHORTQUEUE
 5

	)

134 
	#SHADOW_SHORTQUEUE2
 6

	)

138 
	#PARITY_LEFT_SYM
 1

	)

139 
	#PARITY_LEFT_ASYM
 2

	)

140 
	#PARITY_RIGHT_ASYM
 3

	)

141 
	#PARITY_RIGHT_SYM
 4

	)

143 
	#LOGORG_PARITY_SEQGIVE
 32

	)

144 
	#MAXCOPIES
 10

	)

145 
	#NUMGENS
 50

	)

146 
	#HASH_OUTSTAND
 20

	)

148 
	#BLOCKINGMAX
 128

	)

149 
	#INTERFEREMAX
 32

	)

150 
	#INTDISTMAX
 8

	)

152 
	sdï
 {

153 
	mdevno
;

154 
	mblkno
;

155 
	mnumdïs
;

156 
dï
 *
	m√xt
;

157 
dï
 *
	mc⁄t
;

158 
i‹eq_evít
 *
	mdïs
[10];

159 } 
	tdïíds
;

161 
	sos
 {

162 
	m¨πime
;

163 
	mty≥
;

164 
os
 *
	m√xt
;

165 
os
 *
	m¥ev
;

166 
u_öt
 
	mbcou¡
;

167 
u_öt
 
	mblkno
;

168 
u_öt
 
	mÊags
;

169 
u_öt
 
	mbu¢o
;

170 
	mnumªqs
;

171 
u_öt
 
	mdevno
;

172 
	m›id
;

173 
	mªq›id
;

174 *
	mbuf
;

175 
dïíds
 *
	mdïíd
;

176 } 
	tout°™d
;

179 
	mouâime
;

180 
	mrunouâime
;

181 
	mout°™dög
;

182 
	mªadout°™dög
;

183 
	mmaxout°™dög
;

184 
	mn⁄zîoouâime
;

185 
	mªads
;

186 
	mgís
[
NUMGENS
];

187 
	m£qdiskswôches
;

188 
	mlocdiskswôches
;

189 
	mnumloˇl
;

190 
	m¸ôªads
;

191 
	m¸ôwrôes
;

192 
	m£qªads
;

193 
	m£qwrôes
;

194 
	mdi°avgdiff
[10];

195 
	mdi°maxdiff
[10];

196 
	midÀ°¨t
;

197 
	mœ°¨r
;

198 
	mœ°ªad
;

199 
	mœ°wrôe
;

200 *
	mblocked
;

201 *
	mÆig√d
;

202 *
	mœ°ªq
;

203 *
	mötdi°
;

204 
°©gí
 
	mª•time°©s
;

205 
°©gí
 
	midÀ°©s
;

206 
°©gí
 
	msize°©s
;

207 
°©gí
 
	mªadsize°©s
;

208 
°©gí
 
	mwrôesize°©s
;

209 
°©gí
 
	möèº°©s
;

210 
°©gí
 
	mªadöèº°©s
;

211 
°©gí
 
	mwrôeöèº°©s
;

212 } 
	tlog‹g°©
;

215 
	mdevno
;

216 
	m°¨tblkno
;

217 
ioq
 * 
	mqueue
;

218 
	mœ°blkno
;

219 
	m£qªads
;

220 
	m£qwrôes
;

221 
	mœ°blkno2
;

222 
	möåóds
;

223 
	mötwrôes
;

224 
	mnumout
;

225 
	mdi°numout
[10];

226 
	mcur°ªak
;

227 
°©gí
 
	m°ªak°©s
;

228 
°©gí
 
	mloˇlôy°©s
;

229 } 
	tlog‹gdev
;

232 
	mdevno
;

233 
	mblkno
;

234 } 
	tèbÀíåy
;

236 
	slog‹g
 {

237 *
	m«me
;

238 
out°™d
 * 
	mhashout°™d
[
HASH_OUTSTAND
];

239 
	mout°™dqÀn
;

240 
	m›id
;

241 
	maddrby∑πs
;

242 
	mm≠ty≥
;

243 
	mªdu¡y≥
;

244 
	mnumdisks
;

245 
	ma˘uÆnumdisks
;

246 
	m¨øydisk
;

247 
	mwrôesync
;

248 
	mc›õs
;

249 
	mc›ychoi˚
;

250 
	mrmwpoöt
;

251 
	m∑rôyunô
;

252 
	mrŸty≥
;

253 
	mblk•î∑π
;

254 
	ma˘uÆblk•î∑π
;

255 
	m°rùeunô
;

256 
	m£˘i⁄unô
;

257 
	mèbÀ°rùes
;

258 
èbÀíåy
 *
	mèbÀ
;

259 
	mèbÀsize
;

260 
	m∑π•î°rùe
;

261 
	midó o
;

262 
	mªdu¡oggÀ
;

263 
	mœ°diskac˚s£d
;

264 
	mnumfuŒ
;

265 *
	msizes
;

266 *
	mªdunsizes
;

267 
	m¥öéoˇlôy°©s
;

268 
	m¥ötblockög°©s
;

269 
	m¥ötöãr„ª°©s
;

270 
	m¥ötidÀ°©s
;

271 
	m¥ötöèº°©s
;

272 
	m¥öt°ªak°©s
;

273 
	m¥öt°amp°©s
;

274 
	m¥ötsize°©s
;

275 
	m°ampöãrvÆ
;

276 
	m°amp°¨t
;

277 
	m°amp°›
;

278 
FILE
 * 
	m°ampfûe
;

279 
log‹gdev
 *
	mdevs
;

280 
log‹g°©
 
	m°©
;

282 
	m°¨tdev
;

283 
	míddev
;

284 } 
	tlog‹g
;

290 
log‹g_shadowed
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numªqs
);

291 
log‹g_∑rôy_disk
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numªqs
);

292 
log‹g_∑rôy_rŸ©e
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numªqs
);

293 
log‹g_∑rôy_èbÀ
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numªqs
);

294 
log‹g_¸óã_èbÀ
 (
log‹g
 *
cuºlog‹g
);

295 
log‹g_èbuœr_rŸty≥
 (
m≠ty≥
, 
ªdu¡y≥
, 
rŸty≥
, 
°rùeunô
);

296 
log‹g_check_dïídícõs
 (
log‹g
 *
cuºlog‹g
, 
out°™d
 *
ªq
, 
i‹eq_evít
 *
cuº
);

300 
log‹g
 *
gëlog‹gby«me
÷og‹g **, , *
«me
, *
n
);

302 
INLINE
 
log‹g_£t_¨øydisk
(
log‹g
 *
l
, 
n
);

304 
log‹g
 *
gëlog‹gby«me
÷og‹g **
log‹gs
,

305 
numlog‹gs
,

306 *
«me
,

307 *
n
);

309 
log‹g_˛ónup
(
log‹g
 *);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_main.c

58 
	~"disksim_globÆ.h
"

61 
	$maö
 (
¨gc
, **
¨gv
)

63 
Àn
;

66 #i‚de‡
_WIN32


67 
	`£éöebuf
(
°dout
);

68 
	`£éöebuf
(
°dîr
);

71 if(
¨gc
 == 2) {

72 
	`disksim_ª°‹e_‰om_checkpoöt
 (
¨gv
[1]);

75 
disksim
 = 
	`ˇŒoc
(1, (disksim));

76 
	`disksim_öôülize_disksim_°ru˘uª
(
disksim
);

77 
	`disksim_£tup_disksim
 (
¨gc
, 
¨gv
);

79 
	`disksim_run_simuœti⁄
 ();

80 
	`disksim_˛ónup_™d_¥öt°©s
 ();

81 
	`exô
(0);

82 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_malloc.c

58 
	~"disksim_globÆ.h
"

59 
	~"disksim_mÆloc.h
"

62 
	~<°dlib.h
>

64 *
	$DISKSIM_mÆloc
 (
size
)

84  
	`mÆloc
(
size
);

86 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_malloc.h

58 #i‚de‡
DISKSIM_MALLOC_H


59 
	#DISKSIM_MALLOC_H


	)

64 * 
DISKSIM_mÆloc
 (
size
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_orgface.h

101 #i‚de‡
DISKSIM_ORGFACE_H


102 
	#DISKSIM_ORGFACE_H


	)

106 
	#COMPLETE
 -1

	)

107 
	#NOT_COMPLETE
 0

	)

111 
	glog‹g
;

112 
	gioq
;

115 
log‹g_∑øm_ovîride
 (
log‹g
 **
log‹gs
, 
numlog‹gs
, *
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

117 
log‹g_öôülize
 (
log‹g
 **
log‹gs
,

118 
numlog‹gs
,

119 
ioq
 **
queue£t
,

120 
¥öéoˇlôy°©s
,

121 
¥ötblockög°©s
,

122 
¥ötöãr„ª°©s
,

123 
¥öt°ªak°©s
,

124 
¥öt°amp°©s
,

125 
¥ötöèº°©s
,

126 
¥ötidÀ°©s
,

127 
¥ötsize°©s
);

129 
log‹g_ª£t°©s
 (
log‹g
 **
log‹gs
, 
numlog‹gs
);

130 
log‹g_¥öt°©s
 (
log‹g
 **
log‹gs
, 
numlog‹gs
, *
sour˚°r
);

131 
log‹g_˛ón°©s
 (
log‹g
 **
log‹gs
, 
numlog‹gs
);

132 
log‹g_m≠ªque°
 (
log‹g
 **
log‹gs
, 
numlog‹gs
, 
i‹eq_evít
 *
cuº
);

133 
log‹g_m≠com∂ëe
 (
log‹g
 **
log‹gs
, 
numlog‹gs
, 
i‹eq_evít
 *
cuº
);

134 
log‹g_øi£_¥i‹ôy
 (
log‹g
 **
log‹gs
, 
numlog‹gs
, 
›id
, 
devno
, 
blkno
, *
buf
);

135 
log‹g_time°amp
 (
i‹eq_evít
 *
cuº
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_pfdisp.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_pfsim.h
"

105 
	$pf_di•_put_©_íd_of_queue
(
¥o˚ss
 *
¥o˝
)

107 
¥o˚ss
 *
tmp
 = 
pf_di•q
;

109 
¥o˝
->
lök
 = 
NULL
;

110 i‡(
tmp
 =
NULL
) {

111 
pf_di•q
 = 
¥o˝
;

114 
tmp
->
lök
) {

115 
tmp
 =Åmp->
lök
;

117 
tmp
->
lök
 = 
¥o˝
;

119 
	}
}

122 
	$pf_di•_put_⁄_¶ìp_queue
 (
¥o˚ss
 *
¥o˝
)

124 
¥o˝
->
√xt
 = 
¶ìpqueue
;

125 
¶ìpqueue
 = 
¥o˝
;

126 
	}
}

129 
¥o˚ss
 *
	$pf_di•_gë_‰om_¶ìp_queue
 (*
ch™
)

131 
¥o˚ss
 *
tmp
 = 
¶ìpqueue
;

132 
¥o˚ss
 *
¥ev
 = 
tmp
;

134 i‡(
tmp
 =
NULL
) {

135 (
NULL
);

137 i‡(
tmp
->
ch™
 == chan) {

138 
¶ìpqueue
 = 
tmp
->
√xt
;

139 
tmp
->
√xt
 = 
NULL
;

140 (
tmp
);

142 
tmp
 =Åmp->
√xt
;

143 
tmp
) {

144 i‡(
tmp
->
ch™
 == chan) {

145 
¥ev
->
√xt
 = 
tmp
->next;

146 
tmp
->
√xt
 = 
NULL
;

147 (
tmp
);

149 
¥ev
 = 
tmp
;

150 
tmp
 =Åmp->
√xt
;

152 (
NULL
);

153 
	}
}

156 
¥o˚ss
 *
	$pf_di•_gë_•ecific_‰om_¶ìp_queue
 (
u_öt
 
pid
)

158 
¥o˚ss
 *
tmp
 = 
¶ìpqueue
;

159 
¥o˚ss
 *
¥ev
 = 
tmp
;

161 i‡(
tmp
 =
NULL
) {

162  (
NULL
);

164 i‡(
tmp
->
pid
 ==Öid) {

165 
¶ìpqueue
 = 
tmp
->
√xt
;

166 
tmp
->
√xt
 = 
NULL
;

167 (
tmp
);

169 
tmp
 =Åmp->
√xt
;

170 
tmp
) {

171 i‡(
tmp
->
pid
 ==Öid) {

172 
¥ev
->
√xt
 = 
tmp
->next;

173 
tmp
->
√xt
 = 
NULL
;

174 (
tmp
);

176 
¥ev
 = 
tmp
;

177 
tmp
 =Åmp->
√xt
;

179 (
NULL
);

180 
	}
}

183 
¥o˚ss
 *
	$pf_di•©ch
 (
˝unum
)

185 
¥o˚ss
 *
¥o˝
 = 
pf_di•q
;

187 i‡(
¥o˝
) {

188 
pf_di•q
 = 
¥o˝
->
lök
;

189 
¥o˝
->
run˝u
 = 
˝unum
;

190 
¥o˝
->
°©
 = 
PROC_ONPROC
;

202 (
¥o˝
);

203 
	}
}

206 
	$pf_di•©chî_öô
 (
¥o˚ss
 *
°¨çrocs
)

208 
¥o˚ss
 *
¥o˝
;

209 
¥o˚ss
 *
tmp
 = 
°¨çrocs
;

210 
i
;

217 
tmp
) {

218 
¥o˝
 = 
tmp
;

219 
tmp
 = 
¥o˝
->
√xt
;

221 
¥o˝
->
livñi°
 = 
¥o˚ss_livñi°
;

222 
¥o˚ss_livñi°
 = 
¥o˝
;

225 
¥o˝
->
pid
 +
num˝us
;

226 
	`pf_di•_put_©_íd_of_queue
(
¥o˝
);

235 
i
 = 0; i < 
num˝us
; i++) {

236 if(
˝us
[
i
].
cuºít
->
¥o˝
 =
NULL
) {

237 
˝us
[
i
].
cuºít
->
¥o˝
 = 
	`pf_di•©ch
(i);

240 
	}
}

243 
¥o˚ss
 * 
	$pf_di•_¶ìp
 (
¥o˚ss
 *
¥o˝
)

245 
¥o˝
->
°©
 = 
PROC_SLEEP
;

246 
	`pf_di•_put_⁄_¶ìp_queue
(
¥o˝
);

248 (
	`pf_di•©ch
(
¥o˝
->
run˝u
));

249 
	}
}

252 
	$pf_di•_wakeup
 (
¥o˚ss
 *
¥o˝
)

254 
c
;

255 
¥o˝
->
°©
 = 
PROC_RUN
;

256 
	`pf_di•_put_©_íd_of_queue
(
¥o˝
);

266 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_pfface.h

101 #i‚de‡
DISKSIM_PFFACE_H


102 
	#DISKSIM_PFFACE_H


	)

106 
	#SYNTHIO_OVERRIDE
 1

	)

110 
pf_£tˇŒbacks
 ();

111 
pf_öôülize
 (
£edvÆue
);

112 
pf_ª£t°©s
 ();

113 
pf_˛ón°©s
 ();

114 
pf_¥öt°©s
 ();

115 
pf_ªad∑øms
 (
FILE
 *
∑rfûe
);

116 
pf_∑øm_ovîride
 (
°ru˘ty≥
, *
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

117 
pf_öã∫Æ_evít
 (
evít
 *
cuº
);

119 
evít
 * 
pf_io_d⁄e_nŸify
 (
i‹eq_evít
 *
cuº
, *
˘x
);

121 
pf_h™dÀ_öå_evít
 (
öå_evít
 *
öåp
, 
˝unum
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_pfsim.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_°©.h
"

103 
	~"disksim_pfÁ˚.h
"

104 
	~"disksim_pfsim.h
"

105 
	~"disksim_ioÁ˚.h
"

106 
	~"disksim_sy¡hio.h
"

107 
	~"c⁄fig.h
"

109 
	~"moduÀs/moduÀs.h
"

112 
	$pf_how_m™y_˝us
()

114  (
num˝us
);

115 
	}
}

118 
	$pf_Æloˇã_¥o˚ss_°ru˘s
()

120 
i
;

121 
¥o˚ss
 *
ãmp
 = (¥o˚s†*Ë
	`DISKSIM_mÆloc
(
ALLOCSIZE
);

123 
	`ASSERT
(
ãmp
 !
NULL
);

124 
i
=0; i<((
ALLOCSIZE
/(
¥o˚ss
))-1); i++) {

125 
ãmp
[
i
].
√xt
 = &temp[i+1];

127 
ãmp
[((
ALLOCSIZE
/(
¥o˚ss
))-1)].
√xt
 = 
NULL
;

128 
exåa_¥o˚ss_q
 = 
ãmp
;

129 
exåa_¥o˚ss_qÀn
 = 
ALLOCSIZE
/(
¥o˚ss
);

130 
	}
}

134 
	$pf_addt€xåa_¥o˚ss_q
(
ãmp
)

135 
¥o˚ss
 *
ãmp
;

137 
ãmp
->
√xt
 = 
exåa_¥o˚ss_q
;

138 
exåa_¥o˚ss_q
 = 
ãmp
;

139 
exåa_¥o˚ss_qÀn
++;

140 
	}
}

144 
¥o˚ss
 *
	$pf_gë‰omexåa_¥o˚ss_q
()

146 
¥o˚ss
 *
ãmp
 = 
exåa_¥o˚ss_q
;

148 i‡(
exåa_¥o˚ss_qÀn
 == 0) {

149 
	`pf_Æloˇã_¥o˚ss_°ru˘s
();

150 
ãmp
 = 
exåa_¥o˚ss_q
;

151 
exåa_¥o˚ss_q
 =Éxåa_¥o˚ss_q->
√xt
;

152 } i‡(
exåa_¥o˚ss_qÀn
 == 1) {

153 
exåa_¥o˚ss_q
 = 
NULL
;

155 
exåa_¥o˚ss_q
 =Éxåa_¥o˚ss_q->
√xt
;

157 
exåa_¥o˚ss_qÀn
--;

158 
ãmp
->
pfÊags
 = 0;

159 
ãmp
->
°©
 = 
PROC_RUN
;

160 
ãmp
->
idÀr
 = 0;

161 
ãmp
->
run˝u
 = 0;

162 
ãmp
->
Êags
 = 0;

163 
ãmp
->
ch™
 = 0;

164 
ãmp
->
ios
 = 0;

165 
ãmp
->
i‹óds
 = 0;

166 
ãmp
->
cswôches
 = 0;

167 
ãmp
->
a˘ive
 = 0;

168 
ãmp
->
¶ìps
 = 0;

169 
ãmp
->
io¶ìp
 = 0;

170 
ãmp
->
io¶ìps
 = 0;

171 
ãmp
->
runio¶ìp
 = 0.0;

172 
ãmp
->
œ°¶ìp
 = 0.0;

173 
ãmp
->
run¶ìp
 = 0.0;

174 
ãmp
->
ru¡ime
 = 0.0;

175 
ãmp
->
Ál£idÀtime
 = 0.0;

176 
ãmp
->
œ°evíâime
 = -1.0;

177 
	`°©_öôülize
(
°©deffûe
, "Timêlimô duøti⁄", &
ãmp
->
ªadtimñimô°©s
);

178 
	`°©_öôülize
(
°©deffûe
, "Timêlimô duøti⁄", &
ãmp
->
wrôëimñimô°©s
);

179 
	`°©_öôülize
(
°©deffûe
, "Timêlimô duøti⁄", &
ãmp
->
ªadmis¶imô°©s
);

180 
	`°©_öôülize
(
°©deffûe
, "Timêlimô duøti⁄", &
ãmp
->
wrôemis¶imô°©s
);

181 
ãmp
->
i‹eq
 = 
NULL
;

182 
ãmp
->
evíéi°
 = 
NULL
;

183 
ãmp
->
•a˚
 = 
NULL
;

184 
ãmp
->
lök
 = 
NULL
;

185 
ãmp
->
√xt
 = 
NULL
;

186 (
ãmp
);

187 
	}
}

193 
¥o˚ss
 * 
	$pf_√w_¥o˚ss
()

195 
¥o˚ss
 *
¥o˝
 = 
	`pf_gë‰omexåa_¥o˚ss_q
();

197 
¥o˝
->
pid
 = (
sy¡hli°
) ? (synthlist->pid + 1) : 0;

198 
¥o˝
->
√xt
 = 
sy¡hli°
;

199 
sy¡hli°
 = 
¥o˝
;

200 (
¥o˝
);

201 
	}
}

205 
evít
 * 
	$pf_ªmove_‰om_¥o˚ss_evíéi°
 (
¥o˚ss
 *
¥o˝
)

207 
evít
 *
ﬁd
 = 
¥o˝
->
evíéi°
;

208 
¥o˝
->
evíéi°
 = 
ﬁd
->
√xt
;

209 (
ﬁd
);

210 
	}
}

214 
	$pf_add_to_¥o˚ss_evíéi°
 (
¥o˚ss
 *
¥o˝
, 
evít
 *
√w
)

216 
√w
->
√xt
 = 
¥o˝
->
evíéi°
;

217 
¥o˝
->
evíéi°
 = 
√w
;

218 
	}
}

221 
	$pf_add_to_öåp_evíéi°
 (
öå_evít
 *
öåp
, 
evít
 *
√w
)

223 
√w
->
√xt
 = 
öåp
->
evíéi°
;

224 
öåp
->
evíéi°
 = 
√w
;

225 
	}
}

228 
	$pf_add_Ál£_idÀ_time
 (
Àngth
)

230 
ªt
 = 0.0;

231 
¥o˚ss
 *
¥o˝
 = 
¥o˚ss_livñi°
;

232 
¥o˝
 !
NULL
) {

233 i‡((
¥o˝
->
°©
 =
PROC_SLEEP
Ë&& (¥o˝->
io¶ìp
)) {

234 
¥o˝
->
Ál£idÀtime
 +
Àngth
;

235 
ªt
 = 
Àngth
;

236 } i‡((
¥o˝
->
°©
 =
PROC_RUN
Ë&& (¥o˝->
pfÊags
 & 
PF_SLEEP_FLAG
Ë&& (¥o˝->
io¶ìp
)) {

237 
¥o˝
->
Ál£idÀtime
 +
Àngth
;

238 
ªt
 = 
Àngth
;

239 } i‡((
¥o˝
->
°©
 =
PROC_ONPROC
Ë&& (
˝us
[¥o˝->
run˝u
].
°©e
 =
CPU_IDLE
Ë&& (¥o˝->
pfÊags
 & 
PF_SLEEP_FLAG
Ë&& (¥o˝->
io¶ìp
)) {

240 
¥o˝
->
Ál£idÀtime
 +
Àngth
;

241 
ªt
 = 
Àngth
;

243 
¥o˝
 =Öro˝->
livñi°
;

245 (
ªt
);

246 
	}
}

249 
	$pf_add_to_≥ndiﬁi°
 (
¥o˚ss
 *
¥o˝
, 
i‹eq_evít
 *
cuº
)

251 
i‹eq_evít
 *
√w
 = (i‹eq_evíà*)
	`gë‰omexåaq
();

252 
√w
->
time
 = 
simtime
;

253 
√w
->
devno
 = 
cuº
->devno;

254 
√w
->
blkno
 = 
cuº
->blkno;

255 
√w
->
buf
 = 
cuº
->buf;

256 
√w
->
›id
 = 
cuº
->opid;

257 
√w
->
ãmµå1
 = 
¥o˝
;

258 
√w
->
ãmpöt2
 = -1;

259 
√w
->
Êags
 = 
cuº
->Êag†& ~
PF_BUF_WANTED
;

260 
√w
->
¥ev
 = 
NULL
;

261 
√w
->
√xt
 = 
≥ndiﬁi°
;

262 
≥ndiﬁi°
 = 
√w
;

263 
	}
}

266 
evít
 * 
	$pf_io_d⁄e_nŸify
 (
i‹eq_evít
 *
cuº
, *
˘x
)

268 
i‹eq_evít
 *
tmp
 = 
≥ndiﬁi°
;

269 
i‹eq_evít
 *
tmp2
;

270 
wakeup_evít
 *
tmpwake
 = 
NULL
;

272 if(
disksim
->
exã∫Æ_c⁄åﬁ
){

273 
disksim
->
	`exã∫Æ_io_d⁄e_nŸify
 (
cuº
, 
˘x
);

276 i‡(
pf_¥öthack
) {

277 
	`Ârötf
 (
ouçutfûe
, "pf_io_d⁄e_nŸify: cuº->bu‡%p, cuº->›id %x, cuº->blknÿ%d\n", 
cuº
->
buf
, cuº->
›id
, cuº->
blkno
);

280 
	`ASSERT
(
≥ndiﬁi°
 !
NULL
);

281 i‡((
tmp
->
buf
 =
cuº
->bufË&& (tmp->
›id
 == curr->opid)) {

282 
≥ndiﬁi°
 = 
tmp
->
√xt
;

285 (
tmp
->
√xt
) &&

286 ((
tmp
->
√xt
->
buf
 !
cuº
->buf) ||

287 (
tmp
->
√xt
->
›id
 !
cuº
->opid)))

289 
tmp
 =Åmp->
√xt
;

292 
	`ASSERT
(
tmp
->
√xt
 !
NULL
);

293 
tmp2
 = 
tmp
->
√xt
;

294 
tmp
->
√xt
 = 
tmp2
->next;

295 
tmp
 = 
tmp2
;

298 i‡(
tmp
->
Êags
 & 
PF_BUF_WANTED
) {

299 
tmpwake
 = (
wakeup_evít
 *Ë
	`gë‰omexåaq
();

300 
tmpwake
->
ty≥
 = 
WAKEUP_EVENT
;

302 
tmpwake
->
√xt
 = 
NULL
;

303 
tmpwake
->
ch™
 = 
tmp
->
buf
;

304 
tmpwake
->
dr›ô
 = 0;

307 i‡(
cuº
->
Êags
 & 
TIME_CRITICAL
) {

308 
	`°©_upd©e
(&
time¸ôª•°©s
, (
simtime
 - 
tmp
->
time
));

310 i‡(
cuº
->
Êags
 & 
TIME_LIMITED
) {

311 
	`°©_upd©e
(&
timñimôª•°©s
, (
simtime
 - 
tmp
->
time
));

314 
	`°©_upd©e
(&
timí⁄¸ôª•°©s
, (
simtime
 - 
tmp
->
time
));

317 i‡(!(
cuº
->
Êags
 & 
TIME_LIMITED
Ë|| (
tmpwake
)) {

318 
	`addt€xåaq
((
evít
 *Ë
tmp
);

321 
tmp
->
√xt
 = 
d⁄eiﬁi°
;

322 
d⁄eiﬁi°
 = 
tmp
;

324 ((
evít
 *Ë
tmpwake
);

325 
	}
}

328 
	$pf_iowaô
 (*
ch™
, 
¥o˚ss
 *
¥o˝
)

330 
tm±ime
;

331 
i‹eq_evít
 *
tmp
 = 
≥ndiﬁi°
;

333 (
tmp
Ë&& (tmp->
buf
 !
ch™
)) {

334 
tmp
 =Åmp->
√xt
;

336 i‡(
tmp
 =
NULL
) {

337 
i‹eq_evít
 *
¥ev
 = 0;

338 
tmp
 = 
d⁄eiﬁi°
;

339 (
tmp
Ë&& (tmp->
buf
 !
ch™
)) {

340 
¥ev
 = 
tmp
;

341 
tmp
 =Åmp->
√xt
;

343 i‡(
tmp
) {

344 i‡(
d⁄eiﬁi°
 =
tmp
) {

345 
d⁄eiﬁi°
 = 
tmp
->
√xt
;

347 
¥ev
->
√xt
 = 
tmp
->next;

349 i‡(
tmp
->
Êags
 & 
READ
) {

350 
	`°©_upd©e
(&
¥o˝
->
ªadtimñimô°©s
, (
simtime
 - 
tmp
->
time
));

352 
	`°©_upd©e
(&
¥o˝
->
wrôëimñimô°©s
, (
simtime
 - 
tmp
->
time
));

354 
	`addt€xåaq
((
evít
 *Ë
tmp
);

356 (
FALSE
);

359 i‡(
pf_¥öthack
)

360 
	`Ârötf
 (
ouçutfûe
, "pf_iowaô: ch™ %p,Ñód %d, crô %d, opid %d, blknÿ%x\n", 
tmp
->
buf
, (tmp->
Êags
 & 
READ
), (tmp->Êag†& (
TIME_LIMITED
|
TIME_CRITICAL
)),Åmp->
›id
,Åmp->
blkno
);

362 i‡(
tmp
->
Êags
 & 
TIME_LIMITED
) {

363 i‡(
tmp
->
Êags
 & 
READ
) {

364 
	`°©_upd©e
(&
¥o˝
->
ªadtimñimô°©s
, (
simtime
 - 
tmp
->
time
));

365 
	`°©_upd©e
(&
¥o˝
->
ªadmis¶imô°©s
, (
simtime
 - 
tmp
->
time
));

367 
	`°©_upd©e
(&
¥o˝
->
wrôëimñimô°©s
, (
simtime
 - 
tmp
->
time
));

368 
	`°©_upd©e
(&
¥o˝
->
wrôemis¶imô°©s
, (
simtime
 - 
tmp
->
time
));

371 
tmp
->
Êags
 |
PF_BUF_WANTED
;

372 
tm±ime
 = 
	`io_øi£_¥i‹ôy
(
tmp
->
›id
,Åmp->
devno
,Åmp->
blkno
,Åmp->
buf
);

373 i‡(
tm±ime
 != 0.0) {

374 
	`Ârötf
(
°dîr
, "Haven't handledÇon-zero bufferwaitÅime yet\n");

375 
	`exô
(1);

377 (
TRUE
);

378 
	}
}

381 
	$pf_add_cswôch_evít
 (
¥o˚ss
 *
¥o˝
,Öro˚s†*
√w¥o˝
, 
˝u_evít
 *
˝u_ev
)

383 
˝u
 *
cuº˝u
 = &
˝us
[(
˝u_ev
->
˝unum
)];

384 
cswôch_evít
 *
√w
 = (cswôch_evíà*Ë
	`gë‰omexåaq
();

385 
√w
->
ty≥
 = 
CSWITCH_EVENT
;

386 
√w
->
√w¥o˝
 =Çewprocp;

387 i‡(
¥o˝
 !
√w¥o˝
) {

388 
√w
->
time
 = 
PF_CSWITCH_TIME
;

389 
cuº˝u
->
cswôches
++;

391 
√w
->
time
 = 0.0;

393 
cuº˝u
->
runswôchtime
 +
√w
->
time
;

394 i‡(
¥o˝
) {

395 
	`pf_add_to_¥o˚ss_evíéi°
(
¥o˝
, (
evít
 *Ë
√w
);

397 
√w
->
√xt
 = 
cuº˝u
->
idÀevíts
;

398 
cuº˝u
->
idÀevíts
 = (
evít
 *Ë
√w
;

400 
	}
}

403 
	$pf_gë_time_to_√xt_¥o˚ss_evít
 (
¥o˚ss
 *
¥o˝
)

405 
tm±ime
;

407 i‡(
¥o˝
->
evíéi°
 =
NULL
) {

408 
	`Ârötf
 (
ouçutfûe
, "A˘ivê¥o˚s†©Énd o‡evíéi°: %d\n", 
¥o˝
->
pid
);

409 
	`disksim_sim°›
();

413 
tm±ime
 = 
¥o˝
->
evíéi°
->
time
;

414 
¥o˝
->
evíéi°
->
time
 = 
simtime
;

415 (
tm±ime
);

416 
	}
}

419 
	$pf_gë_time_to_√xt_öå_evít
 (
öå_evít
 *
öåp
)

421 
tm±ime
;

423 
	`ASSERT
(
öåp
->
evíéi°
 !
NULL
);

424 
tm±ime
 = 
öåp
->
evíéi°
->
time
;

425 
öåp
->
evíéi°
->
time
 = 
simtime
;

426 (
tm±ime
);

427 
	}
}

432 
	$pf_idÀ_˝u_ªcheck_di•q
 (
˝unum
)

434 
	`ASSERT
(
˝us
[
˝unum
].
cuºít
->
¥o˝
 =
NULL
);

436 i‡(
˝us
[
˝unum
].
idÀevíts
 =
NULL
) {

437 
evít
 *
√w
 = 
	`gë‰omexåaq
();

438 
√w
->
ty≥
 = 
IDLELOOP_EVENT
;

439 
√w
->
time
 = 
PF_IDLE_CHECK_DISPQ_TIME
;

440 
√w
->
√xt
 = 
˝us
[
˝unum
].
idÀevíts
;

441 
˝us
[
˝unum
].
idÀevíts
 = 
√w
;

443 i‡(
˝us
[
˝unum
].
cuºít
->
öåp
 =
NULL
) {

444 
˝us
[
˝unum
].
idÀtime
 +
simtime
 - cpus[˝unum].
idÀ°¨t
;

445 
˝us
[
˝unum
].
Ál£idÀtime
 +
	`pf_add_Ál£_idÀ_time
(
simtime
 - cpus[˝unum].
idÀ°¨t
);

446 
˝us
[
˝unum
].
cuºít
->
time
 = 
simtime
 + (˝us[˝unum].
sˇÀ
 * 
√w
->time);

447 
√w
->
time
 = 
simtime
;

448 
˝us
[
˝unum
].
°©e
 = 
CPU_IDLE_WORK
;

449 
	`addtoötq
((
evít
 *Ë
˝us
[
˝unum
].
cuºít
);

452 
	}
}

455 
	$pf_h™dÀ_cswôch_evít
 (
cswôch_evít
 *
cuº
, 
˝u_evít
 *
˝u_ev
)

457 
¥o˚ss
 *
¥o˝
 = 
NULL
;

459 i‡(
pf_¥öthack
)

460 
	`Ârötf
 (
ouçutfûe
, "%.3f\tCONTEXT SWITCH cpu=%dÖid=%d,Çewpid=%d\n", 
simtime
, 
˝u_ev
->
˝unum
, ((˝u_ev->
¥o˝
Ë? cpu_ev->¥o˝->
pid
 : 0), ((
cuº
->
√w¥o˝
) ? curr->newprocp->pid : 0));

462 i‡(
˝u_ev
->
¥o˝
) {

463 i‡(
˝u_ev
->
¥o˝
->
idÀr
 == 0) {

464 
œ°u£r
 = 
simtime
;

466 
˝u_ev
->
¥o˝
->
cswôches
++;

471 i‡((
idÀª£t
 == 0) &&

472 ((
cuº
->
√w¥o˝
 =
NULL
) ||

473 (
cuº
->
√w¥o˝
->
idÀr
 != 0))) {

474 
idÀö
 = 
simtime
;

475 
idÀª£t
 = 1;

478 
idÀª£t
 = 0;

481 
˝u_ev
->
¥o˝
 = 
cuº
->
√w¥o˝
;

482 
˝us
[(
˝u_ev
->
˝unum
)].
°©e
 = (
cuº
->
√w¥o˝
Ë? 
CPU_PROCESS
 : 
CPU_IDLE
;

483 i‡(
˝u_ev
->
¥o˝
) {

484 
˝u_ev
->
¥o˝
->
pfÊags
 &~
PF_SLEEP_FLAG
;

487 i‡((
˝u_ev
->
¥o˝
 =
NULL
Ë&& (
pf_di•q
)) {

488 
¥o˝
 = 
	`pf_di•©ch
(
˝u_ev
->
˝unum
);

489 i‡(
¥o˝
 !
˝u_ev
->procp) {

490 
	`pf_add_cswôch_evít
(
˝u_ev
->
¥o˝
,Örocp, cpu_ev);

493 
	`addli°t€xåaq
((
evít
 **Ë&
˝us
[(
˝u_ev
->
˝unum
)].
idÀevíts
);

495 
	}
}

498 
	$pf_h™dÀ_idÀlo›_evít
 (
idÀlo›_evít
 *
cuº
, 
˝u_evít
 *
˝u_ev
)

500 
¥o˚ss
 *
¥o˝
;

502 i‡(
pf_¥öthack
)

503 
	`Ârötf
 (
ouçutfûe
, "%f\tIDLELOOP cpu=%d\n", 
simtime
, 
˝u_ev
->
˝unum
);

505 
	`ASSERT
(
˝u_ev
->
¥o˝
 =
NULL
);

506 
¥o˝
 = 
	`pf_di•©ch
(
˝u_ev
->
˝unum
);

507 i‡(
¥o˝
 !
˝u_ev
->procp) {

508 
	`pf_add_cswôch_evít
(
˝u_ev
->
¥o˝
,Örocp, cpu_ev);

510 
	}
}

513 
	$pf_h™dÀ_¶ìp_evít
 (
¶ìp_evít
 *
cuº
, 
˝u_evít
 *
˝u_ev
)

515 
¥o˚ss
 *
¥o˝
 = 
˝u_ev
->procp;

516 
¥o˚ss
 *
√w¥o˝
;

518 i‡(
pf_¥öthack
)

519 
	`Ârötf
 (
ouçutfûe
, "%f\tSLEEP cpu=%dÖid=%d ch™=%∞öfo=%d io¶ìp=%d\n", 
simtime
, 
˝u_ev
->
˝unum
, 
¥o˝
->
pid
, 
cuº
->
ch™
, cuº->
öfo
, cuº->
io¶ìp
);

521 i‡(
	`pf_iowaô
(
cuº
->
ch™
, 
¥o˝
)) {

522 
	`ASSERT
(
cuº
->
io¶ìp
 > 0);

523 
¥o˝
->
io¶ìp
 = 
TRUE
;

524 
¥o˝
->
io¶ìps
++;

525 } i‡(
cuº
->
io¶ìp
) {

528 
	`ASSERT
 (0);

530 
¥o˝
->
pfÊags
 |
PF_SLEEP_FLAG
;

531 
¥o˝
->
ch™
 = 
cuº
->chan;

532 
√w¥o˝
 = 
	`pf_di•_¶ìp
(
¥o˝
);

533 
	`pf_add_cswôch_evít
(
¥o˝
, 
√w¥o˝
, 
˝u_ev
);

534 
¥o˝
->
œ°¶ìp
 = 
simtime
;

535 
¥o˝
->
¶ìps
++;

536 
	}
}

539 
	$pf_h™dÀ_wakeup_evít
(
wakeup_evít
 *
cuº
, 
˝u_evít
 *
˝u_ev
)

541 
¥o˚ss
 *
¥o˝
;

543 i‡(
pf_¥öthack
) {

544 
	`Ârötf
 (
ouçutfûe
, "%f\tWAKEUP cpu=%d chan=%p info=%d\n",

545 
simtime
, 
˝u_ev
->
˝unum
, 
cuº
->
ch™
, cuº->
öfo
);

548 (
¥o˝
 = 
	`pf_di•_gë_‰om_¶ìp_queue
(
cuº
->
ch™
))) {

550 i‡(
pf_¥öthack
) {

551 
	`Ârötf
 (
ouçutfûe
, "Wakög u∞¥o˚s†%d\n", 
¥o˝
->
pid
);

554 
¥o˝
->
run¶ìp
 +
simtime
 -Öro˝->
œ°¶ìp
;

555 i‡(
¥o˝
->
io¶ìp
 == 1) {

556 
¥o˝
->
runio¶ìp
 +
simtime
 -Öro˝->
œ°¶ìp
;

558 
	`pf_di•_wakeup
(
¥o˝
);

561 
¥o˝
 = 
˝u_ev
->procp;

562 i‡((
¥o˝
)

563 && ((
¥o˝
->
pfÊags
 & 
PF_SLEEP_FLAG
)

564 && (
¥o˝
->
ch™
 =
cuº
->chan)))

566 
¥o˝
->
pfÊags
 |
PF_WAKED
;

568 
	}
}

571 
	$pf_h™dÀ_i‹eq_evít
 (
i‹eq_evít
 *
cuº
, 
˝u_evít
 *
˝u_ev
)

573 
¥o˚ss
 *
¥o˝
 = 
˝u_ev
->procp;

574 
i‹eq_evít
 *
√w
;

575 
i‹eq_evít
 *
tmp
;

577 
	`io_m≠_åa˚_ªque°
(
cuº
);

578 
cuº
->
√xt
 = 
NULL
;

580 i‡(
pf_¥öthack
)

581 
	`Ârötf
 (
ouçutfûe
, "%f\tIOREQ cpu=%d opid=%d buf=%∞blkno=%x fœgs=%x, bcou¡=%d\n", 
simtime
, 
˝u_ev
->
˝unum
, 
cuº
->
›id
, cuº->
buf
, cuº->
blkno
, cuº->
Êags
, cuº->
bcou¡
);

583 
cuº
->
Êags
 &~(
TIMED_OUT
|
HALF_OUT
);

585 
	`pf_add_to_≥ndiﬁi°
(
¥o˝
, 
cuº
);

587 i‡(
˝u_ev
->
öåp
 =
NULL
) {

588 
¥o˝
->
ios
++;

589 i‡(
cuº
->
Êags
 & 
READ
) {

590 
¥o˝
->
i‹óds
++;

593 
cuº
->
ˇu£
 = 0;

594 
√w
 = (
i‹eq_evít
 *Ë
	`io_ªque°
(
cuº
);

595 i‡(
√w
) {

596 
tmp
 = (
i‹eq_evít
 *Ë
¥o˝
->
evíéi°
;

597 
¥o˝
->
evíéi°
 = (
evít
 *Ë
√w
;

598 
√w
->
√xt
) {

599 
√w
 =Çew->
√xt
;

601 
√w
->
√xt
 = 
tmp
;

603 
	}
}

606 
	$pf_h™dÀ_iﬂcc_evít
 (
i‹eq_evít
 *
cuº
, 
˝u_evít
 *
˝u_ev
)

608 i‡(
pf_¥öthack
)

609 
	`Ârötf
 (
ouçutfûe
, "%f\tIOACC cpu=%d opid=%d blkno=%x\n", 
simtime
, 
˝u_ev
->
˝unum
, 
cuº
->
›id
, cuº->
blkno
);

611 
	`io_scheduÀ
(
cuº
);

612 
	}
}

615 
	$pf_h™dÀ_io_öã∫Æ_evít
 (
i‹eq_evít
 *
cuº
, 
˝u_evít
 *
˝u_ev
)

617 i‡(
pf_¥öthack
)

618 
	`Ârötf
 (
ouçutfûe
, "%f\tIO INTERNAL cpu=%dÅy≥ %d opid=%d blkno=%x buf=%p\n", 
simtime
, 
˝u_ev
->
˝unum
, 
cuº
->
ty≥
, cuº->
›id
, cuº->
blkno
, cuº->
buf
);

620 i‡(
cuº
->
ty≥
 =
IO_REQUEST_ARRIVE
) {

621 
i‹eq_evít
 *
√w
 = (i‹eq_evíà*Ë
	`io_ªque°
 (
cuº
);

622 i‡(
√w
) {

623 
öå_evít
 *
öåp
 = 
˝u_ev
->intrp;

624 
i‹eq_evít
 *
tmp
;

625 
	`ASSERT
 (
öåp
 !
NULL
);

627 
tmp
 = (
i‹eq_evít
 *Ë
öåp
->
evíéi°
;

628 
öåp
->
evíéi°
 = (
evít
 *Ë
√w
;

629 
√w
->
√xt
) {

630 
√w
 =Çew->
√xt
;

632 
√w
->
√xt
 = 
tmp
;

635 
	`io_öã∫Æ_evít
(
cuº
);

637 
	}
}

640 
	$pf_˛ock_öãºu±_com∂ëe
 (
öå_evít
 *
öåp
)

642 
	`addt€xåaq
((
evít
 *Ë
öåp
);

643 
	}
}

646 
	$pf_h™dÀ_öãnd_evít
 (
öãnd_evít
 *
cuº
, 
˝u_evít
 *
˝u_ev
)

648 
öå_evít
 *
öåp
 = 
˝u_ev
->intrp;

649 
¥o˚ss
 *
¥o˝
 = 
˝u_ev
->procp;

650 
˝u
 *
cuº˝u
 = &
˝us
[(
˝u_ev
->
˝unum
)];

652 i‡(
pf_¥öthack
)

653 
	`Ârötf
 (
ouçutfûe
, "%f\tINTEND cpu=%d\n", 
simtime
, 
˝u_ev
->
˝unum
);

655 
˝u_ev
->
öåp
 = (
öå_evít
 *Ëöåp->
√xt
;

656 
cuº˝u
->
°©e
 = 
öåp
->
ﬁd°©e
;

657 
cuº˝u
->
öås
++;

658 
cuº˝u
->
runöåtime
 +
öåp
->
ru¡ime
;

659 i‡(
öåp
->
ve˘‹
 =
IO_INTERRUPT
) {

660 
cuº˝u
->
ioöås
++;

661 
cuº˝u
->
runioöåtime
 +
öåp
->
ru¡ime
;

662 
	`io_öãºu±_com∂ëe
 ((
i‹eq_evít
 *Ë
öåp
);

663 } i‡(
öåp
->
ve˘‹
 =
CLOCK_INTERRUPT
) {

664 
cuº˝u
->
˛ocköås
++;

665 
cuº˝u
->
run˛ocköåtime
 +
öåp
->
ru¡ime
;

666 
	`pf_˛ock_öãºu±_com∂ëe
(
öåp
);

668 
	`Ârötf
 (
°dîr
, "pf_h™dÀ_öãnd_evít: unknow¿öãºu± ve˘‹ (%d)\n", 
öåp
->
ve˘‹
);

669 
	`exô
(1);

671 
öåp
 = 
˝u_ev
->intrp;

672 i‡(
öåp
 =
NULL
) {

673 i‡((
¥o˝
 =
NULL
Ë&& (
pf_di•q
)) {

674 
¥o˝
 = 
	`pf_di•©ch
(
˝u_ev
->
˝unum
);

675 
	`as£π
 (
¥o˝
 !
NULL
);

676 
	`pf_add_cswôch_evít
 (
NULL
, 
¥o˝
, 
˝u_ev
);

678 i‡((
¥o˝
 =
NULL
Ë|| (¥o˝->
idÀr
 != 0)) {

679 i‡((
idÀª£t
Ë&& ((
simtime
 - 
idÀö
) > () 50000.0)) {

680 
	`Ârötf
 (
ouçutfûe
, "IdleÖrocess has beenÑunning for moreÅhan 50 seconds\n");

681 
	`disksim_sim°›
();

685 
	}
}

688 
	$pf_h™dÀ_sy¡hio_evít
 (
evít
 *
cuº
, 
˝u_evít
 *
˝u_ev
)

693 
cuº
->
time
 = 0.0;

694 
cuº
->
√xt
 = 
˝u_ev
->
¥o˝
->
evíéi°
;

695 
˝u_ev
->
¥o˝
->
evíéi°
 = 
cuº
;

696 
	`sy¡hio_gíî©e_io_a˘ivôy
(
˝u_ev
->
¥o˝
);

697 
	}
}

700 
	$pf_h™dÀ_evít
 (
evít
 *
cuº
, 
˝u_evít
 *
˝u_ev
)

702 i‡(
pf_¥öthack
) {

703 
	`Ârötf
 (
ouçutfûe
, "%f,É¡îedÖf_h™dÀ_evíàwôhÉvíàty≥ %d\n", 
simtime
, 
cuº
->
ty≥
);

704 
	`fÊush
(
ouçutfûe
);

707 
cuº
->
ty≥
) {

708 
IDLELOOP_EVENT
:

709 
	`pf_h™dÀ_idÀlo›_evít
((
idÀlo›_evít
 *)
cuº
, 
˝u_ev
);

711 
CSWITCH_EVENT
:

712 
	`pf_h™dÀ_cswôch_evít
((
cswôch_evít
 *)
cuº
, 
˝u_ev
);

714 
SLEEP_EVENT
:

715 
	`pf_h™dÀ_¶ìp_evít
((
¶ìp_evít
 *)
cuº
, 
˝u_ev
);

717 
WAKEUP_EVENT
:

718 
	`pf_h™dÀ_wakeup_evít
((
wakeup_evít
 *)
cuº
, 
˝u_ev
);

720 
IOREQ_EVENT
:

721 
	`pf_h™dÀ_i‹eq_evít
((
i‹eq_evít
 *)
cuº
, 
˝u_ev
);

722 
cuº
 = 
NULL
;

724 
IOACC_EVENT
:

725 
	`pf_h™dÀ_iﬂcc_evít
((
i‹eq_evít
 *)
cuº
, 
˝u_ev
);

726 
cuº
 = 
NULL
;

728 
INTEND_EVENT
:

729 
	`pf_h™dÀ_öãnd_evít
((
öãnd_evít
 *)
cuº
, 
˝u_ev
);

731 
SYNTHIO_EVENT
:

732 
	`pf_h™dÀ_sy¡hio_evít
(
cuº
, 
˝u_ev
);

733 
cuº
 = 
NULL
;

736 i‡((
cuº
->
ty≥
 >
IO_MIN_EVENT
Ë&& (cuº->ty≥ <
IO_MAX_EVENT
)) {

737 
	`pf_h™dÀ_io_öã∫Æ_evít
((
i‹eq_evít
 *)
cuº
, 
˝u_ev
);

738 
cuº
 = 
NULL
;

741 
	`Ârötf
(
°dîr
, "TryögÅÿh™dÀ unknow¿p‡evíà- %d\n", 
cuº
->
ty≥
);

742 
	`exô
(1);

744 
	`addt€xåaq
((
evít
 *Ë
cuº
);

745 
	}
}

748 
	$pf_h™dÀ_io_öå_¨rive
 (
öå_evít
 *
öåp
, 
˝u_evít
 *
˝u_ev
)

750 i‡(
pf_¥öthack
) {

751 
i‹eq_evít
 *
tmp
 = (i‹eq_evíà*Ë
öåp
->
öf›å
;

752 
	`Ârötf
 (
ouçutfûe
, "%f\tIO_INTERRUPT cpu %d cau£ %d bu‡%p\n", 
simtime
, 
˝u_ev
->
˝unum
, 
tmp
->
ˇu£
,Åmp->
buf
);

755 
	`io_öãºu±_¨rive
 ((
i‹eq_evít
 *)
öåp
);

756 
	}
}

759 
	$pf_h™dÀ_˛ock_öå_¨rive
 (
öå_evít
 *
öåp
, 
˝u_evít
 *
˝u_ev
)

761 
öå_evít
 *
√xt˛ock
;

762 
öãnd_evít
 *
√w
;

763 
cuæbﬁt
++;

765 i‡(
pf_¥öthack
)

766 
	`Ârötf
 (
ouçutfûe
, "%f, CLOCK_INTERRUPT -ÇewÜbﬁà%d\n", 
simtime
, 
cuæbﬁt
);

768 
	`ASSERT
 (
öåp
->
evíéi°
 =
NULL
);

769 
√w
 = (
öãnd_evít
 *Ë
	`gë‰omexåaq
();

770 
√w
->
ty≥
 = 
INTEND_EVENT
;

771 
√w
->
ve˘‹
 = 
öåp
->
ty≥
;

772 i‡((
cuæbﬁt
 % 
PF_INTER_LONG_CLOCKS
) == 0) {

773 
	`io_tick
();

774 
√w
->
time
 = 
PF_LONG_CLOCK_TIME
;

776 
√w
->
time
 = 
PF_SHORT_CLOCK_TIME
;

778 
	`pf_add_to_öåp_evíéi°
(
öåp
, (
evít
 *)
√w
);

780 
√xt˛ock
 = (
öå_evít
 *Ë
	`gë‰omexåaq
();

781 
√xt˛ock
->
ty≥
 = 
INTR_EVENT
;

782 
√xt˛ock
->
time
 = 
öåp
->timê+ 
PF_INTER_CLOCK_TIME
;

783 
√xt˛ock
->
ve˘‹
 = 
CLOCK_INTERRUPT
;

784 
√xt˛ock
->
evíéi°
 = 
NULL
;

785 
	`addtoötq
((
evít
 *Ë
√xt˛ock
);

786 
	}
}

789 
	$pf_h™dÀ_öå_evít
 (
öå_evít
 *
öåp
, 
˝unum
)

791 
˝u
 *
cuº˝u
 = &
˝us
[
˝unum
];

792 
˝u_evít
 *
˝u_ev
 = 
cuº˝u
->
cuºít
;

793 
¥o˚ss
 *
¥o˝
 = 
˝u_ev
->procp;

795 i‡(
pf_¥öthack
)

796 
	`Ârötf
 (
ouçutfûe
, "%f\tINTR cpu=%d ve˘‹=%d cpu°©e=%d\n", 
simtime
, 
˝unum
, 
öåp
->
ve˘‹
, 
cuº˝u
->
°©e
);

798 
öåp
->
ru¡ime
 = 0.0;

799 
öåp
->
Êags
 = 0;

800 
öåp
->
√xt
 = 
˝u_ev
->intrp;

801 i‡(
cuº˝u
->
°©e
 =
CPU_IDLE
) {

802 
cuº˝u
->
idÀtime
 +
simtime
 - cuº˝u->
idÀ°¨t
;

803 
cuº˝u
->
Ál£idÀtime
 +
	`pf_add_Ál£_idÀ_time
(
simtime
 - cuº˝u->
idÀ°¨t
);

805 i‡(
	`ªmove‰omötq
((
evít
 *)
˝u_ev
) == 0) {

806 
	`Ârötf
(
°dîr
, "Event fromáctive CPUÇotÖending on internal queue\n");

807 
	`exô
(1);

809 i‡(
öåp
->
√xt
) {

810 
öåp
->
√xt
->
ru¡ime
 +
simtime
 - i¡Ω->√xt->
evíéi°
->
time
;

811 
öåp
->
√xt
->
evíéi°
->
time
 = (
˝u_ev
->timê- 
simtime
Ë/ 
cuº˝u
->
sˇÀ
;

812 } i‡(
¥o˝
 =
NULL
) {

813 
cuº˝u
->
idÀw‹ktime
 +
simtime
 - cuº˝u->
idÀevíts
->
time
;

814 
cuº˝u
->
idÀevíts
->
time
 = (
˝u_ev
->timê- 
simtime
Ë/ cuº˝u->
sˇÀ
;

816 
¥o˝
->
ru¡ime
 +
simtime
 -Öro˝->
evíéi°
->
time
;

817 
¥o˝
->
evíéi°
->
time
 = (
˝u_ev
->timê- 
simtime
Ë/ 
cuº˝u
->
sˇÀ
;

820 
öåp
->
ﬁd°©e
 = 
cuº˝u
->
°©e
;

821 
cuº˝u
->
°©e
 = 
CPU_INTR
;

822 
˝u_ev
->
öåp
 = intrp;

823 i‡(
öåp
->
ve˘‹
 =
IO_INTERRUPT
) {

824 
	`pf_h™dÀ_io_öå_¨rive
(
öåp
, 
˝u_ev
);

825 } i‡(
öåp
->
ve˘‹
 =
CLOCK_INTERRUPT
) {

826 
	`pf_h™dÀ_˛ock_öå_¨rive
(
öåp
, 
˝u_ev
);

828 
	`Ârötf
(
°dîr
, "Unknow¿öãºu± ve˘‹: %d\n", 
öåp
->
ve˘‹
);

829 
	`exô
(1);

831 
˝u_ev
->
time
 = 
cuº˝u
->
sˇÀ
 * 
	`pf_gë_time_to_√xt_öå_evít
(
öåp
);

832 
˝u_ev
->
time
 +
simtime
;

833 
	`addtoötq
((
evít
 *Ë
˝u_ev
);

837 
	}
}

840 
	$pf_h™dÀ_˝u_evít
 (
˝u_evít
 *
cuº
)

842 
evít
 *
tmp
;

843 
˝u
 *
cuº˝u
 = &
˝us
[(
cuº
->
˝unum
)];

851 if(
pf_¥öthack
) {

852 
	`Ârötf
 (
ouçutfûe
, "E¡îed h™dÀ_˝u_evít: %d\n", 
cuº
->
ty≥
);

853 
	`fÊush
(
ouçutfûe
);

856 if(
cuº
->
öåp
) {

857 
tmp
 = 
cuº
->
öåp
->
evíéi°
;

858 
cuº
->
öåp
->
ru¡ime
 +
simtime
 - 
tmp
->
time
;

859 
cuº
->
öåp
->
evíéi°
 = 
tmp
->
√xt
;

861 if(
cuº
->
¥o˝
) {

862 
cuº
->
¥o˝
->
œ°evíâime
 = 
simtime
;

863 
tmp
 = 
cuº
->
¥o˝
->
evíéi°
;

864 
cuº
->
¥o˝
->
ru¡ime
 +
simtime
 - 
tmp
->
time
;

865 
cuº
->
¥o˝
->
evíéi°
 = 
tmp
->
√xt
;

868 
tmp
 = 
cuº˝u
->
idÀevíts
;

869 
cuº˝u
->
idÀw‹ktime
 +
simtime
 - 
tmp
->
time
;

870 
cuº˝u
->
idÀevíts
 = 
tmp
->
√xt
;

873 
	`ASSERT
(
tmp
 !
NULL
);

874 
tmp
->
√xt
 = 
NULL
;

875 
	`pf_h™dÀ_evít
(
tmp
, 
cuº
);

877 if(
cuº
->
öåp
) {

878 
cuº
->
time
 = 
	`pf_gë_time_to_√xt_öå_evít
(cuº->
öåp
);

880 if(
cuº
->
¥o˝
 =
NULL
) {

881 i‡(
cuº˝u
->
idÀevíts
 =
NULL
) {

882 
cuº˝u
->
°©e
 = 
CPU_IDLE
;

883 
cuº˝u
->
idÀ°¨t
 = 
simtime
;

886 
cuº
->
time
 = 
cuº˝u
->
idÀevíts
->time;

887 
cuº˝u
->
idÀevíts
->
time
 = 
simtime
;

888 
cuº˝u
->
°©e
 = 
CPU_IDLE_WORK
;

891 
cuº
->
time
 = 
	`pf_gë_time_to_√xt_¥o˚ss_evít
(cuº->
¥o˝
);

894 
cuº
->
time
 = 
simtime
 + (
cuº˝u
->
sˇÀ
 * curr->time);

895 
	`addtoötq
((
evít
 *Ë
cuº
);

898 if(
pf_¥öthack
) {

899 
	`Ârötf
(
ouçutfûe
, "Exited handle_cpu_event\n");

900 
	`fÊush
(
ouçutfûe
);

902 
	}
}

905 
	$pf_öã∫Æ_evít
 (
evít
 *
cuº
)

907 
	`ASSERT
(
cuº
 !
NULL
);

911 
	`ASSERT1
(
cuº
->
ty≥
 =
CPU_EVENT
, "curr->type", curr->type);

912 
	`pf_h™dÀ_˝u_evít
((
˝u_evít
 *Ë
cuº
);

913 
	}
}

916 
	$pf_˝u_ª£t°©s
()

918 
i
;

920 
i
=0; i<
num˝us
; i++) {

921 
˝us
[
i
].
idÀtime
 = 0.0;

922 
˝us
[
i
].
Ál£idÀtime
 = 0.0;

923 
˝us
[
i
].
idÀw‹ktime
 = 0.0;

924 
˝us
[
i
].
idÀ°¨t
 = 
simtime
;

925 
˝us
[
i
].
öås
 = 0;

926 
˝us
[
i
].
ioöås
 = 0;

927 
˝us
[
i
].
˛ocköås
 = 0;

928 
˝us
[
i
].
runöåtime
 = 0.0;

929 
˝us
[
i
].
runioöåtime
 = 0.0;

930 
˝us
[
i
].
run˛ocköåtime
 = 0.0;

931 
˝us
[
i
].
cswôches
 = 0;

932 
˝us
[
i
].
runswôchtime
 = 0.0;

934 
	}
}

937 
	$pf_˝u_öôülize
()

939 
i
;

941 
i
=0; i<
num˝us
; i++) {

942 
˝us
[
i
].
sˇÀ
 = 
pfsˇÀ
;

943 
˝us
[
i
].
idÀevíts
 = 
NULL
;

944 
˝us
[
i
].
cuºít
 = (
˝u_evít
 *Ë
	`gë‰omexåaq
();

945 
˝us
[
i
].
cuºít
->
ty≥
 = 
CPU_EVENT
;

946 
˝us
[
i
].
cuºít
->
˝unum
 = i;

947 
˝us
[
i
].
cuºít
->
¥o˝
 = 
NULL
;

948 
˝us
[
i
].
cuºít
->
öåp
 = 
NULL
;

950 
	`pf_˝u_ª£t°©s
();

951 
	}
}

954 
	$pf_ª£t°©s
()

956 
	`pf_˝u_ª£t°©s
();

957 
	}
}

960 
	$pf_£tˇŒbacks
()

962 
	}
}

965 
	$pf_öôülize
 (
£edvÆue
)

967 
i
 = 0;

968 
¥o˚ss
 *
¥o˝
 = 
NULL
;

969 
öå_evít
 *
öåp
;

973 
	`SèticAs£π
 ((
˝u_evít
Ë<
DISKSIM_EVENT_SIZE
);

974 
	`SèticAs£π
 ((
öãnd_evít
Ë<
DISKSIM_EVENT_SIZE
);

975 
	`SèticAs£π
 ((
cswôch_evít
Ë<
DISKSIM_EVENT_SIZE
);

976 
	`SèticAs£π
 ((
idÀlo›_evít
Ë<
DISKSIM_EVENT_SIZE
);

977 
	`SèticAs£π
 ((
¶ìp_evít
Ë<
DISKSIM_EVENT_SIZE
);

978 
	`SèticAs£π
 ((
wakeup_evít
Ë<
DISKSIM_EVENT_SIZE
);

980 
	`°©_öôülize
(
°©deffûe
, "Re•⁄£Åime", &
time¸ôª•°©s
);

981 
	`°©_öôülize
(
°©deffûe
, "Re•⁄£Åime", &
timñimôª•°©s
);

982 
	`°©_öôülize
(
°©deffûe
, "Re•⁄£Åime", &
timí⁄¸ôª•°©s
);

983 
	`pf_˝u_öôülize
();

985 
öåp
 = (
öå_evít
 *Ë
	`gë‰omexåaq
();

986 
öåp
->
ty≥
 = 
INTR_EVENT
;

987 
öåp
->
time
 = 
PF_INTER_CLOCK_TIME
;

988 
öåp
->
ve˘‹
 = 
CLOCK_INTERRUPT
;

989 
öåp
->
evíéi°
 = 
NULL
;

990 
	`addtoötq
((
evít
 *Ë
öåp
);

992 
	`DISKSIM_§™d48
(
£edvÆue
);

993 
¥o˝
 = 
sy¡hli°
;

994 
¥o˝
) {

995 if(
¥o˝
->
•a˚
) {

996 
	`sy¡hio_öôülize_gíî©‹
(
¥o˝
);

998 
¥o˝
 =Öro˝->
√xt
;

1002 
	`pf_di•©chî_öô
(
sy¡hli°
);

1003 
sy¡hli°
 = 
NULL
;

1005 
i
 = 0; i < 
num˝us
; i++) {

1006 
	`Ârötf
 (
ouçutfûe
, "Kickög of‡˝u #%d\n", 
i
);

1008 if(
˝us
[
i
].
cuºít
->
¥o˝
) {

1009 
˝us
[
i
].
cuºít
->
¥o˝
->
a˘ive
 = 1;

1010 
˝us
[
i
].
cuºít
->
time
 = cpus[i].
sˇÀ
 *

1011 
	`pf_gë_time_to_√xt_¥o˚ss_evít
(
˝us
[
i
].
cuºít
->
¥o˝
);

1013 
	`addtoötq
((
evít
 *)
˝us
[
i
].
cuºít
);

1014 
˝us
[
i
].
°©e
 = 
CPU_PROCESS
;

1015 
	`Ârötf
 (
ouçutfûe
, "FirstÉvent occursátÅime %f\n",

1016 
˝us
[
i
].
cuºít
->
time
);

1019 
˝us
[
i
].
°©e
 = 
CPU_IDLE
;

1022 
	}
}

1026 
	$disksim_pf_lﬂd∑øms
(
Õ_block
 *
b
) {

1027 
pf_öfo_t
 *
pf_öfo
;

1029 if(!
disksim
->
pf_öfo
) {

1030 
pf_öfo
 = 
	`DISKSIM_mÆloc
 ((
pf_öfo_t
));

1031 if(!
pf_öfo
)  0;

1032 
	`bzîo
 ((*)
pf_öfo
, (
pf_öfo_t
));

1033 
disksim
->
pf_öfo
 =Öf_info;

1039 
	`Õ_lﬂd∑øms
(0, 
b
, &
disksim_pf_mod
);

1042 
	}
}

1045 
	$disksim_pf_°©s_lﬂd∑øms
(
Õ_block
 *
b
) {

1046 
pf_öfo_t
 *
pf_öfo
;

1048 if(!
disksim
->
pf_öfo
) {

1049 
pf_öfo
 = 
	`DISKSIM_mÆloc
 ((
pf_öfo_t
));

1050 if(!
pf_öfo
)  0;

1051 
	`bzîo
 ((*)
pf_öfo
, (
pf_öfo_t
));

1052 
disksim
->
pf_öfo
 =Öf_info;

1057 
	`Õ_lﬂd∑øms
(0, 
b
, &
disksim_pf_°©s_mod
);

1061 
	}
}

1065 
	$pf_˛ón°©s
()

1067 
i
;

1068 
öå_evít
 *
öåp
;

1069 
¥o˚ss
 *
¥o˝
;

1071 
i
=0; i<
num˝us
; i++) {

1072 
öåp
 = 
˝us
[
i
].
cuºít
->intrp;

1073 
¥o˝
 = 
˝us
[
i
].
cuºít
->procp;

1074 
˝us
[
i
].
°©e
) {

1075 
CPU_IDLE
:

1076 
˝us
[
i
].
idÀtime
 +
simtime
 - cpus[i].
idÀ°¨t
;

1077 
˝us
[
i
].
Ál£idÀtime
 +
	`pf_add_Ál£_idÀ_time
(
simtime
 - cpus[i].
idÀ°¨t
);

1079 
CPU_IDLE_WORK
:

1080 
˝us
[
i
].
idÀw‹ktime
 +
simtime
 - cpus[i].
idÀevíts
->
time
;

1082 
CPU_PROCESS
:

1083 i‡(
¥o˝
->
idÀr
 == 0) {

1084 
œ°u£r
 = 
simtime
;

1086 
¥o˝
->
ru¡ime
 +
simtime
 -Öro˝->
evíéi°
->
time
;

1088 
CPU_INTR
:

1089 
öåp
->
ru¡ime
 +
simtime
 - i¡Ω->
evíéi°
->
time
;

1092 
	`Ârötf
(
°dîr
, "Unknow¿CPU sèãáàpf_˛ón°©†- %d\n", 
˝us
[
i
].
°©e
);

1093 
	`exô
(1);

1096 
¥o˝
 = 
¥o˚ss_livñi°
;

1097 
¥o˝
) {

1098 i‡(
¥o˝
->
°©
 =
PROC_SLEEP
) {

1099 
¥o˝
->
run¶ìp
 +
simtime
 -Öro˝->
œ°¶ìp
;

1100 i‡(
¥o˝
->
io¶ìp
) {

1101 
¥o˝
->
runio¶ìp
 +
simtime
 -Öro˝->
œ°¶ìp
;

1104 
¥o˝
 =Öro˝->
livñi°
;

1106 
	}
}

1109 
	$pf_¥öt_öãºu±_°©s
 (
°¨t˝u
, 
°›˝u
)

1111 
i
;

1112 
ioöås
 = 0;

1113 
˛ocköås
 = 0;

1114 
runioöå
 = 0.0;

1115 
run˛ocköå
 = 0.0;

1116 
˝u°r
[81];

1118 i‡(
°¨t˝u
 =
°›˝u
) {

1119 
	`•rötf
(
˝u°r
, "CPU #%d ", 
°¨t˝u
);

1121 
	`•rötf
(
˝u°r
, "CPU ");

1124 i‡(
pf_¥öt_öå°©s
 =
FALSE
) {

1128 
i
=
°¨t˝u
; i<=
°›˝u
; i++) {

1129 
ioöås
 +
˝us
[
i
].iointrs;

1130 
˛ocköås
 +
˝us
[
i
].clockintrs;

1131 
runioöå
 +
˝us
[
i
].
runioöåtime
;

1132 
run˛ocköå
 +
˝us
[
i
].
run˛ocköåtime
;

1134 
	`Ârötf
 (
ouçutfûe
, "%sNumbî o‡IO i¡îru±s: %d\n", 
˝u°r
, 
ioöås
);

1135 
	`Ârötf
 (
ouçutfûe
, "%sTimê•íàö I/O i¡îru±s: %f\n", 
˝u°r
, 
runioöå
);

1136 
	`Ârötf
 (
ouçutfûe
, "%sNumbî o‡˛ock i¡îru±s: %d\n", 
˝u°r
, 
˛ocköås
);

1137 
	`Ârötf
 (
ouçutfûe
, "%sTimê•íàö clock i¡îru±s: %f\n", 
˝u°r
, 
run˛ocköå
);

1138 
	}
}

1141 
	$pf_¥öt_¶ìp_°©s
()

1143 
¶ìps
 = 0;

1144 
io¶ìps
 = 0;

1145 
run¶ìp
 = 0.0;

1146 
runio¶ìp
 = 0.0;

1147 
¥o˚ss
 *
¥o˝
 = 
¥o˚ss_livñi°
;

1149 i‡(
pf_¥öt_¶ìp°©s
 =
FALSE
) {

1153 
¥o˝
) {

1154 
¶ìps
 +
¥o˝
->sleeps;

1155 
io¶ìps
 +
¥o˝
->iosleeps;

1156 
run¶ìp
 +
¥o˝
->runsleep;

1157 
runio¶ìp
 +
¥o˝
->runiosleep;

1158 
¥o˝
 =Öro˝->
livñi°
;

1160 
	`Ârötf
 (
ouçutfûe
, "Numbî o‡¶ì∞evíts: %d\n", 
¶ìps
);

1161 
	`Ârötf
 (
ouçutfûe
, "Numbî o‡I/O sÀïÉvíts: %d\n", 
io¶ìps
);

1162 
	`Ârötf
 (
ouçutfûe
, "Avîagê¶ì∞time: %f\n", (
run¶ìp
 / (Ë
	`max
(
¶ìps
,1)));

1163 
	`Ârötf
 (
ouçutfûe
, "AvîagêI/O sÀïÅime: %f\n", (
runio¶ìp
 / (Ë
	`max
(
io¶ìps
,1)));

1164 
	}
}

1167 
	$pf_¥öt_¥o˚ss_°©s
()

1169 
i
 = 0;

1170 
¥o˚ss
 *
¥o˝
 = 
¥o˚ss_livñi°
;

1171 
¥oc˙t
 = 0;

1172 
ru¡ime
 = 0.0;

1173 
œ°evíâime
 = 0.0;

1174 
ios
 = 0;

1175 
i‹óds
 = 0;

1176 
cswôches
 = 0;

1177 
¶ìps
 = 0;

1178 
run¶ìp
 = 0.0;

1179 
io¶ìps
 = 0;

1180 
runio¶ìp
 = 0.0;

1181 
Ál£idÀtime
 = 0.0;

1182 
°©gí
 * 
ªadlimô°©s
[511];

1183 
°©gí
 * 
wrôñimô°©s
[511];

1184 
°©gí
 * 
ªadmiss°©s
[511];

1185 
°©gí
 * 
wrôemiss°©s
[511];

1186 
¥oc°r
[81];

1188 
	`Ârötf
 (
ouçutfûe
, "\nPROCESS STATISTICS\n");

1189 
¥o˝
) {

1190 i‡((
¥o˝
->
ru¡ime
 !0.0Ë|| (¥o˝->
cswôches
)) {

1191 
¥oc˙t
++;

1193 
¥o˝
 =Öro˝->
livñi°
;

1196 
	`ASSERT
(
¥oc˙t
 < 511);

1197 
¥o˝
 = 
¥o˚ss_livñi°
;

1198 
i
 = 0;

1199 
¥o˝
) {

1200 i‡((
¥o˝
->
ru¡ime
 !0.0Ë|| (¥o˝->
cswôches
)) {

1201 
ru¡ime
 +
¥o˝
->runtime;

1202 
œ°evíâime
 = 
	`max
 (
¥o˝
->lasteventtime,Üasteventtime);

1203 
ios
 +
¥o˝
->ios;

1204 
i‹óds
 +
¥o˝
->ioreads;

1205 
cswôches
 +
¥o˝
->cswitches;

1206 
¶ìps
 +
¥o˝
->sleeps;

1207 
run¶ìp
 +
¥o˝
->runsleep;

1208 
io¶ìps
 +
¥o˝
->iosleeps;

1209 
runio¶ìp
 +
¥o˝
->runiosleep;

1210 
Ál£idÀtime
 +
¥o˝
->falseidletime;

1211 
ªadlimô°©s
[
i
] = &
¥o˝
->
ªadtimñimô°©s
;

1212 
wrôñimô°©s
[
i
] = &
¥o˝
->
wrôëimñimô°©s
;

1213 
ªadmiss°©s
[
i
] = &
¥o˝
->
ªadmis¶imô°©s
;

1214 
wrôemiss°©s
[
i
] = &
¥o˝
->
wrôemis¶imô°©s
;

1215 
i
++;

1217 
¥o˝
 =Öro˝->
livñi°
;

1220 
	`Ârötf
(
ouçutfûe
, "Pro˚s†TŸÆ compuèti⁄Åime: %f\n", 
ru¡ime
);

1221 
	`Ârötf
(
ouçutfûe
, "Pro˚s†La°Évíàtime: %f\n", 
œ°evíâime
);

1222 
	`Ârötf
(
ouçutfûe
, "Pro˚s†Numbî o‡I/OÑeque°s: %d\n", 
ios
);

1223 
	`Ârötf
(
ouçutfûe
, "Pro˚s†Numbî o‡ªadÑeque°s: %d\n", 
i‹óds
);

1224 
	`Ârötf
(
ouçutfûe
, "Pro˚s†Numbî o‡C-swôches: %d\n", 
cswôches
);

1225 
	`Ârötf
(
ouçutfûe
, "Pro˚s†Numbî o‡¶ìps: %d\n", 
¶ìps
);

1226 
	`Ârötf
(
ouçutfûe
, "Pro˚s†Avîagê¶ì∞time: %f\n", (
run¶ìp
 / (Ë
	`max
(
¶ìps
,1)));

1227 
	`Ârötf
(
ouçutfûe
, "Pro˚s†Numbî o‡I/O sÀïs: %d\n", 
io¶ìps
);

1228 
	`Ârötf
(
ouçutfûe
, "Pro˚s†AvîagêI/O sÀïÅime: %f\n", (
runio¶ìp
 / (Ë
	`max
(
io¶ìps
,1)));

1229 
	`Ârötf
(
ouçutfûe
, "Pro˚s†FÆ£ idÀÅime: %f\n", 
Ál£idÀtime
);

1230 
	`Ârötf
(
ouçutfûe
, "Pro˚s†Ród Timêlimô†mósuªd: %d\n", 
	`°©_gë_cou¡_£t
(
ªadlimô°©s
, 
¥oc˙t
));

1231 
	`°©_¥öt_£t
(
ªadlimô°©s
, 
¥oc˙t
, "Process Read ");

1232 
	`Ârötf
(
ouçutfûe
, "Pro˚s†WrôêTimêlimô†mósuªd: %d\n", 
	`°©_gë_cou¡_£t
(
wrôñimô°©s
, 
¥oc˙t
));

1233 
	`°©_¥öt_£t
(
wrôñimô°©s
, 
¥oc˙t
, "Process Write ");

1234 
	`Ârötf
(
ouçutfûe
, "Pro˚s†Ród Timêlimô†mis£d: %d\n", 
	`°©_gë_cou¡_£t
(
ªadmiss°©s
, 
¥oc˙t
));

1235 
	`°©_¥öt_£t
(
ªadmiss°©s
, 
¥oc˙t
, "Process Missed Read ");

1236 
	`Ârötf
(
ouçutfûe
, "Pro˚s†WrôêTimêlimô†mis£d: %d\n", 
	`°©_gë_cou¡_£t
(
wrôemiss°©s
, 
¥oc˙t
));

1237 
	`°©_¥öt_£t
(
wrôemiss°©s
, 
¥oc˙t
, "Process Missed Write ");

1239 i‡((
pf_¥öt_≥Ωro˚ss°©s
 =
FALSE
Ë|| (
¥oc˙t
 <= 1)) {

1243 
¥o˝
 = 
¥o˚ss_livñi°
;

1244 
¥o˝
) {

1245 i‡((
¥o˝
->
ru¡ime
 =0.0Ë&& (¥o˝->
cswôches
 == 0)) {

1246 
¥o˝
 =Öro˝->
livñi°
;

1249 
	`Ârötf
(
ouçutfûe
, "\nPro˚s†%d\n", 
¥o˝
->
pid
);

1250 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d TŸÆ compuèti⁄Åime: %f\n", 
¥o˝
->
pid
,Öro˝->
ru¡ime
);

1251 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d La°Évíàtime: %f\n", 
¥o˝
->
pid
,Öro˝->
œ°evíâime
);

1252 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d Numbî o‡I/OÑeque°s: %d\n", 
¥o˝
->
pid
,Öro˝->
ios
);

1253 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d Numbî o‡ªadÑeque°s: %d\n", 
¥o˝
->
pid
,Öro˝->
i‹óds
);

1254 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d Numbî o‡C-swôches: %d\n", 
¥o˝
->
pid
,Öro˝->
cswôches
);

1255 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d Numbî o‡¶ìps: %d\n", 
¥o˝
->
pid
,Öro˝->
¶ìps
);

1256 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d Avîagê¶ì∞time: %f\n", 
¥o˝
->
pid
, (¥o˝->
run¶ìp
 / (Ë
	`max
’ro˝->
¶ìps
,1)));

1257 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d Numbî o‡I/O sÀïs: %d\n", 
¥o˝
->
pid
,Öro˝->
io¶ìps
);

1258 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d AvîagêI/O sÀïÅime: %f\n", 
¥o˝
->
pid
, (¥o˝->
runio¶ìp
 / (Ë
	`max
’ro˝->
io¶ìps
,1)));

1259 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d FÆ£ idÀÅime: %f\n", 
¥o˝
->
pid
,Öro˝->
Ál£idÀtime
);

1260 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d Ród Timêlimô†mósuªd: %d\n", 
¥o˝
->
pid
, 
	`°©_gë_cou¡
(&¥o˝->
ªadtimñimô°©s
));

1261 
	`•rötf
(
¥oc°r
, "Pro˚s†%d Ród ", 
¥o˝
->
pid
);

1262 
	`°©_¥öt
(&
¥o˝
->
ªadtimñimô°©s
, 
¥oc°r
);

1263 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d WrôêTimêlimô†mósuªd: %d\n", 
¥o˝
->
pid
, 
	`°©_gë_cou¡
(&¥o˝->
wrôëimñimô°©s
));

1264 
	`•rötf
(
¥oc°r
, "Pro˚s†%d Wrôê", 
¥o˝
->
pid
);

1265 
	`°©_¥öt
(&
¥o˝
->
wrôëimñimô°©s
, 
¥oc°r
);

1266 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d Ród Timêlimô†mis£d: %d\n", 
¥o˝
->
pid
, 
	`°©_gë_cou¡
(&¥o˝->
ªadmis¶imô°©s
));

1267 
	`•rötf
(
¥oc°r
, "Pro˚s†%d Mis£d Ród ", 
¥o˝
->
pid
);

1268 
	`°©_¥öt
(&
¥o˝
->
ªadmis¶imô°©s
, 
¥oc°r
);

1269 
	`Ârötf
(
ouçutfûe
, "Pro˚s†%d WrôêTimêlimô†mis£d: %d\n", 
¥o˝
->
pid
, 
	`°©_gë_cou¡
(&¥o˝->
wrôemis¶imô°©s
));

1270 
	`•rötf
(
¥oc°r
, "Pro˚s†%d Mis£d Wrôê", 
¥o˝
->
pid
);

1271 
	`°©_¥öt
(&
¥o˝
->
wrôemis¶imô°©s
, 
¥oc°r
);

1272 
¥o˝
 =Öro˝->
livñi°
;

1274 
	`Ârötf
(
ouçutfûe
, "\n");

1275 
	}
}

1278 
	$pf_¥öt_pf_°©s
 (
°¨t˝u
, 
°›˝u
)

1280 
i
;

1281 
idÀtime
 = 0.0;

1282 
Ál£idÀtime
 = 0.0;

1283 
idÀw‹ktime
 = 0.0;

1284 
cswôches
 = 0;

1285 
numöås
 = 0;

1286 
runöå
 = 0.0;

1287 
runswôchtime
 = 0.0;

1288 
˝u˙t
;

1289 
˝u°r
[81];

1290 
˝u°r2
[81];

1292 i‡(
°¨t˝u
 =
°›˝u
) {

1293 
	`•rötf
(
˝u°r
, "CPU #%d ", 
°¨t˝u
);

1295 
	`•rötf
(
˝u°r
, "CPU ");

1298 
˝u˙t
 = 
°›˝u
 - 
°¨t˝u
 + 1;

1299 
i
=
°¨t˝u
; i<=
°›˝u
; i++) {

1300 
idÀtime
 +
˝us
[
i
].idletime;

1301 
Ál£idÀtime
 +
˝us
[
i
].falseidletime;

1302 
idÀw‹ktime
 +
˝us
[
i
].idleworktime;

1303 
cswôches
 +
˝us
[
i
].cswitches;

1304 
runswôchtime
 +
˝us
[
i
].runswitchtime;

1305 
numöås
 +
˝us
[
i
].
öås
;

1306 
runöå
 +
˝us
[
i
].
runöåtime
;

1308 
	`Ârötf
(
ouçutfûe
, "%sTŸÆ idÀ mûli£c⁄ds: %f\n", 
˝u°r
, 
idÀtime
);

1309 
	`Ârötf
(
ouçutfûe
, "%sIdÀÅimê≥∏¥o˚ss‹: %f\n", 
˝u°r
, (
idÀtime
 / (Ë
˝u˙t
));

1310 
	`Ârötf
(
ouçutfûe
, "%sPî˚¡agêidÀ cy˛es: %f\n", 
˝u°r
, ((Ë100.0 * 
idÀtime
 / ((
simtime
 - 
w¨mu±ime
Ë* (Ë
˝u˙t
)));

1311 
	`Ârötf
(
ouçutfûe
, "%sTŸÆ fÆ£ idÀ ms: %f\n", 
˝u°r
, 
Ál£idÀtime
);

1312 
	`Ârötf
(
ouçutfûe
, "%sFÆ£ idÀÅimê≥∏CPU: %f\n", 
˝u°r
, (
Ál£idÀtime
 / (Ë
˝u˙t
));

1313 
	`Ârötf
(
ouçutfûe
, "%sPî˚¡agêÁl£ idÀ cy˛es: %f\n", 
˝u°r
, ((Ë100.0 * 
Ál£idÀtime
 / ((
simtime
 - 
w¨mu±ime
Ë* (Ë
˝u˙t
)));

1314 
	`Ârötf
(
ouçutfûe
, "%sTŸÆ idÀ w‹k ms: %f\n", 
˝u°r
, 
idÀw‹ktime
);

1315 
	`Ârötf
(
ouçutfûe
, "%sC⁄ãxàSwôches: %d\n", 
˝u°r
, 
cswôches
);

1316 
	`Ârötf
(
ouçutfûe
, "%sTimê•íàc⁄ãxàswôchög: %f\n", 
˝u°r
, 
runswôchtime
);

1317 
	`Ârötf
(
ouçutfûe
, "%sPî˚¡agêswôchög cy˛es: %f\n", 
˝u°r
, ((Ë100.0 * 
runswôchtime
 / ((
simtime
 - 
w¨mu±ime
Ë* (Ë
˝u˙t
)));

1318 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡öãºu±s: %d\n", 
˝u°r
, 
numöås
);

1319 
	`Ârötf
(
ouçutfûe
, "%sTŸÆÅimêö i¡îru±s: %.3f\n", 
˝u°r
, 
runöå
);

1320 
	`Ârötf
(
ouçutfûe
, "%sPî˚¡agêöãºu± cy˛es: %f\n", 
˝u°r
, ((Ë100.0 * 
runöå
 / ((
simtime
 - 
w¨mu±ime
Ë* (Ë
˝u˙t
)));

1321 
	`Ârötf
(
ouçutfûe
, "%sTime-Crôiˇ»ªque° cou¡: %d\n", 
˝u°r
, 
	`°©_gë_cou¡
(&
time¸ôª•°©s
));

1322 
	`•rötf
(
˝u°r2
, "%sTime-Crôiˇ»", 
˝u°r
);

1323 
	`°©_¥öt
(&
time¸ôª•°©s
, 
˝u°r2
);

1324 
	`Ârötf
(
ouçutfûe
, "%sTime-LimôedÑeque° cou¡: %d\n", 
˝u°r
, 
	`°©_gë_cou¡
(&
timñimôª•°©s
));

1325 
	`•rötf
(
˝u°r2
, "%sTime-Limôed ", 
˝u°r
);

1326 
	`°©_¥öt
(&
timñimôª•°©s
, 
˝u°r2
);

1327 
	`Ârötf
(
ouçutfûe
, "%sTime-N⁄¸ôiˇ»ªque° cou¡: %d\n", 
˝u°r
, 
	`°©_gë_cou¡
(&
timí⁄¸ôª•°©s
));

1328 
	`•rötf
(
˝u°r2
, "%sTime-N⁄¸ôiˇ»", 
˝u°r
);

1329 
	`°©_¥öt
(&
timí⁄¸ôª•°©s
, 
˝u°r2
);

1330 
	}
}

1333 
	$pf_¥öt_≥r˝u_°©s
()

1335 
i
;

1337 i‡((
num˝us
 =1Ë|| (
pf_¥öt_≥r˝u°©s
 =
FALSE
)) {

1341 
	`Ârötf
 (
ouçutfûe
, "\nPER-CPU STATISTICS\n");

1343 
i
=0; i<
num˝us
; i++) {

1344 
	`Ârötf
 (
ouçutfûe
, "\nCPU #%d\n\n", 
i
);

1345 
	`pf_¥öt_pf_°©s
(
i
, i);

1346 
	`pf_¥öt_öãºu±_°©s
(
i
, i);

1348 
	}
}

1351 
	$pf_¥öt°©s
()

1353 
	`Ârötf
 (
ouçutfûe
, "\nPROCESS FLOW STATISTICS\n");

1354 
	`Ârötf
 (
ouçutfûe
, "-----------------------\n\n");

1356 
	`pf_¥öt_pf_°©s
(0, (
num˝us
 - 1));

1357 
	`pf_¥öt_öãºu±_°©s
(0, (
num˝us
 - 1));

1358 
	`pf_¥öt_¶ìp_°©s
();

1359 
	`pf_¥öt_≥r˝u_°©s
();

1360 
	`pf_¥öt_¥o˚ss_°©s
();

1364 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_pfsim.h

101 #i‚de‡
DISKSIM_PFSIM_H


102 
	#DISKSIM_PFSIM_H


	)

104 
	~"disksim_°©.h
"

108 
	#SLEEP_EVENT
 3

	)

109 
	#WAKEUP_EVENT
 5

	)

110 
	#IOREQ_EVENT
 9

	)

111 
	#IOACC_EVENT
 10

	)

113 
	#CPU_EVENT
 50

	)

114 
	#SYNTHIO_EVENT
 51

	)

115 
	#IDLELOOP_EVENT
 52

	)

116 
	#CSWITCH_EVENT
 53

	)

118 
	#MAXCPUS
 20

	)

120 
	#PF_SLEEP_FLAG
 0x00000002

	)

121 
	#PF_WAKED
 0x00000010

	)

123 
	#PF_BUF_WANTED
 0x00000040

	)

127 
	#CPU_IDLE
 0

	)

128 
	#CPU_PROCESS
 1

	)

129 
	#CPU_IDLE_WORK
 2

	)

130 
	#CPU_INTR
 3

	)

134 
	#PROC_SLEEP
 1

	)

135 
	#PROC_RUN
 2

	)

136 
	#PROC_ONPROC
 3

	)

140 
	#PF_INTER_CLOCK_TIME
 10.0

	)

141 
	#PF_INTER_LONG_CLOCKS
 100

	)

142 
	#PF_LONG_CLOCK_TIME
 0.0

	)

143 
	#PF_SHORT_CLOCK_TIME
 0.0

	)

144 
	#PF_CSWITCH_TIME
 0.0

	)

145 
	#PF_IDLE_CHECK_DISPQ_TIME
 1000.0

	)

146 
	#PF_IO_WAKEUP_TIME
 0.0

	)

148 
	s¥o˚ss
 {

149 
	mpid
;

150 
	midÀr
;

151 
u_öt
 
	mpfÊags
;

152 
u_öt
 
	m°©
;

153 
u_öt
 
	mrun˝u
;

154 
u_öt
 
	mÊags
;

155 *
	mch™
;

156 
	mios
;

157 
	mi‹óds
;

158 
	mcswôches
;

159 
	ma˘ive
;

160 
	m¶ìps
;

161 
	mio¶ìp
;

162 
	mio¶ìps
;

163 
	mrunio¶ìp
;

164 
	mœ°¶ìp
;

165 
	mrun¶ìp
;

166 
	mru¡ime
;

167 
	mÁl£idÀtime
;

168 
	mœ°evíâime
;

169 
°©gí
 
	mªadtimñimô°©s
;

170 
°©gí
 
	mwrôëimñimô°©s
;

171 
°©gí
 
	mªadmis¶imô°©s
;

172 
°©gí
 
	mwrôemis¶imô°©s
;

173 
i‹eq_evít
 *
	mi‹eq
;

174 
evít
 *
	mevíéi°
;

175 *
	m•a˚
;

176 
¥o˚ss
 *
	mlivñi°
;

177 
¥o˚ss
 *
	mlök
;

178 
¥o˚ss
 *
	m√xt
;

179 } 
	t¥o˚ss
;

182 
	mtime
;

183 
	mty≥
;

184 
evít
 *
	m√xt
;

185 
evít
 *
	m¥ev
;

186 
	m˝unum
;

187 
¥o˚ss
 *
	m¥o˝
;

188 
öå_evít
 *
	möåp
;

189 } 
	t˝u_evít
;

192 
	msˇÀ
;

193 
	m°©e
;

194 
˝u_evít
 *
	mcuºít
;

195 
	mru≈ªem±
;

196 
evít
 *
	midÀevíts
;

197 
	midÀ°¨t
;

198 
	midÀtime
;

199 
	mÁl£idÀtime
;

200 
	midÀw‹ktime
;

201 
	möås
;

202 
	mioöås
;

203 
	m˛ocköås
;

204 
	mticköås
;

205 
	mextöås
;

206 
	mrunöåtime
;

207 
	mrunioöåtime
;

208 
	mrun˛ocköåtime
;

209 
	mru¡icköåtime
;

210 
	mru√xtöåtime
;

211 
	mcswôches
;

212 
	mrunswôchtime
;

213 } 
	t˝u
;

216 
	mtime
;

217 
	mty≥
;

218 
evít
 * 
	m√xt
;

219 
evít
 * 
	m¥ev
;

220 
	mve˘‹
;

221 } 
	töãnd_evít
;

224 
	mtime
;

225 
	mty≥
;

226 
evít
 * 
	m√xt
;

227 
evít
 * 
	m¥ev
;

228 
¥o˚ss
 *
	m√w¥o˝
;

229 } 
	tcswôch_evít
;

232 
	mtime
;

233 
	mty≥
;

234 
evít
 * 
	m√xt
;

235 
evít
 * 
	m¥ev
;

236 } 
	tidÀlo›_evít
;

239 
	mtime
;

240 
	mty≥
;

241 
evít
 * 
	m√xt
;

242 
evít
 * 
	m¥ev
;

243 
	möfo
;

244 *
	mch™
;

245 
	mio¶ìp
;

246 
	m¶ì±ime
;

247 } 
	t¶ìp_evít
;

250 
	mtime
;

251 
	mty≥
;

252 
evít
 * 
	m√xt
;

253 
evít
 * 
	m¥ev
;

254 
	möfo
;

255 *
	mch™
;

256 
	mdr›ô
;

257 } 
	twakeup_evít
;

259 
	spf_öfo
 {

261 
˝u
 *
	m˝us
;

262 
	mnum˝us
;

263 
¥o˚ss
 *
	m¥o˚ss_livñi°
;

264 
¥o˚ss
 *
	mexåa_¥o˚ss_q
;

265 
	mexåa_¥o˚ss_qÀn
;

266 
	mcuæbﬁt
;

267 
i‹eq_evít
 *
	m≥ndiﬁi°
;

268 
i‹eq_evít
 *
	md⁄eiﬁi°
;

269 
¥o˚ss
 *
	msy¡hli°
;

270 
	mpfsˇÀ
;

271 
	mœ°u£r
;

272 
	midÀö
;

273 
	midÀª£t
;

274 
	mpf_¥öthack
;

275 
°©gí
 
	mtime¸ôª•°©s
;

276 
°©gí
 
	mtimñimôª•°©s
;

277 
°©gí
 
	mtimí⁄¸ôª•°©s
;

278 
	mpf_¥öt_≥Ωro˚ss°©s
;

279 
	mpf_¥öt_≥r˝u°©s
;

280 
	mpf_¥öt_öå°©s
;

281 
	mpf_¥öt_¶ìp°©s
;

283 
¥o˚ss
 *
	mpf_di•q
;

284 
¥o˚ss
 *
	m¶ìpqueue
;

285 } 
	tpf_öfo_t
;

289 
	#˝us
 (
disksim
->
pf_öfo
->
˝us
)

	)

290 
	#num˝us
 (
disksim
->
pf_öfo
->
num˝us
)

	)

291 
	#¥o˚ss_livñi°
 (
disksim
->
pf_öfo
->
¥o˚ss_livñi°
)

	)

292 
	#exåa_¥o˚ss_q
 (
disksim
->
pf_öfo
->
exåa_¥o˚ss_q
)

	)

293 
	#exåa_¥o˚ss_qÀn
 (
disksim
->
pf_öfo
->
exåa_¥o˚ss_qÀn
)

	)

294 
	#cuæbﬁt
 (
disksim
->
pf_öfo
->
cuæbﬁt
)

	)

295 
	#≥ndiﬁi°
 (
disksim
->
pf_öfo
->
≥ndiﬁi°
)

	)

296 
	#d⁄eiﬁi°
 (
disksim
->
pf_öfo
->
d⁄eiﬁi°
)

	)

297 
	#sy¡hli°
 (
disksim
->
pf_öfo
->
sy¡hli°
)

	)

298 
	#pfsˇÀ
 (
disksim
->
pf_öfo
->
pfsˇÀ
)

	)

299 
	#œ°u£r
 (
disksim
->
pf_öfo
->
œ°u£r
)

	)

300 
	#idÀö
 (
disksim
->
pf_öfo
->
idÀö
)

	)

301 
	#idÀª£t
 (
disksim
->
pf_öfo
->
idÀª£t
)

	)

302 
	#pf_¥öthack
 (
disksim
->
pf_öfo
->
pf_¥öthack
)

	)

303 
	#time¸ôª•°©s
 (
disksim
->
pf_öfo
->
time¸ôª•°©s
)

	)

304 
	#timñimôª•°©s
 (
disksim
->
pf_öfo
->
timñimôª•°©s
)

	)

305 
	#timí⁄¸ôª•°©s
 (
disksim
->
pf_öfo
->
timí⁄¸ôª•°©s
)

	)

306 
	#pf_¥öt_≥Ωro˚ss°©s
 (
disksim
->
pf_öfo
->
pf_¥öt_≥Ωro˚ss°©s
)

	)

307 
	#pf_¥öt_≥r˝u°©s
 (
disksim
->
pf_öfo
->
pf_¥öt_≥r˝u°©s
)

	)

308 
	#pf_¥öt_öå°©s
 (
disksim
->
pf_öfo
->
pf_¥öt_öå°©s
)

	)

309 
	#pf_¥öt_¶ìp°©s
 (
disksim
->
pf_öfo
->
pf_¥öt_¶ìp°©s
)

	)

310 
	#pf_di•q
 (
disksim
->
pf_öfo
->
pf_di•q
)

	)

311 
	#¶ìpqueue
 (
disksim
->
pf_öfo
->
¶ìpqueue
)

	)

316 
pf_how_m™y_˝us
 ();

317 
¥o˚ss
 * 
pf_gë‰omexåa_¥o˚ss_q
 ();

318 
pf_idÀ_˝u_ªcheck_di•q
 (
˝unum
);

319 
¥o˚ss
 * 
pf_√w_¥o˚ss
 ();

323 
pf_di•©chî_öô
 (
¥o˚ss
 *
°¨çrocs
);

324 
¥o˚ss
 * 
pf_di•_gë_‰om_¶ìp_queue
 (*
ch™
);

325 
¥o˚ss
 * 
pf_di•_gë_•ecific_‰om_¶ìp_queue
 (
u_öt
 
pid
);

326 
pf_di•_put_⁄_¶ìp_queue
 (
¥o˚ss
 *
¥o˝
);

327 
¥o˚ss
 * 
pf_di•©ch
 (
˝unum
);

328 
¥o˚ss
 * 
pf_di•_¶ìp
 (¥o˚s†*
¥o˝
);

329 
pf_di•_wakeup
 (
¥o˚ss
 *
¥o˝
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_rand48.c

71 
	~"disksim_globÆ.h
"

72 
	~"disksim_ønd48.h
"

73 
	~<°dio.h
>

78 
	#RAND48_SEED_0
 (0x330e)

	)

79 
	#RAND48_SEED_1
 (0xabcd)

	)

80 
	#RAND48_SEED_2
 (0x1234)

	)

81 
	#RAND48_MULT_0
 (0xe66d)

	)

82 
	#RAND48_MULT_1
 (0xdìc)

	)

83 
	#RAND48_MULT_2
 (0x0005)

	)

84 
	#RAND48_ADD
 (0x000b)

	)

88 
	sønd48_öfo
 {

89 
	m_ønd48_£ed
[3];

90 
	m_ønd48_mu…
[3];

91 
	m_ønd48_add
;

92 } 
	tønd48_öto_t
;

96 
	#_ønd48_£ed
 (
disksim
->
ønd48_öfo
->
_ønd48_£ed
)

	)

97 
	#_ønd48_mu…
 (
disksim
->
ønd48_öfo
->
_ønd48_mu…
)

	)

98 
	#_ønd48_add
 (
disksim
->
ønd48_öfo
->
_ønd48_add
)

	)

101 
	$disksim_ønd48_öôülize
 ()

103 i‡(
disksim
->
ønd48_öfo
 !
NULL
) {

107 
disksim
->
ønd48_öfo
 = 
	`DISKSIM_mÆloc
 ((
ønd48_öto_t
));

108 
	`bzîo
 ((*)
disksim
->
ønd48_öfo
, (
ønd48_öto_t
));

111 
_ønd48_£ed
[0] = 
RAND48_SEED_0
;

112 
_ønd48_£ed
[1] = 
RAND48_SEED_1
;

113 
_ønd48_£ed
[2] = 
RAND48_SEED_2
;

114 
_ønd48_mu…
[0] = 
RAND48_MULT_0
;

115 
_ønd48_mu…
[1] = 
RAND48_MULT_1
;

116 
_ønd48_mu…
[2] = 
RAND48_MULT_2
;

117 
_ønd48_add
 = 
RAND48_ADD
;

118 
	}
}

124 
	g_ønd48_£ed
[3] = {

125 
RAND48_SEED_0
,

126 
RAND48_SEED_1
,

127 
RAND48_SEED_2


129 
	g_ønd48_mu…
[3] = {

130 
RAND48_MULT_0
,

131 
RAND48_MULT_1
,

132 
RAND48_MULT_2


134 
	g_ønd48_add
 = 
RAND48_ADD
;

139 
	$DISKSIM__d‹™d48
(
x£ed
[3])

141 
accu
;

142 
ãmp
[2];

144 
	`disksim_ønd48_öôülize
();

146 
accu
 = (Ë
_ønd48_mu…
[0] * (Ë
x£ed
[0] +

147 (Ë
_ønd48_add
;

148 
ãmp
[0] = (Ë
accu
;

149 
accu
 >>= () * 8;

150 
accu
 +(Ë
_ønd48_mu…
[0] * (Ë
x£ed
[1] +

151 (Ë
_ønd48_mu…
[1] * (Ë
x£ed
[0];

152 
ãmp
[1] = (Ë
accu
;

153 
accu
 >>= () * 8;

154 
accu
 +
_ønd48_mu…
[0] * 
x£ed
[2] + _rand48_mult[1] * xseed[1] + _rand48_mult[2] * xseed[0];

155 
x£ed
[0] = 
ãmp
[0];

156 
x£ed
[1] = 
ãmp
[1];

157 
x£ed
[2] = (Ë
accu
;

158 
	}
}

168 
	$DISKSIM_ldexp
 (
x
, 
exp
)

170 
°¨t
 = 1.0;

171 
ôîs
 = (
exp
 > 0) ?Éxp : -exp;

172 
i
;

174 
	`disksim_ønd48_öôülize
();

177 i‡(
ôîs
 == 16) {

178 
°¨t
 = (
exp
 > 0) ? ()65536 : ()0.0000152587890625 ;

179 
ôîs
 = 0;

180 } i‡(
exp
 == -32) {

181 
°¨t
 = ()0.00000000023283064365386962890625 ;

183 
ôîs
 = 0;

184 } i‡(
exp
 == -48) {

185 
°¨t
 = ()0.000000000000003552713678800500929355621337890625 ;

187 
ôîs
 = 0;

191 
ôîs
 >= 8) {

192 
°¨t
 *(
exp
 > 0) ? 256 : 0.00390625 ;

193 
ôîs
 -= 8;

197 
i
=0; i<
ôîs
; i++) {

198 
°¨t
 *(
exp
 > 0) ? ()2.0 : () 0.5;

201  (
x
 * 
°¨t
);

202 
	}
}

208 
	$DISKSIM_î™d48
(
x£ed
[3])

210 
	`disksim_ønd48_öôülize
();

211 
	`DISKSIM__d‹™d48
(
x£ed
);

212  
	`DISKSIM_ldexp
((Ë
x£ed
[0], -48) +

213 
	`DISKSIM_ldexp
((Ë
x£ed
[1], -32) +

214 
	`DISKSIM_ldexp
((Ë
x£ed
[2], -16);

215 
	}
}

221 
	$DISKSIM_dønd48
()

223 
	`disksim_ønd48_öôülize
();

224  
	`DISKSIM_î™d48
(
_ønd48_£ed
);

226 
	}
}

232 
	$DISKSIM_jønd48
(
x£ed
[3])

234 
	`disksim_ønd48_öôülize
();

235 
	`DISKSIM__d‹™d48
(
x£ed
);

236  ((Ë
x£ed
[2] << 16) + () xseed[1];

237 
	}
}

243 
	$DISKSIM_Ã™d48
()

245 
	`disksim_ønd48_öôülize
();

246 
	`DISKSIM__d‹™d48
(
_ønd48_£ed
);

247  ((Ë
_ønd48_£ed
[2] << 15) + (() _rand48_seed[1] >> 1);

249 
	}
}

255 
	$DISKSIM_mønd48
()

257 
	`disksim_ønd48_öôülize
();

258 
	`DISKSIM__d‹™d48
(
_ønd48_£ed
);

259  ((Ë
_ønd48_£ed
[2] << 16) + () _rand48_seed[1];

260 
	}
}

266 
	$DISKSIM_ƒ™d48
(
x£ed
[3])

268 
	`disksim_ønd48_öôülize
();

269 
	`DISKSIM__d‹™d48
(
x£ed
);

270  ((Ë
x£ed
[2] << 15) + (() xseed[1] >> 1);

271 
	}
}

277 
	$DISKSIM_§™d48
(
£ed
)

279 
	`disksim_ønd48_öôülize
();

280 
_ønd48_£ed
[0] = 
RAND48_SEED_0
;

281 
_ønd48_£ed
[1] = (Ë
£ed
;

282 
_ønd48_£ed
[2] = (Ë(
£ed
 >> 16);

283 
_ønd48_mu…
[0] = 
RAND48_MULT_0
;

284 
_ønd48_mu…
[1] = 
RAND48_MULT_1
;

285 
_ønd48_mu…
[2] = 
RAND48_MULT_2
;

286 
_ønd48_add
 = 
RAND48_ADD
;

287 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_rand48.h

58 #i‚de‡
DISKSIM_RAND48_H


59 
	#DISKSIM_RAND48_H


	)

65 
DISKSIM_dønd48
 ();

68 
DISKSIM_§™d48
 (
__£edvÆ
);

71 
DISKSIM_Ã™d48
 ();

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_redun.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_°©.h
"

103 
	~"disksim_iosim.h
"

104 
	~"disksim_‹gÁ˚.h
"

105 
	~"disksim_log‹g.h
"

106 
	~"disksim_ioqueue.h
"

109 
	$log‹g_modulus_upd©e
 (
öc
, 
vÆ
, 
maxvÆ
)

111 
ªt
;

113 
ªt
 = 
vÆ
 + 
öc
;

114 i‡(
ªt
 < 0) {

115 
ªt
 +
maxvÆ
;

116 } i‡(
ªt
 >
maxvÆ
) {

117 
ªt
 -
maxvÆ
;

119 (
ªt
);

120 
	}
}

123 
	$log‹g_èbuœr_rŸty≥
 (
m≠ty≥
, 
ªdu¡y≥
, 
rŸty≥
, 
°rùeunô
)

125 i‡(
ªdu¡y≥
 !
PARITY_ROTATED
) {

126 (
FALSE
);

128 i‡(
m≠ty≥
 !
STRIPED
) {

129 (
FALSE
);

131 i‡(
°rùeunô
 == 0) {

132 (
FALSE
);

134 
rŸty≥
) {

135 
PARITY_LEFT_SYM
:

136 
PARITY_LEFT_ASYM
:

137 
PARITY_RIGHT_SYM
:

138 
PARITY_RIGHT_ASYM
:

139 (
TRUE
);

141 (
FALSE
);

142 
	}
}

145 
	$log‹g_∑rôy_rŸ©e_idól
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
)

147 i‡(
cuº
->
Êags
 & 
READ
) {

150 
cuº
->
√xt
 = 
	`i‹eq_c›y
(curr);

151 
cuº
->
√xt
->
devno
 = 
cuºlog‹g
->
idó o
;

152 
cuºlog‹g
->
idó o
 = (cuºlog‹g->idó ÿ+ 1Ë% cuºlog‹g->
numdisks
;

153 
	}
}

156 
	$log‹g_∑rôy_rŸ©e_øndom
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
)

158 i‡(
cuº
->
Êags
 & 
READ
) {

161 
cuº
->
√xt
 = 
	`i‹eq_c›y
(curr);

162 
cuº
->
√xt
->
devno
 == curr->devno) {

163 
cuº
->
√xt
->
devno
 = ()(()
cuºlog‹g
->
numdisks
 * 
	`DISKSIM_dønd48
());

165 
	}
}

168 
	$log‹g_shadowed_gë_sh‹t_di°
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numtocheck
, *
checkli°
)

170 
i
, 
j
;

171 
di°
;

172 
sh‹tdev
 = -1;

173 
sh‹tdi°
 = 999999999;

174 
tõs
[
MAXCOPIES
];

175 
no
;

177 
j
 = -1;

178 
i
 = 0; i < 
numtocheck
; i++) {

179 
no
 = 
checkli°
[
i
];

180 
di°
 = 
	`ioqueue_gë_di°
(
cuºlog‹g
->
devs
[(
cuº
->
devno
 + (
no
 * cuºlog‹g->
numdisks
))].
queue
, (cuº->
blkno
 + cuºlog‹g->devs[(cuº->devnÿ+ (nÿ* cuºlog‹g->numdisks))].
°¨tblkno
));

181 i‡(
di°
 >= 999999999) {

182 
	`Ârötf
(
°dîr
, "Haví'àÆlowed f‹Ü¨gêíough 'di°'†öÜog‹g_shadowed_gë_sh‹t_di° - %d\n", 
di°
);

183 
	`exô
(1);

185 i‡(
di°
 =
sh‹tdi°
) {

186 
j
++;

187 i‡(
j
 >
MAXCOPIES
) {

188 
	`Ârötf
(
°dîr
, "Haví'àÆlowed f‹ÉnoughÅõ†öÜog‹g_shadowed_gë_sh‹t_di° - %d\n", 
j
);

189 
	`exô
(1);

191 
tõs
[
j
] = 
no
;

193 i‡(
di°
 < 
sh‹tdi°
) {

194 
sh‹tdi°
 = 
di°
;

195 
sh‹tdev
 = 
no
;

196 
j
 = -1;

199 i‡(
sh‹tdev
 == -1) {

200 
	`Ârötf
(
°dîr
, "Illegal condition inÜogorg_shadowed_get_short_dist\n");

201 
	`exô
(1);

202 } i‡(
j
 != -1) {

203 
i
 = (Ë(
	`DISKSIM_dønd48
(Ë* (Ë(
j
+2));

204 i‡(
i
 != 0) {

205 
sh‹tdev
 = 
tõs
[(
i
-1)];

208 (
sh‹tdev
);

209 
	}
}

212 
	$log‹g_shadowed_gë_sh‹t_queue
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
def
)

214 
i
, 
j
;

215 
Àn
;

216 
sh‹tdev
 = -1;

217 
sh‹éí
 = 999999999;

218 
tõs
[
MAXCOPIES
];

220 
j
 = -1;

221 
i
 = 0; i < 
cuºlog‹g
->
c›õs
; i++) {

222 
Àn
 = 
	`ioqueue_gë_numbî_ö_queue
(
cuºlog‹g
->
devs
[(
cuº
->
devno
 + (
i
 * cuºlog‹g->
numdisks
))].
queue
);

223 i‡(
Àn
 >= 999999999) {

224 
	`Ârötf
(
°dîr
, "Haví'àÆlowed f‹Ü¨gêíough 'di°'†öÜog‹g_shadowed_gë_sh‹t_queuê- %d\n", 
Àn
);

225 
	`exô
(1);

227 i‡(
Àn
 =
sh‹éí
) {

228 
j
++;

229 i‡(
j
 >
MAXCOPIES
) {

230 
	`Ârötf
(
°dîr
, "Haví'àÆlowed f‹ÉnoughÅõ†öÜog‹g_shadowed_gë_sh‹t_queuê- %d\n", 
j
);

231 
	`exô
(1);

233 
tõs
[
j
] = 
i
;

235 i‡(
Àn
 < 
sh‹éí
) {

236 
sh‹éí
 = 
Àn
;

237 
sh‹tdev
 = 
i
;

238 
j
 = -1;

241 i‡(
sh‹tdev
 == -1) {

242 
	`Ârötf
(
°dîr
, "Illegal condition inÜogorg_shadowed_get_short_queue\n");

243 
	`exô
(1);

244 } i‡(
j
 != -1) {

245 i‡(
def
 == 1) {

246 
i
 = (Ë(
	`DISKSIM_dønd48
(Ë* (Ë(
j
+2));

247 i‡(
i
 != 0) {

248 
sh‹tdev
 = 
tõs
[(
i
-1)];

250 } i‡(
def
 == 2) {

251 
j
++;

252 
tõs
[
j
] = 
sh‹tdev
;

253 
sh‹tdev
 = 
	`log‹g_shadowed_gë_sh‹t_di°
(
cuºlog‹g
, 
cuº
, (
j
+1), 
tõs
);

255 
	`Ârötf
(
°dîr
, "Unknow¿deÁu…Åõ bªakî i¿log‹g_shadowed_gë_sh‹t_queuê- %d\n", 
def
);

256 
	`exô
(1);

259 (
sh‹tdev
);

260 
	}
}

263 
	$log‹g_shadowed
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numªqs
)

265 
i
, 
j
;

266 
i‹eq_evít
 *
ãmp
;

267 
i‹eq_evít
 *
√wªq
;

268 
checkli°
[
MAXCOPIES
];

270 
ãmp
 = 
cuº
;

271 i‡(
cuº
->
Êags
 & 
READ
) {

272 
i
 = 0; i < 
numªqs
; i++) {

273 
cuºlog‹g
->
c›ychoi˚
) {

274 
SHADOW_PRIMARY
:

277 
SHADOW_RANDOM
:

278 
ãmp
->
devno
 +
cuºlog‹g
->
numdisks
 * (Ë(
	`DISKSIM_dønd48
(Ë* (Ëcuºlog‹g->
c›õs
);

280 
SHADOW_ROUNDROBIN
:

281 
ãmp
->
devno
 +
cuºlog‹g
->
numdisks
 * cuºlog‹g->
ªdu¡oggÀ
;

282 
cuºlog‹g
->
ªdu¡oggÀ
++;

283 
cuºlog‹g
->
ªdu¡oggÀ
 %cuºlog‹g->
c›õs
;

285 
SHADOW_SHORTDIST
:

286 
j
 = 0; j < 
cuºlog‹g
->
c›õs
; j++)

287 
checkli°
[
j
] = j;

288 
ãmp
->
devno
 +
cuºlog‹g
->
numdisks
 * 
	`log‹g_shadowed_gë_sh‹t_di°
(cuºlog‹g,Åemp, cuºlog‹g->
c›õs
, 
checkli°
);

290 
SHADOW_SHORTQUEUE
:

291 
ãmp
->
devno
 +
cuºlog‹g
->
numdisks
 * 
	`log‹g_shadowed_gë_sh‹t_queue
(currlogorg,Åemp, 1);

293 
SHADOW_SHORTQUEUE2
:

294 
ãmp
->
devno
 +
cuºlog‹g
->
numdisks
 * 
	`log‹g_shadowed_gë_sh‹t_queue
(currlogorg,Åemp, 2);

297 
	`Ârötf
(
°dîr
, "Unknown shadow choiceÅypeátÜogorg_shadowed\n");

298 
	`exô
(1);

300 
ãmp
 =Åemp->
√xt
;

302 (
numªqs
);

304 
i
 = 0; i < 
numªqs
; i++) {

305 
j
 = 1; j < 
cuºlog‹g
->
c›õs
; j++) {

306 
√wªq
 = 
	`i‹eq_c›y
(
ãmp
);

307 
ãmp
->
√xt
 = 
√wªq
;

308 
√wªq
->
devno
 +
cuºlog‹g
->
numdisks
;

309 
ãmp
 = 
√wªq
;

311 
ãmp
 =Åemp->
√xt
;

313 (
cuºlog‹g
->
c›õs
 * 
numªqs
);

315 
	}
}

318 
	$log‹g_∑rôy_disk
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numªqs
)

320 
dïíds
 *
dïíd
;

322 i‡(
cuº
->
Êags
 & 
READ
) {

323 (
numªqs
);

325 i‡((
cuºlog‹g
->
m≠ty≥
 =
STRIPED
Ë&& (cuºlog‹g->
°rùeunô
 == 0)) {

326 
cuº
->
√xt
 = 
	`i‹eq_c›y
(curr);

327 
cuº
->
√xt
->
devno
 = 
cuºlog‹g
->
numdisks
;

328 (
numªqs
+1);

330 i‡(
numªqs
 != 1) {

331 
	`Ârötf
(
°dîr
, "Toÿm™yÑeq†©Üog‹g_∑rôy_disk - %d\n", 
numªqs
);

332 
	`exô
(1);

334 
dïíd
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

335 
dïíd
->
blkno
 = 
cuº
->blkno;

336 
dïíd
->
devno
 = 
cuº
->devno;

337 
dïíd
->
numdïs
 = 2;

338 
dïíd
->
dïs
[0] = 
	`i‹eq_c›y
(
cuº
);

339 
dïíd
->
dïs
[1] = 
	`i‹eq_c›y
(
cuº
);

340 
dïíd
->
dïs
[0]->
›id
 = 2;

341 
dïíd
->
dïs
[0]->
devno
 = 
cuºlog‹g
->
numdisks
;

342 
dïíd
->
√xt
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

343 
dïíd
->
√xt
->√xà
NULL
;

344 
dïíd
->
√xt
->
blkno
 = 
cuº
->blkno;

345 
dïíd
->
√xt
->
devno
 = 
cuºlog‹g
->
numdisks
;

346 
dïíd
->
√xt
->
dïs
[0] = depend->deps[0];

347 
dïíd
->
√xt
->
dïs
[1] = depend->deps[1];

348 i‡(
cuºlog‹g
->
wrôesync
 =
TRUE
) {

349 
dïíd
->
dïs
[1]->
›id
 = 2;

350 
dïíd
->
√xt
->
numdïs
 = 2;

352 
dïíd
->
dïs
[1]->
›id
 = 1;

353 
dïíd
->
√xt
->
numdïs
 = 1;

355 
cuº
->
Êags
 |
READ
;

356 
cuº
->
√xt
 = 
	`i‹eq_c›y
(curr);

357 
cuº
->
√xt
->
devno
 = 
cuºlog‹g
->
numdisks
;

358 
cuº
->
¥ev
 = (
i‹eq_evít
 *Ë
dïíd
;

360 
	}
}

363 
	$log‹g_∑rôy_rŸ©e_upd©es
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
öc
)

365 
ªqs
 = 2;

366 
∑rôyno
;

367 
blk¶e·
;

368 
bcou¡
;

369 
i‹eq_evít
 *
√wªq
;

370 
∑rôyunô
;

371 
numdisks
;

372 
devno
;

373 
∑rôyblock
;

375 
∑rôyunô
 = 
cuºlog‹g
->parityunit;

376 
numdisks
 = 
cuºlog‹g
->numdisks;

378 
∑rôyblock
 = 
cuº
->
blkno
 / (
∑rôyunô
 * (
numdisks
 - 1));

379 
∑rôyno
 = (
cuº
->
blkno
 % (
∑rôyunô
 * (
numdisks
 - 1))) /Öarityunit;

380 
cuº
->
blkno
 +
∑rôyblock
 * 
∑rôyunô
;

381 i‡(
öc
 == -1) {

382 
devno
 = 
numdisks
 - (
∑rôyno
 %Çumdisks) - 1;

384 
devno
 = 
∑rôyno
 % 
numdisks
;

386 i‡(((
öc
 =1Ë&& (
cuº
->
devno
 <= devno)) || ((inc == -1) && (curr->devno >=devno))) {

387 
cuº
->
blkno
 +
∑rôyunô
;

388 
devno
 = 
	`log‹g_modulus_upd©e
(
öc
, devno, 
numdisks
);

389 
∑rôyno
++;

391 
blk¶e·
 = 
∑rôyunô
 - (
cuº
->
blkno
 % 
cuºlog‹g
->parityunit);

392 
bcou¡
 = 
cuº
->bcount;

393 i‡((
∑rôyunô
 !
cuºlog‹g
->∑rôyunôË&& ((
bcou¡
 > 
blk¶e·
) || (parityunit > currlogorg->parityunit))) {

394 
	`Ârötf
(
°dîr
, "Failed integrity check inÜogorg_parity_rotate_left\n");

395 
	`exô
(1);

397 
bcou¡
 > 
blk¶e·
) {

398 i‡(!(
cuº
->
Êags
 & 
READ
)) {

399 
√wªq
 = 
	`i‹eq_c›y
(
cuº
);

400 
√wªq
->
devno
 = devno;

401 
√wªq
->
bcou¡
 = 
blk¶e·
;

402 
√wªq
->
blkno
 = 
cuº
->blknÿ+ cuº->
bcou¡
 - bcount;

403 
√wªq
->
√xt
 = 
cuº
->next;

404 
cuº
->
√xt
 = 
√wªq
;

405 
ªqs
++;

407 
bcou¡
 -
blk¶e·
;

408 
devno
 = 
	`log‹g_modulus_upd©e
(
öc
, devno, 
numdisks
);

409 i‡(
devno
 =
cuº
->devno) {

410 
cuº
->
bcou¡
 +
∑rôyunô
;

411 
devno
 = 
	`log‹g_modulus_upd©e
(
öc
, devno, 
numdisks
);

412 
∑rôyno
++;

414 
∑rôyno
++;

415 
blk¶e·
 = 
∑rôyunô
;

417 i‡(
cuº
->
Êags
 & 
READ
) {

420 
√wªq
 = 
	`i‹eq_c›y
(
cuº
);

421 
√wªq
->
devno
 = devno;

422 
√wªq
->
blkno
 = 
cuº
->blknÿ+ cuº->
bcou¡
 - bcount;

423 
√wªq
->
bcou¡
 = bcount;

424 
√wªq
->
√xt
 = 
cuº
->next;

425 
cuº
->
√xt
 = 
√wªq
;

426 i‡(
∑rôyno
 > 
cuºlog‹g
->
numfuŒ
) {

427 
	`Ârötf
(
°dîr
, "Integrity check failure inÜogorg_parity_rotate_left\n");

428 
	`exô
(1);

430 (
ªqs
);

431 
	}
}

434 
	$log‹g_∑rôy_ªad_ﬁd_sync
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numªqs
)

436 
i
, 
j
;

437 
dïíds
 *
dïíd
;

438 
dïíds
 *
tmpdï
;

439 
i‹eq_evít
 *
ãmp
;

440 
devno
 = 1;

442 
dïíd
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

443 
dïíd
->
blkno
 = 
cuº
->blkno;

444 
dïíd
->
devno
 = 
cuº
->devno;

445 
dïíd
->
dïs
[0] = 
	`i‹eq_c›y
(
cuº
);

446 
dïíd
->
dïs
[0]->
›id
 = 
numªqs
;

447 
cuº
->
¥ev
 = (
i‹eq_evít
 *Ë
dïíd
;

448 
dïíd
->
numdïs
 = 
numªqs
;

449 
ãmp
 = 
cuº
->
√xt
;

450 
i
=1; i<
numªqs
; i++) {

451 i‡(
devno
 == 0) {

452 
dïíd
->
c⁄t
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

453 
dïíd
 = dïíd->
c⁄t
;

455 
dïíd
->
dïs
[
devno
] = 
	`i‹eq_c›y
(
ãmp
);

456 
dïíd
->
dïs
[
devno
]->
›id
 = 
numªqs
;

457 
devno
 = 
	`log‹g_modulus_upd©e
(1, devno, 10);

458 
ãmp
 =Åemp->
√xt
;

460 
ãmp
 = 
cuº
->
√xt
;

461 
cuº
->
Êags
 |
READ
;

462 
i
=1; i<
numªqs
; i++) {

463 
dïíd
 = (
dïíds
 *Ë
	`i‹eq_c›y
(
cuº
->
¥ev
);

464 
dïíd
->
√xt
 = (
dïíds
 *Ë
cuº
->
¥ev
;

465 
cuº
->
¥ev
 = (
i‹eq_evít
 *Ë
dïíd
;

466 
dïíd
->
blkno
 = 
ãmp
->blkno;

467 
dïíd
->
devno
 = 
ãmp
->devno;

468 
tmpdï
 = 
dïíd
->
c⁄t
;

469 
j
=0; j<(
numªqs
/10); j++) {

470 
dïíd
->
c⁄t
 = (
dïíds
 *Ë
	`i‹eq_c›y
((
i‹eq_evít
 *Ë
tmpdï
);

471 
tmpdï
 =Åmpdï->
c⁄t
;

472 
dïíd
 = dïíd->
c⁄t
;

474 
ãmp
->
Êags
 |
READ
;

475 
ãmp
 =Åemp->
√xt
;

477 
	}
}

480 
	$log‹g_∑rôy_ªad_ﬁd_nosync
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numªqs
)

482 
i
;

483 
dïíds
 *
dïíd
;

484 
dïíds
 *
tmpdï
;

485 
i‹eq_evít
 *
ãmp
;

486 
devno
 = 1;

488 
dïíd
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

489 
dïíd
->
blkno
 = 
cuº
->blkno;

490 
dïíd
->
devno
 = 
cuº
->devno;

491 
dïíd
->
numdïs
 = 
numªqs
;

492 
dïíd
->
√xt
 = 
NULL
;

493 
dïíd
->
dïs
[0] = 
	`i‹eq_c›y
(
cuº
);

494 
dïíd
->
dïs
[0]->
›id
 = 1;

495 
cuº
->
¥ev
 = (
i‹eq_evít
 *Ë
dïíd
;

496 
cuº
->
Êags
 |
READ
;

497 
ãmp
 = 
cuº
->
√xt
;

498 
i
=1; i<
numªqs
; i++) {

499 i‡(
devno
 == 0) {

500 
dïíd
->
c⁄t
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

501 
dïíd
 = dïíd->
c⁄t
;

503 
tmpdï
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

504 
tmpdï
->
blkno
 = 
ãmp
->blkno;

505 
tmpdï
->
devno
 = 
ãmp
->devno;

506 
tmpdï
->
numdïs
 = 1;

507 
tmpdï
->
√xt
 = (
dïíds
 *Ë
cuº
->
¥ev
;

508 
cuº
->
¥ev
 = (
i‹eq_evít
 *Ë
tmpdï
;

509 
tmpdï
->
dïs
[0] = 
	`i‹eq_c›y
(
ãmp
);

510 
tmpdï
->
dïs
[0]->
›id
 = 2;

511 
dïíd
->
dïs
[
devno
] = 
tmpdï
->deps[0];

512 
ãmp
->
Êags
 |
READ
;

513 
devno
 = 
	`log‹g_modulus_upd©e
(1, devno, 10);

514 
ãmp
 =Åemp->
√xt
;

516 
	}
}

519 
	$log‹g_∑rôy_rŸ©e
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numªqs
)

521 
ªqs
 = 2;

523 i‡(
cuºlog‹g
->
m≠ty≥
 =
IDEAL
) {

524 
	`log‹g_∑rôy_rŸ©e_idól
(
cuºlog‹g
, 
cuº
);

525 } i‡(
cuºlog‹g
->
m≠ty≥
 =
RANDOM
) {

526 
	`log‹g_∑rôy_rŸ©e_øndom
(
cuºlog‹g
, 
cuº
);

527 } i‡(
cuºlog‹g
->
m≠ty≥
 =
ASIS
) {

528 
cuºlog‹g
->
rŸty≥
) {

530 
PARITY_LEFT_SYM
:

531 
PARITY_LEFT_ASYM
:

532 
ªqs
 = 
	`log‹g_∑rôy_rŸ©e_upd©es
(
cuºlog‹g
, 
cuº
, -1);

535 
PARITY_RIGHT_SYM
:

536 
PARITY_RIGHT_ASYM
:

537 
ªqs
 = 
	`log‹g_∑rôy_rŸ©e_upd©es
(
cuºlog‹g
, 
cuº
, 1);

541 
	`Ârötf
(
°dîr
, "Unknow¿rŸty≥áàlog‹g_∑rôy_rŸ©ê- %d\n", 
cuºlog‹g
->
rŸty≥
);

542 
	`exô
(1);

545 
	`Ârötf
(
°dîr
, "Unknow¿m≠ty≥áàlog‹g_∑rôy_rŸ©ê- %d\n", 
cuºlog‹g
->
m≠ty≥
);

546 
	`exô
(1);

548 i‡(
cuº
->
Êags
 & 
READ
) {

552 i‡(
cuºlog‹g
->
wrôesync
 =
TRUE
) {

553 
	`log‹g_∑rôy_ªad_ﬁd_sync
(
cuºlog‹g
, 
cuº
, 
ªqs
);

555 
	`log‹g_∑rôy_ªad_ﬁd_nosync
(
cuºlog‹g
, 
cuº
, 
ªqs
);

558 (2*
ªqs
);

559 
	}
}

562 
	$log‹g_joö_£qªqs
 (
i‹eq_evít
 *
ªqli°
, i‹eq_evíà*
cuº
, 
£qgive
)

564 
i‹eq_evít
 *
ãmp
;

565 
i‹eq_evít
 *
dñ
;

566 
numªqs
 = 0;

567 
di°™˚
;

569 
ãmp
 = 
ªqli°
;

570 i‡(
ãmp
) {

571 
ãmp
->
√xt
) {

572 
di°™˚
 = 
ãmp
->
√xt
->
blkno
 -Åemp->blknÿ-Åemp->
bcou¡
;

576 i‡(
di°™˚
 < 0) {

577 
	`Ârötf
(
°dîr
, "I¡egrôy check faûuªáàlog‹g_joö_£qªq†- blknÿ%d, bcou¡ %d, blknÿ%d,Ñód %d\n", 
ãmp
->
blkno
,Åemp->
bcou¡
,Åemp->
√xt
->blkno, (ãmp->
Êags
 & 
READ
));

578 
	`exô
(1);

580 i‡(((
ãmp
->
Êags
 & 
READ
Ë=—emp->
√xt
->Êag†& READ)Ë&& (
di°™˚
 <
£qgive
)) {

581 
dñ
 = 
ãmp
->
√xt
;

582 
ãmp
->
√xt
 = 
dñ
->next;

583 
ãmp
->
bcou¡
 +
dñ
->bcou¡ + 
di°™˚
;

584 
ãmp
->
›id
 |
dñ
->opid;

585 
	`addt€xåaq
((
evít
 *Ë
dñ
);

587 
dñ
 = 
ãmp
;

588 
ãmp
 = 
dñ
->
√xt
;

589 
dñ
->
√xt
 = 
cuº
->next;

590 
cuº
->
√xt
 = 
dñ
;

591 
dñ
->
time
 = 
cuº
->time;

592 
dñ
->
buf
 = 
cuº
->buf;

593 
numªqs
++;

596 
numªqs
++;

597 
ãmp
->
√xt
 = 
cuº
->next;

598 
cuº
->
√xt
 = 
ãmp
;

599 
ãmp
->
time
 = 
cuº
->time;

600 
ãmp
->
buf
 = 
cuº
->buf;

602 (
numªqs
);

603 
	}
}

606 
	$log‹g_∑rôy_èbÀ_ö£π
 (
i‹eq_evít
 **
hód
, i‹eq_evíà*
cuº
)

608 
i‹eq_evít
 *
ãmp
;

610 i‡(((*
hód
Ë=
NULL
Ë|| (
cuº
->
blkno
 < (*head)->blkno)) {

611 
cuº
->
√xt
 = (*
hód
);

612 (*
hód
Ë
cuº
;

614 
ãmp
 = (*
hód
);

615 (
ãmp
->
√xt
Ë&& (
cuº
->
blkno
 >=Åemp->next->blkno)) {

616 
ãmp
 =Åemp->
√xt
;

618 
cuº
->
√xt
 = 
ãmp
->next;

619 
ãmp
->
√xt
 = 
cuº
;

621 
	}
}

624 
	$log‹g_∑rôy_èbÀ_ªad_ﬁd
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
rowhód
, i‹eq_evíà**
ªqli°
, 
›id
)

626 
i‹eq_evít
 *
ãmp
;

627 
i‹eq_evít
 *
√wªq
;

628 
i‹eq_evít
 *
¥ev
 = 
NULL
;

630 
ãmp
 = 
rowhód
;

631 
ãmp
) {

632 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

633 
√wªq
->
blkno
 = 
ãmp
->blkno;

634 
√wªq
->
devno
 = 
ãmp
->devno;

635 
√wªq
->
bcou¡
 = 
ãmp
->bcount;

636 
√wªq
->
Êags
 = 
ãmp
->Êag†| 
READ
;

637 
√wªq
->
›id
 = opid;

638 
	`log‹g_∑rôy_èbÀ_ö£π
(&
ªqli°
[
√wªq
->
devno
],Çewreq);

639 
√wªq
->
¥ev
 =Örev;

640 
¥ev
 = 
√wªq
;

642 i‡(
ãmp
->
¥ev
 =
NULL
) {

643 
ãmp
->
›id
 = opid;

645 
ãmp
 =Åemp->
¥ev
;

647 
	}
}

650 
	$log‹g_∑rôy_èbÀ_ªc⁄
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
rowhód
, i‹eq_evíà**
ªqli°
, 
°rùío
, 
unôno
, 
èbÀadd
, 
›id
)

652 
i‹eq_evít
 *
ãmp
;

653 
i‹eq_evít
 *
√wªq
;

654 
íåyno
;

655 
möblkno
;

656 
maxblkno
;

657 
œ°íåy
;

658 
i
;

659 
blkno
;

660 
off£t
;

662 
ãmp
 = 
rowhód
;

663 i‡(
ãmp
 =
NULL
) {

664 
	`Ârötf
(
°dîr
, "Can't have NULLÑowheadátÜogorg_parity_table_recon\n");

665 
	`exô
(1);

667 
œ°íåy
 = (
°rùío
 + 1Ë* 
cuºlog‹g
->
∑π•î°rùe
 + stripeno;

668 
ãmp
->
¥ev
) {

669 
ãmp
 =Åemp->
¥ev
;

671 
ãmp
->
›id
 = opid;

672 
möblkno
 = 
ãmp
->
blkno
 - 
cuºlog‹g
->
èbÀ
[
œ°íåy
].blknÿ- 
èbÀadd
;

673 
maxblkno
 = 
möblkno
 + 
ãmp
->
bcou¡
;

674 
íåyno
 = 
°rùío
 * 
cuºlog‹g
->
∑π•î°rùe
 + stripeno;

675 
i
 = 0; i < 
unôno
; i++) {

676 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

677 
√wªq
->
devno
 = 
cuºlog‹g
->
èbÀ
[
íåyno
].devno;

678 
√wªq
->
blkno
 = 
èbÀadd
 + 
möblkno
 + 
cuºlog‹g
->
èbÀ
[
íåyno
].blkno;

679 
√wªq
->
bcou¡
 = 
maxblkno
 - 
möblkno
;

680 
√wªq
->
Êags
 = 
rowhód
->Êag†| 
READ
;

681 
√wªq
->
›id
 = opid;

682 
	`log‹g_∑rôy_èbÀ_ö£π
(&
ªqli°
[
√wªq
->
devno
],Çewreq);

683 
íåyno
++;

685 
ãmp
 = 
rowhód
;

686 
ãmp
->
¥ev
) {

687 
blkno
 = 
cuºlog‹g
->
èbÀ
[
íåyno
].blkno;

688 
off£t
 = 
ãmp
->
blkno
 - 
èbÀadd
 - blkno;

689 i‡(
off£t
 > 
möblkno
) {

690 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

691 
√wªq
->
devno
 = 
ãmp
->devno;

692 
√wªq
->
blkno
 = 
èbÀadd
 + blknÿ+ 
möblkno
;

693 
√wªq
->
bcou¡
 = 
off£t
 - 
möblkno
;

694 
√wªq
->
Êags
 = 
ãmp
->Êag†| 
READ
;

695 
√wªq
->
›id
 = opid;

696 
	`log‹g_∑rôy_èbÀ_ö£π
(&
ªqli°
[
√wªq
->
devno
],Çewreq);

698 i‡((
off£t
 + 
ãmp
->
bcou¡
Ë< 
maxblkno
) {

699 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

700 
√wªq
->
devno
 = 
ãmp
->devno;

701 
√wªq
->
blkno
 = 
ãmp
->blknÿ+Åemp->
bcou¡
;

702 
√wªq
->
bcou¡
 = 
maxblkno
 - 
off£t
 - 
ãmp
->bcount;

703 
√wªq
->
Êags
 = 
ãmp
->Êag†| 
READ
;

704 
√wªq
->
›id
 = opid;

705 
	`log‹g_∑rôy_èbÀ_ö£π
(&
ªqli°
[
√wªq
->
devno
],Çewreq);

707 
íåyno
++;

708 
ãmp
 =Åemp->
¥ev
;

710 ; 
íåyno
 < 
œ°íåy
;Éntryno++) {

711 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

712 
√wªq
->
devno
 = 
cuºlog‹g
->
èbÀ
[
íåyno
].devno;

713 
√wªq
->
blkno
 = 
èbÀadd
 + 
möblkno
 + 
cuºlog‹g
->
èbÀ
[
íåyno
].blkno;

714 
√wªq
->
bcou¡
 = 
maxblkno
 - 
möblkno
;

715 
√wªq
->
Êags
 = 
rowhód
->Êag†| 
READ
;

716 
√wªq
->
›id
 = opid;

717 
	`log‹g_∑rôy_èbÀ_ö£π
(&
ªqli°
[
√wªq
->
devno
],Çewreq);

719 
	}
}

722 
	$log‹g_∑rôy_èbÀ_dodïs_sync
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, i‹eq_evíà**
ªdu∆i°
, i‹eq_evíà**
ªqli°
)

724 
i
, 
j
;

725 
dïíds
 *
dïíd
;

726 
dïíds
 *
tmpdï
;

727 
›id
 = 0;

728 
numdïs
 = 0;

729 
i‹eq_evít
 *
ãmp
;

730 
i‹eq_evít
 *
dïli°
 = 
NULL
;

731 
devno
 = 1;

733 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

734 
ãmp
 = 
ªdu∆i°
[
i
];

735 
ãmp
) {

736 
ãmp
->
›id
 = 
cuº
->opid;

737 
›id
++;

738 i‡(
ãmp
->
√xt
 =
NULL
) {

739 
ãmp
->
√xt
 = 
cuº
->next;

740 
cuº
->
√xt
 = 
ªdu∆i°
[
i
];

743 
ãmp
 =Åemp->
√xt
;

745 
ãmp
 = 
ªqli°
[
i
];

746 
ãmp
) {

747 
numdïs
++;

748 i‡(
ãmp
->
√xt
 =
NULL
) {

749 
ãmp
->
√xt
 = 
dïli°
;

750 
dïli°
 = 
ªqli°
[
i
];

753 
ãmp
 =Åemp->
√xt
;

756 i‡(
numdïs
 <= 0) {

757 
	`Ârötf
(
°dîr
, "Can't have zeroÑequestsátÜogorg_parity_table_dodeps_sync\n");

758 
	`exô
(1);

760 i‡(
›id
 == 0) {

761 
cuº
->
¥ev
 = 
NULL
;

762 
cuº
->
√xt
 = 
dïli°
;

765 
dïíd
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

766 
dïíd
->
blkno
 = 
cuº
->
√xt
->blkno;

767 
dïíd
->
devno
 = 
cuº
->
√xt
->devno;

768 
dïíd
->
numdïs
 =Çumdeps;

769 
cuº
->
¥ev
 = (
i‹eq_evít
 *Ë
dïíd
;

770 
dïíd
->
dïs
[0] = 
dïli°
;

771 
dïli°
->
›id
 = opid;

772 
ãmp
 = 
dïli°
->
√xt
;

773 
i
=1; i<
numdïs
; i++) {

774 i‡(
devno
 == 0) {

775 
dïíd
->
c⁄t
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

776 
dïíd
 = dïíd->
c⁄t
;

778 
dïíd
->
dïs
[
devno
] = 
ãmp
;

779 
ãmp
->
›id
 = opid;

780 
devno
 = 
	`log‹g_modulus_upd©e
(1, devno, 10);

781 
ãmp
 =Åemp->
√xt
;

783 
ãmp
 = 
cuº
->
√xt
->next;

784 
i
=1; i<
›id
; i++) {

785 
dïíd
 = (
dïíds
 *Ë
	`i‹eq_c›y
(
cuº
->
¥ev
);

786 
dïíd
->
√xt
 = (
dïíds
 *Ë
cuº
->
¥ev
;

787 
cuº
->
¥ev
 = (
i‹eq_evít
 *Ë
dïíd
;

788 
dïíd
->
blkno
 = 
ãmp
->blkno;

789 
dïíd
->
devno
 = 
ãmp
->devno;

790 
tmpdï
 = 
dïíd
->
c⁄t
;

791 
j
=0; j<(
numdïs
/10); j++) {

792 
dïíd
->
c⁄t
 = (
dïíds
 *Ë
	`i‹eq_c›y
((
i‹eq_evít
 *Ë
tmpdï
);

793 
tmpdï
 =Åmpdï->
c⁄t
;

794 
dïíd
 = dïíd->
c⁄t
;

796 
ãmp
 =Åemp->
√xt
;

798 
	}
}

801 
	$log‹g_∑rôy_èbÀ_dodïs_nosync
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, i‹eq_evíà**
ªdu∆i°
, i‹eq_evíà**
ªqli°
)

803 
i
;

804 
dïíds
 *
dïíd
;

805 
dïíds
 *
tmpdï
;

806 
i‹eq_evít
 *
ãmp
;

807 
i‹eq_evít
 *
dñ
;

808 
i‹eq_evít
 *
tm¥ód
;

809 
i‹eq_evít
 *
ªadli°
 = 
NULL
;

810 
i‹eq_evít
 *
dïli°
 = 
NULL
;

811 
hﬁddï
;

813 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

814 
ãmp
 = 
ªdu∆i°
[
i
];

815 
ãmp
) {

816 
dïíd
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

817 
dïíd
->
blkno
 = 
ãmp
->blkno;

818 
dïíd
->
devno
 = 
ãmp
->devno;

819 
dïíd
->
numdïs
 = 0;

820 
dïíd
->
√xt
 = 
NULL
;

821 
ãmp
->
¥ev
 = (
i‹eq_evít
 *Ë
dïíd
;

822 i‡(
ãmp
->
√xt
 =
NULL
) {

823 
ãmp
->
√xt
 = 
ªadli°
;

824 
ªadli°
 = 
ªdu∆i°
[
i
];

827 
ãmp
 =Åemp->
√xt
;

829 
ãmp
 = 
ªqli°
[
i
];

830 
ãmp
) {

831 
dñ
 = 
ãmp
;

832 
ãmp
 =Åemp->
√xt
;

833 i‡((
ªdu∆i°
[
i
] =
NULL
Ë&& (
dñ
->
›id
 == 0)) {

834 
dñ
->
√xt
 = 
cuº
->next;

835 
cuº
->
√xt
 = 
dñ
;

837 
dñ
->
√xt
 = 
dïli°
;

838 
dïli°
 = 
dñ
;

842 i‡(
ªadli°
 =
NULL
) {

843 i‡(
dïli°
) {

844 
	`Ârötf
(
°dîr
, "Unacceptable condition inÜogorg_parity_table_dodeps_nosync\n");

845 
	`exô
(1);

847 
cuº
->
¥ev
 = 
NULL
;

850 
ãmp
 = 
dïli°
;

851 
ãmp
) {

852 
hﬁddï
 = 
ãmp
->
›id
;

853 
ãmp
->
›id
 = 0;

854 
tm¥ód
 = 
ªadli°
;

855 
tm¥ód
) {

856 i‡((
tm¥ód
->
devno
 =
ãmp
->devnoË| (
hﬁddï
 &Åm¥ód->
›id
)) {

857 
tmpdï
 = (
dïíds
 *Ë
tm¥ód
->
¥ev
;

858 
	`ASSERT
 (
tmpdï
 !
NULL
);

859 i‡(
tmpdï
->
numdïs
 > 0) {

860 
i
=0; i<((
tmpdï
->
numdïs
-1)/10); i++) {

861 
tmpdï
 =Åmpdï->
c⁄t
;

863 i‡((
tmpdï
->
numdïs
 % 10) == 0) {

864 
tmpdï
->
c⁄t
 = (
dïíds
 *Ë
	`gë‰omexåaq
();

865 
tmpdï
 =Åmpdï->
c⁄t
;

868 
tmpdï
->
dïs
[—mpdï->
numdïs
 % 10)] = 
ãmp
;

869 
tmpdï
->
numdïs
++;

870 
ãmp
->
›id
++;

872 
tm¥ód
 =Åm¥ód->
√xt
;

874 
ãmp
 =Åemp->
√xt
;

876 
ãmp
 = 
ªadli°
;

877 
cuº
->
¥ev
 = 
NULL
;

878 
ãmp
) {

879 
dïíd
 = (
dïíds
 *Ë
ãmp
->
¥ev
;

880 
ãmp
->
¥ev
 = 
NULL
;

881 
dïíd
->
√xt
 = (
dïíds
 *Ë
cuº
->
¥ev
;

882 
cuº
->
¥ev
 = (
i‹eq_evít
 *Ë
dïíd
;

883 i‡(
ãmp
->
√xt
 =
NULL
) {

884 
ãmp
->
√xt
 = 
cuº
->next;

885 
cuº
->
√xt
 = 
ªadli°
;

888 
ãmp
 =Åemp->
√xt
;

890 
	}
}

893 
	$log‹g_∑rôy_èbÀ
 (
log‹g
 *
cuºlog‹g
, 
i‹eq_evít
 *
cuº
, 
numªqs
)

895 
i
;

896 
i‹eq_evít
 *
ªqs
[
MAXDEVICES
];

897 
i‹eq_evít
 *
ªduƒeqs
[
MAXDEVICES
];

898 
ªq˙t
 = 0;

899 
i‹eq_evít
 *
œ°row
 = 
NULL
;

900 
°rùeunô
;

901 
i‹eq_evít
 *
ãmp
;

902 
i‹eq_evít
 *
√wªq
;

903 
unôno
;

904 
°rùío
;

905 
íåyno
;

906 
blkno
;

907 
blksö∑π
;

908 
ªqsize
;

909 
∑π•î°rùe
;

910 
row˙t
 = 1;

911 
fú°row
 = 0;

912 
›id
 = 0x1;

913 
blkscovîed
;

914 
èbÀíåy
 *
èbÀ
;

915 
èbÀ°¨t
;

916 
¥evíåyno
;

920 i‡(
numªqs
 != 1) {

921 
	`Ârötf
(
°dîr
, "Mu…ùÀÇumªq†©Üog‹g_∑rôy_èbÀ i†nŸác˚±abÀ - %d\n", 
numªqs
);

922 
	`exô
(1);

925 
°rùeunô
 = 
cuºlog‹g
->stripeunit;

926 
∑π•î°rùe
 = 
cuºlog‹g
->partsperstripe;

927 
èbÀ
 = 
cuºlog‹g
->table;

928 i‡(
cuºlog‹g
->
addrby∑πs
) {

929 
cuº
->
blkno
 +cuº->
devno
 * 
cuºlog‹g
->
blk•î∑π
;

931 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

932 
ªqs
[
i
] = 
NULL
;

934 
unôno
 = 
cuº
->
blkno
 / 
°rùeunô
;

935 
°rùío
 = 
unôno
 / 
∑π•î°rùe
;

936 
èbÀ°¨t
 = (
°rùío
 / 
cuºlog‹g
->
èbÀ°rùes
Ë* cuºlog‹g->
èbÀsize
;

937 
°rùío
 = såùíÿ% 
cuºlog‹g
->
èbÀ°rùes
;

938 
blkno
 = 
èbÀ°¨t
 + 
èbÀ
[(
°rùío
*(
∑π•î°rùe
+1))].blkno;

939 i‡(
blkno
 =
cuºlog‹g
->
numfuŒ
) {

940 
°rùeunô
 = 
cuºlog‹g
->
a˘uÆblk•î∑π
 - 
blkno
;

941 
cuº
->
blkno
 -= blkno;

942 
unôno
 = 
cuº
->
blkno
 / 
°rùeunô
;

944 
blksö∑π
 = 
°rùeunô
;

945 
unôno
 = unônÿ% 
∑π•î°rùe
;

946 
cuº
->
blkno
 = cuº->blknÿ% 
°rùeunô
;

947 
ªqsize
 = 
cuº
->
bcou¡
;

948 
íåyno
 = 
°rùío
 * 
∑π•î°rùe
 + såùíÿ+ 
unôno
;

949 
blkno
 = 
èbÀ°¨t
 + 
èbÀ
[
íåyno
].blkno;

950 
blksö∑π
 -
cuº
->
blkno
;

951 
ãmp
 = 
	`i‹eq_c›y
(
cuº
);

952 
cuº
->
√xt
 = 
ãmp
;

953 
ãmp
->
blkno
 = blknÿ+ 
cuº
->blkno;

954 
ãmp
->
devno
 = 
èbÀ
[
íåyno
].devno;

955 
ãmp
->
›id
 = 0;

956 
blkscovîed
 = 
cuº
->
bcou¡
;

957 
cuº
->
blkno
 = 
°rùío
;

958 
cuº
->
devno
 = 
unôno
;

959 
cuº
->
bcou¡
 = 
èbÀ°¨t
;

960 
ªqs
[
ãmp
->
devno
] = 
cuº
->
√xt
;

961 
ãmp
->
√xt
 = 
NULL
;

962 
ãmp
->
¥ev
 = 
NULL
;

963 i‡(
ªqsize
 > 
blksö∑π
) {

964 
ãmp
->
bcou¡
 = 
blksö∑π
;

965 
blkscovîed
 = 
blksö∑π
;

966 
ªqsize
 -
blksö∑π
;

967 
unôno
++;

968 i‡(
unôno
 =
∑π•î°rùe
) {

969 i‡(!(
cuº
->
Êags
 & 
READ
)) {

970 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

971 
√wªq
->
devno
 = 
èbÀ
[(
íåyno
+1)].devno;

972 
√wªq
->
blkno
 = 
èbÀ
[(
íåyno
+1)].blkno;

973 
√wªq
->
blkno
 +
èbÀ°¨t
 + 
ãmp
->blkno - blkno;

974 
√wªq
->
bcou¡
 = 
blkscovîed
;

975 
√wªq
->
Êags
 = 
cuº
->flags;

976 
√wªq
->
›id
 = 0;

977 
ªqs
[
√wªq
->
devno
] =Çewreq;

978 
√wªq
->
√xt
 = 
NULL
;

979 
ãmp
->
¥ev
 = 
√wªq
;

980 
√wªq
->
¥ev
 = 
NULL
;

982 
blkscovîed
 = 0;

983 
unôno
 = 0;

984 i‡(
fú°row
 == 0) {

985 
fú°row
 = 1;

987 
row˙t
 = 0;

988 
°rùío
++;

989 
ãmp
 = 
NULL
;

990 i‡(
°rùío
 =
cuºlog‹g
->
èbÀ°rùes
) {

991 
°rùío
 = 0;

992 
èbÀ°¨t
 +
cuºlog‹g
->
èbÀsize
;

995 
íåyno
 = (
°rùío
 * 
∑π•î°rùe
Ë+ såùíÿ+ 
unôno
;

996 
blkno
 = 
èbÀ°¨t
 + 
èbÀ
[
íåyno
].blkno;

997 
blksö∑π
 = (
blkno
 !
cuºlog‹g
->
numfuŒ
Ë? 
°rùeunô
 : cuºlog‹g->
a˘uÆblk•î∑π
 - blkno;

998 
ªqsize
 > 
blksö∑π
) {

999 
row˙t
++;

1000 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1001 
√wªq
->
blkno
 = blkno;

1002 
√wªq
->
devno
 = 
èbÀ
[
íåyno
].devno;

1003 
√wªq
->
bcou¡
 = 
blksö∑π
;

1004 
blkscovîed
 = 
	`max
(blkscovîed, 
blksö∑π
);

1005 
√wªq
->
Êags
 = 
cuº
->flags;

1006 
√wªq
->
›id
 = 0;

1007 
√wªq
->
¥ev
 = 
NULL
;

1008 i‡(
ãmp
) {

1009 
ãmp
->
¥ev
 = 
√wªq
;

1011 
œ°row
 = 
√wªq
;

1013 
ãmp
 = 
√wªq
;

1014 
	`log‹g_∑rôy_èbÀ_ö£π
(&
ªqs
[
ãmp
->
devno
],Åemp);

1015 
ªqsize
 -
blksö∑π
;

1016 
unôno
++;

1017 i‡(
unôno
 =
∑π•î°rùe
) {

1018 i‡(!(
cuº
->
Êags
 & 
READ
)) {

1019 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1020 
√wªq
->
devno
 = 
èbÀ
[(
íåyno
+1)].devno;

1021 
√wªq
->
blkno
 = 
èbÀ
[(
íåyno
+1)].blknÿ+ 
èbÀ°¨t
;

1022 
√wªq
->
bcou¡
 = 
blkscovîed
;

1023 
√wªq
->
Êags
 = 
cuº
->flags;

1024 
√wªq
->
›id
 = 0;

1025 
ãmp
->
¥ev
 = 
√wªq
;

1026 
√wªq
->
¥ev
 = 
NULL
;

1027 
	`log‹g_∑rôy_èbÀ_ö£π
(&
ªqs
[
√wªq
->
devno
],Çewreq);

1029 
blkscovîed
 = 0;

1030 
unôno
 = 0;

1031 i‡(
fú°row
 == 0) {

1032 
fú°row
 = 
row˙t
;

1034 
row˙t
 = 0;

1035 
ãmp
 = 
NULL
;

1036 
°rùío
++;

1037 i‡(
°rùío
 =
cuºlog‹g
->
èbÀ°rùes
) {

1038 
°rùío
 = 0;

1039 
èbÀ°¨t
 +
cuºlog‹g
->
èbÀsize
;

1042 
íåyno
 = (
°rùío
 * 
∑π•î°rùe
Ë+ såùíÿ+ 
unôno
;

1043 
blkno
 = 
èbÀ°¨t
 + 
èbÀ
[
íåyno
].blkno;

1044 
blksö∑π
 = (
blkno
 !
cuºlog‹g
->
numfuŒ
Ë? 
°rùeunô
 : cuºlog‹g->
a˘uÆblk•î∑π
 - blkno;

1046 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1047 
√wªq
->
blkno
 = blkno;

1048 
√wªq
->
devno
 = 
èbÀ
[
íåyno
].devno;

1049 
√wªq
->
bcou¡
 = 
ªqsize
;

1050 
row˙t
++;

1051 
blkscovîed
 = 
	`max
(blkscovîed, 
blksö∑π
);

1052 
√wªq
->
Êags
 = 
cuº
->flags;

1053 
√wªq
->
›id
 = 0;

1054 
√wªq
->
¥ev
 = 
NULL
;

1055 i‡(
ãmp
) {

1056 
ãmp
->
¥ev
 = 
√wªq
;

1058 
œ°row
 = 
√wªq
;

1060 
ãmp
 = 
√wªq
;

1061 
	`log‹g_∑rôy_èbÀ_ö£π
(&
ªqs
[
√wªq
->
devno
],Çewreq);

1063 i‡(
cuº
->
Êags
 & 
READ
) {

1064 
cuº
->
√xt
 = curr;

1065 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

1066 
ªq˙t
 +
	`log‹g_joö_£qªqs
(
ªqs
[
i
], 
cuº
, 
LOGORG_PARITY_SEQGIVE
);

1069 
¥evíåyno
 = 
íåyno
;

1070 
íåyno
 = (
°rùío
 * 
∑π•î°rùe
) + stripeno +Öartsperstripe;

1071 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1072 
√wªq
->
devno
 = 
èbÀ
[
íåyno
].devno;

1073 
√wªq
->
blkno
 = 
èbÀ
[
íåyno
].blknÿ+ 
ãmp
->blknÿ-ÅabÀ[
¥evíåyno
].blkno;

1074 
√wªq
->
bcou¡
 = (
row˙t
 =1Ë? 
ãmp
->bcou¡ : 
blkscovîed
;

1075 
√wªq
->
Êags
 = 
cuº
->flags;

1076 
√wªq
->
›id
 = 0;

1077 
ãmp
->
¥ev
 = 
√wªq
;

1078 
√wªq
->
¥ev
 = 
NULL
;

1079 
	`log‹g_∑rôy_èbÀ_ö£π
(&
ªqs
[
√wªq
->
devno
],Çewreq);

1080 i‡(
fú°row
 == 0) {

1081 i‡((
row˙t
 =2Ë&& ((
cuº
->
√xt
->
blkno
 - 
ãmp
->blknÿ-Åemp->
bcou¡
) > 0)) {

1082 
√wªq
->
bcou¡
 = 
ãmp
->bcount;

1083 
√wªq
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

1084 
√wªq
->
devno
 = 
ãmp
->
¥ev
->devno;

1085 
œ°row
 = 
ãmp
;

1086 
ãmp
 = 
cuº
->
√xt
;

1087 
√wªq
->
blkno
 = 
èbÀ
[
íåyno
].blknÿ+ 
ãmp
->blknÿ-ÅabÀ[(
¥evíåyno
-1)].blkno;

1088 
√wªq
->
bcou¡
 = 
ãmp
->bcount;

1089 
√wªq
->
Êags
 = 
cuº
->flags;

1090 
√wªq
->
›id
 = 0;

1091 
ãmp
->
¥ev
 = 
√wªq
;

1092 
√wªq
->
¥ev
 = 
NULL
;

1093 
	`log‹g_∑rôy_èbÀ_ö£π
(&
ªqs
[
√wªq
->
devno
],Çewreq);

1094 
fú°row
 = 1;

1095 
row˙t
 = 1;

1097 
fú°row
 = 
row˙t
;

1098 
row˙t
 = 0;

1101 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

1102 
ªduƒeqs
[
i
] = 
NULL
;

1104 i‡(
fú°row
 < 
∑π•î°rùe
) {

1105 i‡(
fú°row
 < 
cuºlog‹g
->
rmwpoöt
) {

1106 
	`log‹g_∑rôy_èbÀ_ªad_ﬁd
(
cuºlog‹g
, 
cuº
->
√xt
, 
ªduƒeqs
, 
›id
);

1108 
	`log‹g_∑rôy_èbÀ_ªc⁄
(
cuºlog‹g
, 
cuº
->
√xt
, 
ªduƒeqs
, cuº->
blkno
, cuº->
devno
, cuº->
bcou¡
, 
›id
);

1110 
›id
 = opid << 1;

1112 i‡((
row˙t
Ë&& (row˙à!
∑π•î°rùe
)) {

1113 i‡(
row˙t
 < 
cuºlog‹g
->
rmwpoöt
) {

1114 
	`log‹g_∑rôy_èbÀ_ªad_ﬁd
(
cuºlog‹g
, 
œ°row
, 
ªduƒeqs
, 
›id
);

1116 
	`log‹g_∑rôy_èbÀ_ªc⁄
(
cuºlog‹g
, 
œ°row
, 
ªduƒeqs
, 
°rùío
, 0, 
èbÀ°¨t
, 
›id
);

1119 
i
=0; i<
cuºlog‹g
->
a˘uÆnumdisks
; i++) {

1120 
cuº
->
√xt
 = 
NULL
;

1121 
ªq˙t
 +
	`log‹g_joö_£qªqs
(
ªduƒeqs
[
i
], 
cuº
, 
LOGORG_PARITY_SEQGIVE
);

1122 
ªduƒeqs
[
i
] = 
cuº
->
√xt
;

1123 
cuº
->
√xt
 = 
NULL
;

1124 
ªq˙t
 +
	`log‹g_joö_£qªqs
(
ªqs
[
i
], 
cuº
, 
LOGORG_PARITY_SEQGIVE
);

1125 
ªqs
[
i
] = 
cuº
->
√xt
;

1127 
cuº
->
√xt
 = curr;

1128 i‡(
cuºlog‹g
->
wrôesync
) {

1129 
	`log‹g_∑rôy_èbÀ_dodïs_sync
(
cuºlog‹g
, 
cuº
, 
ªduƒeqs
, 
ªqs
);

1131 
	`log‹g_∑rôy_èbÀ_dodïs_nosync
(
cuºlog‹g
, 
cuº
, 
ªduƒeqs
, 
ªqs
);

1134 i‡(
cuº
->
√xt
) {

1135 
ãmp
 = 
cuº
->
√xt
;

1136 
cuº
->
blkno
 = 
ãmp
->blkno;

1137 
cuº
->
devno
 = 
ãmp
->devno;

1138 
cuº
->
bcou¡
 = 
ãmp
->bcount;

1139 
cuº
->
Êags
 = 
ãmp
->flags;

1140 
cuº
->
√xt
 = 
ãmp
->next;

1141 
	`addt€xåaq
((
evít
 *Ë
ãmp
);

1143 
	`Ârötf
(
°dîr
, "SeemÅo haveÇoÑequests whenÜeavingÜogorg_parity_table\n");

1144 
	`exô
(1);

1149 (
ªq˙t
);

1150 
	}
}

1153 
	$log‹g_¸óã_èbÀ_À·_sym
 (
log‹g
 *
cuºlog‹g
)

1155 
i
, 
j
;

1156 
numdisks
;

1157 
°rùío
 = 0;

1158 
devno
 = 0;

1159 
blkno
 = 0;

1160 
∑rôyno
;

1162 
numdisks
 = 
cuºlog‹g
->numdisks;

1163 
∑rôyno
 = 
numdisks
 - 1;

1164 
i
=0; i<
cuºlog‹g
->
èbÀ°rùes
; i++) {

1165 
j
=1; j<
numdisks
; j++) {

1166 
cuºlog‹g
->
èbÀ
[
°rùío
].
devno
 = devno;

1167 
cuºlog‹g
->
èbÀ
[
°rùío
].
blkno
 = blkno;

1168 
°rùío
++;

1169 
devno
 = 
	`log‹g_modulus_upd©e
(1, devno, 
numdisks
);

1170 i‡(
devno
 =
∑rôyno
) {

1171 
devno
 = 
	`log‹g_modulus_upd©e
(1, devno, 
numdisks
);

1174 
cuºlog‹g
->
èbÀ
[
°rùío
].
devno
 = 
∑rôyno
;

1175 
cuºlog‹g
->
èbÀ
[
°rùío
].
blkno
 = blkno;

1176 
blkno
 +
cuºlog‹g
->
°rùeunô
;

1177 
°rùío
++;

1178 i‡((
blkno
 % 
cuºlog‹g
->
∑rôyunô
) == 0) {

1179 
devno
 = 
∑rôyno
;

1180 
∑rôyno
 = 
	`log‹g_modulus_upd©e
(-1,Ö¨ôyno, 
numdisks
);

1183 
	}
}

1186 
	$log‹g_¸óã_èbÀ
 (
log‹g
 *
cuºlog‹g
)

1188 
i
;

1189 
numdisks
;

1190 
∑rôyunô
;

1191 
°rùeunô
;

1193 
numdisks
 = 
cuºlog‹g
->numdisks;

1194 
∑rôyunô
 = 
cuºlog‹g
->parityunit;

1195 
°rùeunô
 = 
cuºlog‹g
->stripeunit;

1196 i‡(
cuºlog‹g
->
ªdu¡y≥
 !
PARITY_DISK
) {

1197 i‡((
∑rôyunô
 < 
°rùeunô
) || ((parityunit % stripeunit) != 0)) {

1198 
	`Ârötf
(
°dîr
, "IllegalÖarityunit - stripeunit combinationátÜogorg_create_table\n");

1199 
	`exô
(1);

1202 i‡(
cuºlog‹g
->
ªdu¡y≥
 =
PARITY_DISK
) {

1203 
cuºlog‹g
->
èbÀ°rùes
 = 1;

1205 
cuºlog‹g
->
èbÀ°rùes
 = 
numdisks
 * 
∑rôyunô
 / 
°rùeunô
;

1207 
cuºlog‹g
->
èbÀ
 = 
	`DISKSIM_mÆloc
(cuºlog‹g->
èbÀ°rùes
 * 
numdisks
 * (
èbÀíåy
));

1208 
cuºlog‹g
->
èbÀsize
 = cuºlog‹g->
èbÀ°rùes
 * 
°rùeunô
;

1209 
cuºlog‹g
->
∑π•î°rùe
 = 
numdisks
 - 1;

1210 i‡(
cuºlog‹g
->
ªdu¡y≥
 =
PARITY_DISK
) {

1211 
i
=0; i<
numdisks
; i++) {

1212 
cuºlog‹g
->
èbÀ
[
i
].
devno
 = i;

1213 
cuºlog‹g
->
èbÀ
[
i
].
blkno
 = 0;

1217 
cuºlog‹g
->
rŸty≥
) {

1218 
PARITY_LEFT_SYM
:

1219 
	`log‹g_¸óã_èbÀ_À·_sym
(
cuºlog‹g
);

1221 
PARITY_LEFT_ASYM
:

1222 
PARITY_RIGHT_SYM
:

1223 
PARITY_RIGHT_ASYM
:

1225 
	`Ârötf
(
°dîr
, "UnknownÖarityÑotationÅypeátÜogorg_create_table\n");

1226 
	`exô
(1);

1233 
	}
}

1236 
	$log‹g_check_dïídícõs
 (
log‹g
 *
cuºlog‹g
, 
out°™d
 *
ªq
, 
i‹eq_evít
 *
cuº
)

1238 
i
;

1239 
dïíds
 *
tmpdï
;

1240 
dïíds
 *
dñ
 = 
NULL
;

1241 
numªqs
 = 0;

1242 
devno
 = 0;

1243 
numdïs
;

1244 
i‹eq_evít
 *
ãmp
;

1246 
tmpdï
 = 
ªq
->
dïíd
;

1247 i‡(
tmpdï
 =
NULL
) {

1250 i‡((
tmpdï
->
devno
 =
cuº
->devnoË&& (tmpdï->
blkno
 == curr->blkno)) {

1251 
ªq
->
dïíd
 = 
tmpdï
->
√xt
;

1253 
tmpdï
->
√xt
) {

1254 i‡((
tmpdï
->
√xt
->
devno
 =
cuº
->devnoË&& (tmpdï->√xt->
blkno
 == curr->blkno)) {

1255 
dñ
 = 
tmpdï
->
√xt
;

1256 
tmpdï
->
√xt
 = 
dñ
->next;

1257 
tmpdï
 = 
dñ
;

1260 
tmpdï
 =Åmpdï->
√xt
;

1262 i‡(
dñ
 =
NULL
) {

1266 
cuº
->
√xt
 = curr;

1267 
numdïs
 = 
tmpdï
->numdeps;

1268 
i
 = 0;

1269 
i
 < 
numdïs
) {

1270 
ãmp
 = 
tmpdï
->
dïs
[
devno
];

1271 
ãmp
->
›id
--;

1272 i‡(
ãmp
->
›id
 == 0) {

1273 
numªqs
++;

1274 
ãmp
->
√xt
 = 
cuº
->next;

1275 
cuº
->
√xt
 = 
ãmp
;

1276 
ãmp
->
›id
 = 
ªq
->opid;

1277 
ãmp
->
time
 = 0.0;

1278 i‡(
ªq
->
Êags
 & 
TIME_CRITICAL
) {

1279 
ãmp
->
Êags
 |
TIME_CRITICAL
;

1282 i‡((
i
++Ë>
numdïs
) {

1285 
devno
 = 
	`log‹g_modulus_upd©e
(1, devno, 10);

1286 i‡(
devno
 == 0) {

1287 
dñ
 = 
tmpdï
;

1288 
tmpdï
 =Åmpdï->
c⁄t
;

1289 
	`addt€xåaq
((
evít
 *Ë
dñ
);

1292 
	`addt€xåaq
((
evít
 *Ë
tmpdï
);

1293 (
numªqs
);

1294 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_reqflags.h

32 #i‚de‡
_DISKSIM_REQFLAGS_H


33 
	#_DISKSIM_REQFLAGS_H


	)

36 
	#DISKSIM_WRITE
 0x00000000

	)

37 
	#DISKSIM_READ
 0x00000001

	)

38 
	#DISKSIM_TIME_CRITICAL
 0x00000002

	)

39 
	#DISKSIM_TIME_LIMITED
 0x00000004

	)

40 
	#DISKSIM_TIMED_OUT
 0x00000008

	)

41 
	#DISKSIM_HALF_OUT
 0x00000010

	)

42 
	#DISKSIM_MAPPED
 0x00000020

	)

43 
	#DISKSIM_READ_AFTR_WRITE
 0x00000040

	)

44 
	#DISKSIM_SYNC
 0x00000080

	)

45 
	#DISKSIM_ASYNC
 0x00000100

	)

46 
	#DISKSIM_IO_FLAG_PAGEIO
 0x00000200

	)

47 
	#DISKSIM_SEQ
 0x40000000

	)

48 
	#DISKSIM_LOCAL
 0x20000000

	)

49 
	#DISKSIM_BATCH_COMPLETE
 0x80000000

	)

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_simpledisk.c

102 
	~"disksim_sim∂edisk.h
"

105 
	~"moduÀs/disksim_sim∂edisk_∑øm.h
"

109 *
	g°©desc_ac˘ime°©s
 = "AccessÅime";

114 
	#numsim∂edisks
 (
disksim
->
sim∂edisköfo
->
numsim∂edisks
)

	)

119 
sim∂edisk
 *
	$gësim∂edisk
 (
devno
)

121 
	`ASSERT1
((
devno
 >0Ë&& (devnÿ< 
MAXDEVICES
), "devno", devno);

122  (
disksim
->
sim∂edisköfo
->
sim∂edisks
[
devno
]);

123 
	}
}

126 
	$sim∂edisk_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
)

128 
sim∂edisk_t
 *
cuºdisk
;

129 
˙t
;

131 
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

132 
	`as£π
(
cuºdisk
);

133 
˙t
 = 
cuºdisk
->
numöbu£s
;

134 
cuºdisk
->
numöbu£s
++;

135 i‡((
˙t
 + 1Ë> 
MAXINBUSES
) {

136 
	`Ârötf
(
°dîr
, "Toÿm™y inbu£†•ecifõd f‹ sim∂edisk %d - %d\n", 
devno
, (
˙t
+1));

137 
	`exô
(1);

139 
cuºdisk
->
öbu£s
[
˙t
] = 
öbu¢o
;

140 
cuºdisk
->
dïth
[
˙t
] = depth;

141 
cuºdisk
->
¶Ÿno
[
˙t
] = slotno;

143 
	}
}

146 
	$sim∂edisk_gë_dïth
 (
devno
)

148 
sim∂edisk_t
 *
cuºdisk
;

149 
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

150 (
cuºdisk
->
dïth
[0]);

151 
	}
}

154 
	$sim∂edisk_gë_¶Ÿno
 (
devno
)

156 
sim∂edisk_t
 *
cuºdisk
;

157 
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

158 (
cuºdisk
->
¶Ÿno
[0]);

159 
	}
}

162 
	$sim∂edisk_gë_öbus
 (
devno
)

164 
sim∂edisk_t
 *
cuºdisk
;

165 
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

166 (
cuºdisk
->
öbu£s
[0]);

167 
	}
}

170 
	$sim∂edisk_gë_maxout°™dög
 (
devno
)

172 
sim∂edisk_t
 *
cuºdisk
;

173 
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

174 (
cuºdisk
->
maxqÀn
);

175 
	}
}

178 
	$sim∂edisk_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
)

180 
sim∂edisk_t
 *
cuºdisk
;

181 
tm±ime
;

183 
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

184 
tm±ime
 = 
	`bus_gë_å™s„r_time
(
	`sim∂edisk_gë_bu¢o
(
cuº
), 1, (cuº->
Êags
 & 
READ
));

185 i‡(
tm±ime
 < 
cuºdisk
->
blkå™°ime
) {

186 
tm±ime
 = 
cuºdisk
->
blkå™°ime
;

188 (
tm±ime
);

189 
	}
}

192 
	$sim∂edisk_gë_bu¢o
 (
i‹eq_evít
 *
cuº
)

194 
sim∂edisk_t
 *
cuºdisk
;

195 
ötch¨
 
bu¢o
;

196 
dïth
;

198 
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

199 
bu¢o
.
vÆue
 = 
cuº
->busno;

200 
dïth
 = 
cuºdisk
->depth[0];

201 (
bu¢o
.
byã
[
dïth
]);

202 
	}
}

216 
	$sim∂edisk_£nd_evít_up_∑th
 (
i‹eq_evít
 *
cuº
, 
dñay
)

218 
sim∂edisk_t
 *
cuºdisk
;

219 
bu¢o
;

220 
¶Ÿno
;

224 
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

226 
bu¢o
 = 
	`sim∂edisk_gë_bu¢o
(
cuº
);

227 
¶Ÿno
 = 
cuºdisk
->slotno[0];

230 
cuº
->
√xt
 = 
cuºdisk
->
buswaô
;

231 
cuºdisk
->
buswaô
 = 
cuº
;

233 
cuº
->
ãmpöt1
 = 
bu¢o
;

234 
cuº
->
time
 = 
dñay
;

235 i‡(
cuºdisk
->
busow√d
 == -1) {

239 i‡(
cuº
->
√xt
) {

243 i‡(
	`bus_ow√rshù_gë
(
bu¢o
, 
¶Ÿno
, 
cuº
Ë=
FALSE
) {

245 
cuºdisk
->
°©
.
ªque°edbus
 = 
simtime
;

247 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
cuº
->
devno
, 
dñay
, curr);

249 } i‡(
cuºdisk
->
busow√d
 =
bu¢o
) {

253 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
cuº
->
devno
, 
dñay
, curr);

255 
	`Ârötf
(
°dîr
, "Wrong bus owned forÅransfer desired\n");

256 
	`exô
(1);

258 
	}
}

269 
	$sim∂edisk_bus_ow√rshù_gø¡
 (
devno
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
)

271 
sim∂edisk_t
 *
cuºdisk
;

272 
i‹eq_evít
 *
tmp
;

274 
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

276 
tmp
 = 
cuºdisk
->
buswaô
;

277 (
tmp
 !
NULL
Ë&& (tm∞!
cuº
)) {

278 
tmp
 =Åmp->
√xt
;

280 i‡(
tmp
 =
NULL
) {

281 
	`Ârötf
(
°dîr
, "Bu†ow√rshù gø¡edÅÿunknow¿sim∂ediskÑeque° - devnÿ%d, bu¢ÿ%d\n", 
devno
, 
bu¢o
);

282 
	`exô
(1);

284 
cuºdisk
->
busow√d
 = 
bu¢o
;

285 
cuºdisk
->
°©
.
waôögf‹bus
 +
¨bdñay
;

287 
cuºdisk
->
°©
.
numbuswaôs
++;

288 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
devno
, 
tmp
->
time
,Åmp);

289 
	}
}

292 
	$sim∂edisk_bus_dñay_com∂ëe
 (
devno
, 
i‹eq_evít
 *
cuº
, 
£¡bu¢o
)

294 
sim∂edisk_t
 *
cuºdisk
;

295 
ötch¨
 
¶Ÿno
;

296 
ötch¨
 
bu¢o
;

297 
dïth
;

299 
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

303 i‡(
cuº
 =
cuºdisk
->
buswaô
) {

304 
cuºdisk
->
buswaô
 = 
cuº
->
√xt
;

306 
i‹eq_evít
 *
tmp
 = 
cuºdisk
->
buswaô
;

307 (
tmp
->
√xt
 !
NULL
Ë&& (tmp->√xà!
cuº
)) {

308 
tmp
 =Åmp->
√xt
;

310 i‡(
tmp
->
√xt
 !
cuº
) {

311 
	`Ârötf
(
°dîr
, "Bu†dñay com∂ëêf‹ unknow¿sim∂ediskÑeque° - devnÿ%d, bu¢ÿ%d\n", 
devno
, 
bu¢o
.
vÆue
);

312 
	`exô
(1);

314 
tmp
->
√xt
 = 
cuº
->next;

316 
bu¢o
.
vÆue
 = 
cuº
->busno;

317 
¶Ÿno
.
vÆue
 = 
cuº
->slotno;

318 
dïth
 = 
cuºdisk
->depth[0];

319 
¶Ÿno
.
byã
[
dïth
] = slotno.byte[depth] >> 4;

320 
cuº
->
time
 = 0.0;

321 i‡(
dïth
 == 0) {

322 
	`öå_ªque°
 ((
evít
 *)
cuº
);

324 
	`bus_dñivî_evít
(
bu¢o
.
byã
[
dïth
], 
¶Ÿno
.byã[dïth], 
cuº
);

326 
	}
}

331 
	$sim∂edisk_ªque°_com∂ëe
(
i‹eq_evít
 *
cuº
)

333 
sim∂edisk_t
 *
cuºdisk
;

337 
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

339 i‡((
cuº
 = 
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
cuºdisk
->
queue
,cuº)Ë=
NULL
) {

340 
	`Ârötf
(
°dîr
, "simpledisk_request_complete: ioreq_eventÇot found by ioqueue_physical_access_done call\n");

341 
	`exô
(1);

345 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

346 
cuº
->
ˇu£
 = 
COMPLETION
;

347 
	`sim∂edisk_£nd_evít_up_∑th
(
cuº
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

348 
	}
}

351 
	$sim∂edisk_bu°øns„r_com∂ëe
 (
i‹eq_evít
 *
cuº
)

353 
sim∂edisk_t
 *
cuºdisk
;

357 
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

359 i‡(
cuº
->
Êags
 & 
READ
) {

360 
	`sim∂edisk_ªque°_com∂ëe
 (
cuº
);

363 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

365 i‡(
cuºdisk
->
√vîdisc⁄√˘
 =
FALSE
) {

367 
i‹eq_evít
 *
tmp
 = 
	`i‹eq_c›y
 (
cuº
);

368 
tmp
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

369 
tmp
->
ˇu£
 = 
DISCONNECT
;

370 
	`sim∂edisk_£nd_evít_up_∑th
 (
tmp
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

374 
cuºdisk
->
medü_busy
 = 
TRUE
;

375 
	`°©_upd©e
 (&
cuºdisk
->
°©
.
ac˘ime°©s
, cuºdisk->
ac˘ime
);

376 
cuº
->
time
 = 
simtime
 + 
cuºdisk
->
ac˘ime
;

377 
cuº
->
ty≥
 = 
DEVICE_ACCESS_COMPLETE
;

378 
	`addtoötq
 ((
evít
 *Ë
cuº
);

380 
	}
}

383 
	$sim∂edisk_ªc⁄√˘_d⁄e
 (
i‹eq_evít
 *
cuº
)

385 
sim∂edisk_t
 *
cuºdisk
;

389 
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

391 i‡(
cuº
->
Êags
 & 
READ
) {

392 i‡(
cuºdisk
->
√vîdisc⁄√˘
) {

395 
	`addt€xåaq
((
evít
 *Ë
cuº
);

400 
cuº
->
ty≥
 = 
DEVICE_DATA_TRANSFER_COMPLETE
;

401 
	`sim∂edisk_£nd_evít_up_∑th
(
cuº
, () 0.0);

405 i‡(
cuºdisk
->
ªc⁄√˘_ªas⁄
 =
DEVICE_ACCESS_COMPLETE
) {

406 
	`sim∂edisk_ªque°_com∂ëe
 (
cuº
);

411 
cuº
->
ty≥
 = 
DEVICE_DATA_TRANSFER_COMPLETE
;

412 
	`sim∂edisk_£nd_evít_up_∑th
(
cuº
, () 0.0);

415 
	}
}

418 
	$sim∂edisk_ªque°_¨rive
 (
i‹eq_evít
 *
cuº
)

420 
i‹eq_evít
 *
öåp
;

421 
sim∂edisk_t
 *
cuºdisk
;

426 
cuºdisk
 = 
	`gësim∂edisk
(
cuº
->
devno
);

429 i‡((
cuº
->
blkno
 < 0Ë|| (cuº->
bcou¡
 <= 0) ||

430 ((
cuº
->
blkno
 + cuº->
bcou¡
Ë> 
cuºdisk
->
numblocks
)) {

431 
	`Ârötf
(
°dîr
, "InvÆid së o‡block†ªque°ed from sim∂edisk - blknÿ%d, bcou¡ %d,Çumblock†%d\n", 
cuº
->
blkno
, cuº->
bcou¡
, 
cuºdisk
->
numblocks
);

432 
	`exô
(1);

436 
cuºdisk
->
busow√d
 = 
	`sim∂edisk_gë_bu¢o
(
cuº
);

438 i‡(
	`ioqueue_gë_ªqout°™dög
 (
cuºdisk
->
queue
) == 0) {

439 
	`ioqueue_add_√w_ªque°
(
cuºdisk
->
queue
, 
cuº
);

440 
cuº
 = 
	`ioqueue_gë_√xt_ªque°
 (
cuºdisk
->
queue
);

441 
öåp
 = 
cuº
;

444 i‡(
cuº
->
Êags
 & 
READ
) {

445 
i‹eq_evít
 *
tmp
 = 
	`i‹eq_c›y
 (
cuº
);

446 
cuºdisk
->
medü_busy
 = 
TRUE
;

447 
	`°©_upd©e
 (&
cuºdisk
->
°©
.
ac˘ime°©s
, cuºdisk->
ac˘ime
);

448 
tmp
->
time
 = 
simtime
 + 
cuºdisk
->
ac˘ime
;

449 
tmp
->
ty≥
 = 
DEVICE_ACCESS_COMPLETE
;

450 
	`addtoötq
 ((
evít
 *)
tmp
);

454 
cuºdisk
->
ªc⁄√˘_ªas⁄
 = 
IO_INTERRUPT_ARRIVE
;

455 i‡(
cuº
->
Êags
 & 
READ
) {

456 
öåp
->
ˇu£
 = (
cuºdisk
->
√vîdisc⁄√˘
Ë? 
READY_TO_TRANSFER
 : 
DISCONNECT
;

458 
öåp
->
ˇu£
 = 
READY_TO_TRANSFER
;

462 
öåp
 = 
	`i‹eq_c›y
(
cuº
);

463 
	`ioqueue_add_√w_ªque°
(
cuºdisk
->
queue
, 
cuº
);

464 
öåp
->
ˇu£
 = 
DISCONNECT
;

467 
öåp
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

468 
	`sim∂edisk_£nd_evít_up_∑th
(
öåp
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

469 
	}
}

472 
	$sim∂edisk_ac˚ss_com∂ëe
 (
i‹eq_evít
 *
cuº
)

474 
sim∂edisk_t
 *
cuºdisk
;

478 
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

479 
cuºdisk
->
medü_busy
 = 
FALSE
;

481 i‡(
cuºdisk
->
√vîdisc⁄√˘
) {

483 i‡(
cuº
->
Êags
 & 
READ
) {

486 
cuº
->
ty≥
 = 
DEVICE_DATA_TRANSFER_COMPLETE
;

487 
	`sim∂edisk_£nd_evít_up_∑th
(
cuº
, () 0.0);

490 
	`sim∂edisk_ªque°_com∂ëe
 (
cuº
);

495 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

496 
cuº
->
ˇu£
 = 
RECONNECT
;

497 
	`sim∂edisk_£nd_evít_up_∑th
 (
cuº
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

498 
cuºdisk
->
ªc⁄√˘_ªas⁄
 = 
DEVICE_ACCESS_COMPLETE
;

500 
	}
}

505 
	$sim∂edisk_disc⁄√˘_d⁄e
 (
i‹eq_evít
 *
cuº
)

507 
sim∂edisk_t
 *
cuºdisk
;

509 
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

513 
	`addt€xåaq
((
evít
 *Ë
cuº
);

515 i‡(
cuºdisk
->
busow√d
 != -1) {

516 
	`bus_ow√rshù_ªÀa£
(
cuºdisk
->
busow√d
);

517 
cuºdisk
->
busow√d
 = -1;

519 
	}
}

524 
	$sim∂edisk_com∂ëi⁄_d⁄e
 (
i‹eq_evít
 *
cuº
)

526 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

530 
	`addt€xåaq
((
evít
 *Ë
cuº
);

532 i‡(
cuºdisk
->
busow√d
 != -1) {

533 
	`bus_ow√rshù_ªÀa£
(
cuºdisk
->
busow√d
);

534 
cuºdisk
->
busow√d
 = -1;

538 
cuº
 = 
	`ioqueue_gë_√xt_ªque°
(
cuºdisk
->
queue
);

539 i‡(
cuº
 !
NULL
) {

540 
	`ASSERT
 (
cuºdisk
->
medü_busy
 =
FALSE
);

541 i‡(
cuº
->
Êags
 & 
READ
) {

542 
cuºdisk
->
medü_busy
 = 
TRUE
;

543 
	`°©_upd©e
 (&
cuºdisk
->
°©
.
ac˘ime°©s
, cuºdisk->
ac˘ime
);

544 
cuº
->
time
 = 
simtime
 + 
cuºdisk
->
ac˘ime
;

545 
cuº
->
ty≥
 = 
DEVICE_ACCESS_COMPLETE
;

546 
	`addtoötq
 ((
evít
 *)
cuº
);

549 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

550 
cuº
->
ˇu£
 = 
RECONNECT
;

551 
	`sim∂edisk_£nd_evít_up_∑th
 (
cuº
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

552 
cuºdisk
->
ªc⁄√˘_ªas⁄
 = 
IO_INTERRUPT_ARRIVE
;

555 
	}
}

558 
	$sim∂edisk_öãºu±_com∂ëe
 (
i‹eq_evít
 *
cuº
)

562 
cuº
->
ˇu£
) {

564 
RECONNECT
:

565 
	`sim∂edisk_ªc⁄√˘_d⁄e
(
cuº
);

568 
DISCONNECT
:

569 
	`sim∂edisk_disc⁄√˘_d⁄e
(
cuº
);

572 
COMPLETION
:

573 
	`sim∂edisk_com∂ëi⁄_d⁄e
(
cuº
);

577 
	`ddbg_as£π2
(0, "badÉventÅype");

579 
	}
}

582 
	$sim∂edisk_evít_¨rive
 (
i‹eq_evít
 *
cuº
)

584 
sim∂edisk_t
 *
cuºdisk
;

589 
cuºdisk
 = 
	`gësim∂edisk
 (
cuº
->
devno
);

591 
cuº
->
ty≥
) {

593 
IO_ACCESS_ARRIVE
:

594 
cuº
->
time
 = 
simtime
 + 
cuºdisk
->
ovîhód
;

595 
cuº
->
ty≥
 = 
DEVICE_OVERHEAD_COMPLETE
;

596 
	`addtoötq
((
evít
 *Ë
cuº
);

599 
DEVICE_OVERHEAD_COMPLETE
:

600 
	`sim∂edisk_ªque°_¨rive
(
cuº
);

603 
DEVICE_ACCESS_COMPLETE
:

604 
	`sim∂edisk_ac˚ss_com∂ëe
 (
cuº
);

607 
DEVICE_DATA_TRANSFER_COMPLETE
:

608 
	`sim∂edisk_bu°øns„r_com∂ëe
(
cuº
);

611 
IO_INTERRUPT_COMPLETE
:

612 
	`sim∂edisk_öãºu±_com∂ëe
(
cuº
);

615 
IO_QLEN_MAXCHECK
:

617 
cuº
->
ãmpöt1
 = -1;

618 
cuº
->
ãmpöt2
 = 
	`sim∂edisk_gë_maxout°™dög
(cuº->
devno
);

619 
cuº
->
bcou¡
 = 0;

623 
	`Ârötf
(
°dîr
, "UnrecognizedÉventÅypeát simpledisk_event_arrive\n");

624 
	`exô
(1);

628 
	}
}

631 
	$sim∂edisk_gë_numbî_of_blocks
 (
devno
)

633 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

634  (
cuºdisk
->
numblocks
);

635 
	}
}

638 
	$sim∂edisk_gë_numcyls
 (
devno
)

640 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

641  (
cuºdisk
->
numblocks
);

642 
	}
}

645 
	$sim∂edisk_gë_m≠pög
 (
m≠ty≥
, 
devno
, 
blkno
, *
cyÕå
, *
surÁ˚±r
, *
blk±r
)

647 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

649 i‡((
blkno
 < 0Ë|| (blknÿ>
cuºdisk
->
numblocks
)) {

650 
	`Ârötf
(
°dîr
, "InvÆid blknÿ© sim∂edisk_gë_m≠pög: %d\n", 
blkno
);

651 
	`exô
(1);

654 i‡(
cyÕå
) {

655 *
cyÕå
 = 
blkno
;

657 i‡(
surÁ˚±r
) {

658 *
surÁ˚±r
 = 0;

660 i‡(
blk±r
) {

661 *
blk±r
 = 0;

663 
	}
}

666 
	$sim∂edisk_gë_avg_£˘≥rcyl
 (
devno
)

669 
	}
}

672 
	$sim∂edisk_gë_di°™˚
 (
devno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
)

676 
	}
}

679 
	$sim∂edisk_gë_£rvtime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
)

681 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

682  (
cuºdisk
->
ac˘ime
);

683 
	}
}

686 
	$sim∂edisk_gë_ac˘ime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
maxtime
)

688 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

689  (
cuºdisk
->
ac˘ime
);

690 
	}
}

693 
	$sim∂edisk_gë_numdisks
 ()

695 (
numsim∂edisks
);

696 
	}
}

699 
	$sim∂edisk_˛ón°©s
 ()

701 
i
;

703 
i
=0; i<
MAXDEVICES
; i++) {

704 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
i
);

705 i‡(
cuºdisk
) {

706 
	`ioqueue_˛ón°©s
(
cuºdisk
->
queue
);

709 
	}
}

714 
	$sim∂edisk_°©öô
 (
devno
, 
fú°time
)

716 
sim∂edisk_t
 *
cuºdisk
;

718 
cuºdisk
 = 
	`gësim∂edisk
 (
devno
);

719 i‡(
fú°time
) {

720 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ac˘ime°©s
, &
cuºdisk
->
°©
.
ac˘ime°©s
);

722 
	`°©_ª£t
(&
cuºdisk
->
°©
.
ac˘ime°©s
);

725 
cuºdisk
->
°©
.
ªque°edbus
 = 0.0;

726 
cuºdisk
->
°©
.
waôögf‹bus
 = 0.0;

727 
cuºdisk
->
°©
.
numbuswaôs
 = 0;

728 
	}
}

731 
	$sim∂edisk_po°∑ss
 ()

733 
	}
}

736 
	$sim∂edisk_£tˇŒbacks
 ()

738 
	`ioqueue_£tˇŒbacks
();

739 
	}
}

742 
	$sim∂edisk_öôülize_disköfo
 ()

744 
disksim
->
sim∂edisköfo
 = 
	`mÆloc
 ((
sim∂edisköfo_t
));

745 
	`bzîo
 ((*)
disksim
->
sim∂edisköfo
, (
sim∂edisköfo_t
));

746 
disksim
->
sim∂edisköfo
->
sim∂edisks
 = 
	`mÆloc
(
MAXDEVICES
 * ((
sim∂edisk_t
)));

747 
disksim
->
sim∂edisköfo
->
sim∂edisks_Àn
 = 
MAXDEVICES
;

748 
	`bzîo
 ((*)
disksim
->
sim∂edisköfo
->
sim∂edisks
, (
MAXDEVICES
 * ((
sim∂edisk_t
))));

749 
	}
}

752 
	$sim∂edisk_öôülize
 ()

754 
i
;

756 i‡(
disksim
->
sim∂edisköfo
 =
NULL
) {

757 
	`sim∂edisk_öôülize_disköfo
 ();

762 
	`sim∂edisk_£tˇŒbacks
();

763 
	`sim∂edisk_po°∑ss
();

765 
i
=0; i<
MAXDEVICES
; i++) {

766 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
i
);

767 if(!
cuºdisk
) ;

769 
cuºdisk
->
medü_busy
 = 
FALSE
;

770 
cuºdisk
->
ªc⁄√˘_ªas⁄
 = -1;

771 
	`addli°t€xåaq
 ((
evít
 **Ë&
cuºdisk
->
buswaô
);

772 
cuºdisk
->
busow√d
 = -1;

773 
	`ioqueue_öôülize
 (
cuºdisk
->
queue
, 
i
);

774 
	`sim∂edisk_°©öô
(
i
, 
TRUE
);

777 
	}
}

780 
	$sim∂edisk_ª£t°©s
 ()

782 
i
;

784 
i
=0; i<
MAXDEVICES
; i++) {

785 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
i
);

786 i‡(
cuºdisk
) {

787 
	`ioqueue_ª£t°©s
(
cuºdisk
->
queue
);

788 
	`sim∂edisk_°©öô
(
i
, 0);

791 
	}
}

795 
	$sim∂edisk_add
(
sim∂edisk
 *
d
) {

796 
c
;

798 if(!
disksim
->
sim∂edisköfo
Ë
	`sim∂edisk_öôülize_disköfo
();

800 
c
 = 0; c < 
disksim
->
sim∂edisköfo
->
sim∂edisks_Àn
; c++) {

801 if(!
disksim
->
sim∂edisköfo
->
sim∂edisks
[
c
]) {

802 
disksim
->
sim∂edisköfo
->
sim∂edisks
[
c
] = 
d
;

803 
numsim∂edisks
++;

804  
c
;

809 
disksim
->
sim∂edisköfo
->
sim∂edisks
 =

810 
	`ªÆloc
(
disksim
->
sim∂edisköfo
->
sim∂edisks
,

811 2 * 
c
 * (
sim∂edisk
 *));

813 
	`bzîo
(
disksim
->
sim∂edisköfo
->
sim∂edisks
 + 
numsim∂edisks
,

814 
numsim∂edisks
);

816 
disksim
->
sim∂edisköfo
->
sim∂edisks
[
c
] = 
d
;

817 
numsim∂edisks
++;

818 
disksim
->
sim∂edisköfo
->
sim∂edisks_Àn
 *= 2;

819  
c
;

820 
	}
}

823 
sim∂edisk
 *
	$disksim_sim∂edisk_lﬂd∑øms
(
Õ_block
 *
b
)

826 
sim∂edisk
 *
ªsu…
;

827 
num
;

829 if(!
disksim
->
sim∂edisköfo
Ë
	`sim∂edisk_öôülize_disköfo
();

831 
ªsu…
 = 
	`mÆloc
((
sim∂edisk
));

832 if(!
ªsu…
)  0;

833 
	`bzîo
(
ªsu…
, (
sim∂edisk
));

835 
num
 = 
	`sim∂edisk_add
(
ªsu…
);

837 
ªsu…
->
hdr
 = 
sim∂edisk_hdr_öôülizî
;

838 if(
b
->
«me
)

839 
ªsu…
->
hdr
.
devi˚_«me
 = 
	`°rdup
(
b
->
«me
);

842 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
disksim_sim∂edisk_mod
);

846 
	`devi˚_add
((
devi˚_hódî
 *)
ªsu…
, 
num
);

847  
ªsu…
;

848 
	}
}

851 
sim∂edisk
 *
	$sim∂edisk_c›y
(
sim∂edisk
 *
‹ig
) {

852 
sim∂edisk
 *
ªsu…
 = 
	`mÆloc
((simpledisk));

853 
	`bzîo
(
ªsu…
, (
sim∂edisk
));

854 
	`mem˝y
(
ªsu…
, 
‹ig
, (
sim∂edisk
));

855 
ªsu…
->
queue
 = 
	`ioqueue_c›y
(
‹ig
->queue);

857  
ªsu…
;

858 
	}
}

860 
	$sim∂edisk_£t_sync£t
 (
£t°¨t
, 
£ãnd
)

862 
	}
}

865 
	$sim∂edisk_ac˘ime_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

867 
i
;

868 
°©gí
 * 
°©£t
[
MAXDEVICES
];

870 i‡(
devi˚_¥öèc˘ime°©s
) {

871 
i
=0; i<
£tsize
; i++) {

872 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
£t
[
i
]);

873 
°©£t
[
i
] = &
cuºdisk
->
°©
.
ac˘ime°©s
;

875 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

877 
	}
}

880 
	$sim∂edisk_Ÿhî_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

882 
i
;

883 
numbuswaôs
 = 0;

884 
waôögf‹bus
 = 0.0;

886 
i
=0; i<
£tsize
; i++) {

887 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
£t
[
i
]);

888 
numbuswaôs
 +
cuºdisk
->
°©
.numbuswaits;

889 
waôögf‹bus
 +
cuºdisk
->
°©
.waitingforbus;

892 
	`Ârötf
(
ouçutfûe
, "%sTŸÆ bu†waôÅime: %f\n", 
¥efix
, 
waôögf‹bus
);

893 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡bu†waôs: %d\n", 
¥efix
, 
numbuswaôs
);

894 
	}
}

897 
	$sim∂edisk_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
)

899 
i
;

900 
ioq
 * 
queue£t
[
MAXDEVICES
];

901 
ªq˙t
 = 0;

902 
¥efix
[80];

904 
	`•rötf
(
¥efix
, "%ssim∂edisk ", 
sour˚°r
);

905 
i
=0; i<
£tsize
; i++) {

906 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
£t
[
i
]);

907 
queue£t
[
i
] = 
cuºdisk
->
queue
;

908 
ªq˙t
 +
	`ioqueue_gë_numbî_of_ªque°s
(
cuºdisk
->
queue
);

910 i‡(
ªq˙t
 == 0) {

911 
	`Ârötf
 (
ouçutfûe
, "\nNo simplediskÑequests for members ofÅhis set\n\n");

914 
	`ioqueue_¥öt°©s
(
queue£t
, 
£tsize
, 
¥efix
);

916 
	`sim∂edisk_ac˘ime_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

917 
	`sim∂edisk_Ÿhî_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

918 
	}
}

921 
	$sim∂edisk_¥öt°©s
 ()

923 
ioq
 * 
queue£t
[
MAXDEVICES
];

924 
£t
[
MAXDEVICES
];

925 
i
;

926 
ªq˙t
 = 0;

927 
¥efix
[80];

928 
disk˙t
;

930 
	`Ârötf
(
ouçutfûe
, "\nSIMPLEDISK STATISTICS\n");

931 
	`Ârötf
(
ouçutfûe
, "---------------------\n\n");

933 
	`•rötf
(
¥efix
, "Simpledisk ");

935 
disk˙t
 = 0;

936 
i
=0; i<
MAXDEVICES
; i++) {

937 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
i
);

938 i‡(
cuºdisk
) {

939 
queue£t
[
disk˙t
] = 
cuºdisk
->
queue
;

940 
ªq˙t
 +
	`ioqueue_gë_numbî_of_ªque°s
(
cuºdisk
->
queue
);

941 
disk˙t
++;

944 
	`as£π
 (
disk˙t
 =
numsim∂edisks
);

946 i‡(
ªq˙t
 == 0) {

947 
	`Ârötf
(
ouçutfûe
, "No simplediskÑequestsÉncountered\n");

951 
	`ioqueue_¥öt°©s
(
queue£t
, 
numsim∂edisks
, 
¥efix
);

953 
disk˙t
 = 0;

954 
i
=0; i<
MAXDEVICES
; i++) {

955 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
i
);

956 i‡(
cuºdisk
) {

957 
£t
[
disk˙t
] = 
i
;

958 
disk˙t
++;

961 
	`as£π
 (
disk˙t
 =
numsim∂edisks
);

963 
	`sim∂edisk_ac˘ime_¥öt°©s
(
£t
, 
numsim∂edisks
, 
¥efix
);

964 
	`sim∂edisk_Ÿhî_¥öt°©s
(
£t
, 
numsim∂edisks
, 
¥efix
);

965 
	`Ârötf
 (
ouçutfûe
, "\n\n");

967 i‡(
numsim∂edisks
 <= 1) {

971 
i
=0; i<
numsim∂edisks
; i++) {

972 
sim∂edisk_t
 *
cuºdisk
 = 
	`gësim∂edisk
 (
£t
[
i
]);

973 i‡(
cuºdisk
->
¥öt°©s
 =
FALSE
) {

976 i‡(
	`ioqueue_gë_numbî_of_ªque°s
(
cuºdisk
->
queue
) == 0) {

977 
	`Ârötf
(
ouçutfûe
, "Nÿªque°†f‹ sim∂edisk #%d\n\n\n", 
£t
[
i
]);

980 
	`Ârötf
(
ouçutfûe
, "Sim∂edisk #%d:\n\n", 
£t
[
i
]);

981 
	`•rötf
(
¥efix
, "Sim∂edisk #%d ", 
£t
[
i
]);

982 
	`ioqueue_¥öt°©s
(&
cuºdisk
->
queue
, 1, 
¥efix
);

983 
	`sim∂edisk_ac˘ime_¥öt°©s
(&
£t
[
i
], 1, 
¥efix
);

984 
	`sim∂edisk_Ÿhî_¥öt°©s
(&
£t
[
i
], 1, 
¥efix
);

985 
	`Ârötf
 (
ouçutfûe
, "\n\n");

987 
	}
}

990 
	$sim∂edisk_gë_£ektime
 (
devno
,

991 
i‹eq_evít
 *
ªq
,

992 
checkˇche
,

993 
maxtime
)

995 
	`Ârötf
(
°dîr
, "devi˚_gë_£ektimênŸ suµ‹ãd f‹ sim∂edisk devnÿ%d\n", 
devno
);

996 
	`as£π
(0);

997 
	}
}

1000 
devi˚_hódî
 
	gsim∂edisk_hdr_öôülizî
 = {

1001 
DEVICETYPE_SIMPLEDISK
,

1002 (
sim∂edisk
),

1004 (*)
sim∂edisk_c›y
,

1005 
sim∂edisk_£t_dïth
,

1006 
sim∂edisk_gë_dïth
,

1007 
sim∂edisk_gë_öbus
,

1008 
sim∂edisk_gë_bu¢o
,

1009 
sim∂edisk_gë_¶Ÿno
,

1010 
sim∂edisk_gë_numbî_of_blocks
,

1011 
sim∂edisk_gë_maxout°™dög
,

1012 
sim∂edisk_gë_numcyls
,

1013 
sim∂edisk_gë_blkå™°ime
,

1014 
sim∂edisk_gë_avg_£˘≥rcyl
,

1015 
sim∂edisk_gë_m≠pög
,

1016 
sim∂edisk_evít_¨rive
,

1017 
sim∂edisk_gë_di°™˚
,

1018 
sim∂edisk_gë_£rvtime
,

1019 
sim∂edisk_gë_£ektime
,

1020 
sim∂edisk_gë_ac˘ime
,

1021 
sim∂edisk_bus_dñay_com∂ëe
,

1022 
sim∂edisk_bus_ow√rshù_gø¡


	@/Users/ysoh/disksim-4.0-fcl/src/disksim_simpledisk.h

58 
	~"disksim_globÆ.h
"

59 
	~"disksim_iosim.h
"

60 
	~"disksim_°©.h
"

61 
	~"disksim_ioqueue.h
"

62 
	~"disksim_bus.h
"

63 
	~"c⁄fig.h
"

65 #i‚de‡
DISKSIM_SIMPLEDISK_H


66 
	#DISKSIM_SIMPLEDISK_H


	)

70 
sim∂edisk_ªad_t›röts
 (
FILE
 *
∑rfûe
);

71 
sim∂edisk_ªad_•ecs
 (
FILE
 *
∑rfûe
, 
devno
, 
c›õs
);

72 
sim∂edisk_£t_sync£t
 (
£t°¨t
, 
£ãnd
);

73 
sim∂edisk_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

74 
sim∂edisk_£tˇŒbacks
 ();

75 
sim∂edisk_öôülize
 ();

76 
sim∂edisk_ª£t°©s
 ();

77 
sim∂edisk_¥öt°©s
 ();

78 
sim∂edisk_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
);

79 
sim∂edisk_˛ón°©s
 ();

80 
sim∂edisk_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
);

81 
sim∂edisk_gë_dïth
 (
devno
);

82 
sim∂edisk_gë_öbus
 (
devno
);

83 
sim∂edisk_gë_bu¢o
 (
i‹eq_evít
 *
cuº
);

84 
sim∂edisk_gë_¶Ÿno
 (
devno
);

85 
sim∂edisk_gë_numbî_of_blocks
 (
devno
);

86 
sim∂edisk_gë_maxout°™dög
 (
devno
);

87 
sim∂edisk_gë_numdisks
 ();

88 
sim∂edisk_gë_numcyls
 (
devno
);

89 
sim∂edisk_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
);

90 
sim∂edisk_gë_avg_£˘≥rcyl
 (
devno
);

91 
sim∂edisk_gë_m≠pög
 (
m≠ty≥
, 
devno
, 
blkno
, *
cyÕå
, *
surÁ˚±r
, *
blk±r
);

92 
sim∂edisk_evít_¨rive
 (
i‹eq_evít
 *
cuº
);

93 
sim∂edisk_gë_di°™˚
 (
devno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
);

94 
sim∂edisk_gë_£rvtime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
);

95 
sim∂edisk_gë_ac˘ime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
maxtime
);

96 
sim∂edisk_bus_dñay_com∂ëe
 (
devno
, 
i‹eq_evít
 *
cuº
, 
£¡bu¢o
);

97 
sim∂edisk_bus_ow√rshù_gø¡
 (
devno
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
);

99 
sim∂edisk
 *
gësim∂edisk
 (
devno
);

102 
devi˚_hódî
 
sim∂edisk_hdr_öôülizî
;

107 
°©gí
 
	mac˘ime°©s
;

108 
	mªque°edbus
;

109 
	mwaôögf‹bus
;

110 
	mnumbuswaôs
;

111 } 
	tsim∂edisk_°©_t
;

114 
	ssim∂edisk
 {

115 
devi˚_hódî
 
	mhdr
;

116 
	mac˘ime
;

117 
	movîhód
;

118 
	mbus_å™ß˘i⁄_œãncy
;

119 
	mnumblocks
;

120 
	mdevno
;

121 
	möôed
;

122 
ioq
 *
	mqueue
;

123 
	mmedü_busy
;

124 
	mªc⁄√˘_ªas⁄
;

126 
	mblkå™°ime
;

127 
	mmaxqÀn
;

128 
	mbusow√d
;

129 
i‹eq_evít
 *
	mbuswaô
;

130 
	m√vîdisc⁄√˘
;

131 
	mnumöbu£s
;

132 
	möbu£s
[
MAXINBUSES
];

133 
	mdïth
[
MAXINBUSES
];

134 
	m¶Ÿno
[
MAXINBUSES
];

136 
	m¥öt°©s
;

137 
sim∂edisk_°©_t
 
	m°©
;

138 } 
	tsim∂edisk_t
;

141 
	ssim∂edisk_öfo
 {

142 
sim∂edisk
 **
	msim∂edisks
;

143 
	mnumsim∂edisks
;

144 
	msim∂edisks_Àn
;

145 } 
	tsim∂edisköfo_t
;

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_stat.c

101 
	~"disksim_globÆ.h
"

102 
	~"disksim_°©.h
"

105 
	$°©_gë_cou¡
 (
°©gí
 *
°©±r
)

107 (
°©±r
->
cou¡
);

108 
	}
}

111 
	$°©_gë_cou¡_£t
 (
°©gí
 **
°©£t
, 
°©˙t
)

113 
i
;

114 
cou¡
 = 0;

116 
i
=0; i<
°©˙t
; i++) {

117 
°©gí
 *
°©±r
 = 
°©£t
[
i
];

118 
cou¡
 +
°©±r
->count;

120 (
cou¡
);

121 
	}
}

124 
	$°©_gë_runvÆ
 (
°©gí
 *
°©±r
)

126 (
°©±r
->
runvÆ
);

127 
	}
}

130 
	$°©_upd©e
 (
°©gí
 *
°©±r
, 
vÆue
)

132 
i
 = 0;

133 
°¨t
 = 
°©±r
->
di°brks
[0];

134 
°ï
 = 
°©±r
->
di°brks
[1];

135 
grow
 = 
°©±r
->
di°brks
[2];

136 
equÆs
 = 
°©±r
->equals;

137 
buckës
 = 
°©±r
->
di°brks
[(
DISTSIZE
-1)];

138 
ötvÆ
 = (Ë(
vÆue
 * (Ë
°©±r
->
sˇÀ
);

140 
°©±r
->
cou¡
++;

141 i‡(
°©±r
->
maxvÆ
 < 
vÆue
) {

142 
°©±r
->
maxvÆ
 = 
vÆue
;

144 
°©±r
->
runvÆ
 +
vÆue
;

145 
°©±r
->
runsqu¨es
 +(
vÆue
*value);

146 i‡(
buckës
 > 
DISTSIZE
) {

147 i‡(
ötvÆ
 < 
°¨t
) {

148 } i‡(!
grow
) {

149 i‡((
equÆs
Ë&& (
ötvÆ
 <(
°¨t
 - 
°ï
 + (step *Équals))) && (((intval - start) % step) == 0)) {

150 
i
 = 
ötvÆ
 / 
°ï
;

152 
i
 = (
ötvÆ
 + 
°ï
 - 
°¨t
) / step;

153 i‡(
i
 >
buckës
) {

154 
i
 = 
buckës
 - 1;

158 
t›
 = 
buckës
 - 1;

160 
i
 < 
equÆs
) {

161 i‡(
ötvÆ
 =
°©±r
->
œrgedi°°¨ts
[
i
]) {

164 
i
++;

166 i‡((
i
 >
equÆs
Ë&& (ò< 
buckës
)) {

167 
t›
--;

168 i‡(
ötvÆ
 < 
°©±r
->
œrgedi°°¨ts
[
t›
]) {

169 
bŸtom
 = 
i
;

170 
t›
 !
bŸtom
) {

171 
i
 = 
bŸtom
 + ((
t›
 - bottom) / 2);

172 i‡(
ötvÆ
 < 
°©±r
->
œrgedi°°¨ts
[(
i
+1)]) {

173 
t›
 = 
i
;

175 
bŸtom
 = 
i
+1;

179 
i
 = 
t›
 + 1;

182 
°©±r
->
œrgedi°vÆs
[
i
]++;

184 
i
 = 0;

185 
i
<(
DISTSIZE
-1)) {

186 i‡((
i
 < 
equÆs
Ë&& (
vÆue
 =(Ë
°©±r
->
di°brks
[i])) {

188 } i‡((
i
 >
equÆs
Ë&& (
ötvÆ
 < 
°©±r
->
di°brks
[i])) {

191 
i
++;

193 
°©±r
->
smÆldi°vÆs
[
i
]++;

195 
	}
}

198 
	$°©_¥öt_œrge_di°
 (
°©gí
 **
°©£t
, 
°©˙t
, 
cou¡
, *
idít°r
)

200 
i
, 
j
;

201 
°©gí
 *
°©±r
 = 
°©£t
[0];

202 
°ï
 = 
°©±r
->
di°brks
[1];

203 
grow
 = 
°©±r
->
di°brks
[2];

204 
buckës
 = 
°©±r
->
di°brks
[(
DISTSIZE
-1)];

205 
buckëno
 = 
°©±r
->
di°brks
[0];

206 
sˇÀ
 = (Ë
°©±r
->scale;

207 
sˇÀd
 = (
sˇÀ
 =1.0Ë? 
FALSE
 : 
TRUE
;

208 
di°
 = 0.0;

209 
buckë˙t
;

210 
dísôy
;

212 i‡(
cou¡
 == 0) {

215 
	`Ârötf
 (
ouçutfûe
, "%s%†di°ributi⁄\n", 
idít°r
, 
°©±r
->
°©desc
);

216 
i
=0; i<
buckës
; i++) {

217 i‡(
°©˙t
 > 1) {

218 
buckë˙t
 = 0;

219 
j
=0; j<
°©˙t
; j++) {

220 
°©±r
 = 
°©£t
[
j
];

221 
buckë˙t
 +
°©±r
->
œrgedi°vÆs
[
i
];

224 
buckë˙t
 = 
°©±r
->
œrgedi°vÆs
[
i
];

226 
dísôy
 = (Ë
buckë˙t
 / (Ë
cou¡
;

227 
di°
 +
dísôy
;

228 i‡(
sˇÀd
) {

229 
	`Ârötf
 (
ouçutfûe
, "%6.3‡ \t%7d \t%‡ \t%f\n", ((Ë
buckëno
 / 
sˇÀ
), 
buckë˙t
, 
dísôy
, 
di°
);

231 
	`Ârötf
 (
ouçutfûe
, "%4d \t%7d \t%‡ \t%f\n", 
buckëno
, 
buckë˙t
, 
dísôy
, 
di°
);

233 
buckëno
 +
°ï
 + ()((Ë(
	`abs
(buckënoË* 
grow
) / () 100);

235 
	}
}

238 
	$°©_¥öt
 (
°©gí
 *
°©±r
, *
idít°r
)

240 
	`°©_¥öt_fûe
(
°©±r
, 
idít°r
, 
ouçutfûe
);

241 
	}
}

244 
	$°©_¥öt_fûe
 (
°©gí
 *
°©±r
, *
idít°r
, 
FILE
 *
outfûe
){

245 
i
;

246 
cou¡
 = 0;

247 
buckës
 = 
°©±r
->
di°brks
[(
DISTSIZE
-1)];

248 
sˇÀ
 = (Ë
°©±r
->scale;

249 
ötvÆ
 = 
°©±r
->
di°brks
[(
DISTSIZE
-2)];

250 *
°©desc
 = 
°©±r
->statdesc;

251 
di°ch¨
 = '=';

252 
runsqu¨es
 = 0.0;

253 
avg
 = 0.0;

255 i‡(
°©±r
->
cou¡
 > 0) {

256 
avg
 = 
°©±r
->
runvÆ
 / (Ë°©±r->
cou¡
;

257 
runsqu¨es
 = 
°©±r
->runsqu¨e†/ (Ë°©±r->
cou¡
 - (
avg
*avg);

258 
runsqu¨es
 = (runsqu¨e†> 0.0Ë? 
	`sqπ
(runsquares) : 0.0;

260 
	`Ârötf
(
outfûe
, "%s%†avîage: \t%f\n", 
idít°r
, 
°©desc
, 
avg
);

261 
	`Ârötf
(
outfûe
, "%s%†°d.dev.:\t%f\n", 
idít°r
, 
°©desc
, 
runsqu¨es
);

262 i‡(
°©±r
->
maxvÆ
 == () (()statptr->maxval)) {

263 
	`Ârötf
(
outfûe
, "%s%†maximum:\t%d\n", 
idít°r
, 
°©desc
, (()
°©±r
->
maxvÆ
));

265 
	`Ârötf
(
outfûe
, "%s%†maximum:\t%f\n", 
idít°r
, 
°©desc
, 
°©±r
->
maxvÆ
);

267 i‡(
buckës
 > 
DISTSIZE
) {

268 
	`°©_¥öt_œrge_di°
(&
°©±r
, 1, sèçå->
cou¡
, 
idít°r
);

271 
	`Ârötf
(
outfûe
, "%s%†di°ributi⁄\n", 
idít°r
, 
°©desc
);

272 
i
=(
DISTSIZE
-
buckës
); i<(DISTSIZE-1); i++) {

273 i‡(
i
 >
°©±r
->
equÆs
) {

274 
di°ch¨
 = '<';

276 i‡(
°©±r
->
sˇÀ
 == 1) {

277 
	`Ârötf
(
outfûe
, " %c%3d ", 
di°ch¨
, 
°©±r
->
di°brks
[
i
]);

279 
	`Ârötf
(
outfûe
, " %c%4.1‡", 
di°ch¨
, ((Ë
°©±r
->
di°brks
[
i
] / 
sˇÀ
));

282 i‡(
°©±r
->
equÆs
 =(
DISTSIZE
-1)) {

283 
ötvÆ
++;

285 
	`Ârötf
(
outfûe
, " %3d+\n", 
ötvÆ
);

286 
i
=(
DISTSIZE
-
buckës
); i<DISTSIZE; i++) {

287 
cou¡
 +
°©±r
->
smÆldi°vÆs
[
i
];

288 
	`Ârötf
(
outfûe
, " %6d ", 
°©±r
->
smÆldi°vÆs
[
i
]);

290 
	`Ârötf
(
outfûe
, "\n");

291 
	`ASSERT
(
cou¡
 =
°©±r
->count);

292 
	}
}

295 
	$°©_¥öt_£t
 (
°©gí
 **
°©£t
, 
°©˙t
, *
idít°r
)

297 
i
, 
j
;

298 
cou¡
 = 0;

299 
°©gí
 *
°©±r
 = 
°©£t
[0];

300 *
°©desc
 = 
°©±r
->statdesc;

301 
buckës
 = 
°©±r
->
di°brks
[(
DISTSIZE
-1)];

302 
ötvÆ
 = 
°©±r
->
di°brks
[(
DISTSIZE
-2)];

303 
runvÆ
 = 0.0;

304 
runsqu¨es
 = 0.0;

305 
avg
 = 0.0;

306 
maxvÆ
 = 
°©±r
->maxval;

307 
sˇÀ
 = (Ë
°©±r
->scale;

308 
runcou¡
 = 0;

309 
smÆldi°vÆs
[
DISTSIZE
];

310 
di°ch¨
 = '=';

312 
i
=0; i<
°©˙t
; i++) {

313 
°©±r
 = 
°©£t
[
i
];

314 i‡(
°©±r
->
cou¡
 > 0) {

315 
runcou¡
 +
°©±r
->
cou¡
;

316 
runvÆ
 +
°©±r
->runval;

317 
runsqu¨es
 +
°©±r
->runsquares;

318 i‡(
maxvÆ
 < 
°©±r
->maxval) {

319 
maxvÆ
 = 
°©±r
->maxval;

323 i‡(
runcou¡
 > 0) {

324 
avg
 = 
runvÆ
 / (Ë
runcou¡
;

325 
runsqu¨es
 = (runsqu¨e†/ (Ë
runcou¡
Ë- (
avg
*avg);

326 
runsqu¨es
 = (runsqu¨e†> 0.0Ë? 
	`sqπ
(runsquares) : 0.0;

328 
runsqu¨es
 = 0.0;

330 
	`Ârötf
(
ouçutfûe
, "%s%†avîage: \t%f\n", 
idít°r
, 
°©desc
, 
avg
);

331 
	`Ârötf
(
ouçutfûe
, "%s%†°d.dev.:\t%f\n", 
idít°r
, 
°©desc
, 
runsqu¨es
);

332 i‡(
maxvÆ
 == () (()maxval)) {

333 
	`Ârötf
(
ouçutfûe
, "%s%†maximum:\t%d\n", 
idít°r
, 
°©desc
, ()
maxvÆ
);

335 
	`Ârötf
(
ouçutfûe
, "%s%†maximum:\t%f\n", 
idít°r
, 
°©desc
, 
maxvÆ
);

337 i‡(
buckës
 > 
DISTSIZE
) {

338 
	`°©_¥öt_œrge_di°
(
°©£t
, 
°©˙t
, 
runcou¡
, 
idít°r
);

341 
	`Ârötf
(
ouçutfûe
, "%s%†di°ributi⁄\n", 
idít°r
, 
°©desc
);

342 
°©±r
 = 
°©£t
[0];

343 
i
=(
DISTSIZE
-
buckës
); i<(DISTSIZE-1); i++) {

344 i‡(
i
 >
°©±r
->
equÆs
) {

345 
di°ch¨
 = '<';

347 i‡(
°©±r
->
sˇÀ
 == 1) {

348 
	`Ârötf
(
ouçutfûe
, " %c%3d ", 
di°ch¨
, 
°©±r
->
di°brks
[
i
]);

350 
	`Ârötf
(
ouçutfûe
, " %c%4.1‡", 
di°ch¨
, ((Ë
°©±r
->
di°brks
[
i
] / (Ë
sˇÀ
));

353 i‡(
°©±r
->
equÆs
 =(
DISTSIZE
-1)) {

354 
ötvÆ
++;

356 
	`Ârötf
(
ouçutfûe
, " %3d+\n", 
ötvÆ
);

357 
i
=0; i<
DISTSIZE
; i++) {

358 
smÆldi°vÆs
[
i
] = 0;

360 
i
=0; i<
°©˙t
; i++) {

361 
°©±r
 = 
°©£t
[
i
];

362 
j
=0; j<
DISTSIZE
; j++) {

363 
smÆldi°vÆs
[
j
] +
°©±r
->smalldistvals[j];

366 
i
=(
DISTSIZE
-
buckës
); i<DISTSIZE; i++) {

367 
cou¡
 +
smÆldi°vÆs
[
i
];

368 
	`Ârötf
(
ouçutfûe
, " %6d ", 
smÆldi°vÆs
[
i
]);

370 
	`Ârötf
(
ouçutfûe
, "\n");

371 
	`ASSERT2
(
cou¡
 =
runcou¡
, "count", count, "runcount",Ñuncount);

372 
	}
}

375 
	$°©_ª£t
 (
°©gí
 *
°©±r
)

377 
buckës
 = 
°©±r
->
di°brks
[(
DISTSIZE
-1)];

378 
i
;

380 
°©±r
->
cou¡
 = 0;

381 
°©±r
->
runvÆ
 = 0.0;

382 
°©±r
->
runsqu¨es
 = 0.0;

383 
°©±r
->
maxvÆ
 = 0.0;

384 i‡(
buckës
 > 
DISTSIZE
) {

385 
i
=0; i<
buckës
; i++) {

386 
°©±r
->
œrgedi°vÆs
[
i
] = 0;

389 
i
=0; i<
DISTSIZE
; i++) {

390 
°©±r
->
smÆldi°vÆs
[
i
] = 0;

393 
	}
}

396 
	$°©_gë_œrge_di°
 (
FILE
 *
°©def_fûe
, 
°©gí
 *
°©±r
, 
buckës
)

398 
i
;

399 
löe
[201];

401 
°©±r
->
œrgedi°vÆs
 = (*Ë
	`DISKSIM_mÆloc
(
buckës
*());

402 
	`ASSERT
(
°©±r
->
œrgedi°vÆs
 !
NULL
);

404 i‡(
	`fgës
(
löe
, 200, 
°©def_fûe
Ë=
NULL
) {

405 
	`Ârötf
(
°dîr
, "Can't getÜine describingÜarge dist\n");

406 
	`exô
(1);

408 i‡(
	`ssˇnf
(
löe
, "Sèπ %d sã∞%d grow %d", &
°©±r
->
di°brks
[0], &statptr->distbrks[1], &statptr->distbrks[2]) != 3) {

409 
	`Ârötf
(
°dîr
, "Bad f‹m© f‹Üöêdes¸ibögÜ¨gêdi° - %s\n", 
löe
);

410 
	`exô
(1);

412 
i
=0; i<
buckës
; i++) {

413 
°©±r
->
œrgedi°vÆs
[
i
] = 0;

415 i‡(
°©±r
->
di°brks
[2]) {

416 
grow
 = 
°©±r
->
di°brks
[2];

417 
°ï
 = 
°©±r
->
di°brks
[1];

418 
buckëvÆ
 = 
°©±r
->
di°brks
[0];

419 
i
;

421 
°©±r
->
œrgedi°°¨ts
 = (*Ë
	`DISKSIM_mÆloc
(
buckës
*());

422 
	`ASSERT
(
°©±r
->
œrgedi°°¨ts
 !
NULL
);

424 
i
=0; i < 
buckës
; i++) {

425 
°©±r
->
œrgedi°°¨ts
[
i
] = 
buckëvÆ
;

426 
buckëvÆ
 +
°ï
 + ()((Ë(
	`abs
(buckëvÆË* 
grow
) / () 100);

429 
	}
}

432 
	$°©_öôülize
 (
FILE
 *
°©def_fûe
, *
°©desc
, 
°©gí
 *
°©±r
)

434 
i
;

435 
buckës
;

436 
löe
[201];

437 
löe2
[201];

439 i‡(
	`f£ek
(
°©def_fûe
, 0L, 0)) {

440 
	`Ârötf
(
°dîr
, "Can'tÑewindÅhe statdef_file\n");

441 
	`exô
(1);

443 
	`•rötf
(
löe2
, "%s\n", 
°©desc
);

445 i‡(
	`fgës
(
löe
, 200, 
°©def_fûe
Ë=
NULL
) {

446 
	`Ârötf
(
°dîr
, "Nÿc⁄figuøti⁄ f‹ sèà%†giví i¿°©def†fûe\n", 
°©desc
);

447 
	`exô
(1);

449 i‡(
	`°rcmp
(
löe
, 
löe2
) == 0) {

454 i‡(
	`fgës
(
löe
, 200, 
°©def_fûe
Ë=
NULL
) {

455 
	`Ârötf
(
°dîr
, "Sèàdeföôi⁄ o∆yÖ¨tüŒy found: %s\n", 
°©desc
);

456 
	`exô
(1);

459 i‡(
	`ssˇnf
(
löe
, "Di°ributi⁄ size: %d\n", &
buckës
) != 1) {

460 
	`Ârötf
(
°dîr
, "InvÆid f‹m© f‹ 'di°ributi⁄ size': %s\n", 
°©desc
);

461 
	`exô
(1);

464 i‡(
	`fgës
(
löe
, 200, 
°©def_fûe
Ë=
NULL
) {

465 
	`Ârötf
(
°dîr
, "Sèàdeföôi⁄ o∆yÖ¨tüŒy found: %s\n", 
°©desc
);

466 
	`exô
(1);

469 i‡(
	`ssˇnf
(
löe
, "SˇÀ/EquÆs: %d/%d\n", &
°©±r
->
sˇÀ
, &°©±r->
equÆs
) != 2) {

470 
	`Ârötf
(
°dîr
, "InvÆid f‹m© f‹ 'sˇÀ/equÆs': %s\n", 
°©desc
);

471 
	`exô
(1);

474 
°©±r
->
cou¡
 = 0;

475 
°©±r
->
runvÆ
 = 0.0;

476 
°©±r
->
runsqu¨es
 = 0.0;

477 
°©±r
->
maxvÆ
 = 0.0;

478 
°©±r
->
°©desc
 = 
	`DISKSIM_mÆloc
 (
	`°æí
(statdesc)+1);

479 
	`°r˝y
 (
°©±r
->
°©desc
, statdesc);

480 
i
=0; i<
DISTSIZE
; i++) {

481 
°©±r
->
di°brks
[
i
] = 0;

482 
°©±r
->
smÆldi°vÆs
[
i
] = 0;

484 
°©±r
->
di°brks
[(
DISTSIZE
-1)] = 
buckës
;

485 
°©±r
->
œrgedi°vÆs
 = 
NULL
;

486 
°©±r
->
œrgedi°°¨ts
 = 
NULL
;

488 i‡(
buckës
 > 
DISTSIZE
) {

489 
	`°©_gë_œrge_di°
(
°©def_fûe
, 
°©±r
, 
buckës
);

492 
i
 = 0; i < (
DISTSIZE
-1); i++) {

493 i‡(
	`fsˇnf
(
°©def_fûe
, "%d", &
°©±r
->
di°brks
[
i
]) != 1) {

494 
	`Ârötf
(
°dîr
, "Di°ributi⁄ buckë†⁄lyÖ¨tüŒy s≥cifõd: %†%d\n", 
°©desc
, 
i
);

495 
	`exô
(1);

499 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_stat.h

101 #i‚de‡
DISKSIM_STAT_H


102 
	#DISKSIM_STAT_H


	)

104 
	~<°dio.h
>

105 
	~"disksim_globÆ.h
"

107 
	#DISTSIZE
 10

	)

110 
	mcou¡
;

111 *
	m°©desc
;

112 
FILE
 *
	m°©fûe
;

113 
	m•a˚
[4];

114 
	msˇÀ
;

115 
	mequÆs
;

116 
	mmaxvÆ
;

117 
	mrunvÆ
;

118 
	mrunsqu¨es
;

119 *
	mœrgedi°vÆs
;

120 *
	mœrgedi°°¨ts
;

121 
	mdi°brks
[
DISTSIZE
];

122 
	msmÆldi°vÆs
[
DISTSIZE
];

123 } 
	t°©gí
;

128 
°©_öôülize
 (
FILE
 *
°©def_fûe
, *
°©desc
, 
°©gí
 *
°©±r
);

129 
°©_ª£t
 (
°©gí
 *
°©±r
);

130 
°©_upd©e
 (
°©gí
 *
°©±r
, 
vÆue
);

131 
°©_gë_cou¡
 (
°©gí
 *
°©±r
);

132 
°©_gë_runvÆ
 (
°©gí
 *
°©±r
);

133 
°©_¥öt
 (
°©gí
 *
°©±r
, *
idít°r
);

134 
°©_¥öt_fûe
 (
°©gí
 *
°©±r
, *
idít°r
, 
FILE
 *
outfûe
);

135 
°©_¥öt_£t
 (
°©gí
 **
°©£t
, 
°©˙t
, *
idít°r
);

136 
°©_gë_cou¡_£t
 (
°©gí
 **
°©£t
, 
°©˙t
);

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_statload.c

34 
	~<°dio.h
>

35 
	~<as£π.h
>

36 
	~<°rög.h
>

38 
	~"c⁄fig.h
"

39 
	~"moduÀs/moduÀs.h
"

40 
	~"disksim_globÆ.h
"

43 
	$disksim_°©s_lﬂd∑øms
(
Õ_block
 *
b
) {

48 
	`Õ_lﬂd∑øms
(0, 
b
, &
disksim_°©s_mod
);

51 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_synthio.c

102 
	~"disksim_sy¡hio.h
"

103 
	~"moduÀs/moduÀs.h
"

105 
	#SYNTHIO_UNIFORM
 0

	)

106 
	#SYNTHIO_NORMAL
 1

	)

107 
	#SYNTHIO_EXPONENTIAL
 2

	)

108 
	#SYNTHIO_POISSON
 3

	)

109 
	#SYNTHIO_TWOVALUE
 4

	)

112 
	$sy¡hio_gë_unif‹m
 (
sy¡hio_di°r
 *
‰omdi°r
)

114 (((
‰omdi°r
->
v¨
 - fromdi°r->
ba£
Ë* 
	`DISKSIM_dønd48
()) + fromdistr->base);

115 
	}
}

118 
	$sy¡hio_gë_n‹mÆ
 (
sy¡hio_di°r
 *
‰omdi°r
)

120 
y1
, 
y2
;

121 
y
 = 0;

123 
y
 <= 0.0) {

124 
y2
 = - 
	`log
((Ë1.0 - 
	`DISKSIM_dønd48
());

125 
y1
 = - 
	`log
((Ë1.0 - 
	`DISKSIM_dønd48
());

126 
y
 = 
y2
 - ((
y1
 - () 1.0) * (y1 - () 1.0)) / 2;

128 i‡(
	`DISKSIM_dønd48
() < 0.5) {

129 
y1
 = -y1;

131 ((
‰omdi°r
->
v¨
 * 
y1
Ë+ fromdi°r->
món
);

132 
	}
}

135 
	$sy¡hio_gë_exp⁄ítül
 (
sy¡hio_di°r
 *
‰omdi°r
)

137 
dtmp
;

139 
dtmp
 = 
	`log
((Ë1.0 - 
	`DISKSIM_dønd48
());

140 ((
‰omdi°r
->
ba£
 - (‰omdi°r->
món
 * 
dtmp
)));

141 
	}
}

144 
	$sy¡hio_gë_poiss⁄
 (
sy¡hio_di°r
 *
‰omdi°r
)

146 
dtmp
 = 1.0;

147 
cou¡
 = 0;

148 
°›
;

150 
°›
 = 
	`exp
(-
‰omdi°r
->
món
);

151 
dtmp
 >
°›
) {

152 
dtmp
 *
	`DISKSIM_dønd48
();

153 
cou¡
++;

155 
cou¡
--;

156 ((Ë
cou¡
 + 
‰omdi°r
->
ba£
);

157 
	}
}

160 
	$sy¡hio_gë_twovÆue
 (
sy¡hio_di°r
 *
‰omdi°r
)

162 i‡(
	`DISKSIM_dønd48
(Ë< 
‰omdi°r
->
v¨
) {

163 (
‰omdi°r
->
món
);

165 (
‰omdi°r
->
ba£
);

167 
	}
}

170 
	$sy¡hio_gëønd
 (
sy¡hio_di°r
 *
‰omdi°r
)

172 
‰omdi°r
->
ty≥
) {

173 
SYNTHIO_UNIFORM
:

174 (
	`sy¡hio_gë_unif‹m
(
‰omdi°r
));

175 
SYNTHIO_NORMAL
:

176 (
	`sy¡hio_gë_n‹mÆ
(
‰omdi°r
));

177 
SYNTHIO_EXPONENTIAL
:

178 (
	`sy¡hio_gë_exp⁄ítül
(
‰omdi°r
));

179 
SYNTHIO_POISSON
:

180 (
	`sy¡hio_gë_poiss⁄
(
‰omdi°r
));

181 
SYNTHIO_TWOVALUE
:

182 (
	`sy¡hio_gë_twovÆue
(
‰omdi°r
));

184 
	`Ârötf
(
°dîr
, "Uƒecognized di°ributi⁄Åy≥ - %d\n", 
‰omdi°r
->
ty≥
);

185 
	`exô
(1);

187 
	}
}

190 
	$sy¡hio_≠≥ndio
 (
¥o˚ss
 *
¥o˝
, 
i‹eq_evít
 *
tmp
)

192 
sy¡hio_gíî©‹
 *
gí
 = (sy¡hio_gíî©‹ *Ë
¥o˝
->
•a˚
;

193 
¶ìp_evít
 *
limôtmp
 = 
NULL
;

194 
evít
 *
¥ev
 = 
NULL
;

195 
¶ìp_evít
 *
√w¶ìp
 = 
NULL
;

196 
¶ìp_evít
 *
ˇŒ¶ìp
 = 
NULL
;

197 
¶ìp_evít
 *
ªt¶ìp
 = 
NULL
;

198 
i‹eq_evít
 *
√w
;

199 
blocksize
;

200 
gínum
;

202 
blocksize
 = 
gí
->blocksize;

203 
gínum
 = 
gí
->
numbî
;

204 
√w
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

205 
√w
->
ty≥
 = 
IOREQ_EVENT
;

206 
√w
->
time
 = 
tmp
->time;

207 
√w
->
devno
 = 
tmp
->devno;

208 
√w
->
blkno
 = 
tmp
->blknÿ* 
blocksize
;

209 
√w
->
bcou¡
 = 
tmp
->bcou¡ * 
blocksize
;

210 
√w
->
Êags
 = 
tmp
->flags;

211 
√w
->
ˇu£
 = 
tmp
->cause;

212 
√w
->
›id
 = (
sy¡hio_ídio˙t
 * 
gínum
Ë+ 
sy¡hio_io˙t
;

215 
√w
->
buf
 = (*Ë√w->
›id
;

216 if(
sy¡hio_sysˇŒs
){

217 
ªt¶ìp
 = (
¶ìp_evít
 *Ë
	`gë‰omexåaq
();

218 
ªt¶ìp
->
ty≥
 = 
SLEEP_EVENT
;

219 
ªt¶ìp
->
time
 = 
sy¡hio_sy§ë_time
;

220 
ªt¶ìp
->
ch™
 = 
√w
->
buf
;

221 
ªt¶ìp
->
io¶ìp
 = 1;

222 
ˇŒ¶ìp
 = (
¶ìp_evít
 *Ë
	`gë‰omexåaq
();

223 
ˇŒ¶ìp
->
ty≥
 = 
SLEEP_EVENT
;

224 
ˇŒ¶ìp
->
time
 = 
sy¡hio_sysˇŒ_time
;

225 
ˇŒ¶ìp
->
ch™
 = 
√w
->
buf
;

226 
ˇŒ¶ìp
->
io¶ìp
 = 1;

228 i‡(
√w
->
Êags
 & (
TIME_CRITICAL
|
TIME_LIMITED
)) {

229 
√w¶ìp
 = (
¶ìp_evít
 *Ë
	`gë‰omexåaq
();

230 
√w¶ìp
->
ty≥
 = 
SLEEP_EVENT
;

231 
√w¶ìp
->
time
 = 0.0;

232 
√w¶ìp
->
ch™
 = 
√w
->
buf
;

233 
√w¶ìp
->
io¶ìp
 = 1;

234 i‡(
√w
->
Êags
 & 
TIME_CRITICAL
) {

235 if(
sy¡hio_sysˇŒs
){

236 
ªt¶ìp
->
√xt
 = 
¥o˝
->
evíéi°
;

237 
√w
->
√xt
 = (
i‹eq_evít
 *Ë
ªt¶ìp
;

238 
ˇŒ¶ìp
->
√xt
 = (
evít
 *Ë
√w
;

239 
√w
 = (
i‹eq_evít
 *Ë
ˇŒ¶ìp
;

240 
√w¶ìp
 = 
NULL
;

242 
√w¶ìp
->
√xt
 = 
¥o˝
->
evíéi°
;

243 
√w
->
√xt
 = (
i‹eq_evít
 *Ë
√w¶ìp
;

246 
√w
->
√xt
 = (
i‹eq_evít
 *Ë
¥o˝
->
evíéi°
;

247 
√w¶ìp
->
time
 = -1.0;

248 
√w¶ìp
->
time
 < 0.0) {

249 
√w¶ìp
->
time
 = 
	`sy¡hio_gëønd
 (&
gí
->
tmlimô
);

251 
√w¶ìp
->
time
 +
√w
->time;

252 
limôtmp
 = 
gí
->
limôs
;

253 i‡((
limôtmp
 =
NULL
Ë|| (
√w¶ìp
->
time
 <Üimittmp->time)) {

254 
√w¶ìp
->
√xt
 = (
evít
 *Ë
gí
->
limôs
;

255 
gí
->
limôs
 = (
¶ìp_evít
 *Ë
√w¶ìp
;

256 i‡(
limôtmp
) {

257 
limôtmp
->
time
 -
√w¶ìp
->time;

260 
√w¶ìp
->
time
 -
limôtmp
->time;

261 (
limôtmp
->
√xt
Ë&& (
√w¶ìp
->
time
 >=Üimittmp->next->time)) {

262 
limôtmp
 = (
¶ìp_evít
 *Ëlimôtmp->
√xt
;

263 
√w¶ìp
->
time
 -
limôtmp
->time;

265 
√w¶ìp
->
√xt
 = 
limôtmp
->next;

266 
limôtmp
->
√xt
 = (
evít
 *Ë
√w¶ìp
;

267 i‡(
√w¶ìp
->
√xt
) {

268 
√w¶ìp
->
√xt
->
time
 -=Çewsleep->time;

271 
√w¶ìp
 = 
NULL
;

274 
√w
->
√xt
 = (
i‹eq_evít
 *Ë
¥o˝
->
evíéi°
;

277 
¥o˝
->
evíéi°
 = (
evít
 *Ë
√w
;

279 
sy¡hio_check_gílimôs
:

280 
limôtmp
 = 
gí
->
limôs
;

281 (
limôtmp
Ë&& (limôtmp->
time
 < 
√w
->time)) {

282 
gí
->
limôs
 = (
¶ìp_evít
 *Ë
limôtmp
->
√xt
;

283 
√w
->
time
 -
limôtmp
->time;

284 
limôtmp
->
√xt
 = (
evít
 *Ë
√w
;

285 i‡(
¥ev
) {

286 
¥ev
->
√xt
 = (
evít
 *Ë
limôtmp
;

288 
¥o˝
->
evíéi°
 = (
evít
 *Ë
limôtmp
;

290 
¥ev
 = (
evít
 *Ë
limôtmp
;

291 
limôtmp
 = 
gí
->
limôs
;

294 i‡((
√w¶ìp
Ë&& (
gí
->
limôs
)) {

295 
¥ev
 = (
evít
 *Ë
√w
;

296 
√w
 = (
i‹eq_evít
 *Ë
√w¶ìp
;

297 
√w¶ìp
 = 
NULL
;

298 
sy¡hio_check_gílimôs
;

303 
	}
}

306 
	$sy¡hio_öôülize_gíî©‹
 (
¥o˚ss
 *
¥o˝
)

308 
i‹eq_evít
 *
tmp
;

309 
sy¡hio_gíî©‹
 *
gí
;

310 
evít
 *
ev±r
;

311 
ªq˛ass
;

313 
ev±r
 = 
	`gë‰omexåaq
();

314 
ev±r
->
time
 = 0.0;

315 
ev±r
->
ty≥
 = 
SYNTHIO_EVENT
;

316 
ev±r
->
√xt
 = 
NULL
;

317 
¥o˝
->
evíéi°
 = 
ev±r
;

318 
gí
 = (
sy¡hio_gíî©‹
 *Ë
¥o˝
->
•a˚
;

319 i‡(
gí
 =
NULL
) {

320 
	`Ârötf
(
°dîr
, "Process withÇo synthetic generator in synthio_initialize\n");

321 
	`exô
(1);

323 
tmp
 = (
i‹eq_evít
 *Ë
	`gë‰omexåaq
();

324 
tmp
->
time
 = -1.0;

325 
tmp
->
time
 < 0.0) {

326 
tmp
->
time
 = 
	`sy¡hio_gëønd
(&
gí
->
gíöå
);

328 
tmp
->
Êags
 = 0;

329 
tmp
->
ˇu£
 = 
gí
->
numbî
;

330 
tmp
->
devno
 = 
gí
->devno[(Ë(
	`DISKSIM_dønd48
(Ë* (Ëgí->
numdisks
)];

331 
tmp
->
blkno
 =Åmp->
bcou¡
 = 
gí
->
blk•îdisk
;

332 ((
tmp
->
blkno
 +Åmp->
bcou¡
Ë>
gí
->
blk•îdisk
) || (tmp->bcount == 0)) {

333 
tmp
->
blkno
 = (Ë(
	`DISKSIM_dønd48
(Ë* (Ë
gí
->
blk•îdisk
);

334 
tmp
->
bcou¡
 = ((Ë
	`sy¡hio_gëønd
(&
gí
->
sizedi°
Ë+ gí->
blocksize
 - 1) / gen->blocksize;

336 i‡(
	`DISKSIM_dønd48
(Ë< 
gí
->
¥obªad
) {

337 
tmp
->
Êags
 |
READ
;

339 
ªq˛ass
 = 
	`DISKSIM_dønd48
(Ë- 
gí
->
¥obtm¸ô
;

340 i‡(
ªq˛ass
 < 0.0) {

341 
tmp
->
Êags
 |
TIME_CRITICAL
;

342 } i‡(
ªq˛ass
 < 
gí
->
¥obtmlim
) {

343 
tmp
->
Êags
 |
TIME_LIMITED
;

345 
gí
->
≥ndio
 = 
tmp
;

346 
	`sy¡hio_≠≥ndio
(
¥o˝
, 
tmp
);

348 
	`Ârötf
 (
ouçutfûe
, "Inôülized sy¡hiÿ¥o˚s†#%d, fú°Évíà©Åimê%f\n", 
¥o˝
->
pid
,Öro˝->
evíéi°
->
time
);

350 
	}
}

353 
	$sy¡hio_gíî©íextio
 (
sy¡hio_gíî©‹
 *
gí
)

355 
ty≥
;

356 
ªq˛ass
;

357 
blkno
;

358 
i‹eq_evít
 *
tmp
;

360 i‡((
simtime
 >
sy¡hio_ídtime
Ë|| (
sy¡hio_io˙t
 >
sy¡hio_ídio˙t
))

363 
tmp
 = 
gí
->
≥ndio
;

364 i‡(
gí
->
åa˚fûe
) {

365 
gí
->
≥ndio
 =

366 (
i‹eq_evít
 *)
	`iŸø˚_gë_i‹eq_evít
(
gí
->
åa˚fûe
,

367 
disksim
->
åa˚f‹m©
,

368 
tmp
);

369 i‡(
gí
->
≥ndio
) {

370 
tmp
->
ˇu£
 = 
gí
->
numbî
;

373 
	`Ârötf
(
°dîr
, "Returning NULLÉvent in synthio_generatenextio\n");

379 
ty≥
 = 
	`DISKSIM_dønd48
();

381 i‡((
ty≥
 < 
gí
->
¥ob£q
) &&

382 ((
tmp
->
blkno
 + 2*tmp->
bcou¡
Ë< 
gí
->
blk•îdisk
)) {

384 
tmp
->
time
 = -1.0;

386 
tmp
->
time
 < 0.0) {

387 
tmp
->
time
 = 
	`sy¡hio_gëønd
(&
gí
->
£qöå
);

390 
tmp
->
Êags
 = 
SEQ
 | (tmp->Êag†& 
READ
);

391 
tmp
->
ˇu£
 = 
gí
->
numbî
;

392 
tmp
->
blkno
 +tmp->
bcou¡
;

394 i‡((
ty≥
 < (
gí
->
¥ob£q
 + gí->
¥obloc
)) &&

395 (
ty≥
 >
gí
->
¥ob£q
)) {

397 
tmp
->
time
 = -1.0;

398 
tmp
->
time
 < 0.0) {

399 
tmp
->
time
 = 
	`sy¡hio_gëønd
(&
gí
->
locöå
);

401 
tmp
->
Êags
 = 
LOCAL
;

402 
tmp
->
ˇu£
 = 
gí
->
numbî
;

403 
blkno
 = 
gí
->
blk•îdisk
;

404 ((
blkno
 + 
tmp
->
bcou¡
Ë>
gí
->
blk•îdisk
)

405 || (
blkno
 < 0)

406 || (
tmp
->
bcou¡
 <= 0))

408 
blkno
 = 
tmp
->blkno +

409 ()
	`sy¡hio_gëønd
(&
gí
->
locdi°
Ë/ gí->
blocksize
;

410 
tmp
->
bcou¡
 = ((Ë
	`sy¡hio_gëønd
(&
gí
->
sizedi°
) +

411 
gí
->
blocksize
 - 1) / gen->blocksize;

413 
tmp
->
blkno
 = blkno;

414 i‡(
	`DISKSIM_dønd48
(Ë< 
gí
->
¥obªad
) {

415 
tmp
->
Êags
 |
READ
;

419 
tmp
->
time
 = -1.0;

420 
tmp
->
time
 < 0.0) {

421 
tmp
->
time
 = 
	`sy¡hio_gëønd
(&
gí
->
gíöå
);

423 
tmp
->
Êags
 = 0;

424 
tmp
->
ˇu£
 = 
gí
->
numbî
;

425 
tmp
->
devno
 = 
gí
->devno[()(
	`DISKSIM_dønd48
() *

426 ()
gí
->
numdisks
)];

428 
tmp
->
blkno
 =Åmp->
bcou¡
 = 
gí
->
blk•îdisk
;

429 ((
tmp
->
blkno
 +Åmp->
bcou¡
Ë>
gí
->
blk•îdisk
) ||

430 (
tmp
->
bcou¡
 <= 0)) {

432 
tmp
->
blkno
 = (Ë(
	`DISKSIM_dønd48
(Ë* ()
gí
->
blk•îdisk
);

433 
tmp
->
bcou¡
 = ((Ë
	`sy¡hio_gëønd
(&
gí
->
sizedi°
) +

434 
gí
->
blocksize
 - 1) / gen->blocksize;

437 i‡(
	`DISKSIM_dønd48
(Ë< 
gí
->
¥obªad
) {

438 
tmp
->
Êags
 = 
READ
;

441 
ªq˛ass
 = 
	`DISKSIM_dønd48
(Ë- 
gí
->
¥obtm¸ô
;

443 i‡(
ªq˛ass
 < 0.0) {

444 
tmp
->
Êags
 |
TIME_CRITICAL
;

446 i‡(
ªq˛ass
 < 
gí
->
¥obtmlim
) {

447 
tmp
->
Êags
 |
TIME_LIMITED
;

450 
	}
}

453 
	$sy¡hio_gíî©e_io_a˘ivôy
 (
¥o˚ss
 *
¥o˝
)

455 
sy¡hio_gíî©‹
 *
gí
;

457 
gí
 = (
sy¡hio_gíî©‹
 *Ë
¥o˝
->
•a˚
;

461 
sy¡hio_io˙t
++;

462 i‡(
	`sy¡hio_gíî©íextio
(
gí
)) {

463 
	`sy¡hio_≠≥ndio
(
¥o˝
, 
gí
->
≥ndio
);

465 
	`disksim_sim°›
();

467 
	}
}

472 
	$sy¡hio_ª£t°©s
()

474 
	}
}

477 
	$sy¡hio_˛ón°©s
()

479 
	}
}

482 
	$sy¡hio_¥öt°©s
()

484 
	}
}

487 
	$sy¡hio_ªad_unif‹m
 (
FILE
 *
∑rfûe
, 
sy¡hio_di°r
 *
√wdi°r
, 
mu…
)

489 
√wdi°r
->
ty≥
 = 
SYNTHIO_UNIFORM
;

490 i‡(
	`fsˇnf
(
∑rfûe
, "Möimum vÆue: %lf\n", &
√wdi°r
->
ba£
) != 1) {

491 
	`Ârötf
(
°dîr
, "ErrorÑeading 'minimum value'\n");

492 
	`exô
(1);

494 
	`Ârötf
 (
ouçutfûe
, "Möimum vÆue: %f\n", 
√wdi°r
->
ba£
);

495 
√wdi°r
->
ba£
 *
mu…
;

496 i‡(
	`fsˇnf
(
∑rfûe
, "Maximum vÆue: %lf\n", &
√wdi°r
->
v¨
) != 1) {

497 
	`Ârötf
(
°dîr
, "ErrorÑeading 'maximum value'\n");

498 
	`exô
(1);

500 
	`Ârötf
 (
ouçutfûe
, "Maximum vÆue: %f\n", 
√wdi°r
->
v¨
);

501 
√wdi°r
->
v¨
 *
mu…
;

502 i‡(
√wdi°r
->
v¨
 <√wdi°r->
ba£
) {

503 
	`Ârötf
(
°dîr
, "'maximum vÆue' i†nŸ gª©îÅh™ 'möimum vÆue' - %‡<%f\n", 
√wdi°r
->
v¨
,Çewdi°r->
ba£
);

504 
	`exô
(1);

506 
	}
}

509 
	$sy¡hio_ªad_n‹mÆ
 (
FILE
 *
∑rfûe
, 
sy¡hio_di°r
 *
√wdi°r
, 
mu…
)

511 
√wdi°r
->
ty≥
 = 
SYNTHIO_NORMAL
;

512 i‡(
	`fsˇnf
(
∑rfûe
, "Món: %lf\n", &
√wdi°r
->
món
) != 1) {

513 
	`Ârötf
(
°dîr
, "ErrorÑeadingÇormal mean\n");

514 
	`exô
(1);

516 
	`Ârötf
 (
ouçutfûe
, "Món: %f\n", 
√wdi°r
->
món
);

517 
√wdi°r
->
món
 *
mu…
;

518 i‡(
	`fsˇnf
(
∑rfûe
, "V¨ün˚: %lf\n", &
√wdi°r
->
v¨
) != 1) {

519 
	`Ârötf
(
°dîr
, "ErrorÑeadingÇormal variance\n");

520 
	`exô
(1);

522 
	`Ârötf
 (
ouçutfûe
, "V¨ün˚: %f\n", 
√wdi°r
->
v¨
);

523 i‡(
√wdi°r
->
v¨
 < 0) {

524 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ 'v¨ün˚' - %f\n", 
√wdi°r
->
v¨
);

525 
	`exô
(1);

527 
√wdi°r
->
v¨
 = 
mu…
 * 
	`sqπ
(newdistr->var);

528 
	}
}

531 
	$sy¡hio_ªad_exp⁄ítül
 (
FILE
 *
∑rfûe
, 
sy¡hio_di°r
 *
√wdi°r
, 
mu…
)

533 
√wdi°r
->
ty≥
 = 
SYNTHIO_EXPONENTIAL
;

534 i‡(
	`fsˇnf
(
∑rfûe
, "Ba£ vÆue: %lf\n", &
√wdi°r
->
ba£
) != 1) {

535 
	`Ârötf
(
°dîr
, "ErrorÑeadingÉxponential base\n");

536 
	`exô
(1);

538 
	`Ârötf
 (
ouçutfûe
, "Ba£ vÆue: %f\n", 
√wdi°r
->
ba£
);

539 
√wdi°r
->
ba£
 *
mu…
;

540 i‡(
	`fsˇnf
(
∑rfûe
, "Món: %lf\n", &
√wdi°r
->
món
) != 1) {

541 
	`Ârötf
(
°dîr
, "ErrorÑeadingÉxponential mean\n");

542 
	`exô
(1);

544 
	`Ârötf
 (
ouçutfûe
, "Món: %f\n", 
√wdi°r
->
món
);

545 
√wdi°r
->
món
 *
mu…
;

546 
	}
}

549 
	$sy¡hio_ªad_poiss⁄
 (
FILE
 *
∑rfûe
, 
sy¡hio_di°r
 *
√wdi°r
, 
mu…
)

551 
√wdi°r
->
ty≥
 = 
SYNTHIO_POISSON
;

552 i‡(
	`fsˇnf
(
∑rfûe
, "Ba£ vÆue: %lf\n", &
√wdi°r
->
ba£
) != 1) {

553 
	`Ârötf
(
°dîr
, "ErrorÑeading 'base value'\n");

554 
	`exô
(1);

556 
	`Ârötf
 (
ouçutfûe
, "Ba£ vÆue: %f\n", 
√wdi°r
->
ba£
);

557 
√wdi°r
->
ba£
 *
mu…
;

558 i‡(
	`fsˇnf
(
∑rfûe
, "Món: %lf\n", &
√wdi°r
->
món
) != 1) {

559 
	`Ârötf
(
°dîr
, "ErrorÑeadingÖoisson mean\n");

560 
	`exô
(1);

562 
	`Ârötf
 (
ouçutfûe
, "Món: %f\n", 
√wdi°r
->
món
);

563 
√wdi°r
->
món
 *
mu…
;

564 
	}
}

567 
	$sy¡hio_ªad_twovÆue
 (
FILE
 *
∑rfûe
, 
sy¡hio_di°r
 *
√wdi°r
, 
mu…
)

569 
√wdi°r
->
ty≥
 = 
SYNTHIO_TWOVALUE
;

570 i‡(
	`fsˇnf
(
∑rfûe
, "DeÁu… vÆue: %lf\n", &
√wdi°r
->
ba£
) != 1) {

571 
	`Ârötf
(
°dîr
, "ErrorÑeading 'default value'\n");

572 
	`exô
(1);

574 
	`Ârötf
(
ouçutfûe
, "DeÁu… vÆue: %f\n", 
√wdi°r
->
ba£
);

575 
√wdi°r
->
ba£
 *
mu…
;

576 i‡(
	`fsˇnf
(
∑rfûe
, "Sec⁄d vÆue: %lf\n", &
√wdi°r
->
món
) != 1) {

577 
	`Ârötf
(
°dîr
, "ErrorÑeading 'second value'\n");

578 
	`exô
(1);

580 
	`Ârötf
(
ouçutfûe
, "Sec⁄d vÆue: %f\n", 
√wdi°r
->
món
);

581 
√wdi°r
->
món
 *
mu…
;

582 i‡(
	`fsˇnf
(
∑rfûe
, "Probabûôy o‡£c⁄d vÆue: %lf\n", &
√wdi°r
->
v¨
) != 1) {

583 
	`Ârötf
(
°dîr
, "ErrorÑeading 'probability of second value'\n");

584 
	`exô
(1);

586 i‡((
√wdi°r
->
v¨
 < 0) || (newdistr->var > 1)) {

587 
	`Ârötf
(
°dîr
, "InvÆidÖrobabûôy o‡£c⁄d vÆuê- %f\n", 
√wdi°r
->
v¨
);

588 
	`exô
(1);

590 
	`Ârötf
(
ouçutfûe
, "Probabûôy o‡£c⁄d vÆue: %f\n", 
√wdi°r
->
v¨
);

591 
	}
}

594 
	$sy¡hio_ªad_di°r
 (
FILE
 *
∑rfûe
, 
sy¡hio_di°r
 *
√wdi°r
, 
mu…
)

596 
ty≥
[80];

598 i‡(
	`fsˇnf
(
∑rfûe
, "Ty≥ o‡di°ributi⁄: %s\n", 
ty≥
) != 1) {

599 
	`Ârötf
(
°dîr
, "ErrorÑeading 'type of distribution'\n");

600 
	`exô
(1);

602 
	`Ârötf
 (
ouçutfûe
, "Ty≥ o‡di°ributi⁄: %s\n", 
ty≥
);

603 
ty≥
[0]) {

605 
	`sy¡hio_ªad_unif‹m
(
∑rfûe
, 
√wdi°r
, 
mu…
);

608 
	`sy¡hio_ªad_n‹mÆ
(
∑rfûe
, 
√wdi°r
, 
mu…
);

611 
	`sy¡hio_ªad_exp⁄ítül
(
∑rfûe
, 
√wdi°r
, 
mu…
);

614 
	`sy¡hio_ªad_poiss⁄
(
∑rfûe
, 
√wdi°r
, 
mu…
);

617 
	`sy¡hio_ªad_twovÆue
(
∑rfûe
, 
√wdi°r
, 
mu…
);

620 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ 'ty≥ o‡di°ributi⁄' - %s\n", 
ty≥
);

621 
	`exô
(1);

624 
	}
}

627 
	$sy¡hio_di°rc›y
 (
sy¡hio_di°r
 *
di°r1
, sy¡hio_di°∏*
di°r2
)

629 
di°r2
->
ba£
 = 
di°r1
->base;

630 
di°r2
->
món
 = 
di°r1
->mean;

631 
di°r2
->
v¨
 = 
di°r1
->var;

632 
di°r2
->
ty≥
 = 
di°r1
->type;

633 
	}
}

636 
	$sy¡hio_gíc›y
 (
sy¡hio_gíî©‹
 *
gí1
, sy¡hio_gíî©‹ *
gí2
)

638 
gí2
->
¥ob£q
 = 
gí1
->probseq;

639 
gí2
->
¥obloc
 = 
gí1
->probloc;

640 
gí2
->
¥obªad
 = 
gí1
->probread;

641 
gí2
->
¥obtm¸ô
 = 
gí1
->probtmcrit;

642 
gí2
->
¥obtmlim
 = 
gí1
->probtmlim;

643 
gí2
->
åa˚fûe
 = 
NULL
;

644 
gí2
->
≥ndio
 = 
NULL
;

645 
gí2
->
limôs
 = 
NULL
;

646 
gí2
->
numdisks
 = 
gí1
->numdisks;

647 
	`mem˝y
(
gí2
->
devno
, 
gí1
->devno, gí1->
numdisks
 * ());

648 
gí2
->
numblocks
 = 
gí1
->numblocks;

649 
gí2
->
£˘•îdisk
 = 
gí1
->sectsperdisk;

650 
gí2
->
blk•îdisk
 = 
gí1
->blksperdisk;

651 
gí2
->
blocksize
 = 
gí1
->blocksize;

652 
	`sy¡hio_di°rc›y
(&
gí1
->
tmlimô
, &
gí2
->tmlimit);

653 
	`sy¡hio_di°rc›y
(&
gí1
->
gíöå
, &
gí2
->genintr);

654 
	`sy¡hio_di°rc›y
(&
gí1
->
£qöå
, &
gí2
->seqintr);

655 
	`sy¡hio_di°rc›y
(&
gí1
->
locöå
, &
gí2
->locintr);

656 
	`sy¡hio_di°rc›y
(&
gí1
->
locdi°
, &
gí2
->locdist);

657 
	`sy¡hio_di°rc›y
(&
gí1
->
sizedi°
, &
gí2
->sizedist);

658 
	}
}

664 
lﬂdsy¡hgíî©‹s
(
sy¡hio_gíî©‹
 *
ªsu…
,

665 
Õ_li°
 *
l
);

691 
	$disksim_sy¡hio_lﬂd∑øms
(
Õ_block
 *
b
) {

693 if(!
disksim
->
sy¡hio_öfo
) {

694 
disksim
->
sy¡hio_öfo
 = 
	`DISKSIM_mÆloc
 ((
sy¡hio_öfo_t
));

695 
	`bzîo
 ((*)
disksim
->
sy¡hio_öfo
, (
sy¡hio_öfo_t
));

702 
	`Õ_lﬂd∑øms
(0, 
b
, &
disksim_sy¡hio_mod
);

705 
	}
}

708 
lﬂdgí
(
Õ_block
 *
b
, 
sy¡hio_gíî©‹
 **
ªsu…
);

711 
	$lﬂdsy¡hgíî©‹s
(
sy¡hio_gíî©‹
 *
junk
,

712 
Õ_li°
 *
l
)

714 
c
;

715 
¥o˚ss
 *
¥o˝
;

716 
¶Ÿ
 = 0;

718 if(
sy¡hio_gís
) {

719 
	`Ârötf
(
°dîr
, "***Érror:ÅriedÅoÑedefine synth. I/O generators.\n");

723 
sy¡hio_gís
 = 
	`mÆloc
(
l
->
vÆues_Àn
 * (
sy¡hio_gíî©‹
));

724 
	`bzîo
(
sy¡hio_gís
, 
l
->
vÆues_Àn
 * (
sy¡hio_gíî©‹
));

725 
disksim
->
sy¡hio_öfo
->
sy¡hio_gís_Àn
 = 
l
->
vÆues_Àn
;

727 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

728 if(!
l
->
vÆues
[
c
]) ;

730 if(
l
->
vÆues
[
c
]->
t
 !
BLOCK
) {

731 
	`Ârötf
(
°dîr
, "***Érror: bad synthio io generator spec -- must beá block.\n");

735 if(
	`lﬂdgí
(
l
->
vÆues
[
c
]->
v
.
b
, &
sy¡hio_gís
[
¶Ÿ
]))

738 
¶Ÿ
++;

741 
c
 = 0; c < 
¶Ÿ
; c++) {

742 
¥o˝
 = 
	`pf_√w_¥o˚ss
();

744 
¥o˝
->
•a˚
 = (*)
sy¡hio_gís
[
c
];

745 
sy¡hio_gís
[
c
]->
numbî
 = c;

748 
sy¡hio_gí˙t
 = 
¶Ÿ
;

750 
	}
}

753 *
	gdi°«mes
[] = {

761 
	$di°«me
(*
«me
) {

762 
c
;

763 
c
 = 
SYNTHIO_UNIFORM
; c <
SYNTHIO_TWOVALUE
; c++) {

764 if(!
	`°rcmp
(
«me
, 
di°«mes
[
c
]))  c;

767 
	}
}

769 
	$lﬂddi°n
(
Õ_li°
 *
l
, 
di°
 *
ªsu…
) {

770 
d
;

771 *
ty≥
;

773 if(!
l
->
vÆues
[0]) {

776 if(
l
->
vÆues
[0]->
t
 !
S
) {

779 
ty≥
 = 
l
->
vÆues
[0]->
v
.
s
;

781 
ªsu…
->
ty≥
 = 
	`di°«me
(type);

782 
ªsu…
->
ty≥
) {

784 
SYNTHIO_UNIFORM
:

785 if(
l
->
vÆues_Àn
 < 3) {

788 
d
 = 1; d <= 3; d++) {

789 if(!
l
->
vÆues
[
d
]) { }

790 if(
l
->
vÆues
[
d
]->
t
 !
D
) { }

793 
ªsu…
->
ba£
 = 
l
->
vÆues
[1]->
v
.
d
;

794 
ªsu…
->
v¨
 = 
l
->
vÆues
[2]->
v
.
d
;

797 
SYNTHIO_NORMAL
:

798 if(
l
->
vÆues_Àn
 < 3) {

801 
d
 = 1; d <= 3; d++) {

802 if(!
l
->
vÆues
[
d
]) { }

803 if(
l
->
vÆues
[
d
]->
t
 !
D
) { }

807 
ªsu…
->
món
 = 
l
->
vÆues
[1]->
v
.
d
;

808 
ªsu…
->
v¨
 = 
l
->
vÆues
[2]->
v
.
d
;

811 
SYNTHIO_EXPONENTIAL
:

812 if(
l
->
vÆues_Àn
 < 3) {

815 
d
 = 1; d <= 3; d++) {

816 if(!
l
->
vÆues
[
d
]) { }

817 if(
l
->
vÆues
[
d
]->
t
 !
D
) { }

820 
ªsu…
->
ba£
 = 
l
->
vÆues
[1]->
v
.
d
;

821 
ªsu…
->
món
 = 
l
->
vÆues
[2]->
v
.
d
;

824 
SYNTHIO_POISSON
:

825 if(
l
->
vÆues_Àn
 < 3) {

828 
d
 = 1; d <= 3; d++) {

829 if(!
l
->
vÆues
[
d
]) { }

830 if(
l
->
vÆues
[
d
]->
t
 !
D
) { }

833 
ªsu…
->
ba£
 = 
l
->
vÆues
[1]->
v
.
d
;

834 
ªsu…
->
món
 = 
l
->
vÆues
[2]->
v
.
d
;

837 
SYNTHIO_TWOVALUE
:

838 if(
l
->
vÆues_Àn
 < 4) {

841 
d
 = 1; d <= 4; d++) {

842 if(!
l
->
vÆues
[
d
]) { }

843 if(
l
->
vÆues
[
d
]->
t
 !
D
) { }

846 
ªsu…
->
ba£
 = 
l
->
vÆues
[1]->
v
.
d
;

847 
ªsu…
->
món
 = 
l
->
vÆues
[2]->
v
.
d
;

848 
ªsu…
->
v¨
 = 
l
->
vÆues
[3]->
v
.
d
;

849 if(!
	`RANGE
(
ªsu…
->
v¨
,0.0,1.0)) {

855 
	`Ârötf
(
°dîr
, "***Éº‹: unknow¿di°ributi⁄: %s\n", 
ty≥
);

862 
	}
}

865 
	$disksim_sy¡hgí_lﬂd∑øms
(
Õ_block
 *
b
) {

866 
	`ddbg_as£π2
(0, "this isá dummyÅhat isn't supposedÅo be called");

868 
	}
}

870 
lﬂdsy¡hdevs
(
sy¡hio_gíî©‹
 *
ªsu…
, 
Õ_li°
 *
l
);

872 
	$lﬂdgí
(
Õ_block
 *
b
, 
sy¡hio_gíî©‹
 **
ªsu…
) {

874 (*
ªsu…
Ë
	`mÆloc
((
sy¡hio_gíî©‹
));

875 
	`bzîo
((*
ªsu…
), (
sy¡hio_gíî©‹
));

878 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
disksim_sy¡hgí_mod
);

880 (*
ªsu…
)->
numblocks
 = (*ªsu…)->
£˘•îdisk
 * (*ªsu…)->
numdisks
;

881 (*
ªsu…
)->
blk•îdisk
 = (*ªsu…)->
£˘•îdisk
 / (*ªsu…)->
blocksize
;

884 
	}
}

889 
	$lﬂdsy¡hdevs
(
sy¡hio_gíî©‹
 *
ªsu…
, 
Õ_li°
 *
l
)

891 
c
;

892 
num
, 
ty≥
;

893 *
«me
;

894 
¶Ÿ
 = 0;

896 
ªsu…
->
devno
 = 
	`mÆloc
(
l
->
vÆues_Àn
 * ());

897 
	`bzîo
(
ªsu…
->
devno
, 
l
->
vÆues_Àn
 * ());

899 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

900 if(!
l
->
vÆues
[
c
]) ;

901 if(
l
->
vÆues
[
c
]->
t
 !
S
) {

905 
«me
 = 
l
->
vÆues
[
c
]->
v
.
s
;

907 if(!
	`gëdevby«me
(
«me
, &
num
, 0, &
ty≥
)) {

908 if(!
	`gëlog‹gby«me
(
sys‹gs
, 
numsys‹gs
, 
«me
, &
num
)) {

909 
	`Ârötf
(
°dîr
, "***Éº‹: bad devi˚ %†ö sy¡hëi¯gíî©‹ s≥c:Çÿsuch devi˚ o∏log‹g.\n", 
«me
);

914 
ªsu…
->
devno
[
¶Ÿ
++] = 
num
;

918 
ªsu…
->
numdisks
 = 
¶Ÿ
;

921 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/disksim_synthio.h

101 
	~"c⁄fig.h
"

102 
	~"disksim_globÆ.h
"

103 
	~"disksim_pfsim.h
"

104 
	~"disksim_iŸø˚.h
"

105 
	~"disksim_devi˚.h
"

106 
	~"disksim_iodrivî.h
"

107 
	~"disksim_log‹g.h
"

110 #i‚de‡
DISKSIM_SYNTHIO_H


111 
	#DISKSIM_SYNTHIO_H


	)

115 
	g¥o˚ss
;

116 
sy¡hio_ªad∑øms
 (
FILE
 *
∑rfûe
);

117 
sy¡hio_öôülize_gíî©‹
 (
¥o˚ss
 *
¥o˝
);

118 
sy¡hio_ª£t°©s
 ();

119 
sy¡hio_˛ón°©s
 ();

120 
sy¡hio_¥öt°©s
 ();

121 
sy¡hio_gíî©e_io_a˘ivôy
 (
¥o˚ss
 *
¥o˝
);

122 
sy¡hio_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

125 
	sdi°
 {

126 
	mba£
;

127 
	mmón
;

128 
	mv¨
;

129 
	mty≥
;

130 } 
	tsy¡hio_di°r
;

133 
	sgí
 {

134 
FILE
 *
	måa˚fûe
;

135 
	m¥ob£q
;

136 
	m¥obloc
;

137 
	m¥obªad
;

138 
	m¥obtm¸ô
;

139 
	m¥obtmlim
;

140 
	mnumbî
;

141 
i‹eq_evít
 * 
	m≥ndio
;

142 
¶ìp_evít
 * 
	mlimôs
;

143 
	mnumdisks
;

144 *
	mdevno
;

145 
	mnumblocks
;

146 
	m£˘•îdisk
;

147 
	mblk•îdisk
;

148 
	mblocksize
;

149 
sy¡hio_di°r
 
	mtmlimô
;

150 
sy¡hio_di°r
 
	mgíöå
;

151 
sy¡hio_di°r
 
	m£qöå
;

152 
sy¡hio_di°r
 
	mlocöå
;

153 
sy¡hio_di°r
 
	mlocdi°
;

154 
sy¡hio_di°r
 
	msizedi°
;

155 } 
	tsy¡hio_gíî©‹
;

158 
	ssy¡hio_öfo
 {

159 
sy¡hio_gíî©‹
 **
	msy¡hio_gís
;

160 
	msy¡hio_gí˙t
;

161 
	msy¡hio_gís_Àn
;

163 
	msy¡hio_io˙t
;

164 
	msy¡hio_ídio˙t
;

165 
	msy¡hio_ídtime
;

166 
	msy¡hio_sysˇŒs
;

167 
	msy¡hio_sysˇŒ_time
;

168 
	msy¡hio_sy§ë_time
;

169 } 
	tsy¡hio_öfo_t
;

173 
	#sy¡hio_gís
 (
disksim
->
sy¡hio_öfo
->
sy¡hio_gís
)

	)

174 
	#sy¡hio_gí˙t
 (
disksim
->
sy¡hio_öfo
->
sy¡hio_gí˙t
)

	)

175 
	#sy¡hio_io˙t
 (
disksim
->
sy¡hio_öfo
->
sy¡hio_io˙t
)

	)

176 
	#sy¡hio_ídio˙t
 (
disksim
->
sy¡hio_öfo
->
sy¡hio_ídio˙t
)

	)

177 
	#sy¡hio_ídtime
 (
disksim
->
sy¡hio_öfo
->
sy¡hio_ídtime
)

	)

178 
	#sy¡hio_sysˇŒs
 (
disksim
->
sy¡hio_öfo
->
sy¡hio_sysˇŒs
)

	)

179 
	#sy¡hio_sysˇŒ_time
 (
disksim
->
sy¡hio_öfo
->
sy¡hio_sysˇŒ_time
)

	)

180 
	#sy¡hio_sy§ë_time
 (
disksim
->
sy¡hio_öfo
->
sy¡hio_sy§ë_time
)

	)

	@/Users/ysoh/disksim-4.0-fcl/src/hplcomb.c

42 
	~<sys/ty≥s.h
>

43 
	~<°dio.h
>

44 
	~<°dlib.h
>

45 
	~<as£π.h
>

46 
	~<°rög.h
>

50 
	#u_öt32_t
 

	)

51 
	#öt32_t
 

	)

55 
öt32_t
 
	mvÆue
;

56 
	mbyã
[4];

57 } 
	tötch¨
;

59 
	#TRUE
 1

	)

60 
	#FALSE
 0

	)

62 
	#_BIG_ENDIAN
 1

	)

63 
	#_LITTLE_ENDIAN
 2

	)

67 
	#NCR_ASCII
 1

	)

68 
	#HPL_SRT
 2

	)

69 
	#DEC_RAMAKR
 3

	)

70 
	#DEFAULT
 
NCR_ASCII


	)

72 
	gídün
 = 
_LITTLE_ENDIAN
;

73 
	gåa˚f‹m©
 = 
NCR_ASCII
;

74 
	gåa˚ídün
 = 
_LITTLE_ENDIAN
;

75 
	gåa˚b©ch
 = 
FALSE
;

76 
	gåa˚com¥ess
 = 
FALSE
;

77 
	g¥öt_åa˚fûe_hódî
 = 
FALSE
;

79 
FILE
 *
	giŸø˚fûe
 = 
NULL
;

80 
FILE
 *
	giŸø˚b©ch
 = 
NULL
;

82 
	giŸø˚fûíame
[200];

84 
	gba£yór
 = 0;

85 
	gba£day
 = 0;

86 
	gba££c⁄d
 = 0;

87 
	gcuºít£c⁄d
 = 0;

90 
	$io_m⁄th_c⁄vît
(
m⁄th°r
, 
yór
)

91 *
m⁄th°r
;

92 
yór
;

94 i‡(
	`°rcmp
(
m⁄th°r
, "Jan") == 0) {

96 } i‡(
	`°rcmp
(
m⁄th°r
, "Feb") == 0) {

98 } i‡(
	`°rcmp
(
m⁄th°r
, "Mar") == 0) {

99 ((
yór
 % 4) ? 59 : 60);

100 } i‡(
	`°rcmp
(
m⁄th°r
, "Apr") == 0) {

101 ((
yór
 % 4) ? 90 : 91);

102 } i‡(
	`°rcmp
(
m⁄th°r
, "May") == 0) {

103 ((
yór
 % 4) ? 120 : 121);

104 } i‡(
	`°rcmp
(
m⁄th°r
, "Jun") == 0) {

105 ((
yór
 % 4) ? 151 : 152);

106 } i‡(
	`°rcmp
(
m⁄th°r
, "Jul") == 0) {

107 ((
yór
 % 4) ? 181 : 182);

108 } i‡(
	`°rcmp
(
m⁄th°r
, "Aug") == 0) {

109 ((
yór
 % 4) ? 212 : 213);

110 } i‡(
	`°rcmp
(
m⁄th°r
, "Sep") == 0) {

111 ((
yór
 % 4) ? 243 : 244);

112 } i‡(
	`°rcmp
(
m⁄th°r
, "Oct") == 0) {

113 ((
yór
 % 4) ? 273 : 274);

114 } i‡(
	`°rcmp
(
m⁄th°r
, "Nov") == 0) {

115 ((
yór
 % 4) ? 304 : 305);

116 } i‡(
	`°rcmp
(
m⁄th°r
, "Dec") == 0) {

117 ((
yór
 % 4) ? 334 : 335);

119 
	`as£π
 (0);

121 
	}
}

124 
	$io_h∂_§t_åa˚fûe_°¨t
(
åa˚d©e
)

125 *
åa˚d©e
;

127 
¸≠
[40];

128 
m⁄th°r
[40];

129 
day
;

130 
hour
;

131 
möuã
;

132 
£c⁄d
;

133 
yór
;

135 i‡(
	`ssˇnf
(
åa˚d©e
, "%s\t\"%†%†%d %d:%d:%d %d\";\n", 
¸≠
, cøp, 
m⁄th°r
, &
day
, &
hour
, &
möuã
, &
£c⁄d
, &
yór
) != 8) {

136 
	`Ârötf
(
°dîr
, "F‹m©ÖrobÀm wôh 'åa˚d©e'Üöêö HPLÅø˚ - %s\n", 
åa˚d©e
);

137 
	`exô
(1);

139 i‡(
ba£yór
 == 0) {

140 
ba£yór
 = 
yór
;

142 
day
 = day + 
	`io_m⁄th_c⁄vît
(
m⁄th°r
, 
yór
);

143 i‡(
yór
 !
ba£yór
) {

144 
day
 +(
ba£yór
 % 4) ? 365 : 366;

146 i‡(
ba£day
 == 0) {

147 
ba£day
 = 
day
;

149 
£c⁄d
 +(60 * 
möuã
Ë+ (3600 * 
hour
Ë+ (86400 * (
day
 - 
ba£day
));

150 i‡(
ba££c⁄d
 == 0) {

151 
ba££c⁄d
 = 
£c⁄d
;

153 
cuºít£c⁄d
 = 
£c⁄d
 - 
ba££c⁄d
;

154 
	}
}

157 
	$h∂_§t_öôülize_fûe
(
iŸø˚fûe
)

158 
FILE
 *
iŸø˚fûe
;

160 
Àâî
 = '0';

161 
löe
[201];

162 
löëy≥
[40];

165 i‡(
	`fgës
(
löe
, 200, 
iŸø˚fûe
Ë=
NULL
) {

166 
	`Ârötf
(
°dîr
, "No 'tracedate'Üine in HPLÅrace\n");

167 
	`exô
(1);

169 
	`ssˇnf
(
löe
, "%s", 
löëy≥
);

170 i‡(
	`°rcmp
(
löëy≥
, "tracedate") == 0) {

174 
	`io_h∂_§t_åa˚fûe_°¨t
(
löe
);

175 
Àâî
 != 0x0C) {

176 i‡(
	`fsˇnf
(
iŸø˚fûe
, "%c", &
Àâî
) != 1) {

177 
	`Ârötf
(
°dîr
, "End of header informationÇever found -Énd of file\n");

178 
	`exô
(1);

181 
	}
}

184 
	$åa˚_b©ch_öôülize
(
b©chfûe
, 
fûïå
, 
åa˚fûíame
)

185 
FILE
 *
b©chfûe
;

186 
FILE
 **
fûïå
;

187 *
åa˚fûíame
;

189 
comm™d«me
[200];

191 i‡((*
fûïå
Ë&& (
åa˚com¥ess
)) {

192 
	`•rötf
(
comm™d«me
, "com¥es†%†&", 
åa˚fûíame
);

193 
	`sy°em
(
comm™d«me
);

195 
	`f˛o£
(*
fûïå
);

196 i‡(
	`fsˇnf
(
b©chfûe
, "%s\n", 
åa˚fûíame
) != 1) {

199 i‡(
åa˚com¥ess
) {

200 
	`•rötf
(
comm™d«me
, "uncom¥es†%s", 
åa˚fûíame
);

201 
	`sy°em
(
comm™d«me
);

203 i‡((*
fûïå
 = 
	`f›í
(
åa˚fûíame
,"r")Ë=
NULL
) {

204 
	`Ârötf
(
°dîr
, "B©chedÅø˚fûê%†ˇ¬Ÿ bê›íed f‹Ñódác˚ss\n", 
åa˚fûíame
);

205 
	`exô
(1);

207 
	`h∂_§t_öôülize_fûe
(*
fûïå
);

209 
	}
}

212 
	$maö
(
¨gc
, 
¨gv
)

213 
¨gc
;

214 **
¨gv
;

216 
ªc‹d˙t
 = 0;

217 
ötch¨
 
doubÀw‹d
;

218 
ötch¨
 
c⁄vîãr
;

220 
	`as£π
 ((
ötch¨
) == 4);

221 i‡(
¨gc
 != 2) {

222 
	`Ârötf
(
°dîr
,"Ußge: %†b©chfûe\n", 
¨gv
[0]);

223 
	`exô
(1);

225 i‡((
iŸø˚b©ch
 = 
	`f›í
(
¨gv
[1],"r")Ë=
NULL
) {

226 
	`Ârötf
(
°dîr
,"%†ˇ¬Ÿ bê›íed f‹Ñódác˚ss\n", 
¨gv
[1]);

227 
	`exô
(1);

229 
åa˚f‹m©
 = 
HPL_SRT
;

230 
åa˚ídün
 = 
_BIG_ENDIAN
;

231 
åa˚b©ch
 = 
TRUE
;

232 
åa˚com¥ess
 = 
TRUE
;

233 
	`åa˚_b©ch_öôülize
(
iŸø˚b©ch
, &
iŸø˚fûe
, 
iŸø˚fûíame
)) {

234 
	`‰ód
(&
doubÀw‹d
.
vÆue
, (
öt32_t
), 1, 
iŸø˚fûe
) == 1) {

235 i‡((
ªc‹d˙t
 % 14) == 2) {

236 
c⁄vîãr
.
byã
[0] = 
doubÀw‹d
.byte[3];

237 
c⁄vîãr
.
byã
[1] = 
doubÀw‹d
.byte[2];

238 
c⁄vîãr
.
byã
[2] = 
doubÀw‹d
.byte[1];

239 
c⁄vîãr
.
byã
[3] = 
doubÀw‹d
.byte[0];

240 
doubÀw‹d
.
vÆue
 = 
cuºít£c⁄d
 + 
c⁄vîãr
.value;

241 
c⁄vîãr
.
byã
[0] = 
doubÀw‹d
.byte[3];

242 
c⁄vîãr
.
byã
[1] = 
doubÀw‹d
.byte[2];

243 
c⁄vîãr
.
byã
[2] = 
doubÀw‹d
.byte[1];

244 
c⁄vîãr
.
byã
[3] = 
doubÀw‹d
.byte[0];

245 
doubÀw‹d
.
vÆue
 = 
c⁄vîãr
.value;

247 
	`fwrôe
(&
doubÀw‹d
.
vÆue
, (), 1, 
°dout
);

248 
ªc‹d˙t
++;

250 i‡(
ªc‹d˙t
 % 14) {

251 
	`Ârötf
(
°dîr
, "P¨tü»ªc‹dáàíd o‡åa˚fûê- %d\n", (
ªc‹d˙t
 % 14));

252 
	`exô
(1);

256 
	`f˛o£
(
iŸø˚fûe
);

257 
	`f˛o£
(
iŸø˚b©ch
);

258 
	`exô
(0);

259 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/inline.h

34 #i‚de‡
_DISKSIM_INLINE_H


35 
	#_DISKSIM_INLINE_H


	)

37 #ifde‡
_INLINE


38 
	#INLINE
 
ölöe


	)

40 
	#INLINE


	)

	@/Users/ysoh/disksim-4.0-fcl/src/inst.h

32 #i‚de‡
_DISKSIM_INST_H


33 
	#_DISKSIM_INST_H


	)

35 
disksim_evt_cou¡î
;

37 
disksim_ö°
(
cou¡
, *
fmt
, ...);

39 #ifde‡
DISKSIM_INST


40 
	#disksim_ö°_íãr
() \

41 
	`disksim_ö°
(
disksim_evt_cou¡î
++, "íã∏%†(%s:%d)", 
__func__
, \

42 
__FILE__
, 
__LINE__
)

	)

44 
	#disksim_ö°_íãr
()

	)

	@/Users/ysoh/disksim-4.0-fcl/src/list.h

1 
	~"pois⁄.h
"

3 #i‚de‡
_LINUX_LIST_H


4 
	#_LINUX_LIST_H


	)

7 
	sli°_hód
 {

8 
li°_hód
 *
	m√xt
, *
	m¥ev
;

11 
	shli°_hód
 {

12 
hli°_node
 *
	mfú°
;

15 
	shli°_node
 {

16 
hli°_node
 *
	m√xt
, **
	mµªv
;

19 
	#¥e„tch


	)

30 
	#LIST_HEAD_INIT
(
«me
Ë{ &“ame), &“ameË}

	)

32 
	#LIST_HEAD
(
«me
) \

33 
li°_hód
 
«me
 = 
	`LIST_HEAD_INIT
“ame)

	)

35 
ölöe
 
	$INIT_LIST_HEAD
(
li°_hód
 *
li°
)

37 
li°
->
√xt
 =Üist;

38 
li°
->
¥ev
 =Üist;

39 
	}
}

47 #i‚de‡
CONFIG_DEBUG_LIST


48 
ölöe
 
	$__li°_add
(
li°_hód
 *
√w
,

49 
li°_hód
 *
¥ev
,

50 
li°_hód
 *
√xt
)

52 
√xt
->
¥ev
 = 
√w
;

53 
√w
->
√xt
 =Çext;

54 
√w
->
¥ev
 =Örev;

55 
¥ev
->
√xt
 = 
√w
;

56 
	}
}

58 
__li°_add
(
li°_hód
 *
√w
,

59 
li°_hód
 *
¥ev
,

60 
li°_hód
 *
√xt
);

71 
ölöe
 
	$li°_add
(
li°_hód
 *
√w
, li°_hód *
hód
)

73 
	`__li°_add
(
√w
, 
hód
, hód->
√xt
);

74 
	}
}

85 
ölöe
 
	$li°_add_èû
(
li°_hód
 *
√w
, li°_hód *
hód
)

87 
	`__li°_add
(
√w
, 
hód
->
¥ev
, head);

88 
	}
}

97 
ölöe
 
	$__li°_dñ
(
li°_hód
 * 
¥ev
, li°_hód * 
√xt
)

99 
√xt
->
¥ev
 =Örev;

100 
¥ev
->
√xt
 =Çext;

101 
	}
}

109 #i‚de‡
CONFIG_DEBUG_LIST


110 
ölöe
 
	$__li°_dñ_íåy
(
li°_hód
 *
íåy
)

112 
	`__li°_dñ
(
íåy
->
¥ev
,É¡ry->
√xt
);

113 
	}
}

115 
ölöe
 
	$li°_dñ
(
li°_hód
 *
íåy
)

117 
	`__li°_dñ
(
íåy
->
¥ev
,É¡ry->
√xt
);

118 
íåy
->
√xt
 = 
LIST_POISON1
;

119 
íåy
->
¥ev
 = 
LIST_POISON2
;

120 
	}
}

122 
__li°_dñ_íåy
(
li°_hód
 *
íåy
);

123 
li°_dñ
(
li°_hód
 *
íåy
);

133 
ölöe
 
	$li°_ª∂a˚
(
li°_hód
 *
ﬁd
,

134 
li°_hód
 *
√w
)

136 
√w
->
√xt
 = 
ﬁd
->next;

137 
√w
->
√xt
->
¥ev
 =Çew;

138 
√w
->
¥ev
 = 
ﬁd
->prev;

139 
√w
->
¥ev
->
√xt
 =Çew;

140 
	}
}

142 
ölöe
 
	$li°_ª∂a˚_öô
(
li°_hód
 *
ﬁd
,

143 
li°_hód
 *
√w
)

145 
	`li°_ª∂a˚
(
ﬁd
, 
√w
);

146 
	`INIT_LIST_HEAD
(
ﬁd
);

147 
	}
}

153 
ölöe
 
	$li°_dñ_öô
(
li°_hód
 *
íåy
)

155 
	`__li°_dñ_íåy
(
íåy
);

156 
	`INIT_LIST_HEAD
(
íåy
);

157 
	}
}

164 
ölöe
 
	$li°_move
(
li°_hód
 *
li°
, li°_hód *
hód
)

166 
	`__li°_dñ_íåy
(
li°
);

167 
	`li°_add
(
li°
, 
hód
);

168 
	}
}

175 
ölöe
 
	$li°_move_èû
(
li°_hód
 *
li°
,

176 
li°_hód
 *
hód
)

178 
	`__li°_dñ_íåy
(
li°
);

179 
	`li°_add_èû
(
li°
, 
hód
);

180 
	}
}

187 
ölöe
 
	$li°_is_œ°
(c⁄° 
li°_hód
 *
li°
,

188 c⁄° 
li°_hód
 *
hód
)

190  
li°
->
√xt
 =
hód
;

191 
	}
}

197 
ölöe
 
	$li°_em±y
(c⁄° 
li°_hód
 *
hód
)

199  
hód
->
√xt
 == head;

200 
	}
}

215 
ölöe
 
	$li°_em±y_ˇªful
(c⁄° 
li°_hód
 *
hód
)

217 
li°_hód
 *
√xt
 = 
hód
->next;

218  (
√xt
 =
hód
Ë&& (√xà=hód->
¥ev
);

219 
	}
}

225 
ölöe
 
	$li°_rŸ©e_À·
(
li°_hód
 *
hód
)

227 
li°_hód
 *
fú°
;

229 i‡(!
	`li°_em±y
(
hód
)) {

230 
fú°
 = 
hód
->
√xt
;

231 
	`li°_move_èû
(
fú°
, 
hód
);

233 
	}
}

239 
ölöe
 
	$li°_is_söguœr
(c⁄° 
li°_hód
 *
hód
)

241  !
	`li°_em±y
(
hód
Ë&& (hód->
√xt
 =hód->
¥ev
);

242 
	}
}

244 
ölöe
 
	$__li°_cut_posôi⁄
(
li°_hód
 *
li°
,

245 
li°_hód
 *
hód
, li°_hód *
íåy
)

247 
li°_hód
 *
√w_fú°
 = 
íåy
->
√xt
;

248 
li°
->
√xt
 = 
hód
->next;

249 
li°
->
√xt
->
¥ev
 =Üist;

250 
li°
->
¥ev
 = 
íåy
;

251 
íåy
->
√xt
 = 
li°
;

252 
hód
->
√xt
 = 
√w_fú°
;

253 
√w_fú°
->
¥ev
 = 
hód
;

254 
	}
}

270 
ölöe
 
	$li°_cut_posôi⁄
(
li°_hód
 *
li°
,

271 
li°_hód
 *
hód
, li°_hód *
íåy
)

273 i‡(
	`li°_em±y
(
hód
))

275 i‡(
	`li°_is_söguœr
(
hód
) &&

276 (
hód
->
√xt
 !
íåy
 && head !=Éntry))

278 i‡(
íåy
 =
hód
)

279 
	`INIT_LIST_HEAD
(
li°
);

281 
	`__li°_cut_posôi⁄
(
li°
, 
hód
, 
íåy
);

282 
	}
}

284 
ölöe
 
	$__li°_•li˚
(c⁄° 
li°_hód
 *
li°
,

285 
li°_hód
 *
¥ev
,

286 
li°_hód
 *
√xt
)

288 
li°_hód
 *
fú°
 = 
li°
->
√xt
;

289 
li°_hód
 *
œ°
 = 
li°
->
¥ev
;

291 
fú°
->
¥ev
 =Örev;

292 
¥ev
->
√xt
 = 
fú°
;

294 
œ°
->
√xt
 =Çext;

295 
√xt
->
¥ev
 = 
œ°
;

296 
	}
}

303 
ölöe
 
	$li°_•li˚
(c⁄° 
li°_hód
 *
li°
,

304 
li°_hód
 *
hód
)

306 i‡(!
	`li°_em±y
(
li°
))

307 
	`__li°_•li˚
(
li°
, 
hód
, hód->
√xt
);

308 
	}
}

315 
ölöe
 
	$li°_•li˚_èû
(
li°_hód
 *
li°
,

316 
li°_hód
 *
hód
)

318 i‡(!
	`li°_em±y
(
li°
))

319 
	`__li°_•li˚
(
li°
, 
hód
->
¥ev
, head);

320 
	}
}

329 
ölöe
 
	$li°_•li˚_öô
(
li°_hód
 *
li°
,

330 
li°_hód
 *
hód
)

332 i‡(!
	`li°_em±y
(
li°
)) {

333 
	`__li°_•li˚
(
li°
, 
hód
, hód->
√xt
);

334 
	`INIT_LIST_HEAD
(
li°
);

336 
	}
}

346 
ölöe
 
	$li°_•li˚_èû_öô
(
li°_hód
 *
li°
,

347 
li°_hód
 *
hód
)

349 i‡(!
	`li°_em±y
(
li°
)) {

350 
	`__li°_•li˚
(
li°
, 
hód
->
¥ev
, head);

351 
	`INIT_LIST_HEAD
(
li°
);

353 
	}
}

354 
	#c⁄èöî_of
(
±r
, 
ty≥
, 
membî
) \

355 ((
ty≥
 *)((*)(
±r
)-()(&(—y≥ *)0)->
membî
)))

	)

363 
	#li°_íåy
(
±r
, 
ty≥
, 
membî
) \

364 
	`c⁄èöî_of
(
±r
, 
ty≥
, 
membî
)

	)

374 
	#li°_fú°_íåy
(
±r
, 
ty≥
, 
membî
) \

375 
	`li°_íåy
((
±r
)->
√xt
, 
ty≥
, 
membî
)

	)

383 
	#li°_f‹_óch
(
pos
, 
hód
) \

384 
pos
 = (
hód
)->
√xt
; 
	`¥e„tch
(pos->next),Öos != (head); \

385 
pos
 =Öos->
√xt
)

	)

387 
	#li°_f‹_óch
(
pos
, 
hód
) \

388 
pos
 = (
hód
)->
√xt
;Öos != (head); \

389 
pos
 =Öos->
√xt
)

	)

401 
	#__li°_f‹_óch
(
pos
, 
hód
) \

402 
pos
 = (
hód
)->
√xt
;Öo†!(hód);Öo†pos->√xt)

	)

409 
	#li°_f‹_óch_¥ev
(
pos
, 
hód
) \

410 
pos
 = (
hód
)->
¥ev
; 
	`¥e„tch
(pos->prev),Öos != (head); \

411 
pos
 =Öos->
¥ev
)

	)

419 
	#li°_f‹_óch_ß„
(
pos
, 
n
, 
hód
) \

420 
pos
 = (
hód
)->
√xt
, 
n
 =Öos->next;Öos != (head); \

421 
pos
 = 
n
,Ç =Öos->
√xt
)

	)

429 
	#li°_f‹_óch_¥ev_ß„
(
pos
, 
n
, 
hód
) \

430 
pos
 = (
hód
)->
¥ev
, 
n
 =Öos->prev; \

431 
	`¥e„tch
(
pos
->
¥ev
),Öo†!(
hód
); \

432 
pos
 = 
n
,Ç =Öos->
¥ev
)

	)

440 
	#li°_f‹_óch_íåy
(
pos
, 
hód
, 
membî
) \

441 
pos
 = 
	`li°_íåy
((
hód
)->
√xt
, 
	`ty≥of
(*pos), 
membî
); \

442 &
pos
->
membî
 !(
hód
); \

443 
pos
 = 
	`li°_íåy
’os->
membî
.
√xt
, 
	`ty≥of
(*pos), membî))

	)

451 
	#li°_f‹_óch_íåy_ªvî£
(
pos
, 
hód
, 
membî
) \

452 
pos
 = 
	`li°_íåy
((
hód
)->
¥ev
, 
	`ty≥of
(*pos), 
membî
); \

453 
	`¥e„tch
(
pos
->
membî
.
¥ev
), &pos->membî !(
hód
); \

454 
pos
 = 
	`li°_íåy
’os->
membî
.
¥ev
, 
	`ty≥of
(*pos), membî))

	)

464 
	#li°_¥ï¨e_íåy
(
pos
, 
hód
, 
membî
) \

465 ((
pos
Ë? : 
	`li°_íåy
(
hód
, 
	`ty≥of
(*pos), 
membî
))

	)

476 
	#li°_f‹_óch_íåy_c⁄töue
(
pos
, 
hód
, 
membî
) \

477 
pos
 = 
	`li°_íåy
’os->
membî
.
√xt
, 
	`ty≥of
(*pos), member); \

478 
	`¥e„tch
(
pos
->
membî
.
√xt
), &pos->membî !(
hód
); \

479 
pos
 = 
	`li°_íåy
’os->
membî
.
√xt
, 
	`ty≥of
(*pos), membî))

	)

490 
	#li°_f‹_óch_íåy_c⁄töue_ªvî£
(
pos
, 
hód
, 
membî
) \

491 
pos
 = 
	`li°_íåy
’os->
membî
.
¥ev
, 
	`ty≥of
(*pos), member); \

492 
	`¥e„tch
(
pos
->
membî
.
¥ev
), &pos->membî !(
hód
); \

493 
pos
 = 
	`li°_íåy
’os->
membî
.
¥ev
, 
	`ty≥of
(*pos), membî))

	)

503 
	#li°_f‹_óch_íåy_‰om
(
pos
, 
hód
, 
membî
) \

504 ; 
	`¥e„tch
(
pos
->
membî
.
√xt
), &pos->membî !(
hód
); \

505 
pos
 = 
	`li°_íåy
’os->
membî
.
√xt
, 
	`ty≥of
(*pos), membî))

	)

514 
	#li°_f‹_óch_íåy_ß„
(
pos
, 
n
, 
hód
, 
membî
) \

515 
pos
 = 
	`li°_íåy
((
hód
)->
√xt
, 
	`ty≥of
(*pos), 
membî
), \

516 
n
 = 
	`li°_íåy
(
pos
->
membî
.
√xt
, 
	`ty≥of
(*pos), member); \

517 &
pos
->
membî
 !(
hód
); \

518 
pos
 = 
n
,Ç = 
	`li°_íåy
“->
membî
.
√xt
, 
	`ty≥of
(*n), membî))

	)

530 
	#li°_f‹_óch_íåy_ß„_c⁄töue
(
pos
, 
n
, 
hód
, 
membî
) \

531 
pos
 = 
	`li°_íåy
’os->
membî
.
√xt
, 
	`ty≥of
(*pos), member), \

532 
n
 = 
	`li°_íåy
(
pos
->
membî
.
√xt
, 
	`ty≥of
(*pos), member); \

533 &
pos
->
membî
 !(
hód
); \

534 
pos
 = 
n
,Ç = 
	`li°_íåy
“->
membî
.
√xt
, 
	`ty≥of
(*n), membî))

	)

546 
	#li°_f‹_óch_íåy_ß„_‰om
(
pos
, 
n
, 
hód
, 
membî
) \

547 
n
 = 
	`li°_íåy
(
pos
->
membî
.
√xt
, 
	`ty≥of
(*pos), member); \

548 &
pos
->
membî
 !(
hód
); \

549 
pos
 = 
n
,Ç = 
	`li°_íåy
“->
membî
.
√xt
, 
	`ty≥of
(*n), membî))

	)

561 
	#li°_f‹_óch_íåy_ß„_ªvî£
(
pos
, 
n
, 
hód
, 
membî
) \

562 
pos
 = 
	`li°_íåy
((
hód
)->
¥ev
, 
	`ty≥of
(*pos), 
membî
), \

563 
n
 = 
	`li°_íåy
(
pos
->
membî
.
¥ev
, 
	`ty≥of
(*pos), member); \

564 &
pos
->
membî
 !(
hód
); \

565 
pos
 = 
n
,Ç = 
	`li°_íåy
“->
membî
.
¥ev
, 
	`ty≥of
(*n), membî))

	)

579 
	#li°_ß„_ª£t_√xt
(
pos
, 
n
, 
membî
) \

580 
n
 = 
	`li°_íåy
(
pos
->
membî
.
√xt
, 
	`ty≥of
(*pos), membî)

	)

589 
	#HLIST_HEAD_INIT
 { .
fú°
 = 
NULL
 }

	)

590 
	#HLIST_HEAD
(
«me
Ë
hli°_hód
Çamê{ .
fú°
 = 
NULL
 }

	)

591 
	#INIT_HLIST_HEAD
(
±r
Ë(’å)->
fú°
 = 
NULL
)

	)

592 
ölöe
 
	$INIT_HLIST_NODE
(
hli°_node
 *
h
)

594 
h
->
√xt
 = 
NULL
;

595 
h
->
µªv
 = 
NULL
;

596 
	}
}

598 
ölöe
 
	$hli°_unhashed
(c⁄° 
hli°_node
 *
h
)

600  !
h
->
µªv
;

601 
	}
}

603 
ölöe
 
	$hli°_em±y
(c⁄° 
hli°_hód
 *
h
)

605  !
h
->
fú°
;

606 
	}
}

608 
ölöe
 
	$__hli°_dñ
(
hli°_node
 *
n
)

610 
hli°_node
 *
√xt
 = 
n
->next;

611 
hli°_node
 **
µªv
 = 
n
->pprev;

612 *
µªv
 = 
√xt
;

613 i‡(
√xt
)

614 
√xt
->
µªv
 =Öprev;

615 
	}
}

617 
ölöe
 
	$hli°_dñ
(
hli°_node
 *
n
)

619 
	`__hli°_dñ
(
n
);

620 
n
->
√xt
 = 
LIST_POISON1
;

621 
n
->
µªv
 = 
LIST_POISON2
;

622 
	}
}

624 
ölöe
 
	$hli°_dñ_öô
(
hli°_node
 *
n
)

626 i‡(!
	`hli°_unhashed
(
n
)) {

627 
	`__hli°_dñ
(
n
);

628 
	`INIT_HLIST_NODE
(
n
);

630 
	}
}

632 
ölöe
 
	$hli°_add_hód
(
hli°_node
 *
n
, 
hli°_hód
 *
h
)

634 
hli°_node
 *
fú°
 = 
h
->first;

635 
n
->
√xt
 = 
fú°
;

636 i‡(
fú°
)

637 
fú°
->
µªv
 = &
n
->
√xt
;

638 
h
->
fú°
 = 
n
;

639 
n
->
µªv
 = &
h
->
fú°
;

640 
	}
}

643 
ölöe
 
	$hli°_add_bef‹e
(
hli°_node
 *
n
,

644 
hli°_node
 *
√xt
)

646 
n
->
µªv
 = 
√xt
->pprev;

647 
n
->
√xt
 =Çext;

648 
√xt
->
µªv
 = &
n
->next;

649 *(
n
->
µªv
) =Ç;

650 
	}
}

652 
ölöe
 
	$hli°_add_a·î
(
hli°_node
 *
n
,

653 
hli°_node
 *
√xt
)

655 
√xt
->√xà
n
->next;

656 
n
->
√xt
 =Çext;

657 
√xt
->
µªv
 = &
n
->next;

659 if(
√xt
->next)

660 
√xt
->√xt->
µªv
 = &next->next;

661 
	}
}

664 
ölöe
 
	$hli°_add_Áke
(
hli°_node
 *
n
)

666 
n
->
µªv
 = &n->
√xt
;

667 
	}
}

673 
ölöe
 
	$hli°_move_li°
(
hli°_hód
 *
ﬁd
,

674 
hli°_hód
 *
√w
)

676 
√w
->
fú°
 = 
ﬁd
->first;

677 i‡(
√w
->
fú°
)

678 
√w
->
fú°
->
µªv
 = &new->first;

679 
ﬁd
->
fú°
 = 
NULL
;

680 
	}
}

682 
	#hli°_íåy
(
±r
, 
ty≥
, 
membî
Ë
	`c⁄èöî_of
’å,ty≥,membî)

	)

684 
	#hli°_f‹_óch
(
pos
, 
hód
) \

685 
pos
 = (
hód
)->
fú°
;Öo†&& ({ 
	`¥e„tch
’os->
√xt
); 1; }); \

686 
pos
 =Öos->
√xt
)

	)

688 
	#hli°_f‹_óch_ß„
(
pos
, 
n
, 
hód
) \

689 
pos
 = (
hód
)->
fú°
;Öo†&& ({ 
n
 =Öos->
√xt
; 1; }); \

690 
pos
 = 
n
)

	)

699 
	#hli°_f‹_óch_íåy
(
ços
, 
pos
, 
hód
, 
membî
) \

700 
pos
 = (
hód
)->
fú°
; \

701 
pos
 && ({ 
	`¥e„tch
’os->
√xt
); 1;}) && \

702 ({ 
ços
 = 
	`hli°_íåy
(
pos
, 
	`ty≥of
(*ços), 
membî
); 1;}); \

703 
pos
 =Öos->
√xt
)

	)

711 
	#hli°_f‹_óch_íåy_c⁄töue
(
ços
, 
pos
, 
membî
) \

712 
pos
 = (pos)->
√xt
; \

713 
pos
 && ({ 
	`¥e„tch
’os->
√xt
); 1;}) && \

714 ({ 
ços
 = 
	`hli°_íåy
(
pos
, 
	`ty≥of
(*ços), 
membî
); 1;}); \

715 
pos
 =Öos->
√xt
)

	)

723 
	#hli°_f‹_óch_íåy_‰om
(
ços
, 
pos
, 
membî
) \

724 ; 
pos
 && ({ 
	`¥e„tch
’os->
√xt
); 1;}) && \

725 ({ 
ços
 = 
	`hli°_íåy
(
pos
, 
	`ty≥of
(*ços), 
membî
); 1;}); \

726 
pos
 =Öos->
√xt
)

	)

736 
	#hli°_f‹_óch_íåy_ß„
(
ços
, 
pos
, 
n
, 
hód
, 
membî
) \

737 
pos
 = (
hód
)->
fú°
; \

738 
pos
 && ({ 
n
 =Öos->
√xt
; 1; }) && \

739 ({ 
ços
 = 
	`hli°_íåy
(
pos
, 
	`ty≥of
(*ços), 
membî
); 1;}); \

740 
pos
 = 
n
)

	)

	@/Users/ysoh/disksim-4.0-fcl/src/lru_test.c

1 
	~<°dio.h
>

2 
	~"li°.h
"

3 
	~"disksim_f˛_ˇche.h
"

5 
	$maö
(){

6 
ˇche_m™agî
 *
Ãu_m™agî
;

7 
i
;

9 
	`Ãu_öô
(&
Ãu_m™agî
,"LRU", 500, 500, 1, 0);

11 
i
 =0;i < 1000000;i++){

12 
Ãu_node
 *
 
 = 
NULL
;

13 
blkno
 = 
	`RND
(10000);

15 
 
 = 
	`CACHE_SEARCH
(
Ãu_m™agî
, 
blkno
);

16 if(!
 
){

18 
 
 = 
	`CACHE_REPLACE
(
Ãu_m™agî
, 0);

19 
 
 = 
	`CACHE_ALLOC
(
Ãu_m™agî
,Ün, 
blkno
);

20 
	`CACHE_INSERT
(
Ãu_m™agî
, 
 
);

22 
 
 = 
	`CACHE_REMOVE
(
Ãu_m™agî
,Ün);

23 
	`CACHE_INSERT
(
Ãu_m™agî
, 
 
);

27 
	`CACHE_CLOSE
(
Ãu_m™agî
, 1);

30 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_bus_param.c

1 
	~"disksim_bus_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_bus.h
"

5 
	$DISKSIM_BUS_TYPE_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_BUS_TYPE_lﬂdî
(
bus
 * 
ªsu…
, 
i
)

13 i‡(!(
	`RANGE
(
i
, 1, 2))) {

16 
ªsu…
->
ty≥
 = 
i
;

18 
	}
}

21 
	$DISKSIM_BUS_ARBITRATION_TYPE_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_BUS_ARBITRATION_TYPE_lﬂdî
(
bus
 * 
ªsu…
, 
i
)

29 i‡(!(
	`RANGE
(
i
, 1, 2))) {

32 
ªsu…
->
¨bty≥
 = 
i
;

34 
	}
}

37 
	$DISKSIM_BUS_ARBITRATION_TIME_dïíd
(*
bv
)

40 
	}
}

43 
	$DISKSIM_BUS_ARBITRATION_TIME_lﬂdî
(
bus
 * 
ªsu…
, 
d
)

45 i‡(!((
d
 >= 0.0))) {

48 
ªsu…
->
¨btime
 = 
d
;

50 
	}
}

53 
	$DISKSIM_BUS_READ_BLOCK_TRANSFER_TIME_dïíd
(*
bv
)

56 
	}
}

59 
	$DISKSIM_BUS_READ_BLOCK_TRANSFER_TIME_lﬂdî
(
bus
 * 
ªsu…
, 
d
)

61 i‡(!((
d
 >= 0.0))) {

64 
ªsu…
->
ªadblkå™°ime
 = 
d
;

66 
	}
}

69 
	$DISKSIM_BUS_WRITE_BLOCK_TRANSFER_TIME_dïíd
(*
bv
)

72 
	}
}

75 
	$DISKSIM_BUS_WRITE_BLOCK_TRANSFER_TIME_lﬂdî
(
bus
 * 
ªsu…
, 
d
)

77 i‡(!((
d
 >= 0.0))) {

80 
ªsu…
->
wrôeblkå™°ime
 = 
d
;

82 
	}
}

85 
	$DISKSIM_BUS_PRINT_STATS_dïíd
(*
bv
)

88 
	}
}

91 
	$DISKSIM_BUS_PRINT_STATS_lﬂdî
(
bus
 * 
ªsu…
, 
i
)

93 
ªsu…
->
¥öt°©s
 = 
i
;

95 
	}
}

97 *
	gDISKSIM_BUS_lﬂdîs
[] = {

98 (*Ë
DISKSIM_BUS_TYPE_lﬂdî
,

99 (*Ë
DISKSIM_BUS_ARBITRATION_TYPE_lﬂdî
,

100 (*Ë
DISKSIM_BUS_ARBITRATION_TIME_lﬂdî
,

101 (*Ë
DISKSIM_BUS_READ_BLOCK_TRANSFER_TIME_lﬂdî
,

102 (*Ë
DISKSIM_BUS_WRITE_BLOCK_TRANSFER_TIME_lﬂdî
,

103 (*Ë
DISKSIM_BUS_PRINT_STATS_lﬂdî


106 
Õ_∑ømdï_t
 
	gDISKSIM_BUS_dïs
[] = {

107 
DISKSIM_BUS_TYPE_dïíd
,

108 
DISKSIM_BUS_ARBITRATION_TYPE_dïíd
,

109 
DISKSIM_BUS_ARBITRATION_TIME_dïíd
,

110 
DISKSIM_BUS_READ_BLOCK_TRANSFER_TIME_dïíd
,

111 
DISKSIM_BUS_WRITE_BLOCK_TRANSFER_TIME_dïíd
,

112 
DISKSIM_BUS_PRINT_STATS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_bus_param.h

2 #i‚de‡
_DISKSIM_BUS_PARAM_H


3 
	#_DISKSIM_BUS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
bus
 *
disksim_bus_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
DISKSIM_BUS_TYPE
,

16 
DISKSIM_BUS_ARBITRATION_TYPE
,

17 
DISKSIM_BUS_ARBITRATION_TIME
,

18 
DISKSIM_BUS_READ_BLOCK_TRANSFER_TIME
,

19 
DISKSIM_BUS_WRITE_BLOCK_TRANSFER_TIME
,

20 
DISKSIM_BUS_PRINT_STATS


21 } 
	tdisksim_bus_∑øm_t
;

23 
	#DISKSIM_BUS_MAX_PARAM
 
DISKSIM_BUS_PRINT_STATS


	)

24 * 
DISKSIM_BUS_lﬂdîs
[];

25 
Õ_∑ømdï_t
 
DISKSIM_BUS_dïs
[];

28 
Õ_v¨•ec
 
	gdisksim_bus_∑øms
 [] = {

29 {"ty≥", 
I
, 1 },

30 {"Arbôøti⁄Åy≥", 
I
, 1 },

31 {"Arbôøti⁄Åime", 
D
, 1 },

32 {"Ród blockÅøns„∏time", 
D
, 1 },

33 {"WrôêblockÅøns„∏time", 
D
, 1 },

34 {"Pröà°©s", 
I
, 1 },

37 
	#DISKSIM_BUS_MAX
 6

	)

38 
Õ_mod
 
	gdisksim_bus_mod
 = { "disksim_bus", 
disksim_bus_∑øms
, 
DISKSIM_BUS_MAX
, (
Õ_modlﬂdî_t
)
disksim_bus_lﬂd∑øms
, 0, 0, 
DISKSIM_BUS_lﬂdîs
, 
DISKSIM_BUS_dïs
 };

41 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_bus_stats_param.c

1 
	~"disksim_bus_°©s_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"disksim_bus.h
"

5 
	$DISKSIM_BUS_STATS_PRINT_BUS_IDLE_STATS_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_BUS_STATS_PRINT_BUS_IDLE_STATS_lﬂdî
(
ªsu…
, 
i
)

13 i‡(!(
	`RANGE
(
i
, 0, 1))) {

16 
disksim
->
busöfo
->
bus_¥ötidÀ°©s
 = 
i
;

18 
	}
}

21 
	$DISKSIM_BUS_STATS_PRINT_BUS_ARBWAIT_STATS_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_BUS_STATS_PRINT_BUS_ARBWAIT_STATS_lﬂdî
(
ªsu…
, 
i
)

29 i‡(!(
	`RANGE
(
i
, 0, 1))) {

32 
disksim
->
busöfo
->
bus_¥öèrbwaô°©s
 = 
i
;

34 
	}
}

36 *
	gDISKSIM_BUS_STATS_lﬂdîs
[] = {

37 (*Ë
DISKSIM_BUS_STATS_PRINT_BUS_IDLE_STATS_lﬂdî
,

38 (*Ë
DISKSIM_BUS_STATS_PRINT_BUS_ARBWAIT_STATS_lﬂdî


41 
Õ_∑ømdï_t
 
	gDISKSIM_BUS_STATS_dïs
[] = {

42 
DISKSIM_BUS_STATS_PRINT_BUS_IDLE_STATS_dïíd
,

43 
DISKSIM_BUS_STATS_PRINT_BUS_ARBWAIT_STATS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_bus_stats_param.h

2 #i‚de‡
_DISKSIM_BUS_STATS_PARAM_H


3 
	#_DISKSIM_BUS_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_bus_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_BUS_STATS_PRINT_BUS_IDLE_STATS
,

16 
DISKSIM_BUS_STATS_PRINT_BUS_ARBWAIT_STATS


17 } 
	tdisksim_bus_°©s_∑øm_t
;

19 
	#DISKSIM_BUS_STATS_MAX_PARAM
 
DISKSIM_BUS_STATS_PRINT_BUS_ARBWAIT_STATS


	)

20 * 
DISKSIM_BUS_STATS_lﬂdîs
[];

21 
Õ_∑ømdï_t
 
DISKSIM_BUS_STATS_dïs
[];

24 
Õ_v¨•ec
 
	gdisksim_bus_°©s_∑øms
 [] = {

25 {"Pröàbu†idÀ sèts", 
I
, 1 },

26 {"Pröàbu†¨bwaô sèts", 
I
, 1 },

29 
	#DISKSIM_BUS_STATS_MAX
 2

	)

30 
Õ_mod
 
	gdisksim_bus_°©s_mod
 = { "disksim_bus_°©s", 
disksim_bus_°©s_∑øms
, 
DISKSIM_BUS_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_bus_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_BUS_STATS_lﬂdîs
, 
DISKSIM_BUS_STATS_dïs
 };

33 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_cachedev_param.c

1 
	~"disksim_ˇchedev_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"disksim_ˇchedev.h
"

5 
	$DISKSIM_CACHEDEV_CACHE_SIZE_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_CACHEDEV_CACHE_SIZE_lﬂdî
(
ˇche_dev
 * 
ªsu…
, 
i
)

13 i‡(!(
i
 >= 0)) {

16 i‡(
ªsu…
->
vÆidm≠
 ||Ñesu…->
dútym≠
) {

17 
	`Ârötf
(
°dîr
, "*** ignoringÑepeat cache size definition.\n");

19 
ªsu…
->
size
 = 
i
;

20 
ªsu…
->
vÆidm≠
 = (
bô°r_t
 *Ë
	`DISKSIM_mÆloc
(
	`bô°r_size
‘esu…->
size
));

21 
ªsu…
->
dútym≠
 = (
bô°r_t
 *Ë
	`DISKSIM_mÆloc
(
	`bô°r_size
‘esu…->
size
));

22 
	`ASSERT
((
ªsu…
->
vÆidm≠
 !
NULL
Ë&& (ªsu…->
dútym≠
 != NULL));

25 
	}
}

28 
	$DISKSIM_CACHEDEV_MAX_REQUEST_SIZE_dïíd
(*
bv
)

31 
	}
}

34 
	$DISKSIM_CACHEDEV_MAX_REQUEST_SIZE_lﬂdî
(
ˇche_dev
 * 
ªsu…
, 
i
)

36 i‡(!(
i
 >= 0)) {

39 
ªsu…
->
maxªqsize
 = 
i
;

41 
	}
}

44 
	$DISKSIM_CACHEDEV_WRITE_SCHEME_dïíd
(*
bv
)

47 
	}
}

50 
	$DISKSIM_CACHEDEV_WRITE_SCHEME_lﬂdî
(
ˇche_dev
 * 
ªsu…
, 
i
)

52 i‡(!(
	`RANGE
(
i
, 
CACHE_WRITE_MIN
, 
CACHE_WRITE_MAX
))) {

55 
ªsu…
->
wrôescheme
 = 
i
;

57 
	}
}

60 
	$DISKSIM_CACHEDEV_FLUSH_POLICY_dïíd
(*
bv
)

63 
	}
}

66 
	$DISKSIM_CACHEDEV_FLUSH_POLICY_lﬂdî
(
ˇche_dev
 * 
ªsu…
, 
i
)

68 i‡(!(
	`RANGE
(
i
, 
CACHE_FLUSH_MIN
, 
CACHE_FLUSH_MAX
))) {

71 
ªsu…
->
Êush_pﬁicy
 = 
i
;

73 
	}
}

76 
	$DISKSIM_CACHEDEV_FLUSH_PERIOD_dïíd
(*
bv
)

79 
	}
}

82 
	$DISKSIM_CACHEDEV_FLUSH_PERIOD_lﬂdî
(
ˇche_dev
 * 
ªsu…
, 
d
)

84 i‡(!(
d
 >= 0)) {

87 
ªsu…
->
Êush_≥riod
 = 
d
;

89 
	}
}

92 
	$DISKSIM_CACHEDEV_FLUSH_IDLE_DELAY_dïíd
(*
bv
)

95 
	}
}

98 
	$DISKSIM_CACHEDEV_FLUSH_IDLE_DELAY_lﬂdî
(
ˇche_dev
 * 
ªsu…
, 
d
)

100 i‡(!((
d
 >= 0) || (d == -1.0))) {

103 
ªsu…
->
Êush_idÀdñay
 = 
d
;

105 
	}
}

108 
	$DISKSIM_CACHEDEV_CACHE_DEVICE_dïíd
(*
bv
)

111 
	}
}

114 
	$DISKSIM_CACHEDEV_CACHE_DEVICE_lﬂdî
(
ˇche_dev
 * 
ªsu…
, *
s
)

116 i‡(!(
	`gëdevby«me
(
s
, &
ªsu…
->
ˇche_devno
, 0, 0))) {

119 
	}
}

122 
	$DISKSIM_CACHEDEV_CACHED_DEVICE_dïíd
(*
bv
)

125 
	}
}

128 
	$DISKSIM_CACHEDEV_CACHED_DEVICE_lﬂdî
(
ˇche_dev
 * 
ªsu…
, *
s
)

130 i‡(!(
	`gëdevby«me
(
s
, &
ªsu…
->
ªÆ_devno
, 0, 0))) {

133 
	}
}

135 *
	gDISKSIM_CACHEDEV_lﬂdîs
[] = {

136 (*Ë
DISKSIM_CACHEDEV_CACHE_SIZE_lﬂdî
,

137 (*Ë
DISKSIM_CACHEDEV_MAX_REQUEST_SIZE_lﬂdî
,

138 (*Ë
DISKSIM_CACHEDEV_WRITE_SCHEME_lﬂdî
,

139 (*Ë
DISKSIM_CACHEDEV_FLUSH_POLICY_lﬂdî
,

140 (*Ë
DISKSIM_CACHEDEV_FLUSH_PERIOD_lﬂdî
,

141 (*Ë
DISKSIM_CACHEDEV_FLUSH_IDLE_DELAY_lﬂdî
,

142 (*Ë
DISKSIM_CACHEDEV_CACHE_DEVICE_lﬂdî
,

143 (*Ë
DISKSIM_CACHEDEV_CACHED_DEVICE_lﬂdî


146 
Õ_∑ømdï_t
 
	gDISKSIM_CACHEDEV_dïs
[] = {

147 
DISKSIM_CACHEDEV_CACHE_SIZE_dïíd
,

148 
DISKSIM_CACHEDEV_MAX_REQUEST_SIZE_dïíd
,

149 
DISKSIM_CACHEDEV_WRITE_SCHEME_dïíd
,

150 
DISKSIM_CACHEDEV_FLUSH_POLICY_dïíd
,

151 
DISKSIM_CACHEDEV_FLUSH_PERIOD_dïíd
,

152 
DISKSIM_CACHEDEV_FLUSH_IDLE_DELAY_dïíd
,

153 
DISKSIM_CACHEDEV_CACHE_DEVICE_dïíd
,

154 
DISKSIM_CACHEDEV_CACHED_DEVICE_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_cachedev_param.h

2 #i‚de‡
_DISKSIM_CACHEDEV_PARAM_H


3 
	#_DISKSIM_CACHEDEV_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
ˇche_if
 *
disksim_ˇchedev_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_CACHEDEV_CACHE_SIZE
,

16 
DISKSIM_CACHEDEV_MAX_REQUEST_SIZE
,

17 
DISKSIM_CACHEDEV_WRITE_SCHEME
,

18 
DISKSIM_CACHEDEV_FLUSH_POLICY
,

19 
DISKSIM_CACHEDEV_FLUSH_PERIOD
,

20 
DISKSIM_CACHEDEV_FLUSH_IDLE_DELAY
,

21 
DISKSIM_CACHEDEV_CACHE_DEVICE
,

22 
DISKSIM_CACHEDEV_CACHED_DEVICE


23 } 
	tdisksim_ˇchedev_∑øm_t
;

25 
	#DISKSIM_CACHEDEV_MAX_PARAM
 
DISKSIM_CACHEDEV_CACHED_DEVICE


	)

26 * 
DISKSIM_CACHEDEV_lﬂdîs
[];

27 
Õ_∑ømdï_t
 
DISKSIM_CACHEDEV_dïs
[];

30 
Õ_v¨•ec
 
	gdisksim_ˇchedev_∑øms
 [] = {

31 {"Cachêsize", 
I
, 1 },

32 {"MaxÑeque° size", 
I
, 1 },

33 {"Wrôêscheme", 
I
, 1 },

34 {"FlushÖﬁicy", 
I
, 1 },

35 {"FlushÖîiod", 
D
, 1 },

36 {"Flush idÀ dñay", 
D
, 1 },

37 {"Cachêdevi˚", 
S
, 1 },

38 {"Cached devi˚", 
S
, 1 },

41 
	#DISKSIM_CACHEDEV_MAX
 8

	)

42 
Õ_mod
 
	gdisksim_ˇchedev_mod
 = { "disksim_ˇchedev", 
disksim_ˇchedev_∑øms
, 
DISKSIM_CACHEDEV_MAX
, (
Õ_modlﬂdî_t
)
disksim_ˇchedev_lﬂd∑øms
, 0, 0, 
DISKSIM_CACHEDEV_lﬂdîs
, 
DISKSIM_CACHEDEV_dïs
 };

45 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_cachemem_param.c

1 
	~"disksim_ˇchemem_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"disksim_ˇchemem.h
"

5 
	$DISKSIM_CACHEMEM_CACHE_SIZE_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_CACHEMEM_CACHE_SIZE_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

13 i‡(!(
i
 >= 0)) {

16 i‡(
ªsu…
->
m≠
) {

17 
	`Ârötf
(
°dîr
, "*** ignoringÑepeat cache size definition.\n");

19 
c2
;

20 
ªsu…
->
size
 = 
i
;

21 
ªsu…
->
m≠mask
 = 0;

22 
ªsu…
->
m≠
 = 
	`DISKSIM_mÆloc
(‘esu…->
m≠mask
 + 1Ë* (
ˇche_m≠íåy
));

23 
ªsu…
->
m≠
[0].
‰ìli°
 = 
NULL
;

24 
c2
 = 0; c2 < 
CACHE_MAXSEGMENTS
; c2++) {

25 
ªsu…
->
m≠
[0].
maxa˘ive
[
c2
] =Ñesu…->
size
;

26 
ªsu…
->
m≠
[0].
Ãu
[
c2
] = 
NULL
;

30 
	}
}

33 
	$DISKSIM_CACHEMEM_SLRU_SEGMENTS_dïíd
(*
bv
)

36 
	}
}

39 
	$DISKSIM_CACHEMEM_SLRU_SEGMENTS_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
Õ_li°
 * 
l
)

41 
	`ˇchemem_£tup_£gs
(
ªsu…
, 
l
);

43 
	}
}

46 
	$DISKSIM_CACHEMEM_LINE_SIZE_dïíd
(*
bv
)

49 
	}
}

52 
	$DISKSIM_CACHEMEM_LINE_SIZE_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

54 i‡(!(
i
 >= 0)) {

57 
ªsu…
->
löesize
 = 
i
;

59 
	}
}

62 
	$DISKSIM_CACHEMEM_BIT_GRANULARITY_dïíd
(*
bv
)

65 
	}
}

68 
	$DISKSIM_CACHEMEM_BIT_GRANULARITY_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

70 i‡(!(
i
 > 0)) {

73 
ªsu…
->
©om•îbô
 = 
i
;

75 
	}
}

78 
	$DISKSIM_CACHEMEM_LOCK_GRANULARITY_dïíd
(*
bv
)

81 
	}
}

84 
	$DISKSIM_CACHEMEM_LOCK_GRANULARITY_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

86 i‡(!(
i
 > 0)) {

89 
ªsu…
->
lockgøn
 = 
i
;

91 
	}
}

94 
	$DISKSIM_CACHEMEM_SHARED_READ_LOCKS_dïíd
(*
bv
)

97 
	}
}

100 
	$DISKSIM_CACHEMEM_SHARED_READ_LOCKS_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

102 i‡(!(
	`RANGE
(
i
, 0, 1))) {

105 
ªsu…
->
sh¨edªadlocks
 = 
i
;

107 
	}
}

110 
	$DISKSIM_CACHEMEM_MAX_REQUEST_SIZE_dïíd
(*
bv
)

113 
	}
}

116 
	$DISKSIM_CACHEMEM_MAX_REQUEST_SIZE_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

118 i‡(!(
i
 >= 0)) {

121 
ªsu…
->
maxªqsize
 = 
i
;

123 
	}
}

126 
	$DISKSIM_CACHEMEM_REPLACEMENT_POLICY_dïíd
(*
bv
)

129 
	}
}

132 
	$DISKSIM_CACHEMEM_REPLACEMENT_POLICY_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

134 i‡(!(
	`RANGE
(
i
, 
CACHE_REPLACE_MIN
, 
CACHE_REPLACE_MAX
))) {

137 
ªsu…
->
ª∂a˚pﬁicy
 = 
i
;

139 
	}
}

142 
	$DISKSIM_CACHEMEM_ALLOCATION_POLICY_dïíd
(*
bv
)

145 
	}
}

148 
	$DISKSIM_CACHEMEM_ALLOCATION_POLICY_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

150 i‡(!(
	`RANGE
(
i
, 
CACHE_ALLOCATE_MIN
, 
CACHE_ALLOCATE_MAX
))) {

153 
ªsu…
->
Æloˇãpﬁicy
 = 
i
;

155 
	}
}

158 
	$DISKSIM_CACHEMEM_WRITE_SCHEME_dïíd
(*
bv
)

161 
	}
}

164 
	$DISKSIM_CACHEMEM_WRITE_SCHEME_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

166 i‡(!(
	`RANGE
(
i
, 
CACHE_WRITE_MIN
, 
CACHE_WRITE_MAX
))) {

169 
ªsu…
->
wrôescheme
 = 
i
;

171 
	}
}

174 
	$DISKSIM_CACHEMEM_FLUSH_POLICY_dïíd
(*
bv
)

177 
	}
}

180 
	$DISKSIM_CACHEMEM_FLUSH_POLICY_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

182 i‡(!(
	`RANGE
(
i
, 
CACHE_FLUSH_MIN
, 
CACHE_FLUSH_MAX
))) {

185 
ªsu…
->
Êush_pﬁicy
 = 
i
;

187 
	}
}

190 
	$DISKSIM_CACHEMEM_FLUSH_PERIOD_dïíd
(*
bv
)

193 
	}
}

196 
	$DISKSIM_CACHEMEM_FLUSH_PERIOD_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
d
)

198 i‡(!(
d
 >= 0)) {

201 
ªsu…
->
Êush_≥riod
 = 
d
;

203 
	}
}

206 
	$DISKSIM_CACHEMEM_FLUSH_IDLE_DELAY_dïíd
(*
bv
)

209 
	}
}

212 
	$DISKSIM_CACHEMEM_FLUSH_IDLE_DELAY_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
d
)

214 i‡(!((
d
 >= 0) || (d == -1.0))) {

217 
ªsu…
->
Êush_idÀdñay
 = 
d
;

219 
	}
}

222 
	$DISKSIM_CACHEMEM_FLUSH_MAX_LINE_CLUSTER_dïíd
(*
bv
)

225 
	}
}

228 
	$DISKSIM_CACHEMEM_FLUSH_MAX_LINE_CLUSTER_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

230 i‡(!(
i
 >= 0)) {

233 
ªsu…
->
Êush_maxlöe˛u°î
 = 
i
;

235 
	}
}

238 
	$DISKSIM_CACHEMEM_READ_PREFETCH_TYPE_dïíd
(*
bv
)

241 
	}
}

244 
	$DISKSIM_CACHEMEM_READ_PREFETCH_TYPE_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

246 i‡(!(
	`RANGE
(
i
, 
CACHE_PREFETCH_MIN
, 
CACHE_PREFETCH_MAX
))) {

249 
ªsu…
->
ªad_¥e„tch_ty≥
 = 
i
;

251 
	}
}

254 
	$DISKSIM_CACHEMEM_WRITE_PREFETCH_TYPE_dïíd
(*
bv
)

257 
	}
}

260 
	$DISKSIM_CACHEMEM_WRITE_PREFETCH_TYPE_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

262 i‡(!(
	`RANGE
(
i
, 
CACHE_PREFETCH_MIN
, 
CACHE_PREFETCH_MAX
))) {

265 
ªsu…
->
wrôefûl_¥e„tch_ty≥
 = 
i
;

267 
	}
}

270 
	$DISKSIM_CACHEMEM_LINE_BY_LINE_FETCHES_dïíd
(*
bv
)

273 
	}
}

276 
	$DISKSIM_CACHEMEM_LINE_BY_LINE_FETCHES_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

278 i‡(!(
	`RANGE
(
i
, 0, 1))) {

281 
ªsu…
->
ªad_löe_by_löe
 = 
i
;

282 
ªsu…
->
wrôe_löe_by_löe
 = 
i
;

284 
	}
}

287 
	$DISKSIM_CACHEMEM_MAX_GATHER_dïíd
(*
bv
)

290 
	}
}

293 
	$DISKSIM_CACHEMEM_MAX_GATHER_lﬂdî
(
ˇche_mem
 * 
ªsu…
, 
i
)

295 i‡(!(
i
 >= 0)) {

298 
ªsu…
->
maxsˇtg©h
 = 
i
;

300 
	}
}

302 *
	gDISKSIM_CACHEMEM_lﬂdîs
[] = {

303 (*Ë
DISKSIM_CACHEMEM_CACHE_SIZE_lﬂdî
,

304 (*Ë
DISKSIM_CACHEMEM_SLRU_SEGMENTS_lﬂdî
,

305 (*Ë
DISKSIM_CACHEMEM_LINE_SIZE_lﬂdî
,

306 (*Ë
DISKSIM_CACHEMEM_BIT_GRANULARITY_lﬂdî
,

307 (*Ë
DISKSIM_CACHEMEM_LOCK_GRANULARITY_lﬂdî
,

308 (*Ë
DISKSIM_CACHEMEM_SHARED_READ_LOCKS_lﬂdî
,

309 (*Ë
DISKSIM_CACHEMEM_MAX_REQUEST_SIZE_lﬂdî
,

310 (*Ë
DISKSIM_CACHEMEM_REPLACEMENT_POLICY_lﬂdî
,

311 (*Ë
DISKSIM_CACHEMEM_ALLOCATION_POLICY_lﬂdî
,

312 (*Ë
DISKSIM_CACHEMEM_WRITE_SCHEME_lﬂdî
,

313 (*Ë
DISKSIM_CACHEMEM_FLUSH_POLICY_lﬂdî
,

314 (*Ë
DISKSIM_CACHEMEM_FLUSH_PERIOD_lﬂdî
,

315 (*Ë
DISKSIM_CACHEMEM_FLUSH_IDLE_DELAY_lﬂdî
,

316 (*Ë
DISKSIM_CACHEMEM_FLUSH_MAX_LINE_CLUSTER_lﬂdî
,

317 (*Ë
DISKSIM_CACHEMEM_READ_PREFETCH_TYPE_lﬂdî
,

318 (*Ë
DISKSIM_CACHEMEM_WRITE_PREFETCH_TYPE_lﬂdî
,

319 (*Ë
DISKSIM_CACHEMEM_LINE_BY_LINE_FETCHES_lﬂdî
,

320 (*Ë
DISKSIM_CACHEMEM_MAX_GATHER_lﬂdî


323 
Õ_∑ømdï_t
 
	gDISKSIM_CACHEMEM_dïs
[] = {

324 
DISKSIM_CACHEMEM_CACHE_SIZE_dïíd
,

325 
DISKSIM_CACHEMEM_SLRU_SEGMENTS_dïíd
,

326 
DISKSIM_CACHEMEM_LINE_SIZE_dïíd
,

327 
DISKSIM_CACHEMEM_BIT_GRANULARITY_dïíd
,

328 
DISKSIM_CACHEMEM_LOCK_GRANULARITY_dïíd
,

329 
DISKSIM_CACHEMEM_SHARED_READ_LOCKS_dïíd
,

330 
DISKSIM_CACHEMEM_MAX_REQUEST_SIZE_dïíd
,

331 
DISKSIM_CACHEMEM_REPLACEMENT_POLICY_dïíd
,

332 
DISKSIM_CACHEMEM_ALLOCATION_POLICY_dïíd
,

333 
DISKSIM_CACHEMEM_WRITE_SCHEME_dïíd
,

334 
DISKSIM_CACHEMEM_FLUSH_POLICY_dïíd
,

335 
DISKSIM_CACHEMEM_FLUSH_PERIOD_dïíd
,

336 
DISKSIM_CACHEMEM_FLUSH_IDLE_DELAY_dïíd
,

337 
DISKSIM_CACHEMEM_FLUSH_MAX_LINE_CLUSTER_dïíd
,

338 
DISKSIM_CACHEMEM_READ_PREFETCH_TYPE_dïíd
,

339 
DISKSIM_CACHEMEM_WRITE_PREFETCH_TYPE_dïíd
,

340 
DISKSIM_CACHEMEM_LINE_BY_LINE_FETCHES_dïíd
,

341 
DISKSIM_CACHEMEM_MAX_GATHER_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_cachemem_param.h

2 #i‚de‡
_DISKSIM_CACHEMEM_PARAM_H


3 
	#_DISKSIM_CACHEMEM_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
ˇche_if
 *
disksim_ˇchemem_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_CACHEMEM_CACHE_SIZE
,

16 
DISKSIM_CACHEMEM_SLRU_SEGMENTS
,

17 
DISKSIM_CACHEMEM_LINE_SIZE
,

18 
DISKSIM_CACHEMEM_BIT_GRANULARITY
,

19 
DISKSIM_CACHEMEM_LOCK_GRANULARITY
,

20 
DISKSIM_CACHEMEM_SHARED_READ_LOCKS
,

21 
DISKSIM_CACHEMEM_MAX_REQUEST_SIZE
,

22 
DISKSIM_CACHEMEM_REPLACEMENT_POLICY
,

23 
DISKSIM_CACHEMEM_ALLOCATION_POLICY
,

24 
DISKSIM_CACHEMEM_WRITE_SCHEME
,

25 
DISKSIM_CACHEMEM_FLUSH_POLICY
,

26 
DISKSIM_CACHEMEM_FLUSH_PERIOD
,

27 
DISKSIM_CACHEMEM_FLUSH_IDLE_DELAY
,

28 
DISKSIM_CACHEMEM_FLUSH_MAX_LINE_CLUSTER
,

29 
DISKSIM_CACHEMEM_READ_PREFETCH_TYPE
,

30 
DISKSIM_CACHEMEM_WRITE_PREFETCH_TYPE
,

31 
DISKSIM_CACHEMEM_LINE_BY_LINE_FETCHES
,

32 
DISKSIM_CACHEMEM_MAX_GATHER


33 } 
	tdisksim_ˇchemem_∑øm_t
;

35 
	#DISKSIM_CACHEMEM_MAX_PARAM
 
DISKSIM_CACHEMEM_MAX_GATHER


	)

36 * 
DISKSIM_CACHEMEM_lﬂdîs
[];

37 
Õ_∑ømdï_t
 
DISKSIM_CACHEMEM_dïs
[];

40 
Õ_v¨•ec
 
	gdisksim_ˇchemem_∑øms
 [] = {

41 {"Cachêsize", 
I
, 1 },

42 {"SLRU segmíts", 
LIST
, 0 },

43 {"Löêsize", 
I
, 1 },

44 {"Bô gønuœrôy", 
I
, 1 },

45 {"Lock gønuœrôy", 
I
, 1 },

46 {"Sh¨edÑódÜocks", 
I
, 1 },

47 {"MaxÑeque° size", 
I
, 1 },

48 {"Rïœ˚míàpﬁicy", 
I
, 1 },

49 {"AŒoˇti⁄Öﬁicy", 
I
, 1 },

50 {"Wrôêscheme", 
I
, 1 },

51 {"FlushÖﬁicy", 
I
, 1 },

52 {"FlushÖîiod", 
D
, 1 },

53 {"Flush idÀ dñay", 
D
, 1 },

54 {"Flush maxÜöê˛u°î", 
I
, 1 },

55 {"RódÖª„tchÅy≥", 
I
, 1 },

56 {"Wrôê¥e„tchÅy≥", 
I
, 1 },

57 {"Löe-by-löê„tches", 
I
, 1 },

58 {"Max g©hî", 
I
, 1 },

61 
	#DISKSIM_CACHEMEM_MAX
 18

	)

62 
Õ_mod
 
	gdisksim_ˇchemem_mod
 = { "disksim_ˇchemem", 
disksim_ˇchemem_∑øms
, 
DISKSIM_CACHEMEM_MAX
, (
Õ_modlﬂdî_t
)
disksim_ˇchemem_lﬂd∑øms
, 0, 0, 
DISKSIM_CACHEMEM_lﬂdîs
, 
DISKSIM_CACHEMEM_dïs
 };

65 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ctlr_param.c

1 
	~"disksim_˘Ã_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_˘Ã.h
"

5 
	$DISKSIM_CTLR_TYPE_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_CTLR_TYPE_lﬂdî
(
c⁄åﬁÀr
 * 
ªsu…
, 
i
)

13 i‡(!(
	`RANGE
(
i
, 1, 3))) {

16 
ªsu…
->
ty≥
 = 
i
;

18 
	}
}

21 
	$DISKSIM_CTLR_SCALE_FOR_DELAYS_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_CTLR_SCALE_FOR_DELAYS_lﬂdî
(
c⁄åﬁÀr
 * 
ªsu…
, 
d
)

29 i‡(!(
d
 >= 0.0)) {

32 
ªsu…
->
timesˇÀ
 = 
d
;

34 
	}
}

37 
	$DISKSIM_CTLR_BULK_SECTOR_TRANSFER_TIME_dïíd
(*
bv
)

40 
	}
}

43 
	$DISKSIM_CTLR_BULK_SECTOR_TRANSFER_TIME_lﬂdî
(
c⁄åﬁÀr
 * 
ªsu…
, 
d
)

45 i‡(!((
d
 >= 0.0))) {

48 
ªsu…
->
blkå™°ime
 = 
d
;

50 
	}
}

53 
	$DISKSIM_CTLR_MAXIMUM_QUEUE_LENGTH_dïíd
(*
bv
)

56 
	}
}

59 
	$DISKSIM_CTLR_MAXIMUM_QUEUE_LENGTH_lﬂdî
(
c⁄åﬁÀr
 * 
ªsu…
, 
i
)

61 i‡(!((
i
 >= 0))) {

64 
ªsu…
->
maxout°™dög
 = 
i
 + 1;

66 
	}
}

69 
	$DISKSIM_CTLR_PRINT_STATS_dïíd
(*
bv
)

72 
	}
}

75 
	$DISKSIM_CTLR_PRINT_STATS_lﬂdî
(
c⁄åﬁÀr
 * 
ªsu…
, 
i
)

77 i‡(!(
	`RANGE
(
i
, 0, 1))) {

80 
ªsu…
->
¥öt°©s
 = 
i
;

82 
	}
}

85 
	$DISKSIM_CTLR_SCHEDULER_dïíd
(*
bv
)

88 
	}
}

91 
	$DISKSIM_CTLR_SCHEDULER_lﬂdî
(
c⁄åﬁÀr
 * 
ªsu…
, 
Õ_block
 * 
blk
)

93 i‡(!(
ªsu…
->
queue
 = (
ioq
 *Ë
	`disksim_ioqueue_lﬂd∑øms
(
blk
, 
disksim
->
˘Ãöfo
->
˘l_¥ötqueue°©s
, disksim->˘Ãöfo->
˘l_¥öt¸ô°©s
, disksim->˘Ãöfo->
˘l_¥ötidÀ°©s
, disksim->˘Ãöfo->
˘l_¥ötöèº°©s
, disksim->˘Ãöfo->
˘l_¥ötsize°©s
))) {

96 
	}
}

99 
	$DISKSIM_CTLR_CACHE_dïíd
(*
bv
)

102 
	}
}

105 
	$DISKSIM_CTLR_CACHE_lﬂdî
(
c⁄åﬁÀr
 * 
ªsu…
, 
Õ_block
 * 
blk
)

107 i‡(!(
ªsu…
->
ˇche
 = 
	`disksim_ˇche_lﬂd∑øms
(
blk
))) {

110 
	}
}

113 
	$DISKSIM_CTLR_MAX_PER_DISK_PENDING_COUNT_dïíd
(*
bv
)

116 
	}
}

119 
	$DISKSIM_CTLR_MAX_PER_DISK_PENDING_COUNT_lﬂdî
(
c⁄åﬁÀr
 * 
ªsu…
, 
i
)

121 i‡(!(
i
 >= 0)) {

124 
ªsu…
->
maxdiskqsize
 = 
i
;

126 
	}
}

128 *
	gDISKSIM_CTLR_lﬂdîs
[] = {

129 (*Ë
DISKSIM_CTLR_TYPE_lﬂdî
,

130 (*Ë
DISKSIM_CTLR_SCALE_FOR_DELAYS_lﬂdî
,

131 (*Ë
DISKSIM_CTLR_BULK_SECTOR_TRANSFER_TIME_lﬂdî
,

132 (*Ë
DISKSIM_CTLR_MAXIMUM_QUEUE_LENGTH_lﬂdî
,

133 (*Ë
DISKSIM_CTLR_PRINT_STATS_lﬂdî
,

134 (*Ë
DISKSIM_CTLR_SCHEDULER_lﬂdî
,

135 (*Ë
DISKSIM_CTLR_CACHE_lﬂdî
,

136 (*Ë
DISKSIM_CTLR_MAX_PER_DISK_PENDING_COUNT_lﬂdî


139 
Õ_∑ømdï_t
 
	gDISKSIM_CTLR_dïs
[] = {

140 
DISKSIM_CTLR_TYPE_dïíd
,

141 
DISKSIM_CTLR_SCALE_FOR_DELAYS_dïíd
,

142 
DISKSIM_CTLR_BULK_SECTOR_TRANSFER_TIME_dïíd
,

143 
DISKSIM_CTLR_MAXIMUM_QUEUE_LENGTH_dïíd
,

144 
DISKSIM_CTLR_PRINT_STATS_dïíd
,

145 
DISKSIM_CTLR_SCHEDULER_dïíd
,

146 
DISKSIM_CTLR_CACHE_dïíd
,

147 
DISKSIM_CTLR_MAX_PER_DISK_PENDING_COUNT_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ctlr_param.h

2 #i‚de‡
_DISKSIM_CTLR_PARAM_H


3 
	#_DISKSIM_CTLR_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
c⁄åﬁÀr
 *
disksim_˘Ã_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_CTLR_TYPE
,

16 
DISKSIM_CTLR_SCALE_FOR_DELAYS
,

17 
DISKSIM_CTLR_BULK_SECTOR_TRANSFER_TIME
,

18 
DISKSIM_CTLR_MAXIMUM_QUEUE_LENGTH
,

19 
DISKSIM_CTLR_PRINT_STATS
,

20 
DISKSIM_CTLR_SCHEDULER
,

21 
DISKSIM_CTLR_CACHE
,

22 
DISKSIM_CTLR_MAX_PER_DISK_PENDING_COUNT


23 } 
	tdisksim_˘Ã_∑øm_t
;

25 
	#DISKSIM_CTLR_MAX_PARAM
 
DISKSIM_CTLR_MAX_PER_DISK_PENDING_COUNT


	)

26 * 
DISKSIM_CTLR_lﬂdîs
[];

27 
Õ_∑ømdï_t
 
DISKSIM_CTLR_dïs
[];

30 
Õ_v¨•ec
 
	gdisksim_˘Ã_∑øms
 [] = {

31 {"ty≥", 
I
, 1 },

32 {"SˇÀ f‹ dñays", 
D
, 1 },

33 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

34 {"Maximum queuêÀngth", 
I
, 1 },

35 {"Pröà°©s", 
I
, 1 },

36 {"ScheduÀr", 
BLOCK
, 0 },

37 {"Cache", 
BLOCK
, 0 },

38 {"MaxÖî-diskÖídög cou¡", 
I
, 0 },

41 
	#DISKSIM_CTLR_MAX
 8

	)

42 
Õ_mod
 
	gdisksim_˘Ã_mod
 = { "disksim_˘Ã", 
disksim_˘Ã_∑øms
, 
DISKSIM_CTLR_MAX
, (
Õ_modlﬂdî_t
)
disksim_˘Ã_lﬂd∑øms
, 0, 0, 
DISKSIM_CTLR_lﬂdîs
, 
DISKSIM_CTLR_dïs
 };

45 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ctlr_stats_param.c

1 
	~"disksim_˘Ã_°©s_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_globÆ.h
"

4 
	~"../disksim_˘Ã.h
"

6 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CACHE_STATS_dïíd
(*
bv
)

9 
	}
}

12 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CACHE_STATS_lﬂdî
(
ªsu…
, 
i
)

14 i‡(!(
	`RANGE
(
i
, 0, 1))) {

17 
disksim
->
˘Ãöfo
->
˘l_¥ötˇche°©s
 = 
i
;

19 
	}
}

22 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_SIZE_STATS_dïíd
(*
bv
)

25 
	}
}

28 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_SIZE_STATS_lﬂdî
(
ªsu…
, 
i
)

30 i‡(!(
	`RANGE
(
i
, 0, 1))) {

33 
disksim
->
˘Ãöfo
->
˘l_¥ötsize°©s
 = 
i
;

35 
	}
}

38 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_LOCALITY_STATS_dïíd
(*
bv
)

41 
	}
}

44 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_LOCALITY_STATS_lﬂdî
(
ªsu…
, 
i
)

46 i‡(!(
	`RANGE
(
i
, 0, 1))) {

49 
disksim
->
˘Ãöfo
->
˘l_¥öéoˇlôy°©s
 = 
i
;

51 
	}
}

54 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_BLOCKING_STATS_dïíd
(*
bv
)

57 
	}
}

60 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_BLOCKING_STATS_lﬂdî
(
ªsu…
, 
i
)

62 i‡(!(
	`RANGE
(
i
, 0, 1))) {

65 
disksim
->
˘Ãöfo
->
˘l_¥ötblockög°©s
 = 
i
;

67 
	}
}

70 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTERFERENCE_STATS_dïíd
(*
bv
)

73 
	}
}

76 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTERFERENCE_STATS_lﬂdî
(
ªsu…
, 
i
)

78 i‡(!(
	`RANGE
(
i
, 0, 1))) {

81 
disksim
->
˘Ãöfo
->
˘l_¥ötöãr„ª°©s
 = 
i
;

83 
	}
}

86 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_QUEUE_STATS_dïíd
(*
bv
)

89 
	}
}

92 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_QUEUE_STATS_lﬂdî
(
ªsu…
, 
i
)

94 i‡(!(
	`RANGE
(
i
, 0, 1))) {

97 
disksim
->
˘Ãöfo
->
˘l_¥ötqueue°©s
 = 
i
;

99 
	}
}

102 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CRIT_STATS_dïíd
(*
bv
)

105 
	}
}

108 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CRIT_STATS_lﬂdî
(
ªsu…
, 
i
)

110 i‡(!(
	`RANGE
(
i
, 0, 1))) {

113 
disksim
->
˘Ãöfo
->
˘l_¥öt¸ô°©s
 = 
i
;

115 
	}
}

118 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_IDLE_STATS_dïíd
(*
bv
)

121 
	}
}

124 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_IDLE_STATS_lﬂdî
(
ªsu…
, 
i
)

126 i‡(!(
	`RANGE
(
i
, 0, 1))) {

129 
disksim
->
˘Ãöfo
->
˘l_¥ötidÀ°©s
 = 
i
;

131 
	}
}

134 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTARR_STATS_dïíd
(*
bv
)

137 
	}
}

140 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTARR_STATS_lﬂdî
(
ªsu…
, 
i
)

142 i‡(!(
	`RANGE
(
i
, 0, 1))) {

145 
disksim
->
˘Ãöfo
->
˘l_¥ötöèº°©s
 = 
i
;

147 
	}
}

150 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STREAK_STATS_dïíd
(*
bv
)

153 
	}
}

156 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STREAK_STATS_lﬂdî
(
ªsu…
, 
i
)

158 i‡(!(
	`RANGE
(
i
, 0, 1))) {

161 
disksim
->
˘Ãöfo
->
˘l_¥öt°ªak°©s
 = 
i
;

163 
	}
}

166 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STAMP_STATS_dïíd
(*
bv
)

169 
	}
}

172 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STAMP_STATS_lﬂdî
(
ªsu…
, 
i
)

174 i‡(!(
	`RANGE
(
i
, 0, 1))) {

177 
disksim
->
˘Ãöfo
->
˘l_¥öt°amp°©s
 = 
i
;

179 
	}
}

182 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_PER_DEVICE_STATS_dïíd
(*
bv
)

185 
	}
}

188 
	$DISKSIM_CTLR_STATS_PRINT_CONTROLLER_PER_DEVICE_STATS_lﬂdî
(
ªsu…
, 
i
)

190 i‡(!(
	`RANGE
(
i
, 0, 1))) {

193 
disksim
->
˘Ãöfo
->
˘l_¥öçîdisk°©s
 = 
i
;

195 
	}
}

197 *
	gDISKSIM_CTLR_STATS_lﬂdîs
[] = {

198 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CACHE_STATS_lﬂdî
,

199 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_SIZE_STATS_lﬂdî
,

200 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_LOCALITY_STATS_lﬂdî
,

201 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_BLOCKING_STATS_lﬂdî
,

202 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTERFERENCE_STATS_lﬂdî
,

203 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_QUEUE_STATS_lﬂdî
,

204 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CRIT_STATS_lﬂdî
,

205 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_IDLE_STATS_lﬂdî
,

206 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTARR_STATS_lﬂdî
,

207 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STREAK_STATS_lﬂdî
,

208 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STAMP_STATS_lﬂdî
,

209 (*Ë
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_PER_DEVICE_STATS_lﬂdî


212 
Õ_∑ømdï_t
 
	gDISKSIM_CTLR_STATS_dïs
[] = {

213 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CACHE_STATS_dïíd
,

214 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_SIZE_STATS_dïíd
,

215 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_LOCALITY_STATS_dïíd
,

216 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_BLOCKING_STATS_dïíd
,

217 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTERFERENCE_STATS_dïíd
,

218 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_QUEUE_STATS_dïíd
,

219 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CRIT_STATS_dïíd
,

220 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_IDLE_STATS_dïíd
,

221 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTARR_STATS_dïíd
,

222 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STREAK_STATS_dïíd
,

223 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STAMP_STATS_dïíd
,

224 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_PER_DEVICE_STATS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ctlr_stats_param.h

2 #i‚de‡
_DISKSIM_CTLR_STATS_PARAM_H


3 
	#_DISKSIM_CTLR_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_˘Ã_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CACHE_STATS
,

16 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_SIZE_STATS
,

17 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_LOCALITY_STATS
,

18 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_BLOCKING_STATS
,

19 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTERFERENCE_STATS
,

20 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_QUEUE_STATS
,

21 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_CRIT_STATS
,

22 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_IDLE_STATS
,

23 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_INTARR_STATS
,

24 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STREAK_STATS
,

25 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_STAMP_STATS
,

26 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_PER_DEVICE_STATS


27 } 
	tdisksim_˘Ã_°©s_∑øm_t
;

29 
	#DISKSIM_CTLR_STATS_MAX_PARAM
 
DISKSIM_CTLR_STATS_PRINT_CONTROLLER_PER_DEVICE_STATS


	)

30 * 
DISKSIM_CTLR_STATS_lﬂdîs
[];

31 
Õ_∑ømdï_t
 
DISKSIM_CTLR_STATS_dïs
[];

34 
Õ_v¨•ec
 
	gdisksim_˘Ã_°©s_∑øms
 [] = {

35 {"Pröàc⁄åﬁÀ∏ˇchê°©s", 
I
, 1 },

36 {"Pröàc⁄åﬁÀ∏sizê°©s", 
I
, 1 },

37 {"Pröàc⁄åﬁÀ∏loˇlôy sèts", 
I
, 1 },

38 {"Pröàc⁄åﬁÀ∏blockög sèts", 
I
, 1 },

39 {"Pröàc⁄åﬁÀ∏öãr„ªn˚ sèts", 
I
, 1 },

40 {"Pröàc⁄åﬁÀ∏queuê°©s", 
I
, 1 },

41 {"Pröàc⁄åﬁÀ∏¸ô sèts", 
I
, 1 },

42 {"Pröàc⁄åﬁÀ∏idÀ sèts", 
I
, 1 },

43 {"Pröàc⁄åﬁÀ∏öèº sèts", 
I
, 1 },

44 {"Pröàc⁄åﬁÀ∏°ªak sèts", 
I
, 1 },

45 {"Pröàc⁄åﬁÀ∏°am∞°©s", 
I
, 1 },

46 {"Pröàc⁄åﬁÀ∏≥r-devi˚ sèts", 
I
, 1 },

49 
	#DISKSIM_CTLR_STATS_MAX
 12

	)

50 
Õ_mod
 
	gdisksim_˘Ã_°©s_mod
 = { "disksim_˘Ã_°©s", 
disksim_˘Ã_°©s_∑øms
, 
DISKSIM_CTLR_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_˘Ã_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_CTLR_STATS_lﬂdîs
, 
DISKSIM_CTLR_STATS_dïs
 };

53 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_device_param.c

1 
	~"disksim_devi˚_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 *
	gDISKSIM_DEVICE_lﬂdîs
[] = {

4 
NULL


7 
Õ_∑ømdï_t
 
	gDISKSIM_DEVICE_dïs
[] = {

8 
NULL


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_device_param.h

2 #i‚de‡
_DISKSIM_DEVICE_PARAM_H


3 
	#_DISKSIM_DEVICE_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_devi˚_lﬂd∑øms
();

14 
	#DISKSIM_DEVICE_MAX_PARAM


	)

15 * 
DISKSIM_DEVICE_lﬂdîs
[];

16 
Õ_∑ømdï_t
 
DISKSIM_DEVICE_dïs
[];

19 
Õ_v¨•ec
 
	gdisksim_devi˚_∑øms
 [] = {

22 
	#DISKSIM_DEVICE_MAX
 0

	)

23 
Õ_mod
 
	gdisksim_devi˚_mod
 = { "disksim_devi˚", 
disksim_devi˚_∑øms
, 
DISKSIM_DEVICE_MAX
, (
Õ_modlﬂdî_t
)
disksim_devi˚_lﬂd∑øms
, 0, 0, 
DISKSIM_DEVICE_lﬂdîs
, 
DISKSIM_DEVICE_dïs
 };

26 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_device_stats_param.c

1 
	~"disksim_devi˚_°©s_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_devi˚.h
"

5 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_QUEUE_STATS_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_QUEUE_STATS_lﬂdî
(
ªsu…
, 
i
)

13 i‡(!(
	`RANGE
(
i
, 0, 1))) {

16 
devi˚_¥ötqueue°©s
 = 
i
;

18 
	}
}

21 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_CRIT_STATS_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_CRIT_STATS_lﬂdî
(
ªsu…
, 
i
)

29 i‡(!(
	`RANGE
(
i
, 0, 1))) {

32 
devi˚_¥öt¸ô°©s
 = 
i
;

34 
	}
}

37 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_IDLE_STATS_dïíd
(*
bv
)

40 
	}
}

43 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_IDLE_STATS_lﬂdî
(
ªsu…
, 
i
)

45 i‡(!(
	`RANGE
(
i
, 0, 1))) {

48 
devi˚_¥ötidÀ°©s
 = 
i
;

50 
	}
}

53 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTARR_STATS_dïíd
(*
bv
)

56 
	}
}

59 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTARR_STATS_lﬂdî
(
ªsu…
, 
i
)

61 i‡(!(
	`RANGE
(
i
, 0, 1))) {

64 
devi˚_¥ötöèº°©s
 = 
i
;

66 
	}
}

69 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_SIZE_STATS_dïíd
(*
bv
)

72 
	}
}

75 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_SIZE_STATS_lﬂdî
(
ªsu…
, 
i
)

77 i‡(!(
	`RANGE
(
i
, 0, 1))) {

80 
devi˚_¥ötsize°©s
 = 
i
;

82 
	}
}

85 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_SEEK_STATS_dïíd
(*
bv
)

88 
	}
}

91 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_SEEK_STATS_lﬂdî
(
ªsu…
, 
i
)

93 i‡(!(
	`RANGE
(
i
, 0, 1))) {

96 
devi˚_¥öt£ek°©s
 = 
i
;

98 
	}
}

101 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_LATENCY_STATS_dïíd
(*
bv
)

104 
	}
}

107 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_LATENCY_STATS_lﬂdî
(
ªsu…
, 
i
)

109 i‡(!(
	`RANGE
(
i
, 0, 1))) {

112 
devi˚_¥öé©ícy°©s
 = 
i
;

114 
	}
}

117 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_XFER_STATS_dïíd
(*
bv
)

120 
	}
}

123 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_XFER_STATS_lﬂdî
(
ªsu…
, 
i
)

125 i‡(!(
	`RANGE
(
i
, 0, 1))) {

128 
devi˚_¥ötx„r°©s
 = 
i
;

130 
	}
}

133 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_ACCTIME_STATS_dïíd
(*
bv
)

136 
	}
}

139 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_ACCTIME_STATS_lﬂdî
(
ªsu…
, 
i
)

141 i‡(!(
	`RANGE
(
i
, 0, 1))) {

144 
devi˚_¥öèc˘ime°©s
 = 
i
;

146 
	}
}

149 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTERFERE_STATS_dïíd
(*
bv
)

152 
	}
}

155 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTERFERE_STATS_lﬂdî
(
ªsu…
, 
i
)

157 i‡(!(
	`RANGE
(
i
, 0, 1))) {

160 
devi˚_¥ötöãr„ª°©s
 = 
i
;

162 
	}
}

165 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_BUFFER_STATS_dïíd
(*
bv
)

168 
	}
}

171 
	$DISKSIM_DEVICE_STATS_PRINT_DEVICE_BUFFER_STATS_lﬂdî
(
ªsu…
, 
i
)

173 i‡(!(
	`RANGE
(
i
, 0, 1))) {

176 
devi˚_¥ötbuf„r°©s
 = 
i
;

178 
	}
}

180 *
	gDISKSIM_DEVICE_STATS_lﬂdîs
[] = {

181 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_QUEUE_STATS_lﬂdî
,

182 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_CRIT_STATS_lﬂdî
,

183 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_IDLE_STATS_lﬂdî
,

184 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTARR_STATS_lﬂdî
,

185 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_SIZE_STATS_lﬂdî
,

186 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_SEEK_STATS_lﬂdî
,

187 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_LATENCY_STATS_lﬂdî
,

188 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_XFER_STATS_lﬂdî
,

189 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_ACCTIME_STATS_lﬂdî
,

190 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTERFERE_STATS_lﬂdî
,

191 (*Ë
DISKSIM_DEVICE_STATS_PRINT_DEVICE_BUFFER_STATS_lﬂdî


194 
Õ_∑ømdï_t
 
	gDISKSIM_DEVICE_STATS_dïs
[] = {

195 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_QUEUE_STATS_dïíd
,

196 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_CRIT_STATS_dïíd
,

197 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_IDLE_STATS_dïíd
,

198 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTARR_STATS_dïíd
,

199 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_SIZE_STATS_dïíd
,

200 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_SEEK_STATS_dïíd
,

201 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_LATENCY_STATS_dïíd
,

202 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_XFER_STATS_dïíd
,

203 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_ACCTIME_STATS_dïíd
,

204 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTERFERE_STATS_dïíd
,

205 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_BUFFER_STATS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_device_stats_param.h

2 #i‚de‡
_DISKSIM_DEVICE_STATS_PARAM_H


3 
	#_DISKSIM_DEVICE_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_devi˚_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_QUEUE_STATS
,

16 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_CRIT_STATS
,

17 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_IDLE_STATS
,

18 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTARR_STATS
,

19 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_SIZE_STATS
,

20 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_SEEK_STATS
,

21 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_LATENCY_STATS
,

22 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_XFER_STATS
,

23 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_ACCTIME_STATS
,

24 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_INTERFERE_STATS
,

25 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_BUFFER_STATS


26 } 
	tdisksim_devi˚_°©s_∑øm_t
;

28 
	#DISKSIM_DEVICE_STATS_MAX_PARAM
 
DISKSIM_DEVICE_STATS_PRINT_DEVICE_BUFFER_STATS


	)

29 * 
DISKSIM_DEVICE_STATS_lﬂdîs
[];

30 
Õ_∑ømdï_t
 
DISKSIM_DEVICE_STATS_dïs
[];

33 
Õ_v¨•ec
 
	gdisksim_devi˚_°©s_∑øms
 [] = {

34 {"Pröàdevi˚ queuê°©s", 
I
, 1 },

35 {"Pröàdevi˚ crô sèts", 
I
, 1 },

36 {"Pröàdevi˚ idÀ sèts", 
I
, 1 },

37 {"Pröàdevi˚ i¡¨∏°©s", 
I
, 1 },

38 {"Pröàdevi˚ sizê°©s", 
I
, 1 },

39 {"Pröàdevi˚ sìk sèts", 
I
, 1 },

40 {"Pröàdevi˚Ü©ícy sèts", 
I
, 1 },

41 {"Pröàdevi˚ x„∏°©s", 
I
, 1 },

42 {"Pröàdevi˚ác˘imê°©s", 
I
, 1 },

43 {"Pröàdevi˚ i¡î„ª sèts", 
I
, 1 },

44 {"Pröàdevi˚ buf„∏°©s", 
I
, 1 },

47 
	#DISKSIM_DEVICE_STATS_MAX
 11

	)

48 
Õ_mod
 
	gdisksim_devi˚_°©s_mod
 = { "disksim_devi˚_°©s", 
disksim_devi˚_°©s_∑øms
, 
DISKSIM_DEVICE_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_devi˚_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_DEVICE_STATS_lﬂdîs
, 
DISKSIM_DEVICE_STATS_dïs
 };

51 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_disk_param.c

1 
	~"disksim_disk_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_disk.h
"

5 
	$DISKSIM_DISK_MODEL_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_DISK_MODEL_lﬂdî
(
disk
 * 
ªsu…
, 
Õ_block
 * 
blk
)

13 i‡(!(
ªsu…
->
modñ
 = (
dm_disk_if
 *Ë
	`dm_disk_lﬂd∑øms
(
blk
, 0))) {

16 
	}
}

19 
	$DISKSIM_DISK_SCHEDULER_dïíd
(*
bv
)

22 
	}
}

25 
	$DISKSIM_DISK_SCHEDULER_lﬂdî
(
disk
 * 
ªsu…
, 
Õ_block
 * 
blk
)

27 i‡(!((
ªsu…
->
queue
 = (
ioq
 *Ë
	`disksim_ioqueue_lﬂd∑øms
(
blk
, 
devi˚_¥ötqueue°©s
, 
devi˚_¥öt¸ô°©s
, 
devi˚_¥ötidÀ°©s
, 
devi˚_¥ötöèº°©s
, 
devi˚_¥ötsize°©s
)))) {

30 
	}
}

33 
	$DISKSIM_DISK_MAX_QUEUE_LENGTH_dïíd
(*
bv
)

36 
	}
}

39 
	$DISKSIM_DISK_MAX_QUEUE_LENGTH_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

41 i‡(!(
i
 >= 0)) {

44 
ªsu…
->
maxqÀn
 = 
i
;

46 
	}
}

49 
	$DISKSIM_DISK_BULK_SECTOR_TRANSFER_TIME_dïíd
(*
bv
)

52 
	}
}

55 
	$DISKSIM_DISK_BULK_SECTOR_TRANSFER_TIME_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

57 i‡(!(
d
 >= 0.0)) {

60 
ªsu…
->
blkå™°ime
 = 
d
;

62 
	}
}

65 
	$DISKSIM_DISK_SEGMENT_SIZE__dïíd
(*
bv
)

68 
	}
}

71 
	$DISKSIM_DISK_SEGMENT_SIZE__lﬂdî
(
disk
 * 
ªsu…
, 
i
)

73 i‡(!(
	`RANGE
(
i
, 1, 
ªsu…
->
modñ
->
dm_£˘‹s
))) {

76 
ªsu…
->
£gsize
 = 
i
;

78 
	}
}

81 
	$DISKSIM_DISK_NUMBER_OF_BUFFER_SEGMENTS_dïíd
(*
bv
)

84 
	}
}

87 
	$DISKSIM_DISK_NUMBER_OF_BUFFER_SEGMENTS_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

89 i‡(!(
i
 >= 0)) {

92 
ªsu…
->
num£gs
 = 
i
;

94 
	}
}

97 
	$DISKSIM_DISK_PRINT_STATS_dïíd
(*
bv
)

100 
	}
}

103 
	$DISKSIM_DISK_PRINT_STATS_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

105 i‡(!(
	`RANGE
(
i
, 0, 1))) {

108 
ªsu…
->
¥öt°©s
 = 
i
;

110 
	}
}

113 
	$DISKSIM_DISK_PER_REQUEST_OVERHEAD_TIME_dïíd
(*
bv
)

116 
	}
}

119 
	$DISKSIM_DISK_PER_REQUEST_OVERHEAD_TIME_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

121 i‡(!(
d
 >= 0.0)) {

124 
ªsu…
->
ovîhód
 = 
d
;

126 
	}
}

129 
	$DISKSIM_DISK_TIME_SCALE_FOR_OVERHEADS_dïíd
(*
bv
)

132 
	}
}

135 
	$DISKSIM_DISK_TIME_SCALE_FOR_OVERHEADS_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

137 i‡(!(
d
 >= 0.0)) {

140 
ªsu…
->
timesˇÀ
 = 
d
;

142 
	}
}

145 
	$DISKSIM_DISK_HOLD_BUS_ENTIRE_READ_XFER_dïíd
(*
bv
)

148 
	}
}

151 
	$DISKSIM_DISK_HOLD_BUS_ENTIRE_READ_XFER_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

153 i‡(!(
	`RANGE
(
i
, 0, 1))) {

156 
ªsu…
->
hﬁd_bus_f‹_whﬁe_ªad_x„r
 = 
i
;

158 
	}
}

161 
	$DISKSIM_DISK_HOLD_BUS_ENTIRE_WRITE_XFER_dïíd
(*
bv
)

164 
	}
}

167 
	$DISKSIM_DISK_HOLD_BUS_ENTIRE_WRITE_XFER_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

169 i‡(!(
	`RANGE
(
i
, 0, 1))) {

172 
ªsu…
->
hﬁd_bus_f‹_whﬁe_wrôe_x„r
 = 
i
;

174 
	}
}

177 
	$DISKSIM_DISK_ALLOW_ALMOST_READ_HITS_dïíd
(*
bv
)

180 
	}
}

183 
	$DISKSIM_DISK_ALLOW_ALMOST_READ_HITS_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

185 i‡(!(
	`RANGE
(
i
, 0, 1))) {

188 
ªsu…
->
Æmo°ªadhôs
 = 
i
;

190 
	}
}

193 
	$DISKSIM_DISK_ALLOW_SNEAKY_FULL_READ_HITS_dïíd
(*
bv
)

196 
	}
}

199 
	$DISKSIM_DISK_ALLOW_SNEAKY_FULL_READ_HITS_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

201 i‡(!(
	`RANGE
(
i
, 0, 1))) {

204 
ªsu…
->
¢ókyfuŒªadhôs
 = 
i
;

206 
	}
}

209 
	$DISKSIM_DISK_ALLOW_SNEAKY_PARTIAL_READ_HITS_dïíd
(*
bv
)

212 
	}
}

215 
	$DISKSIM_DISK_ALLOW_SNEAKY_PARTIAL_READ_HITS_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

217 i‡(!(
	`RANGE
(
i
, 0, 1))) {

220 
ªsu…
->
¢óky∑πüÃódhôs
 = 
i
;

222 
	}
}

225 
	$DISKSIM_DISK_ALLOW_SNEAKY_INTERMEDIATE_READ_HITS_dïíd
(*
bv
)

228 
	}
}

231 
	$DISKSIM_DISK_ALLOW_SNEAKY_INTERMEDIATE_READ_HITS_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

233 i‡(!(
	`RANGE
(
i
, 0, 1))) {

236 
ªsu…
->
¢ókyöãrmedüãªadhôs
 = 
i
;

238 
	}
}

241 
	$DISKSIM_DISK_ALLOW_READ_HITS_ON_WRITE_DATA_dïíd
(*
bv
)

244 
	}
}

247 
	$DISKSIM_DISK_ALLOW_READ_HITS_ON_WRITE_DATA_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

249 i‡(!(
	`RANGE
(
i
, 0, 1))) {

252 
ªsu…
->
ªadhôs⁄wrôed©a
 = 
i
;

254 
	}
}

257 
	$DISKSIM_DISK_ALLOW_WRITE_PREBUFFERING_dïíd
(*
bv
)

260 
	}
}

263 
	$DISKSIM_DISK_ALLOW_WRITE_PREBUFFERING_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

265 i‡(!(
	`RANGE
(
i
, 0, 1))) {

268 
ªsu…
->
wrôïªbuf„rög
 = 
i
;

270 
	}
}

273 
	$DISKSIM_DISK_PRESEEKING_LEVEL_dïíd
(*
bv
)

276 
	}
}

279 
	$DISKSIM_DISK_PRESEEKING_LEVEL_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

281 i‡(!(
	`RANGE
(
i
, 0, 2))) {

284 
ªsu…
->
¥e£ekög
 = 
i
;

286 
	}
}

289 
	$DISKSIM_DISK_NEVER_DISCONNECT_dïíd
(*
bv
)

292 
	}
}

295 
	$DISKSIM_DISK_NEVER_DISCONNECT_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

297 i‡(!(
	`RANGE
(
i
, 0, 1))) {

300 
ªsu…
->
√vîdisc⁄√˘
 = 
i
;

302 
	}
}

305 
	$DISKSIM_DISK_AVG_SECTORS_PER_CYLINDER_dïíd
(*
bv
)

308 
	}
}

311 
	$DISKSIM_DISK_AVG_SECTORS_PER_CYLINDER_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

313 i‡(!(
	`RANGE
(
i
, 1, 
ªsu…
->
modñ
->
dm_£˘‹s
))) {

316 
ªsu…
->
£˘≥rcyl
 = 
i
;

318 
	}
}

321 
	$DISKSIM_DISK_MAXIMUM_NUMBER_OF_WRITE_SEGMENTS_dïíd
(*
bv
)

323 i‡(!
	`BIT_TEST
(
bv
, 
DISKSIM_DISK_NUMBER_OF_BUFFER_SEGMENTS
)) {

324  
DISKSIM_DISK_NUMBER_OF_BUFFER_SEGMENTS
;

327 
	}
}

330 
	$DISKSIM_DISK_MAXIMUM_NUMBER_OF_WRITE_SEGMENTS_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

332 i‡(!(
	`RANGE
(
i
, 1, 
ªsu…
->
num£gs
))) {

335 
ªsu…
->
numwrôe£gs
 = 
i
;

337 
	}
}

340 
	$DISKSIM_DISK_USE_SEPARATE_WRITE_SEGMENT_dïíd
(*
bv
)

343 
	}
}

346 
	$DISKSIM_DISK_USE_SEPARATE_WRITE_SEGMENT_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

348 i‡(!(
	`RANGE
(
i
, 0, 1))) {

351 
ªsu…
->
dediˇãdwrôe£g
 = (
£gmít
 *Ë
i
;

353 
	}
}

356 
	$DISKSIM_DISK_LOW__WATER_MARK_dïíd
(*
bv
)

359 
	}
}

362 
	$DISKSIM_DISK_LOW__WATER_MARK_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

364 i‡(!(
	`RANGE
(
d
, 0.0, 1.0))) {

367 
ªsu…
->
wrôew©î
 = 
d
;

369 
	}
}

372 
	$DISKSIM_DISK_HIGH__WATER_MARK_dïíd
(*
bv
)

375 
	}
}

378 
	$DISKSIM_DISK_HIGH__WATER_MARK_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

380 i‡(!(
	`RANGE
(
d
, 0.0, 1.0))) {

383 
ªsu…
->
ªadw©î
 = 
d
;

385 
	}
}

388 
	$DISKSIM_DISK_SET_WATERMARK_BY_REQSIZE_dïíd
(*
bv
)

391 
	}
}

394 
	$DISKSIM_DISK_SET_WATERMARK_BY_REQSIZE_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

396 i‡(!(
	`RANGE
(
i
, 0, 1))) {

399 
ªsu…
->
ªqw©î
 = 
i
;

401 
	}
}

404 
	$DISKSIM_DISK_CALC_SECTOR_BY_SECTOR_dïíd
(*
bv
)

407 
	}
}

410 
	$DISKSIM_DISK_CALC_SECTOR_BY_SECTOR_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

412 i‡(!(
	`RANGE
(
i
, 0, 1))) {

415 
ªsu…
->
£˘by£˘
 = 
i
;

417 
	}
}

420 
	$DISKSIM_DISK_ENABLE_CACHING_IN_BUFFER_dïíd
(*
bv
)

423 
	}
}

426 
	$DISKSIM_DISK_ENABLE_CACHING_IN_BUFFER_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

428 i‡(!(
	`RANGE
(
i
, 0, 2))) {

431 
ªsu…
->
íabÀˇche
 = 
i
;

433 
	}
}

436 
	$DISKSIM_DISK_BUFFER_CONTINUOUS_READ_dïíd
(*
bv
)

439 
	}
}

442 
	$DISKSIM_DISK_BUFFER_CONTINUOUS_READ_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

444 i‡(!(
	`RANGE
(
i
, 0, 4))) {

447 
ªsu…
->
c⁄åód
 = 
i
;

449 
	}
}

452 
	$DISKSIM_DISK_MINIMUM_READ_AHEAD__dïíd
(*
bv
)

455 
	}
}

458 
	$DISKSIM_DISK_MINIMUM_READ_AHEAD__lﬂdî
(
disk
 * 
ªsu…
, 
i
)

460 i‡(!(
	`RANGE
(
i
, 0, 
ªsu…
->
£gsize
))) {

463 
ªsu…
->
möªadahód
 = 
i
;

465 
	}
}

468 
	$DISKSIM_DISK_MAXIMUM_READ_AHEAD__dïíd
(*
bv
)

471 
	}
}

474 
	$DISKSIM_DISK_MAXIMUM_READ_AHEAD__lﬂdî
(
disk
 * 
ªsu…
, 
i
)

476 i‡(!(
	`RANGE
(
i
, 0, 
ªsu…
->
£gsize
))) {

479 
ªsu…
->
maxªadahód
 = 
i
;

481 
	}
}

484 
	$DISKSIM_DISK_READ_AHEAD_OVER_REQUESTED_dïíd
(*
bv
)

487 
	}
}

490 
	$DISKSIM_DISK_READ_AHEAD_OVER_REQUESTED_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

492 i‡(!(
	`RANGE
(
i
, -1, 1))) {

495 
ªsu…
->
kì¥eque°d©a
 = 
i
;

497 
	}
}

500 
	$DISKSIM_DISK_READ_AHEAD_ON_IDLE_HIT_dïíd
(*
bv
)

503 
	}
}

506 
	$DISKSIM_DISK_READ_AHEAD_ON_IDLE_HIT_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

508 i‡(!(
	`RANGE
(
i
, 0, 1))) {

511 
ªsu…
->
ªadahódifidÀ
 = 
i
;

513 
	}
}

516 
	$DISKSIM_DISK_READ_ANY_FREE_BLOCKS_dïíd
(*
bv
)

519 
	}
}

522 
	$DISKSIM_DISK_READ_ANY_FREE_BLOCKS_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

524 i‡(!(
	`RANGE
(
i
, 0, 1))) {

527 
ªsu…
->
ªad™y‰ìblocks
 = 
i
;

529 
	}
}

532 
	$DISKSIM_DISK_FAST_WRITE_LEVEL_dïíd
(*
bv
)

535 
	}
}

538 
	$DISKSIM_DISK_FAST_WRITE_LEVEL_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

540 i‡(!(
	`RANGE
(
i
, 0, 2))) {

543 
ªsu…
->
Á°wrôes
 = 
i
;

545 
	}
}

548 
	$DISKSIM_DISK_COMBINE_SEQ_WRITES_dïíd
(*
bv
)

551 
	}
}

554 
	$DISKSIM_DISK_COMBINE_SEQ_WRITES_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

556 i‡(!(
	`RANGE
(
i
, 0, 1))) {

559 
ªsu…
->
wrôecomb
 = 
i
;

561 
	}
}

564 
	$DISKSIM_DISK_STOP_PREFETCH_IN_SECTOR_dïíd
(*
bv
)

567 
	}
}

570 
	$DISKSIM_DISK_STOP_PREFETCH_IN_SECTOR_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

572 i‡(!(
	`RANGE
(
i
, 0, 1))) {

575 
ªsu…
->
°›ö£˘‹
 = 
i
;

577 
	}
}

580 
	$DISKSIM_DISK_DISCONNECT_WRITE_IF_SEEK_dïíd
(*
bv
)

583 
	}
}

586 
	$DISKSIM_DISK_DISCONNECT_WRITE_IF_SEEK_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

588 i‡(!(
	`RANGE
(
i
, 0, 1))) {

591 
ªsu…
->
disc⁄√˘ö£ek
 = 
i
;

593 
	}
}

596 
	$DISKSIM_DISK_WRITE_HIT_STOP_PREFETCH_dïíd
(*
bv
)

599 
	}
}

602 
	$DISKSIM_DISK_WRITE_HIT_STOP_PREFETCH_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

604 i‡(!(
	`RANGE
(
i
, 0, 1))) {

607 
ªsu…
->
wrôe_hô_°›_ªadahód
 = 
i
;

609 
	}
}

612 
	$DISKSIM_DISK_READ_DIRECTLY_TO_BUFFER_dïíd
(*
bv
)

615 
	}
}

618 
	$DISKSIM_DISK_READ_DIRECTLY_TO_BUFFER_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

620 i‡(!(
	`RANGE
(
i
, 0, 1))) {

623 
ªsu…
->
ªad_dúe˘_to_buf„r
 = 
i
;

625 
	}
}

628 
	$DISKSIM_DISK_IMMED_TRANSFER_PARTIAL_HIT_dïíd
(*
bv
)

631 
	}
}

634 
	$DISKSIM_DISK_IMMED_TRANSFER_PARTIAL_HIT_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

636 i‡(!(
	`RANGE
(
i
, 0, 1))) {

639 
ªsu…
->
immedå™s_™y_ªadhô
 = 
i
;

641 
	}
}

644 
	$DISKSIM_DISK_READ_HIT_OVER_AFTER_READ_dïíd
(*
bv
)

647 
	}
}

650 
	$DISKSIM_DISK_READ_HIT_OVER_AFTER_READ_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

652 i‡(!(
d
 >= 0.0)) {

655 
ªsu…
->
ovîhód_comm™d_ªadhô_a·îªad
 = 
d
;

657 
	}
}

660 
	$DISKSIM_DISK_READ_HIT_OVER_AFTER_WRITE_dïíd
(*
bv
)

663 
	}
}

666 
	$DISKSIM_DISK_READ_HIT_OVER_AFTER_WRITE_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

668 i‡(!(
d
 >= 0.0)) {

671 
ªsu…
->
ovîhód_comm™d_ªadhô_a·îwrôe
 = 
d
;

673 
	}
}

676 
	$DISKSIM_DISK_READ_MISS_OVER_AFTER_READ_dïíd
(*
bv
)

679 
	}
}

682 
	$DISKSIM_DISK_READ_MISS_OVER_AFTER_READ_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

684 i‡(!(
d
 >= 0.0)) {

687 
ªsu…
->
ovîhód_comm™d_ªadmiss_a·îªad
 = 
d
;

689 
	}
}

692 
	$DISKSIM_DISK_READ_MISS_OVER_AFTER_WRITE_dïíd
(*
bv
)

695 
	}
}

698 
	$DISKSIM_DISK_READ_MISS_OVER_AFTER_WRITE_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

700 i‡(!(
d
 >= 0.0)) {

703 
ªsu…
->
ovîhód_comm™d_ªadmiss_a·îwrôe
 = 
d
;

705 
	}
}

708 
	$DISKSIM_DISK_WRITE_HIT_OVER_AFTER_READ_dïíd
(*
bv
)

711 
	}
}

714 
	$DISKSIM_DISK_WRITE_HIT_OVER_AFTER_READ_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

716 i‡(!(
d
 >= 0.0)) {

719 
ªsu…
->
ovîhód_comm™d_wrôehô_a·îªad
 = 
d
;

721 
	}
}

724 
	$DISKSIM_DISK_WRITE_HIT_OVER_AFTER_WRITE_dïíd
(*
bv
)

727 
	}
}

730 
	$DISKSIM_DISK_WRITE_HIT_OVER_AFTER_WRITE_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

732 i‡(!(
d
 >= 0.0)) {

735 
ªsu…
->
ovîhód_comm™d_wrôehô_a·îwrôe
 = 
d
;

737 
	}
}

740 
	$DISKSIM_DISK_WRITE_MISS_OVER_AFTER_READ_dïíd
(*
bv
)

743 
	}
}

746 
	$DISKSIM_DISK_WRITE_MISS_OVER_AFTER_READ_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

748 i‡(!(
d
 >= 0.0)) {

751 
ªsu…
->
ovîhód_comm™d_wrôemiss_a·îªad
 = 
d
;

753 
	}
}

756 
	$DISKSIM_DISK_WRITE_MISS_OVER_AFTER_WRITE_dïíd
(*
bv
)

759 
	}
}

762 
	$DISKSIM_DISK_WRITE_MISS_OVER_AFTER_WRITE_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

764 i‡(!(
d
 >= 0.0)) {

767 
ªsu…
->
ovîhód_comm™d_wrôemiss_a·îwrôe
 = 
d
;

769 
	}
}

772 
	$DISKSIM_DISK_READ_COMPLETION_OVERHEAD_dïíd
(*
bv
)

775 
	}
}

778 
	$DISKSIM_DISK_READ_COMPLETION_OVERHEAD_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

780 i‡(!(
d
 >= 0.0)) {

783 
ªsu…
->
ovîhód_com∂ëe_ªad
 = 
d
;

785 
	}
}

788 
	$DISKSIM_DISK_WRITE_COMPLETION_OVERHEAD_dïíd
(*
bv
)

791 
	}
}

794 
	$DISKSIM_DISK_WRITE_COMPLETION_OVERHEAD_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

796 i‡(!(
d
 >= 0.0)) {

799 
ªsu…
->
ovîhód_com∂ëe_wrôe
 = 
d
;

801 
	}
}

804 
	$DISKSIM_DISK_DATA_PREPARATION_OVERHEAD_dïíd
(*
bv
)

807 
	}
}

810 
	$DISKSIM_DISK_DATA_PREPARATION_OVERHEAD_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

812 i‡(!(
d
 >= 0.0)) {

815 
ªsu…
->
ovîhód_d©a_¥ï
 = 
d
;

817 
	}
}

820 
	$DISKSIM_DISK_FIRST_RESELECT_OVERHEAD_dïíd
(*
bv
)

823 
	}
}

826 
	$DISKSIM_DISK_FIRST_RESELECT_OVERHEAD_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

828 i‡(!(
d
 >= 0.0)) {

831 
ªsu…
->
ovîhód_ª£À˘_fú°
 = 
d
;

833 
	}
}

836 
	$DISKSIM_DISK_OTHER_RESELECT_OVERHEAD_dïíd
(*
bv
)

839 
	}
}

842 
	$DISKSIM_DISK_OTHER_RESELECT_OVERHEAD_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

844 i‡(!(
d
 >= 0.0)) {

847 
ªsu…
->
ovîhód_ª£À˘_Ÿhî
 = 
d
;

849 
	}
}

852 
	$DISKSIM_DISK_READ_DISCONNECT_AFTERREAD_dïíd
(*
bv
)

855 
	}
}

858 
	$DISKSIM_DISK_READ_DISCONNECT_AFTERREAD_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

860 i‡(!(
d
 >= 0.0)) {

863 
ªsu…
->
ovîhód_disc⁄√˘_ªad_a·îªad
 = 
d
;

865 
	}
}

868 
	$DISKSIM_DISK_READ_DISCONNECT_AFTERWRITE_dïíd
(*
bv
)

871 
	}
}

874 
	$DISKSIM_DISK_READ_DISCONNECT_AFTERWRITE_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

876 i‡(!(
d
 >= 0.0)) {

879 
ªsu…
->
ovîhód_disc⁄√˘_ªad_a·îwrôe
 = 
d
;

881 
	}
}

884 
	$DISKSIM_DISK_WRITE_DISCONNECT_OVERHEAD_dïíd
(*
bv
)

887 
	}
}

890 
	$DISKSIM_DISK_WRITE_DISCONNECT_OVERHEAD_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

892 i‡(!(
d
 >= 0.0)) {

895 
ªsu…
->
ovîhód_disc⁄√˘_wrôe
 = 
d
;

897 
	}
}

900 
	$DISKSIM_DISK_EXTRA_WRITE_DISCONNECT_dïíd
(*
bv
)

903 
	}
}

906 
	$DISKSIM_DISK_EXTRA_WRITE_DISCONNECT_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

908 i‡(!(
	`RANGE
(
i
, 0, 1))) {

911 
ªsu…
->
exåa_wrôe_disc⁄√˘
 = 
i
;

913 
	}
}

916 
	$DISKSIM_DISK_EXTRADISC_COMMAND_OVERHEAD_dïíd
(*
bv
)

919 
	}
}

922 
	$DISKSIM_DISK_EXTRADISC_COMMAND_OVERHEAD_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

924 i‡(!(
d
 >= 0.0)) {

927 
ªsu…
->
exåadisc_comm™d
 = 
d
;

929 
	}
}

932 
	$DISKSIM_DISK_EXTRADISC_DISCONNECT_OVERHEAD_dïíd
(*
bv
)

935 
	}
}

938 
	$DISKSIM_DISK_EXTRADISC_DISCONNECT_OVERHEAD_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

940 i‡(!(
d
 >= 0.0)) {

943 
ªsu…
->
exåadisc_disc⁄√˘1
 = 
d
;

945 
	}
}

948 
	$DISKSIM_DISK_EXTRADISC_INTER_DISCONNECT_DELAY_dïíd
(*
bv
)

951 
	}
}

954 
	$DISKSIM_DISK_EXTRADISC_INTER_DISCONNECT_DELAY_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

956 i‡(!(
d
 >= 0.0)) {

959 
ªsu…
->
exåadisc_öãr_disc⁄√˘
 = 
d
;

961 
	}
}

964 
	$DISKSIM_DISK_EXTRADISC_2ND_DISCONNECT_OVERHEAD_dïíd
(*
bv
)

967 
	}
}

970 
	$DISKSIM_DISK_EXTRADISC_2ND_DISCONNECT_OVERHEAD_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

972 i‡(!(
d
 >= 0.0)) {

975 
ªsu…
->
exåadisc_disc⁄√˘2
 = 
d
;

977 
	}
}

980 
	$DISKSIM_DISK_EXTRADISC_SEEK_DELTA_dïíd
(*
bv
)

983 
	}
}

986 
	$DISKSIM_DISK_EXTRADISC_SEEK_DELTA_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

988 i‡(!(
d
 >= 0.0)) {

991 
ªsu…
->
exåadisc_£ekdñè
 = 
d
;

993 
	}
}

996 
	$DISKSIM_DISK_MINIMUM_SEEK_DELAY_dïíd
(*
bv
)

999 
	}
}

1002 
	$DISKSIM_DISK_MINIMUM_SEEK_DELAY_lﬂdî
(
disk
 * 
ªsu…
, 
d
)

1004 i‡(!(
d
 >= 0.0)) {

1007 
ªsu…
->
möimum_£ek_dñay
 = 
d
;

1009 
	}
}

1012 
	$DISKSIM_DISK_IMMEDIATE_BUFFER_READ_dïíd
(*
bv
)

1015 
	}
}

1018 
	$DISKSIM_DISK_IMMEDIATE_BUFFER_READ_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

1020 i‡(!(
	`RANGE
(
i
, 0, 2))) {

1023 
ªsu…
->
immedªad
 = 
i
;

1025 
	}
}

1028 
	$DISKSIM_DISK_IMMEDIATE_BUFFER_WRITE_dïíd
(*
bv
)

1031 
	}
}

1034 
	$DISKSIM_DISK_IMMEDIATE_BUFFER_WRITE_lﬂdî
(
disk
 * 
ªsu…
, 
i
)

1036 i‡(!(
	`RANGE
(
i
, 0, 2))) {

1039 
ªsu…
->
immedwrôe
 = 
i
;

1041 
	}
}

1043 *
	gDISKSIM_DISK_lﬂdîs
[] = {

1044 (*Ë
DISKSIM_DISK_MODEL_lﬂdî
,

1045 (*Ë
DISKSIM_DISK_SCHEDULER_lﬂdî
,

1046 (*Ë
DISKSIM_DISK_MAX_QUEUE_LENGTH_lﬂdî
,

1047 (*Ë
DISKSIM_DISK_BULK_SECTOR_TRANSFER_TIME_lﬂdî
,

1048 (*Ë
DISKSIM_DISK_SEGMENT_SIZE__lﬂdî
,

1049 (*Ë
DISKSIM_DISK_NUMBER_OF_BUFFER_SEGMENTS_lﬂdî
,

1050 (*Ë
DISKSIM_DISK_PRINT_STATS_lﬂdî
,

1051 (*Ë
DISKSIM_DISK_PER_REQUEST_OVERHEAD_TIME_lﬂdî
,

1052 (*Ë
DISKSIM_DISK_TIME_SCALE_FOR_OVERHEADS_lﬂdî
,

1053 (*Ë
DISKSIM_DISK_HOLD_BUS_ENTIRE_READ_XFER_lﬂdî
,

1054 (*Ë
DISKSIM_DISK_HOLD_BUS_ENTIRE_WRITE_XFER_lﬂdî
,

1055 (*Ë
DISKSIM_DISK_ALLOW_ALMOST_READ_HITS_lﬂdî
,

1056 (*Ë
DISKSIM_DISK_ALLOW_SNEAKY_FULL_READ_HITS_lﬂdî
,

1057 (*Ë
DISKSIM_DISK_ALLOW_SNEAKY_PARTIAL_READ_HITS_lﬂdî
,

1058 (*Ë
DISKSIM_DISK_ALLOW_SNEAKY_INTERMEDIATE_READ_HITS_lﬂdî
,

1059 (*Ë
DISKSIM_DISK_ALLOW_READ_HITS_ON_WRITE_DATA_lﬂdî
,

1060 (*Ë
DISKSIM_DISK_ALLOW_WRITE_PREBUFFERING_lﬂdî
,

1061 (*Ë
DISKSIM_DISK_PRESEEKING_LEVEL_lﬂdî
,

1062 (*Ë
DISKSIM_DISK_NEVER_DISCONNECT_lﬂdî
,

1063 (*Ë
DISKSIM_DISK_AVG_SECTORS_PER_CYLINDER_lﬂdî
,

1064 (*Ë
DISKSIM_DISK_MAXIMUM_NUMBER_OF_WRITE_SEGMENTS_lﬂdî
,

1065 (*Ë
DISKSIM_DISK_USE_SEPARATE_WRITE_SEGMENT_lﬂdî
,

1066 (*Ë
DISKSIM_DISK_LOW__WATER_MARK_lﬂdî
,

1067 (*Ë
DISKSIM_DISK_HIGH__WATER_MARK_lﬂdî
,

1068 (*Ë
DISKSIM_DISK_SET_WATERMARK_BY_REQSIZE_lﬂdî
,

1069 (*Ë
DISKSIM_DISK_CALC_SECTOR_BY_SECTOR_lﬂdî
,

1070 (*Ë
DISKSIM_DISK_ENABLE_CACHING_IN_BUFFER_lﬂdî
,

1071 (*Ë
DISKSIM_DISK_BUFFER_CONTINUOUS_READ_lﬂdî
,

1072 (*Ë
DISKSIM_DISK_MINIMUM_READ_AHEAD__lﬂdî
,

1073 (*Ë
DISKSIM_DISK_MAXIMUM_READ_AHEAD__lﬂdî
,

1074 (*Ë
DISKSIM_DISK_READ_AHEAD_OVER_REQUESTED_lﬂdî
,

1075 (*Ë
DISKSIM_DISK_READ_AHEAD_ON_IDLE_HIT_lﬂdî
,

1076 (*Ë
DISKSIM_DISK_READ_ANY_FREE_BLOCKS_lﬂdî
,

1077 (*Ë
DISKSIM_DISK_FAST_WRITE_LEVEL_lﬂdî
,

1078 (*Ë
DISKSIM_DISK_COMBINE_SEQ_WRITES_lﬂdî
,

1079 (*Ë
DISKSIM_DISK_STOP_PREFETCH_IN_SECTOR_lﬂdî
,

1080 (*Ë
DISKSIM_DISK_DISCONNECT_WRITE_IF_SEEK_lﬂdî
,

1081 (*Ë
DISKSIM_DISK_WRITE_HIT_STOP_PREFETCH_lﬂdî
,

1082 (*Ë
DISKSIM_DISK_READ_DIRECTLY_TO_BUFFER_lﬂdî
,

1083 (*Ë
DISKSIM_DISK_IMMED_TRANSFER_PARTIAL_HIT_lﬂdî
,

1084 (*Ë
DISKSIM_DISK_READ_HIT_OVER_AFTER_READ_lﬂdî
,

1085 (*Ë
DISKSIM_DISK_READ_HIT_OVER_AFTER_WRITE_lﬂdî
,

1086 (*Ë
DISKSIM_DISK_READ_MISS_OVER_AFTER_READ_lﬂdî
,

1087 (*Ë
DISKSIM_DISK_READ_MISS_OVER_AFTER_WRITE_lﬂdî
,

1088 (*Ë
DISKSIM_DISK_WRITE_HIT_OVER_AFTER_READ_lﬂdî
,

1089 (*Ë
DISKSIM_DISK_WRITE_HIT_OVER_AFTER_WRITE_lﬂdî
,

1090 (*Ë
DISKSIM_DISK_WRITE_MISS_OVER_AFTER_READ_lﬂdî
,

1091 (*Ë
DISKSIM_DISK_WRITE_MISS_OVER_AFTER_WRITE_lﬂdî
,

1092 (*Ë
DISKSIM_DISK_READ_COMPLETION_OVERHEAD_lﬂdî
,

1093 (*Ë
DISKSIM_DISK_WRITE_COMPLETION_OVERHEAD_lﬂdî
,

1094 (*Ë
DISKSIM_DISK_DATA_PREPARATION_OVERHEAD_lﬂdî
,

1095 (*Ë
DISKSIM_DISK_FIRST_RESELECT_OVERHEAD_lﬂdî
,

1096 (*Ë
DISKSIM_DISK_OTHER_RESELECT_OVERHEAD_lﬂdî
,

1097 (*Ë
DISKSIM_DISK_READ_DISCONNECT_AFTERREAD_lﬂdî
,

1098 (*Ë
DISKSIM_DISK_READ_DISCONNECT_AFTERWRITE_lﬂdî
,

1099 (*Ë
DISKSIM_DISK_WRITE_DISCONNECT_OVERHEAD_lﬂdî
,

1100 (*Ë
DISKSIM_DISK_EXTRA_WRITE_DISCONNECT_lﬂdî
,

1101 (*Ë
DISKSIM_DISK_EXTRADISC_COMMAND_OVERHEAD_lﬂdî
,

1102 (*Ë
DISKSIM_DISK_EXTRADISC_DISCONNECT_OVERHEAD_lﬂdî
,

1103 (*Ë
DISKSIM_DISK_EXTRADISC_INTER_DISCONNECT_DELAY_lﬂdî
,

1104 (*Ë
DISKSIM_DISK_EXTRADISC_2ND_DISCONNECT_OVERHEAD_lﬂdî
,

1105 (*Ë
DISKSIM_DISK_EXTRADISC_SEEK_DELTA_lﬂdî
,

1106 (*Ë
DISKSIM_DISK_MINIMUM_SEEK_DELAY_lﬂdî
,

1107 (*Ë
DISKSIM_DISK_IMMEDIATE_BUFFER_READ_lﬂdî
,

1108 (*Ë
DISKSIM_DISK_IMMEDIATE_BUFFER_WRITE_lﬂdî


1111 
Õ_∑ømdï_t
 
	gDISKSIM_DISK_dïs
[] = {

1112 
DISKSIM_DISK_MODEL_dïíd
,

1113 
DISKSIM_DISK_SCHEDULER_dïíd
,

1114 
DISKSIM_DISK_MAX_QUEUE_LENGTH_dïíd
,

1115 
DISKSIM_DISK_BULK_SECTOR_TRANSFER_TIME_dïíd
,

1116 
DISKSIM_DISK_SEGMENT_SIZE__dïíd
,

1117 
DISKSIM_DISK_NUMBER_OF_BUFFER_SEGMENTS_dïíd
,

1118 
DISKSIM_DISK_PRINT_STATS_dïíd
,

1119 
DISKSIM_DISK_PER_REQUEST_OVERHEAD_TIME_dïíd
,

1120 
DISKSIM_DISK_TIME_SCALE_FOR_OVERHEADS_dïíd
,

1121 
DISKSIM_DISK_HOLD_BUS_ENTIRE_READ_XFER_dïíd
,

1122 
DISKSIM_DISK_HOLD_BUS_ENTIRE_WRITE_XFER_dïíd
,

1123 
DISKSIM_DISK_ALLOW_ALMOST_READ_HITS_dïíd
,

1124 
DISKSIM_DISK_ALLOW_SNEAKY_FULL_READ_HITS_dïíd
,

1125 
DISKSIM_DISK_ALLOW_SNEAKY_PARTIAL_READ_HITS_dïíd
,

1126 
DISKSIM_DISK_ALLOW_SNEAKY_INTERMEDIATE_READ_HITS_dïíd
,

1127 
DISKSIM_DISK_ALLOW_READ_HITS_ON_WRITE_DATA_dïíd
,

1128 
DISKSIM_DISK_ALLOW_WRITE_PREBUFFERING_dïíd
,

1129 
DISKSIM_DISK_PRESEEKING_LEVEL_dïíd
,

1130 
DISKSIM_DISK_NEVER_DISCONNECT_dïíd
,

1131 
DISKSIM_DISK_AVG_SECTORS_PER_CYLINDER_dïíd
,

1132 
DISKSIM_DISK_MAXIMUM_NUMBER_OF_WRITE_SEGMENTS_dïíd
,

1133 
DISKSIM_DISK_USE_SEPARATE_WRITE_SEGMENT_dïíd
,

1134 
DISKSIM_DISK_LOW__WATER_MARK_dïíd
,

1135 
DISKSIM_DISK_HIGH__WATER_MARK_dïíd
,

1136 
DISKSIM_DISK_SET_WATERMARK_BY_REQSIZE_dïíd
,

1137 
DISKSIM_DISK_CALC_SECTOR_BY_SECTOR_dïíd
,

1138 
DISKSIM_DISK_ENABLE_CACHING_IN_BUFFER_dïíd
,

1139 
DISKSIM_DISK_BUFFER_CONTINUOUS_READ_dïíd
,

1140 
DISKSIM_DISK_MINIMUM_READ_AHEAD__dïíd
,

1141 
DISKSIM_DISK_MAXIMUM_READ_AHEAD__dïíd
,

1142 
DISKSIM_DISK_READ_AHEAD_OVER_REQUESTED_dïíd
,

1143 
DISKSIM_DISK_READ_AHEAD_ON_IDLE_HIT_dïíd
,

1144 
DISKSIM_DISK_READ_ANY_FREE_BLOCKS_dïíd
,

1145 
DISKSIM_DISK_FAST_WRITE_LEVEL_dïíd
,

1146 
DISKSIM_DISK_COMBINE_SEQ_WRITES_dïíd
,

1147 
DISKSIM_DISK_STOP_PREFETCH_IN_SECTOR_dïíd
,

1148 
DISKSIM_DISK_DISCONNECT_WRITE_IF_SEEK_dïíd
,

1149 
DISKSIM_DISK_WRITE_HIT_STOP_PREFETCH_dïíd
,

1150 
DISKSIM_DISK_READ_DIRECTLY_TO_BUFFER_dïíd
,

1151 
DISKSIM_DISK_IMMED_TRANSFER_PARTIAL_HIT_dïíd
,

1152 
DISKSIM_DISK_READ_HIT_OVER_AFTER_READ_dïíd
,

1153 
DISKSIM_DISK_READ_HIT_OVER_AFTER_WRITE_dïíd
,

1154 
DISKSIM_DISK_READ_MISS_OVER_AFTER_READ_dïíd
,

1155 
DISKSIM_DISK_READ_MISS_OVER_AFTER_WRITE_dïíd
,

1156 
DISKSIM_DISK_WRITE_HIT_OVER_AFTER_READ_dïíd
,

1157 
DISKSIM_DISK_WRITE_HIT_OVER_AFTER_WRITE_dïíd
,

1158 
DISKSIM_DISK_WRITE_MISS_OVER_AFTER_READ_dïíd
,

1159 
DISKSIM_DISK_WRITE_MISS_OVER_AFTER_WRITE_dïíd
,

1160 
DISKSIM_DISK_READ_COMPLETION_OVERHEAD_dïíd
,

1161 
DISKSIM_DISK_WRITE_COMPLETION_OVERHEAD_dïíd
,

1162 
DISKSIM_DISK_DATA_PREPARATION_OVERHEAD_dïíd
,

1163 
DISKSIM_DISK_FIRST_RESELECT_OVERHEAD_dïíd
,

1164 
DISKSIM_DISK_OTHER_RESELECT_OVERHEAD_dïíd
,

1165 
DISKSIM_DISK_READ_DISCONNECT_AFTERREAD_dïíd
,

1166 
DISKSIM_DISK_READ_DISCONNECT_AFTERWRITE_dïíd
,

1167 
DISKSIM_DISK_WRITE_DISCONNECT_OVERHEAD_dïíd
,

1168 
DISKSIM_DISK_EXTRA_WRITE_DISCONNECT_dïíd
,

1169 
DISKSIM_DISK_EXTRADISC_COMMAND_OVERHEAD_dïíd
,

1170 
DISKSIM_DISK_EXTRADISC_DISCONNECT_OVERHEAD_dïíd
,

1171 
DISKSIM_DISK_EXTRADISC_INTER_DISCONNECT_DELAY_dïíd
,

1172 
DISKSIM_DISK_EXTRADISC_2ND_DISCONNECT_OVERHEAD_dïíd
,

1173 
DISKSIM_DISK_EXTRADISC_SEEK_DELTA_dïíd
,

1174 
DISKSIM_DISK_MINIMUM_SEEK_DELAY_dïíd
,

1175 
DISKSIM_DISK_IMMEDIATE_BUFFER_READ_dïíd
,

1176 
DISKSIM_DISK_IMMEDIATE_BUFFER_WRITE_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_disk_param.h

2 #i‚de‡
_DISKSIM_DISK_PARAM_H


3 
	#_DISKSIM_DISK_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disk
 *
disksim_disk_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
DISKSIM_DISK_MODEL
,

16 
DISKSIM_DISK_SCHEDULER
,

17 
DISKSIM_DISK_MAX_QUEUE_LENGTH
,

18 
DISKSIM_DISK_BULK_SECTOR_TRANSFER_TIME
,

19 
DISKSIM_DISK_SEGMENT_SIZE_
,

20 
DISKSIM_DISK_NUMBER_OF_BUFFER_SEGMENTS
,

21 
DISKSIM_DISK_PRINT_STATS
,

22 
DISKSIM_DISK_PER_REQUEST_OVERHEAD_TIME
,

23 
DISKSIM_DISK_TIME_SCALE_FOR_OVERHEADS
,

24 
DISKSIM_DISK_HOLD_BUS_ENTIRE_READ_XFER
,

25 
DISKSIM_DISK_HOLD_BUS_ENTIRE_WRITE_XFER
,

26 
DISKSIM_DISK_ALLOW_ALMOST_READ_HITS
,

27 
DISKSIM_DISK_ALLOW_SNEAKY_FULL_READ_HITS
,

28 
DISKSIM_DISK_ALLOW_SNEAKY_PARTIAL_READ_HITS
,

29 
DISKSIM_DISK_ALLOW_SNEAKY_INTERMEDIATE_READ_HITS
,

30 
DISKSIM_DISK_ALLOW_READ_HITS_ON_WRITE_DATA
,

31 
DISKSIM_DISK_ALLOW_WRITE_PREBUFFERING
,

32 
DISKSIM_DISK_PRESEEKING_LEVEL
,

33 
DISKSIM_DISK_NEVER_DISCONNECT
,

34 
DISKSIM_DISK_AVG_SECTORS_PER_CYLINDER
,

35 
DISKSIM_DISK_MAXIMUM_NUMBER_OF_WRITE_SEGMENTS
,

36 
DISKSIM_DISK_USE_SEPARATE_WRITE_SEGMENT
,

37 
DISKSIM_DISK_LOW__WATER_MARK
,

38 
DISKSIM_DISK_HIGH__WATER_MARK
,

39 
DISKSIM_DISK_SET_WATERMARK_BY_REQSIZE
,

40 
DISKSIM_DISK_CALC_SECTOR_BY_SECTOR
,

41 
DISKSIM_DISK_ENABLE_CACHING_IN_BUFFER
,

42 
DISKSIM_DISK_BUFFER_CONTINUOUS_READ
,

43 
DISKSIM_DISK_MINIMUM_READ_AHEAD_
,

44 
DISKSIM_DISK_MAXIMUM_READ_AHEAD_
,

45 
DISKSIM_DISK_READ_AHEAD_OVER_REQUESTED
,

46 
DISKSIM_DISK_READ_AHEAD_ON_IDLE_HIT
,

47 
DISKSIM_DISK_READ_ANY_FREE_BLOCKS
,

48 
DISKSIM_DISK_FAST_WRITE_LEVEL
,

49 
DISKSIM_DISK_COMBINE_SEQ_WRITES
,

50 
DISKSIM_DISK_STOP_PREFETCH_IN_SECTOR
,

51 
DISKSIM_DISK_DISCONNECT_WRITE_IF_SEEK
,

52 
DISKSIM_DISK_WRITE_HIT_STOP_PREFETCH
,

53 
DISKSIM_DISK_READ_DIRECTLY_TO_BUFFER
,

54 
DISKSIM_DISK_IMMED_TRANSFER_PARTIAL_HIT
,

55 
DISKSIM_DISK_READ_HIT_OVER_AFTER_READ
,

56 
DISKSIM_DISK_READ_HIT_OVER_AFTER_WRITE
,

57 
DISKSIM_DISK_READ_MISS_OVER_AFTER_READ
,

58 
DISKSIM_DISK_READ_MISS_OVER_AFTER_WRITE
,

59 
DISKSIM_DISK_WRITE_HIT_OVER_AFTER_READ
,

60 
DISKSIM_DISK_WRITE_HIT_OVER_AFTER_WRITE
,

61 
DISKSIM_DISK_WRITE_MISS_OVER_AFTER_READ
,

62 
DISKSIM_DISK_WRITE_MISS_OVER_AFTER_WRITE
,

63 
DISKSIM_DISK_READ_COMPLETION_OVERHEAD
,

64 
DISKSIM_DISK_WRITE_COMPLETION_OVERHEAD
,

65 
DISKSIM_DISK_DATA_PREPARATION_OVERHEAD
,

66 
DISKSIM_DISK_FIRST_RESELECT_OVERHEAD
,

67 
DISKSIM_DISK_OTHER_RESELECT_OVERHEAD
,

68 
DISKSIM_DISK_READ_DISCONNECT_AFTERREAD
,

69 
DISKSIM_DISK_READ_DISCONNECT_AFTERWRITE
,

70 
DISKSIM_DISK_WRITE_DISCONNECT_OVERHEAD
,

71 
DISKSIM_DISK_EXTRA_WRITE_DISCONNECT
,

72 
DISKSIM_DISK_EXTRADISC_COMMAND_OVERHEAD
,

73 
DISKSIM_DISK_EXTRADISC_DISCONNECT_OVERHEAD
,

74 
DISKSIM_DISK_EXTRADISC_INTER_DISCONNECT_DELAY
,

75 
DISKSIM_DISK_EXTRADISC_2ND_DISCONNECT_OVERHEAD
,

76 
DISKSIM_DISK_EXTRADISC_SEEK_DELTA
,

77 
DISKSIM_DISK_MINIMUM_SEEK_DELAY
,

78 
DISKSIM_DISK_IMMEDIATE_BUFFER_READ
,

79 
DISKSIM_DISK_IMMEDIATE_BUFFER_WRITE


80 } 
	tdisksim_disk_∑øm_t
;

82 
	#DISKSIM_DISK_MAX_PARAM
 
DISKSIM_DISK_IMMEDIATE_BUFFER_WRITE


	)

83 * 
DISKSIM_DISK_lﬂdîs
[];

84 
Õ_∑ømdï_t
 
DISKSIM_DISK_dïs
[];

87 
Õ_v¨•ec
 
	gdisksim_disk_∑øms
 [] = {

88 {"Modñ", 
BLOCK
, 1 },

89 {"ScheduÀr", 
BLOCK
, 1 },

90 {"Max queuêÀngth", 
I
, 1 },

91 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

92 {"Segmíàsizê(ö blks)", 
I
, 1 },

93 {"Numbî o‡buf„∏£gmíts", 
I
, 1 },

94 {"Pröà°©s", 
I
, 1 },

95 {"Pî-ªque° ovîhódÅime", 
D
, 1 },

96 {"TimêsˇÀ f‹ ovîhóds", 
D
, 1 },

97 {"Hﬁd bu†ítúêªad x„r", 
I
, 1 },

98 {"Hﬁd bu†ítúêwrôêx„r", 
I
, 1 },

99 {"AŒowálmo°Ñód hôs", 
I
, 1 },

100 {"AŒow s√aky fuŒÑód hôs", 
I
, 1 },

101 {"AŒow s√akyÖ¨tü»ªad hôs", 
I
, 1 },

102 {"AŒow s√aky i¡îmedüãÑód hôs", 
I
, 1 },

103 {"AŒowÑód hô†⁄ wrôêd©a", 
I
, 1 },

104 {"AŒow wrôê¥ebuf„rög", 
I
, 1 },

105 {"Pª£ekögÜevñ", 
I
, 1 },

106 {"Nevî disc⁄√˘", 
I
, 1 },

107 {"Avg se˘‹†≥∏cylödî", 
I
, 1 },

108 {"MaximumÇumbî o‡wrôê£gmíts", 
I
, 1 },

109 {"U£ sï¨©êwrôê£gmít", 
I
, 1 },

110 {"Low (wrôeËw©î m¨k", 
D
, 1 },

111 {"High (ªadËw©î m¨k", 
D
, 1 },

112 {"Së w©îm¨k byÑeqsize", 
I
, 1 },

113 {"CÆ¯£˘‹ by se˘‹", 
I
, 1 },

114 {"E«bÀ cachög i¿buf„r", 
I
, 1 },

115 {"Buf„∏c⁄töuou†ªad", 
I
, 1 },

116 {"MöimumÑód-ahód (blks)", 
I
, 1 },

117 {"MaximumÑód-ahód (blks)", 
I
, 1 },

118 {"Ród-ahód ovîÑeque°ed", 
I
, 1 },

119 {"Ród-ahód o¿idÀ hô", 
I
, 1 },

120 {"Ródány fªêblocks", 
I
, 1 },

121 {"Fa° wrôêÀvñ", 
I
, 1 },

122 {"Comböê£q wrôes", 
I
, 1 },

123 {"St›Öª„tch i¿£˘‹", 
I
, 1 },

124 {"Disc⁄√˘ wrôêi‡£ek", 
I
, 1 },

125 {"Wrôêhô st›Öª„tch", 
I
, 1 },

126 {"Ród dúe˘lyÅÿbuf„r", 
I
, 1 },

127 {"ImmedÅøns„∏∑πü»hô", 
I
, 1 },

128 {"Ród hô ovî.á·îÑód", 
D
, 1 },

129 {"Ród hô ovî.á·î wrôe", 
D
, 1 },

130 {"Ród mis†ovî.á·îÑód", 
D
, 1 },

131 {"Ród mis†ovî.á·î wrôe", 
D
, 1 },

132 {"Wrôêhô ovî.á·îÑód", 
D
, 1 },

133 {"Wrôêhô ovî.á·î wrôe", 
D
, 1 },

134 {"Wrôêmis†ovî.á·îÑód", 
D
, 1 },

135 {"Wrôêmis†ovî.á·î wrôe", 
D
, 1 },

136 {"Ród com∂ëi⁄ ovîhód", 
D
, 1 },

137 {"Wrôêcom∂ëi⁄ ovîhód", 
D
, 1 },

138 {"D©®¥ï¨©i⁄ ovîhód", 
D
, 1 },

139 {"Fú°Ñe£À˘ ovîhód", 
D
, 1 },

140 {"OthîÑe£À˘ ovîhód", 
D
, 1 },

141 {"Ród disc⁄√˘á·îªad", 
D
, 1 },

142 {"Ród disc⁄√˘á·îwrôe", 
D
, 1 },

143 {"Wrôêdisc⁄√˘ ovîhód", 
D
, 1 },

144 {"Exå®wrôêdisc⁄√˘", 
I
, 1 },

145 {"Exåadis¯comm™d ovîhód", 
D
, 1 },

146 {"Exåadis¯disc⁄√˘ ovîhód", 
D
, 1 },

147 {"Exåadis¯öãr-disc⁄√˘ dñay", 
D
, 1 },

148 {"Exåadis¯2nd disc⁄√˘ ovîhód", 
D
, 1 },

149 {"Exåadis¯£ek dñè", 
D
, 1 },

150 {"Möimum sìk dñay", 
D
, 1 },

151 {"Immedüã buf„∏ªad", 
I
, 1 },

152 {"Immedüã buf„∏wrôe", 
I
, 1 },

155 
	#DISKSIM_DISK_MAX
 65

	)

156 
Õ_mod
 
	gdisksim_disk_mod
 = { "disksim_disk", 
disksim_disk_∑øms
, 
DISKSIM_DISK_MAX
, (
Õ_modlﬂdî_t
)
disksim_disk_lﬂd∑øms
, 0, 0, 
DISKSIM_DISK_lﬂdîs
, 
DISKSIM_DISK_dïs
 };

159 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_fcl_param.c

1 
	~"disksim_f˛_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_f˛.h
"

5 
	$DISKSIM_FCL_PAGE_SIZE_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_FCL_PAGE_SIZE_lﬂdî
(
f˛_∑ømëîs
 * 
ªsu…
, 
i
)

13 i‡(!((
i
 >= 0))) {

16 
ªsu…
->
Âa_∑ge_size
 = 
i
;

18 
	}
}

21 
	$DISKSIM_FCL_MAX_PAGES_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_FCL_MAX_PAGES_lﬂdî
(
f˛_∑ømëîs
 * 
ªsu…
, 
i
)

29 i‡(!((
i
 >= 0))) {

32 
ªsu…
->
Âa_max_∑ges
 = 
i
;

34 
	}
}

37 
	$DISKSIM_FCL_BYPASS_CACHE_dïíd
(*
bv
)

40 
	}
}

43 
	$DISKSIM_FCL_BYPASS_CACHE_lﬂdî
(
f˛_∑ømëîs
 * 
ªsu…
, 
i
)

45 i‡(!((
i
 >= 0))) {

48 
ªsu…
->
Âa_by∑ss_ˇche
 = 
i
;

50 
	}
}

53 
	$DISKSIM_FCL_IDLE_DETECT_TIME_dïíd
(*
bv
)

56 
	}
}

59 
	$DISKSIM_FCL_IDLE_DETECT_TIME_lﬂdî
(
f˛_∑ømëîs
 * 
ªsu…
, 
d
)

61 i‡(!((
d
 >= 0))) {

64 
ªsu…
->
Âa_idÀ_dëe˘_time
 = 
d
;

66 
	}
}

68 *
	gDISKSIM_FCL_lﬂdîs
[] = {

69 (*Ë
DISKSIM_FCL_PAGE_SIZE_lﬂdî
,

70 (*Ë
DISKSIM_FCL_MAX_PAGES_lﬂdî
,

71 (*Ë
DISKSIM_FCL_BYPASS_CACHE_lﬂdî
,

72 (*Ë
DISKSIM_FCL_IDLE_DETECT_TIME_lﬂdî


75 
Õ_∑ømdï_t
 
	gDISKSIM_FCL_dïs
[] = {

76 
DISKSIM_FCL_PAGE_SIZE_dïíd
,

77 
DISKSIM_FCL_MAX_PAGES_dïíd
,

78 
DISKSIM_FCL_BYPASS_CACHE_dïíd
,

79 
DISKSIM_FCL_IDLE_DETECT_TIME_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_fcl_param.h

2 #i‚de‡
_DISKSIM_FCL_PARAM_H


3 
	#_DISKSIM_FCL_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_f˛_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
DISKSIM_FCL_PAGE_SIZE
,

16 
DISKSIM_FCL_MAX_PAGES
,

17 
DISKSIM_FCL_BYPASS_CACHE
,

18 
DISKSIM_FCL_IDLE_DETECT_TIME


19 } 
	tdisksim_f˛_∑øm_t
;

21 
	#DISKSIM_FCL_MAX_PARAM
 
DISKSIM_FCL_IDLE_DETECT_TIME


	)

22 * 
DISKSIM_FCL_lﬂdîs
[];

23 
Õ_∑ømdï_t
 
DISKSIM_FCL_dïs
[];

26 
Õ_v¨•ec
 
	gdisksim_f˛_∑øms
 [] = {

27 {"PagêSize", 
I
, 1 },

28 {"Max Pages", 
I
, 1 },

29 {"By∑s†Cache", 
I
, 1 },

30 {"IdÀ Dëe˘ Time", 
D
, 1 },

33 
	#DISKSIM_FCL_MAX
 4

	)

34 
Õ_mod
 
	gdisksim_f˛_mod
 = { "disksim_f˛", 
disksim_f˛_∑øms
, 
DISKSIM_FCL_MAX
, (
Õ_modlﬂdî_t
)
disksim_f˛_lﬂd∑øms
, 0, 0, 
DISKSIM_FCL_lﬂdîs
, 
DISKSIM_FCL_dïs
 };

37 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_global_param.c

1 
	~"disksim_globÆ_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_globÆ.h
"

4 
	~<libddbg/libddbg.h
>

6 
	$DISKSIM_GLOBAL_INIT_SEED_dïíd
(*
bv
)

9 
	}
}

12 
	$DISKSIM_GLOBAL_INIT_SEED_lﬂdî
(
ªsu…
, 
i
)

14 
disksim
->
£edvÆ
 = 
i
;

15 
	`DISKSIM_§™d48
(
disksim
->
£edvÆ
);

17 
	}
}

20 
	$DISKSIM_GLOBAL_INIT_SEED_WITH_TIME_dïíd
(*
bv
)

23 
	}
}

26 
	$DISKSIM_GLOBAL_INIT_SEED_WITH_TIME_lﬂdî
(
ªsu…
, 
i
)

28 i‡(!(
	`RANGE
(
i
, 0, 1))) {

31 i‡(
i
) {

32 
disksim
->
£edvÆ
 = 
	`DISKSIM_time
();

34 
	}
}

37 
	$DISKSIM_GLOBAL_REAL_SEED_dïíd
(*
bv
)

40 
	}
}

43 
	$DISKSIM_GLOBAL_REAL_SEED_lﬂdî
(
ªsu…
, 
i
)

45 
disksim
->
£edvÆ
 = 
i
;

47 
	}
}

50 
	$DISKSIM_GLOBAL_REAL_SEED_WITH_TIME_dïíd
(*
bv
)

53 
	}
}

56 
	$DISKSIM_GLOBAL_REAL_SEED_WITH_TIME_lﬂdî
(
ªsu…
, 
i
)

58 i‡(!(
	`RANGE
(
i
, 0, 1))) {

61 
disksim
->
£edvÆ
 = 
	`DISKSIM_time
();

63 
	}
}

66 
	$DISKSIM_GLOBAL_STATISTIC_WARM_UP_TIME_dïíd
(*
bv
)

69 
	}
}

72 
	$DISKSIM_GLOBAL_STATISTIC_WARM_UP_TIME_lﬂdî
(
ªsu…
, 
d
)

74 i‡(!((
d
 >= 0))) {

77 
disksim
->
w¨mup_evít
 = (
timî_evít
 *Ë
	`gë‰omexåaq
();

78 
disksim
->
w¨mup_evít
->
ty≥
 = 
TIMER_EXPIRED
;

79 
disksim
->
w¨mup_evít
->
time
 = 
d
 * () 1000.0;

80 
disksim
->
w¨mup_evít
->
func
 = &disksim->
timîfunc_disksim
;

82 
	}
}

85 
	$DISKSIM_GLOBAL_STATISTIC_WARM_UP_IOS_dïíd
(*
bv
)

88 
	}
}

91 
	$DISKSIM_GLOBAL_STATISTIC_WARM_UP_IOS_lﬂdî
(
ªsu…
, 
i
)

93 i‡(!((
i
 >= 0))) {

96 
disksim
->
w¨mup_io˙t
 = 
i
;

98 
	}
}

101 
	$DISKSIM_GLOBAL_STAT_DEFINITION_FILE_dïíd
(*
bv
)

104 
	}
}

107 
	$DISKSIM_GLOBAL_STAT_DEFINITION_FILE_lﬂdî
(
ªsu…
, *
s
)

109 *
∑th
 = 
	`Õ_£¨ch_∑th
(
Õ_cwd
, 
s
);

110 i‡(!
∑th
) {

111 
	`ddbg_as£π2
(0, "Couldn't find statdefs file inÖath");

113 
°©deffûe
 = 
	`f›í
(
∑th
, "r");

114 
	`ddbg_as£π2
(
°©deffûe
 != 0, "failedÅo open statdefs file!");

117 
	}
}

120 
	$DISKSIM_GLOBAL_OUTPUT_FILE_FOR_TRACE_OF_IO_REQUESTS_SIMULATED_dïíd
(*
bv
)

123 
	}
}

126 
	$DISKSIM_GLOBAL_OUTPUT_FILE_FOR_TRACE_OF_IO_REQUESTS_SIMULATED_lﬂdî
(
ªsu…
, *
s
)

128 i‡(!((
outios
 = 
	`f›í
(
s
, "w")Ë!
NULL
)) {

131 
	`°r˝y
(
disksim
->
outiosfûíame
, 
s
);

133 
	}
}

136 
	$DISKSIM_GLOBAL_DETAILED_EXECUTION_TRACE_dïíd
(*
bv
)

139 
	}
}

142 
	$DISKSIM_GLOBAL_DETAILED_EXECUTION_TRACE_lﬂdî
(
ªsu…
, *
s
)

144 i‡(!((
disksim
->
exe˘ø˚
 = 
	`f›í
(
s
, "w")Ë!
NULL
)) {

147 
disksim
->
exe˘ø˚_‚
 = 
	`°rdup
(
s
);

149 
	}
}

151 *
	gDISKSIM_GLOBAL_lﬂdîs
[] = {

152 (*Ë
DISKSIM_GLOBAL_INIT_SEED_lﬂdî
,

153 (*Ë
DISKSIM_GLOBAL_INIT_SEED_WITH_TIME_lﬂdî
,

154 (*Ë
DISKSIM_GLOBAL_REAL_SEED_lﬂdî
,

155 (*Ë
DISKSIM_GLOBAL_REAL_SEED_WITH_TIME_lﬂdî
,

156 (*Ë
DISKSIM_GLOBAL_STATISTIC_WARM_UP_TIME_lﬂdî
,

157 (*Ë
DISKSIM_GLOBAL_STATISTIC_WARM_UP_IOS_lﬂdî
,

158 (*Ë
DISKSIM_GLOBAL_STAT_DEFINITION_FILE_lﬂdî
,

159 (*Ë
DISKSIM_GLOBAL_OUTPUT_FILE_FOR_TRACE_OF_IO_REQUESTS_SIMULATED_lﬂdî
,

160 (*Ë
DISKSIM_GLOBAL_DETAILED_EXECUTION_TRACE_lﬂdî


163 
Õ_∑ømdï_t
 
	gDISKSIM_GLOBAL_dïs
[] = {

164 
DISKSIM_GLOBAL_INIT_SEED_dïíd
,

165 
DISKSIM_GLOBAL_INIT_SEED_WITH_TIME_dïíd
,

166 
DISKSIM_GLOBAL_REAL_SEED_dïíd
,

167 
DISKSIM_GLOBAL_REAL_SEED_WITH_TIME_dïíd
,

168 
DISKSIM_GLOBAL_STATISTIC_WARM_UP_TIME_dïíd
,

169 
DISKSIM_GLOBAL_STATISTIC_WARM_UP_IOS_dïíd
,

170 
DISKSIM_GLOBAL_STAT_DEFINITION_FILE_dïíd
,

171 
DISKSIM_GLOBAL_OUTPUT_FILE_FOR_TRACE_OF_IO_REQUESTS_SIMULATED_dïíd
,

172 
DISKSIM_GLOBAL_DETAILED_EXECUTION_TRACE_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_global_param.h

2 #i‚de‡
_DISKSIM_GLOBAL_PARAM_H


3 
	#_DISKSIM_GLOBAL_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_globÆ_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_GLOBAL_INIT_SEED
,

16 
DISKSIM_GLOBAL_INIT_SEED_WITH_TIME
,

17 
DISKSIM_GLOBAL_REAL_SEED
,

18 
DISKSIM_GLOBAL_REAL_SEED_WITH_TIME
,

19 
DISKSIM_GLOBAL_STATISTIC_WARM_UP_TIME
,

20 
DISKSIM_GLOBAL_STATISTIC_WARM_UP_IOS
,

21 
DISKSIM_GLOBAL_STAT_DEFINITION_FILE
,

22 
DISKSIM_GLOBAL_OUTPUT_FILE_FOR_TRACE_OF_IO_REQUESTS_SIMULATED
,

23 
DISKSIM_GLOBAL_DETAILED_EXECUTION_TRACE


24 } 
	tdisksim_globÆ_∑øm_t
;

26 
	#DISKSIM_GLOBAL_MAX_PARAM
 
DISKSIM_GLOBAL_DETAILED_EXECUTION_TRACE


	)

27 * 
DISKSIM_GLOBAL_lﬂdîs
[];

28 
Õ_∑ømdï_t
 
DISKSIM_GLOBAL_dïs
[];

31 
Õ_v¨•ec
 
	gdisksim_globÆ_∑øms
 [] = {

32 {"Inô Sìd", 
I
, 0 },

33 {"Inô Sìd wôhÅime", 
I
, 0 },

34 {"Ró»Sìd", 
I
, 0 },

35 {"Ró»Sìd wôhÅime", 
I
, 0 },

36 {"Sèti°i¯w¨m-u∞time", 
D
, 0 },

37 {"Sèti°i¯w¨m-u∞IOs", 
I
, 0 },

38 {"Sèàdeföôi⁄ fûe", 
S
, 1 },

39 {"Ouçuàfûêf‹Åø˚ o‡I/OÑeque°†simuœãd", 
S
, 0 },

40 {"DëaûedÉxecuti⁄Åø˚", 
S
, 0 },

43 
	#DISKSIM_GLOBAL_MAX
 9

	)

44 
Õ_mod
 
	gdisksim_globÆ_mod
 = { "disksim_globÆ", 
disksim_globÆ_∑øms
, 
DISKSIM_GLOBAL_MAX
, (
Õ_modlﬂdî_t
)
disksim_globÆ_lﬂd∑øms
, 0, 0, 
DISKSIM_GLOBAL_lﬂdîs
, 
DISKSIM_GLOBAL_dïs
 };

47 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iodriver_param.c

1 
	~"disksim_iodrivî_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_iodrivî.h
"

5 
	$DISKSIM_IODRIVER_TYPE_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_IODRIVER_TYPE_lﬂdî
(
iodrivî
 * 
ªsu…
, 
i
)

13 i‡(!(
i
 >= 0)) {

16 
ªsu…
->
ty≥
 = 
i
;

18 
	}
}

21 
	$DISKSIM_IODRIVER_CONSTANT_ACCESS_TIME_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_IODRIVER_CONSTANT_ACCESS_TIME_lﬂdî
(
iodrivî
 * 
ªsu…
, 
d
)

29 i‡(!((
d
 >= 0.0) || (d == -3.0) || (d == -2.0) || (d == -1.0))) {

32 
ªsu…
->
c⁄°time
 = 
d
;

34 
	}
}

37 
	$DISKSIM_IODRIVER_USE_QUEUEING_IN_SUBSYSTEM_dïíd
(*
bv
)

40 
	}
}

43 
	$DISKSIM_IODRIVER_USE_QUEUEING_IN_SUBSYSTEM_lﬂdî
(
iodrivî
 * 
ªsu…
, 
i
)

45 i‡(!(
	`RANGE
(
i
, 0, 1))) {

48 
ªsu…
->
u£queue
 = 
i
;

50 
	}
}

53 
	$DISKSIM_IODRIVER_SCHEDULER_dïíd
(*
bv
)

56 
	}
}

59 
	$DISKSIM_IODRIVER_SCHEDULER_lﬂdî
(
iodrivî
 * 
ªsu…
, 
Õ_block
 * 
blk
)

61 i‡(!(
ªsu…
->
queue
 = (
ioq
 *Ë
	`disksim_ioqueue_lﬂd∑øms
(
blk
, 
drv_¥ötqueue°©s
, 
drv_¥öt¸ô°©s
, 
drv_¥ötidÀ°©s
, 
drv_¥ötöèº°©s
, 
drv_¥ötsize°©s
))) {

64 
	}
}

66 *
	gDISKSIM_IODRIVER_lﬂdîs
[] = {

67 (*Ë
DISKSIM_IODRIVER_TYPE_lﬂdî
,

68 (*Ë
DISKSIM_IODRIVER_CONSTANT_ACCESS_TIME_lﬂdî
,

69 (*Ë
DISKSIM_IODRIVER_USE_QUEUEING_IN_SUBSYSTEM_lﬂdî
,

70 (*Ë
DISKSIM_IODRIVER_SCHEDULER_lﬂdî


73 
Õ_∑ømdï_t
 
	gDISKSIM_IODRIVER_dïs
[] = {

74 
DISKSIM_IODRIVER_TYPE_dïíd
,

75 
DISKSIM_IODRIVER_CONSTANT_ACCESS_TIME_dïíd
,

76 
DISKSIM_IODRIVER_USE_QUEUEING_IN_SUBSYSTEM_dïíd
,

77 
DISKSIM_IODRIVER_SCHEDULER_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iodriver_param.h

2 #i‚de‡
_DISKSIM_IODRIVER_PARAM_H


3 
	#_DISKSIM_IODRIVER_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
iodrivî
 *
disksim_iodrivî_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_IODRIVER_TYPE
,

16 
DISKSIM_IODRIVER_CONSTANT_ACCESS_TIME
,

17 
DISKSIM_IODRIVER_USE_QUEUEING_IN_SUBSYSTEM
,

18 
DISKSIM_IODRIVER_SCHEDULER


19 } 
	tdisksim_iodrivî_∑øm_t
;

21 
	#DISKSIM_IODRIVER_MAX_PARAM
 
DISKSIM_IODRIVER_SCHEDULER


	)

22 * 
DISKSIM_IODRIVER_lﬂdîs
[];

23 
Õ_∑ømdï_t
 
DISKSIM_IODRIVER_dïs
[];

26 
Õ_v¨•ec
 
	gdisksim_iodrivî_∑øms
 [] = {

27 {"ty≥", 
I
, 1 },

28 {"C⁄°™àac˚s†time", 
D
, 1 },

29 {"U£ queueög i¿subsy°em", 
I
, 1 },

30 {"ScheduÀr", 
BLOCK
, 1 },

33 
	#DISKSIM_IODRIVER_MAX
 4

	)

34 
Õ_mod
 
	gdisksim_iodrivî_mod
 = { "disksim_iodrivî", 
disksim_iodrivî_∑øms
, 
DISKSIM_IODRIVER_MAX
, (
Õ_modlﬂdî_t
)
disksim_iodrivî_lﬂd∑øms
, 0, 0, 
DISKSIM_IODRIVER_lﬂdîs
, 
DISKSIM_IODRIVER_dïs
 };

37 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iodriver_stats_param.c

1 
	~"disksim_iodrivî_°©s_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_iodrivî.h
"

5 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_SIZE_STATS_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_SIZE_STATS_lﬂdî
(
ªsu…
, 
i
)

13 i‡(!(
	`RANGE
(
i
, 0, 1))) {

16 
drv_¥ötsize°©s
 = 
i
;

18 
	}
}

21 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_LOCALITY_STATS_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_LOCALITY_STATS_lﬂdî
(
ªsu…
, 
i
)

29 i‡(!(
	`RANGE
(
i
, 0, 1))) {

32 
drv_¥öéoˇlôy°©s
 = 
i
;

34 
	}
}

37 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_BLOCKING_STATS_dïíd
(*
bv
)

40 
	}
}

43 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_BLOCKING_STATS_lﬂdî
(
ªsu…
, 
i
)

45 i‡(!(
	`RANGE
(
i
, 0, 1))) {

48 
drv_¥ötblockög°©s
 = 
i
;

50 
	}
}

53 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTERFERENCE_STATS_dïíd
(*
bv
)

56 
	}
}

59 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTERFERENCE_STATS_lﬂdî
(
ªsu…
, 
i
)

61 i‡(!(
	`RANGE
(
i
, 0, 1))) {

64 
drv_¥ötöãr„ª°©s
 = 
i
;

66 
	}
}

69 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_QUEUE_STATS_dïíd
(*
bv
)

72 
	}
}

75 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_QUEUE_STATS_lﬂdî
(
ªsu…
, 
i
)

77 i‡(!(
	`RANGE
(
i
, 0, 1))) {

80 
drv_¥ötqueue°©s
 = 
i
;

82 
	}
}

85 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_CRIT_STATS_dïíd
(*
bv
)

88 
	}
}

91 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_CRIT_STATS_lﬂdî
(
ªsu…
, 
i
)

93 i‡(!(
	`RANGE
(
i
, 0, 1))) {

96 
drv_¥öt¸ô°©s
 = 
i
;

98 
	}
}

101 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_IDLE_STATS_dïíd
(*
bv
)

104 
	}
}

107 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_IDLE_STATS_lﬂdî
(
ªsu…
, 
i
)

109 i‡(!(
	`RANGE
(
i
, 0, 1))) {

112 
drv_¥ötidÀ°©s
 = 
i
;

114 
	}
}

117 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTARR_STATS_dïíd
(*
bv
)

120 
	}
}

123 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTARR_STATS_lﬂdî
(
ªsu…
, 
i
)

125 i‡(!(
	`RANGE
(
i
, 0, 1))) {

128 
drv_¥ötöèº°©s
 = 
i
;

130 
	}
}

133 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STREAK_STATS_dïíd
(*
bv
)

136 
	}
}

139 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STREAK_STATS_lﬂdî
(
ªsu…
, 
i
)

141 i‡(!(
	`RANGE
(
i
, 0, 1))) {

144 
drv_¥öt°ªak°©s
 = 
i
;

146 
	}
}

149 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STAMP_STATS_dïíd
(*
bv
)

152 
	}
}

155 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STAMP_STATS_lﬂdî
(
ªsu…
, 
i
)

157 i‡(!(
	`RANGE
(
i
, 0, 1))) {

160 
drv_¥öt°amp°©s
 = 
i
;

162 
	}
}

165 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_PER_DEVICE_STATS_dïíd
(*
bv
)

168 
	}
}

171 
	$DISKSIM_IODRIVER_STATS_PRINT_DRIVER_PER_DEVICE_STATS_lﬂdî
(
ªsu…
, 
i
)

173 i‡(!(
	`RANGE
(
i
, 0, 1))) {

176 
drv_¥öçîdisk°©s
 = 
i
;

178 
	}
}

180 *
	gDISKSIM_IODRIVER_STATS_lﬂdîs
[] = {

181 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_SIZE_STATS_lﬂdî
,

182 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_LOCALITY_STATS_lﬂdî
,

183 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_BLOCKING_STATS_lﬂdî
,

184 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTERFERENCE_STATS_lﬂdî
,

185 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_QUEUE_STATS_lﬂdî
,

186 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_CRIT_STATS_lﬂdî
,

187 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_IDLE_STATS_lﬂdî
,

188 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTARR_STATS_lﬂdî
,

189 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STREAK_STATS_lﬂdî
,

190 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STAMP_STATS_lﬂdî
,

191 (*Ë
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_PER_DEVICE_STATS_lﬂdî


194 
Õ_∑ømdï_t
 
	gDISKSIM_IODRIVER_STATS_dïs
[] = {

195 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_SIZE_STATS_dïíd
,

196 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_LOCALITY_STATS_dïíd
,

197 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_BLOCKING_STATS_dïíd
,

198 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTERFERENCE_STATS_dïíd
,

199 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_QUEUE_STATS_dïíd
,

200 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_CRIT_STATS_dïíd
,

201 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_IDLE_STATS_dïíd
,

202 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTARR_STATS_dïíd
,

203 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STREAK_STATS_dïíd
,

204 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STAMP_STATS_dïíd
,

205 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_PER_DEVICE_STATS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iodriver_stats_param.h

2 #i‚de‡
_DISKSIM_IODRIVER_STATS_PARAM_H


3 
	#_DISKSIM_IODRIVER_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_iodrivî_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_SIZE_STATS
,

16 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_LOCALITY_STATS
,

17 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_BLOCKING_STATS
,

18 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTERFERENCE_STATS
,

19 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_QUEUE_STATS
,

20 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_CRIT_STATS
,

21 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_IDLE_STATS
,

22 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_INTARR_STATS
,

23 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STREAK_STATS
,

24 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_STAMP_STATS
,

25 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_PER_DEVICE_STATS


26 } 
	tdisksim_iodrivî_°©s_∑øm_t
;

28 
	#DISKSIM_IODRIVER_STATS_MAX_PARAM
 
DISKSIM_IODRIVER_STATS_PRINT_DRIVER_PER_DEVICE_STATS


	)

29 * 
DISKSIM_IODRIVER_STATS_lﬂdîs
[];

30 
Õ_∑ømdï_t
 
DISKSIM_IODRIVER_STATS_dïs
[];

33 
Õ_v¨•ec
 
	gdisksim_iodrivî_°©s_∑øms
 [] = {

34 {"Pröàdrivî sizê°©s", 
I
, 1 },

35 {"PröàdrivîÜoˇlôy sèts", 
I
, 1 },

36 {"Pröàdrivî blockög sèts", 
I
, 1 },

37 {"Pröàdrivî i¡î„ªn˚ sèts", 
I
, 1 },

38 {"Pröàdrivî queuê°©s", 
I
, 1 },

39 {"Pröàdrivî crô sèts", 
I
, 1 },

40 {"Pröàdrivî idÀ sèts", 
I
, 1 },

41 {"Pröàdrivî i¡¨∏°©s", 
I
, 1 },

42 {"Pröàdrivî såók sèts", 
I
, 1 },

43 {"Pröàdrivî sèm∞°©s", 
I
, 1 },

44 {"PröàdrivîÖî-devi˚ sèts", 
I
, 1 },

47 
	#DISKSIM_IODRIVER_STATS_MAX
 11

	)

48 
Õ_mod
 
	gdisksim_iodrivî_°©s_mod
 = { "disksim_iodrivî_°©s", 
disksim_iodrivî_°©s_∑øms
, 
DISKSIM_IODRIVER_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_iodrivî_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_IODRIVER_STATS_lﬂdîs
, 
DISKSIM_IODRIVER_STATS_dïs
 };

51 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iomap_param.c

1 
	~"disksim_iom≠_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_iosim.h
"

5 
	$DISKSIM_IOMAP_TRACEDEV_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_IOMAP_TRACEDEV_lﬂdî
(
ªsu…
, 
i
)

13 
åa˚m≠
[
ªsu…
] = 
i
;

15 
	}
}

18 
	$DISKSIM_IOMAP_SIMDEV_dïíd
(*
bv
)

21 
	}
}

24 
	$DISKSIM_IOMAP_SIMDEV_lﬂdî
(
ªsu…
, *
s
)

26 i‡(!(
	`gëdevby«me
(
s
, &
åa˚m≠1
[
ªsu…
], 0, 0))) {

29 
	}
}

32 
	$DISKSIM_IOMAP_LOCSCALE_dïíd
(*
bv
)

35 
	}
}

38 
	$DISKSIM_IOMAP_LOCSCALE_lﬂdî
(
ªsu…
, 
i
)

40 i‡(!((
i
 > 0) && (!(512 % i) || !(i % 512)))) {

43 
åa˚m≠2
[
ªsu…
] = 
i
;

45 
	}
}

48 
	$DISKSIM_IOMAP_SIZESCALE_dïíd
(*
bv
)

51 
	}
}

54 
	$DISKSIM_IOMAP_SIZESCALE_lﬂdî
(
ªsu…
, 
i
)

56 i‡(!(
i
 > 0)) {

59 
åa˚m≠3
[
ªsu…
] = 
i
;

61 
	}
}

64 
	$DISKSIM_IOMAP_OFFSET_dïíd
(*
bv
)

67 
	}
}

70 
	$DISKSIM_IOMAP_OFFSET_lﬂdî
(
ªsu…
, 
i
)

72 i‡(!(
i
 >= 0)) {

75 
åa˚m≠4
[
ªsu…
] = 
i
;

77 
	}
}

79 *
	gDISKSIM_IOMAP_lﬂdîs
[] = {

80 (*Ë
DISKSIM_IOMAP_TRACEDEV_lﬂdî
,

81 (*Ë
DISKSIM_IOMAP_SIMDEV_lﬂdî
,

82 (*Ë
DISKSIM_IOMAP_LOCSCALE_lﬂdî
,

83 (*Ë
DISKSIM_IOMAP_SIZESCALE_lﬂdî
,

84 (*Ë
DISKSIM_IOMAP_OFFSET_lﬂdî


87 
Õ_∑ømdï_t
 
	gDISKSIM_IOMAP_dïs
[] = {

88 
DISKSIM_IOMAP_TRACEDEV_dïíd
,

89 
DISKSIM_IOMAP_SIMDEV_dïíd
,

90 
DISKSIM_IOMAP_LOCSCALE_dïíd
,

91 
DISKSIM_IOMAP_SIZESCALE_dïíd
,

92 
DISKSIM_IOMAP_OFFSET_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iomap_param.h

2 #i‚de‡
_DISKSIM_IOMAP_PARAM_H


3 
	#_DISKSIM_IOMAP_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_iom≠_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_IOMAP_TRACEDEV
,

16 
DISKSIM_IOMAP_SIMDEV
,

17 
DISKSIM_IOMAP_LOCSCALE
,

18 
DISKSIM_IOMAP_SIZESCALE
,

19 
DISKSIM_IOMAP_OFFSET


20 } 
	tdisksim_iom≠_∑øm_t
;

22 
	#DISKSIM_IOMAP_MAX_PARAM
 
DISKSIM_IOMAP_OFFSET


	)

23 * 
DISKSIM_IOMAP_lﬂdîs
[];

24 
Õ_∑ømdï_t
 
DISKSIM_IOMAP_dïs
[];

27 
Õ_v¨•ec
 
	gdisksim_iom≠_∑øms
 [] = {

28 {"åa˚dev", 
I
, 1 },

29 {"simdev", 
S
, 1 },

30 {"locSˇÀ", 
I
, 1 },

31 {"sizeSˇÀ", 
I
, 1 },

32 {"off£t", 
I
, 0 },

35 
	#DISKSIM_IOMAP_MAX
 5

	)

36 
Õ_mod
 
	gdisksim_iom≠_mod
 = { "disksim_iom≠", 
disksim_iom≠_∑øms
, 
DISKSIM_IOMAP_MAX
, (
Õ_modlﬂdî_t
)
disksim_iom≠_lﬂd∑øms
, 0, 0, 
DISKSIM_IOMAP_lﬂdîs
, 
DISKSIM_IOMAP_dïs
 };

39 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ioqueue_param.c

1 
	~"disksim_ioqueue_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_ioqueue.h
"

5 
	$DISKSIM_IOQUEUE_SCHEDULING_POLICY_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_IOQUEUE_SCHEDULING_POLICY_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

13 i‡(!(
	`RANGE
(
i
, 
MINSCHED
, 
MAXSCHED
))) {

16 
ªsu…
->
ba£
.
sched_Æg
 = 
i
;

18 
	}
}

21 
	$DISKSIM_IOQUEUE_CYLINDER_MAPPING_STRATEGY_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_IOQUEUE_CYLINDER_MAPPING_STRATEGY_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

29 i‡(!(
	`RANGE
(
i
, 0, 6))) {

32 
ªsu…
->
cylm≠ty≥
 = 
i
;

34 
	}
}

37 
	$DISKSIM_IOQUEUE_WRITE_INITIATION_DELAY_dïíd
(*
bv
)

40 
	}
}

43 
	$DISKSIM_IOQUEUE_WRITE_INITIATION_DELAY_lﬂdî
(
ioq
 * 
ªsu…
, 
d
)

45 i‡(!(
d
 >= 0)) {

48 
ªsu…
->
wrôedñay
 = 
d
;

50 
	}
}

53 
	$DISKSIM_IOQUEUE_READ_INITIATION_DELAY_dïíd
(*
bv
)

56 
	}
}

59 
	$DISKSIM_IOQUEUE_READ_INITIATION_DELAY_lﬂdî
(
ioq
 * 
ªsu…
, 
d
)

61 i‡(!(
d
 >= 0)) {

64 
ªsu…
->
ªaddñay
 = 
d
;

66 
	}
}

69 
	$DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_SCHEME_dïíd
(*
bv
)

72 
	}
}

75 
	$DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_SCHEME_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

77 
ªsu…
->
£qscheme
 = 
i
;

79 
	}
}

82 
	$DISKSIM_IOQUEUE_MAXIMUM_CONCAT_SIZE_dïíd
(*
bv
)

85 
	}
}

88 
	$DISKSIM_IOQUEUE_MAXIMUM_CONCAT_SIZE_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

90 i‡(!(
i
 >= 0)) {

93 
ªsu…
->
c⁄ˇtmax
 = 
i
;

95 
	}
}

98 
	$DISKSIM_IOQUEUE_OVERLAPPING_REQUEST_SCHEME_dïíd
(*
bv
)

101 
	}
}

104 
	$DISKSIM_IOQUEUE_OVERLAPPING_REQUEST_SCHEME_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

106 i‡(!(
	`RANGE
(
i
, 0, 2))) {

109 
ªsu…
->
combovîœps
 = 
i
;

111 
	}
}

114 
	$DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_DIFF_MAXIMUM_dïíd
(*
bv
)

117 
	}
}

120 
	$DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_DIFF_MAXIMUM_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

122 i‡(!(
	`RANGE
(
i
, 0, 2))) {

125 
ªsu…
->
£q°ªamdiff
 = 
i
;

127 
	}
}

130 
	$DISKSIM_IOQUEUE_SCHEDULING_TIMEOUT_SCHEME_dïíd
(*
bv
)

133 
	}
}

136 
	$DISKSIM_IOQUEUE_SCHEDULING_TIMEOUT_SCHEME_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

138 i‡(
disksim
->
vîbosôy
 > 0)

139 
	`Ârötf
(
°dîr
, "** warning: ignoring \"SchedulingÅimeout scheme\" \n");

141 
	}
}

144 
	$DISKSIM_IOQUEUE_TIMEOUT_TIMEWEIGHT_dïíd
(*
bv
)

147 
	}
}

150 
	$DISKSIM_IOQUEUE_TIMEOUT_TIMEWEIGHT_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

152 i‡(!(
i
 >= 0)) {

155 
ªsu…
->
to_time
 = 
i
;

157 
	}
}

160 
	$DISKSIM_IOQUEUE_TIMEOUT_SCHEDULING_dïíd
(*
bv
)

163 
	}
}

166 
	$DISKSIM_IOQUEUE_TIMEOUT_SCHEDULING_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

168 i‡(!(
	`RANGE
(
i
, 0, 21))) {

171 
ªsu…
->
timeout
.
sched_Æg
 = 
i
;

173 
	}
}

176 
	$DISKSIM_IOQUEUE_SCHEDULING_PRIORITY_SCHEME_dïíd
(*
bv
)

179 
	}
}

182 
	$DISKSIM_IOQUEUE_SCHEDULING_PRIORITY_SCHEME_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

184 i‡(!(
	`RANGE
(
i
, 0, 1))) {

187 
ªsu…
->
¥i_scheme
 = 
i
;

189 
	}
}

192 
	$DISKSIM_IOQUEUE_PRIORITY_SCHEDULING_dïíd
(*
bv
)

195 
	}
}

198 
	$DISKSIM_IOQUEUE_PRIORITY_SCHEDULING_lﬂdî
(
ioq
 * 
ªsu…
, 
i
)

200 i‡(!(
	`RANGE
(
i
, 0, 21))) {

203 
ªsu…
->
¥i‹ôy
.
sched_Æg
 = 
i
;

205 
	}
}

207 *
	gDISKSIM_IOQUEUE_lﬂdîs
[] = {

208 (*Ë
DISKSIM_IOQUEUE_SCHEDULING_POLICY_lﬂdî
,

209 (*Ë
DISKSIM_IOQUEUE_CYLINDER_MAPPING_STRATEGY_lﬂdî
,

210 (*Ë
DISKSIM_IOQUEUE_WRITE_INITIATION_DELAY_lﬂdî
,

211 (*Ë
DISKSIM_IOQUEUE_READ_INITIATION_DELAY_lﬂdî
,

212 (*Ë
DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_SCHEME_lﬂdî
,

213 (*Ë
DISKSIM_IOQUEUE_MAXIMUM_CONCAT_SIZE_lﬂdî
,

214 (*Ë
DISKSIM_IOQUEUE_OVERLAPPING_REQUEST_SCHEME_lﬂdî
,

215 (*Ë
DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_DIFF_MAXIMUM_lﬂdî
,

216 (*Ë
DISKSIM_IOQUEUE_SCHEDULING_TIMEOUT_SCHEME_lﬂdî
,

217 (*Ë
DISKSIM_IOQUEUE_TIMEOUT_TIMEWEIGHT_lﬂdî
,

218 (*Ë
DISKSIM_IOQUEUE_TIMEOUT_SCHEDULING_lﬂdî
,

219 (*Ë
DISKSIM_IOQUEUE_SCHEDULING_PRIORITY_SCHEME_lﬂdî
,

220 (*Ë
DISKSIM_IOQUEUE_PRIORITY_SCHEDULING_lﬂdî


223 
Õ_∑ømdï_t
 
	gDISKSIM_IOQUEUE_dïs
[] = {

224 
DISKSIM_IOQUEUE_SCHEDULING_POLICY_dïíd
,

225 
DISKSIM_IOQUEUE_CYLINDER_MAPPING_STRATEGY_dïíd
,

226 
DISKSIM_IOQUEUE_WRITE_INITIATION_DELAY_dïíd
,

227 
DISKSIM_IOQUEUE_READ_INITIATION_DELAY_dïíd
,

228 
DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_SCHEME_dïíd
,

229 
DISKSIM_IOQUEUE_MAXIMUM_CONCAT_SIZE_dïíd
,

230 
DISKSIM_IOQUEUE_OVERLAPPING_REQUEST_SCHEME_dïíd
,

231 
DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_DIFF_MAXIMUM_dïíd
,

232 
DISKSIM_IOQUEUE_SCHEDULING_TIMEOUT_SCHEME_dïíd
,

233 
DISKSIM_IOQUEUE_TIMEOUT_TIMEWEIGHT_dïíd
,

234 
DISKSIM_IOQUEUE_TIMEOUT_SCHEDULING_dïíd
,

235 
DISKSIM_IOQUEUE_SCHEDULING_PRIORITY_SCHEME_dïíd
,

236 
DISKSIM_IOQUEUE_PRIORITY_SCHEDULING_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ioqueue_param.h

2 #i‚de‡
_DISKSIM_IOQUEUE_PARAM_H


3 
	#_DISKSIM_IOQUEUE_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
ioq
 *
disksim_ioqueue_lﬂd∑øms
(
Õ_block
 *
b
, 
¥ötqueue°©s
, 
¥öt¸ô°©s
, 
¥ötidÀ°©s
, 
¥ötöèº°©s
, 
¥ötsize°©s
);

15 
DISKSIM_IOQUEUE_SCHEDULING_POLICY
,

16 
DISKSIM_IOQUEUE_CYLINDER_MAPPING_STRATEGY
,

17 
DISKSIM_IOQUEUE_WRITE_INITIATION_DELAY
,

18 
DISKSIM_IOQUEUE_READ_INITIATION_DELAY
,

19 
DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_SCHEME
,

20 
DISKSIM_IOQUEUE_MAXIMUM_CONCAT_SIZE
,

21 
DISKSIM_IOQUEUE_OVERLAPPING_REQUEST_SCHEME
,

22 
DISKSIM_IOQUEUE_SEQUENTIAL_STREAM_DIFF_MAXIMUM
,

23 
DISKSIM_IOQUEUE_SCHEDULING_TIMEOUT_SCHEME
,

24 
DISKSIM_IOQUEUE_TIMEOUT_TIMEWEIGHT
,

25 
DISKSIM_IOQUEUE_TIMEOUT_SCHEDULING
,

26 
DISKSIM_IOQUEUE_SCHEDULING_PRIORITY_SCHEME
,

27 
DISKSIM_IOQUEUE_PRIORITY_SCHEDULING


28 } 
	tdisksim_ioqueue_∑øm_t
;

30 
	#DISKSIM_IOQUEUE_MAX_PARAM
 
DISKSIM_IOQUEUE_PRIORITY_SCHEDULING


	)

31 * 
DISKSIM_IOQUEUE_lﬂdîs
[];

32 
Õ_∑ømdï_t
 
DISKSIM_IOQUEUE_dïs
[];

35 
Õ_v¨•ec
 
	gdisksim_ioqueue_∑øms
 [] = {

36 {"SchedulögÖﬁicy", 
I
, 1 },

37 {"Cylödî m≠pög så©egy", 
I
, 1 },

38 {"Wrôêöôüti⁄ dñay", 
D
, 1 },

39 {"Ród inôüti⁄ dñay", 
D
, 1 },

40 {"Sequítü»°ªam scheme", 
I
, 1 },

41 {"Maximum c⁄ˇàsize", 
I
, 1 },

42 {"OvîœµögÑeque° scheme", 
I
, 1 },

43 {"Sequítü»°ªam dif‡maximum", 
I
, 1 },

44 {"SchedulögÅimeouàscheme", 
I
, 1 },

45 {"Timeouàtime/weight", 
I
, 1 },

46 {"Timeouàschedulög", 
I
, 1 },

47 {"SchedulögÖri‹ôy scheme", 
I
, 1 },

48 {"Pri‹ôy schedulög", 
I
, 1 },

51 
	#DISKSIM_IOQUEUE_MAX
 13

	)

52 
Õ_mod
 
	gdisksim_ioqueue_mod
 = { "disksim_ioqueue", 
disksim_ioqueue_∑øms
, 
DISKSIM_IOQUEUE_MAX
, (
Õ_modlﬂdî_t
)
disksim_ioqueue_lﬂd∑øms
, 0, 0, 
DISKSIM_IOQUEUE_lﬂdîs
, 
DISKSIM_IOQUEUE_dïs
 };

55 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iosim_param.c

1 
	~"disksim_iosim_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_iosim.h
"

5 
	$DISKSIM_IOSIM_IO_TRACE_TIME_SCALE_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_IOSIM_IO_TRACE_TIME_SCALE_lﬂdî
(
ªsu…
, 
d
)

13 i‡(
iosˇÀ
 < 0.0) {

14 i‡(
iosˇÀ
 > -1.0) {

15 
c⁄°öèºtime
 = 1 / (-
iosˇÀ
);

16 
iosˇÀ
 = 1.0;

18 
disksim
->
˛o£dios
 = (Ë-
iosˇÀ
;

19 
iosˇÀ
 = 1.0;

21 } i‡(
iosˇÀ
 == 0.0) {

22 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ I/OÅø˚ÅimêsˇÀ - %f\n", 
iosˇÀ
);

23 
	`exô
(0);

25 
	}
}

28 
	$DISKSIM_IOSIM_IO_MAPPINGS_dïíd
(*
bv
)

31 
	}
}

34 
	$DISKSIM_IOSIM_IO_MAPPINGS_lﬂdî
(
ªsu…
, 
Õ_li°
 * 
l
)

36 i‡(!(
	`iosim_lﬂd_m≠pögs
(
l
))) {

39 
	}
}

41 *
	gDISKSIM_IOSIM_lﬂdîs
[] = {

42 (*Ë
DISKSIM_IOSIM_IO_TRACE_TIME_SCALE_lﬂdî
,

43 (*Ë
DISKSIM_IOSIM_IO_MAPPINGS_lﬂdî


46 
Õ_∑ømdï_t
 
	gDISKSIM_IOSIM_dïs
[] = {

47 
DISKSIM_IOSIM_IO_TRACE_TIME_SCALE_dïíd
,

48 
DISKSIM_IOSIM_IO_MAPPINGS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iosim_param.h

2 #i‚de‡
_DISKSIM_IOSIM_PARAM_H


3 
	#_DISKSIM_IOSIM_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_iosim_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_IOSIM_IO_TRACE_TIME_SCALE
,

16 
DISKSIM_IOSIM_IO_MAPPINGS


17 } 
	tdisksim_iosim_∑øm_t
;

19 
	#DISKSIM_IOSIM_MAX_PARAM
 
DISKSIM_IOSIM_IO_MAPPINGS


	)

20 * 
DISKSIM_IOSIM_lﬂdîs
[];

21 
Õ_∑ømdï_t
 
DISKSIM_IOSIM_dïs
[];

24 
Õ_v¨•ec
 
	gdisksim_iosim_∑øms
 [] = {

25 {"I/O Tø˚ TimêSˇÀ", 
D
, 0 },

26 {"I/O M≠pögs", 
LIST
, 0 },

29 
	#DISKSIM_IOSIM_MAX
 2

	)

30 
Õ_mod
 
	gdisksim_iosim_mod
 = { "disksim_iosim", 
disksim_iosim_∑øms
, 
DISKSIM_IOSIM_MAX
, (
Õ_modlﬂdî_t
)
disksim_iosim_lﬂd∑øms
, 0, 0, 
DISKSIM_IOSIM_lﬂdîs
, 
DISKSIM_IOSIM_dïs
 };

33 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_logorg_param.c

1 
	~"disksim_log‹g_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_log‹g.h
"

5 
	$DISKSIM_LOGORG_ADDRESSING_MODE_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_LOGORG_ADDRESSING_MODE_lﬂdî
(
log‹g
 * 
ªsu…
, *
s
)

13 i‡(!(!
	`log‹g_addr
(
ªsu…
, 
s
))) {

16 
	}
}

19 
	$DISKSIM_LOGORG_DISTRIBUTION_SCHEME_dïíd
(*
bv
)

22 
	}
}

25 
	$DISKSIM_LOGORG_DISTRIBUTION_SCHEME_lﬂdî
(
log‹g
 * 
ªsu…
, *
s
)

27 i‡(!(!
	`log‹g_di°n
(
ªsu…
, 
s
))) {

30 
	}
}

33 
	$DISKSIM_LOGORG_REDUNDANCY_SCHEME_dïíd
(*
bv
)

36 
	}
}

39 
	$DISKSIM_LOGORG_REDUNDANCY_SCHEME_lﬂdî
(
log‹g
 * 
ªsu…
, *
s
)

41 i‡(!(!
	`log‹g_ªdun
(
ªsu…
, 
s
))) {

44 
	}
}

47 
	$_dïíd
(*
bv
)

50 
	}
}

53 
	$DISKSIM_LOGORG_COMPONENTS_lﬂdî
(
log‹g
 * 
ªsu…
, *
s
)

56 
	}
}

59 
	$DISKSIM_LOGORG_DEVICES_dïíd
(*
bv
)

62 
	}
}

65 
	$DISKSIM_LOGORG_DEVICES_lﬂdî
(
log‹g
 * 
ªsu…
, 
Õ_li°
 * 
l
)

67 i‡(!(!
	`gëlog‹gdevs
(
ªsu…
, 
l
))) {

70 
	}
}

73 
	$DISKSIM_LOGORG_STRIPE_UNIT_dïíd
(*
bv
)

76 
	}
}

79 
	$DISKSIM_LOGORG_STRIPE_UNIT_lﬂdî
(
log‹g
 * 
ªsu…
, 
i
)

81 i‡(!(
i
 > 0)) {

84 
ªsu…
->
°rùeunô
 = 
i
;

86 
	}
}

89 
	$DISKSIM_LOGORG_SYNCH_WRITES_FOR_SAFETY_dïíd
(*
bv
)

92 
	}
}

95 
	$DISKSIM_LOGORG_SYNCH_WRITES_FOR_SAFETY_lﬂdî
(
log‹g
 * 
ªsu…
, 
i
)

97 i‡(!(
	`RANGE
(
i
, 0, 1))) {

100 
ªsu…
->
wrôesync
 = 
i
;

102 
	}
}

105 
	$DISKSIM_LOGORG_NUMBER_OF_COPIES_dïíd
(*
bv
)

108 
	}
}

111 
	$DISKSIM_LOGORG_NUMBER_OF_COPIES_lﬂdî
(
log‹g
 * 
ªsu…
, 
i
)

113 i‡(!(
i
 > 0)) {

116 
ªsu…
->
c›õs
 = 
i
;

118 
	}
}

121 
	$DISKSIM_LOGORG_COPY_CHOICE_ON_READ_dïíd
(*
bv
)

124 
	}
}

127 
	$DISKSIM_LOGORG_COPY_CHOICE_ON_READ_lﬂdî
(
log‹g
 * 
ªsu…
, 
i
)

129 i‡(!(
	`RANGE
(
i
, 1, 6))) {

132 
ªsu…
->
c›ychoi˚
 = 
i
;

134 
	}
}

137 
	$DISKSIM_LOGORG_RMW_VS_RECONSTRUCT_dïíd
(*
bv
)

140 
	}
}

143 
	$DISKSIM_LOGORG_RMW_VS_RECONSTRUCT_lﬂdî
(
log‹g
 * 
ªsu…
, 
d
)

145 i‡(!(
	`RANGE
(
d
, 0.0, 1.0))) {

148 
ªsu…
->
rmwpoöt
 = 
d
;

150 
	}
}

153 
	$DISKSIM_LOGORG_PARITY_STRIPE_UNIT_dïíd
(*
bv
)

156 
	}
}

159 
	$DISKSIM_LOGORG_PARITY_STRIPE_UNIT_lﬂdî
(
log‹g
 * 
ªsu…
, 
i
)

161 i‡(!(
i
 > 0)) {

164 
ªsu…
->
∑rôyunô
 = 
i
;

166 
	}
}

169 
	$DISKSIM_LOGORG_PARITY_ROTATION_TYPE_dïíd
(*
bv
)

172 
	}
}

175 
	$DISKSIM_LOGORG_PARITY_ROTATION_TYPE_lﬂdî
(
log‹g
 * 
ªsu…
, 
i
)

177 i‡(!(
	`RANGE
(
i
, 1, 4))) {

180 
ªsu…
->
rŸty≥
 = 
i
;

182 
	}
}

185 
	$DISKSIM_LOGORG_TIME_STAMP_INTERVAL_dïíd
(*
bv
)

188 
	}
}

191 
	$DISKSIM_LOGORG_TIME_STAMP_INTERVAL_lﬂdî
(
log‹g
 * 
ªsu…
, 
d
)

193 i‡(!(
d
 >= 0.0)) {

196 
ªsu…
->
°amp°¨t
 = 
d
;

198 
	}
}

201 
	$DISKSIM_LOGORG_TIME_STAMP_START_TIME_dïíd
(*
bv
)

204 
	}
}

207 
	$DISKSIM_LOGORG_TIME_STAMP_START_TIME_lﬂdî
(
log‹g
 * 
ªsu…
, 
d
)

209 i‡(!(
d
 >= 0.0)) {

212 
ªsu…
->
°amp°¨t
 = 
d
;

214 
	}
}

217 
	$DISKSIM_LOGORG_TIME_STAMP_STOP_TIME_dïíd
(*
bv
)

220 
	}
}

223 
	$DISKSIM_LOGORG_TIME_STAMP_STOP_TIME_lﬂdî
(
log‹g
 * 
ªsu…
, 
d
)

225 i‡(!(
d
 >= 0.0)) {

228 
ªsu…
->
°amp°›
 = 
d
;

230 
	}
}

233 
	$DISKSIM_LOGORG_TIME_STAMP_FILE_NAME_dïíd
(*
bv
)

236 
	}
}

239 
	$DISKSIM_LOGORG_TIME_STAMP_FILE_NAME_lﬂdî
(
log‹g
 * 
ªsu…
, *
s
)

241 i‡(!((
ªsu…
->
°ampfûe
 = 
	`f›í
(
s
, "w")))) {

244 
	}
}

246 *
	gDISKSIM_LOGORG_lﬂdîs
[] = {

247 (*Ë
DISKSIM_LOGORG_ADDRESSING_MODE_lﬂdî
,

248 (*Ë
DISKSIM_LOGORG_DISTRIBUTION_SCHEME_lﬂdî
,

249 (*Ë
DISKSIM_LOGORG_REDUNDANCY_SCHEME_lﬂdî
,

250 (*Ë
DISKSIM_LOGORG_COMPONENTS_lﬂdî
,

251 (*Ë
DISKSIM_LOGORG_DEVICES_lﬂdî
,

252 (*Ë
DISKSIM_LOGORG_STRIPE_UNIT_lﬂdî
,

253 (*Ë
DISKSIM_LOGORG_SYNCH_WRITES_FOR_SAFETY_lﬂdî
,

254 (*Ë
DISKSIM_LOGORG_NUMBER_OF_COPIES_lﬂdî
,

255 (*Ë
DISKSIM_LOGORG_COPY_CHOICE_ON_READ_lﬂdî
,

256 (*Ë
DISKSIM_LOGORG_RMW_VS_RECONSTRUCT_lﬂdî
,

257 (*Ë
DISKSIM_LOGORG_PARITY_STRIPE_UNIT_lﬂdî
,

258 (*Ë
DISKSIM_LOGORG_PARITY_ROTATION_TYPE_lﬂdî
,

259 (*Ë
DISKSIM_LOGORG_TIME_STAMP_INTERVAL_lﬂdî
,

260 (*Ë
DISKSIM_LOGORG_TIME_STAMP_START_TIME_lﬂdî
,

261 (*Ë
DISKSIM_LOGORG_TIME_STAMP_STOP_TIME_lﬂdî
,

262 (*Ë
DISKSIM_LOGORG_TIME_STAMP_FILE_NAME_lﬂdî


265 
Õ_∑ømdï_t
 
	gDISKSIM_LOGORG_dïs
[] = {

266 
DISKSIM_LOGORG_ADDRESSING_MODE_dïíd
,

267 
DISKSIM_LOGORG_DISTRIBUTION_SCHEME_dïíd
,

268 
DISKSIM_LOGORG_REDUNDANCY_SCHEME_dïíd
,

269 
_dïíd
,

270 
DISKSIM_LOGORG_DEVICES_dïíd
,

271 
DISKSIM_LOGORG_STRIPE_UNIT_dïíd
,

272 
DISKSIM_LOGORG_SYNCH_WRITES_FOR_SAFETY_dïíd
,

273 
DISKSIM_LOGORG_NUMBER_OF_COPIES_dïíd
,

274 
DISKSIM_LOGORG_COPY_CHOICE_ON_READ_dïíd
,

275 
DISKSIM_LOGORG_RMW_VS_RECONSTRUCT_dïíd
,

276 
DISKSIM_LOGORG_PARITY_STRIPE_UNIT_dïíd
,

277 
DISKSIM_LOGORG_PARITY_ROTATION_TYPE_dïíd
,

278 
DISKSIM_LOGORG_TIME_STAMP_INTERVAL_dïíd
,

279 
DISKSIM_LOGORG_TIME_STAMP_START_TIME_dïíd
,

280 
DISKSIM_LOGORG_TIME_STAMP_STOP_TIME_dïíd
,

281 
DISKSIM_LOGORG_TIME_STAMP_FILE_NAME_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_logorg_param.h

2 #i‚de‡
_DISKSIM_LOGORG_PARAM_H


3 
	#_DISKSIM_LOGORG_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
log‹g
 *
disksim_log‹g_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_LOGORG_ADDRESSING_MODE
,

16 
DISKSIM_LOGORG_DISTRIBUTION_SCHEME
,

17 
DISKSIM_LOGORG_REDUNDANCY_SCHEME
,

18 
DISKSIM_LOGORG_COMPONENTS
,

19 
DISKSIM_LOGORG_DEVICES
,

20 
DISKSIM_LOGORG_STRIPE_UNIT
,

21 
DISKSIM_LOGORG_SYNCH_WRITES_FOR_SAFETY
,

22 
DISKSIM_LOGORG_NUMBER_OF_COPIES
,

23 
DISKSIM_LOGORG_COPY_CHOICE_ON_READ
,

24 
DISKSIM_LOGORG_RMW_VS_RECONSTRUCT
,

25 
DISKSIM_LOGORG_PARITY_STRIPE_UNIT
,

26 
DISKSIM_LOGORG_PARITY_ROTATION_TYPE
,

27 
DISKSIM_LOGORG_TIME_STAMP_INTERVAL
,

28 
DISKSIM_LOGORG_TIME_STAMP_START_TIME
,

29 
DISKSIM_LOGORG_TIME_STAMP_STOP_TIME
,

30 
DISKSIM_LOGORG_TIME_STAMP_FILE_NAME


31 } 
	tdisksim_log‹g_∑øm_t
;

33 
	#DISKSIM_LOGORG_MAX_PARAM
 
DISKSIM_LOGORG_TIME_STAMP_FILE_NAME


	)

34 * 
DISKSIM_LOGORG_lﬂdîs
[];

35 
Õ_∑ømdï_t
 
DISKSIM_LOGORG_dïs
[];

38 
Õ_v¨•ec
 
	gdisksim_log‹g_∑øms
 [] = {

39 {"Addªssög mode", 
S
, 1 },

40 {"Di°ributi⁄ scheme", 
S
, 1 },

41 {"Redund™cy scheme", 
S
, 1 },

42 {"Comp⁄íts", 
S
, 0 },

43 {"devi˚s", 
LIST
, 1 },

44 {"Såùêunô", 
I
, 1 },

45 {"Synch wrôe†f‹ sa„ty", 
I
, 1 },

46 {"Numbî o‡c›õs", 
I
, 1 },

47 {"C›y choi˚ o¿ªad", 
I
, 1 },

48 {"RMW vs.Ñec⁄°ru˘", 
D
, 1 },

49 {"P¨ôy såùêunô", 
I
, 1 },

50 {"P¨ôyÑŸ©i⁄Åy≥", 
I
, 1 },

51 {"Timê°am∞öãrvÆ", 
D
, 0 },

52 {"Timê°am∞°¨àtime", 
D
, 0 },

53 {"Timê°am∞°›Åime", 
D
, 0 },

54 {"Timê°am∞fûê«me", 
S
, 0 },

57 
	#DISKSIM_LOGORG_MAX
 16

	)

58 
Õ_mod
 
	gdisksim_log‹g_mod
 = { "disksim_log‹g", 
disksim_log‹g_∑øms
, 
DISKSIM_LOGORG_MAX
, (
Õ_modlﬂdî_t
)
disksim_log‹g_lﬂd∑øms
, 0, 0, 
DISKSIM_LOGORG_lﬂdîs
, 
DISKSIM_LOGORG_dïs
 };

61 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_pf_param.c

1 
	~"disksim_pf_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_pfsim.h
"

5 
	$DISKSIM_PF_NUMBER_OF_PROCESSORS_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_PF_NUMBER_OF_PROCESSORS_lﬂdî
(
ªsu…
, 
i
)

13 i‡(!(
i
 > 0)) {

16 
num˝us
 = 
i
;

17 
˝us
 = (
˝u
 *Ë
	`DISKSIM_mÆloc
(
num˝us
 * (cpu));

19 
	}
}

22 
	$DISKSIM_PF_PROCESS_FLOW_TIME_SCALE_dïíd
(*
bv
)

25 
	}
}

28 
	$DISKSIM_PF_PROCESS_FLOW_TIME_SCALE_lﬂdî
(
ªsu…
, 
d
)

30 i‡(!(
d
 >= 0.0)) {

33 
pfsˇÀ
 = 
d
;

35 
	}
}

37 *
	gDISKSIM_PF_lﬂdîs
[] = {

38 (*Ë
DISKSIM_PF_NUMBER_OF_PROCESSORS_lﬂdî
,

39 (*Ë
DISKSIM_PF_PROCESS_FLOW_TIME_SCALE_lﬂdî


42 
Õ_∑ømdï_t
 
	gDISKSIM_PF_dïs
[] = {

43 
DISKSIM_PF_NUMBER_OF_PROCESSORS_dïíd
,

44 
DISKSIM_PF_PROCESS_FLOW_TIME_SCALE_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_pf_param.h

2 #i‚de‡
_DISKSIM_PF_PARAM_H


3 
	#_DISKSIM_PF_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_pf_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_PF_NUMBER_OF_PROCESSORS
,

16 
DISKSIM_PF_PROCESS_FLOW_TIME_SCALE


17 } 
	tdisksim_pf_∑øm_t
;

19 
	#DISKSIM_PF_MAX_PARAM
 
DISKSIM_PF_PROCESS_FLOW_TIME_SCALE


	)

20 * 
DISKSIM_PF_lﬂdîs
[];

21 
Õ_∑ømdï_t
 
DISKSIM_PF_dïs
[];

24 
Õ_v¨•ec
 
	gdisksim_pf_∑øms
 [] = {

25 {"Numbî o‡¥o˚ss‹s", 
I
, 1 },

26 {"Pro˚ss-Flow TimêSˇÀ", 
D
, 1 },

29 
	#DISKSIM_PF_MAX
 2

	)

30 
Õ_mod
 
	gdisksim_pf_mod
 = { "disksim_pf", 
disksim_pf_∑øms
, 
DISKSIM_PF_MAX
, (
Õ_modlﬂdî_t
)
disksim_pf_lﬂd∑øms
, 0, 0, 
DISKSIM_PF_lﬂdîs
, 
DISKSIM_PF_dïs
 };

33 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_pf_stats_param.c

1 
	~"disksim_pf_°©s_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_pfsim.h
"

5 
	$DISKSIM_PF_STATS_PRINT_PER_PROCESS_STATS_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_PF_STATS_PRINT_PER_PROCESS_STATS_lﬂdî
(
ªsu…
, 
i
)

13 i‡(!(
	`RANGE
(
i
, 0, 1))) {

16 
pf_¥öt_≥Ωro˚ss°©s
 = 
i
;

18 
	}
}

21 
	$DISKSIM_PF_STATS_PRINT_PER_CPU_STATS_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_PF_STATS_PRINT_PER_CPU_STATS_lﬂdî
(
ªsu…
, 
i
)

29 i‡(!(
	`RANGE
(
i
, 0, 1))) {

32 
pf_¥öt_≥r˝u°©s
 = 
i
;

34 
	}
}

37 
	$DISKSIM_PF_STATS_PRINT_ALL_INTERRUPT_STATS_dïíd
(*
bv
)

40 
	}
}

43 
	$DISKSIM_PF_STATS_PRINT_ALL_INTERRUPT_STATS_lﬂdî
(
ªsu…
, 
i
)

45 i‡(!(
	`RANGE
(
i
, 0, 1))) {

48 
pf_¥öt_öå°©s
 = 
i
;

50 
	}
}

53 
	$DISKSIM_PF_STATS_PRINT_SLEEP_STATS_dïíd
(*
bv
)

56 
	}
}

59 
	$DISKSIM_PF_STATS_PRINT_SLEEP_STATS_lﬂdî
(
ªsu…
, 
i
)

61 i‡(!(
	`RANGE
(
i
, 0, 1))) {

64 
pf_¥öt_¶ìp°©s
 = 
i
;

66 
	}
}

68 *
	gDISKSIM_PF_STATS_lﬂdîs
[] = {

69 (*Ë
DISKSIM_PF_STATS_PRINT_PER_PROCESS_STATS_lﬂdî
,

70 (*Ë
DISKSIM_PF_STATS_PRINT_PER_CPU_STATS_lﬂdî
,

71 (*Ë
DISKSIM_PF_STATS_PRINT_ALL_INTERRUPT_STATS_lﬂdî
,

72 (*Ë
DISKSIM_PF_STATS_PRINT_SLEEP_STATS_lﬂdî


75 
Õ_∑ømdï_t
 
	gDISKSIM_PF_STATS_dïs
[] = {

76 
DISKSIM_PF_STATS_PRINT_PER_PROCESS_STATS_dïíd
,

77 
DISKSIM_PF_STATS_PRINT_PER_CPU_STATS_dïíd
,

78 
DISKSIM_PF_STATS_PRINT_ALL_INTERRUPT_STATS_dïíd
,

79 
DISKSIM_PF_STATS_PRINT_SLEEP_STATS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_pf_stats_param.h

2 #i‚de‡
_DISKSIM_PF_STATS_PARAM_H


3 
	#_DISKSIM_PF_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_pf_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_PF_STATS_PRINT_PER_PROCESS_STATS
,

16 
DISKSIM_PF_STATS_PRINT_PER_CPU_STATS
,

17 
DISKSIM_PF_STATS_PRINT_ALL_INTERRUPT_STATS
,

18 
DISKSIM_PF_STATS_PRINT_SLEEP_STATS


19 } 
	tdisksim_pf_°©s_∑øm_t
;

21 
	#DISKSIM_PF_STATS_MAX_PARAM
 
DISKSIM_PF_STATS_PRINT_SLEEP_STATS


	)

22 * 
DISKSIM_PF_STATS_lﬂdîs
[];

23 
Õ_∑ømdï_t
 
DISKSIM_PF_STATS_dïs
[];

26 
Õ_v¨•ec
 
	gdisksim_pf_°©s_∑øms
 [] = {

27 {"Pröà≥r-¥o˚s†°©s", 
I
, 1 },

28 {"Pröà≥r-CPU sèts", 
I
, 1 },

29 {"PröàÆ»öãºu± sèts", 
I
, 1 },

30 {"Pröà¶ì∞°©s", 
I
, 1 },

33 
	#DISKSIM_PF_STATS_MAX
 4

	)

34 
Õ_mod
 
	gdisksim_pf_°©s_mod
 = { "disksim_pf_°©s", 
disksim_pf_°©s_∑øms
, 
DISKSIM_PF_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_pf_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_PF_STATS_lﬂdîs
, 
DISKSIM_PF_STATS_dïs
 };

37 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_simpledisk_param.c

1 
	~"disksim_sim∂edisk_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_sim∂edisk.h
"

5 
	$DISKSIM_SIMPLEDISK_SCHEDULER_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_SIMPLEDISK_SCHEDULER_lﬂdî
(
sim∂edisk
 * 
ªsu…
, 
Õ_block
 * 
blk
)

13 i‡(!(
ªsu…
->
queue
 = (
ioq
 *Ë
	`disksim_ioqueue_lﬂd∑øms
(
blk
, 
devi˚_¥ötqueue°©s
, 
devi˚_¥öt¸ô°©s
, 
devi˚_¥ötidÀ°©s
, 
devi˚_¥ötöèº°©s
, 
devi˚_¥ötsize°©s
))) {

16 
	}
}

19 
	$DISKSIM_SIMPLEDISK_MAX_QUEUE_LENGTH_dïíd
(*
bv
)

22 
	}
}

25 
	$DISKSIM_SIMPLEDISK_MAX_QUEUE_LENGTH_lﬂdî
(
sim∂edisk
 * 
ªsu…
, 
i
)

27 i‡(!(
i
 >= 0)) {

30 
ªsu…
->
maxqÀn
 = 
i
;

32 
	}
}

35 
	$DISKSIM_SIMPLEDISK_BLOCK_COUNT_dïíd
(*
bv
)

38 
	}
}

41 
	$DISKSIM_SIMPLEDISK_BLOCK_COUNT_lﬂdî
(
sim∂edisk
 * 
ªsu…
, 
i
)

43 i‡(!(
i
 >= 1)) {

46 
ªsu…
->
numblocks
 = 
i
;

48 
	}
}

51 
	$DISKSIM_SIMPLEDISK_BUS_TRANSACTION_LATENCY_dïíd
(*
bv
)

54 
	}
}

57 
	$DISKSIM_SIMPLEDISK_BUS_TRANSACTION_LATENCY_lﬂdî
(
sim∂edisk
 * 
ªsu…
, 
d
)

59 i‡(!(
d
 >= 0.0)) {

62 
ªsu…
->
bus_å™ß˘i⁄_œãncy
 = 
d
;

64 
	}
}

67 
	$DISKSIM_SIMPLEDISK_BULK_SECTOR_TRANSFER_TIME_dïíd
(*
bv
)

70 
	}
}

73 
	$DISKSIM_SIMPLEDISK_BULK_SECTOR_TRANSFER_TIME_lﬂdî
(
sim∂edisk
 * 
ªsu…
, 
d
)

75 i‡(!(
d
 >= 0.0)) {

78 
ªsu…
->
blkå™°ime
 = 
d
;

80 
	}
}

83 
	$DISKSIM_SIMPLEDISK_NEVER_DISCONNECT_dïíd
(*
bv
)

86 
	}
}

89 
	$DISKSIM_SIMPLEDISK_NEVER_DISCONNECT_lﬂdî
(
sim∂edisk
 * 
ªsu…
, 
i
)

91 i‡(!(
	`RANGE
(
i
, 0, 1))) {

94 
ªsu…
->
√vîdisc⁄√˘
 = 
i
;

96 
	}
}

99 
	$DISKSIM_SIMPLEDISK_PRINT_STATS_dïíd
(*
bv
)

102 
	}
}

105 
	$DISKSIM_SIMPLEDISK_PRINT_STATS_lﬂdî
(
sim∂edisk
 * 
ªsu…
, 
i
)

107 i‡(!(
	`RANGE
(
i
, 0, 1))) {

110 
ªsu…
->
¥öt°©s
 = 
i
;

112 
	}
}

115 
	$DISKSIM_SIMPLEDISK_COMMAND_OVERHEAD_dïíd
(*
bv
)

118 
	}
}

121 
	$DISKSIM_SIMPLEDISK_COMMAND_OVERHEAD_lﬂdî
(
sim∂edisk
 * 
ªsu…
, 
d
)

123 i‡(!(
d
 >= 0.0)) {

126 
ªsu…
->
ovîhód
 = 
d
;

128 
	}
}

131 
	$DISKSIM_SIMPLEDISK_CONSTANT_ACCESS_TIME_dïíd
(*
bv
)

134 
	}
}

137 
	$DISKSIM_SIMPLEDISK_CONSTANT_ACCESS_TIME_lﬂdî
(
sim∂edisk
 * 
ªsu…
, 
d
)

139 i‡(!(
d
 >= 0.0)) {

142 
ªsu…
->
ac˘ime
 = 
d
;

144 
	}
}

147 
	$DISKSIM_SIMPLEDISK_ACCESS_TIME_dïíd
(*
bv
)

150 
	}
}

153 
	$DISKSIM_SIMPLEDISK_ACCESS_TIME_lﬂdî
(
sim∂edisk
 * 
ªsu…
, 
d
)

155 i‡(!(
d
 >= 0.0)) {

158 
ªsu…
->
ac˘ime
 = 
d
;

160 
	}
}

162 *
	gDISKSIM_SIMPLEDISK_lﬂdîs
[] = {

163 (*Ë
DISKSIM_SIMPLEDISK_SCHEDULER_lﬂdî
,

164 (*Ë
DISKSIM_SIMPLEDISK_MAX_QUEUE_LENGTH_lﬂdî
,

165 (*Ë
DISKSIM_SIMPLEDISK_BLOCK_COUNT_lﬂdî
,

166 (*Ë
DISKSIM_SIMPLEDISK_BUS_TRANSACTION_LATENCY_lﬂdî
,

167 (*Ë
DISKSIM_SIMPLEDISK_BULK_SECTOR_TRANSFER_TIME_lﬂdî
,

168 (*Ë
DISKSIM_SIMPLEDISK_NEVER_DISCONNECT_lﬂdî
,

169 (*Ë
DISKSIM_SIMPLEDISK_PRINT_STATS_lﬂdî
,

170 (*Ë
DISKSIM_SIMPLEDISK_COMMAND_OVERHEAD_lﬂdî
,

171 (*Ë
DISKSIM_SIMPLEDISK_CONSTANT_ACCESS_TIME_lﬂdî
,

172 (*Ë
DISKSIM_SIMPLEDISK_ACCESS_TIME_lﬂdî


175 
Õ_∑ømdï_t
 
	gDISKSIM_SIMPLEDISK_dïs
[] = {

176 
DISKSIM_SIMPLEDISK_SCHEDULER_dïíd
,

177 
DISKSIM_SIMPLEDISK_MAX_QUEUE_LENGTH_dïíd
,

178 
DISKSIM_SIMPLEDISK_BLOCK_COUNT_dïíd
,

179 
DISKSIM_SIMPLEDISK_BUS_TRANSACTION_LATENCY_dïíd
,

180 
DISKSIM_SIMPLEDISK_BULK_SECTOR_TRANSFER_TIME_dïíd
,

181 
DISKSIM_SIMPLEDISK_NEVER_DISCONNECT_dïíd
,

182 
DISKSIM_SIMPLEDISK_PRINT_STATS_dïíd
,

183 
DISKSIM_SIMPLEDISK_COMMAND_OVERHEAD_dïíd
,

184 
DISKSIM_SIMPLEDISK_CONSTANT_ACCESS_TIME_dïíd
,

185 
DISKSIM_SIMPLEDISK_ACCESS_TIME_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_simpledisk_param.h

2 #i‚de‡
_DISKSIM_SIMPLEDISK_PARAM_H


3 
	#_DISKSIM_SIMPLEDISK_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
sim∂edisk
 *
disksim_sim∂edisk_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_SIMPLEDISK_SCHEDULER
,

16 
DISKSIM_SIMPLEDISK_MAX_QUEUE_LENGTH
,

17 
DISKSIM_SIMPLEDISK_BLOCK_COUNT
,

18 
DISKSIM_SIMPLEDISK_BUS_TRANSACTION_LATENCY
,

19 
DISKSIM_SIMPLEDISK_BULK_SECTOR_TRANSFER_TIME
,

20 
DISKSIM_SIMPLEDISK_NEVER_DISCONNECT
,

21 
DISKSIM_SIMPLEDISK_PRINT_STATS
,

22 
DISKSIM_SIMPLEDISK_COMMAND_OVERHEAD
,

23 
DISKSIM_SIMPLEDISK_CONSTANT_ACCESS_TIME
,

24 
DISKSIM_SIMPLEDISK_ACCESS_TIME


25 } 
	tdisksim_sim∂edisk_∑øm_t
;

27 
	#DISKSIM_SIMPLEDISK_MAX_PARAM
 
DISKSIM_SIMPLEDISK_ACCESS_TIME


	)

28 * 
DISKSIM_SIMPLEDISK_lﬂdîs
[];

29 
Õ_∑ømdï_t
 
DISKSIM_SIMPLEDISK_dïs
[];

32 
Õ_v¨•ec
 
	gdisksim_sim∂edisk_∑øms
 [] = {

33 {"ScheduÀr", 
BLOCK
, 1 },

34 {"Max queuêÀngth", 
I
, 1 },

35 {"Block cou¡", 
I
, 1 },

36 {"Bu†å™ß˘i⁄Ü©ícy", 
D
, 0 },

37 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

38 {"Nevî disc⁄√˘", 
I
, 1 },

39 {"Pröà°©s", 
I
, 1 },

40 {"Comm™d ovîhód", 
D
, 1 },

41 {"C⁄°™àac˚s†time", 
D
, 0 },

42 {"Ac˚s†time", 
D
, 1 },

45 
	#DISKSIM_SIMPLEDISK_MAX
 10

	)

46 
Õ_mod
 
	gdisksim_sim∂edisk_mod
 = { "disksim_sim∂edisk", 
disksim_sim∂edisk_∑øms
, 
DISKSIM_SIMPLEDISK_MAX
, (
Õ_modlﬂdî_t
)
disksim_sim∂edisk_lﬂd∑øms
, 0, 0, 
DISKSIM_SIMPLEDISK_lﬂdîs
, 
DISKSIM_SIMPLEDISK_dïs
 };

49 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_stats_param.c

1 
	~"disksim_°©s_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

4 
	$DISKSIM_STATS_IODRIVER_STATS_dïíd
(*
bv
)

7 
	}
}

10 
	$DISKSIM_STATS_IODRIVER_STATS_lﬂdî
(
ªsu…
, 
Õ_block
 * 
blk
)

12 i‡(!(
	`disksim_iodrivî_°©s_lﬂd∑øms
(
blk
))) {

15 
	}
}

18 
	$DISKSIM_STATS_BUS_STATS_dïíd
(*
bv
)

21 
	}
}

24 
	$DISKSIM_STATS_BUS_STATS_lﬂdî
(
ªsu…
, 
Õ_block
 * 
blk
)

26 i‡(!(
	`disksim_bus_°©s_lﬂd∑øms
(
blk
))) {

29 
	}
}

32 
	$DISKSIM_STATS_CTLR_STATS_dïíd
(*
bv
)

35 
	}
}

38 
	$DISKSIM_STATS_CTLR_STATS_lﬂdî
(
ªsu…
, 
Õ_block
 * 
blk
)

40 i‡(!(
	`disksim_˘Ã_°©s_lﬂd∑øms
(
blk
))) {

43 
	}
}

46 
	$DISKSIM_STATS_DEVICE_STATS_dïíd
(*
bv
)

49 
	}
}

52 
	$DISKSIM_STATS_DEVICE_STATS_lﬂdî
(
ªsu…
, 
Õ_block
 * 
blk
)

54 i‡(!(
	`disksim_devi˚_°©s_lﬂd∑øms
(
blk
))) {

57 
	}
}

60 
	$DISKSIM_STATS_PROCESS_FLOW_STATS_dïíd
(*
bv
)

63 
	}
}

66 
	$DISKSIM_STATS_PROCESS_FLOW_STATS_lﬂdî
(
ªsu…
, 
Õ_block
 * 
blk
)

68 i‡(!(
	`disksim_pf_°©s_lﬂd∑øms
(
blk
))) {

71 
	}
}

73 *
	gDISKSIM_STATS_lﬂdîs
[] = {

74 (*Ë
DISKSIM_STATS_IODRIVER_STATS_lﬂdî
,

75 (*Ë
DISKSIM_STATS_BUS_STATS_lﬂdî
,

76 (*Ë
DISKSIM_STATS_CTLR_STATS_lﬂdî
,

77 (*Ë
DISKSIM_STATS_DEVICE_STATS_lﬂdî
,

78 (*Ë
DISKSIM_STATS_PROCESS_FLOW_STATS_lﬂdî


81 
Õ_∑ømdï_t
 
	gDISKSIM_STATS_dïs
[] = {

82 
DISKSIM_STATS_IODRIVER_STATS_dïíd
,

83 
DISKSIM_STATS_BUS_STATS_dïíd
,

84 
DISKSIM_STATS_CTLR_STATS_dïíd
,

85 
DISKSIM_STATS_DEVICE_STATS_dïíd
,

86 
DISKSIM_STATS_PROCESS_FLOW_STATS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_stats_param.h

2 #i‚de‡
_DISKSIM_STATS_PARAM_H


3 
	#_DISKSIM_STATS_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_°©s_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_STATS_IODRIVER_STATS
,

16 
DISKSIM_STATS_BUS_STATS
,

17 
DISKSIM_STATS_CTLR_STATS
,

18 
DISKSIM_STATS_DEVICE_STATS
,

19 
DISKSIM_STATS_PROCESS_FLOW_STATS


20 } 
	tdisksim_°©s_∑øm_t
;

22 
	#DISKSIM_STATS_MAX_PARAM
 
DISKSIM_STATS_PROCESS_FLOW_STATS


	)

23 * 
DISKSIM_STATS_lﬂdîs
[];

24 
Õ_∑ømdï_t
 
DISKSIM_STATS_dïs
[];

27 
Õ_v¨•ec
 
	gdisksim_°©s_∑øms
 [] = {

28 {"iodrivî sèts", 
BLOCK
, 1 },

29 {"bu†°©s", 
BLOCK
, 1 },

30 {"˘Ã sèts", 
BLOCK
, 1 },

31 {"devi˚ sèts", 
BLOCK
, 1 },

32 {"¥o˚s†Êow sèts", 
BLOCK
, 1 },

35 
	#DISKSIM_STATS_MAX
 5

	)

36 
Õ_mod
 
	gdisksim_°©s_mod
 = { "disksim_°©s", 
disksim_°©s_∑øms
, 
DISKSIM_STATS_MAX
, (
Õ_modlﬂdî_t
)
disksim_°©s_lﬂd∑øms
, 0, 0, 
DISKSIM_STATS_lﬂdîs
, 
DISKSIM_STATS_dïs
 };

39 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_syncset_param.c

1 
	~"disksim_sync£t_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

4 
	$_dïíd
(*
bv
)

7 
	}
}

10 
	$DISKSIM_SYNCSET_TYPE_lﬂdî
(
ªsu…
, *
s
)

13 
	}
}

15 *
	gDISKSIM_SYNCSET_lﬂdîs
[] = {

16 (*Ë
DISKSIM_SYNCSET_TYPE_lﬂdî


19 
Õ_∑ømdï_t
 
	gDISKSIM_SYNCSET_dïs
[] = {

20 
_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_syncset_param.h

2 #i‚de‡
_DISKSIM_SYNCSET_PARAM_H


3 
	#_DISKSIM_SYNCSET_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_sync£t_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_SYNCSET_TYPE
,

16 
DISKSIM_SYNCSET_DEVICES


17 } 
	tdisksim_sync£t_∑øm_t
;

19 
	#DISKSIM_SYNCSET_MAX_PARAM
 
DISKSIM_SYNCSET_DEVICES


	)

20 * 
DISKSIM_SYNCSET_lﬂdîs
[];

21 
Õ_∑ømdï_t
 
DISKSIM_SYNCSET_dïs
[];

24 
Õ_v¨•ec
 
	gdisksim_sync£t_∑øms
 [] = {

25 {"ty≥", 
S
, 1 },

26 {"devi˚s", 
LIST
, 1 },

29 
	#DISKSIM_SYNCSET_MAX
 2

	)

30 
Õ_mod
 
	gdisksim_sync£t_mod
 = { "disksim_sync£t", 
disksim_sync£t_∑øms
, 
DISKSIM_SYNCSET_MAX
, (
Õ_modlﬂdî_t
)
disksim_sync£t_lﬂd∑øms
, 0, 0, 
DISKSIM_SYNCSET_lﬂdîs
, 
DISKSIM_SYNCSET_dïs
 };

33 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_synthgen_param.c

1 
	~"disksim_sy¡hgí_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_sy¡hio.h
"

5 
	$DISKSIM_SYNTHGEN_STORAGE_CAPACITY_PER_DEVICE_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_SYNTHGEN_STORAGE_CAPACITY_PER_DEVICE_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
i
)

13 i‡(!(
i
 > 0)) {

16 (*
ªsu…
)->
£˘•îdisk
 = 
i
;

18 
	}
}

21 
	$DISKSIM_SYNTHGEN_DEVICES_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_SYNTHGEN_DEVICES_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
Õ_li°
 * 
l
)

29 i‡(!(!
	`lﬂdsy¡hdevs
((*
ªsu…
), 
l
))) {

32 
	}
}

35 
	$DISKSIM_SYNTHGEN_BLOCKING_FACTOR_dïíd
(*
bv
)

38 
	}
}

41 
	$DISKSIM_SYNTHGEN_BLOCKING_FACTOR_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
i
)

43 i‡(!(
i
 > 0)) {

46 (*
ªsu…
)->
blocksize
 = 
i
;

48 
	}
}

51 
	$DISKSIM_SYNTHGEN_PROBABILITY_OF_SEQUENTIAL_ACCESS_dïíd
(*
bv
)

54 
	}
}

57 
	$DISKSIM_SYNTHGEN_PROBABILITY_OF_SEQUENTIAL_ACCESS_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
d
)

59 i‡(!(
	`RANGE
(
d
, 0.0, 1.0))) {

62 (*
ªsu…
)->
¥ob£q
 = 
d
;

64 
	}
}

67 
	$DISKSIM_SYNTHGEN_PROBABILITY_OF_LOCAL_ACCESS_dïíd
(*
bv
)

70 
	}
}

73 
	$DISKSIM_SYNTHGEN_PROBABILITY_OF_LOCAL_ACCESS_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
d
)

75 i‡(!(
	`RANGE
(
d
, 0.0, 1.0))) {

78 (*
ªsu…
)->
¥obloc
 = 
d
;

80 
	}
}

83 
	$DISKSIM_SYNTHGEN_PROBABILITY_OF_READ_ACCESS_dïíd
(*
bv
)

86 
	}
}

89 
	$DISKSIM_SYNTHGEN_PROBABILITY_OF_READ_ACCESS_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
d
)

91 i‡(!(
	`RANGE
(
d
, 0.0, 1.0))) {

94 (*
ªsu…
)->
¥obªad
 = 
d
;

96 
	}
}

99 
	$DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_CRITICAL_REQUEST_dïíd
(*
bv
)

102 
	}
}

105 
	$DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_CRITICAL_REQUEST_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
d
)

107 i‡(!(
	`RANGE
(
d
, 0.0, 1.0))) {

110 (*
ªsu…
)->
¥obtm¸ô
 = 
d
;

112 
	}
}

115 
	$DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_LIMITED_REQUEST_dïíd
(*
bv
)

118 
	}
}

121 
	$DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_LIMITED_REQUEST_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
d
)

123 i‡(!(
	`RANGE
(
d
, 0.0, 1.0))) {

126 (*
ªsu…
)->
¥obtmlim
 = 
d
;

128 
	}
}

131 
	$DISKSIM_SYNTHGEN_TIME_LIMITED_THINK_TIMES_dïíd
(*
bv
)

134 
	}
}

137 
	$DISKSIM_SYNTHGEN_TIME_LIMITED_THINK_TIMES_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
Õ_li°
 * 
l
)

139 i‡(!(!
	`lﬂddi°n
(
l
, &(*
ªsu…
)->
tmlimô
))) {

142 
	}
}

145 
	$DISKSIM_SYNTHGEN_GENERAL_INTER_ARRIVAL_TIMES_dïíd
(*
bv
)

148 
	}
}

151 
	$DISKSIM_SYNTHGEN_GENERAL_INTER_ARRIVAL_TIMES_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
Õ_li°
 * 
l
)

153 i‡(!(!
	`lﬂddi°n
(
l
, &(*
ªsu…
)->
gíöå
))) {

156 
	}
}

159 
	$DISKSIM_SYNTHGEN_SEQUENTIAL_INTER_ARRIVAL_TIMES_dïíd
(*
bv
)

162 
	}
}

165 
	$DISKSIM_SYNTHGEN_SEQUENTIAL_INTER_ARRIVAL_TIMES_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
Õ_li°
 * 
l
)

167 i‡(!(!
	`lﬂddi°n
(
l
, &(*
ªsu…
)->
£qöå
))) {

170 
	}
}

173 
	$DISKSIM_SYNTHGEN_LOCAL_INTER_ARRIVAL_TIMES_dïíd
(*
bv
)

176 
	}
}

179 
	$DISKSIM_SYNTHGEN_LOCAL_INTER_ARRIVAL_TIMES_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
Õ_li°
 * 
l
)

181 i‡(!(!
	`lﬂddi°n
(
l
, &(*
ªsu…
)->
locöå
))) {

184 
	}
}

187 
	$DISKSIM_SYNTHGEN_LOCAL_DISTANCES_dïíd
(*
bv
)

190 
	}
}

193 
	$DISKSIM_SYNTHGEN_LOCAL_DISTANCES_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
Õ_li°
 * 
l
)

195 i‡(!(!
	`lﬂddi°n
(
l
, &(*
ªsu…
)->
locdi°
))) {

198 
	}
}

201 
	$DISKSIM_SYNTHGEN_SIZES_dïíd
(*
bv
)

204 
	}
}

207 
	$DISKSIM_SYNTHGEN_SIZES_lﬂdî
(
sy¡hio_gíî©‹
 ** 
ªsu…
, 
Õ_li°
 * 
l
)

209 i‡(!(!
	`lﬂddi°n
(
l
, &(*
ªsu…
)->
sizedi°
))) {

212 
	}
}

214 *
	gDISKSIM_SYNTHGEN_lﬂdîs
[] = {

215 (*Ë
DISKSIM_SYNTHGEN_STORAGE_CAPACITY_PER_DEVICE_lﬂdî
,

216 (*Ë
DISKSIM_SYNTHGEN_DEVICES_lﬂdî
,

217 (*Ë
DISKSIM_SYNTHGEN_BLOCKING_FACTOR_lﬂdî
,

218 (*Ë
DISKSIM_SYNTHGEN_PROBABILITY_OF_SEQUENTIAL_ACCESS_lﬂdî
,

219 (*Ë
DISKSIM_SYNTHGEN_PROBABILITY_OF_LOCAL_ACCESS_lﬂdî
,

220 (*Ë
DISKSIM_SYNTHGEN_PROBABILITY_OF_READ_ACCESS_lﬂdî
,

221 (*Ë
DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_CRITICAL_REQUEST_lﬂdî
,

222 (*Ë
DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_LIMITED_REQUEST_lﬂdî
,

223 (*Ë
DISKSIM_SYNTHGEN_TIME_LIMITED_THINK_TIMES_lﬂdî
,

224 (*Ë
DISKSIM_SYNTHGEN_GENERAL_INTER_ARRIVAL_TIMES_lﬂdî
,

225 (*Ë
DISKSIM_SYNTHGEN_SEQUENTIAL_INTER_ARRIVAL_TIMES_lﬂdî
,

226 (*Ë
DISKSIM_SYNTHGEN_LOCAL_INTER_ARRIVAL_TIMES_lﬂdî
,

227 (*Ë
DISKSIM_SYNTHGEN_LOCAL_DISTANCES_lﬂdî
,

228 (*Ë
DISKSIM_SYNTHGEN_SIZES_lﬂdî


231 
Õ_∑ømdï_t
 
	gDISKSIM_SYNTHGEN_dïs
[] = {

232 
DISKSIM_SYNTHGEN_STORAGE_CAPACITY_PER_DEVICE_dïíd
,

233 
DISKSIM_SYNTHGEN_DEVICES_dïíd
,

234 
DISKSIM_SYNTHGEN_BLOCKING_FACTOR_dïíd
,

235 
DISKSIM_SYNTHGEN_PROBABILITY_OF_SEQUENTIAL_ACCESS_dïíd
,

236 
DISKSIM_SYNTHGEN_PROBABILITY_OF_LOCAL_ACCESS_dïíd
,

237 
DISKSIM_SYNTHGEN_PROBABILITY_OF_READ_ACCESS_dïíd
,

238 
DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_CRITICAL_REQUEST_dïíd
,

239 
DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_LIMITED_REQUEST_dïíd
,

240 
DISKSIM_SYNTHGEN_TIME_LIMITED_THINK_TIMES_dïíd
,

241 
DISKSIM_SYNTHGEN_GENERAL_INTER_ARRIVAL_TIMES_dïíd
,

242 
DISKSIM_SYNTHGEN_SEQUENTIAL_INTER_ARRIVAL_TIMES_dïíd
,

243 
DISKSIM_SYNTHGEN_LOCAL_INTER_ARRIVAL_TIMES_dïíd
,

244 
DISKSIM_SYNTHGEN_LOCAL_DISTANCES_dïíd
,

245 
DISKSIM_SYNTHGEN_SIZES_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_synthgen_param.h

2 #i‚de‡
_DISKSIM_SYNTHGEN_PARAM_H


3 
	#_DISKSIM_SYNTHGEN_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_sy¡hgí_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_SYNTHGEN_STORAGE_CAPACITY_PER_DEVICE
,

16 
DISKSIM_SYNTHGEN_DEVICES
,

17 
DISKSIM_SYNTHGEN_BLOCKING_FACTOR
,

18 
DISKSIM_SYNTHGEN_PROBABILITY_OF_SEQUENTIAL_ACCESS
,

19 
DISKSIM_SYNTHGEN_PROBABILITY_OF_LOCAL_ACCESS
,

20 
DISKSIM_SYNTHGEN_PROBABILITY_OF_READ_ACCESS
,

21 
DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_CRITICAL_REQUEST
,

22 
DISKSIM_SYNTHGEN_PROBABILITY_OF_TIME_LIMITED_REQUEST
,

23 
DISKSIM_SYNTHGEN_TIME_LIMITED_THINK_TIMES
,

24 
DISKSIM_SYNTHGEN_GENERAL_INTER_ARRIVAL_TIMES
,

25 
DISKSIM_SYNTHGEN_SEQUENTIAL_INTER_ARRIVAL_TIMES
,

26 
DISKSIM_SYNTHGEN_LOCAL_INTER_ARRIVAL_TIMES
,

27 
DISKSIM_SYNTHGEN_LOCAL_DISTANCES
,

28 
DISKSIM_SYNTHGEN_SIZES


29 } 
	tdisksim_sy¡hgí_∑øm_t
;

31 
	#DISKSIM_SYNTHGEN_MAX_PARAM
 
DISKSIM_SYNTHGEN_SIZES


	)

32 * 
DISKSIM_SYNTHGEN_lﬂdîs
[];

33 
Õ_∑ømdï_t
 
DISKSIM_SYNTHGEN_dïs
[];

36 
Õ_v¨•ec
 
	gdisksim_sy¡hgí_∑øms
 [] = {

37 {"St‹agêˇ∑côyÖî devi˚", 
I
, 1 },

38 {"devi˚s", 
LIST
, 1 },

39 {"Blockög fa˘‹", 
I
, 1 },

40 {"Probabûôy o‡£quítü»ac˚ss", 
D
, 1 },

41 {"Probabûôy o‡loˇ»ac˚ss", 
D
, 1 },

42 {"Probabûôy o‡ªadác˚ss", 
D
, 1 },

43 {"Probabûôy o‡time-¸ôiˇ»ªque°", 
D
, 1 },

44 {"Probabûôy o‡time-limôedÑeque°", 
D
, 1 },

45 {"Time-limôedÅhökÅimes", 
LIST
, 1 },

46 {"GíîÆ i¡î-¨rivÆÅimes", 
LIST
, 1 },

47 {"Sequítü»öãr-¨rivÆÅimes", 
LIST
, 1 },

48 {"Loˇ»öãr-¨rivÆÅimes", 
LIST
, 1 },

49 {"Loˇ»di°™˚s", 
LIST
, 1 },

50 {"Sizes", 
LIST
, 1 },

53 
	#DISKSIM_SYNTHGEN_MAX
 14

	)

54 
Õ_mod
 
	gdisksim_sy¡hgí_mod
 = { "disksim_sy¡hgí", 
disksim_sy¡hgí_∑øms
, 
DISKSIM_SYNTHGEN_MAX
, (
Õ_modlﬂdî_t
)
disksim_sy¡hgí_lﬂd∑øms
, 0, 0, 
DISKSIM_SYNTHGEN_lﬂdîs
, 
DISKSIM_SYNTHGEN_dïs
 };

57 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_synthio_param.c

1 
	~"disksim_sy¡hio_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../disksim_sy¡hio.h
"

5 
	$DISKSIM_SYNTHIO_NUMBER_OF_IO_REQUESTS_TO_GENERATE_dïíd
(*
bv
)

8 
	}
}

11 
	$DISKSIM_SYNTHIO_NUMBER_OF_IO_REQUESTS_TO_GENERATE_lﬂdî
(
ªsu…
, 
i
)

13 i‡(!(
i
 > 0)) {

16 
sy¡hio_ídio˙t
 = 
i
;

18 
	}
}

21 
	$DISKSIM_SYNTHIO_MAXIMUM_TIME_OF_TRACE_GENERATED_dïíd
(*
bv
)

24 
	}
}

27 
	$DISKSIM_SYNTHIO_MAXIMUM_TIME_OF_TRACE_GENERATED_lﬂdî
(
ªsu…
, 
d
)

29 i‡(!(
d
 > 0.0)) {

32 
sy¡hio_ídtime
 = 
d
;

33 
sy¡hio_ídtime
 *= 1000.0;

35 
	}
}

38 
	$DISKSIM_SYNTHIO_SYSTEM_CALLRETURN_WITH_EACH_REQUEST_dïíd
(*
bv
)

41 
	}
}

44 
	$DISKSIM_SYNTHIO_SYSTEM_CALLRETURN_WITH_EACH_REQUEST_lﬂdî
(
ªsu…
, 
i
)

46 i‡(!(
	`RANGE
(
i
, 0, 1))) {

49 
sy¡hio_sysˇŒs
 = 
i
;

51 
	}
}

54 
	$DISKSIM_SYNTHIO_THINK_TIME_FROM_CALL_TO_REQUEST_dïíd
(*
bv
)

57 
	}
}

60 
	$DISKSIM_SYNTHIO_THINK_TIME_FROM_CALL_TO_REQUEST_lﬂdî
(
ªsu…
, 
d
)

62 i‡(!(
d
 >= 0.0)) {

65 
sy¡hio_sysˇŒ_time
 = 
d
;

67 
	}
}

70 
	$DISKSIM_SYNTHIO_THINK_TIME_FROM_REQUEST_TO_RETURN_dïíd
(*
bv
)

73 
	}
}

76 
	$DISKSIM_SYNTHIO_THINK_TIME_FROM_REQUEST_TO_RETURN_lﬂdî
(
ªsu…
, 
d
)

78 i‡(!(
d
 >= 0.0)) {

81 
sy¡hio_sy§ë_time
 = 
d
;

83 
	}
}

86 
	$DISKSIM_SYNTHIO_GENERATORS_dïíd
(*
bv
)

89 
	}
}

92 
	$DISKSIM_SYNTHIO_GENERATORS_lﬂdî
(
ªsu…
, 
Õ_li°
 * 
l
)

94 i‡(!(!
	`lﬂdsy¡hgíî©‹s
(0, 
l
))) {

97 
	}
}

99 *
	gDISKSIM_SYNTHIO_lﬂdîs
[] = {

100 (*Ë
DISKSIM_SYNTHIO_NUMBER_OF_IO_REQUESTS_TO_GENERATE_lﬂdî
,

101 (*Ë
DISKSIM_SYNTHIO_MAXIMUM_TIME_OF_TRACE_GENERATED_lﬂdî
,

102 (*Ë
DISKSIM_SYNTHIO_SYSTEM_CALLRETURN_WITH_EACH_REQUEST_lﬂdî
,

103 (*Ë
DISKSIM_SYNTHIO_THINK_TIME_FROM_CALL_TO_REQUEST_lﬂdî
,

104 (*Ë
DISKSIM_SYNTHIO_THINK_TIME_FROM_REQUEST_TO_RETURN_lﬂdî
,

105 (*Ë
DISKSIM_SYNTHIO_GENERATORS_lﬂdî


108 
Õ_∑ømdï_t
 
	gDISKSIM_SYNTHIO_dïs
[] = {

109 
DISKSIM_SYNTHIO_NUMBER_OF_IO_REQUESTS_TO_GENERATE_dïíd
,

110 
DISKSIM_SYNTHIO_MAXIMUM_TIME_OF_TRACE_GENERATED_dïíd
,

111 
DISKSIM_SYNTHIO_SYSTEM_CALLRETURN_WITH_EACH_REQUEST_dïíd
,

112 
DISKSIM_SYNTHIO_THINK_TIME_FROM_CALL_TO_REQUEST_dïíd
,

113 
DISKSIM_SYNTHIO_THINK_TIME_FROM_REQUEST_TO_RETURN_dïíd
,

114 
DISKSIM_SYNTHIO_GENERATORS_dïíd


	@/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_synthio_param.h

2 #i‚de‡
_DISKSIM_SYNTHIO_PARAM_H


3 
	#_DISKSIM_SYNTHIO_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
disksim_sy¡hio_lﬂd∑øms
(
Õ_block
 *
b
);

15 
DISKSIM_SYNTHIO_NUMBER_OF_IO_REQUESTS_TO_GENERATE
,

16 
DISKSIM_SYNTHIO_MAXIMUM_TIME_OF_TRACE_GENERATED
,

17 
DISKSIM_SYNTHIO_SYSTEM_CALLRETURN_WITH_EACH_REQUEST
,

18 
DISKSIM_SYNTHIO_THINK_TIME_FROM_CALL_TO_REQUEST
,

19 
DISKSIM_SYNTHIO_THINK_TIME_FROM_REQUEST_TO_RETURN
,

20 
DISKSIM_SYNTHIO_GENERATORS


21 } 
	tdisksim_sy¡hio_∑øm_t
;

23 
	#DISKSIM_SYNTHIO_MAX_PARAM
 
DISKSIM_SYNTHIO_GENERATORS


	)

24 * 
DISKSIM_SYNTHIO_lﬂdîs
[];

25 
Õ_∑ømdï_t
 
DISKSIM_SYNTHIO_dïs
[];

28 
Õ_v¨•ec
 
	gdisksim_sy¡hio_∑øms
 [] = {

29 {"Numbî o‡I/OÑeque°†tÿgíî©e", 
I
, 1 },

30 {"MaximumÅimêo‡åa˚ gíî©ed", 
D
, 1 },

31 {"Sy°em cÆl/ªtu∫ wôhÉachÑeque°", 
I
, 1 },

32 {"ThökÅimê‰om cÆ»tÿªque°", 
D
, 1 },

33 {"ThökÅimê‰omÑeque°Åÿªtu∫", 
D
, 1 },

34 {"Gíî©‹s", 
LIST
, 1 },

37 
	#DISKSIM_SYNTHIO_MAX
 6

	)

38 
Õ_mod
 
	gdisksim_sy¡hio_mod
 = { "disksim_sy¡hio", 
disksim_sy¡hio_∑øms
, 
DISKSIM_SYNTHIO_MAX
, (
Õ_modlﬂdî_t
)
disksim_sy¡hio_lﬂd∑øms
, 0, 0, 
DISKSIM_SYNTHIO_lﬂdîs
, 
DISKSIM_SYNTHIO_dïs
 };

41 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/src/modules/modules.h

2 #i‚de‡
_DISKSIM_MODULES_H


3 
	#_DISKSIM_MODULES_H


	)

6 
	~"disksim_bus_∑øm.h
"

7 
	~"disksim_bus_°©s_∑øm.h
"

8 
	~"disksim_ˇchedev_∑øm.h
"

9 
	~"disksim_ˇchemem_∑øm.h
"

10 
	~"disksim_˘Ã_∑øm.h
"

11 
	~"disksim_˘Ã_°©s_∑øm.h
"

12 
	~"disksim_devi˚_∑øm.h
"

13 
	~"disksim_devi˚_°©s_∑øm.h
"

14 
	~"disksim_disk_∑øm.h
"

15 
	~"disksim_f˛_∑øm.h
"

16 
	~"disksim_globÆ_∑øm.h
"

17 
	~"disksim_iodrivî_∑øm.h
"

18 
	~"disksim_iodrivî_°©s_∑øm.h
"

19 
	~"disksim_iom≠_∑øm.h
"

20 
	~"disksim_ioqueue_∑øm.h
"

21 
	~"disksim_iosim_∑øm.h
"

22 
	~"disksim_log‹g_∑øm.h
"

23 
	~"disksim_pf_∑øm.h
"

24 
	~"disksim_pf_°©s_∑øm.h
"

25 
	~"disksim_sim∂edisk_∑øm.h
"

26 
	~"disksim_°©s_∑øm.h
"

27 
	~"disksim_sync£t_∑øm.h
"

28 
	~"disksim_sy¡hgí_∑øm.h
"

29 
	~"disksim_sy¡hio_∑øm.h
"

32 
Õ_mod
 *
	gdisksim_mods
[] = {

33 &
disksim_bus_mod
 ,

34 &
disksim_bus_°©s_mod
 ,

35 &
disksim_ˇchedev_mod
 ,

36 &
disksim_ˇchemem_mod
 ,

37 &
disksim_˘Ã_mod
 ,

38 &
disksim_˘Ã_°©s_mod
 ,

39 &
disksim_devi˚_mod
 ,

40 &
disksim_devi˚_°©s_mod
 ,

41 &
disksim_disk_mod
 ,

42 &
disksim_f˛_mod
 ,

43 &
disksim_globÆ_mod
 ,

44 &
disksim_iodrivî_mod
 ,

45 &
disksim_iodrivî_°©s_mod
 ,

46 &
disksim_iom≠_mod
 ,

47 &
disksim_ioqueue_mod
 ,

48 &
disksim_iosim_mod
 ,

49 &
disksim_log‹g_mod
 ,

50 &
disksim_pf_mod
 ,

51 &
disksim_pf_°©s_mod
 ,

52 &
disksim_sim∂edisk_mod
 ,

53 &
disksim_°©s_mod
 ,

54 &
disksim_sync£t_mod
 ,

55 &
disksim_sy¡hgí_mod
 ,

56 &
disksim_sy¡hio_mod


60 
	mDISKSIM_MOD_BUS
,

61 
	mDISKSIM_MOD_BUS_STATS
,

62 
	mDISKSIM_MOD_CACHEDEV
,

63 
	mDISKSIM_MOD_CACHEMEM
,

64 
	mDISKSIM_MOD_CTLR
,

65 
	mDISKSIM_MOD_CTLR_STATS
,

66 
	mDISKSIM_MOD_DEVICE
,

67 
	mDISKSIM_MOD_DEVICE_STATS
,

68 
	mDISKSIM_MOD_DISK
,

69 
	mDISKSIM_MOD_FCL
,

70 
	mDISKSIM_MOD_GLOBAL
,

71 
	mDISKSIM_MOD_IODRIVER
,

72 
	mDISKSIM_MOD_IODRIVER_STATS
,

73 
	mDISKSIM_MOD_IOMAP
,

74 
	mDISKSIM_MOD_IOQUEUE
,

75 
	mDISKSIM_MOD_IOSIM
,

76 
	mDISKSIM_MOD_LOGORG
,

77 
	mDISKSIM_MOD_PF
,

78 
	mDISKSIM_MOD_PF_STATS
,

79 
	mDISKSIM_MOD_SIMPLEDISK
,

80 
	mDISKSIM_MOD_STATS
,

81 
	mDISKSIM_MOD_SYNCSET
,

82 
	mDISKSIM_MOD_SYNTHGEN
,

83 
	mDISKSIM_MOD_SYNTHIO


84 } 
	tdisksim_mod_t
;

86 
	#DISKSIM_MAX_MODULE
 23

	)

	@/Users/ysoh/disksim-4.0-fcl/src/poison.h

1 #i‚de‡
_LINUX_POISON_H


2 
	#_LINUX_POISON_H


	)

11 #ifde‡
CONFIG_ILLEGAL_POINTER_VALUE


12 
	#POISON_POINTER_DELTA
 
	`_AC
(
CONFIG_ILLEGAL_POINTER_VALUE
, 
UL
)

	)

14 
	#POISON_POINTER_DELTA
 0

	)

22 
	#LIST_POISON1
 ((*Ë0x00100100 + 
POISON_POINTER_DELTA
)

	)

23 
	#LIST_POISON2
 ((*Ë0x00200200 + 
POISON_POINTER_DELTA
)

	)

30 
	#TIMER_ENTRY_STATIC
 ((*Ë0x74737461)

	)

33 
	#PAGE_POISON
 0xØ

	)

40 
	#RED_INACTIVE
 0x09F911029D74E35BULL

	)

41 
	#RED_ACTIVE
 0xD84156C5635688C0ULL

	)

43 
	#SLUB_RED_INACTIVE
 0xbb

	)

44 
	#SLUB_RED_ACTIVE
 0xcc

	)

47 
	#POISON_INUSE
 0x5®

	)

48 
	#POISON_FREE
 0x6b

	)

49 
	#POISON_END
 0xa5

	)

52 
	#POISON_FREE_INITMEM
 0xcc

	)

61 
	#JBD_POISON_FREE
 0x5b

	)

62 
	#JBD2_POISON_FREE
 0x5c

	)

65 
	#POOL_POISON_FREED
 0xa7

	)

66 
	#POOL_POISON_ALLOCATED
 0xa9

	)

69 
	#ATM_POISON_FREE
 0x12

	)

70 
	#ATM_POISON
 0xdódbìf

	)

73 
	#NEIGHBOR_DEAD
 0xdódbìf

	)

74 
	#NETFILTER_LINK_POISON
 0xdód57ac

	)

77 
	#MUTEX_DEBUG_INIT
 0x11

	)

78 
	#MUTEX_DEBUG_FREE
 0x22

	)

81 
	#FLEX_ARRAY_FREE
 0x6¯

	)

84 
	#KEY_DESTROY
 0xbd

	)

87 
	#OSS_POISON_FREE
 0xAB

	)

	@/Users/ysoh/disksim-4.0-fcl/src/raw_layout.c

56 
	#DISKSIM


	)

58 #ifde‡
DISKSIM


60 
	~<°dio.h
>

61 
	~<°dlib.h
>

63 
	~"disksim_globÆ.h
"

64 
	~"disksim_iosim.h
"

65 
	~"disksim_disk.h
"

66 
	#öã∫Æ_îr‹
 
¥ötf


	)

67 
	#îr‹_h™dÀr
 
¥ötf


	)

71 
	~"dixåac.h
"

72 
	~"h™dÀ_îr‹.h
"

73 
	~"exåa˘_œyout.h
"

74 
b™d_t
 
	tb™d
;

75 
disköfo_t
 
	tdisk
;

79 #ifde‡
RAWLAYOUT_SUPPORT


83 
	#MAXSECTORS
 1000

	)

86 
	#COUNT_THRSHLD
 19

	)

88 
	#PERCENT
 0.04

	)

91 
	#MIN_CYL_DISTANCE
 20

	)

93 
	#NOVAL
 -9999

	)

95 
	ss‰eq
 {

96 
	mcou¡
,
	mcyls
;

97 
	mmöcyl
,
	mmaxcyl
;

98 } 
	ts‰eq_t
;

105 
	$dëîmöe_z⁄es
(
disk
 *
cuºdisk
, 
s‰eq_t
 *
£˘‰eq
, 
ˇ∑côy
)

107 
	s•
 {

108 
•t
;

109 
cou¡
;

110 
avgcyl
;

111 
•
 *
√xt
;

112 } 
	t•t_t
;

114 
•t_t
 *
£˘•îåk
, *
cuº•t
, *
ãmp
;

115 
•t_t
 *
¥ev
 = 0;

116 
i
;

118 
£˘≥rcyl_sum
 = 0;

120 i‡(!(
£˘•îåk
 = (
•t_t
 *Ë
	`mÆloc
((spt_t))))

121 
	`Ârötf
(
°dîr
,"CouldÇotállocate memory!\n");

123 
£˘•îåk
->
•t
 = 0;

124 
£˘•îåk
->
cou¡
 = 0;

125 
£˘•îåk
->
avgcyl
 = 0;

126 
£˘•îåk
->
√xt
 = 
NULL
;

128 
i
=1;i<
MAXSECTORS
;i++) {

129 i‡(
£˘‰eq
[
i
].
cou¡
 > 0) {

130 
avg
 = 
£˘‰eq
[
i
].
cyls
 / se˘‰eq[i].
cou¡
;

131 
cuº•t
 = 
£˘•îåk
;

133 i‡(
	`abs
(
avg
 - 
cuº•t
->
avgcyl
Ë> (cuº•t->avgcy»* 
PERCENT
)) {

134 i‡(
£˘‰eq
[
i
].
cou¡
 >(
COUNT_THRSHLD
 * 
ˇ∑côy
)) {

135 i‡(!(
ãmp
 = (
•t_t
 *Ë
	`mÆloc
((spt_t)))) {

136 
	`Ârötf
(
°dîr
,"CouldÇotállocate memory!\n");

138 
ãmp
->
•t
 = 
i
;

139 
ãmp
->
cou¡
 = 
£˘‰eq
[
i
].count;

140 
ãmp
->
avgcyl
 = 
£˘‰eq
[
i
].
cyls
 / se˘‰eq[i].
cou¡
;

141 
ãmp
->
√xt
 = 
cuº•t
;

142 i‡(
cuº•t
 =
£˘•îåk
) {

143 
£˘•îåk
 = 
ãmp
;

146 
¥ev
->
√xt
 = 
ãmp
;

152 i‡(
£˘‰eq
[
i
].
cou¡
 > 
cuº•t
->count) {

153 
cuº•t
->
•t
 = 
i
;

154 
cuº•t
->
cou¡
 = 
£˘‰eq
[
i
].count;

155 
cuº•t
->
avgcyl
 = 
£˘‰eq
[
i
].
cyls
 / se˘‰eq[i].
cou¡
;

159 
¥ev
 = 
cuº•t
;

160 } (
cuº•t
 = cuº•t->
√xt
));

162 #ifde‡
PRINT_LAYOUT_INFO


163 i‡(
i
 == 1) {

164 
	`¥ötf
("\tSPT\tCount\tAvg. Cyl\n");

165 
	`¥ötf
("=============================\n");

167 i‡(
£˘‰eq
[
i
].
cou¡
 > 0) {

168 
	`¥ötf
("\t%d\t%d\t%d\n",
i
,
£˘‰eq
[i].
cou¡
,

169 
£˘‰eq
[
i
].
cyls
 / se˘‰eq[i].
cou¡
);

174 
cuº•t
 = 
£˘•îåk
;

176 #ifde‡
PRINT_LAYOUT_INFO


177 
	`¥ötf
("\nSPT\tCount\tAvg. Cyl\tMin. Cyl\tMax. Cyl\n");

178 
	`¥ötf
("========================================================\n");

181 
i
 = 0;

183 i‡(
cuº•t
->
cou¡
 > 0) {

184 
cuºdisk
->
b™ds
[
i
].
°¨tcyl
 = 
£˘‰eq
[
cuº•t
->
•t
].
möcyl
;

185 
cuºdisk
->
b™ds
[
i
].
ídcyl
 = 
£˘‰eq
[
cuº•t
->
•t
].
maxcyl
;

186 
cuºdisk
->
b™ds
[
i
].
blk•îåack
 = 
cuº•t
->
•t
;

187 
cuºdisk
->
b™ds
[
i
].
blksöb™d
 =

188 
cuºdisk
->
æcyls
[cuºdisk->
b™ds
[
i
].
ídcyl
].
œ°lbn
 -

189 
cuºdisk
->
æcyls
[cuºdisk->
b™ds
[
i
].
°¨tcyl
].
fú°lbn
 + 1;

191 
cuºdisk
->
b™ds
[
i
].
fú°blkno
 = 0.0;

192 
cuºdisk
->
b™ds
[
i
].
dód•a˚
 = 0;

193 
cuºdisk
->
b™ds
[
i
].
•¨e˙t
 = 0;

194 
cuºdisk
->
b™ds
[
i
].
num¶ùs
 = 0;

196 
£˘≥rcyl_sum
 +
cuº•t
->
•t
 * 
cuºdisk
->
numsurÁ˚s
;

198 #ifde‡
PRINT_LAYOUT_INFO


199 
	`¥ötf
("%3d\t%6d\t%6d",
cuº•t
->
•t
,cuº•t->
cou¡
,cuº•t->
avgcyl
);

200 
	`¥ötf
("\t\t%6d\t\t%6d\n",
£˘‰eq
[
cuº•t
->
•t
].
möcyl
,

201 
£˘‰eq
[
cuº•t
->
•t
].
maxcyl
);

203 
i
++;

205 
ãmp
 = 
cuº•t
;

206 
	`‰ì
(
ãmp
);

207 
cuº•t
 = cuº•t->
√xt
;

208 } 
cuº•t
);

209 
cuºdisk
->
numb™ds
 = 
i
;

211 
cuºdisk
->
£˘≥rcyl
 = 
£˘≥rcyl_sum
 / cuºdisk->
numb™ds
;

213 #ifde‡
PRINT_LAYOUT_INFO


214 
	`¥ötf
("\n\n");

215 
	`¥ötf
("SPT\tStart LBN\tEnd LBN \tMin. Cyl\tMax. Cyl\n");

216 
	`¥ötf
("================================================================\n");

218 
tŸÆ
 = 0;

219 
i
=0;i< 
cuºdisk
->
numb™ds
;i++) {

220 
	`¥ötf
("%3d\t%8d\t%8d",
cuºdisk
->
b™ds
[
i
].
blk•îåack
,

221 
cuºdisk
->
æcyls
[cuºdisk->
b™ds
[
i
].
°¨tcyl
].
fú°lbn
,

222 
cuºdisk
->
æcyls
[cuºdisk->
b™ds
[
i
].
°¨tcyl
].
fú°lbn
 +

223 
cuºdisk
->
b™ds
[
i
].
blksöb™d
 - 1);

224 
	`¥ötf
("\t%6d\t\t%6d\n",

226 
cuºdisk
->
b™ds
[
i
].
°¨tcyl
,

227 
cuºdisk
->
b™ds
[
i
].
ídcyl
);

228 
tŸÆ
 +
cuºdisk
->
b™ds
[
i
].
blksöb™d
;

230 
	`¥ötf
("\nTŸÆ = %d\n",
tŸÆ
);

233 
	}
}

239 
	$ªad_øw_œyout
(
disk
 *
cuºdisk
,*
æfûíame
) {

240 
	#LINELEN
 100

	)

241 
löe
[
LINELEN
];

242 
rŸ
, 
numsurÁ˚s
;

243 
lbn
, 
cyl
, 
hód
, 
£˘
, 
£q˙t
;

244 
löíum
,
ªtvÆ
,
cuºcyl
,
cuºhód
,
vÆid_idx
,
i
,
•t
;

245 
ønge
 = 0;

246 
FILE
 *
Â
;

247 
maxlbn
,
blocksize
,
numcyls
;

249 *
sf_cyls
;

250 
s‰eq_t
 *
£˘‰eq
;

251 #i‚de‡
DISKSIM


252 
˙t
;

255 i‡(!(
Â
 = 
	`f›í
 (
æfûíame
, "r"))) {

256 
	`îr‹_h™dÀr
("Eº‹ o≥nögÑawÜayouàfûê%s!\n",
æfûíame
);

260 i‡(!(
£˘‰eq
 = (
s‰eq_t
 *Ë
	`mÆloc
(
MAXSECTORS
*(sfreq_t))))

261 
	`öã∫Æ_îr‹
("CouldÇotállocate sectfreq structure!\n");

262 
	`mem£t
(
£˘‰eq
,0,(sectfreq));

263 
i
=1;i<
MAXSECTORS
;i++)

264 
£˘‰eq
[
i
].
möcyl
 = 
NOVAL
;

266 i‡(!(
sf_cyls
 = (*Ë
	`mÆloc
(
MAXSECTORS
*())))

267 
	`öã∫Æ_îr‹
("CouldÇotállocate sf_cyls structure!\n");

268 
i
=0;i<
MAXSECTORS
;i++)

269 
sf_cyls
[
i
] = 
NOVAL
;

271 
	`fgës
(
löe
,
LINELEN
,
Â
);

272 
ªtvÆ
 = 
	`fsˇnf
(
Â
,"maxlb¿%d, blocksizê%d\n",&
maxlbn
,&
blocksize
);

273 
ªtvÆ
 = 
	`fsˇnf
 (
Â
, "%d cylödîs, %dÑŸ, %d hóds\n", &
numcyls
,&
rŸ
,

274 &
numsurÁ˚s
);

276 i‡(
ªtvÆ
 != 3) {

277 
	`îr‹_h™dÀr
("CannotÑead .layout.mappings file!\n");

281 
löíum
 = 4;

284 
cuºdisk
->
numsurÁ˚s
 =Çumsurfaces;

285 
cuºdisk
->
numblocks
 = 
maxlbn
+1;

286 
cuºdisk
->
numcyls
 =Çumcyls;

287 
cuºdisk
->
m≠pög
 = 
LAYOUT_RAWFILE
;

288 
cuºdisk
->
•¨escheme
 = 
NO_SPARING
;

290 i‡(!(
cuºdisk
->
lbƒ™ge
 = (
lbn_øwœyout_t
 *Ë
	`mÆloc
(cuºdisk->
numcyls
 *

291 
cuºdisk
->
numsurÁ˚s
 * (
lbn_øwœyout_t
))))

292 
	`öã∫Æ_îr‹
("CouldÇotállocateÜbn_rawlayout_t structure!\n");

294 i‡(!(
cuºdisk
->
æcyls
 = (
cyl_øwœyout_t
 *)

295 
	`mÆloc
(
cuºdisk
->
numcyls
 * (
cyl_øwœyout_t
))))

296 
	`öã∫Æ_îr‹
("CouldÇotállocate cyl_rawlayout_t structure!\n");

298 
	`mem£t
(
cuºdisk
->
æcyls
,0,cuºdisk->
numcyls
 * (
cyl_øwœyout_t
));

299 
i
=0;i<
cuºdisk
->
numcyls
;i++)

300 
cuºdisk
->
æcyls
[
i
].
fú°lbn
 = 
NOVAL
;

302 
cuºcyl
 = 
NOVAL
;

303 
cuºhód
 = 
NOVAL
;

307 
	`fsˇnf
 (
Â
, "lbn %d --> cyl %d, head %d, sect %d, seqcnt %d\n",

308 &
lbn
, &
cyl
, &
hód
, &
£˘
, &
£q˙t
);

312 i‡(
cuºdisk
->
numcyls
 <
cyl
) {

313 
	`îr‹_h™dÀr
("Cyl %d onÜine %d is biggerÅhanÅhe max value of %d!\n",

314 
cyl
,
löíum
,
cuºdisk
->
numcyls
-1);

317 i‡(
cuºdisk
->
numsurÁ˚s
 <
hód
) {

318 
	`îr‹_h™dÀr
("Head %d onÜine %d is biggerÅhanÅhe max value of %d!\n",

319 
hód
,
löíum
,
cuºdisk
->
numsurÁ˚s
-1);

323 i‡((
cuºhód
 !
hód
Ë|| (
cuºcyl
 !
cyl
)){

324 i‡(
cuºhód
 !
NOVAL
) {

326 
cuºdisk
->
æcyls
[
cuºcyl
].
surÁ˚
[
cuºhód
].
œ°lbn
 = 
lbn
 - 1;

329 
•t
 = 
cuºdisk
->
æcyls
[
cuºcyl
].
surÁ˚
[
cuºhód
].
œ°lbn
 -

330 
cuºdisk
->
æcyls
[
cuºcyl
].
surÁ˚
[
cuºhód
].
fú°lbn
 + 1;

332 i‡(
•t
 >
MAXSECTORS
) {

333 
	`öã∫Æ_îr‹
("Se˘‹ cou¡Éx˚ed†%d (MAXSECTORS).\n",
MAXSECTORS
);

336 
£˘‰eq
[
•t
].
cou¡
++;

337 
£˘‰eq
[
•t
].
cyls
 + 
cyl
;

339 i‡(
sf_cyls
[
•t
] !
NOVAL
) {

340 i‡(
	`abs
–
cyl
 - 
sf_cyls
[
•t
]Ë> 
MIN_CYL_DISTANCE
) {

341 
£˘‰eq
[
•t
].
möcyl
 = 
cyl
;

343 
£˘‰eq
[
•t
].
cou¡
 = 1;

344 
£˘‰eq
[
•t
].
cyls
 = 
cyl
;

347 
sf_cyls
[
•t
] = 
cyl
;

350 i‡((
£˘‰eq
[
•t
].
möcyl
> 
cyl
) ||

351 (
£˘‰eq
[
•t
].
möcyl
==
NOVAL
)){

352 
£˘‰eq
[
•t
].
möcyl
 = 
cyl
;

354 i‡(
£˘‰eq
[
•t
].
maxcyl
 < 
cyl
)

355 
£˘‰eq
[
•t
].
maxcyl
 = 
cyl
;

357 
cuºhód
 = 
hód
;

359 i‡(
cuºcyl
 !
cyl
) {

360 i‡(
cuºcyl
 !
NOVAL
) {

361 
cuºdisk
->
æcyls
[
cuºcyl
].
œ°lbn
 = 
lbn
-1;

362 
cuºdisk
->
lbƒ™ge
[
ønge
-1].
œ°lbn
 = 
lbn
-1;

364 
cuºcyl
 = 
cyl
;

365 
cuºdisk
->
æcyls
[
cuºcyl
].
vÆidcyl
 = 1;

367 
cuºdisk
->
lbƒ™ge
[
ønge
].
fú°lbn
 = 
lbn
;

368 
cuºdisk
->
lbƒ™ge
[
ønge
].
cyl
 = cyl;

369 
ønge
++;

371 i‡((
cuºdisk
->
æcyls
[
cuºcyl
].
fú°lbn
 > 
lbn
) ||

372 (
cuºdisk
->
æcyls
[
cuºcyl
].
fú°lbn
 =
NOVAL
)){

373 
cuºdisk
->
æcyls
[
cuºcyl
].
fú°lbn
 = 
lbn
;

377 
vÆid_idx
 = 
cuºdisk
->
æcyls
[
cuºcyl
].
surÁ˚
[
hód
].
vÆid
++;

379 i‡(!
vÆid_idx
) {

380 
cuºdisk
->
æcyls
[
cuºcyl
].
surÁ˚
[
hód
].
fú°lbn
 = 
lbn
;

382 #ifde‡
DETAILED_RAW_LAYOUT


384 
cuºdisk
->
æcyls
[
cuºcyl
].
surÁ˚
[
hód
].
£˘
[
vÆid_idx
] = sect;

385 
cuºdisk
->
æcyls
[
cuºcyl
].
surÁ˚
[
hód
].
£q˙t
[
vÆid_idx
] = seqcnt;

387 
löíum
++;

388 } 5 =
	`fsˇnf
 (
Â
, "lbn %d --> cyl %d, head %d, sect %d, seqcnt %d\n",

389 &
lbn
, &
cyl
, &
hód
, &
£˘
, &
£q˙t
));

391 
cuºdisk
->
æcyls
[
cuºcyl
].
œ°lbn
 = 
lbn
+
£q˙t
;;

392 
cuºdisk
->
æcyls
[
cuºcyl
].
surÁ˚
[
hód
].
œ°lbn
 = 
lbn
+
£q˙t
;

395 
cuºdisk
->
lbƒ™ge
[
ønge
-1].
œ°lbn
 = 
lbn
+
£q˙t
;

396 
cuºdisk
->
numlbƒ™ges
=
ønge
;

397 #i‚de‡
DISKSIM


398 
cuºdisk
->
de„˘_li°s
 = (
de„˘_t
 *Ë
	`mÆloc
 (0x80000);

399 
	`mem£t
((*)
cuºdisk
->
de„˘_li°s
,0,0x80000);

400 
˙t
 = 1;

402 
ªtvÆ
 = 
	`fsˇnf
 (
Â
, "Defectát cyl %d, head %d, sect %d\n",

403 &
cuºdisk
->
de„˘_li°s
[
˙t
].
cyl
,

404 &
cuºdisk
->
de„˘_li°s
[
˙t
].
hód
,

405 &
cuºdisk
->
de„˘_li°s
[
˙t
].
£˘
);

406 i‡(
ªtvÆ
 == 3) {

408 
˙t
++;

411 i‡((
˙t
 > 2Ë&& (
cuºdisk
->
de„˘_li°s
[˙t-1].
cyl
 == currdisk->defect_lists[cnt-2].cyl) &&

412 (
cuºdisk
->
de„˘_li°s
[
˙t
-1].
hód
 == currdisk->defect_lists[cnt-2].head) &&

413 (
cuºdisk
->
de„˘_li°s
[
˙t
-1].
£˘
 == currdisk->defect_lists[cnt-2].sect)) {

414 
˙t
--;

416 } 
ªtvÆ
 == 3);

417 
cuºdisk
->
de„˘_li°s
[0].
cyl
 = 
˙t
-1;

420 
	`dëîmöe_z⁄es
(
cuºdisk
,
£˘‰eq
,(Ë(((Ëcuºdisk->
numblocks
) *

421 ((Ë
blocksize
) /1024 /1024 /1024));

422 
	`‰ì
(
£˘‰eq
);

423 
	`‰ì
(
sf_cyls
);

424 
	`f˛o£
(
Â
);

428 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/rms.c

101 
	~<°dio.h
>

102 
	~<°rög.h
>

103 
	~<m©h.h
>

104 
	~<°dlib.h
>

106 
	#RMS_INCR
 0.0001

	)

108 
	#MAX_POINTS
 10000

	)

110 
	glöe1_x
[
MAX_POINTS
];

111 
	glöe1_y
[
MAX_POINTS
];

112 
	glöe2_x
[
MAX_POINTS
];

113 
	glöe2_y
[
MAX_POINTS
];

115 
	$gë_löe
(
fûíame
, 
x
, 
y
, 
di°«me
)

116 *
fûíame
;

117 *
x
;

118 *
y
;

119 *
di°«me
;

121 
FILE
 *
öfûe
;

122 
löe
[201];

123 
junk
;

124 
i
 = 0;

126 i‡(
	`°rcmp
(
fûíame
, "stdin") == 0) {

127 
öfûe
 = 
°dö
;

128 } i‡((
öfûe
 = 
	`f›í
(
fûíame
, "r")Ë=
NULL
) {

129 
	`Ârötf
(
°dîr
, "C™'à›í infûê%s\n", 
fûíame
);

130 
	`exô
(1);

132 (
	`fgës
(
löe
, 200, 
öfûe
)Ë&& (
	`°rcmp
÷öe, 
di°«me
))) {

134 
	`fgës
(
löe
, 200, 
öfûe
)) {

135 i‡(
	`ssˇnf
(
löe
, "%l‡%l‡%l‡%lf", &
x
[
i
], &
junk
, &junk, &
y
[i]) != 4) {

136 
	`Ârötf
(
°dîr
, "InvÆidÜöêö di°ributi⁄: %s\n", 
löe
);

137 
	`exô
(1);

139 i‡(
y
[
i
] >= 1.0) {

142 i‡(
i
 >
MAX_POINTS
) {

143 
	`Ârötf
 (
°dîr
, "Toÿm™yÜöe†ö di°ributi⁄: %d\n", 
i
);

144 
	`exô
(1);

146 
i
++;

148 
	}
}

151 
	$compuã_rms
(
x1
, 
y1
, 
x2
, 
y2
)

152 *
x1
;

153 *
y1
;

154 *
x2
;

155 *
y2
;

157 
cou¡
 = 0;

158 
runvÆ
 = 0.0;

159 
runsqu¨es
 = 0.0;

160 
i1
 = 0;

161 
i2
 = 0;

162 
≤t
 = 
RMS_INCR
;

163 
y‰ac
;

164 
x1≤t
, 
x2≤t
;

166 ; 
≤t
 <1.0;Ö¡ +
RMS_INCR
) {

167 
y1
[
i1
] < 
≤t
) {

168 
i1
++;

170 
y2
[
i2
] < 
≤t
) {

171 
i2
++;

173 
y‰ac
 = (
≤t
 - 
y1
[(
i1
-1)]) / (y1[i1] - y1[(i1-1)]);

174 
x1≤t
 = 
x1
[(
i1
-1)] + (
y‰ac
 * (x1[i1] - x1[(i1-1)]));

175 
y‰ac
 = (
≤t
 - 
y2
[(
i2
-1)]) / (y2[i2] - y2[(i2-1)]);

176 
x2≤t
 = 
x2
[(
i2
-1)] + (
y‰ac
 * (x2[i2] - x2[(i2-1)]));

177 
runvÆ
 +
	`Ábs
(
x1≤t
 - 
x2≤t
);

178 
runsqu¨es
 +(
x1≤t
 - 
x2≤t
) * (x1pnt - x2pnt);

179 
cou¡
++;

181 (
	`sqπ
(
runsqu¨es
 / (Ë
cou¡
));

182 
	}
}

185 
	$maö
(
¨gc
, 
¨gv
)

186 
¨gc
;

187 **
¨gv
;

189 
diskno
;

190 
di°«me
[201];

191 
rms
;

192 
roŸ«mes
;

193 
dof‹£rvs
;

195 i‡(
¨gc
 != 6) {

196 
	`Ârötf
(
°dîr
, "Ußge: %†fûíame1 fûîoŸ2 disknÿroŸ«me†dof‹£rvs\n", 
¨gv
[0]);

197 
	`exô
(1);

199 i‡(
	`ssˇnf
(
¨gv
[3], "%d", &
diskno
) != 1) {

200 
	`Ârötf
(
°dîr
, "InvÆid diskÇumbî: %s\n", 
¨gv
[3]);

201 
	`exô
(1);

203 i‡(
	`ssˇnf
(
¨gv
[5], "%d", &
dof‹£rvs
) != 1) {

204 
	`Ârötf
(
°dîr
, "InvÆid vÆuêf‹ dof‹£rvs: %s\n", 
¨gv
[3]);

205 
	`exô
(1);

207 i‡(
dof‹£rvs
) {

208 i‡(
diskno
 == -1) {

209 
	`•rötf
(
di°«me
, "IOdriver PhysicaláccessÅime distribution\n");

211 
	`•rötf
(
di°«me
, "IOdrivî #0 devi˚ #%d Physiˇ»ac˚s†timêdi°ributi⁄\n", 
diskno
);

214 i‡(
diskno
 == -1) {

215 
	`•rötf
(
di°«me
, "IOdriver ResponseÅime distribution\n");

217 
	`•rötf
(
di°«me
, "IOdrivî #0 devi˚ #%d Re•⁄£Åimêdi°ributi⁄\n", 
diskno
);

220 
	`gë_löe
(
¨gv
[1], 
löe1_x
, 
löe1_y
, 
di°«me
);

221 i‡(
	`ssˇnf
(
¨gv
[4], "%d", &
roŸ«mes
) != 1) {

222 
	`Ârötf
(
°dîr
, "InvÆidÇumbî o‡roŸ«mes: %s\n", 
¨gv
[4]);

223 
	`exô
(1);

225 i‡(
roŸ«mes
 == -1) {

226 
	`•rötf
(
di°«me
, "VALIDATE TraceáccessÅime distribution\n");

227 
roŸ«mes
 = 0;

229 i‡(
roŸ«mes
 == 0) {

230 
	`gë_löe
(
¨gv
[2], 
löe2_x
, 
löe2_y
, 
di°«me
);

231 
rms
 = 
	`compuã_rms
(
löe1_x
, 
löe1_y
, 
löe2_x
, 
löe2_y
);

232 
	`¥ötf
("rm†%f\n", 
rms
);

234 
ruƒms
 = 0.0;

235 
runsqu¨es
 = 0.0;

236 
fûíame
[51];

237 
i
;

239 
i
=1; i<=
roŸ«mes
; i++) {

240 
	`•rötf
(
fûíame
, "%s.%d", 
¨gv
[2], 
i
);

241 
	`gë_löe
(
fûíame
, 
löe2_x
, 
löe2_y
, 
di°«me
);

242 
rms
 = 
	`compuã_rms
(
löe1_x
, 
löe1_y
, 
löe2_x
, 
löe2_y
);

243 
ruƒms
 +
rms
;

244 
runsqu¨es
 +
rms
 *Ñms;

246 
ruƒms
 /(Ë
roŸ«mes
;

247 
runsqu¨es
 = (runsqu¨e†/ (Ë
roŸ«mes
Ë- (
ruƒms
 *Ñunrms);

248 
runsqu¨es
 = (runsqu¨e†> 0.0Ë? 
	`sqπ
(runsquares) : 0.0;

249 
	`¥ötf
("rm†%‡(%f)\n", 
ruƒms
, 
runsqu¨es
);

251 
	`exô
(0);

252 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/syssim_driver.c

44 
	~<°dio.h
>

45 
	~<°dlib.h
>

46 
	~<sys/ty≥s.h
>

47 
	~<sys/°©.h
>

48 
	~<m©h.h
>

50 
	~"syssim_drivî.h
"

51 
	~"disksim_öãrÁ˚.h
"

52 
	~"disksim_ønd48.h
"

55 
	#BLOCK
 4096

	)

56 
	#SECTOR
 512

	)

57 
	#BLOCK2SECTOR
 (
BLOCK
/
SECTOR
)

	)

60 
	mn
;

61 
	msum
;

62 
	msqr
;

63 } 
	tSèt
;

66 
SysTime
 
	gnow
 = 0;

67 
SysTime
 
	g√xt_evít
 = -1;

68 
	gcom∂ëed
 = 0;

69 
Sèt
 
	g°
;

73 
	$∑nic
(c⁄° *
s
)

75 
	`≥º‹
(
s
);

76 
	`exô
(1);

77 
	}
}

81 
	$add_°©i°ics
(
Sèt
 *
s
, 
x
)

83 
s
->
n
++;

84 
s
->
sum
 +
x
;

85 
s
->
sqr
 +
x
*x;

86 
	}
}

90 
	$¥öt_°©i°ics
(
Sèt
 *
s
, c⁄° *
tôÀ
)

92 
avg
, 
°d
;

94 
avg
 = 
s
->
sum
/s->
n
;

95 
°d
 = 
	`sqπ
((
s
->
sqr
 - 2*
avg
*s->
sum
 + s->
n
*avg*avg) / s->n);

96 
	`¥ötf
("%s:Ç=%dávîage=%‡°d. devüti⁄=%f\n", 
tôÀ
, 
s
->
n
, 
avg
, 
°d
);

97 
	}
}

106 
	$syssim_scheduÀ_ˇŒback
(
disksim_öãrÁ˚_ˇŒback_t
 
‚
,

107 
SysTime
 
t
,

108 *
˘x
)

110 
√xt_evít
 = 
t
;

111 
	}
}

118 
	$syssim_descheduÀ_ˇŒback
(
t
, *
˘x
)

120 
√xt_evít
 = -1;

121 
	}
}

125 
	$syssim_ªp‹t_com∂ëi⁄
(
SysTime
 
t
, 
disksim_ªque°
 *
r
, *
˘x
)

127 
com∂ëed
 = 1;

128 
now
 = 
t
;

129 
	`add_°©i°ics
(&
°
, 
t
 - 
r
->
°¨t
);

130 
	}
}

134 
	$maö
(
¨gc
, *
¨gv
[])

136 
i
;

137 
n£˘‹s
;

138 
°©
 
buf
;

139 
disksim_ªque°
 
r
;

140 
disksim_öãrÁ˚
 *
disksim
;

142 i‡(
¨gc
 !4 || (
n£˘‹s
 = 
	`©oi
(
¨gv
[3])) <= 0) {

143 
	`Ârötf
(
°dîr
, "usage: %s <param file> <output file> <#sectors>\n",

144 
¨gv
[0]);

145 
	`exô
(1);

148 i‡(
	`°©
(
¨gv
[1], &
buf
) < 0)

149 
	`∑nic
(
¨gv
[1]);

151 
disksim
 = 
	`disksim_öãrÁ˚_öôülize
(
¨gv
[1],

152 
¨gv
[2],

153 
syssim_ªp‹t_com∂ëi⁄
,

154 
syssim_scheduÀ_ˇŒback
,

155 
syssim_descheduÀ_ˇŒback
,

161 
	`DISKSIM_§™d48
(1);

163 
i
=0; i < 1000; i++) {

164 
r
.
°¨t
 = 
now
;

165 
r
.
Êags
 = 
DISKSIM_WRITE
;

166 
r
.
devno
 = 0;

169 
r
.
blkno
 = 
BLOCK2SECTOR
*(
	`DISKSIM_Ã™d48
()%(
n£˘‹s
/BLOCK2SECTOR));

170 
r
.
byãcou¡
 = 
BLOCK
;

171 
com∂ëed
 = 0;

172 
	`disksim_öãrÁ˚_ªque°_¨rive
(
disksim
, 
now
, &
r
);

175 
√xt_evít
 >= 0) {

176 
now
 = 
√xt_evít
;

177 
√xt_evít
 = -1;

178 
	`disksim_öãrÁ˚_öã∫Æ_evít
(
disksim
, 
now
, 0);

181 i‡(!
com∂ëed
) {

182 
	`Ârötf
(
°dîr
,

184 
¨gv
[0], 
i
);

185 
	`exô
(1);

189 
	`disksim_öãrÁ˚_shutdown
(
disksim
, 
now
);

191 
	`¥öt_°©i°ics
(&
°
, "responseÅime");

193 
	`exô
(0);

194 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/src/syssim_driver.h

33 
	~"disksim_öãrÁ˚.h
"

42 
	tSysTime
;

58 
syssim_scheduÀ_ˇŒback
(
disksim_öãrÁ˚_ˇŒback_t
, 
SysTime
 
t
, *);

59 
syssim_ªp‹t_com∂ëi⁄
(
SysTime
 
t
, 
disksim_ªque°
 *
r
, *);

60 
syssim_descheduÀ_ˇŒback
(, *);

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/include/ssdmodel/modules/modules.h

2 #i‚de‡
_SSDMODEL_MODULES_H


3 
	#_SSDMODEL_MODULES_H


	)

6 
	~"ssdmodñ_ssd_∑øm.h
"

9 
Õ_mod
 *
	gssdmodñ_mods
[] = {

10 &
ssdmodñ_ssd_mod


14 
	mSSDMODEL_MOD_SSD


15 } 
	tssdmodñ_mod_t
;

17 
	#SSDMODEL_MAX_MODULE
 0

	)

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/include/ssdmodel/modules/ssdmodel_ssd_param.h

2 #i‚de‡
_SSDMODEL_SSD_PARAM_H


3 
	#_SSDMODEL_SSD_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
ssd
 *
ssdmodñ_ssd_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
SSDMODEL_SSD_SCHEDULER
,

16 
SSDMODEL_SSD_MAX_QUEUE_LENGTH
,

17 
SSDMODEL_SSD_BLOCK_COUNT
,

18 
SSDMODEL_SSD_BUS_TRANSACTION_LATENCY
,

19 
SSDMODEL_SSD_BULK_SECTOR_TRANSFER_TIME
,

20 
SSDMODEL_SSD_NEVER_DISCONNECT
,

21 
SSDMODEL_SSD_PRINT_STATS
,

22 
SSDMODEL_SSD_COMMAND_OVERHEAD
,

23 
SSDMODEL_SSD_TIMING_MODEL
,

24 
SSDMODEL_SSD_FLASH_CHIP_ELEMENTS
,

25 
SSDMODEL_SSD_PAGE_SIZE
,

26 
SSDMODEL_SSD_PAGES_PER_BLOCK
,

27 
SSDMODEL_SSD_BLOCKS_PER_ELEMENT
,

28 
SSDMODEL_SSD_ELEMENT_STRIDE_PAGES
,

29 
SSDMODEL_SSD_CHIP_XFER_LATENCY
,

30 
SSDMODEL_SSD_PAGE_READ_LATENCY
,

31 
SSDMODEL_SSD_PAGE_WRITE_LATENCY
,

32 
SSDMODEL_SSD_BLOCK_ERASE_LATENCY
,

33 
SSDMODEL_SSD_WRITE_POLICY
,

34 
SSDMODEL_SSD_RESERVE_PAGES_PERCENTAGE
,

35 
SSDMODEL_SSD_MINIMUM_FREE_BLOCKS_PERCENTAGE
,

36 
SSDMODEL_SSD_CLEANING_POLICY
,

37 
SSDMODEL_SSD_PLANES_PER_PACKAGE
,

38 
SSDMODEL_SSD_BLOCKS_PER_PLANE
,

39 
SSDMODEL_SSD_PLANE_BLOCK_MAPPING
,

40 
SSDMODEL_SSD_COPY_BACK
,

41 
SSDMODEL_SSD_NUMBER_OF_PARALLEL_UNITS
,

42 
SSDMODEL_SSD_ELEMENTS_PER_GANG
,

43 
SSDMODEL_SSD_CLEANING_IN_BACKGROUND
,

44 
SSDMODEL_SSD_GANG_SHARE
,

45 
SSDMODEL_SSD_ALLOCATION_POOL_LOGIC


46 } 
	tssdmodñ_ssd_∑øm_t
;

48 
	#SSDMODEL_SSD_MAX_PARAM
 
SSDMODEL_SSD_ALLOCATION_POOL_LOGIC


	)

49 * 
SSDMODEL_SSD_lﬂdîs
[];

50 
Õ_∑ømdï_t
 
SSDMODEL_SSD_dïs
[];

53 
Õ_v¨•ec
 
	gssdmodñ_ssd_∑øms
 [] = {

54 {"ScheduÀr", 
BLOCK
, 1 },

55 {"Max queuêÀngth", 
I
, 1 },

56 {"Block cou¡", 
I
, 0 },

57 {"Bu†å™ß˘i⁄Ü©ícy", 
D
, 0 },

58 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

59 {"Nevî disc⁄√˘", 
I
, 1 },

60 {"Pröà°©s", 
I
, 1 },

61 {"Comm™d ovîhód", 
D
, 1 },

62 {"Timög modñ", 
I
, 1 },

63 {"Fœsh chùÉÀmíts", 
I
, 1 },

64 {"Pagêsize", 
I
, 1 },

65 {"Page†≥∏block", 
I
, 1 },

66 {"Block†≥∏ñemít", 
I
, 1 },

67 {"EÀmíà°ridê∑ges", 
I
, 1 },

68 {"Chù x„∏œãncy", 
D
, 1 },

69 {"PagêªadÜ©ícy", 
D
, 1 },

70 {"Pagêwrôêœãncy", 
D
, 1 },

71 {"BlockÉø£Ü©ícy", 
D
, 1 },

72 {"Wrôêpﬁicy", 
I
, 1 },

73 {"Re£rvê∑ge†≥r˚¡age", 
I
, 1 },

74 {"Möimum fªêblock†≥r˚¡age", 
I
, 1 },

75 {"CÀ™ögÖﬁicy", 
I
, 1 },

76 {"Pœ√†≥∏∑ckage", 
I
, 1 },

77 {"Block†≥∏∂™e", 
I
, 1 },

78 {"Pœ√ block m≠pög", 
I
, 1 },

79 {"C›y back", 
I
, 1 },

80 {"Numbî o‡∑øŒñ unôs", 
I
, 1 },

81 {"EÀmít†≥∏g™g", 
I
, 1 },

82 {"CÀ™ög i¿background", 
I
, 1 },

83 {"G™g sh¨e", 
I
, 1 },

84 {"AŒoˇti⁄ÖoﬁÜogic", 
I
, 1 },

87 
	#SSDMODEL_SSD_MAX
 31

	)

88 
Õ_mod
 
	gssdmodñ_ssd_mod
 = { "ssdmodñ_ssd", 
ssdmodñ_ssd_∑øms
, 
SSDMODEL_SSD_MAX
, (
Õ_modlﬂdî_t
)
ssdmodñ_ssd_lﬂd∑øms
, 0, 0, 
SSDMODEL_SSD_lﬂdîs
, 
SSDMODEL_SSD_dïs
 };

91 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/include/ssdmodel/ssd.h

4 
	~"disksim_globÆ.h
"

5 
	~"disksim_iosim.h
"

6 
	~"disksim_°©.h
"

7 
	~"disksim_ioqueue.h
"

8 
	~"disksim_bus.h
"

9 
	~"c⁄fig.h
"

11 #i‚de‡
DISKSIM_SSD_H


12 
	#DISKSIM_SSD_H


	)

14 
ssd
 *
gëssd
 (
devno
);

17 
devi˚_hódî
 
ssd_hdr_öôülizî
;

21 
	#SSD_MAX_ELEMENTS
 64

	)

22 
	#SSD_MAX_PLANES_PER_ELEM
 16

	)

23 
	#SSD_MAX_PARUNITS_PER_ELEM
 
SSD_MAX_PLANES_PER_ELEM


	)

24 
	#SSD_MAX_ELEMS_PER_GANG
 
SSD_MAX_ELEMENTS


25 
	#SSD_BITS_ELEMS_PER_GANG
 8

	)

29 
°©gí
 
	mac˘ime°©s
;

30 
	mªque°edbus
;

31 
	mwaôögf‹bus
;

32 
	mnumbuswaôs
;

33 } 
	tssd_°©_t
;

38 
	s_ssd_ñemít_°©
 {

39 
	mnum_˛ón
;

40 
	m∑ges_moved
;

41 
	mtŸ_x„r_co°
;

42 
	mavg_li„time
;

43 
	mtŸ_ªqs_issued
;

44 
	mtŸ_time_èkí
;

45 
	mtŸ_˛ón_time
;

46 } 
	tssd_ñemít_°©
;

52 
	mSSD_BLOCK_CLEAN
,

53 
	mSSD_BLOCK_INUSE
,

54 
	mSSD_BLOCK_SEALED


55 } 
	tSSD_BLOCK_STATES
;

66 
	s_block_mëad©a
 {

67 
	mblock_num
;

68 
	m∂™e_num
;

70 *
	m∑ge
;

74 
	mnum_vÆid
;

78 
	mªm_li„time
;

84 
	mtime_of_œ°_îasuª
;

86 
	m°©e
;

93 
	mb¢
;

94 } 
	tblock_mëad©a
;

100 
	s_∂™e_mëad©a
 {

102 
	m‰ì_blocks
;

104 
	mvÆid_∑ges
;

107 
	ma˘ive_∑ge
;

110 
	m˛ón_ö_¥ogªss
;

112 
	m˛ón_ö_block
;

113 
	mblock_Æloc_pos
;

114 
	m∑runô_num
;

115 
	mnum_˛óns
;

116 } 
	t∂™e_mëad©a
;

118 
	s_∑runô
 {

119 
	m∂™e_to_˛ón
;

120 } 
	t∑runô
;

126 
	s_ssd_ñemít_mëad©a
 {

127 *
	mlba_èbÀ
;

130 *
	m‰ì_blocks
;

135 
	mtŸ_‰ì_blocks
;

139 
	ma˘ive_∑ge
;

142 
∂™e_mëad©a
 
	m∂™e_mëa
[
SSD_MAX_PLANES_PER_ELEM
];

144 
block_mëad©a
 *
	mblock_ußge
;

148 
	mb¢
;

150 
	m∂™e_to_˛ón
;

151 
	m∂™e_to_wrôe
;

152 
	mblock_Æloc_pos
;

154 
∑runô
 
	m∑runôs
[
SSD_MAX_PARUNITS_PER_ELEM
];

156 
	mg™g_num
;

157 
	mªqs_waôög
;

158 
	mtŸ_migøti⁄s
;

159 
	mtŸ_pgs_migøãd
;

160 
	mmig_co°
;

161 } 
	tssd_ñemít_mëad©a
;

167 
	s_ssd_∂™e
 {

171 
	mmedü_busy
;

172 
	m∑ú_∂™e
;

174 
	mnum_blocks
;

175 } 
	tssd_∂™e
;

185 
	s_ssd_ñemít
 {

186 
ioq
 *
	mqueue
;

187 
	mmedü_busy
;

188 
ssd_ñemít_mëad©a
 
	mmëad©a
;

189 
ssd_ñemít_°©
 
	m°©
;

191 
	mpö_busy
;

192 
	mnum_∂™es
;

193 
ssd_∂™e
 
	m∂™e
[
SSD_MAX_PLANES_PER_ELEM
];

194 } 
	tssd_ñemít
;

196 
	s_ssd_ñem_numbî
 {

197 
	me
:
SSD_BITS_ELEMS_PER_GANG
;

198 } 
	tssd_ñem_numbî
;

200 
	s_g™g_mëad©a
 {

201 
ioq
 *
	mqueue
;

202 
	m˛ónög
;

203 
	mbusy
;

204 
	mªqs_waôög
;

205 
	mﬁde°
;

206 
	mñem_‰ì_∑ges
[
SSD_MAX_ELEMENTS
];

207 
ssd_ñem_numbî
 *
	mpg2ñem
;

208 } 
	tg™g_mëad©a
;

211 
	#SSD_SIMPLE_MODEL
 1

	)

212 
	#SSD_SIMPLE_DW_MODEL
 2

	)

213 
	#SSD_LOGDISK_MODEL
 3

	)

216 
	#DISKSIM_SSD_MAX_WRITE_POLICIES
 2

	)

217 
	#DISKSIM_SSD_WRITE_POLICY_SIMPLE
 1

	)

218 
	#DISKSIM_SSD_WRITE_POLICY_OSR
 2

	)

222 
	#DISKSIM_SSD_MAX_RESERVE
 50

	)

225 
	#SSD_DATA_BYTES_PER_SECTOR
 512

	)

226 
	#SSD_MDATA_BYTES_PER_SECTOR
 16

	)

227 
	#SSD_BYTES_PER_SECTOR
 (
SSD_DATA_BYTES_PER_SECTOR
 + 
SSD_MDATA_BYTES_PER_SECTOR
)

	)

230 
	#SSD_SECTORS_PER_SUMMARY_PAGE
 1

	)

243 
	#PLANE_BLOCKS_CONCAT
 1

	)

258 
	#PLANE_BLOCKS_PAIRWISE_STRIPE
 2

	)

270 
	#PLANE_BLOCKS_FULL_STRIPE
 3

	)

274 
	#SSD_COPY_BACK_DISABLE
 0

	)

275 
	#SSD_COPY_BACK_ENABLE
 1

	)

278 
	#SSD_ALLOC_POOL_GANG
 0

	)

279 
	#SSD_ALLOC_POOL_CHIP
 1

280 
	#SSD_ALLOC_POOL_PLANE
 2

	)

283 
	#SSD_SHARED_BUS_GANG
 1

284 
	#SSD_SHARED_CONTROL_GANG
 2

285 

	)

286 
	s_ssd_timög_∑øms
 {

287 
	mssd_modñ
;

288 
	m√Àmíts
;

289 
	m∑ge_size
;

290 
	m∑ges_≥r_block
;

291 
	mblocks_≥r_ñemít
;

292 
	mñemít_°ride_∑ges
;

296 
	mchù_x„r_œãncy
;

297 
	m∑ge_ªad_œãncy
;

298 
	m∑ge_wrôe_œãncy
;

299 
	mblock_îa£_œãncy
;

301 
	mwrôe_pﬁicy
;

305 
	mª£rve_blocks
;

307 
	mmö_‰ìblks_≥r˚¡
;

309 
	m˛ónög_pﬁicy
;

312 
	m∂™es_≥r_pkg
;

314 
	mblocks_≥r_∂™e
;

316 
	m∂™e_block_m≠pög
;

318 
	mc›y_back
;

320 
	mnum_∑runôs
;

322 
	mñemíts_≥r_g™g
;

324 
	mg™g_sh¨e
;

326 
	m˛ónög_ö_background
;

328 
	mÆloc_poﬁ_logic
;

329 } 
	tssd_timög_∑øms
;

331 
	g_ssd_timög_t
;

334 
	sssd
 {

335 
devi˚_hódî
 
	mhdr
;

336 
ssd_timög_∑øms
 
	m∑øms
;

337 
_ssd_timög_t
 *
	mtimög_t
;

339 
	movîhód
;

340 
	mbus_å™ß˘i⁄_œãncy
;

341 
	mnumblocks
;

342 
	mdevno
;

343 
	möôed
;

344 
	mªc⁄√˘_ªas⁄
;

346 
i‹eq_evít
 *
	mch™√l_a˘ivôy
;

347 
i‹eq_evít
 *
	mcom∂ëi⁄_queue
;

348 
ioq
 *
	mqueue
;

350 
ssd_ñemít
 
	mñemíts
[
SSD_MAX_ELEMENTS
];

353 
	md©a_∑ges_≥r_ñem
;

354 
g™g_mëad©a
 
	mg™g_mëa
[
SSD_MAX_ELEMENTS
];

356 
	mblkå™°ime
;

357 
	mmaxqÀn
;

358 
	mbusow√d
;

359 
i‹eq_evít
 *
	mbuswaô
;

360 
	m√vîdisc⁄√˘
;

361 
	mnumöbu£s
;

362 
	möbu£s
[
MAXINBUSES
];

363 
	mdïth
[
MAXINBUSES
];

364 
	m¶Ÿno
[
MAXINBUSES
];

366 
	m¥öt°©s
;

367 
ssd_°©_t
 
	m°©
;

368 } 
	tssd_t
;

370 
	sssd_öfo
 {

371 
ssd
 **
	mssds
;

372 
	mnumssds
;

373 
	mssds_Àn
;

374 } 
	tssdöfo_t
;

377 
	s_ssd_ªq
 {

378 
	mblk
;

379 
	mcou¡
;

380 
	mis_ªad
;

381 
	m∂™e_num
;

382 
i‹eq_evít
 *
	m‹g_ªq
;

383 
	mac˘ime
;

384 
	mschtime
;

385 
	mö˛ude
;

387 } 
	tssd_ªq
;

390 
	#SSD_PAGE_TO_BLOCK
(
≤um
, 
s
Ë(’num)/(s->
∑øms
.
∑ges_≥r_block
))

	)

391 
	#SSD_PAGES_PER_ELEM
(
s
Ë((s)->
∑øms
.
blocks_≥r_ñemít
 * (s)->∑øms.
∑ges_≥r_block
)

	)

392 
	#ADDRESSABLE_PAGES_PER_ELEM
(
s
Ë((s)->
d©a_∑ges_≥r_ñem
)

	)

393 
	#SSD_PLANES_PER_ELEM
(
s
Ë((s)->
∑øms
.
∂™es_≥r_pkg
)

	)

394 
	#SSD_PARUNITS_PER_ELEM
(
s
Ë((s)->
∑øms
.
num_∑runôs
)

	)

395 
	#SSD_PLANES_PER_PARUNIT
(
s
Ë(
	`SSD_PLANES_PER_ELEM
(s)/
	`SSD_PARUNITS_PER_ELEM
(s))

	)

396 
	#SSD_DATA_PAGES_PER_BLOCK
(
s
Ë((s)->
∑øms
.
∑ges_≥r_block
 - 1)

	)

397 
	#SSD_GANG_PAGE_SIZE
(
s
Ë((s)->
∑øms
.
ñemíts_≥r_g™g
 * (s)->∑øms.
∑ge_size
)

	)

398 
	#numssds
 (
disksim
->
ssdöfo
->
numssds
)

	)

400 
	#ALLOC_UNIT_GANG
 1

	)

401 
	#ALLOC_UNIT_ELEM
 2

	)

402 
	#SSD_NUM_GANG
(
s
Ë((s)->
∑øms
.
√Àmíts
 / (s)->∑øms.
ñemíts_≥r_g™g
)

	)

403 
	#SSD_GANG_SIZE
(
s
Ë(
	`ADDRESSABLE_PAGES_PER_ELEM
(sË* (s)->
∑øms
.
ñemíts_≥r_g™g
)

	)

404 
	#MIN_REQS
 99999999

	)

405 
	#MAX_REQS
 100

	)

406 
	#MAX_REQS_ELEM_QUEUE
 100

	)

407 
	#SYNC_GANG
 1

	)

408 
	#MIGRATE
 1

	)

411 
ssd_ªad_t›röts
 (
FILE
 *
∑rfûe
);

412 
ssd_ªad_•ecs
 (
FILE
 *
∑rfûe
, 
devno
, 
c›õs
);

413 
ssd_£t_sync£t
 (
£t°¨t
, 
£ãnd
);

414 
ssd_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

415 
ssd_£tˇŒbacks
 ();

416 
ssd_öôülize
 ();

417 
ssd_ª£t°©s
 ();

418 
ssd_¥öt°©s
 ();

419 
ssd_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
);

420 
ssd_˛ón°©s
 ();

421 
ssd_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
);

422 
ssd_gë_dïth
 (
devno
);

423 
ssd_gë_öbus
 (
devno
);

424 
ssd_gë_bu¢o
 (
i‹eq_evít
 *
cuº
);

425 
ssd_gë_¶Ÿno
 (
devno
);

426 
ssd_gë_numbî_of_blocks
 (
devno
);

427 
ssd_gë_maxout°™dög
 (
devno
);

428 
ssd_gë_numdisks
 ();

429 
ssd_gë_numcyls
 (
devno
);

430 
ssd_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
);

431 
ssd_gë_avg_£˘≥rcyl
 (
devno
);

432 
ssd_gë_m≠pög
 (
m≠ty≥
, 
devno
, 
blkno
, *
cyÕå
, *
surÁ˚±r
, *
blk±r
);

433 
ssd_evít_¨rive
 (
i‹eq_evít
 *
cuº
);

434 
ssd_gë_di°™˚
 (
devno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
);

435 
ssd_gë_£rvtime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
);

436 
ssd_gë_ac˘ime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
maxtime
);

437 
ssd_bus_dñay_com∂ëe
 (
devno
, 
i‹eq_evít
 *
cuº
, 
£¡bu¢o
);

438 
ssd_bus_ow√rshù_gø¡
 (
devno
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
);

440 
ssd_as£π_‰ì_blocks
(
ssd_t
 *
s
, 
ssd_ñemít_mëad©a
 *
mëad©a
);

441 
ssd_as£π_vÆid_∑ges
(
∂™e_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

442 
ssd_d©a_å™s„r_co°
(
ssd_t
 *
s
, 
£˘‹s_cou¡
);

443 
ssd_œ°_∑ge_ö_block
(
∑ge_num
, 
ssd_t
 *
s
);

444 
_ssd_wrôe_∑ge_o§
(
ssd_t
 *
s
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
Õn
);

445 
ssd_logiˇl_∑gío
(
blkno
, 
ssd_t
 *
s
);

446 
ssd_block_to_bôpos
(
ssd_t
 *
cuºdisk
, 
block
);

447 
ssd_bôpos_to_block
(
bôpos
, 
ssd_t
 *
s
);

448 
_ssd_Æloc_a˘ive_block
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
);

449 
ssd_‰ì_bôs
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

450 
ssd_as£π_∂™e_‰ìbôs
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

451 
ssd_ªad_pﬁicy_sim∂e
(
cou¡
, 
ssd_t
 *
s
);

452 
ssd_com∂ëe_∑ª¡
(
i‹eq_evít
 *
cuº
, 
ssd_t
 *
cuºdisk
);

453 
_ssd_övoke_ñemít_˛ónög
(
ñem_num
, 
ssd_t
 *
s
);

454 
ssd_Æªady_¥e£¡
(
ssd_ªq
 **
ªqs
, 
tŸÆ
, 
i‹eq_evít
 *
ªq
);

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/modules/modules.h

2 #i‚de‡
_SSDMODEL_MODULES_H


3 
	#_SSDMODEL_MODULES_H


	)

6 
	~"ssdmodñ_ssd_∑øm.h
"

9 
Õ_mod
 *
	gssdmodñ_mods
[] = {

10 &
ssdmodñ_ssd_mod


14 
	mSSDMODEL_MOD_SSD


15 } 
	tssdmodñ_mod_t
;

17 
	#SSDMODEL_MAX_MODULE
 0

	)

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/modules/ssdmodel_ssd_param.c

1 
	~"ssdmodñ_ssd_∑øm.h
"

2 
	~<lib∑øm/bôve˘‹.h
>

3 
	~"../ssd.h
"

5 
	$SSDMODEL_SSD_SCHEDULER_dïíd
(*
bv
)

8 
	}
}

11 
	$SSDMODEL_SSD_SCHEDULER_lﬂdî
(
ssd
 * 
ªsu…
, 
Õ_block
 * 
blk
)

13 i‡(!(
ªsu…
->
queue
 = (
ioq
 *Ë
	`disksim_ioqueue_lﬂd∑øms
(
blk
, 
devi˚_¥ötqueue°©s
, 
devi˚_¥öt¸ô°©s
, 
devi˚_¥ötidÀ°©s
, 
devi˚_¥ötöèº°©s
, 
devi˚_¥ötsize°©s
))) {

16 
	}
}

19 
	$SSDMODEL_SSD_MAX_QUEUE_LENGTH_dïíd
(*
bv
)

22 
	}
}

25 
	$SSDMODEL_SSD_MAX_QUEUE_LENGTH_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

27 i‡(!((
i
 >= 0))) {

30 
ªsu…
->
maxqÀn
 = 
i
;

32 
	}
}

35 
	$SSDMODEL_SSD_BLOCK_COUNT_dïíd
(*
bv
)

38 
	}
}

41 
	$SSDMODEL_SSD_BLOCK_COUNT_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

43 i‡(!((
i
 > 0))) {

46 
ªsu…
->
numblocks
 = 
i
;

48 
	}
}

51 
	$SSDMODEL_SSD_BUS_TRANSACTION_LATENCY_dïíd
(*
bv
)

54 
	}
}

57 
	$SSDMODEL_SSD_BUS_TRANSACTION_LATENCY_lﬂdî
(
ssd
 * 
ªsu…
, 
d
)

59 i‡(!((
d
 >= 0.0))) {

62 
ªsu…
->
bus_å™ß˘i⁄_œãncy
 = 
d
;

64 
	}
}

67 
	$SSDMODEL_SSD_BULK_SECTOR_TRANSFER_TIME_dïíd
(*
bv
)

70 
	}
}

73 
	$SSDMODEL_SSD_BULK_SECTOR_TRANSFER_TIME_lﬂdî
(
ssd
 * 
ªsu…
, 
d
)

75 i‡(!((
d
 >= 0.0))) {

78 
ªsu…
->
blkå™°ime
 = 
d
;

80 
	}
}

83 
	$SSDMODEL_SSD_NEVER_DISCONNECT_dïíd
(*
bv
)

86 
	}
}

89 
	$SSDMODEL_SSD_NEVER_DISCONNECT_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

91 i‡(!(
	`RANGE
(
i
, 0, 1))) {

94 
ªsu…
->
√vîdisc⁄√˘
 = 
i
;

96 
	}
}

99 
	$SSDMODEL_SSD_PRINT_STATS_dïíd
(*
bv
)

102 
	}
}

105 
	$SSDMODEL_SSD_PRINT_STATS_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

107 i‡(!(
	`RANGE
(
i
, 0, 1))) {

110 
ªsu…
->
¥öt°©s
 = 
i
;

112 
	}
}

115 
	$SSDMODEL_SSD_COMMAND_OVERHEAD_dïíd
(*
bv
)

118 
	}
}

121 
	$SSDMODEL_SSD_COMMAND_OVERHEAD_lﬂdî
(
ssd
 * 
ªsu…
, 
d
)

123 i‡(!((
d
 >= 0.0))) {

126 
ªsu…
->
ovîhód
 = 
d
;

128 
	}
}

131 
	$SSDMODEL_SSD_TIMING_MODEL_dïíd
(*
bv
)

134 
	}
}

137 
	$SSDMODEL_SSD_TIMING_MODEL_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

139 i‡(!(
	`RANGE
(
i
, 
SSD_SIMPLE_MODEL
, 
SSD_LOGDISK_MODEL
))) {

142 
ªsu…
->
∑øms
.
ssd_modñ
 = 
i
;

144 
	}
}

147 
	$SSDMODEL_SSD_FLASH_CHIP_ELEMENTS_dïíd
(*
bv
)

150 
	}
}

153 
	$SSDMODEL_SSD_FLASH_CHIP_ELEMENTS_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

155 i‡(!((
i
 >= 0))) {

158 
ªsu…
->
∑øms
.
√Àmíts
 = 
i
;

160 
	}
}

163 
	$SSDMODEL_SSD_PAGE_SIZE_dïíd
(*
bv
)

166 
	}
}

169 
	$SSDMODEL_SSD_PAGE_SIZE_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

171 i‡(!((
i
 >= 0))) {

174 
ªsu…
->
∑øms
.
∑ge_size
 = 
i
;

176 
	}
}

179 
	$SSDMODEL_SSD_PAGES_PER_BLOCK_dïíd
(*
bv
)

182 
	}
}

185 
	$SSDMODEL_SSD_PAGES_PER_BLOCK_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

187 i‡(!((
i
 >= 0))) {

190 
ªsu…
->
∑øms
.
∑ges_≥r_block
 = 
i
;

192 
	}
}

195 
	$SSDMODEL_SSD_BLOCKS_PER_ELEMENT_dïíd
(*
bv
)

198 
	}
}

201 
	$SSDMODEL_SSD_BLOCKS_PER_ELEMENT_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

203 i‡(!((
i
 >= 0))) {

206 
ªsu…
->
∑øms
.
blocks_≥r_ñemít
 = 
i
;

208 
	}
}

211 
	$SSDMODEL_SSD_ELEMENT_STRIDE_PAGES_dïíd
(*
bv
)

214 
	}
}

217 
	$SSDMODEL_SSD_ELEMENT_STRIDE_PAGES_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

219 i‡(!((
i
 >= 0))) {

222 
ªsu…
->
∑øms
.
ñemít_°ride_∑ges
 = 
i
;

224 
	}
}

227 
	$SSDMODEL_SSD_CHIP_XFER_LATENCY_dïíd
(*
bv
)

230 
	}
}

233 
	$SSDMODEL_SSD_CHIP_XFER_LATENCY_lﬂdî
(
ssd
 * 
ªsu…
, 
d
)

235 i‡(!((
d
 >= 0))) {

238 
ªsu…
->
∑øms
.
chù_x„r_œãncy
 = 
d
;

240 
	}
}

243 
	$SSDMODEL_SSD_PAGE_READ_LATENCY_dïíd
(*
bv
)

246 
	}
}

249 
	$SSDMODEL_SSD_PAGE_READ_LATENCY_lﬂdî
(
ssd
 * 
ªsu…
, 
d
)

251 i‡(!((
d
 >= 0))) {

254 
ªsu…
->
∑øms
.
∑ge_ªad_œãncy
 = 
d
;

256 
	}
}

259 
	$SSDMODEL_SSD_PAGE_WRITE_LATENCY_dïíd
(*
bv
)

262 
	}
}

265 
	$SSDMODEL_SSD_PAGE_WRITE_LATENCY_lﬂdî
(
ssd
 * 
ªsu…
, 
d
)

267 i‡(!((
d
 >= 0))) {

270 
ªsu…
->
∑øms
.
∑ge_wrôe_œãncy
 = 
d
;

272 
	}
}

275 
	$SSDMODEL_SSD_BLOCK_ERASE_LATENCY_dïíd
(*
bv
)

278 
	}
}

281 
	$SSDMODEL_SSD_BLOCK_ERASE_LATENCY_lﬂdî
(
ssd
 * 
ªsu…
, 
d
)

283 i‡(!((
d
 >= 0))) {

286 
ªsu…
->
∑øms
.
block_îa£_œãncy
 = 
d
;

288 
	}
}

291 
	$SSDMODEL_SSD_WRITE_POLICY_dïíd
(*
bv
)

294 
	}
}

297 
	$SSDMODEL_SSD_WRITE_POLICY_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

299 i‡(!((
i
 >= 0))) {

302 
ªsu…
->
∑øms
.
wrôe_pﬁicy
 = 
i
;

304 
	}
}

307 
	$SSDMODEL_SSD_RESERVE_PAGES_PERCENTAGE_dïíd
(*
bv
)

310 
	}
}

313 
	$SSDMODEL_SSD_RESERVE_PAGES_PERCENTAGE_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

315 i‡(!((
i
 >= 0))) {

318 
ªsu…
->
∑øms
.
ª£rve_blocks
 = 
i
;

320 
	}
}

323 
	$SSDMODEL_SSD_MINIMUM_FREE_BLOCKS_PERCENTAGE_dïíd
(*
bv
)

326 
	}
}

329 
	$SSDMODEL_SSD_MINIMUM_FREE_BLOCKS_PERCENTAGE_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

331 i‡(!((
i
 >= 0))) {

334 
ªsu…
->
∑øms
.
mö_‰ìblks_≥r˚¡
 = 
i
;

336 
	}
}

339 
	$SSDMODEL_SSD_CLEANING_POLICY_dïíd
(*
bv
)

342 
	}
}

345 
	$SSDMODEL_SSD_CLEANING_POLICY_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

347 i‡(!((
i
 >= 0))) {

350 
ªsu…
->
∑øms
.
˛ónög_pﬁicy
 = 
i
;

352 
	}
}

355 
	$SSDMODEL_SSD_PLANES_PER_PACKAGE_dïíd
(*
bv
)

358 
	}
}

361 
	$SSDMODEL_SSD_PLANES_PER_PACKAGE_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

363 i‡(!((
i
 >= 0))) {

366 
ªsu…
->
∑øms
.
∂™es_≥r_pkg
 = 
i
;

368 
	}
}

371 
	$SSDMODEL_SSD_BLOCKS_PER_PLANE_dïíd
(*
bv
)

374 
	}
}

377 
	$SSDMODEL_SSD_BLOCKS_PER_PLANE_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

379 i‡(!((
i
 >= 0))) {

382 
ªsu…
->
∑øms
.
blocks_≥r_∂™e
 = 
i
;

384 
	}
}

387 
	$SSDMODEL_SSD_PLANE_BLOCK_MAPPING_dïíd
(*
bv
)

390 
	}
}

393 
	$SSDMODEL_SSD_PLANE_BLOCK_MAPPING_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

395 i‡(!((
i
 >= 0))) {

398 
ªsu…
->
∑øms
.
∂™e_block_m≠pög
 = 
i
;

400 
	}
}

403 
	$SSDMODEL_SSD_COPY_BACK_dïíd
(*
bv
)

406 
	}
}

409 
	$SSDMODEL_SSD_COPY_BACK_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

411 i‡(!(
	`RANGE
(
i
, 0, 1))) {

414 
ªsu…
->
∑øms
.
c›y_back
 = 
i
;

416 
	}
}

419 
	$SSDMODEL_SSD_NUMBER_OF_PARALLEL_UNITS_dïíd
(*
bv
)

422 
	}
}

425 
	$SSDMODEL_SSD_NUMBER_OF_PARALLEL_UNITS_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

427 i‡(!((
i
 >= 0.0))) {

430 
ªsu…
->
∑øms
.
num_∑runôs
 = 
i
;

432 
	}
}

435 
	$SSDMODEL_SSD_ELEMENTS_PER_GANG_dïíd
(*
bv
)

438 
	}
}

441 
	$SSDMODEL_SSD_ELEMENTS_PER_GANG_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

443 i‡(!((
i
 >= 0))) {

446 
ªsu…
->
∑øms
.
ñemíts_≥r_g™g
 = 
i
;

448 
	}
}

451 
	$SSDMODEL_SSD_CLEANING_IN_BACKGROUND_dïíd
(*
bv
)

454 
	}
}

457 
	$SSDMODEL_SSD_CLEANING_IN_BACKGROUND_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

459 i‡(!(
	`RANGE
(
i
, 0, 1))) {

462 
ªsu…
->
∑øms
.
˛ónög_ö_background
 = 
i
;

464 
	}
}

467 
	$SSDMODEL_SSD_GANG_SHARE_dïíd
(*
bv
)

470 
	}
}

473 
	$SSDMODEL_SSD_GANG_SHARE_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

475 i‡(!((
i
 >= 0))) {

478 
ªsu…
->
∑øms
.
g™g_sh¨e
 = 
i
;

480 
	}
}

483 
	$SSDMODEL_SSD_ALLOCATION_POOL_LOGIC_dïíd
(*
bv
)

486 
	}
}

489 
	$SSDMODEL_SSD_ALLOCATION_POOL_LOGIC_lﬂdî
(
ssd
 * 
ªsu…
, 
i
)

491 i‡(!((
i
 >= 0))) {

494 
ªsu…
->
∑øms
.
Æloc_poﬁ_logic
 = 
i
;

496 
	}
}

498 *
	gSSDMODEL_SSD_lﬂdîs
[] = {

499 (*Ë
SSDMODEL_SSD_SCHEDULER_lﬂdî
,

500 (*Ë
SSDMODEL_SSD_MAX_QUEUE_LENGTH_lﬂdî
,

501 (*Ë
SSDMODEL_SSD_BLOCK_COUNT_lﬂdî
,

502 (*Ë
SSDMODEL_SSD_BUS_TRANSACTION_LATENCY_lﬂdî
,

503 (*Ë
SSDMODEL_SSD_BULK_SECTOR_TRANSFER_TIME_lﬂdî
,

504 (*Ë
SSDMODEL_SSD_NEVER_DISCONNECT_lﬂdî
,

505 (*Ë
SSDMODEL_SSD_PRINT_STATS_lﬂdî
,

506 (*Ë
SSDMODEL_SSD_COMMAND_OVERHEAD_lﬂdî
,

507 (*Ë
SSDMODEL_SSD_TIMING_MODEL_lﬂdî
,

508 (*Ë
SSDMODEL_SSD_FLASH_CHIP_ELEMENTS_lﬂdî
,

509 (*Ë
SSDMODEL_SSD_PAGE_SIZE_lﬂdî
,

510 (*Ë
SSDMODEL_SSD_PAGES_PER_BLOCK_lﬂdî
,

511 (*Ë
SSDMODEL_SSD_BLOCKS_PER_ELEMENT_lﬂdî
,

512 (*Ë
SSDMODEL_SSD_ELEMENT_STRIDE_PAGES_lﬂdî
,

513 (*Ë
SSDMODEL_SSD_CHIP_XFER_LATENCY_lﬂdî
,

514 (*Ë
SSDMODEL_SSD_PAGE_READ_LATENCY_lﬂdî
,

515 (*Ë
SSDMODEL_SSD_PAGE_WRITE_LATENCY_lﬂdî
,

516 (*Ë
SSDMODEL_SSD_BLOCK_ERASE_LATENCY_lﬂdî
,

517 (*Ë
SSDMODEL_SSD_WRITE_POLICY_lﬂdî
,

518 (*Ë
SSDMODEL_SSD_RESERVE_PAGES_PERCENTAGE_lﬂdî
,

519 (*Ë
SSDMODEL_SSD_MINIMUM_FREE_BLOCKS_PERCENTAGE_lﬂdî
,

520 (*Ë
SSDMODEL_SSD_CLEANING_POLICY_lﬂdî
,

521 (*Ë
SSDMODEL_SSD_PLANES_PER_PACKAGE_lﬂdî
,

522 (*Ë
SSDMODEL_SSD_BLOCKS_PER_PLANE_lﬂdî
,

523 (*Ë
SSDMODEL_SSD_PLANE_BLOCK_MAPPING_lﬂdî
,

524 (*Ë
SSDMODEL_SSD_COPY_BACK_lﬂdî
,

525 (*Ë
SSDMODEL_SSD_NUMBER_OF_PARALLEL_UNITS_lﬂdî
,

526 (*Ë
SSDMODEL_SSD_ELEMENTS_PER_GANG_lﬂdî
,

527 (*Ë
SSDMODEL_SSD_CLEANING_IN_BACKGROUND_lﬂdî
,

528 (*Ë
SSDMODEL_SSD_GANG_SHARE_lﬂdî
,

529 (*Ë
SSDMODEL_SSD_ALLOCATION_POOL_LOGIC_lﬂdî


532 
Õ_∑ømdï_t
 
	gSSDMODEL_SSD_dïs
[] = {

533 
SSDMODEL_SSD_SCHEDULER_dïíd
,

534 
SSDMODEL_SSD_MAX_QUEUE_LENGTH_dïíd
,

535 
SSDMODEL_SSD_BLOCK_COUNT_dïíd
,

536 
SSDMODEL_SSD_BUS_TRANSACTION_LATENCY_dïíd
,

537 
SSDMODEL_SSD_BULK_SECTOR_TRANSFER_TIME_dïíd
,

538 
SSDMODEL_SSD_NEVER_DISCONNECT_dïíd
,

539 
SSDMODEL_SSD_PRINT_STATS_dïíd
,

540 
SSDMODEL_SSD_COMMAND_OVERHEAD_dïíd
,

541 
SSDMODEL_SSD_TIMING_MODEL_dïíd
,

542 
SSDMODEL_SSD_FLASH_CHIP_ELEMENTS_dïíd
,

543 
SSDMODEL_SSD_PAGE_SIZE_dïíd
,

544 
SSDMODEL_SSD_PAGES_PER_BLOCK_dïíd
,

545 
SSDMODEL_SSD_BLOCKS_PER_ELEMENT_dïíd
,

546 
SSDMODEL_SSD_ELEMENT_STRIDE_PAGES_dïíd
,

547 
SSDMODEL_SSD_CHIP_XFER_LATENCY_dïíd
,

548 
SSDMODEL_SSD_PAGE_READ_LATENCY_dïíd
,

549 
SSDMODEL_SSD_PAGE_WRITE_LATENCY_dïíd
,

550 
SSDMODEL_SSD_BLOCK_ERASE_LATENCY_dïíd
,

551 
SSDMODEL_SSD_WRITE_POLICY_dïíd
,

552 
SSDMODEL_SSD_RESERVE_PAGES_PERCENTAGE_dïíd
,

553 
SSDMODEL_SSD_MINIMUM_FREE_BLOCKS_PERCENTAGE_dïíd
,

554 
SSDMODEL_SSD_CLEANING_POLICY_dïíd
,

555 
SSDMODEL_SSD_PLANES_PER_PACKAGE_dïíd
,

556 
SSDMODEL_SSD_BLOCKS_PER_PLANE_dïíd
,

557 
SSDMODEL_SSD_PLANE_BLOCK_MAPPING_dïíd
,

558 
SSDMODEL_SSD_COPY_BACK_dïíd
,

559 
SSDMODEL_SSD_NUMBER_OF_PARALLEL_UNITS_dïíd
,

560 
SSDMODEL_SSD_ELEMENTS_PER_GANG_dïíd
,

561 
SSDMODEL_SSD_CLEANING_IN_BACKGROUND_dïíd
,

562 
SSDMODEL_SSD_GANG_SHARE_dïíd
,

563 
SSDMODEL_SSD_ALLOCATION_POOL_LOGIC_dïíd


	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/modules/ssdmodel_ssd_param.h

2 #i‚de‡
_SSDMODEL_SSD_PARAM_H


3 
	#_SSDMODEL_SSD_PARAM_H


	)

5 
	~<lib∑øm/lib∑øm.h
>

6 #ifde‡
__˝lu•lus


9 
dm_disk_if
;

12 
ssd
 *
ssdmodñ_ssd_lﬂd∑øms
(
Õ_block
 *
b
, *
num
);

15 
SSDMODEL_SSD_SCHEDULER
,

16 
SSDMODEL_SSD_MAX_QUEUE_LENGTH
,

17 
SSDMODEL_SSD_BLOCK_COUNT
,

18 
SSDMODEL_SSD_BUS_TRANSACTION_LATENCY
,

19 
SSDMODEL_SSD_BULK_SECTOR_TRANSFER_TIME
,

20 
SSDMODEL_SSD_NEVER_DISCONNECT
,

21 
SSDMODEL_SSD_PRINT_STATS
,

22 
SSDMODEL_SSD_COMMAND_OVERHEAD
,

23 
SSDMODEL_SSD_TIMING_MODEL
,

24 
SSDMODEL_SSD_FLASH_CHIP_ELEMENTS
,

25 
SSDMODEL_SSD_PAGE_SIZE
,

26 
SSDMODEL_SSD_PAGES_PER_BLOCK
,

27 
SSDMODEL_SSD_BLOCKS_PER_ELEMENT
,

28 
SSDMODEL_SSD_ELEMENT_STRIDE_PAGES
,

29 
SSDMODEL_SSD_CHIP_XFER_LATENCY
,

30 
SSDMODEL_SSD_PAGE_READ_LATENCY
,

31 
SSDMODEL_SSD_PAGE_WRITE_LATENCY
,

32 
SSDMODEL_SSD_BLOCK_ERASE_LATENCY
,

33 
SSDMODEL_SSD_WRITE_POLICY
,

34 
SSDMODEL_SSD_RESERVE_PAGES_PERCENTAGE
,

35 
SSDMODEL_SSD_MINIMUM_FREE_BLOCKS_PERCENTAGE
,

36 
SSDMODEL_SSD_CLEANING_POLICY
,

37 
SSDMODEL_SSD_PLANES_PER_PACKAGE
,

38 
SSDMODEL_SSD_BLOCKS_PER_PLANE
,

39 
SSDMODEL_SSD_PLANE_BLOCK_MAPPING
,

40 
SSDMODEL_SSD_COPY_BACK
,

41 
SSDMODEL_SSD_NUMBER_OF_PARALLEL_UNITS
,

42 
SSDMODEL_SSD_ELEMENTS_PER_GANG
,

43 
SSDMODEL_SSD_CLEANING_IN_BACKGROUND
,

44 
SSDMODEL_SSD_GANG_SHARE
,

45 
SSDMODEL_SSD_ALLOCATION_POOL_LOGIC


46 } 
	tssdmodñ_ssd_∑øm_t
;

48 
	#SSDMODEL_SSD_MAX_PARAM
 
SSDMODEL_SSD_ALLOCATION_POOL_LOGIC


	)

49 * 
SSDMODEL_SSD_lﬂdîs
[];

50 
Õ_∑ømdï_t
 
SSDMODEL_SSD_dïs
[];

53 
Õ_v¨•ec
 
	gssdmodñ_ssd_∑øms
 [] = {

54 {"ScheduÀr", 
BLOCK
, 1 },

55 {"Max queuêÀngth", 
I
, 1 },

56 {"Block cou¡", 
I
, 0 },

57 {"Bu†å™ß˘i⁄Ü©ícy", 
D
, 0 },

58 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

59 {"Nevî disc⁄√˘", 
I
, 1 },

60 {"Pröà°©s", 
I
, 1 },

61 {"Comm™d ovîhód", 
D
, 1 },

62 {"Timög modñ", 
I
, 1 },

63 {"Fœsh chùÉÀmíts", 
I
, 1 },

64 {"Pagêsize", 
I
, 1 },

65 {"Page†≥∏block", 
I
, 1 },

66 {"Block†≥∏ñemít", 
I
, 1 },

67 {"EÀmíà°ridê∑ges", 
I
, 1 },

68 {"Chù x„∏œãncy", 
D
, 1 },

69 {"PagêªadÜ©ícy", 
D
, 1 },

70 {"Pagêwrôêœãncy", 
D
, 1 },

71 {"BlockÉø£Ü©ícy", 
D
, 1 },

72 {"Wrôêpﬁicy", 
I
, 1 },

73 {"Re£rvê∑ge†≥r˚¡age", 
I
, 1 },

74 {"Möimum fªêblock†≥r˚¡age", 
I
, 1 },

75 {"CÀ™ögÖﬁicy", 
I
, 1 },

76 {"Pœ√†≥∏∑ckage", 
I
, 1 },

77 {"Block†≥∏∂™e", 
I
, 1 },

78 {"Pœ√ block m≠pög", 
I
, 1 },

79 {"C›y back", 
I
, 1 },

80 {"Numbî o‡∑øŒñ unôs", 
I
, 1 },

81 {"EÀmít†≥∏g™g", 
I
, 1 },

82 {"CÀ™ög i¿background", 
I
, 1 },

83 {"G™g sh¨e", 
I
, 1 },

84 {"AŒoˇti⁄ÖoﬁÜogic", 
I
, 1 },

87 
	#SSDMODEL_SSD_MAX
 31

	)

88 
Õ_mod
 
	gssdmodñ_ssd_mod
 = { "ssdmodñ_ssd", 
ssdmodñ_ssd_∑øms
, 
SSDMODEL_SSD_MAX
, (
Õ_modlﬂdî_t
)
ssdmodñ_ssd_lﬂd∑øms
, 0, 0, 
SSDMODEL_SSD_lﬂdîs
, 
SSDMODEL_SSD_dïs
 };

91 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/old/ssd_param.c

4 
	~"ssd_∑øm.h
"

5 
	~<lib∑øm/bôve˘‹.h
>

6 
	~"../ssdmodñ/ssd.h
"

7 
	~"../ssdmodñ/ssd_timög.h
"

9 
	$DISKSIM_SSD_SCHEDULER_dïíd
(*
bv
) {

11 
	}
}

13 
	$DISKSIM_SSD_SCHEDULER_lﬂdî
(

14 
ssd
 * 
ªsu…
, 
Õ_block
 *
blk
) {

15 
i
;

16 
ªsu…
->
queue
 =

17 (
ioq
 *)
	`disksim_ioqueue_lﬂd∑øms
(

18 
blk
, 
devi˚_¥ötqueue°©s
, 
devi˚_¥öt¸ô°©s
,

19 
devi˚_¥ötidÀ°©s
, 
devi˚_¥ötöèº°©s
,

20 
devi˚_¥ötsize°©s
);

21 
	`as£π
(
ªsu…
->
queue
 !
NULL
);

45 
	}
}

47 
	$DISKSIM_SSD_MAX_QUEUE_LENGTH_dïíd
(*
bv
) {

49 
	}
}

51 
	$DISKSIM_SSD_MAX_QUEUE_LENGTH_lﬂdî
(
ssd
 * 
ªsu…
, 
i
) {

52 i‡(! (
i
 >= 0)) {

54 
ªsu…
->
maxqÀn
 = 
i
;

56 
	}
}

58 
	$DISKSIM_SSD_BLOCK_COUNT_dïíd
(*
bv
) {

60 
	}
}

62 
	$DISKSIM_SSD_BLOCK_COUNT_lﬂdî
(
ssd
 * 
ªsu…
, 
i
) {

63 i‡(! (
i
 >= 1)) {

65 
ªsu…
->
numblocks
 = 
i
;

66 
	}
}

68 
	$DISKSIM_SSD_BUS_TRANSACTION_LATENCY_dïíd
(*
bv
) {

70 
	}
}

72 
	$DISKSIM_SSD_BUS_TRANSACTION_LATENCY_lﬂdî
(
ssd
 * 
ªsu…
, 
d
) {

73 i‡(! (
d
 >= 0.0)) {

75 
ªsu…
->
bus_å™ß˘i⁄_œãncy
 = 
d
;

77 
	}
}

79 
	$DISKSIM_SSD_BULK_SECTOR_TRANSFER_TIME_dïíd
(*
bv
) {

81 
	}
}

83 
	$DISKSIM_SSD_BULK_SECTOR_TRANSFER_TIME_lﬂdî
(
ssd
 * 
ªsu…
, 
d
) {

84 i‡(! (
d
 >= 0.0)) {

86 
ªsu…
->
blkå™°ime
 = 
d
;

88 
	}
}

90 
	$DISKSIM_SSD_NEVER_DISCONNECT_dïíd
(*
bv
) {

92 
	}
}

94 
	$DISKSIM_SSD_NEVER_DISCONNECT_lﬂdî
(
ssd
 * 
ªsu…
, 
i
) {

95 i‡(! (
	`RANGE
(
i
,0,1))) {

97 
ªsu…
->
√vîdisc⁄√˘
 = 
i
;

99 
	}
}

101 
	$DISKSIM_SSD_PRINT_STATS_dïíd
(*
bv
) {

103 
	}
}

105 
	$DISKSIM_SSD_PRINT_STATS_lﬂdî
(
ssd
 * 
ªsu…
, 
i
) {

106 i‡(! (
	`RANGE
(
i
,0,1))) {

108 
ªsu…
->
¥öt°©s
 = 
i
;

110 
	}
}

112 
	$DISKSIM_SSD_COMMAND_OVERHEAD_dïíd
(*
bv
) {

114 
	}
}

116 
	$DISKSIM_SSD_COMMAND_OVERHEAD_lﬂdî
(
ssd
 * 
ªsu…
, 
d
) {

117 i‡(! (
d
 >= 0.0)) {

119 
ªsu…
->
ovîhód
 = 
d
;

120 
	}
}

122 
	$DISKSIM_SSD_MODEL_TYPE_dïíd
(*
bv
) {

124 
	}
}

126 
	$DISKSIM_SSD_MODEL_TYPE_lﬂdî
(
ssd
 * 
ªsu…
, 
i
) {

127 i‡(! (
	`RANGE
(
i
,
SSD_SIMPLE_MODEL
,
SSD_LOGDISK_MODEL
))) {

129 
ªsu…
->
∑øms
.
ssd_modñ
 = 
i
;

130 
	}
}

132 
	$DISKSIM_SSD_FLASH_CHIP_ELEMENTS_dïíd
(*
bv
) {

134 
	}
}

136 
	$DISKSIM_SSD_FLASH_CHIP_ELEMENTS_lﬂdî
(
ssd
 * 
ªsu…
, 
i
) {

137 i‡(! (
	`RANGE
(
i
,1,
SSD_MAX_ELEMENTS
))) {

139 
ªsu…
->
∑øms
.
√Àmíts
 = 
i
;

140 
	}
}

141 
	$DISKSIM_SSD_FLASH_PAGE_SIZE_dïíd
(*
bv
) {

143 
	}
}

145 
	$DISKSIM_SSD_FLASH_PAGE_SIZE_lﬂdî
(
ssd
 * 
ªsu…
, 
i
) {

146 i‡(! (
i
>=8)) {

148 
ªsu…
->
∑øms
.
∑ge_size
 = 
i
;

149 
	}
}

150 
	$DISKSIM_SSD_PAGES_PER_BLOCK_dïíd
(*
bv
) {

152 
	}
}

154 
	$DISKSIM_SSD_PAGES_PER_BLOCK_lﬂdî
(
ssd
 * 
ªsu…
, 
i
) {

155 i‡(! (
i
>0)) {

157 
ªsu…
->
∑øms
.
∑ges_≥r_block
 = 
i
;

158 
	}
}

160 
	$DISKSIM_SSD_BLOCKS_PER_ELEMENT_dïíd
(*
bv
) {

162 
	}
}

164 
	$DISKSIM_SSD_BLOCKS_PER_ELEMENT_lﬂdî
(
ssd
 * 
ªsu…
, 
i
) {

165 i‡(! (
i
>0)) {

167 
ªsu…
->
∑øms
.
blocks_≥r_ñemít
 = 
i
;

168 
	}
}

170 
	$DISKSIM_SSD_ELEMENT_STRIDE_PAGES_dïíd
(*
bv
) {

172 
	}
}

174 
	$DISKSIM_SSD_ELEMENT_STRIDE_PAGES_lﬂdî
(
ssd
 * 
ªsu…
, 
i
) {

175 i‡(! (
i
>=8)) {

177 
ªsu…
->
∑øms
.
ñemít_°ride_∑ges
 = 
i
;

178 
	}
}

179 
	$DISKSIM_SSD_CHIP_XFER_LATENCY_dïíd
(*
bv
) {

181 
	}
}

183 
	$DISKSIM_SSD_CHIP_XFER_LATENCY_lﬂdî
(
ssd
 * 
ªsu…
, 
d
) {

184 i‡(! (
d
 >= 0.0)) {

186 
ªsu…
->
∑øms
.
chù_x„r_œãncy
 = 
d
;

187 
	}
}

189 
	$DISKSIM_SSD_PAGE_READ_LATENCY_dïíd
(*
bv
) {

191 
	}
}

193 
	$DISKSIM_SSD_PAGE_READ_LATENCY_lﬂdî
(
ssd
 * 
ªsu…
, 
d
) {

194 i‡(! (
d
 >= 0.0)) {

196 
ªsu…
->
∑øms
.
∑ge_ªad_œãncy
 = 
d
;

197 
	}
}

199 
	$DISKSIM_SSD_PAGE_WRITE_LATENCY_dïíd
(*
bv
) {

201 
	}
}

203 
	$DISKSIM_SSD_PAGE_WRITE_LATENCY_lﬂdî
(
ssd
 * 
ªsu…
, 
d
) {

204 i‡(! (
d
 >= 0.0)) {

206 
ªsu…
->
∑øms
.
∑ge_wrôe_œãncy
 = 
d
;

207 
	}
}

208 
	$DISKSIM_SSD_BLOCK_ERASE_LATENCY_dïíd
(*
bv
) {

210 
	}
}

212 
	$DISKSIM_SSD_BLOCK_ERASE_LATENCY_lﬂdî
(
ssd
 * 
ªsu…
, 
d
) {

213 i‡(! (
d
 >= 0.0)) {

215 
ªsu…
->
∑øms
.
block_îa£_œãncy
 = 
d
;

216 
	}
}

219 
	$DISKSIM_SSD_WRITE_POLICY_dïíd
(*
bv
) {

221 
	}
}

223 
	$DISKSIM_SSD_WRITE_POLICY_lﬂdî
(
ssd
 *
ªsu…
, 
i
) {

224 i‡(
i
 > 
DISKSIM_SSD_MAX_WRITE_POLICIES
) {

225 
	`Ârötf
(
°dîr
, "Eº‹: invÆid wrôêpﬁicy %d i¿DISKSIM_SSD_WRITE_POLICY_lﬂdî\n", 
i
);

226 
	`exô
(1);

228 
ªsu…
->
∑øms
.
wrôe_pﬁicy
 = 
i
;

229 
	}
}

231 
	$DISKSIM_SSD_RESERVE_BLOCKS_dïíd
(*
bv
)

234 
	}
}

236 
	$DISKSIM_SSD_RESERVE_BLOCKS_lﬂdî
(
ssd
 *
ªsu…
, 
i
)

238 i‡((
i
 < 0Ë|| (ò> 
DISKSIM_SSD_MAX_RESERVE
)) {

239 
	`Ârötf
(
°dîr
, "Eº‹: invÆid Re£rvêblock†≥r˚¡agê%d\n", 
i
);

240 
	`exô
(1);

242 
ªsu…
->
∑øms
.
ª£rve_blocks
 = 
i
;

243 
	}
}

245 
	$DISKSIM_SSD_MIN_FREEBLKS_PERCENTAGE_dïíd
(*
bv
)

248 
	}
}

250 
	$DISKSIM_SSD_MIN_FREEBLKS_PERCENTAGE_lﬂdî
(
ssd
 *
ªsu…
, 
i
)

252 
ªsu…
->
∑øms
.
mö_‰ìblks_≥r˚¡
 = 
i
;

253 
	}
}

256 
	$DISKSIM_SSD_CLEANING_POLICY_dïíd
(*
bv
)

259 
	}
}

261 
	$DISKSIM_SSD_CLEANING_POLICY_lﬂdî
(
ssd
 *
ªsu…
, 
i
)

263 i‡(
i
 < 0) {

264 
	`Ârötf
(
°dîr
, "Eº‹: invÆid cÀ™ögÖﬁicy %d\n", 
i
);

265 
	`exô
(1);

268 
ªsu…
->
∑øms
.
˛ónög_pﬁicy
 = 
i
;

269 
	}
}

271 
	$DISKSIM_SSD_PLANES_PER_PKG_dïíd
(*
bv
) {

273 
	}
}

274 
	$DISKSIM_SSD_PLANES_PER_PKG_lﬂdî
(
ssd
 *
ªsu…
, 
i
) {

275 i‡((
i
 <0Ë|| (ò> 
SSD_MAX_PLANES_PER_ELEM
)) {

276 
	`Ârötf
(
°dîr
, "Eº‹: invÆidÖœ√†≥∏∑ckagê%d\n", 
i
);

277 
	`exô
(1);

279 
ªsu…
->
∑øms
.
∂™es_≥r_pkg
 = 
i
;

280 
	}
}

284 
	$DISKSIM_SSD_BLOCKS_PER_PLANE_dïíd
(*
bv
) {

286 
	}
}

287 
	$DISKSIM_SSD_BLOCKS_PER_PLANE_lﬂdî
(
ssd
 *
ªsu…
, 
i
) {

288 i‡(
i
 <= 0) {

289 
	`Ârötf
(
°dîr
, "Eº‹: invÆid block†≥∏∂™ê%d\n", 
i
);

290 
	`exô
(1);

292 
ªsu…
->
∑øms
.
blocks_≥r_∂™e
 = 
i
;

293 
	}
}

296 
	$DISKSIM_SSD_PLANE_BLOCK_MAPPING_dïíd
(*
bv
) {

298 
	}
}

299 
	$DISKSIM_SSD_PLANE_BLOCK_MAPPING_lﬂdî
(
ssd
 *
ªsu…
, 
i
) {

300 
ªsu…
->
∑øms
.
∂™e_block_m≠pög
 = 
i
;

301 
	}
}

304 
	$DISKSIM_SSD_COPY_BACK_dïíd
(*
bv
) {

306 
	}
}

307 
	$DISKSIM_SSD_COPY_BACK_lﬂdî
(
ssd
 *
ªsu…
, 
i
) {

308 
ªsu…
->
∑øms
.
c›y_back
 = 
i
;

309 
	}
}

312 
	$DISKSIM_SSD_NUM_PARALLEL_UNITS_dïíd
(*
bv
) {

314 
	}
}

315 
	$DISKSIM_SSD_NUM_PARALLEL_UNITS_lﬂdî
(
ssd
 *
ªsu…
, 
i
) {

316 
ªsu…
->
∑øms
.
num_∑runôs
 = 
i
;

317 
	}
}

319 
	$DISKSIM_SSD_ELEMENTS_PER_GANG_dïíd
(*
bv
) {

321 
	}
}

322 
	$DISKSIM_SSD_ELEMENTS_PER_GANG_lﬂdî
(
ssd
 *
ªsu…
, 
i
) {

323 
ªsu…
->
∑øms
.
ñemíts_≥r_g™g
 = 
i
;

324 
	}
}

326 
	$DISKSIM_SSD_CLEANING_IN_BACKGROUND_dïíd
(*
bv
) {

328 
	}
}

329 
	$DISKSIM_SSD_CLEANING_IN_BACKGROUND_lﬂdî
(
ssd
 *
ªsu…
, 
i
) {

330 
ªsu…
->
∑øms
.
˛ónög_ö_background
 = 
i
;

331 
	}
}

333 
	$DISKSIM_SSD_GANG_SHARE_dïíd
(*
bv
) {

335 
	}
}

336 
	$DISKSIM_SSD_GANG_SHARE_lﬂdî
(
ssd
 *
ªsu…
, 
i
) {

337 
ªsu…
->
∑øms
.
g™g_sh¨e
 = 
i
;

338 
	}
}

341 
	$DISKSIM_SSD_ALLOC_POOL_LOGIC_dïíd
(*
bv
) {

343 
	}
}

344 
	$DISKSIM_SSD_ALLOC_POOL_LOGIC_lﬂdî
(
ssd
 *
ªsu…
, 
i
) {

345 
ªsu…
->
∑øms
.
Æloc_poﬁ_logic
 = 
i
;

346 
	}
}

349 * 
	gDISKSIM_SSD_lﬂdîs
[] = {

350 (*)
DISKSIM_SSD_SCHEDULER_lﬂdî
,

351 (*)
DISKSIM_SSD_MAX_QUEUE_LENGTH_lﬂdî
,

352 (*)
DISKSIM_SSD_BLOCK_COUNT_lﬂdî
,

353 (*)
DISKSIM_SSD_BUS_TRANSACTION_LATENCY_lﬂdî
,

354 (*)
DISKSIM_SSD_BULK_SECTOR_TRANSFER_TIME_lﬂdî
,

355 (*)
DISKSIM_SSD_NEVER_DISCONNECT_lﬂdî
,

356 (*)
DISKSIM_SSD_PRINT_STATS_lﬂdî
,

357 (*)
DISKSIM_SSD_COMMAND_OVERHEAD_lﬂdî
,

358 (*)
DISKSIM_SSD_MODEL_TYPE_lﬂdî
,

359 (*)
DISKSIM_SSD_FLASH_CHIP_ELEMENTS_lﬂdî
,

360 (*)
DISKSIM_SSD_FLASH_PAGE_SIZE_lﬂdî
,

361 (*)
DISKSIM_SSD_PAGES_PER_BLOCK_lﬂdî
,

362 (*)
DISKSIM_SSD_BLOCKS_PER_ELEMENT_lﬂdî
,

363 (*)
DISKSIM_SSD_ELEMENT_STRIDE_PAGES_lﬂdî
,

364 (*)
DISKSIM_SSD_CHIP_XFER_LATENCY_lﬂdî
,

365 (*)
DISKSIM_SSD_PAGE_READ_LATENCY_lﬂdî
,

366 (*)
DISKSIM_SSD_PAGE_WRITE_LATENCY_lﬂdî
,

367 (*)
DISKSIM_SSD_BLOCK_ERASE_LATENCY_lﬂdî
,

370 (*)
DISKSIM_SSD_WRITE_POLICY_lﬂdî
,

371 (*)
DISKSIM_SSD_RESERVE_BLOCKS_lﬂdî
,

372 (*)
DISKSIM_SSD_MIN_FREEBLKS_PERCENTAGE_lﬂdî
,

373 (*)
DISKSIM_SSD_CLEANING_POLICY_lﬂdî
,

374 (*)
DISKSIM_SSD_PLANES_PER_PKG_lﬂdî
,

375 (*)
DISKSIM_SSD_BLOCKS_PER_PLANE_lﬂdî
,

376 (*)
DISKSIM_SSD_PLANE_BLOCK_MAPPING_lﬂdî
,

377 (*)
DISKSIM_SSD_COPY_BACK_lﬂdî
,

378 (*)
DISKSIM_SSD_NUM_PARALLEL_UNITS_lﬂdî
,

379 (*)
DISKSIM_SSD_ELEMENTS_PER_GANG_lﬂdî
,

380 (*)
DISKSIM_SSD_CLEANING_IN_BACKGROUND_lﬂdî
,

381 (*)
DISKSIM_SSD_GANG_SHARE_lﬂdî
,

382 (*)
DISKSIM_SSD_ALLOC_POOL_LOGIC_lﬂdî
,

384 
NULL


387 
Õ_∑ømdï_t
 
	gDISKSIM_SSD_dïs
[] = {

388 (*)
DISKSIM_SSD_SCHEDULER_dïíd
,

389 (*)
DISKSIM_SSD_MAX_QUEUE_LENGTH_dïíd
,

390 (*)
DISKSIM_SSD_BLOCK_COUNT_dïíd
,

391 (*)
DISKSIM_SSD_BUS_TRANSACTION_LATENCY_dïíd
,

392 (*)
DISKSIM_SSD_BULK_SECTOR_TRANSFER_TIME_dïíd
,

393 (*)
DISKSIM_SSD_NEVER_DISCONNECT_dïíd
,

394 (*)
DISKSIM_SSD_PRINT_STATS_dïíd
,

395 (*)
DISKSIM_SSD_COMMAND_OVERHEAD_dïíd
,

396 (*)
DISKSIM_SSD_MODEL_TYPE_dïíd
,

397 (*)
DISKSIM_SSD_FLASH_CHIP_ELEMENTS_dïíd
,

398 (*)
DISKSIM_SSD_FLASH_PAGE_SIZE_dïíd
,

399 (*)
DISKSIM_SSD_PAGES_PER_BLOCK_dïíd
,

400 (*)
DISKSIM_SSD_BLOCKS_PER_ELEMENT_dïíd
,

401 (*)
DISKSIM_SSD_ELEMENT_STRIDE_PAGES_dïíd
,

402 (*)
DISKSIM_SSD_CHIP_XFER_LATENCY_dïíd
,

403 (*)
DISKSIM_SSD_PAGE_READ_LATENCY_dïíd
,

404 (*)
DISKSIM_SSD_PAGE_WRITE_LATENCY_dïíd
,

405 (*)
DISKSIM_SSD_BLOCK_ERASE_LATENCY_dïíd
,

408 (*)
DISKSIM_SSD_WRITE_POLICY_dïíd
,

409 (*)
DISKSIM_SSD_RESERVE_BLOCKS_dïíd
,

410 (*)
DISKSIM_SSD_MIN_FREEBLKS_PERCENTAGE_dïíd
,

411 (*)
DISKSIM_SSD_CLEANING_POLICY_dïíd
,

412 (*)
DISKSIM_SSD_PLANES_PER_PKG_dïíd
,

413 (*)
DISKSIM_SSD_BLOCKS_PER_PLANE_dïíd
,

414 (*)
DISKSIM_SSD_PLANE_BLOCK_MAPPING_dïíd
,

415 (*)
DISKSIM_SSD_COPY_BACK_dïíd
,

416 (*)
DISKSIM_SSD_NUM_PARALLEL_UNITS_dïíd
,

417 (*)
DISKSIM_SSD_ELEMENTS_PER_GANG_dïíd
,

418 (*)
DISKSIM_SSD_CLEANING_IN_BACKGROUND_dïíd
,

419 (*)
DISKSIM_SSD_GANG_SHARE_dïíd
,

420 (*)
DISKSIM_SSD_ALLOC_POOL_LOGIC_dïíd
,

422 
NULL


	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/old/ssd_param.h

4 
	~<lib∑øm/lib∑øm.h
>

8 #i‚de‡
_DISKSIM_SSD_PARAM_H


9 
	#_DISKSIM_SSD_PARAM_H


	)

11 #ifde‡
__˝lu•lus


15 
	#DISKSIM_SSD_MAX
 10

	)

19 
ssd
 *
disksim_ssd_lﬂd∑øms
(
Õ_block
 *
b
);

22 
DISKSIM_SSD_SCHEDULER
,

23 
DISKSIM_SSD_MAX_QUEUE_LENGTH
,

24 
DISKSIM_SSD_BLOCK_COUNT
,

25 
DISKSIM_SSD_BUS_TRANSACTION_LATENCY
,

26 
DISKSIM_SSD_BULK_SECTOR_TRANSFER_TIME
,

27 
DISKSIM_SSD_NEVER_DISCONNECT
,

28 
DISKSIM_SSD_PRINT_STATS
,

29 
DISKSIM_SSD_COMMAND_OVERHEAD
,

30 
DISKSIM_SSD_MODEL_TYPE
,

31 
DISKSIM_SSD_NELEMENTS
,

32 
DISKSIM_SSD_FLASH_PAGE_SIZE
,

33 
DISKSIM_SSD_PAGES_PER_BLOCK
,

34 
DISKSIM_SSD_BLOCKS_PER_ELEMENT
,

35 
DISKSIM_SSD_ELEMENT_STRIDE
,

36 
DISKSIM_SSD_CHIP_XFER_LATENCY
,

37 
DISKSIM_SSD_PAGE_READ_LATENCY
,

38 
DISKSIM_SSD_PAGE_WRITE_LATENCY
,

39 
DISKSIM_SSD_BLOCK_ERASE_LATENCY
,

42 
DISKSIM_SSD_WRITE_POLICY
,

43 
DISKSIM_SSD_RESERVE_BLOCKS
,

44 
DISKSIM_SSD_MIN_FREEBLKS_PERCENTAGE
,

45 
DISKSIM_SSD_CLEANING_POLICY
,

46 
DISKSIM_SSD_PLANES_PER_PKG
,

47 
DISKSIM_SSD_BLOCKS_PER_PLANE
,

48 
DISKSIM_SSD_PLANE_BLOCK_MAPPING
,

49 
DISKSIM_SSD_COPY_BACK
,

50 
DISKSIM_SSD_NUM_PARALLEL_UNITS
,

51 
DISKSIM_SSD_ELEMENTS_PER_GANG
,

52 
DISKSIM_SSD_CLEANING_IN_BACKGROUND
,

53 
DISKSIM_SSD_GANG_SHARE
,

54 
DISKSIM_SSD_ALLOC_POOL_LOGIC


55 } 
	tdisksim_ssd_∑øm_t
;

58 
	#DISKSIM_SSD_MAX_PARAM
 (
DISKSIM_SSD_ALLOC_POOL_LOGIC
 + 1)

	)

59 * 
DISKSIM_SSD_lﬂdîs
[];

60 
Õ_∑ømdï_t
 
DISKSIM_SSD_dïs
[];

63 
Õ_v¨•ec
 
	gdisksim_ssd_∑øms
 [] = {

64 {"ScheduÀr", 
BLOCK
, 1 },

65 {"Max queuêÀngth", 
I
, 1 },

66 {"Block cou¡", 
I
, 0 },

67 {"Bu†å™ß˘i⁄Ü©ícy", 
D
, 0 },

68 {"Bulk se˘‹Åøns„∏time", 
D
, 1 },

69 {"Nevî disc⁄√˘", 
I
, 1 },

70 {"Pröà°©s", 
I
, 1 },

71 {"Comm™d ovîhód", 
D
, 1 },

72 {"Timög modñ", 
I
, 1 },

73 {"Fœsh chùÉÀmíts", 
I
, 1 },

74 {"Pagêsize", 
I
, 1 },

75 {"Page†≥∏block", 
I
, 1 },

76 {"Block†≥∏ñemít", 
I
, 1 },

77 {"EÀmíà°ridê∑ges", 
I
, 1 },

78 {"Chù x„∏œãncy", 
D
, 1 },

79 {"PagêªadÜ©ícy", 
D
, 1 },

80 {"Pagêwrôêœãncy", 
D
, 1 },

81 {"BlockÉø£Ü©ícy", 
D
, 1 },

84 {"Wrôêpﬁicy", 
I
, 1},

85 {"Re£rvê∑ge†≥r˚¡age", 
I
, 1},

86 {"Möimum fªêblock†≥r˚¡age", 
I
, 1},

87 {"CÀ™ögÖﬁicy", 
I
, 1},

88 {"Pœ√†≥∏∑ckage", 
I
, 1},

89 {"Block†≥∏∂™e", 
I
, 1},

90 {"Pœ√ block m≠pög", 
I
, 1},

91 {"C›y back", 
I
, 1},

92 {"Numbî o‡∑øŒñ unôs", 
I
, 1},

93 {"EÀmít†≥∏g™g", 
I
, 1},

94 {"CÀ™ög i¿background", 
I
, 1},

95 {"G™g sh¨e", 
I
, 1},

96 {"AŒoˇti⁄ÖoﬁÜogic", 
I
, 1},

99 
Õ_mod
 
	gdisksim_ssd_mod
 = { "disksim_ssd", 
disksim_ssd_∑øms
, 
DISKSIM_SSD_MAX_PARAM
, (
Õ_modlﬂdî_t
)
disksim_ssd_lﬂd∑øms
, 0, 0, 
DISKSIM_SSD_lﬂdîs
, 
DISKSIM_SSD_dïs
 };

102 #ifde‡
__˝lu•lus


	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd.c

4 
	~"ssd.h
"

5 
	~"ssd_timög.h
"

6 
	~"ssd_˛ón.h
"

7 
	~"ssd_g™g.h
"

8 
	~"ssd_öô.h
"

9 
	~"moduÀs/ssdmodñ_ssd_∑øm.h
"

11 #i‚de‡
•rötf_s


12 
	#•rötf_s3
(
x
,
y
,
z
Ë
	`•rötf
(x,z)

	)

13 
	#•rötf_s4
(
x
,
y
,
z
,
w
Ë
	`•rötf
(x,z,w)

	)

14 
	#•rötf_s5
(
x
,
y
,
z
,
w
,
s
Ë
	`•rötf
(x,z,w,s)

	)

16 
	#•rötf_s3
(
x
,
y
,
z
Ë
	`•rötf_s
(x,z)

	)

17 
	#•rötf_s4
(
x
,
y
,
z
,
w
Ë
	`•rötf_s
(x,z,w)

	)

18 
	#•rötf_s5
(
x
,
y
,
z
,
w
,
s
Ë
	`•rötf_s
(x,z,w,s)

	)

21 #i‚de‡
_°rdup


22 
	#_°rdup
 
°rdup


	)

25 
ssd_ªque°_com∂ëe
(
i‹eq_evít
 *
cuº
);

26 
ssd_medü_ac˚ss_ªque°
(
i‹eq_evít
 *
cuº
);

28 
	#devi˚nos
 (
disksim
->
devi˚öfo
->
devi˚nos
)

	)

29 
ssd
 *
	$gëssd
 (
devno
)

31 
ssd
 *
s
;

32 
	`ASSERT1
((
devno
 >0Ë&& (devnÿ< 
MAXDEVICES
), "devno", devno);

34 if(
devno
 < 0 || devnÿ>
MAXDEVICES
){

35 
	`Ârötf
(" invÆid devnÿ%d \n", 
devno
);

38 if(
devno
 >
disksim
->
disköfo
->
numdisks
)

39  (
disksim
->
ssdöfo
->
ssds
[
devno
-disksim->
disköfo
->
numdisks
]);

41  
disksim
->
ssdöfo
->
ssds
[
devno
];

42 
	}
}

44 
	$ssd_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
)

46 
ssd_t
 *
cuºdisk
;

47 
˙t
;

49 
cuºdisk
 = 
	`gëssd
 (
devno
);

50 
	`as£π
(
cuºdisk
);

51 
˙t
 = 
cuºdisk
->
numöbu£s
;

52 
cuºdisk
->
numöbu£s
++;

53 i‡((
˙t
 + 1Ë> 
MAXINBUSES
) {

54 
	`Ârötf
(
°dîr
, "Toÿm™y inbu£†•ecifõd f‹ ssd %d - %d\n", 
devno
, (
˙t
+1));

55 
	`exô
(1);

57 
cuºdisk
->
öbu£s
[
˙t
] = 
öbu¢o
;

58 
cuºdisk
->
dïth
[
˙t
] = depth;

59 
cuºdisk
->
¶Ÿno
[
˙t
] = slotno;

61 
	}
}

63 
	$ssd_gë_dïth
 (
devno
)

65 
ssd_t
 *
cuºdisk
;

66 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
devno
]);

67 (
cuºdisk
->
dïth
[0]);

68 
	}
}

70 
	$ssd_gë_¶Ÿno
 (
devno
)

72 
ssd_t
 *
cuºdisk
;

73 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
devno
]);

74 (
cuºdisk
->
¶Ÿno
[0]);

75 
	}
}

77 
	$ssd_gë_öbus
 (
devno
)

79 
ssd_t
 *
cuºdisk
;

80 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
devno
]);

81 (
cuºdisk
->
öbu£s
[0]);

82 
	}
}

84 
	$ssd_gë_maxout°™dög
 (
devno
)

86 
ssd_t
 *
cuºdisk
;

87 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
devno
]);

88 (
cuºdisk
->
maxqÀn
);

89 
	}
}

91 
	$ssd_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
)

93 
ssd_t
 *
cuºdisk
;

94 
tm±ime
;

96 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);

97 
tm±ime
 = 
	`bus_gë_å™s„r_time
(
	`ssd_gë_bu¢o
(
cuº
), 1, (cuº->
Êags
 & 
READ
));

98 i‡(
tm±ime
 < 
cuºdisk
->
blkå™°ime
) {

99 
tm±ime
 = 
cuºdisk
->
blkå™°ime
;

101 (
tm±ime
);

102 
	}
}

104 
	$ssd_gë_bu¢o
 (
i‹eq_evít
 *
cuº
)

106 
ssd_t
 *
cuºdisk
;

107 
ötch¨
 
bu¢o
;

108 
dïth
;

110 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);

111 
bu¢o
.
vÆue
 = 
cuº
->busno;

112 
dïth
 = 
cuºdisk
->depth[0];

113 (
bu¢o
.
byã
[
dïth
]);

114 
	}
}

116 
	$ssd_as£π_cuºít_a˘ivôy
(
ssd_t
 *
cuºdisk
, 
i‹eq_evít
 *
cuº
)

118 
	`as£π
(
cuºdisk
->
ch™√l_a˘ivôy
 !
NULL
 &&

119 
cuºdisk
->
ch™√l_a˘ivôy
->
devno
 =
cuº
->devno &&

120 
cuºdisk
->
ch™√l_a˘ivôy
->
blkno
 =
cuº
->blkno &&

121 
cuºdisk
->
ch™√l_a˘ivôy
->
bcou¡
 =
cuº
->bcount);

122 
	}
}

134 
	$ssd_£nd_evít_up_∑th
 (
i‹eq_evít
 *
cuº
, 
dñay
)

136 
ssd_t
 *
cuºdisk
;

137 
bu¢o
;

138 
¶Ÿno
;

142 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);

144 
	`ssd_as£π_cuºít_a˘ivôy
(
cuºdisk
, 
cuº
);

146 
bu¢o
 = 
	`ssd_gë_bu¢o
(
cuº
);

147 
¶Ÿno
 = 
cuºdisk
->slotno[0];

150 
cuº
->
√xt
 = 
cuºdisk
->
buswaô
;

151 
cuºdisk
->
buswaô
 = 
cuº
;

153 
cuº
->
ãmpöt1
 = 
bu¢o
;

154 
cuº
->
time
 = 
dñay
;

155 i‡(
cuºdisk
->
busow√d
 == -1) {

159 i‡(
cuº
->
√xt
) {

163 i‡(
	`bus_ow√rshù_gë
(
bu¢o
, 
¶Ÿno
, 
cuº
Ë=
FALSE
) {

165 
cuºdisk
->
°©
.
ªque°edbus
 = 
simtime
;

167 
cuºdisk
->
busow√d
 = 
bu¢o
;

168 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
cuº
->
devno
, 
dñay
, curr);

170 } i‡(
cuºdisk
->
busow√d
 =
bu¢o
) {

174 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
cuº
->
devno
, 
dñay
, curr);

176 
	`Ârötf
(
°dîr
, "Wrong bus owned forÅransfer desired\n");

177 
	`exô
(1);

179 
	}
}

192 
	$ssd_check_ch™√l_a˘ivôy
 (
ssd_t
 *
cuºdisk
)

195 
i‹eq_evít
 *
cuº
 = 
cuºdisk
->
com∂ëi⁄_queue
;

196 
cuºdisk
->
ch™√l_a˘ivôy
 = 
cuº
;

197 i‡(
cuº
 !
NULL
) {

198 
cuºdisk
->
com∂ëi⁄_queue
 = 
cuº
->
√xt
;

199 i‡(
cuºdisk
->
√vîdisc⁄√˘
) {

201 i‡(
cuº
->
Êags
 & 
READ
) {

204 
cuº
->
ty≥
 = 
DEVICE_DATA_TRANSFER_COMPLETE
;

205 
	`ssd_£nd_evít_up_∑th
(
cuº
, () 0.0);

207 
	`ssd_ªque°_com∂ëe
 (
cuº
);

211 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

212 
cuº
->
ˇu£
 = 
RECONNECT
;

213 
	`ssd_£nd_evít_up_∑th
 (
cuº
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

214 
cuºdisk
->
ªc⁄√˘_ªas⁄
 = 
DEVICE_ACCESS_COMPLETE
;

217 
cuº
 = 
	`ioqueue_gë_√xt_ªque°
(
cuºdisk
->
queue
);

218 
cuºdisk
->
ch™√l_a˘ivôy
 = 
cuº
;

219 i‡(
cuº
 !
NULL
) {

220 i‡(
cuº
->
Êags
 & 
READ
) {

221 i‡(!
cuºdisk
->
√vîdisc⁄√˘
) {

222 
	`ssd_medü_ac˚ss_ªque°
(
	`i‹eq_c›y
(
cuº
));

223 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

224 
cuº
->
ˇu£
 = 
DISCONNECT
;

225 
	`ssd_£nd_evít_up_∑th
 (
cuº
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

227 
	`ssd_medü_ac˚ss_ªque°
(
cuº
);

231 
cuº
->
ˇu£
 = 
RECONNECT
;

232 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

233 
cuºdisk
->
ªc⁄√˘_ªas⁄
 = 
IO_INTERRUPT_ARRIVE
;

234 
	`ssd_£nd_evít_up_∑th
 (
cuº
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

240 
	}
}

247 
	$ssd_bus_ow√rshù_gø¡
 (
devno
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
)

249 
ssd_t
 *
cuºdisk
;

250 
i‹eq_evít
 *
tmp
;

252 
cuºdisk
 = 
	`gëssd
 (
devno
);

254 
	`ssd_as£π_cuºít_a˘ivôy
(
cuºdisk
, 
cuº
);

255 
tmp
 = 
cuºdisk
->
buswaô
;

256 (
tmp
 !
NULL
Ë&& (tm∞!
cuº
)) {

257 
tmp
 =Åmp->
√xt
;

259 i‡(
tmp
 =
NULL
) {

260 
	`Ârötf
(
°dîr
, "Bu†ow√rshù gø¡edÅÿunknow¿ssdÑeque° - devnÿ%d, bu¢ÿ%d\n", 
devno
, 
bu¢o
);

261 
	`exô
(1);

263 
cuºdisk
->
busow√d
 = 
bu¢o
;

264 
cuºdisk
->
°©
.
waôögf‹bus
 +
¨bdñay
;

266 
cuºdisk
->
°©
.
numbuswaôs
++;

267 
	`bus_dñay
(
bu¢o
, 
DEVICE
, 
devno
, 
tmp
->
time
,Åmp);

268 
	}
}

270 
	$ssd_bus_dñay_com∂ëe
 (
devno
, 
i‹eq_evít
 *
cuº
, 
£¡bu¢o
)

272 
ssd_t
 *
cuºdisk
;

273 
ötch¨
 
¶Ÿno
;

274 
ötch¨
 
bu¢o
;

275 
dïth
;

277 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
devno
]);

278 
	`ssd_as£π_cuºít_a˘ivôy
(
cuºdisk
, 
cuº
);

284 i‡(
cuº
 =
cuºdisk
->
buswaô
) {

285 
cuºdisk
->
buswaô
 = 
cuº
->
√xt
;

287 
i‹eq_evít
 *
tmp
 = 
cuºdisk
->
buswaô
;

288 (
tmp
->
√xt
 !
NULL
Ë&& (tmp->√xà!
cuº
)) {

289 
tmp
 =Åmp->
√xt
;

291 i‡(
tmp
->
√xt
 !
cuº
) {

294 
	`Ârötf
(
°dîr
, "Bu†dñay com∂ëêf‹ unknow¿ssdÑeque° - devnÿ%d, bu¢ÿ%d\n", 
devno
, 
cuº
->
bu¢o
);

295 
	`exô
(1);

297 
tmp
->
√xt
 = 
cuº
->next;

299 
bu¢o
.
vÆue
 = 
cuº
->busno;

300 
¶Ÿno
.
vÆue
 = 
cuº
->slotno;

301 
dïth
 = 
cuºdisk
->depth[0];

302 
¶Ÿno
.
byã
[
dïth
] = slotno.byte[depth] >> 4;

303 
cuº
->
time
 = 0.0;

304 i‡(
dïth
 == 0) {

305 
	`öå_ªque°
 ((
evít
 *)
cuº
);

307 
	`bus_dñivî_evít
(
bu¢o
.
byã
[
dïth
], 
¶Ÿno
.byã[dïth], 
cuº
);

309 
	}
}

315 
	$ssd_ªque°_com∂ëe
(
i‹eq_evít
 *
cuº
)

317 
ssd_t
 *
cuºdisk
;

318 
i‹eq_evít
 *
x
;

322 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);

323 
	`ssd_as£π_cuºít_a˘ivôy
(
cuºdisk
, 
cuº
);

325 i‡((
x
 = 
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
cuºdisk
->
queue
,
cuº
)Ë=
NULL
) {

326 
	`Ârötf
(
°dîr
, "ssd_request_complete: ioreq_eventÇot found by ioqueue_physical_access_done call\n");

327 
	`exô
(1);

331 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

332 
cuº
->
ˇu£
 = 
COMPLETION
;

333 
	`ssd_£nd_evít_up_∑th
(
cuº
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

334 
	}
}

336 
	$ssd_bu°øns„r_com∂ëe
 (
i‹eq_evít
 *
cuº
)

340 i‡(
cuº
->
Êags
 & 
READ
) {

341 
	`ssd_ªque°_com∂ëe
 (
cuº
);

343 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);

344 
	`ssd_as£π_cuºít_a˘ivôy
(
cuºdisk
, 
cuº
);

345 i‡(
cuºdisk
->
√vîdisc⁄√˘
 =
FALSE
) {

347 
i‹eq_evít
 *
tmp
 = 
	`i‹eq_c›y
 (
cuº
);

348 
tmp
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

349 
tmp
->
ˇu£
 = 
DISCONNECT
;

350 
	`ssd_£nd_evít_up_∑th
 (
tmp
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

351 
	`ssd_medü_ac˚ss_ªque°
 (
cuº
);

353 
	`ssd_medü_ac˚ss_ªque°
 (
cuº
);

354 
	`ssd_check_ch™√l_a˘ivôy
 (
cuºdisk
);

357 
	}
}

363 
	$ssd_logiˇl_∑gío
(
blkno
, 
ssd_t
 *
s
)

365 
≠n
;

366 
Õn
;

369 
≠n
 = 
blkno
/
s
->
∑øms
.
∑ge_size
;

377 
Õn
 = ((
≠n
 - (≠¿% (
s
->
∑øms
.
ñemít_°ride_∑ges
 * s->∑øms.
√Àmíts
)))/

378 
s
->
∑øms
.
√Àmíts
Ë+ (
≠n
 % s->∑øms.
ñemít_°ride_∑ges
);

380  
Õn
;

381 
	}
}

383 
	$ssd_Æªady_¥e£¡
(
ssd_ªq
 **
ªqs
, 
tŸÆ
, 
i‹eq_evít
 *
ªq
)

385 
i
;

386 
found
 = 0;

388 
i
 = 0; i < 
tŸÆ
; i ++) {

389 i‡((
ªq
->
blkno
 =
ªqs
[
i
]->
‹g_ªq
->blkno) &&

390 (
ªq
->
Êags
 =
ªqs
[
i
]->
‹g_ªq
->flags)) {

391 
found
 = 1;

396  
found
;

397 
	}
}

399 
	$_ssd_övoke_ñemít_˛ónög
(
ñem_num
, 
ssd_t
 *
s
)

401 
˛ón_co°
 = 
	`ssd_˛ón_ñemít
(
s
, 
ñem_num
);

402  
˛ón_co°
;

403 
	}
}

405 
	$ssd_övoke_ñemít_˛ónög
(
ñem_num
, 
ssd_t
 *
s
)

407 
max_co°
 = 0;

408 
˛ónög_övoked
 = 0;

409 
ssd_ñemít
 *
ñem
 = &
s
->
ñemíts
[
ñem_num
];

412 
	`ASSERT
(
ñem
->
medü_busy
 =
FALSE
);

414 
max_co°
 = 
	`_ssd_övoke_ñemít_˛ónög
(
ñem_num
, 
s
);

419 i‡(
max_co°
 > 0) {

420 
i‹eq_evít
 *
tmp
;

422 
ñem
->
medü_busy
 = 1;

423 
˛ónög_övoked
 = 1;

426 
tmp
 = (
i‹eq_evít
 *)
	`gë‰omexåaq
();

427 
tmp
->
devno
 = 
s
->devno;

428 
tmp
->
time
 = 
simtime
 + 
max_co°
;

429 
tmp
->
blkno
 = 
ñem_num
;

430 
tmp
->
ssd_ñem_num
 = 
ñem_num
;

431 
tmp
->
ty≥
 = 
SSD_CLEAN_ELEMENT
;

432 
tmp
->
Êags
 = 
SSD_CLEAN_ELEMENT
;

433 
tmp
->
bu¢o
 = -1;

434 
tmp
->
bcou¡
 = -1;

435 
	`°©_upd©e
 (&
s
->
°©
.
ac˘ime°©s
, 
max_co°
);

436 
	`addtoötq
 ((
evít
 *)
tmp
);

439 
ñem
->
°©
.
tŸ_˛ón_time
 +
max_co°
;

442  
˛ónög_övoked
;

443 
	}
}

445 
	$ssd_a˘iv©e_ñem
(
ssd_t
 *
cuºdisk
, 
ñem_num
)

447 
i‹eq_evít
 *
ªq
;

448 
ssd_ªq
 **
ªad_ªqs
;

449 
ssd_ªq
 **
wrôe_ªqs
;

450 
i
;

451 
ªad_tŸÆ
 = 0;

452 
wrôe_tŸÆ
 = 0;

453 
schtime
 = 0;

454 
max_ªqs
;

455 
tŸ_ªqs_issued
;

456 
max_time_èkí
 = 0;

459 
ssd_ñemít
 *
ñem
 = &
cuºdisk
->
ñemíts
[
ñem_num
];

462 i‡(
ñem
->
medü_busy
 =
TRUE
) {

466 
	`ASSERT
(
	`ioqueue_gë_ªqout°™dög
(
ñem
->
queue
) == 0);

470 i‡(
cuºdisk
->
∑øms
.
˛ónög_ö_background
) {

473 i‡(
	`ssd_övoke_ñemít_˛ónög
(
ñem_num
, 
cuºdisk
)) {

478 
	`ASSERT
(
ñem
->
mëad©a
.
ªqs_waôög
 =
	`ioqueue_gë_numbî_ö_queue
”Àm->
queue
));

480 i‡(
ñem
->
mëad©a
.
ªqs_waôög
 > 0) {

483 i‡(!
cuºdisk
->
∑øms
.
˛ónög_ö_background
) {

486 i‡(
	`ssd_övoke_ñemít_˛ónög
(
ñem_num
, 
cuºdisk
)) {

492 i‡(
cuºdisk
->
∑øms
.
c›y_back
 =
SSD_COPY_BACK_DISABLE
) {

493 
max_ªqs
 = 1;

495 i‡(
cuºdisk
->
∑øms
.
num_∑runôs
 == 1) {

496 
max_ªqs
 = 1;

498 
max_ªqs
 = 
MAX_REQS_ELEM_QUEUE
;

506 
ªad_ªqs
 = (
ssd_ªq
 **Ë
	`mÆloc
(
max_ªqs
 * (ssd_req *));

507 
wrôe_ªqs
 = (
ssd_ªq
 **Ë
	`mÆloc
(
max_ªqs
 * (ssd_req *));

510 (
ªq
 = 
	`ioqueue_gë_√xt_ªque°
(
ñem
->
queue
)Ë!
NULL
) {

511 
found
 = 0;

513 
ñem
->
mëad©a
.
ªqs_waôög
 --;

518 i‡(
ªq
->
Êags
 & 
READ
) {

519 
found
 = 
	`ssd_Æªady_¥e£¡
(
ªad_ªqs
, 
ªad_tŸÆ
, 
ªq
);

521 
found
 = 
	`ssd_Æªady_¥e£¡
(
wrôe_ªqs
, 
wrôe_tŸÆ
, 
ªq
);

524 i‡(!
found
) {

526 
ssd_ªq
 *
r
 = 
	`mÆloc
((ssd_req));

527 
r
->
blk
 = 
ªq
->
blkno
;

528 
r
->
cou¡
 = 
ªq
->
bcou¡
;

529 
r
->
is_ªad
 = 
ªq
->
Êags
 & 
READ
;

530 
r
->
‹g_ªq
 = 
ªq
;

531 
r
->
∂™e_num
 = -1;

533 i‡(
ªq
->
Êags
 & 
READ
) {

534 
ªad_ªqs
[
ªad_tŸÆ
] = 
r
;

535 
ªad_tŸÆ
 ++;

537 
wrôe_ªqs
[
wrôe_tŸÆ
] = 
r
;

538 
wrôe_tŸÆ
 ++;

542 i‡((
ªad_tŸÆ
 >
max_ªqs
) ||

543 (
wrôe_tŸÆ
 >
max_ªqs
)) {

548 
	`°©_upd©e
 (&
cuºdisk
->
°©
.
ac˘ime°©s
, 0);

549 
ªq
->
time
 = 
simtime
;

550 
ªq
->
ssd_ñem_num
 = 
ñem_num
;

551 
ªq
->
ty≥
 = 
DEVICE_ACCESS_COMPLETE
;

552 
	`addtoötq
 ((
evít
 *)
ªq
);

556 i‡(
ªad_tŸÆ
 > 0) {

560 
	`ssd_compuã_ac˚ss_time
(
cuºdisk
, 
ñem_num
, 
ªad_ªqs
, 
ªad_tŸÆ
);

563 
i
 = 0; i < 
ªad_tŸÆ
; i ++) {

564 
ñem
->
medü_busy
 = 
TRUE
;

567 i‡(
schtime
 < 
ªad_ªqs
[
i
]->schtime) {

568 
schtime
 = 
ªad_ªqs
[
i
]->schtime;

571 
	`°©_upd©e
 (&
cuºdisk
->
°©
.
ac˘ime°©s
, 
ªad_ªqs
[
i
]->
ac˘ime
);

572 
ªad_ªqs
[
i
]->
‹g_ªq
->
time
 = 
simtime
 +Ñód_ªqs[i]->
schtime
;

573 
ªad_ªqs
[
i
]->
‹g_ªq
->
ssd_ñem_num
 = 
ñem_num
;

574 
ªad_ªqs
[
i
]->
‹g_ªq
->
ty≥
 = 
DEVICE_ACCESS_COMPLETE
;

579 
	`addtoötq
 ((
evít
 *)
ªad_ªqs
[
i
]->
‹g_ªq
);

580 
	`‰ì
(
ªad_ªqs
[
i
]);

584 
	`‰ì
(
ªad_ªqs
);

586 
max_time_èkí
 = 
schtime
;

588 i‡(
wrôe_tŸÆ
 > 0) {

590 
	`ssd_compuã_ac˚ss_time
(
cuºdisk
, 
ñem_num
, 
wrôe_ªqs
, 
wrôe_tŸÆ
);

595 
i
 = 0; i < 
wrôe_tŸÆ
; i ++) {

596 
ñem
->
medü_busy
 = 
TRUE
;

598 
	`°©_upd©e
 (&
cuºdisk
->
°©
.
ac˘ime°©s
, 
wrôe_ªqs
[
i
]->
ac˘ime
);

599 
wrôe_ªqs
[
i
]->
‹g_ªq
->
time
 = 
simtime
 + 
schtime
 + write_reqs[i]->schtime;

602 i‡(
max_time_èkí
 < (
schtime
+
wrôe_ªqs
[
i
]->schtime)) {

603 
max_time_èkí
 = (
schtime
+
wrôe_ªqs
[
i
]->schtime);

606 
wrôe_ªqs
[
i
]->
‹g_ªq
->
ssd_ñem_num
 = 
ñem_num
;

607 
wrôe_ªqs
[
i
]->
‹g_ªq
->
ty≥
 = 
DEVICE_ACCESS_COMPLETE
;

611 
	`addtoötq
 ((
evít
 *)
wrôe_ªqs
[
i
]->
‹g_ªq
);

612 
	`‰ì
(
wrôe_ªqs
[
i
]);

616 
	`‰ì
(
wrôe_ªqs
);

619 
tŸ_ªqs_issued
 = 
ªad_tŸÆ
 + 
wrôe_tŸÆ
;

620 
	`ASSERT
(
tŸ_ªqs_issued
 > 0);

621 
cuºdisk
->
ñemíts
[
ñem_num
].
°©
.
tŸ_ªqs_issued
 +=Åot_reqs_issued;

622 
cuºdisk
->
ñemíts
[
ñem_num
].
°©
.
tŸ_time_èkí
 +
max_time_èkí
;

624 
	}
}

627 
	$ssd_medü_ac˚ss_ªque°_ñemít
 (
i‹eq_evít
 *
cuº
)

629 
ssd_t
 *
cuºdisk
 = 
	`gëssd
(
devi˚nos
[
cuº
->
devno
]);

630 
blkno
 = 
cuº
->blkno;

631 
cou¡
 = 
cuº
->
bcou¡
;

634 
cuº
->
ãmpöt2
 = 
cou¡
;

635 
cou¡
 != 0) {

638 
ñem_num
 = 
cuºdisk
->
timög_t
->
	`choo£_ñemít
(cuºdisk->timög_t, 
blkno
);

639 
ssd_ñemít
 *
ñem
 = &
cuºdisk
->
ñemíts
[
ñem_num
];

642 
i‹eq_evít
 *
tmp
 = (i‹eq_evíà*)
	`gë‰omexåaq
();

643 
tmp
->
devno
 = 
cuº
->devno;

644 
tmp
->
bu¢o
 = 
cuº
->busno;

645 
tmp
->
Êags
 = 
cuº
->flags;

646 
tmp
->
blkno
 = blkno;

647 
tmp
->
bcou¡
 = 
	`ssd_choo£_Æig√d_cou¡
(
cuºdisk
->
∑øms
.
∑ge_size
, 
blkno
, 
cou¡
);

648 
	`ASSERT
(
tmp
->
bcou¡
 =
cuºdisk
->
∑øms
.
∑ge_size
);

650 
tmp
->
ãmµå2
 = 
cuº
;

651 
blkno
 +
tmp
->
bcou¡
;

652 
cou¡
 -
tmp
->
bcou¡
;

654 
ñem
->
mëad©a
.
ªqs_waôög
 ++;

657 
	`ioqueue_add_√w_ªque°
(
ñem
->
queue
, (
i‹eq_evít
 *)
tmp
);

658 
	`ssd_a˘iv©e_ñem
(
cuºdisk
, 
ñem_num
);

660 
	}
}

662 
	$ssd_medü_ac˚ss_ªque°
 (
i‹eq_evít
 *
cuº
)

664 
ssd_t
 *
cuºdisk
 = 
	`gëssd
(
devi˚nos
[
cuº
->
devno
]);

666 
cuºdisk
->
∑øms
.
Æloc_poﬁ_logic
) {

667 
SSD_ALLOC_POOL_PLANE
:

668 
SSD_ALLOC_POOL_CHIP
:

669 
	`ssd_medü_ac˚ss_ªque°_ñemít
(
cuº
);

672 
SSD_ALLOC_POOL_GANG
:

673 #i‡
SYNC_GANG


674 
	`ssd_medü_ac˚ss_ªque°_g™g_sync
(
cuº
);

676 
	`ssd_medü_ac˚ss_ªque°_g™g
(
cuº
);

681 
	`¥ötf
("Unknow¿Ælo¯poﬁÜogi¯%d\n", 
cuºdisk
->
∑øms
.
Æloc_poﬁ_logic
);

682 
	`ASSERT
(0);

684 
	}
}

686 
	$ssd_ªc⁄√˘_d⁄e
 (
i‹eq_evít
 *
cuº
)

688 
ssd_t
 *
cuºdisk
;

692 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);

693 
	`ssd_as£π_cuºít_a˘ivôy
(
cuºdisk
, 
cuº
);

695 i‡(
cuº
->
Êags
 & 
READ
) {

696 i‡(
cuºdisk
->
√vîdisc⁄√˘
) {

699 
	`addt€xåaq
((
evít
 *Ë
cuº
);

700 
	`ssd_check_ch™√l_a˘ivôy
 (
cuºdisk
);

704 
cuº
->
ty≥
 = 
DEVICE_DATA_TRANSFER_COMPLETE
;

705 
	`ssd_£nd_evít_up_∑th
(
cuº
, () 0.0);

709 i‡(
cuºdisk
->
ªc⁄√˘_ªas⁄
 =
DEVICE_ACCESS_COMPLETE
) {

710 
	`ssd_ªque°_com∂ëe
 (
cuº
);

715 
cuº
->
ty≥
 = 
DEVICE_DATA_TRANSFER_COMPLETE
;

716 
	`ssd_£nd_evít_up_∑th
(
cuº
, () 0.0);

719 
	}
}

721 
	$ssd_ªque°_¨rive
 (
i‹eq_evít
 *
cuº
)

723 
ssd_t
 *
cuºdisk
;

728 
cuºdisk
 = 
	`gëssd
(
devi˚nos
[
cuº
->
devno
]);

731 i‡((
cuº
->
blkno
 < 0Ë|| (cuº->
bcou¡
 <= 0) ||

732 ((
cuº
->
blkno
 + cuº->
bcou¡
Ë> 
cuºdisk
->
numblocks
)) {

733 
	`Ârötf
(
°dîr
, "InvÆid së o‡block†ªque°ed from ssd - blknÿ%d, bcou¡ %d,Çumblock†%d\n", 
cuº
->
blkno
, cuº->
bcou¡
, 
cuºdisk
->
numblocks
);

734 
	`exô
(1);

738 
	`ioqueue_add_√w_ªque°
(
cuºdisk
->
queue
, 
cuº
);

739 i‡(
cuºdisk
->
ch™√l_a˘ivôy
 =
NULL
) {

741 
cuº
 = 
	`ioqueue_gë_√xt_ªque°
(
cuºdisk
->
queue
);

742 
cuºdisk
->
busow√d
 = 
	`ssd_gë_bu¢o
(
cuº
);

743 
cuºdisk
->
ch™√l_a˘ivôy
 = 
cuº
;

744 
cuºdisk
->
ªc⁄√˘_ªas⁄
 = 
IO_INTERRUPT_ARRIVE
;

746 i‡(
cuº
->
Êags
 & 
READ
) {

747 i‡(!
cuºdisk
->
√vîdisc⁄√˘
) {

748 
	`ssd_medü_ac˚ss_ªque°
 (
	`i‹eq_c›y
(
cuº
));

749 
cuº
->
ˇu£
 = 
DISCONNECT
;

750 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

751 
	`ssd_£nd_evít_up_∑th
(
cuº
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

753 
	`ssd_medü_ac˚ss_ªque°
 (
cuº
);

754 
	`ssd_check_ch™√l_a˘ivôy
(
cuºdisk
);

757 
cuº
->
ˇu£
 = 
READY_TO_TRANSFER
;

758 
cuº
->
ty≥
 = 
IO_INTERRUPT_ARRIVE
;

759 
	`ssd_£nd_evít_up_∑th
(
cuº
, 
cuºdisk
->
bus_å™ß˘i⁄_œãncy
);

762 
	}
}

767 
	$ssd_˛ón_ñemít_com∂ëe
(
i‹eq_evít
 *
cuº
)

769 
ssd_t
 *
cuºdisk
;

770 
ñem_num
;

772 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);

773 
ñem_num
 = 
cuº
->
ssd_ñem_num
;

774 
	`ASSERT
(
cuºdisk
->
ñemíts
[
ñem_num
].
medü_busy
 =
TRUE
);

777 
	`addt€xåaq
((
evít
 *Ë
cuº
);

780 
cuºdisk
->
ñemíts
[
ñem_num
].
medü_busy
 = 0;

781 
	`ssd_a˘iv©e_ñem
(
cuºdisk
, 
ñem_num
);

782 
	}
}

784 
	$ssd_com∂ëe_∑ª¡
(
i‹eq_evít
 *
cuº
, 
ssd_t
 *
cuºdisk
)

786 
i‹eq_evít
 *
∑ª¡
;

789 
∑ª¡
 = 
cuº
->
ãmµå2
;

790 
∑ª¡
->
ãmpöt2
 -
cuº
->
bcou¡
;

792 i‡(
∑ª¡
->
ãmpöt2
 == 0) {

793 
i‹eq_evít
 *
¥ev
;

795 
	`as£π
(
∑ª¡
 !
cuºdisk
->
ch™√l_a˘ivôy
);

796 
¥ev
 = 
cuºdisk
->
com∂ëi⁄_queue
;

797 i‡(
¥ev
 =
NULL
) {

798 
cuºdisk
->
com∂ëi⁄_queue
 = 
∑ª¡
;

799 
∑ª¡
->
√xt
 = 
¥ev
;

801 
¥ev
->
√xt
 !
NULL
)

802 
¥ev
 =Öªv->
√xt
;

803 
∑ª¡
->
√xt
 = 
¥ev
->next;

804 
¥ev
->
√xt
 = 
∑ª¡
;

806 i‡(
cuºdisk
->
ch™√l_a˘ivôy
 =
NULL
) {

807 
	`ssd_check_ch™√l_a˘ivôy
 (
cuºdisk
);

810 
	}
}

812 
	$ssd_ac˚ss_com∂ëe_ñemít
(
i‹eq_evít
 *
cuº
)

814 
ssd_t
 *
cuºdisk
;

815 
ñem_num
;

816 
ssd_ñemít
 *
ñem
;

817 
i‹eq_evít
 *
x
;

819 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);

820 
ñem_num
 = 
cuºdisk
->
timög_t
->
	`choo£_ñemít
(cuºdisk->timög_t, 
cuº
->
blkno
);

821 
	`ASSERT
(
ñem_num
 =
cuº
->
ssd_ñem_num
);

822 
ñem
 = &
cuºdisk
->
ñemíts
[
ñem_num
];

824 i‡((
x
 = 
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
ñem
->
queue
,
cuº
)Ë=
NULL
) {

825 
	`Ârötf
(
°dîr
, "ssd_access_complete: ioreq_eventÇot found by ioqueue_physical_access_done call\n");

826 
	`exô
(1);

830 i‡(
	`ioqueue_gë_ªqout°™dög
(
ñem
->
queue
) == 0) {

831 
ñem
->
medü_busy
 = 
FALSE
;

834 
	`ssd_com∂ëe_∑ª¡
(
cuº
, 
cuºdisk
);

835 
	`addt€xåaq
((
evít
 *Ë
cuº
);

836 
	`ssd_a˘iv©e_ñem
(
cuºdisk
, 
ñem_num
);

837 
	}
}

839 
	$ssd_ac˚ss_com∂ëe
(
i‹eq_evít
 *
cuº
)

841 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);;

843 
cuºdisk
->
∑øms
.
Æloc_poﬁ_logic
) {

844 
SSD_ALLOC_POOL_PLANE
:

845 
SSD_ALLOC_POOL_CHIP
:

846 
	`ssd_ac˚ss_com∂ëe_ñemít
(
cuº
);

849 
SSD_ALLOC_POOL_GANG
:

850 #i‡
SYNC_GANG


851 
	`ssd_ac˚ss_com∂ëe_g™g_sync
(
cuº
);

853 
	`ssd_ac˚ss_com∂ëe_g™g
(
cuº
);

858 
	`¥ötf
("Unknow¿Ælo¯poﬁÜogi¯%d\n", 
cuºdisk
->
∑øms
.
Æloc_poﬁ_logic
);

859 
	`ASSERT
(0);

861 
	}
}

864 
	$ssd_disc⁄√˘_d⁄e
 (
i‹eq_evít
 *
cuº
)

866 
ssd_t
 *
cuºdisk
;

868 
cuºdisk
 = 
	`gëssd
 (
cuº
->
devno
);

869 
	`ssd_as£π_cuºít_a˘ivôy
(
cuºdisk
, 
cuº
);

873 
	`addt€xåaq
((
evít
 *Ë
cuº
);

875 i‡(
cuºdisk
->
busow√d
 != -1) {

876 
	`bus_ow√rshù_ªÀa£
(
cuºdisk
->
busow√d
);

877 
cuºdisk
->
busow√d
 = -1;

879 
	`ssd_check_ch™√l_a˘ivôy
 (
cuºdisk
);

880 
	}
}

883 
	$ssd_com∂ëi⁄_d⁄e
 (
i‹eq_evít
 *
cuº
)

885 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);

886 
	`ssd_as£π_cuºít_a˘ivôy
(
cuºdisk
, 
cuº
);

890 
	`addt€xåaq
((
evít
 *Ë
cuº
);

892 i‡(
cuºdisk
->
busow√d
 != -1) {

893 
	`bus_ow√rshù_ªÀa£
(
cuºdisk
->
busow√d
);

894 
cuºdisk
->
busow√d
 = -1;

897 
	`ssd_check_ch™√l_a˘ivôy
 (
cuºdisk
);

898 
	}
}

900 
	$ssd_öãºu±_com∂ëe
 (
i‹eq_evít
 *
cuº
)

904 
cuº
->
ˇu£
) {

906 
RECONNECT
:

907 
	`ssd_ªc⁄√˘_d⁄e
(
cuº
);

910 
DISCONNECT
:

911 
	`ssd_disc⁄√˘_d⁄e
(
cuº
);

914 
COMPLETION
:

915 
	`ssd_com∂ëi⁄_d⁄e
(
cuº
);

919 
	`ddbg_as£π2
(0, "badÉventÅype");

921 
	}
}

924 
	$ssd_evít_¨rive
 (
i‹eq_evít
 *
cuº
)

926 
ssd_t
 *
cuºdisk
;

931 
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
cuº
->
devno
]);

933 
cuº
->
ty≥
) {

935 
IO_ACCESS_ARRIVE
:

936 
cuº
->
time
 = 
simtime
 + 
cuºdisk
->
ovîhód
;

937 
cuº
->
ty≥
 = 
DEVICE_OVERHEAD_COMPLETE
;

938 
	`addtoötq
((
evít
 *Ë
cuº
);

941 
DEVICE_OVERHEAD_COMPLETE
:

942 
	`ssd_ªque°_¨rive
(
cuº
);

945 
DEVICE_ACCESS_COMPLETE
:

946 
	`ssd_ac˚ss_com∂ëe
 (
cuº
);

949 
DEVICE_DATA_TRANSFER_COMPLETE
:

950 
	`ssd_bu°øns„r_com∂ëe
(
cuº
);

953 
IO_INTERRUPT_COMPLETE
:

954 
	`ssd_öãºu±_com∂ëe
(
cuº
);

957 
IO_QLEN_MAXCHECK
:

959 
cuº
->
ãmpöt1
 = -1;

960 
cuº
->
ãmpöt2
 = 
	`ssd_gë_maxout°™dög
(cuº->
devno
);

961 
cuº
->
bcou¡
 = 0;

964 
SSD_CLEAN_GANG
:

965 
	`ssd_˛ón_g™g_com∂ëe
(
cuº
);

968 
SSD_CLEAN_ELEMENT
:

969 
	`ssd_˛ón_ñemít_com∂ëe
(
cuº
);

973 
	`Ârötf
(
°dîr
, "UnrecognizedÉventÅypeát ssd_event_arrive\n");

974 
	`exô
(1);

978 
	}
}

981 
	$ssd_gë_numbî_of_blocks
 (
devno
)

983 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
devno
]);

984  (
cuºdisk
->
numblocks
);

985 
	}
}

988 
	$ssd_gë_numcyls
 (
devno
)

990 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
devno
);

991  (
cuºdisk
->
numblocks
);

992 
	}
}

995 
	$ssd_gë_m≠pög
 (
m≠ty≥
, 
devno
, 
blkno
, *
cyÕå
, *
surÁ˚±r
, *
blk±r
)

997 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
devno
]);

999 i‡((
blkno
 < 0Ë|| (blknÿ>
cuºdisk
->
numblocks
)) {

1000 
	`Ârötf
(
°dîr
, "InvÆid blknÿ© ssd_gë_m≠pög: %d\n", 
blkno
);

1001 
	`exô
(1);

1004 i‡(
cyÕå
) {

1005 *
cyÕå
 = 
blkno
;

1007 i‡(
surÁ˚±r
) {

1008 *
surÁ˚±r
 = 0;

1010 i‡(
blk±r
) {

1011 *
blk±r
 = 0;

1013 
	}
}

1016 
	$ssd_gë_avg_£˘≥rcyl
 (
devno
)

1019 
	}
}

1022 
	$ssd_gë_di°™˚
 (
devno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
)

1026 
	}
}

1030 
	$ssd_gë_£rvtime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
)

1032 
	`Ârötf
(
°dîr
, "devi˚_gë_£ektimênŸ suµ‹ãd f‹ ssd devnÿ%d\n", 
devno
);

1033 
	`as£π
(0);

1035 
	}
}

1039 
	$ssd_gë_ac˘ime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
maxtime
)

1041 
	`Ârötf
(
°dîr
, "devi˚_gë_£ektimênŸ suµ‹ãd f‹ ssd devnÿ%d\n", 
devno
);

1042 
	`as£π
(0);

1044 
	}
}

1047 
	$ssd_gë_numdisks
 ()

1049 (
numssds
);

1050 
	}
}

1053 
	$ssd_˛ón°©s
 ()

1055 
i
, 
j
;

1057 
i
=0; i<
MAXDEVICES
; i++) {

1058 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
i
);

1059 i‡(
cuºdisk
) {

1060 
	`ioqueue_˛ón°©s
(
cuºdisk
->
queue
);

1061 
j
=0; j<
cuºdisk
->
∑øms
.
√Àmíts
; j++)

1062 
	`ioqueue_˛ón°©s
(
cuºdisk
->
ñemíts
[
j
].
queue
);

1065 
	}
}

1067 
	$ssd_£tˇŒbacks
 ()

1069 
	`ioqueue_£tˇŒbacks
();

1070 
	}
}

1072 
	$ssd_add
(
ssd
 *
d
) {

1073 
c
;

1075 if(!
disksim
->
ssdöfo
Ë
	`ssd_öôülize_disköfo
();

1077 
c
 = 0; c < 
disksim
->
ssdöfo
->
ssds_Àn
; c++) {

1078 if(!
disksim
->
ssdöfo
->
ssds
[
c
]) {

1079 
disksim
->
ssdöfo
->
ssds
[
c
] = 
d
;

1080 
numssds
++;

1081  
c
;

1086 
disksim
->
ssdöfo
->
ssds
 =

1087 
	`ªÆloc
(
disksim
->
ssdöfo
->
ssds
,

1088 2 * 
c
 * (
ssd
 *));

1090 
	`bzîo
(
disksim
->
ssdöfo
->
ssds
 + 
numssds
,

1091 
numssds
);

1093 
disksim
->
ssdöfo
->
ssds
[
c
] = 
d
;

1094 
numssds
++;

1095 
disksim
->
ssdöfo
->
ssds_Àn
 *= 2;

1096  
c
;

1097 
	}
}

1100 
ssd
 *
	$ssdmodñ_ssd_lﬂd∑øms
(
Õ_block
 *
b
, *
num
)

1103 
n
;

1104 
ssd
 *
ªsu…
;

1106 if(!
disksim
->
ssdöfo
Ë
	`ssd_öôülize_disköfo
();

1108 
ªsu…
 = 
	`mÆloc
((
ssd
));

1109 if(!
ªsu…
)  0;

1110 
	`bzîo
(
ªsu…
, (
ssd
));

1112 
n
 = 
	`ssd_add
(
ªsu…
);

1114 
ªsu…
->
hdr
 = 
ssd_hdr_öôülizî
;

1115 if(
b
->
«me
)

1116 
ªsu…
->
hdr
.
devi˚_«me
 = 
	`_°rdup
(
b
->
«me
);

1118 
	`Õ_lﬂd∑øms
(
ªsu…
, 
b
, &
ssdmodñ_ssd_mod
);

1120 
	`devi˚_add
((
devi˚_hódî
 *)
ªsu…
,
disksim
->
disköfo
->
numdisks
+
n
);

1122 i‡(
num
 !
NULL
)

1123 *
num
 = 
n
;

1124  
ªsu…
;

1125 
	}
}

1128 
ssd
 *
	$ssd_c›y
(
ssd
 *
‹ig
) {

1129 
i
;

1130 
ssd
 *
ªsu…
 = 
	`mÆloc
((ssd));

1131 
	`bzîo
(
ªsu…
, (
ssd
));

1132 
	`mem˝y
(
ªsu…
, 
‹ig
, (
ssd
));

1133 
ªsu…
->
queue
 = 
	`ioqueue_c›y
(
‹ig
->queue);

1134 
i
=0;i<
‹ig
->
∑øms
.
√Àmíts
;i++)

1135 
ªsu…
->
ñemíts
[
i
].
queue
 = 
	`ioqueue_c›y
(
‹ig
->elements[i].queue);

1136  
ªsu…
;

1137 
	}
}

1139 
	$ssd_£t_sync£t
 (
£t°¨t
, 
£ãnd
)

1141 
	}
}

1144 
	$ssd_ac˘ime_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

1146 
i
;

1147 
°©gí
 * 
°©£t
[
MAXDEVICES
];

1149 i‡(
devi˚_¥öèc˘ime°©s
) {

1150 
i
=0; i<
£tsize
; i++) {

1151 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
£t
[
i
]]);

1152 
°©£t
[
i
] = &
cuºdisk
->
°©
.
ac˘ime°©s
;

1154 
	`°©_¥öt_£t
(
°©£t
, 
£tsize
, 
¥efix
);

1156 
	}
}

1159 
	$ssd_Ÿhî_¥öt°©s
 (*
£t
, 
£tsize
, *
¥efix
)

1161 
i
;

1162 
numbuswaôs
 = 0;

1163 
waôögf‹bus
 = 0.0;

1165 
i
=0; i<
£tsize
; i++) {

1166 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
£t
[
i
]]);

1167 
numbuswaôs
 +
cuºdisk
->
°©
.numbuswaits;

1168 
waôögf‹bus
 +
cuºdisk
->
°©
.waitingforbus;

1171 
	`Ârötf
(
ouçutfûe
, "%sTŸÆ bu†waôÅime: %f\n", 
¥efix
, 
waôögf‹bus
);

1172 
	`Ârötf
(
ouçutfûe
, "%sNumbî o‡bu†waôs: %d\n", 
¥efix
, 
numbuswaôs
);

1173 
	}
}

1175 
	$ssd_¥öt_block_li„time_di°ributi⁄
(
ñem_num
, 
ssd_t
 *
s
, 
ssdno
, 
avg_li„time
, *
sour˚°r
)

1177 c⁄° 
buckë_size
 = 20;

1178 
no_buckës
 = (100/
buckë_size
 + 1);

1179 
i
;

1180 *
hi°
;

1181 
dód_blocks
 = 0;

1182 
n
;

1183 
sum
;

1184 
sum_sqr
;

1185 
món
;

1186 
v¨ün˚
;

1187 
ssd_ñemít_mëad©a
 *
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

1190 
hi°
 = (*Ë
	`mÆloc
(
no_buckës
 * ());

1191 
	`mem£t
(
hi°
, 0, 
no_buckës
 * ());

1194 
n
 = 
s
->
∑øms
.
blocks_≥r_ñemít
;

1195 
sum
 = 0;

1196 
sum_sqr
 = 0;

1198 
i
 = 0; i < 
s
->
∑øms
.
blocks_≥r_ñemít
; i ++) {

1199 
buckë
;

1200 
ªm_li„time
 = 
mëad©a
->
block_ußge
[
i
].rem_lifetime;

1201 
≥rc
 = (
ªm_li„time
 * 100.0Ë/ 
avg_li„time
;

1204 i‡(
mëad©a
->
block_ußge
[
i
].
ªm_li„time
 == 0) {

1205 
dód_blocks
 ++;

1208 i‡(
≥rc
 >= 100) {

1213 
buckë
 = 
no_buckës
 - 1;

1215 
buckë
 = (Ë
≥rc
 / 
buckë_size
;

1218 
hi°
[
buckë
] ++;

1221 
sum
 = sum + 
ªm_li„time
;

1222 
sum_sqr
 = sum_sq∏+ (
ªm_li„time
*rem_lifetime);

1226 
	`Ârötf
(
ouçutfûe
, "%†#%dÉÀm #%d ", 
sour˚°r
, 
ssdno
, 
ñem_num
);

1227 
	`Ârötf
(
ouçutfûe
, "Block Lifetime Distribution\n");

1230 
	`Ârötf
(
ouçutfûe
, "%†#%dÉÀm #%d ", 
sour˚°r
, 
ssdno
, 
ñem_num
);

1231 
i
 = 
buckë_size
; i <= 100; i += bucket_size) {

1232 
	`Ârötf
(
ouçutfûe
, "< %d\t", 
i
);

1234 
	`Ârötf
(
ouçutfûe
, ">= 100\t\n");

1237 
	`Ârötf
(
ouçutfûe
, "%†#%dÉÀm #%d ", 
sour˚°r
, 
ssdno
, 
ñem_num
);

1238 
i
 = 
buckë_size
; i <= 100; i += bucket_size) {

1239 
	`Ârötf
(
ouçutfûe
, "%d\t", 
hi°
[
i
/
buckë_size
 - 1]);

1241 
	`Ârötf
(
ouçutfûe
, "%d\t\n", 
hi°
[
no_buckës
 - 1]);

1243 
món
 = 
sum
/
n
;

1244 
v¨ün˚
 = (
sum_sqr
 - 
sum
*
món
)/(
n
 - 1);

1245 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Average ofÜifeÅime:\t%f\n",

1246 
sour˚°r
, 
ssdno
, 
ñem_num
, 
món
);

1247 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Variance ofÜifeÅime:\t%f\n",

1248 
sour˚°r
, 
ssdno
, 
ñem_num
, 
v¨ün˚
);

1249 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Total dead blocks:\t%d\n",

1250 
sour˚°r
, 
ssdno
, 
ñem_num
, 
dód_blocks
);

1251 
	}
}

1254 
	$ssd_¥öt˛ón°©s
(*
£t
, 
£tsize
, *
sour˚°r
)

1256 
i
;

1257 
tŸ_ssd
 = 0;

1258 
ñts_cou¡
 = 0;

1259 
i›s
 = 0;

1261 
	`Ârötf
(
ouçutfûe
, "\n\nSSD CLEANING STATISTICS\n");

1262 
	`Ârötf
(
ouçutfûe
, "---------------------------------------------\n\n");

1263 
i
 = 0; i < 
£tsize
; i ++) {

1264 
j
;

1265 
tŸ_ñts
 = 0;

1266 
ssd_t
 *
s
 = 
	`gëssd
(
devi˚nos
[
£t
[
i
]]);

1268 i‡(
s
->
∑øms
.
wrôe_pﬁicy
 =
DISKSIM_SSD_WRITE_POLICY_OSR
) {

1270 
ñts_cou¡
 +
s
->
∑øms
.
√Àmíts
;

1272 
j
 = 0; j < 
s
->
∑øms
.
√Àmíts
; j ++) {

1273 
∂™e_num
;

1274 
avg_li„time
;

1275 
ñem_i›s
 = 0;

1276 
ñem_˛ón_i›s
 = 0;

1278 
ssd_ñemít_°©
 *
°©
 = &(
s
->
ñemíts
[
j
].stat);

1280 
avg_li„time
 = 
	`ssd_compuã_avg_li„time
(-1, 
j
, 
s
);

1282 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d TotalÑeqs issued:\t%d\n",

1283 
sour˚°r
, 
£t
[
i
], 
j
, 
s
->
ñemíts
[j].
°©
.
tŸ_ªqs_issued
);

1284 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d TotalÅimeÅaken:\t%f\n",

1285 
sour˚°r
, 
£t
[
i
], 
j
, 
s
->
ñemíts
[j].
°©
.
tŸ_time_èkí
);

1286 i‡(
s
->
ñemíts
[
j
].
°©
.
tŸ_time_èkí
 > 0) {

1287 
ñem_i›s
 = ((
s
->
ñemíts
[
j
].
°©
.
tŸ_ªqs_issued
*1000.0)/s->ñemíts[j].°©.
tŸ_time_èkí
);

1288 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d IOPS:\t%f\n",

1289 
sour˚°r
, 
£t
[
i
], 
j
, 
ñem_i›s
);

1292 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Total cleaningÑeqs issued:\t%d\n",

1293 
sour˚°r
, 
£t
[
i
], 
j
, 
s
->
ñemíts
[j].
°©
.
num_˛ón
);

1294 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Total cleaningÅimeÅaken:\t%f\n",

1295 
sour˚°r
, 
£t
[
i
], 
j
, 
s
->
ñemíts
[j].
°©
.
tŸ_˛ón_time
);

1296 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Total migrations:\t%d\n",

1297 
sour˚°r
, 
£t
[
i
], 
j
, 
s
->
ñemíts
[j].
mëad©a
.
tŸ_migøti⁄s
);

1298 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d TotalÖages migrated:\t%d\n",

1299 
sour˚°r
, 
£t
[
i
], 
j
, 
s
->
ñemíts
[j].
mëad©a
.
tŸ_pgs_migøãd
);

1300 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Total migrations cost:\t%f\n",

1301 
sour˚°r
, 
£t
[
i
], 
j
, 
s
->
ñemíts
[j].
mëad©a
.
mig_co°
);

1304 i‡(
s
->
ñemíts
[
j
].
°©
.
tŸ_˛ón_time
 > 0) {

1305 
ñem_˛ón_i›s
 = ((
s
->
ñemíts
[
j
].
°©
.
num_˛ón
*1000.0)/s->ñemíts[j].°©.
tŸ_˛ón_time
);

1306 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d clean IOPS:\t%f\n",

1307 
sour˚°r
, 
£t
[
i
], 
j
, 
ñem_˛ón_i›s
);

1310 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Overall IOPS:\t%f\n",

1311 
sour˚°r
, 
£t
[
i
], 
j
, ((
s
->
ñemíts
[j].
°©
.
num_˛ón
+s->ñemíts[j].°©.
tŸ_ªqs_issued
)*1000.0)/(s->ñemíts[j].°©.
tŸ_˛ón_time
+s->ñemíts[j].°©.
tŸ_time_èkí
));

1313 
i›s
 +
ñem_i›s
;

1315 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Number of free blocks:\t%d\n",

1316 
sour˚°r
, 
£t
[
i
], 
j
, 
s
->
ñemíts
[j].
mëad©a
.
tŸ_‰ì_blocks
);

1317 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Number of cleans:\t%d\n",

1318 
sour˚°r
, 
£t
[
i
], 
j
, 
°©
->
num_˛ón
);

1319 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Pages moved:\t%d\n",

1320 
sour˚°r
, 
£t
[
i
], 
j
, 
°©
->
∑ges_moved
);

1321 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Total xferÅime:\t%f\n",

1322 
sour˚°r
, 
£t
[
i
], 
j
, 
°©
->
tŸ_x„r_co°
);

1323 i‡(
°©
->
tŸ_x„r_co°
 > 0) {

1324 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d XferÅimeÖerÖage:\t%f\n",

1325 
sour˚°r
, 
£t
[
i
], 
j
, 
°©
->
tŸ_x„r_co°
/(1.0*°©->
∑ges_moved
));

1327 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d XferÅimeÖerÖage:\t0\n",

1328 
sour˚°r
, 
£t
[
i
], 
j
);

1330 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d AverageÜifetime:\t%f\n",

1331 
sour˚°r
, 
£t
[
i
], 
j
, 
avg_li„time
);

1332 
	`Ârötf
(
ouçutfûe
, "%s #%dÉlem #%d Plane Level Statistics\n",

1333 
sour˚°r
, 
£t
[
i
], 
j
);

1334 
	`Ârötf
(
ouçutfûe
, "%†#%dÉÀm #%d ", 
sour˚°r
, 
£t
[
i
], 
j
);

1335 
∂™e_num
 = 0;Öœ√_num < 
s
->
∑øms
.
∂™es_≥r_pkg
;Ölane_num ++) {

1336 
	`Ârötf
(
ouçutfûe
, "%d:(%d) ",

1337 
∂™e_num
, 
s
->
ñemíts
[
j
].
mëad©a
.
∂™e_mëa
[∂™e_num].
num_˛óns
);

1339 
	`Ârötf
(
ouçutfûe
, "\n");

1342 
	`ssd_¥öt_block_li„time_di°ributi⁄
(
j
, 
s
, 
£t
[
i
], 
avg_li„time
, 
sour˚°r
);

1343 
	`Ârötf
(
ouçutfûe
, "\n");

1345 
tŸ_ñts
 +
°©
->
∑ges_moved
;

1351 
tŸ_ssd
 +
tŸ_ñts
;

1352 
	`Ârötf
(
ouçutfûe
, "\n");

1356 i‡(
ñts_cou¡
 > 0) {

1357 
	`Ârötf
(
ouçutfûe
, "%s Total SSD IOPS:\t%f\n",

1358 
sour˚°r
, 
i›s
);

1359 
	`Ârötf
(
ouçutfûe
, "%s Average SSDÉlement IOPS:\t%f\n",

1360 
sour˚°r
, 
i›s
/
ñts_cou¡
);

1365 
	}
}

1367 
	$ssd_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
)

1369 
i
;

1370 
ioq
 * 
queue£t
[
MAXDEVICES
*
SSD_MAX_ELEMENTS
];

1371 
queue˙t
 = 0;

1372 
ªq˙t
 = 0;

1373 
¥efix
[80];

1376 
	`•rötf_s4
(
¥efix
, 80, "%sssd ", 
sour˚°r
);

1377 
i
=0; i<
£tsize
; i++) {

1378 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
devi˚nos
[
£t
[
i
]]);

1379 
ioq
 *
q
 = 
cuºdisk
->
queue
;

1380 
queue£t
[
queue˙t
] = 
q
;

1381 
queue˙t
++;

1382 
ªq˙t
 +
	`ioqueue_gë_numbî_of_ªque°s
(
q
);

1384 i‡(
ªq˙t
 == 0) {

1385 
	`Ârötf
 (
ouçutfûe
, "\nNo ssdÑequests for members ofÅhis set\n\n");

1388 
	`ioqueue_¥öt°©s
(
queue£t
, 
queue˙t
, 
¥efix
);

1390 
	`ssd_ac˘ime_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

1391 
	`ssd_Ÿhî_¥öt°©s
(
£t
, 
£tsize
, 
¥efix
);

1392 
	}
}

1395 
	$ssd_¥öt°©s
 ()

1397 
ioq
 * 
queue£t
[
MAXDEVICES
*
SSD_MAX_ELEMENTS
];

1398 
£t
[
MAXDEVICES
];

1399 
i
,
j
;

1400 
ªq˙t
 = 0;

1401 
¥efix
[80];

1402 
disk˙t
;

1403 
queue˙t
;

1405 
	`Ârötf
(
ouçutfûe
, "\nSSD STATISTICS\n");

1406 
	`Ârötf
(
ouçutfûe
, "---------------------\n\n");

1408 
	`•rötf_s3
(
¥efix
, 80, "ssd ");

1410 
disk˙t
 = 0;

1411 
queue˙t
 = 0;

1413 
i
=0; i< 
numssds
; i++) {

1414 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
i
);

1415 i‡(
cuºdisk
) {

1416 
ioq
 *
q
 = 
cuºdisk
->
queue
;

1417 
queue£t
[
queue˙t
] = 
q
;

1418 
queue˙t
++;

1419 
ªq˙t
 +
	`ioqueue_gë_numbî_of_ªque°s
(
q
);

1420 
disk˙t
++;

1423 
	`as£π
 (
disk˙t
 =
numssds
);

1425 i‡(
ªq˙t
 == 0) {

1426 
	`Ârötf
(
ouçutfûe
, "No ssdÑequestsÉncountered\n");

1430 
	`ioqueue_¥öt°©s
(
queue£t
, 
queue˙t
, 
¥efix
);

1432 
disk˙t
 = 0;

1434 
i
=0; i< 
numssds
; i++) {

1435 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
i
);

1436 i‡(
cuºdisk
) {

1437 
£t
[
disk˙t
] = 
i
;

1438 
disk˙t
++;

1441 
	`as£π
 (
disk˙t
 =
numssds
);

1443 
	`ssd_ac˘ime_¥öt°©s
(
£t
, 
numssds
, 
¥efix
);

1444 
	`ssd_Ÿhî_¥öt°©s
(
£t
, 
numssds
, 
¥efix
);

1446 
	`ssd_¥öt˛ón°©s
(
£t
, 
numssds
, 
¥efix
);

1448 
	`Ârötf
 (
ouçutfûe
, "\n\n");

1450 
i
=0; i<
numssds
; i++) {

1452 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
i
);

1453 i‡(
cuºdisk
->
¥öt°©s
 =
FALSE
) {

1456 
ªq˙t
 = 0;

1458 
ioq
 *
q
 = 
cuºdisk
->
queue
;

1459 
ªq˙t
 +
	`ioqueue_gë_numbî_of_ªque°s
(
q
);

1461 i‡(
ªq˙t
 == 0) {

1462 
	`Ârötf
(
ouçutfûe
, "Nÿªque°†f‹ ssd #%d\n\n\n", 
£t
[
i
]);

1465 
	`Ârötf
(
ouçutfûe
, "ssd #%d:\n\n", 
£t
[
i
]);

1466 
	`•rötf_s4
(
¥efix
, 80, "ssd #%d ", 
£t
[
i
]);

1468 
ioq
 *
q
;

1469 
q
 = 
cuºdisk
->
queue
;

1470 
	`ioqueue_¥öt°©s
(&
q
, 1, 
¥efix
);

1472 
j
=0;j<
cuºdisk
->
∑øms
.
√Àmíts
;j++) {

1473 
µªfix
[100];

1474 
ioq
 *
q
;

1475 
	`•rötf_s5
(
µªfix
, 100, "%†ñem #%d ", 
¥efix
, 
j
);

1476 
q
 = 
cuºdisk
->
ñemíts
[
j
].
queue
;

1477 
	`ioqueue_¥öt°©s
(&
q
, 1, 
µªfix
);

1479 
	`ssd_ac˘ime_¥öt°©s
(&
£t
[
i
], 1, 
¥efix
);

1480 
	`ssd_Ÿhî_¥öt°©s
(&
£t
[
i
], 1, 
¥efix
);

1481 
	`Ârötf
 (
ouçutfûe
, "\n\n");

1483 
	}
}

1486 
	$ssd_gë_£ektime
 (
devno
,

1487 
i‹eq_evít
 *
ªq
,

1488 
checkˇche
,

1489 
maxtime
)

1491 
	`Ârötf
(
°dîr
, "devi˚_gë_£ektimênŸ suµ‹ãd f‹ ssd devnÿ%d\n", 
devno
);

1492 
	`as£π
(0);

1494 
	}
}

1497 
devi˚_hódî
 
	gssd_hdr_öôülizî
 = {

1498 
DEVICETYPE_SSD
,

1499 (
ssd
),

1501 (*)
ssd_c›y
,

1502 
ssd_£t_dïth
,

1503 
ssd_gë_dïth
,

1504 
ssd_gë_öbus
,

1505 
ssd_gë_bu¢o
,

1506 
ssd_gë_¶Ÿno
,

1507 
ssd_gë_numbî_of_blocks
,

1508 
ssd_gë_maxout°™dög
,

1509 
ssd_gë_numcyls
,

1510 
ssd_gë_blkå™°ime
,

1511 
ssd_gë_avg_£˘≥rcyl
,

1512 
ssd_gë_m≠pög
,

1513 
ssd_evít_¨rive
,

1514 
ssd_gë_di°™˚
,

1515 
ssd_gë_£rvtime
,

1516 
ssd_gë_£ektime
,

1517 
ssd_gë_ac˘ime
,

1518 
ssd_bus_dñay_com∂ëe
,

1519 
ssd_bus_ow√rshù_gø¡


	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd.h

4 
	~"disksim_globÆ.h
"

5 
	~"disksim_iosim.h
"

6 
	~"disksim_°©.h
"

7 
	~"disksim_ioqueue.h
"

8 
	~"disksim_bus.h
"

9 
	~"c⁄fig.h
"

11 #i‚de‡
DISKSIM_SSD_H


12 
	#DISKSIM_SSD_H


	)

14 
ssd
 *
gëssd
 (
devno
);

17 
devi˚_hódî
 
ssd_hdr_öôülizî
;

21 
	#SSD_MAX_ELEMENTS
 64

	)

22 
	#SSD_MAX_PLANES_PER_ELEM
 16

	)

23 
	#SSD_MAX_PARUNITS_PER_ELEM
 
SSD_MAX_PLANES_PER_ELEM


	)

24 
	#SSD_MAX_ELEMS_PER_GANG
 
SSD_MAX_ELEMENTS


25 
	#SSD_BITS_ELEMS_PER_GANG
 8

	)

29 
°©gí
 
	mac˘ime°©s
;

30 
	mªque°edbus
;

31 
	mwaôögf‹bus
;

32 
	mnumbuswaôs
;

33 } 
	tssd_°©_t
;

38 
	s_ssd_ñemít_°©
 {

39 
	mnum_˛ón
;

40 
	m∑ges_moved
;

41 
	mtŸ_x„r_co°
;

42 
	mavg_li„time
;

43 
	mtŸ_ªqs_issued
;

44 
	mtŸ_time_èkí
;

45 
	mtŸ_˛ón_time
;

46 } 
	tssd_ñemít_°©
;

52 
	mSSD_BLOCK_CLEAN
,

53 
	mSSD_BLOCK_INUSE
,

54 
	mSSD_BLOCK_SEALED


55 } 
	tSSD_BLOCK_STATES
;

66 
	s_block_mëad©a
 {

67 
	mblock_num
;

68 
	m∂™e_num
;

70 *
	m∑ge
;

74 
	mnum_vÆid
;

78 
	mªm_li„time
;

84 
	mtime_of_œ°_îasuª
;

86 
	m°©e
;

93 
	mb¢
;

94 } 
	tblock_mëad©a
;

100 
	s_∂™e_mëad©a
 {

102 
	m‰ì_blocks
;

104 
	mvÆid_∑ges
;

107 
	ma˘ive_∑ge
;

110 
	m˛ón_ö_¥ogªss
;

112 
	m˛ón_ö_block
;

113 
	mblock_Æloc_pos
;

114 
	m∑runô_num
;

115 
	mnum_˛óns
;

116 } 
	t∂™e_mëad©a
;

118 
	s_∑runô
 {

119 
	m∂™e_to_˛ón
;

120 } 
	t∑runô
;

126 
	s_ssd_ñemít_mëad©a
 {

127 *
	mlba_èbÀ
;

130 *
	m‰ì_blocks
;

135 
	mtŸ_‰ì_blocks
;

139 
	ma˘ive_∑ge
;

142 
∂™e_mëad©a
 
	m∂™e_mëa
[
SSD_MAX_PLANES_PER_ELEM
];

144 
block_mëad©a
 *
	mblock_ußge
;

148 
	mb¢
;

150 
	m∂™e_to_˛ón
;

151 
	m∂™e_to_wrôe
;

152 
	mblock_Æloc_pos
;

154 
∑runô
 
	m∑runôs
[
SSD_MAX_PARUNITS_PER_ELEM
];

156 
	mg™g_num
;

157 
	mªqs_waôög
;

158 
	mtŸ_migøti⁄s
;

159 
	mtŸ_pgs_migøãd
;

160 
	mmig_co°
;

161 } 
	tssd_ñemít_mëad©a
;

167 
	s_ssd_∂™e
 {

171 
	mmedü_busy
;

172 
	m∑ú_∂™e
;

174 
	mnum_blocks
;

175 } 
	tssd_∂™e
;

185 
	s_ssd_ñemít
 {

186 
ioq
 *
	mqueue
;

187 
	mmedü_busy
;

188 
ssd_ñemít_mëad©a
 
	mmëad©a
;

189 
ssd_ñemít_°©
 
	m°©
;

191 
	mpö_busy
;

192 
	mnum_∂™es
;

193 
ssd_∂™e
 
	m∂™e
[
SSD_MAX_PLANES_PER_ELEM
];

194 } 
	tssd_ñemít
;

196 
	s_ssd_ñem_numbî
 {

197 
	me
:
SSD_BITS_ELEMS_PER_GANG
;

198 } 
	tssd_ñem_numbî
;

200 
	s_g™g_mëad©a
 {

201 
ioq
 *
	mqueue
;

202 
	m˛ónög
;

203 
	mbusy
;

204 
	mªqs_waôög
;

205 
	mﬁde°
;

206 
	mñem_‰ì_∑ges
[
SSD_MAX_ELEMENTS
];

207 
ssd_ñem_numbî
 *
	mpg2ñem
;

208 } 
	tg™g_mëad©a
;

211 
	#SSD_SIMPLE_MODEL
 1

	)

212 
	#SSD_SIMPLE_DW_MODEL
 2

	)

213 
	#SSD_LOGDISK_MODEL
 3

	)

216 
	#DISKSIM_SSD_MAX_WRITE_POLICIES
 2

	)

217 
	#DISKSIM_SSD_WRITE_POLICY_SIMPLE
 1

	)

218 
	#DISKSIM_SSD_WRITE_POLICY_OSR
 2

	)

222 
	#DISKSIM_SSD_MAX_RESERVE
 50

	)

225 
	#SSD_DATA_BYTES_PER_SECTOR
 512

	)

226 
	#SSD_MDATA_BYTES_PER_SECTOR
 16

	)

227 
	#SSD_BYTES_PER_SECTOR
 (
SSD_DATA_BYTES_PER_SECTOR
 + 
SSD_MDATA_BYTES_PER_SECTOR
)

	)

230 
	#SSD_SECTORS_PER_SUMMARY_PAGE
 1

	)

243 
	#PLANE_BLOCKS_CONCAT
 1

	)

258 
	#PLANE_BLOCKS_PAIRWISE_STRIPE
 2

	)

270 
	#PLANE_BLOCKS_FULL_STRIPE
 3

	)

274 
	#SSD_COPY_BACK_DISABLE
 0

	)

275 
	#SSD_COPY_BACK_ENABLE
 1

	)

278 
	#SSD_ALLOC_POOL_GANG
 0

	)

279 
	#SSD_ALLOC_POOL_CHIP
 1

280 
	#SSD_ALLOC_POOL_PLANE
 2

	)

283 
	#SSD_SHARED_BUS_GANG
 1

284 
	#SSD_SHARED_CONTROL_GANG
 2

285 

	)

286 
	s_ssd_timög_∑øms
 {

287 
	mssd_modñ
;

288 
	m√Àmíts
;

289 
	m∑ge_size
;

290 
	m∑ges_≥r_block
;

291 
	mblocks_≥r_ñemít
;

292 
	mñemít_°ride_∑ges
;

296 
	mchù_x„r_œãncy
;

297 
	m∑ge_ªad_œãncy
;

298 
	m∑ge_wrôe_œãncy
;

299 
	mblock_îa£_œãncy
;

301 
	mwrôe_pﬁicy
;

305 
	mª£rve_blocks
;

307 
	mmö_‰ìblks_≥r˚¡
;

309 
	m˛ónög_pﬁicy
;

312 
	m∂™es_≥r_pkg
;

314 
	mblocks_≥r_∂™e
;

316 
	m∂™e_block_m≠pög
;

318 
	mc›y_back
;

320 
	mnum_∑runôs
;

322 
	mñemíts_≥r_g™g
;

324 
	mg™g_sh¨e
;

326 
	m˛ónög_ö_background
;

328 
	mÆloc_poﬁ_logic
;

329 } 
	tssd_timög_∑øms
;

331 
	g_ssd_timög_t
;

334 
	sssd
 {

335 
devi˚_hódî
 
	mhdr
;

336 
ssd_timög_∑øms
 
	m∑øms
;

337 
_ssd_timög_t
 *
	mtimög_t
;

339 
	movîhód
;

340 
	mbus_å™ß˘i⁄_œãncy
;

341 
	mnumblocks
;

342 
	mdevno
;

343 
	möôed
;

344 
	mªc⁄√˘_ªas⁄
;

346 
i‹eq_evít
 *
	mch™√l_a˘ivôy
;

347 
i‹eq_evít
 *
	mcom∂ëi⁄_queue
;

348 
ioq
 *
	mqueue
;

350 
ssd_ñemít
 
	mñemíts
[
SSD_MAX_ELEMENTS
];

353 
	md©a_∑ges_≥r_ñem
;

354 
g™g_mëad©a
 
	mg™g_mëa
[
SSD_MAX_ELEMENTS
];

356 
	mblkå™°ime
;

357 
	mmaxqÀn
;

358 
	mbusow√d
;

359 
i‹eq_evít
 *
	mbuswaô
;

360 
	m√vîdisc⁄√˘
;

361 
	mnumöbu£s
;

362 
	möbu£s
[
MAXINBUSES
];

363 
	mdïth
[
MAXINBUSES
];

364 
	m¶Ÿno
[
MAXINBUSES
];

366 
	m¥öt°©s
;

367 
ssd_°©_t
 
	m°©
;

368 } 
	tssd_t
;

370 
	sssd_öfo
 {

371 
ssd
 **
	mssds
;

372 
	mnumssds
;

373 
	mssds_Àn
;

374 } 
	tssdöfo_t
;

377 
	s_ssd_ªq
 {

378 
	mblk
;

379 
	mcou¡
;

380 
	mis_ªad
;

381 
	m∂™e_num
;

382 
i‹eq_evít
 *
	m‹g_ªq
;

383 
	mac˘ime
;

384 
	mschtime
;

385 
	mö˛ude
;

387 } 
	tssd_ªq
;

390 
	#SSD_PAGE_TO_BLOCK
(
≤um
, 
s
Ë(’num)/(s->
∑øms
.
∑ges_≥r_block
))

	)

391 
	#SSD_PAGES_PER_ELEM
(
s
Ë((s)->
∑øms
.
blocks_≥r_ñemít
 * (s)->∑øms.
∑ges_≥r_block
)

	)

392 
	#ADDRESSABLE_PAGES_PER_ELEM
(
s
Ë((s)->
d©a_∑ges_≥r_ñem
)

	)

393 
	#SSD_PLANES_PER_ELEM
(
s
Ë((s)->
∑øms
.
∂™es_≥r_pkg
)

	)

394 
	#SSD_PARUNITS_PER_ELEM
(
s
Ë((s)->
∑øms
.
num_∑runôs
)

	)

395 
	#SSD_PLANES_PER_PARUNIT
(
s
Ë(
	`SSD_PLANES_PER_ELEM
(s)/
	`SSD_PARUNITS_PER_ELEM
(s))

	)

396 
	#SSD_DATA_PAGES_PER_BLOCK
(
s
Ë((s)->
∑øms
.
∑ges_≥r_block
 - 1)

	)

397 
	#SSD_GANG_PAGE_SIZE
(
s
Ë((s)->
∑øms
.
ñemíts_≥r_g™g
 * (s)->∑øms.
∑ge_size
)

	)

398 
	#numssds
 (
disksim
->
ssdöfo
->
numssds
)

	)

400 
	#ALLOC_UNIT_GANG
 1

	)

401 
	#ALLOC_UNIT_ELEM
 2

	)

402 
	#SSD_NUM_GANG
(
s
Ë((s)->
∑øms
.
√Àmíts
 / (s)->∑øms.
ñemíts_≥r_g™g
)

	)

403 
	#SSD_GANG_SIZE
(
s
Ë(
	`ADDRESSABLE_PAGES_PER_ELEM
(sË* (s)->
∑øms
.
ñemíts_≥r_g™g
)

	)

404 
	#MIN_REQS
 99999999

	)

405 
	#MAX_REQS
 100

	)

406 
	#MAX_REQS_ELEM_QUEUE
 100

	)

407 
	#SYNC_GANG
 1

	)

408 
	#MIGRATE
 1

	)

411 
ssd_ªad_t›röts
 (
FILE
 *
∑rfûe
);

412 
ssd_ªad_•ecs
 (
FILE
 *
∑rfûe
, 
devno
, 
c›õs
);

413 
ssd_£t_sync£t
 (
£t°¨t
, 
£ãnd
);

414 
ssd_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

415 
ssd_£tˇŒbacks
 ();

416 
ssd_öôülize
 ();

417 
ssd_ª£t°©s
 ();

418 
ssd_¥öt°©s
 ();

419 
ssd_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
);

420 
ssd_˛ón°©s
 ();

421 
ssd_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
);

422 
ssd_gë_dïth
 (
devno
);

423 
ssd_gë_öbus
 (
devno
);

424 
ssd_gë_bu¢o
 (
i‹eq_evít
 *
cuº
);

425 
ssd_gë_¶Ÿno
 (
devno
);

426 
ssd_gë_numbî_of_blocks
 (
devno
);

427 
ssd_gë_maxout°™dög
 (
devno
);

428 
ssd_gë_numdisks
 ();

429 
ssd_gë_numcyls
 (
devno
);

430 
ssd_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
);

431 
ssd_gë_avg_£˘≥rcyl
 (
devno
);

432 
ssd_gë_m≠pög
 (
m≠ty≥
, 
devno
, 
blkno
, *
cyÕå
, *
surÁ˚±r
, *
blk±r
);

433 
ssd_evít_¨rive
 (
i‹eq_evít
 *
cuº
);

434 
ssd_gë_di°™˚
 (
devno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
);

435 
ssd_gë_£rvtime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
);

436 
ssd_gë_ac˘ime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
maxtime
);

437 
ssd_bus_dñay_com∂ëe
 (
devno
, 
i‹eq_evít
 *
cuº
, 
£¡bu¢o
);

438 
ssd_bus_ow√rshù_gø¡
 (
devno
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
);

440 
ssd_as£π_‰ì_blocks
(
ssd_t
 *
s
, 
ssd_ñemít_mëad©a
 *
mëad©a
);

441 
ssd_as£π_vÆid_∑ges
(
∂™e_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

442 
ssd_d©a_å™s„r_co°
(
ssd_t
 *
s
, 
£˘‹s_cou¡
);

443 
ssd_œ°_∑ge_ö_block
(
∑ge_num
, 
ssd_t
 *
s
);

444 
_ssd_wrôe_∑ge_o§
(
ssd_t
 *
s
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
Õn
);

445 
ssd_logiˇl_∑gío
(
blkno
, 
ssd_t
 *
s
);

446 
ssd_block_to_bôpos
(
ssd_t
 *
cuºdisk
, 
block
);

447 
ssd_bôpos_to_block
(
bôpos
, 
ssd_t
 *
s
);

448 
_ssd_Æloc_a˘ive_block
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
);

449 
ssd_‰ì_bôs
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

450 
ssd_as£π_∂™e_‰ìbôs
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

451 
ssd_ªad_pﬁicy_sim∂e
(
cou¡
, 
ssd_t
 *
s
);

452 
ssd_com∂ëe_∑ª¡
(
i‹eq_evít
 *
cuº
, 
ssd_t
 *
cuºdisk
);

453 
_ssd_övoke_ñemít_˛ónög
(
ñem_num
, 
ssd_t
 *
s
);

454 
ssd_Æªady_¥e£¡
(
ssd_ªq
 **
ªqs
, 
tŸÆ
, 
i‹eq_evít
 *
ªq
);

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_clean.c

4 
	~"ssd.h
"

5 
	~"ssd_˛ón.h
"

6 
	~"ssd_utûs.h
"

11 
	gssd_ßme_∂™e_blocks


12 (
ssd_t
 *
	gs
, 
ssd_ñemít_mëad©a
 *
	gmëad©a
, 
	g‰om_blk
, 
	gto_blk
)

14  (
	gmëad©a
->
	gblock_ußge
[
‰om_blk
].
	g∂™e_num
 =
mëad©a
->
block_ußge
[
to_blk
].
∂™e_num
);

20 
	$ssd_ˇn_˛ón_block
(
ssd_t
 *
s
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
blk
)

22 
bôpos
 = 
	`ssd_block_to_bôpos
(
s
, 
blk
);

23  ((
	`ssd_bô_⁄
(
mëad©a
->
‰ì_blocks
, 
bôpos
)Ë&& (mëad©a->
block_ußge
[
blk
].
°©e
 =
SSD_BLOCK_SEALED
));

24 
	}
}

29 
	gssd_¸ossovî_co°


30 (
ssd_t
 *
	gs
, 
ssd_ñemít_mëad©a
 *
	gmëad©a
, 
	g‰om_blk
, 
	gto_blk
)

32 i‡(
ssd_ßme_∂™e_blocks
(
s
, 
mëad©a
, 
‰om_blk
, 
to_blk
)) {

35 
	gx„r_co°
;

38 
	gx„r_co°
 = 
ssd_d©a_å™s„r_co°
(
s
, s->
∑øms
.
∑ge_size
);

39  (2 * 
	gx„r_co°
);

47 
	$ssd_move_∑ge
(
Õn
, 
‰om_blk
, 
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

49 
co°
 = 0;

50 
ssd_ñemít_mëad©a
 *
mëad©a
 = &
s
->
ñemíts
[
ñem_num
].metadata;

52 
s
->
∑øms
.
c›y_back
) {

53 
SSD_COPY_BACK_DISABLE
:

54 i‡(
	`ssd_œ°_∑ge_ö_block
(
mëad©a
->
a˘ive_∑ge
, 
s
)) {

55 
	`_ssd_Æloc_a˘ive_block
(-1, 
ñem_num
, 
s
);

59 
SSD_COPY_BACK_ENABLE
:

60 
	`ASSERT
(
mëad©a
->
∂™e_mëa
[
∂™e_num
].
a˘ive_∑ge
 == metadata->active_page);

61 i‡(
	`ssd_œ°_∑ge_ö_block
(
mëad©a
->
a˘ive_∑ge
, 
s
)) {

62 
	`_ssd_Æloc_a˘ive_block
(
∂™e_num
, 
ñem_num
, 
s
);

67 
	`Ârötf
(
°dîr
, "Error: invalid copy backÖolicy %d\n",

68 
s
->
∑øms
.
c›y_back
);

69 
	`exô
(1);

72 
co°
 +
	`_ssd_wrôe_∑ge_o§
(
s
, 
mëad©a
, 
Õn
);

74  
co°
;

75 
	}
}

80 
	gssd_˛ón_⁄e_∑ge


81 (
	gÕ_num
, 
	gµ_ödex
, 
	gblk
, 
	g∂™e_num
, 
	gñem_num
, 
ssd_ñemít_mëad©a
 *
	gmëad©a
, 
ssd_t
 *
	gs
)

83 
	gco°
 = 0;

84 
	gx„r_co°
 = 0;

86 
	gco°
 +
s
->
∑øms
.
∑ge_ªad_œãncy
;

87 
	gco°
 +
ssd_move_∑ge
(
Õ_num
, 
blk
, 
∂™e_num
, 
ñem_num
, 
s
);

92 
	gx„r_co°
 = 
ssd_¸ossovî_co°
(
s
, 
mëad©a
, 
blk
, 
SSD_PAGE_TO_BLOCK
(mëad©a->
a˘ive_∑ge
, s));

94 
	gco°
 +
x„r_co°
;

96 
ssd_as£π_vÆid_∑ges
(
∂™e_num
, 
mëad©a
, 
s
);

97 
ASSERT
(
mëad©a
->
block_ußge
[
blk
].
∑ge
[
µ_ödex
] == -1);

100 
	gs
->
	gñemíts
[
ñem_num
].
	g°©
.
	g∑ges_moved
 ++;

101 
	gs
->
	gñemíts
[
ñem_num
].
	g°©
.
	gtŸ_x„r_co°
 +
x„r_co°
;

103  
	gco°
;

114 
	$ssd_upd©e_block_li„time
(
time
, 
blk
, 
ssd_ñemít_mëad©a
 *
mëad©a
)

116 
mëad©a
->
block_ußge
[
blk
].
ªm_li„time
 --;

117 
mëad©a
->
block_ußge
[
blk
].
time_of_œ°_îasuª
 = 
time
;

119 i‡(
mëad©a
->
block_ußge
[
blk
].
ªm_li„time
 < 0) {

120 
	`Ârötf
(
°dîr
, "Error: NegativeÜifetime %d (block is beingÉrasedáfter it's dead)\n",

121 
mëad©a
->
block_ußge
[
blk
].
ªm_li„time
);

122 
	`ASSERT
(0);

123 
	`exô
(1);

125 
	}
}

130 
	$ssd_upd©e_‰ì_block_°©us
(
blk
, 
∂™e_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
)

132 
bôpos
;

136 
bôpos
 = 
	`ssd_block_to_bôpos
(
s
, 
blk
);

137 
	`ssd_˛ór_bô
(
mëad©a
->
‰ì_blocks
, 
bôpos
);

138 
mëad©a
->
block_ußge
[
blk
].
°©e
 = 
SSD_BLOCK_CLEAN
;

139 
mëad©a
->
block_ußge
[
blk
].
b¢
 = 0;

140 
mëad©a
->
tŸ_‰ì_blocks
 ++;

141 
mëad©a
->
∂™e_mëa
[
∂™e_num
].
‰ì_blocks
 ++;

142 
	`ssd_as£π_‰ì_blocks
(
s
, 
mëad©a
);

145 
	`ASSERT
(
mëad©a
->
block_ußge
[
blk
].
num_vÆid
 == 0);

146 
	`ssd_as£π_vÆid_∑ges
(
∂™e_num
, 
mëad©a
, 
s
);

147 
	}
}

158 #ifde‡
CAMERA_READY


159 
	$ssd_øã_limô
(
block_li„
, 
avg_li„time
)

161 
≥r˚¡_ªm
 = (
block_li„
 * 1.0Ë/ 
avg_li„time
;

162 
ãmp
 = (
≥r˚¡_ªm
 - (
SSD_LIFETIME_THRESHOLD_X
-
SSD_RATELIMIT_WINDOW
)) / (SSD_LIFETIME_THRESHOLD_X -Öercent_rem);

163 
ønd_no
 = 
	`DISKSIM_dønd48
();

166 i‡(
ønd_no
 < 
ãmp
) {

173 
	}
}

175 
	$ssd_øã_limô
(
block_li„
, 
avg_li„time
)

177 
≥r˚¡_ªm
 = (
block_li„
 * 1.0Ë/ 
avg_li„time
;

178 
ãmp
 = 
≥r˚¡_ªm
 / 
SSD_LIFETIME_THRESHOLD_X
;

179 
ønd_no
 = 
	`DISKSIM_dønd48
();

182 i‡(
ønd_no
 < 
ãmp
) {

189 
	}
}

195 
	$ssd_compuã_avg_li„time_ö_∂™e
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

197 
i
;

198 
bôpos
;

199 
tŸ_li„time
 = 0;

200 
ssd_ñemít_mëad©a
 *
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

202 
bôpos
 = 
∂™e_num
 * 
s
->
∑øms
.
blocks_≥r_∂™e
;

203 
i
 = 
bôpos
; i < bôpo†+ ()
s
->
∑øms
.
blocks_≥r_∂™e
; i ++) {

204 
block
 = 
	`ssd_bôpos_to_block
(
i
, 
s
);

205 
	`ASSERT
(
mëad©a
->
block_ußge
[
block
].
∂™e_num
 ==Ölane_num);

206 
tŸ_li„time
 +
mëad©a
->
block_ußge
[
block
].
ªm_li„time
;

209  (
tŸ_li„time
 / 
s
->
∑øms
.
blocks_≥r_∂™e
);

210 
	}
}

216 
	$ssd_compuã_avg_li„time_ö_ñemít
(
ñem_num
, 
ssd_t
 *
s
)

218 
tŸ_li„time
 = 0;

219 
i
;

220 
ssd_ñemít_mëad©a
 *
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

222 
i
 = 0; i < 
s
->
∑øms
.
blocks_≥r_ñemít
; i ++) {

223 
tŸ_li„time
 +
mëad©a
->
block_ußge
[
i
].
ªm_li„time
;

226  (
tŸ_li„time
 / 
s
->
∑øms
.
blocks_≥r_ñemít
);

227 
	}
}

229 
	$ssd_compuã_avg_li„time
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

231 i‡(
∂™e_num
 == -1) {

232  
	`ssd_compuã_avg_li„time_ö_ñemít
(
ñem_num
, 
s
);

234  
	`ssd_compuã_avg_li„time_ö_∂™e
(
∂™e_num
, 
ñem_num
, 
s
);

236 
	}
}

238 #ifde‡
CAMERA_READY


249 
	$ssd_pick_wór_aw¨e
(
blk
, 
block_li„
, 
avg_li„time
, 
ssd_t
 *
s
)

251 
	`ASSERT
(
s
->
∑øms
.
˛ónög_pﬁicy
 =
DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AWARE
);

256 i‡(
block_li„
 < (
SSD_LIFETIME_THRESHOLD_X
 * 
avg_li„time
)) {

257 i‡((
block_li„
 > (
SSD_LIFETIME_THRESHOLD_X
 - 
SSD_RATELIMIT_WINDOW
Ë* 
avg_li„time
)) {

263 i‡(
	`ssd_øã_limô
(
block_li„
, 
avg_li„time
)) {

276 
	}
}

280 
	$ssd_pick_wór_aw¨e
(
blk
, 
block_li„
, 
avg_li„time
, 
ssd_t
 *
s
)

282 
	`ASSERT
(
s
->
∑øms
.
˛ónög_pﬁicy
 =
DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AWARE
);

287 i‡(
block_li„
 < (
SSD_LIFETIME_THRESHOLD_X
 * 
avg_li„time
)) {

294 i‡(
	`ssd_øã_limô
(
block_li„
, 
avg_li„time
)) {

301 
	}
}

304 
	g_ssd_pick_block_to_˛ón


305 (
	gblk
, 
	g∂™e_num
, 
	gñem_num
, 
ssd_ñemít_mëad©a
 *
	gmëad©a
, 
ssd_t
 *
	gs
)

307 
	gblock_li„
;

309 i‡(
	g∂™e_num
 != -1) {

310 i‡(
mëad©a
->
block_ußge
[
blk
].
∂™e_num
 !=Ölane_num) {

315 
	gblock_li„
 = 
mëad©a
->
block_ußge
[
blk
].
ªm_li„time
;

318 i‡(
	gblock_li„
 == 0) {

323 i‡(!
ssd_ˇn_˛ón_block
(
s
, 
mëad©a
, 
blk
)) {

333 
	$ssd_migøã_cﬁd_d©a
(
to_blk
, *
mco°
, 
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

335 
i
;

336 
‰om_blk
 = -1;

337 
ﬁde°_îa£_time
 = 
simtime
;

338 
co°
 = 0;

339 
bôpos
;

341 #i‡
SSD_ASSERT_ALL


342 
f1
;

343 
f2
;

346 
ssd_ñemít_mëad©a
 *
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

351 i‡(
∂™e_num
 == -1) {

352 
i
 = 0; i < 
s
->
∑øms
.
blocks_≥r_ñemít
; i ++) {

353 i‡(
mëad©a
->
block_ußge
[
i
].
num_vÆid
 > 0) {

354 i‡(
mëad©a
->
block_ußge
[
i
].
time_of_œ°_îasuª
 < 
ﬁde°_îa£_time
) {

355 
ﬁde°_îa£_time
 = 
mëad©a
->
block_ußge
[
i
].
time_of_œ°_îasuª
;

356 
‰om_blk
 = 
i
;

362 #i‡
SSD_ASSERT_ALL


363 
f1
 = 
	`ssd_‰ì_bôs
(
∂™e_num
, 
ñem_num
, 
mëad©a
, 
s
);

364 
	`ASSERT
(
f1
 =
mëad©a
->
∂™e_mëa
[mëad©a->
block_ußge
[
to_blk
].
∂™e_num
].
‰ì_blocks
);

367 
bôpos
 = 
∂™e_num
 * 
s
->
∑øms
.
blocks_≥r_∂™e
;

368 
i
 = 
bôpos
; i < bôpo†+ ()
s
->
∑øms
.
blocks_≥r_∂™e
; i ++) {

369 
block
 = 
	`ssd_bôpos_to_block
(
i
, 
s
);

370 
	`ASSERT
(
mëad©a
->
block_ußge
[
block
].
∂™e_num
 ==Ölane_num);

372 i‡(
mëad©a
->
block_ußge
[
block
].
num_vÆid
 > 0) {

373 i‡(
mëad©a
->
block_ußge
[
block
].
time_of_œ°_îasuª
 < 
ﬁde°_îa£_time
) {

374 
ﬁde°_îa£_time
 = 
mëad©a
->
block_ußge
[
block
].
time_of_œ°_îasuª
;

375 
‰om_blk
 = 
block
;

381 
	`ASSERT
(
‰om_blk
 != -1);

382 i‡(
∂™e_num
 != -1) {

383 
	`ASSERT
(
mëad©a
->
block_ußge
[
‰om_blk
].
∂™e_num
 =mëad©a->block_ußge[
to_blk
].plane_num);

388 
co°
 +
	`_ssd_˛ón_block_fuŒy
(
to_blk
, 
mëad©a
->
block_ußge
[to_blk].
∂™e_num
, 
ñem_num
, mëad©a, 
s
);

390 #i‡
SSD_ASSERT_ALL


391 i‡(
∂™e_num
 != -1) {

392 
f2
 = 
	`ssd_‰ì_bôs
(
∂™e_num
, 
ñem_num
, 
mëad©a
, 
s
);

393 
	`ASSERT
(
f2
 =
mëad©a
->
∂™e_mëa
[mëad©a->
block_ußge
[
to_blk
].
∂™e_num
].
‰ì_blocks
);

399 
co°
 +
mëad©a
->
block_ußge
[
‰om_blk
].
num_vÆid
 * 
s
->
∑øms
.
∑ge_ªad_œãncy
;

401 
co°
 +
mëad©a
->
block_ußge
[
‰om_blk
].
num_vÆid
 * 
s
->
∑øms
.
∑ge_wrôe_œãncy
;

404 
co°
 +
	`ssd_¸ossovî_co°
(
s
, 
mëad©a
, 
‰om_blk
, 
to_blk
);

410 
mëad©a
->
block_ußge
[
to_blk
].
b¢
 = mëad©a->block_ußge[
‰om_blk
].bsn;

411 
mëad©a
->
block_ußge
[
to_blk
].
num_vÆid
 = mëad©a->block_ußge[
‰om_blk
].num_valid;

412 
mëad©a
->
block_ußge
[
‰om_blk
].
num_vÆid
 = 0;

414 
i
 = 0; i < 
s
->
∑øms
.
∑ges_≥r_block
; i ++) {

415 
Õn
 = 
mëad©a
->
block_ußge
[
‰om_blk
].
∑ge
[
i
];

416 i‡(
Õn
 != -1) {

417 
	`ASSERT
(
mëad©a
->
lba_èbÀ
[
Õn
] =(
‰om_blk
 * 
s
->
∑øms
.
∑ges_≥r_block
 + 
i
));

418 
mëad©a
->
lba_èbÀ
[
Õn
] = 
to_blk
 * 
s
->
∑øms
.
∑ges_≥r_block
 + 
i
;

420 
mëad©a
->
block_ußge
[
to_blk
].
∑ge
[
i
] = mëad©a->block_ußge[
‰om_blk
].page[i];

422 
mëad©a
->
block_ußge
[
to_blk
].
°©e
 = mëad©a->block_ußge[
‰om_blk
].state;

424 
bôpos
 = 
	`ssd_block_to_bôpos
(
s
, 
to_blk
);

425 
	`ssd_£t_bô
(
mëad©a
->
‰ì_blocks
, 
bôpos
);

426 
mëad©a
->
tŸ_‰ì_blocks
 --;

427 
mëad©a
->
∂™e_mëa
[mëad©a->
block_ußge
[
to_blk
].
∂™e_num
].
‰ì_blocks
 --;

429 #i‡
SSD_ASSERT_ALL


430 i‡(
∂™e_num
 != -1) {

431 
f2
 = 
	`ssd_‰ì_bôs
(
∂™e_num
, 
ñem_num
, 
mëad©a
, 
s
);

432 
	`ASSERT
(
f2
 =
mëad©a
->
∂™e_mëa
[mëad©a->
block_ußge
[
to_blk
].
∂™e_num
].
‰ì_blocks
);

436 
	`ssd_as£π_‰ì_blocks
(
s
, 
mëad©a
);

437 
	`ASSERT
(
mëad©a
->
block_ußge
[
‰om_blk
].
num_vÆid
 == 0);

439 #i‡
ASSERT_FREEBITS


440 i‡(
∂™e_num
 != -1) {

441 
f2
 = 
	`ssd_‰ì_bôs
(
∂™e_num
, 
ñem_num
, 
mëad©a
, 
s
);

442 
	`ASSERT
(
f1
 =
f2
);

446 *
mco°
 = 
co°
;

449 
mëad©a
->
tŸ_migøti⁄s
 ++;

450 
mëad©a
->
tŸ_pgs_migøãd
 +mëad©a->
block_ußge
[
to_blk
].
num_vÆid
;

451 
mëad©a
->
mig_co°
 +
co°
;

453  
‰om_blk
;

454 
	}
}

457 
	gssd_pick_wór_aw¨e_wôh_migøti⁄


458 (
	gblk
, 
	gblock_li„
, 
	gavg_li„time
, *
	gco°
, 
	g∂™e_num
, 
	gñem_num
, 
ssd_t
 *
	gs
)

460 
	g‰om_block
 = 
blk
;

461 
	gªtúemít_age
;

462 
ASSERT
(
s
->
∑øms
.
˛ónög_pﬁicy
 =
DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AWARE
);

464 
	gªtúemít_age
 = 
SSD_LIFETIME_THRESHOLD_Y
 * 
avg_li„time
;

470 i‡(
	gblock_li„
 < 
	gªtúemít_age
) {

473 
	g‰om_block
 = 
ssd_migøã_cﬁd_d©a
(
blk
, 
co°
, 
∂™e_num
, 
ñem_num
, 
s
);

478  
	g‰om_block
;

485 
	$ssd_pick_block_to_˛ón2
(
∂™e_num
, 
ñem_num
, *
mco°
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
)

487 
avg_li„time
 = 1;

488 
i
;

489 
size
;

490 
block
 = -1;

491 
mö_vÆid
 = 
s
->
∑øms
.
∑ges_≥r_block
 - 1;

492 
li°node
 *
gªedy_li°
;

494 *
mco°
 = 0;

497 
avg_li„time
 = 
	`ssd_compuã_avg_li„time
(
∂™e_num
, 
ñem_num
, 
s
);

500 
	`Œ_¸óã
(&
gªedy_li°
);

501 
i
 = 0; i < 
s
->
∑øms
.
blocks_≥r_ñemít
; i ++) {

502 i‡(
	`_ssd_pick_block_to_˛ón
(
i
, 
∂™e_num
, 
ñem_num
, 
mëad©a
, 
s
)) {

505 i‡(
mëad©a
->
block_ußge
[
i
].
num_vÆid
 <
mö_vÆid
) {

506 
	`ASSERT
(
i
 =
mëad©a
->
block_ußge
[i].
block_num
);

507 
	`Œ_ö£π_©_hód
(
gªedy_li°
, (*)&
mëad©a
->
block_ußge
[
i
]);

508 
mö_vÆid
 = 
mëad©a
->
block_ußge
[
i
].
num_vÆid
;

509 
block
 = 
i
;

514 
	`ASSERT
(
block
 != -1);

515 
block
 = -1;

519 
size
 = 
	`Œ_gë_size
(
gªedy_li°
);

524 
i
 = 0; i < 
size
; i ++) {

525 
block_mëad©a
 *
bm
;

526 
mig_blk
;

528 
li°node
 *
n
 = 
	`Œ_gë_¡h_node
(
gªedy_li°
, 
i
);

529 
bm
 = ((
block_mëad©a
 *)
n
->
d©a
);

531 i‡(
i
 == 0) {

532 
	`ASSERT
(
mö_vÆid
 =
bm
->
num_vÆid
);

536 i‡(
i
 =
size
 -1) {

538 
block
 = 
bm
->
block_num
;

542 i‡(
s
->
∑øms
.
˛ónög_pﬁicy
 =
DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AGNOSTIC
) {

543 
block
 = 
bm
->
block_num
;

546 #i‡
MIGRATE


548 
mig_blk
 = 
	`ssd_pick_wór_aw¨e_wôh_migøti⁄
(
bm
->
block_num
, bm->
ªm_li„time
, 
avg_li„time
, 
mco°
, bm->
∂™e_num
, 
ñem_num
, 
s
);

549 i‡(
mig_blk
 !
bm
->
block_num
) {

552 
block
 = 
mig_blk
;

558 i‡(
	`ssd_pick_wór_aw¨e
(
bm
->
block_num
, bm->
ªm_li„time
, 
avg_li„time
, 
s
)) {

559 
block
 = 
bm
->
block_num
;

565 
	`Œ_ªÀa£
(
gªedy_li°
);

567 
	`ASSERT
(
block
 != -1);

568  
block
;

569 
	}
}

571 
	$ssd_pick_block_to_˛ón1
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
)

573 
i
;

574 
block
 = -1;

575 
mö_vÆid
 = 
s
->
∑øms
.
∑ges_≥r_block
 - 1;

577 
i
 = 0; i < 
s
->
∑øms
.
blocks_≥r_ñemít
; i ++) {

578 i‡(
	`_ssd_pick_block_to_˛ón
(
i
, 
∂™e_num
, 
ñem_num
, 
mëad©a
, 
s
)) {

579 i‡(
mëad©a
->
block_ußge
[
i
].
num_vÆid
 < 
mö_vÆid
) {

580 
mö_vÆid
 = 
mëad©a
->
block_ußge
[
i
].
num_vÆid
;

581 
block
 = 
i
;

586 i‡(
block
 != -1) {

587  
block
;

589 
	`Ârötf
(
°dîr
, "Eº‹: wêˇ¬Ÿ födá blockÅÿ˛ó¿öÖœ√ %d\n", 
∂™e_num
);

590 
	`ASSERT
(0);

591 
	`exô
(1);

593 
	}
}

595 
	$ssd_pick_block_to_˛ón
(
∂™e_num
, 
ñem_num
, *
mco°
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
)

597  
	`ssd_pick_block_to_˛ón2
(
∂™e_num
, 
ñem_num
, 
mco°
, 
mëad©a
, 
s
);

598 
	}
}

604 
	$_ssd_˛ón_block_∑πüŒy
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

606 
ssd_ñemít_mëad©a
 *
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

607 
∂™e_mëad©a
 *
pm
 = &
mëad©a
->
∂™e_mëa
[
∂™e_num
];

608 
co°
 = 0;

609 
block
;

610 
i
;

612 
	`ASSERT
(
pm
->
˛ón_ö_¥ogªss
);

613 
block
 = 
pm
->
˛ón_ö_block
;

615 i‡(
mëad©a
->
block_ußge
[
block
].
num_vÆid
 > 0) {

617 
i
 = 0; i < 
s
->
∑øms
.
∑ges_≥r_block
; i ++) {

618 
Õ_num
 = 
mëad©a
->
block_ußge
[
block
].
∑ge
[
i
];

620 i‡(
Õ_num
 != -1) {

621 
co°
 +
	`ssd_˛ón_⁄e_∑ge
(
Õ_num
, 
i
, 
block
, 
∂™e_num
, 
ñem_num
, 
mëad©a
, 
s
);

630 i‡(
mëad©a
->
block_ußge
[
block
].
num_vÆid
 == 0) {

632 
co°
 +
s
->
∑øms
.
block_îa£_œãncy
;

634 
	`ssd_upd©e_‰ì_block_°©us
(
block
, 
∂™e_num
, 
mëad©a
, 
s
);

635 
	`ssd_upd©e_block_li„time
(
simtime
+
co°
, 
block
, 
mëad©a
);

636 
pm
->
˛ón_ö_¥ogªss
 = 0;

637 
pm
->
˛ón_ö_block
 = -1;

640  
co°
;

641 
	}
}

643 
	$ssd_˛ón_block_∑πüŒy
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

645 
ssd_ñemít_mëad©a
 *
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

646 
∂™e_mëad©a
 *
pm
 = &
mëad©a
->
∂™e_mëa
[
∂™e_num
];

647 
co°
 = 0;

648 
mco°
 = 0;

651 i‡(!
pm
->
˛ón_ö_¥ogªss
) {

653 
pm
->
˛ón_ö_block
 = 
	`ssd_pick_block_to_˛ón
(
∂™e_num
, 
ñem_num
, &
mco°
, 
mëad©a
, 
s
);

654 
pm
->
˛ón_ö_¥ogªss
 = 1;

658 
	`ASSERT
(
pm
->
˛ón_ö_block
 != -1);

659 
co°
 = 
	`_ssd_˛ón_block_∑πüŒy
(
∂™e_num
, 
ñem_num
, 
s
);

661  (
co°
+
mco°
);

662 
	}
}

670 
	$_ssd_˛ón_block_fuŒy
(
blk
, 
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
)

672 
co°
 = 0;

673 
∂™e_mëad©a
 *
pm
 = &
mëad©a
->
∂™e_mëa
[
∂™e_num
];

675 
	`ASSERT
((
pm
->
˛ón_ö_¥ogªss
 =0Ë&& (pm->
˛ón_ö_block
 = -1));

676 
pm
->
˛ón_ö_block
 = 
blk
;

677 
pm
->
˛ón_ö_¥ogªss
 = 1;

680 
pm
->
num_˛óns
 ++;

681 
s
->
ñemíts
[
ñem_num
].
°©
.
num_˛ón
 ++;

684 
co°
 +
	`_ssd_˛ón_block_∑πüŒy
(
∂™e_num
, 
ñem_num
, 
s
);

685 } 
mëad©a
->
block_ußge
[
blk
].
num_vÆid
 > 0);

687  
co°
;

688 
	}
}

690 
	$ssd_˛ón_block_fuŒy
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

692 
blk
;

693 
co°
 = 0;

694 
mco°
 = 0;

695 
ssd_ñemít_mëad©a
 *
mëad©a
 = &
s
->
ñemíts
[
ñem_num
].metadata;

696 
∂™e_mëad©a
 *
pm
 = &
mëad©a
->
∂™e_mëa
[
∂™e_num
];

698 
	`ASSERT
((
pm
->
˛ón_ö_¥ogªss
 =0Ë&& (pm->
˛ón_ö_block
 = -1));

700 
blk
 = 
	`ssd_pick_block_to_˛ón
(
∂™e_num
, 
ñem_num
, &
mco°
, 
mëad©a
, 
s
);

701 
	`ASSERT
(
mëad©a
->
block_ußge
[
blk
].
∂™e_num
 ==Ölane_num);

703 
co°
 = 
	`_ssd_˛ón_block_fuŒy
(
blk
, 
∂™e_num
, 
ñem_num
, 
mëad©a
, 
s
);

704  (
co°
+
mco°
);

705 
	}
}

708 
ußge_èbÀ
 *
	$ssd_buûd_ußge_èbÀ
(
ñem_num
, 
ssd_t
 *
s
)

710 
i
;

711 
ußge_èbÀ
 *
èbÀ
;

712 
ssd_ñemít_mëad©a
 *
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

717 
èbÀ
 = (
ußge_èbÀ
 *Ë
	`mÆloc
((ußge_èbÀË* (
s
->
∑øms
.
∑ges_≥r_block
 + 1));

718 
	`mem£t
(
èbÀ
, 0, (
ußge_èbÀ
Ë* (
s
->
∑øms
.
∑ges_≥r_block
 + 1));

721 
i
 = 0; i < 
s
->
∑øms
.
blocks_≥r_ñemít
; i ++) {

722 
ußge
 = 
mëad©a
->
block_ußge
[
i
].
num_vÆid
;

723 
èbÀ
[
ußge
].
Àn
 ++;

727 
i
 = 0; i <
s
->
∑øms
.
∑ges_≥r_block
; i ++) {

728 
èbÀ
[
i
].
block
 = (*)
	`mÆloc
(()*èbÀ[i].
Àn
);

733 
i
 = 0; i < 
s
->
∑øms
.
blocks_≥r_ñemít
; i ++) {

734 
ußge_èbÀ
 *
íåy
;

735 
ußge
 = 
mëad©a
->
block_ußge
[
i
].
num_vÆid
;

737 
íåy
 = &(
èbÀ
[
ußge
]);

738 
íåy
->
block
[íåy->
ãmp
 ++] = 
i
;

741  
èbÀ
;

742 
	}
}

744 
	$ssd_ªÀa£_ußge_èbÀ
(
ußge_èbÀ
 *
èbÀ
, 
ssd_t
 *
s
)

746 
i
;

748 
i
 = 0; i <
s
->
∑øms
.
∑ges_≥r_block
; i ++) {

749 
	`‰ì
(
èbÀ
[
i
].
block
);

753 
	`‰ì
(
èbÀ
);

754 
	}
}

759 
	$ssd_˛ón_blocks_øndom
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

761 
co°
 = 0;

763 
	`¥ötf
("ssd_clean_blocks_random:Çot yet fixed\n");

764 
	`exô
(1);

766 
blk
 = 0;

767 
ssd_ñemít_mëad©a
 *
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

771 
blk
 = 
	`DISKSIM_Ã™d48
(Ë% 
s
->
∑øms
.
blocks_≥r_ñemít
;

775 i‡((
∂™e_num
 !-1Ë&& (
mëad©a
->
block_ußge
[
blk
].plane_num !=Ölane_num)) {

780 i‡(
	`ssd_ˇn_˛ón_block
(
s
, 
mëad©a
, 
blk
)) {

782 
vÆid_∑ges
 = 
mëad©a
->
block_ußge
[
blk
].
num_vÆid
;

786 i‡(
vÆid_∑ges
 =
s
->
∑øms
.
∑ges_≥r_block
) {

790 
co°
 +
	`_ssd_˛ón_block_fuŒy
(
blk
, 
ñem_num
, 
mëad©a
, 
s
);

792 i‡(
	`ssd_°›_˛ónög
(
∂™e_num
, 
ñem_num
, 
s
)) {

803  
co°
;

804 
	}
}

806 
	#GREEDY_IN_COPYBACK
 0

	)

813 
	$ssd_˛ón_blocks_gªedy
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

815 
co°
 = 0;

816 
avg_li„time
;

817 
i
;

818 
ußge_èbÀ
 *
èbÀ
;

819 
ssd_ñemít_mëad©a
 *
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

823 
èbÀ
 = 
	`ssd_buûd_ußge_èbÀ
(
ñem_num
, 
s
);

827 
avg_li„time
 = 
	`ssd_compuã_avg_li„time
(
∂™e_num
, 
ñem_num
, 
s
);

833 
i
 = 0; i <
s
->
∑øms
.
∑ges_≥r_block
; i ++) {

834 
j
;

835 
ußge_èbÀ
 *
íåy
;

838 
íåy
 = &(
èbÀ
[
i
]);

841 
j
 = 0; j < 
íåy
->
Àn
; j ++) {

842 
blk
 = 
íåy
->
block
[
j
];

843 
block_li„
 = 
mëad©a
->
block_ußge
[
blk
].
ªm_li„time
;

847 i‡((
∂™e_num
 !-1Ë&& (
mëad©a
->
block_ußge
[
blk
].plane_num !=Ölane_num)) {

852 i‡(
block_li„
 == 0) {

857 i‡(
	`ssd_ˇn_˛ón_block
(
s
, 
mëad©a
, 
blk
)) {

860 i‡(
s
->
∑øms
.
˛ónög_pﬁicy
 =
DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AWARE
) {

865 i‡(
block_li„
 < (
SSD_LIFETIME_THRESHOLD_X
 * 
avg_li„time
)) {

868 
	`¥ötf
("RateÜimiting block %d (blockÜife %dávgÜife %f\n",

869 
blk
, 
block_li„
, 
avg_li„time
);

871 i‡(
	`ssd_øã_limô
(
block_li„
, 
avg_li„time
)) {

880 
co°
 +
	`_ssd_˛ón_block_fuŒy
(
blk
, 
mëad©a
->
block_ußge
[blk].
∂™e_num
, 
ñem_num
, mëad©a, 
s
);

882 i‡(
	`ssd_°›_˛ónög
(
∂™e_num
, 
ñem_num
, 
s
)) {

889 i‡(
	`ssd_°›_˛ónög
(
∂™e_num
, 
ñem_num
, 
s
)) {

896 
	`ssd_ªÀa£_ußge_èbÀ
(
èbÀ
, 
s
);

899 i‡(!
	`ssd_°›_˛ónög
(
∂™e_num
, 
ñem_num
, 
s
)) {

900 
	`¥ötf
("Yuck! we couldn't generateÉnough freeÖages inÖlane %dÉlem %d ssd %d\n",

901 
∂™e_num
, 
ñem_num
, 
s
->
devno
);

904  
co°
;

905 
	}
}

907 
	$ssd_˛ón_ñemít_no_c›yback
(
ñem_num
, 
ssd_t
 *
s
)

909 
co°
 = 0;

911 i‡(!
	`ssd_°¨t_˛ónög
(-1, 
ñem_num
, 
s
)) {

912  
co°
;

915 
s
->
∑øms
.
˛ónög_pﬁicy
) {

916 
DISKSIM_SSD_CLEANING_POLICY_RANDOM
:

917 
co°
 = 
	`ssd_˛ón_blocks_øndom
(-1, 
ñem_num
, 
s
);

920 
DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AGNOSTIC
:

921 
DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AWARE
:

922 
co°
 = 
	`ssd_˛ón_blocks_gªedy
(-1, 
ñem_num
, 
s
);

926 
	`Ârötf
(
°dîr
, "Error: invalid cleaningÖolicy %d\n",

927 
s
->
∑øms
.
˛ónög_pﬁicy
);

928 
	`exô
(1);

931  
co°
;

932 
	}
}

934 
	$ssd_˛ón_∂™e_c›yback
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

936 
co°
 = 0;

938 
	`ASSERT
(
∂™e_num
 != -1);

940 
s
->
∑øms
.
˛ónög_pﬁicy
) {

941 
DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AGNOSTIC
:

942 
DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AWARE
:

943 
co°
 = 
	`ssd_˛ón_block_fuŒy
(
∂™e_num
, 
ñem_num
, 
s
);

946 
DISKSIM_SSD_CLEANING_POLICY_RANDOM
:

948 
	`Ârötf
(
°dîr
, "Error: invalid cleaningÖolicy %d\n",

949 
s
->
∑øms
.
˛ónög_pﬁicy
);

950 
	`exô
(1);

953  
co°
;

954 
	}
}

960 
	$ssd_˛ón_ñemít_c›yback
(
ñem_num
, 
ssd_t
 *
s
)

963 
˛ón_ªq
 = 0;

964 
i
;

965 
max_˛ónög_co°
 = 0;

966 
∂™e_to_˛ón
[
SSD_MAX_PARUNITS_PER_ELEM
];

967 
ssd_ñemít_mëad©a
 *
mëad©a
 = &
s
->
ñemíts
[
ñem_num
].metadata;

968 
tŸ_˛óns
 = 0;

970 
i
 = 0; i < 
	`SSD_PARUNITS_PER_ELEM
(
s
); i ++) {

971 i‡((
∂™e_to_˛ón
[
i
] = 
	`ssd_°¨t_˛ónög_∑runô
(i, 
ñem_num
, 
s
)) != -1) {

972 
˛ón_ªq
 = 1;

976 i‡(
˛ón_ªq
) {

977 
i
 = 0; i < 
	`SSD_PARUNITS_PER_ELEM
(
s
); i ++) {

978 
˛ónög_co°
 = 0;

979 
∂™e_num
 = 
∂™e_to_˛ón
[
i
];

981 i‡(
∂™e_num
 == -1) {

986 i‡(
mëad©a
->
∂™e_mëa
[
∂™e_num
].
˛ón_ö_¥ogªss
) {

987 
mëad©a
->
∂™e_mëa
[
∂™e_num
].
˛ón_ö_¥ogªss
 = 0;

988 
mëad©a
->
∂™e_mëa
[
∂™e_num
].
˛ón_ö_block
 = -1;

991 
mëad©a
->
a˘ive_∑ge
 = mëad©a->
∂™e_mëa
[
∂™e_num
].active_page;

992 
˛ónög_co°
 = 
	`ssd_˛ón_∂™e_c›yback
(
∂™e_num
, 
ñem_num
, 
s
);

994 
tŸ_˛óns
 ++;

996 i‡(
max_˛ónög_co°
 < 
˛ónög_co°
) {

997 
max_˛ónög_co°
 = 
˛ónög_co°
;

1002  
max_˛ónög_co°
;

1003 
	}
}

1005 
	$ssd_˛ón_ñemít
(
ssd_t
 *
s
, 
ñem_num
)

1007 
co°
 = 0;

1008 i‡(
s
->
∑øms
.
c›y_back
 =
SSD_COPY_BACK_DISABLE
) {

1009 
co°
 = 
	`ssd_˛ón_ñemít_no_c›yback
(
ñem_num
, 
s
);

1011 
co°
 = 
	`ssd_˛ón_ñemít_c›yback
(
ñem_num
, 
s
);

1013  
co°
;

1014 
	}
}

1016 
	$ssd_√xt_∂™e_ö_∑runô
(
∂™e_num
, 
∑runô_num
, 
ñem_num
, 
ssd_t
 *
s
)

1018  (
∑runô_num
*
	`SSD_PLANES_PER_PARUNIT
(
s
Ë+ (
∂™e_num
+1)%SSD_PLANES_PER_PARUNIT(s));

1019 
	}
}

1021 
	$ssd_°¨t_˛ónög_∑runô
(
∑runô_num
, 
ñem_num
, 
ssd_t
 *
s
)

1023 
i
;

1024 
°¨t
;

1026 
°¨t
 = 
s
->
ñemíts
[
ñem_num
].
mëad©a
.
∑runôs
[
∑runô_num
].
∂™e_to_˛ón
;

1027 
i
 = 
°¨t
;

1029 
	`ASSERT
(
∑runô_num
 =
s
->
ñemíts
[
ñem_num
].
mëad©a
.
∂™e_mëa
[
i
].parunit_num);

1030 i‡(
	`ssd_°¨t_˛ónög
(
i
, 
ñem_num
, 
s
)) {

1031 
s
->
ñemíts
[
ñem_num
].
mëad©a
.
∑runôs
[
∑runô_num
].
∂™e_to_˛ón
 = \

1032 
	`ssd_√xt_∂™e_ö_∑runô
(
i
, 
∑runô_num
, 
ñem_num
, 
s
);

1033  
i
;

1036 
i
 = 
	`ssd_√xt_∂™e_ö_∑runô
(i, 
∑runô_num
, 
ñem_num
, 
s
);

1037 } 
i
 !
°¨t
);

1040 
	}
}

1046 
	$ssd_°¨t_˛ónög
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

1048 i‡(
∂™e_num
 == -1) {

1049 
low
 = ()
	`LOW_WATERMARK_PER_ELEMENT
(
s
);

1050  (
s
->
ñemíts
[
ñem_num
].
mëad©a
.
tŸ_‰ì_blocks
 <
low
);

1052 
low
 = ()
	`LOW_WATERMARK_PER_PLANE
(
s
);

1053  (
s
->
ñemíts
[
ñem_num
].
mëad©a
.
∂™e_mëa
[
∂™e_num
].
‰ì_blocks
 <
low
);

1055 
	}
}

1061 
	$ssd_°›_˛ónög
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

1063 i‡(
∂™e_num
 == -1) {

1064 
high
 = ()
	`HIGH_WATERMARK_PER_ELEMENT
(
s
);

1065  (
s
->
ñemíts
[
ñem_num
].
mëad©a
.
tŸ_‰ì_blocks
 > 
high
);

1067 
high
 = ()
	`HIGH_WATERMARK_PER_PLANE
(
s
);

1068  (
s
->
ñemíts
[
ñem_num
].
mëad©a
.
∂™e_mëa
[
∂™e_num
].
‰ì_blocks
 > 
high
);

1070 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_clean.h

4 #i‚de‡
_DISKSIM_SSD_CLEAN_H


5 
	#_DISKSIM_SSD_CLEAN_H


	)

7 
	~"ssd.h
"

8 
	~"moduÀs/ssdmodñ_ssd_∑øm.h
"

12 
	#DISKSIM_SSD_CLEANING_POLICY_RANDOM
 1

	)

13 
	#DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AGNOSTIC
 2

	)

14 
	#DISKSIM_SSD_CLEANING_POLICY_GREEDY_WEAR_AWARE
 3

	)

18 
	#SSD_MAX_ERASURES
 50

	)

19 
	#SSD_LIFETIME_THRESHOLD_X
 0.80

	)

20 
	#SSD_LIFETIME_THRESHOLD_Y
 0.85

	)

23 
	#SSD_RATELIMIT_WINDOW
 0.80

	)

28 
	#LOW_WATERMARK_PER_ELEMENT
(
s
Ë((s)->
∑øms
.
blocks_≥r_ñemít
 * ((1.0*(s)->∑øms.
mö_‰ìblks_≥r˚¡
)/100.0))

	)

29 
	#HIGH_WATERMARK_PER_ELEMENT
(
s
Ë(
	`LOW_WATERMARK_PER_ELEMENT
(sË+ 1)

	)

32 
	#LOW_WATERMARK_PER_PLANE
(
s
Ë((s)->
∑øms
.
blocks_≥r_∂™e
 * ((1.0*(s)->∑øms.
mö_‰ìblks_≥r˚¡
)/100.0))

	)

33 
	#HIGH_WATERMARK_PER_PLANE
(
s
Ë(
	`LOW_WATERMARK_PER_PLANE
(sË+ 1)

	)

37 
	#LOW_WATERMARK_PER_ELEMENT
(
s
Ë(800)

	)

38 
	#HIGH_WATERMARK_PER_ELEMENT
(
s
Ë(1000)

	)

40 
	#LOW_WATERMARK_PER_PLANE
(
s
Ë(125)

	)

41 
	#HIGH_WATERMARK_PER_PLANE
(
s
Ë(125)

	)

46 
	s_ußge_èbÀ
 {

47 
	mÀn
;

48 
	mãmp
;

49 *
	mblock
;

50 } 
	tußge_èbÀ
;

52 
ssd_compuã_avg_li„time
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
);

53 
ssd_˛ón_block_∑πüŒy
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
);

54 
ssd_˛ón_ñemít_no_c›yback
(
ñem_num
, 
ssd_t
 *
s
);

55 
ssd_‰ì_bôs
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

56 
ssd_as£π_∂™e_‰ìbôs
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

58 
_ssd_˛ón_block_fuŒy
(
blk
, 
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

59 
ssd_˛ón_ñemít
(
ssd_t
 *
s
, 
ñem_num
);

60 
ssd_√xt_∂™e_ö_∑runô
(
∂™e_num
, 
∑runô_num
, 
ñem_num
, 
ssd_t
 *
s
);

61 
ssd_°¨t_˛ónög_∑runô
(
∑runô_num
, 
ñem_num
, 
ssd_t
 *
s
);

62 
ssd_°¨t_˛ónög
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
);

63 
ssd_°›_˛ónög
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
);

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_gang.c

4 
	~"ssd.h
"

5 
	~"ssd_g™g.h
"

6 
	~"ssd_timög.h
"

8 
	$ssd_övoke_g™g_˛ónög
(
g™g_num
, 
ssd_t
 *
s
)

10 
i
;

11 
ñem_num
;

12 
max_co°
 = 0;

13 
ñem_˛ón_co°
;

14 
˛ónög_övoked
 = 0;

15 
g™g_mëad©a
 *
g
 = &
s
->
g™g_mëa
[
g™g_num
];

18 
	`ASSERT
(
g
->
busy
 =
FALSE
);

19 
	`ASSERT
(
g
->
˛ónög
 =
FALSE
);

22 
i
 = 0; i < 
s
->
∑øms
.
ñemíts_≥r_g™g
; i ++) {

23 
ñem_num
 = 
g™g_num
 * 
s
->
∑øms
.
ñemíts_≥r_g™g
 + 
i
;

24 
ñem_˛ón_co°
 = 
	`_ssd_övoke_ñemít_˛ónög
(
ñem_num
, 
s
);

27 
s
->
ñemíts
[
ñem_num
].
°©
.
tŸ_˛ón_time
 +
max_co°
;

29 i‡(
max_co°
 < 
ñem_˛ón_co°
) {

30 
max_co°
 = 
ñem_˛ón_co°
;

37 i‡(
max_co°
 > 0) {

38 
i‹eq_evít
 *
tmp
;

40 
g
->
busy
 = 1;

41 
g
->
˛ónög
 = 1;

42 
˛ónög_övoked
 = 1;

45 
tmp
 = (
i‹eq_evít
 *)
	`gë‰omexåaq
();

46 
tmp
->
devno
 = 
s
->devno;

47 
tmp
->
time
 = 
simtime
 + 
max_co°
;

48 
tmp
->
blkno
 = 
g™g_num
;

49 
tmp
->
ssd_g™g_num
 = 
g™g_num
;

50 
tmp
->
ty≥
 = 
SSD_CLEAN_GANG
;

51 
tmp
->
Êags
 = 
SSD_CLEAN_GANG
;

52 
tmp
->
bu¢o
 = -1;

53 
tmp
->
bcou¡
 = -1;

54 
	`°©_upd©e
 (&
s
->
°©
.
ac˘ime°©s
, 
max_co°
);

55 
	`addtoötq
 ((
evít
 *)
tmp
);

58  
˛ónög_övoked
;

59 
	}
}

61 
	$ssd_√xt_ñem_ö_g™g
(
ssd_t
 *
s
, 
g™g_num
, 
ñem_num
)

63  ((
ñem_num
+1)%
s
->
∑øms
.
ñemíts_≥r_g™g
 + \

64 
g™g_num
*
s
->
∑øms
.
ñemíts_≥r_g™g
);

65 
	}
}

70 
	gssd_cﬁÀ˘_ªq_ö_g™g


71 (
ssd_t
 *
	gs
, 
	gg™g_num
, 
ssd_ªq
 ***
	grd_q
, ssd_ªq ***
	gwr_q
, *
	grd_tŸÆ
, *
	gwr_tŸÆ
)

73 
	gi
;

74 
	g°¨t
;

75 
g™g_mëad©a
 *
	gg
;

77 
	gg
 = &
s
->
g™g_mëa
[
g™g_num
];

80 
	g°¨t
 = 
g™g_num
 * 
s
->
∑øms
.
ñemíts_≥r_g™g
;

81 
	gi
 = 
°¨t
;

83 *
	grd_tŸÆ
 = 0;

84 *
	gwr_tŸÆ
 = 0;

87 
ssd_ñemít
 *
	gñem
;

88 
i‹eq_evít
 *
	gªq
;

89 
	gtŸ_rd_ªqs
;

90 
	gtŸ_wr_ªqs
;

91 
	gj
;

93 
	gñem
 = &
s
->
ñemíts
[
i
];

94 
ASSERT
(
ioqueue_gë_ªqout°™dög
(
ñem
->
queue
) == 0);

95 
	gj
 = 
i
 % 
s
->
∑øms
.
ñemíts_≥r_g™g
;

98 
	gtŸ_rd_ªqs
 = 0;

99 
	gtŸ_wr_ªqs
 = 0;

100 i‡((
	gªq
 = 
ioqueue_gë_√xt_ªque°
(
ñem
->
queue
)Ë!
NULL
) {

101 
found
;

103 i‡(
	gªq
->
	gÊags
 & 
	gREAD
) {

104 
	gfound
 = 
ssd_Æªady_¥e£¡
(
rd_q
[
j
], 
tŸ_rd_ªqs
, 
ªq
);

106 
	gfound
 = 
ssd_Æªady_¥e£¡
(
wr_q
[
j
], 
tŸ_wr_ªqs
, 
ªq
);

109 i‡(!
	gfound
) {

111 
ssd_ªq
 *
	gr
 = 
mÆloc
((ssd_req));

112 
	gr
->
	gblk
 = 
ªq
->
blkno
;

113 
	gr
->
	gcou¡
 = 
ªq
->
bcou¡
;

114 
	gr
->
	gis_ªad
 = 
ªq
->
Êags
 & 
READ
;

115 
	gr
->
	g‹g_ªq
 = 
ªq
;

116 
	gr
->
	g∂™e_num
 = -1;

118 i‡(
	gªq
->
	gÊags
 & 
	gREAD
) {

119 
	grd_q
[
j
][
tŸ_rd_ªqs
] = 
r
;

120 
	gtŸ_rd_ªqs
 ++;

122 
	gwr_q
[
j
][
tŸ_wr_ªqs
] = 
r
;

123 
	gtŸ_wr_ªqs
 ++;

127 
°©_upd©e
 (&
s
->
°©
.
ac˘ime°©s
, 0);

128 
	gªq
->
	gtime
 = 
simtime
;

129 
	gªq
->
	gssd_ñem_num
 = 
i
;

130 
	gªq
->
	gssd_g™g_num
 = 
g™g_num
;

132 
	gªq
->
	gty≥
 = 
DEVICE_ACCESS_COMPLETE
;

133 
addtoötq
 ((
evít
 *)
ªq
);

136 
ASSERT
((
tŸ_rd_ªqs
 < 
MAX_REQS
Ë&& (
tŸ_wr_ªqs
 < MAX_REQS))

139 *
	grd_tŸÆ
 = *
rd_tŸÆ
 + 
tŸ_rd_ªqs
;

140 *
	gwr_tŸÆ
 = *
wr_tŸÆ
 + 
tŸ_wr_ªqs
;

143 
	gi
 = 
ssd_√xt_ñem_ö_g™g
(
s
, 
g™g_num
, 
i
);

144 } 
	gi
 !
°¨t
);

147 
	$choo£_g™g
(
blk
, 
ssd_t
 *
s
)

149 
num_g™gs
 = 
	`SSD_NUM_GANG
(
s
);

150 
∑ge
 = 
blk
 / 
s
->
∑øms
.
∑ge_size
;

153  ((
∑ge
/
s
->
∑øms
.
ñemíts_≥r_g™g
Ë% 
num_g™gs
);

154 
	}
}

156 
	$ssd_g™g_ödex
(
blk
, 
ssd_t
 *
s
)

158 
∑ge
 = 
blk
/
s
->
∑øms
.
∑ge_size
;

159 
i
 = 
∑ge
/
s
->
∑øms
.
ñemíts_≥r_g™g
;

160  (
i
/
	`SSD_NUM_GANG
(
s
));

161 
	}
}

163 
	$choo£_ñem_ö_g™g
(
blk
, 
g™g_num
, 
ssd_t
 *
s
)

165 
j
;

166 
ñem_num
;

167 
num_g™gs
 = 
	`SSD_NUM_GANG
(
s
);

168 
∑ge
 = 
blk
 / 
s
->
∑øms
.
∑ge_size
;

169 
pg_ödex_ö_g™g
;

170 
g™g_mëad©a
 *
gm
 = &
s
->
g™g_mëa
[
g™g_num
];

172 
pg_ödex_ö_g™g
 = 
	`ssd_g™g_ödex
(
blk
, 
s
);

175 
ñem_num
 = (
g™g_num
)*
s
->
∑øms
.
ñemíts_≥r_g™g
 + 
∑ge
%s->params.elements_per_gang;

176 
j
 = (
∑ge
 % 
s
->
∑øms
.
ñemíts_≥r_g™g
Ë* s->
d©a_∑ges_≥r_ñem
 + 
pg_ödex_ö_g™g
;

178 
	`ASSERT
(
ñem_num
 =()
gm
->
pg2ñem
[
j
].
e
);

179 
	`ASSERT
((
ñem_num
 >(
g™g_num
)*
s
->
∑øms
.
ñemíts_≥r_g™g
) && (elem_num < (gang_num+1)*s->params.elements_per_gang));

181  
ñem_num
;

182 
	}
}

184 
	$choo£_g™g_™d_ñemít
(
blk
, 
i‹eq_evít
 *
ªq
, 
ssd_t
 *
s
, *
g™g_num
, *
ñem_num
)

186 
gnum
 = 
	`choo£_g™g
(
blk
, 
s
);

187 
e
 = 
	`choo£_ñem_ö_g™g
(
blk
, 
gnum
, 
s
);

188 *
g™g_num
 = 
gnum
;

189 *
ñem_num
 = 
e
;

192 
	}
}

194 
	$ssd_g™g_ªad_sync
(
g™g_num
, 
blkno
, 
cou¡
, 
ssd_t
 *
s
)

196 
g™g_mëad©a
 *
g
;

197 
ªq_time
 = 0;

198 
blk
;

199 
gödex
;

201 
g
 = &
s
->
g™g_mëa
[
g™g_num
];

202 
blk
 = 
blkno
;

203 
ªq_time
 = 0;

204 
	`ASSERT
(
cou¡
 <
	`SSD_GANG_PAGE_SIZE
(
s
));

206 
gödex
 = 
	`ssd_g™g_ödex
(
blkno
, 
s
);

209 
cou¡
 > 0) {

210 
ssd_ñemít
 *
ñem
;

211 
ñem_num
;

212 
ac˘ime
 = 0;

214 
	`ASSERT
(
gödex
 =
	`ssd_g™g_ödex
(
blk
, 
s
));

215 
ñem_num
 = 
	`choo£_ñem_ö_g™g
(
blk
, 
g™g_num
, 
s
);

216 
ñem
 = &
s
->
ñemíts
[
ñem_num
];

220 
ac˘ime
 = 
s
->
∑øms
.
∑ge_ªad_œãncy
;

225 
ac˘ime
 +
	`ssd_d©a_å™s„r_co°
(
s
, s->
∑øms
.
∑ge_size
);

228 
ñem
->
°©
.
tŸ_ªqs_issued
 ++;

229 
ñem
->
°©
.
tŸ_time_èkí
 +
ac˘ime
;

230 
	`°©_upd©e
 (&
s
->
°©
.
ac˘ime°©s
, 
ac˘ime
);

231 
ªq_time
 +
ac˘ime
;

237 
blk
 +
s
->
∑øms
.
∑ge_size
;

238 
cou¡
 -
s
->
∑øms
.
∑ge_size
;

241  
ªq_time
;

242 
	}
}

247 
	$ssd_a˘iv©e_g™g_sync
(
g™g_num
, 
ssd_t
 *
s
)

249 
i‹eq_evít
 *
ªq
;

250 
g™g_mëad©a
 *
g
;

252 
g
 = &
s
->
g™g_mëa
[
g™g_num
];

253 i‡(
g
->
busy
) {

257 i‡(
s
->
∑øms
.
˛ónög_ö_background
) {

259 i‡(
	`ssd_övoke_g™g_˛ónög
(
g™g_num
, 
s
)) {

264 i‡(
g
->
ªqs_waôög
 > 0) {

265 
ªq_time
 = 0;

269 i‡(!
s
->
∑øms
.
˛ónög_ö_background
) {

271 i‡(
	`ssd_övoke_g™g_˛ónög
(
g™g_num
, 
s
)) {

276 
ªq
 = 
	`ioqueue_gë_√xt_ªque°
(
g
->
queue
);

277 
	`ASSERT
(
ªq
 !
NULL
);

280 
	`ASSERT
(
ªq
->
bcou¡
 <
	`SSD_GANG_PAGE_SIZE
(
s
));

283 i‡(
ªq
->
Êags
 & 
READ
) {

284 
g
->
busy
 = 
TRUE
;

285 
ªq_time
 = 
	`ssd_g™g_ªad_sync
(
g™g_num
, 
ªq
->
blkno
,Ñeq->
bcou¡
, 
s
);

288 
ªq
->
time
 = 
simtime
 + 
ªq_time
;

289 
ªq
->
ty≥
 = 
DEVICE_ACCESS_COMPLETE
;

290 
ªq
->
ssd_g™g_num
 = 
g™g_num
;

291 
	`addtoötq
 ((
evít
 *)
ªq
);

300 
ªad_time
 = 0;

301 
x„r_time
 = 0;

302 
cou¡
, 
blk
, 
pg
, 
°¨t_pg
;

303 
gödex
;

304 
wrŸe_summ¨y
 = 0;

305 
ssd_ªq
 *
ñem_ªq
[1];

307 
g
->
busy
 = 
TRUE
;

310 
pg
 = 
ªq
->
blkno
 / 
s
->
∑øms
.
∑ge_size
;

311 
°¨t_pg
 = 
pg
 -Ög % 
s
->
∑øms
.
ñemíts_≥r_g™g
;

312 
gödex
 = 
	`ssd_g™g_ödex
(
ªq
->
blkno
, 
s
);

314 i‡(
ªq
->
bcou¡
 !
	`SSD_GANG_PAGE_SIZE
(
s
)) {

315 
blk
 = 
°¨t_pg
 * 
s
->
∑øms
.
∑ge_size
;

316 
cou¡
 = 
	`SSD_GANG_PAGE_SIZE
(
s
);

319 
cou¡
 > 0) {

321 
	`ASSERT
(
gödex
 =
	`ssd_g™g_ödex
(
blk
, 
s
));

322 i‡((
ªq
->
blkno
 <
blk
Ë&& ((blk+
s
->
∑øms
.
∑ge_size
-1Ë< (ªq->blkno+ªq->
bcou¡
))) {

332 
cou¡
 -
s
->
∑øms
.
∑ge_size
;

333 
blk
 +
s
->
∑øms
.
∑ge_size
;

336 
ªad_time
 +
s
->
∑øms
.
∑ge_ªad_œãncy
;

340 
ñem_ªq
[0] = 
	`mÆloc
((
ssd_ªq
));

341 
	`mem£t
(
ñem_ªq
[0], 0, (
ssd_ªq
));

343 
blk
 = 
°¨t_pg
 * 
s
->
∑øms
.
∑ge_size
;

344 
cou¡
 = 
	`SSD_GANG_PAGE_SIZE
(
s
);

345 
ªq_time
 = 
ªad_time
;

348 
cou¡
 > 0) {

349 
ssd_ñemít
 *
ñem
;

350 
ñem_num
;

351 
x„πime
;

352 
ac˘ime
;

354 
	`ASSERT
(
gödex
 =
	`ssd_g™g_ödex
(
blk
, 
s
));

355 
ñem_num
 = 
	`choo£_ñem_ö_g™g
(
blk
, 
g™g_num
, 
s
);

356 
ñem
 = &
s
->
ñemíts
[
ñem_num
];

357 
ñem_ªq
[0]->
blk
 = blk;

358 
ñem_ªq
[0]->
cou¡
 = 
s
->
∑øms
.
∑ge_size
;

359 
ñem_ªq
[0]->
is_ªad
 = 0;

363 
	`ssd_compuã_ac˚ss_time
(
s
, 
ñem_num
, &
ñem_ªq
[0], 1);

366 
x„πime
 = 
	`ssd_d©a_å™s„r_co°
(
s
, s->
∑øms
.
∑ge_size
);

367 
ac˘ime
 = 
ªad_time
 + 
ñem_ªq
[0]->acctime;

368 
ñem
->
°©
.
tŸ_ªqs_issued
 ++;

369 
ñem
->
°©
.
tŸ_time_èkí
 +
ac˘ime
;

370 
	`°©_upd©e
 (&
s
->
°©
.
ac˘ime°©s
, 
ac˘ime
);

371 
ªq_time
 +
x„πime
;

374 i‡(
ñem_ªq
[0]->
ac˘ime
 > (
x„πime
 + 
s
->
∑øms
.
∑ge_wrôe_œãncy
)) {

375 
wrŸe_summ¨y
 = 1;

379 
blk
 +
s
->
∑øms
.
∑ge_size
;

380 
cou¡
 -
s
->
∑øms
.
∑ge_size
;

384 i‡(
wrŸe_summ¨y
) {

385 
ªq_time
 +=Ñeq_time;

386 
ªq_time
 +2 * 
s
->
∑øms
.
∑ge_wrôe_œãncy
;

388 
ªq_time
 +
s
->
∑øms
.
∑ge_wrôe_œãncy
;

392 
ªq
->
time
 = 
simtime
 + 
ªq_time
;

393 
ªq
->
ty≥
 = 
DEVICE_ACCESS_COMPLETE
;

394 
ªq
->
ssd_g™g_num
 = 
g™g_num
;

395 
	`addtoötq
 ((
evít
 *)
ªq
);

398 
	`‰ì
(
ñem_ªq
[0]);

402 
g
->
ªqs_waôög
 --;

404 
	}
}

406 
	g_ssd_a˘iv©e_g™g


407 (
ssd_t
 *
	gs
, 
g™g_mëad©a
 *
	gg
, 
	gg™g_num
, 
ssd_ªq
 ***
	gªqs_queue
, 
	gªad_Êag
, 
	gtŸÆ
)

409 
	ga·î
 = 0;

410 
ssd_ªq
 ***
	gfú°
;

411 
	gi
;

413 i‡(
	gtŸÆ
 == 0) {

417 
	gfú°
 = (
ssd_ªq
 ***Ë
mÆloc
 (
s
->
∑øms
.
ñemíts_≥r_g™g
 * (ssd_req **));

418 
	gi
 = 0; i < 
	gs
->
	g∑øms
.
	gñemíts_≥r_g™g
; i ++) {

419 
	gfú°
[
i
] = &
ªqs_queue
[i][0];

423 
	gskù
 = 0;

424 
	gac˘ime
 = 0;

425 
	gªqs_issued
 = 0;

428 
	gi
 = 0; i < 
	gs
->
	g∑øms
.
	gñemíts_≥r_g™g
; i ++) {

431 i‡(
	gªqs_queue
[
i
][0]) {

432 
ssd_ªq
 *
	gto_‰ì
;

433 
ssd_ñemít
 *
	gñem
;

434 
	gñem_num
;

436 
	gñem_num
 = 
g™g_num
 * 
s
->
∑øms
.
ñemíts_≥r_g™g
 + 
i
;

437 
	gñem
 = &
s
->
ñemíts
[
ñem_num
];

439 
	gg
->
	gbusy
 = 1;

440 
	gñem
->
	gmedü_busy
 = 
TRUE
;

443 
ssd_compuã_ac˚ss_time
(
s
, 
ñem_num
, 
ªqs_queue
[
i
], 1);

446 i‡(
	gac˘ime
 < 
	gªqs_queue
[
i
][0]->acctime) {

447 
	gac˘ime
 = 
ªqs_queue
[
i
][0]->
ac˘ime
;

450 
	gñem
->
	g°©
.
	gtŸ_ªqs_issued
 ++;

451 
	gñem
->
	g°©
.
	gtŸ_time_èkí
 +
ªqs_queue
[
i
][0]->
ac˘ime
;

454 
°©_upd©e
 (&
s
->
°©
.
ac˘ime°©s
, 
ªqs_queue
[
i
][0]->
ac˘ime
);

455 
	gªqs_queue
[
i
][0]->
	g‹g_ªq
->
	gtime
 = 
simtime
 + 
a·î
 + 
ªqs_queue
[i][0]->
ac˘ime
;

456 
	gªqs_queue
[
i
][0]->
	g‹g_ªq
->
	gty≥
 = 
DEVICE_ACCESS_COMPLETE
;

457 
	gªqs_queue
[
i
][0]->
	g‹g_ªq
->
	gssd_ñem_num
 = 
ñem_num
;

458 
	gªqs_queue
[
i
][0]->
	g‹g_ªq
->
	gssd_g™g_num
 = 
g™g_num
;

460 
addtoötq
 ((
evít
 *)
ªqs_queue
[
i
][0]->
‹g_ªq
);

463 
	gto_‰ì
 = 
ªqs_queue
[
i
][0];

466 
	gªqs_queue
[
i
] = &
ªqs_queue
[i][1];

467 
‰ì
(
to_‰ì
);

469 
	gªqs_issued
 ++;

473 i‡(
	gs
->
	g∑øms
.
	gg™g_sh¨e
 =
SSD_SHARED_BUS_GANG
) {

474 i‡(
ªqs_issued
 == 1) {

479 
	gskù
 ++;

485 
	ga·î
 = 
a·î
 + 
ac˘ime
;

488 i‡(
	gskù
 =
s
->
∑øms
.
ñemíts_≥r_g™g
) {

494 
	gi
 = 0; i < 
	gs
->
	g∑øms
.
	gñemíts_≥r_g™g
; i ++) {

495 
	gªqs_queue
[
i
] = 
fú°
[i];

498 
‰ì
(
fú°
);

505 
	$ssd_a˘iv©e_g™g
(
ssd_t
 *
s
, 
g™g_num
)

507 
i
;

508 
ssd_ªq
 ***
rd_q
;

509 
ssd_ªq
 ***
wr_q
;

510 
g™g_mëad©a
 *
g
;

512 
g
 = &
s
->
g™g_mëa
[
g™g_num
];

513 i‡(
g
->
busy
) {

517 i‡(
s
->
∑øms
.
˛ónög_ö_background
) {

520 i‡(
	`ssd_övoke_g™g_˛ónög
(
g™g_num
, 
s
)) {

525 i‡(
g
->
ªqs_waôög
 > 0) {

526 
rd_tŸÆ
;

527 
wr_tŸÆ
;

531 i‡(!
s
->
∑øms
.
˛ónög_ö_background
) {

534 i‡(
	`ssd_övoke_g™g_˛ónög
(
g™g_num
, 
s
)) {

540 
rd_q
 = (
ssd_ªq
 ***Ë
	`mÆloc
(
s
->
∑øms
.
ñemíts_≥r_g™g
 *  (ssd_req **));

541 
wr_q
 = (
ssd_ªq
 ***Ë
	`mÆloc
(
s
->
∑øms
.
ñemíts_≥r_g™g
 *  (ssd_req **));

542 
i
 = 0; i < 
s
->
∑øms
.
ñemíts_≥r_g™g
; i ++) {

543 
rd_q
[
i
] = 
	`mÆloc
(
MAX_REQS
 * (
ssd_ªq
 *));

544 
wr_q
[
i
] = 
	`mÆloc
(
MAX_REQS
 * (
ssd_ªq
 *));

545 
	`mem£t
(
rd_q
[
i
], 0, 
MAX_REQS
 * (
ssd_ªq
 *));

546 
	`mem£t
(
wr_q
[
i
], 0, 
MAX_REQS
 * (
ssd_ªq
 *));

550 
	`ssd_cﬁÀ˘_ªq_ö_g™g
(
s
, 
g™g_num
, 
rd_q
, 
wr_q
, &
rd_tŸÆ
, &
wr_tŸÆ
);

553 
	`_ssd_a˘iv©e_g™g
(
s
, 
g
, 
g™g_num
, 
rd_q
, 1, 
rd_tŸÆ
);

554 
	`_ssd_a˘iv©e_g™g
(
s
, 
g
, 
g™g_num
, 
wr_q
, 0, 
wr_tŸÆ
);

556 
g
->
ªqs_waôög
 -(
rd_tŸÆ
 + 
wr_tŸÆ
);

559 
i
 = 0; i < 
s
->
∑øms
.
ñemíts_≥r_g™g
; i ++) {

560 
	`‰ì
(
rd_q
[
i
]);

561 
	`‰ì
(
wr_q
[
i
]);

563 
	`‰ì
(
rd_q
);

564 
	`‰ì
(
wr_q
);

566 
	}
}

568 
	$ssd_medü_ac˚ss_ªque°_g™g_sync
(
i‹eq_evít
 *
cuº
)

570 
i
;

571 
g™g_to_a˘iv©e
[
SSD_MAX_ELEMENTS
];

572 
ssd_t
 *
cuºdisk
 = 
	`gëssd
(
cuº
->
devno
);

573 
blkno
 = 
cuº
->blkno;

574 
cou¡
 = 
cuº
->
bcou¡
;

576 
	`mem£t
(
g™g_to_a˘iv©e
, 0, 
SSD_MAX_ELEMENTS
 * ());

579 
cuº
->
ãmpöt2
 = 
cou¡
;

580 
cou¡
 != 0) {

581 
g™g_num
;

582 
i‹eq_evít
 *
tmp
;

583 
g™g_mëad©a
 *
g
;

585 
g™g_num
 = 
	`choo£_g™g
(
blkno
, 
cuºdisk
);

586 
g
 = &
cuºdisk
->
g™g_mëa
[
g™g_num
];

589 
g™g_to_a˘iv©e
[
g™g_num
] = 1;

592 
tmp
 = (
i‹eq_evít
 *)
	`gë‰omexåaq
();

593 
tmp
->
devno
 = 
cuº
->devno;

594 
tmp
->
bu¢o
 = 
cuº
->busno;

595 
tmp
->
Êags
 = 
cuº
->flags;

596 
tmp
->
blkno
 = blkno;

597 
tmp
->
ãmµå2
 = 
cuº
;

598 
tmp
->
bcou¡
 = 
	`ssd_choo£_Æig√d_cou¡
(
	`SSD_GANG_PAGE_SIZE
(
cuºdisk
), 
blkno
, 
cou¡
);

599 
	`ASSERT
(
tmp
->
bcou¡
 <
	`SSD_GANG_PAGE_SIZE
(
cuºdisk
));

601 
blkno
 +
tmp
->
bcou¡
;

602 
cou¡
 -
tmp
->
bcou¡
;

605 
	`ioqueue_add_√w_ªque°
(
g
->
queue
, (
i‹eq_evít
 *)
tmp
);

610 
g
->
ªqs_waôög
 ++;

611 i‡(
g
->
ªqs_waôög
 == 1) {

612 
g
->
ﬁde°
 = 
simtime
;

617 
i
 = 0; i < 
	`SSD_NUM_GANG
(
cuºdisk
); i ++) {

618 i‡(
g™g_to_a˘iv©e
[
i
]) {

619 
	`ssd_a˘iv©e_g™g_sync
(
i
, 
cuºdisk
);

622 
	}
}

624 
	$ssd_medü_ac˚ss_ªque°_g™g
 (
i‹eq_evít
 *
cuº
)

626 
i
;

627 
g™g_to_a˘iv©e
[
SSD_MAX_ELEMENTS
];

628 
ssd_t
 *
cuºdisk
 = 
	`gëssd
(
cuº
->
devno
);

629 
blkno
 = 
cuº
->blkno;

630 
cou¡
 = 
cuº
->
bcou¡
;

632 
	`mem£t
(
g™g_to_a˘iv©e
, 0, 
SSD_MAX_ELEMENTS
 * ());

635 
cuº
->
ãmpöt2
 = 
cou¡
;

636 
cou¡
 != 0) {

637 
g™g_num
;

638 
ñem_num
;

639 
ssd_ñemít
 *
ñem
;

640 
i‹eq_evít
 *
tmp
;

641 
g™g_mëad©a
 *
g
;

644 
	`choo£_g™g_™d_ñemít
(
blkno
, 
cuº
, 
cuºdisk
, &
g™g_num
, &
ñem_num
);

647 
g™g_to_a˘iv©e
[
g™g_num
] = 1;

649 
g
 = &
cuºdisk
->
g™g_mëa
[
g™g_num
];

650 
ñem
 = &
cuºdisk
->
ñemíts
[
ñem_num
];

653 
tmp
 = (
i‹eq_evít
 *)
	`gë‰omexåaq
();

654 
tmp
->
devno
 = 
cuº
->devno;

655 
tmp
->
bu¢o
 = 
cuº
->busno;

656 
tmp
->
Êags
 = 
cuº
->flags;

657 
tmp
->
blkno
 = blkno;

658 
tmp
->
bcou¡
 = 
	`ssd_choo£_Æig√d_cou¡
(
cuºdisk
->
∑øms
.
∑ge_size
, 
blkno
, 
cou¡
);

659 
	`ASSERT
(
tmp
->
bcou¡
 =
cuºdisk
->
∑øms
.
∑ge_size
);

661 
tmp
->
ãmµå2
 = 
cuº
;

662 
blkno
 +
tmp
->
bcou¡
;

663 
cou¡
 -
tmp
->
bcou¡
;

666 
	`ioqueue_add_√w_ªque°
(
ñem
->
queue
, (
i‹eq_evít
 *)
tmp
);

671 
g
->
ªqs_waôög
 ++;

672 i‡(
g
->
ªqs_waôög
 == 1) {

673 
g
->
ﬁde°
 = 
simtime
;

678 
i
 = 0; i < 
	`SSD_NUM_GANG
(
cuºdisk
); i ++) {

679 i‡(
g™g_to_a˘iv©e
[
i
]) {

680 
	`ssd_a˘iv©e_g™g
(
cuºdisk
, 
i
);

683 
	}
}

688 
	$ssd_˛ón_g™g_com∂ëe
(
i‹eq_evít
 *
cuº
)

690 
ssd_t
 *
cuºdisk
;

691 
i
;

692 
g™g_num
;

694 
cuºdisk
 = 
	`gëssd
 (
cuº
->
devno
);

695 
g™g_num
 = 
cuº
->
ssd_g™g_num
;

697 
	`ASSERT
(
cuºdisk
->
g™g_mëa
[
g™g_num
].
busy
 =
TRUE
);

698 
	`ASSERT
(
cuºdisk
->
g™g_mëa
[
g™g_num
].
˛ónög
 =
TRUE
);

701 
i
 = 0; i < 
cuºdisk
->
∑øms
.
ñemíts_≥r_g™g
; i ++) {

702 
e
 = 
g™g_num
 * 
cuºdisk
->
∑øms
.
ñemíts_≥r_g™g
 + 
i
;

703 
	`ASSERT
 (
cuºdisk
->
ñemíts
[
e
].
medü_busy
 =
FALSE
);

707 
	`addt€xåaq
((
evít
 *Ë
cuº
);

710 
cuºdisk
->
g™g_mëa
[
g™g_num
].
busy
 = 0;

711 
cuºdisk
->
g™g_mëa
[
g™g_num
].
˛ónög
 = 0;

713 #i‡
SYNC_GANG


714 
	`ssd_a˘iv©e_g™g_sync
(
g™g_num
, 
cuºdisk
);

716 
	`ssd_a˘iv©e_g™g
(
cuºdisk
, 
g™g_num
);

718 
	}
}

720 
	$ssd_ac˚ss_com∂ëe_g™g_sync
(
i‹eq_evít
 *
cuº
)

722 
ssd_t
 *
cuºdisk
;

723 
g™g_num
;

724 
g™g_mëad©a
 *
gm
;

726 
cuºdisk
 = 
	`gëssd
 (
cuº
->
devno
);

727 
g™g_num
 = 
cuº
->
ssd_g™g_num
;

728 
gm
 = &
cuºdisk
->
g™g_mëa
[
g™g_num
];

730 i‡(
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
gm
->
queue
,
cuº
Ë=
NULL
) {

731 
	`Ârötf
(
°dîr
, "ssd_access_complete_gang_sync: ioreq_eventÇot found by ioqueue_physical_access_done call\n");

732 
	`ASSERT
(0);

736 
	`ASSERT
(
cuºdisk
->
g™g_mëa
[
g™g_num
].
˛ónög
 == 0);

737 i‡(
	`ioqueue_gë_ªqout°™dög
(
gm
->
queue
) == 0) {

738 
gm
->
busy
 = 
FALSE
;

741 
	`ssd_com∂ëe_∑ª¡
(
cuº
, 
cuºdisk
);

742 
	`addt€xåaq
((
evít
 *Ë
cuº
);

743 
	`ssd_a˘iv©e_g™g_sync
(
g™g_num
, 
cuºdisk
);

744 
	}
}

746 
	$ssd_ac˚ss_com∂ëe_g™g
 (
i‹eq_evít
 *
cuº
)

748 
ssd_t
 *
cuºdisk
;

749 
ñem_num
;

750 
ssd_ñemít
 *
ñem
;

751 
i‹eq_evít
 *
x
;

752 
i
;

753 
g™g_num
;

754 
some_ñem_busy
;

758 
cuºdisk
 = 
	`gëssd
 (
cuº
->
devno
);

759 
ñem_num
 = 
cuº
->
ssd_ñem_num
;

760 
ñem
 = &
cuºdisk
->
ñemíts
[
ñem_num
];

761 
g™g_num
 = 
cuº
->
ssd_g™g_num
;

762 
	`ASSERT
(
g™g_num
 =
ñem
->
mëad©a
.gang_num);

764 i‡((
x
 = 
	`ioqueue_physiˇl_ac˚ss_d⁄e
(
ñem
->
queue
,
cuº
)Ë=
NULL
) {

765 
	`Ârötf
(
°dîr
, "ssd_access_complete: ioreq_eventÇot found by ioqueue_physical_access_done call\n");

766 
	`exô
(1);

770 i‡(
	`ioqueue_gë_ªqout°™dög
(
ñem
->
queue
) == 0) {

771 
ñem
->
medü_busy
 = 
FALSE
;

774 
some_ñem_busy
 = 0;

775 
	`ASSERT
(
cuºdisk
->
g™g_mëa
[
g™g_num
].
˛ónög
 == 0);

776 
i
 = 0; i < 
cuºdisk
->
∑øms
.
ñemíts_≥r_g™g
; i ++) {

777 
e
 = 
g™g_num
 * 
cuºdisk
->
∑øms
.
ñemíts_≥r_g™g
 + 
i
;

778 i‡(
cuºdisk
->
ñemíts
[
e
].
medü_busy
) {

779 
some_ñem_busy
 = 1;

784 i‡(!
some_ñem_busy
) {

785 
cuºdisk
->
g™g_mëa
[
g™g_num
].
busy
 = 0;

788 
	`ssd_com∂ëe_∑ª¡
(
cuº
, 
cuºdisk
);

789 
	`addt€xåaq
((
evít
 *Ë
cuº
);

790 
	`ssd_a˘iv©e_g™g
(
cuºdisk
, 
g™g_num
);

791 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_gang.h

4 #i‚de‡
_DISKSIM_SSD_GANG_H


5 
	#_DISKSIM_SSD_GANG_H


	)

7 
	~"ssd.h
"

8 
	~"moduÀs/ssdmodñ_ssd_∑øm.h
"

10 
ssd_medü_ac˚ss_ªque°_g™g_sync
(
i‹eq_evít
 *
cuº
);

11 
ssd_medü_ac˚ss_ªque°_g™g
(
i‹eq_evít
 *
cuº
);

12 
ssd_˛ón_g™g_com∂ëe
(
i‹eq_evít
 *
cuº
);

13 
ssd_ac˚ss_com∂ëe_g™g_sync
(
i‹eq_evít
 *
cuº
);

14 
ssd_ac˚ss_com∂ëe_g™g
(
i‹eq_evít
 *
cuº
);

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_init.c

4 
	~"ssd.h
"

5 
	~"ssd_timög.h
"

6 
	~"ssd_˛ón.h
"

7 
	~"ssd_utûs.h
"

8 
	~"ssd_öô.h
"

11 *
	g°©desc_ac˘ime°©s
 = "AccessÅime";

13 
	$ssd_°©öô
 (
devno
, 
fú°time
)

15 
ssd_t
 *
cuºdisk
;

17 
cuºdisk
 = 
	`gëssd
 (
devno
);

18 i‡(
fú°time
) {

19 
	`°©_öôülize
(
°©deffûe
, 
°©desc_ac˘ime°©s
, &
cuºdisk
->
°©
.
ac˘ime°©s
);

21 
	`°©_ª£t
(&
cuºdisk
->
°©
.
ac˘ime°©s
);

24 
cuºdisk
->
°©
.
ªque°edbus
 = 0.0;

25 
cuºdisk
->
°©
.
waôögf‹bus
 = 0.0;

26 
cuºdisk
->
°©
.
numbuswaôs
 = 0;

27 
	}
}

29 
	$ssd_öôülize_disköfo
 ()

31 
disksim
->
ssdöfo
 = 
	`mÆloc
 ((
ssdöfo_t
));

32 
	`bzîo
 ((*)
disksim
->
ssdöfo
, (
ssdöfo_t
));

33 
disksim
->
ssdöfo
->
ssds
 = 
	`mÆloc
(
MAXDEVICES
 * ((
ssd_t
)));

34 
disksim
->
ssdöfo
->
ssds_Àn
 = 
MAXDEVICES
;

35 
	`bzîo
 ((*)
disksim
->
ssdöfo
->
ssds
, (
MAXDEVICES
 * ((
ssd_t
))));

36 
	}
}

39 
	$ssd_fú°_∑ge_ö_√xt_block
(
µage
, 
ssd_t
 *
cuºdisk
)

41 
skù_by
 = 
µage
 % 
cuºdisk
->
∑øms
.
∑ges_≥r_block
;

42 
µage
 +
cuºdisk
->
∑øms
.
∑ges_≥r_block
 - 
skù_by
;

43  
µage
;

44 
	}
}

46 
	$ssd_ñem_exp‹t_size
(
ssd_t
 *
cuºdisk
)

48 
ª£rved_blocks
, 
ußbÀ_blocks
;

49 
ª£rved_blocks_≥r_∂™e
, 
ußbÀ_blocks_≥r_∂™e
;

51 
ª£rved_blocks_≥r_∂™e
 = (
cuºdisk
->
∑øms
.
ª£rve_blocks
 * cuºdisk->∑øms.
blocks_≥r_∂™e
) / 100;

52 
ußbÀ_blocks_≥r_∂™e
 = 
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
 - 
ª£rved_blocks_≥r_∂™e
;

53 
ª£rved_blocks
 = 
ª£rved_blocks_≥r_∂™e
 * 
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
;

54 
ußbÀ_blocks
 = 
ußbÀ_blocks_≥r_∂™e
 * 
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
;

56  (
ußbÀ_blocks
 * 
	`SSD_DATA_PAGES_PER_BLOCK
(
cuºdisk
));

57 
	}
}

60 
	$ssd_ñem_exp‹t_size2
(
ssd_t
 *
cuºdisk
)

62 
ª£rved_blocks
, 
ußbÀ_blocks
;

63 
ª£rved_blocks_≥r_∂™e
, 
ußbÀ_blocks_≥r_∂™e
;

65 
ª£rved_blocks_≥r_∂™e
 = (
cuºdisk
->
∑øms
.
ª£rve_blocks
 * cuºdisk->∑øms.
blocks_≥r_∂™e
) / 100;

66 
ußbÀ_blocks_≥r_∂™e
 = 
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
 - 
ª£rved_blocks_≥r_∂™e
;

67 
ª£rved_blocks
 = 
ª£rved_blocks_≥r_∂™e
 * 
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
;

68 
ußbÀ_blocks
 = 
ußbÀ_blocks_≥r_∂™e
 * 
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
;

70  (
ußbÀ_blocks
 * 
	`SSD_DATA_PAGES_PER_BLOCK
(
cuºdisk
Ë* cuºdisk->
∑øms
.
√Àmíts
);

71 
	}
}

81 
	$ssd_ñemít_mëad©a_öô
(
ñem_numbî
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
cuºdisk
)

83 
g™g_mëad©a
 *
g
;

84 
µage
;

85 
i
;

86 
byãs_to_Æloc
;

87 
tŸ_blocks
 = 
cuºdisk
->
∑øms
.
blocks_≥r_ñemít
;

88 
tŸ_∑ges
 = 
tŸ_blocks
 * 
cuºdisk
->
∑øms
.
∑ges_≥r_block
;

89 
ª£rved_blocks
, 
ußbÀ_blocks
, 
exp‹t_size
;

90 
ª£rved_blocks_≥r_∂™e
, 
ußbÀ_blocks_≥r_∂™e
;

91 
bôpos
;

92 
a˘ive_block
;

93 
ñem_ödex
;

94 
b¢
 = 1;

95 
∂™e_block_m≠pög
 = 
cuºdisk
->
∑øms
.plane_block_mapping;

99 
ª£rved_blocks_≥r_∂™e
 = (
cuºdisk
->
∑øms
.
ª£rve_blocks
 * cuºdisk->∑øms.
blocks_≥r_∂™e
) / 100;

100 
ußbÀ_blocks_≥r_∂™e
 = 
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
 - 
ª£rved_blocks_≥r_∂™e
;

101 
ª£rved_blocks
 = 
ª£rved_blocks_≥r_∂™e
 * 
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
;

102 
ußbÀ_blocks
 = 
ußbÀ_blocks_≥r_∂™e
 * 
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
;

106 
mëad©a
->
tŸ_‰ì_blocks
 = 
ª£rved_blocks
;

110 
mëad©a
->
g™g_num
 = 
ñem_numbî
 / 
cuºdisk
->
∑øms
.
ñemíts_≥r_g™g
;

111 
cuºdisk
->
g™g_mëa
[
mëad©a
->
g™g_num
].
ñem_‰ì_∑ges
[
ñem_numbî
] = \

112 
mëad©a
->
tŸ_‰ì_blocks
 * 
	`SSD_DATA_PAGES_PER_BLOCK
(
cuºdisk
);

113 
g
 = &
cuºdisk
->
g™g_mëa
[
mëad©a
->
g™g_num
];

114 
ñem_ödex
 = 
ñem_numbî
 % 
cuºdisk
->
∑øms
.
ñemíts_≥r_g™g
;

118 
mëad©a
->
∂™e_to_˛ón
 = 0;

119 
mëad©a
->
∂™e_to_wrôe
 = 0;

120 
mëad©a
->
block_Æloc_pos
 = 0;

121 
mëad©a
->
ªqs_waôög
 = 0;

122 
mëad©a
->
tŸ_migøti⁄s
 = 0;

123 
mëad©a
->
tŸ_pgs_migøãd
 = 0;

124 
mëad©a
->
mig_co°
 = 0;

128 
i
 = 0; i < ()
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
; i ++) {

129 
blocks_to_skù
;

131 
∂™e_block_m≠pög
) {

132 
PLANE_BLOCKS_CONCAT
:

133 
blocks_to_skù
 = (
i
*
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
 + 
ußbÀ_blocks_≥r_∂™e
);

136 
PLANE_BLOCKS_PAIRWISE_STRIPE
:

137 
blocks_to_skù
 = (
i
/2)*(2*
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
Ë+ (2*
ußbÀ_blocks_≥r_∂™e
) + i%2;

140 
PLANE_BLOCKS_FULL_STRIPE
:

141 
blocks_to_skù
 = (
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
 * 
ußbÀ_blocks_≥r_∂™e
Ë+ 
i
;

145 
	`Ârötf
(
°dîr
, "Eº‹: unknow¿∂™e_block_m≠pög %d\n", 
∂™e_block_m≠pög
);

146 
	`exô
(1);

149 
mëad©a
->
∂™e_mëa
[
i
].
a˘ive_∑ge
 = 
blocks_to_skù
*
cuºdisk
->
∑øms
.
∑ges_≥r_block
;

150 
mëad©a
->
∂™e_mëa
[
i
].
‰ì_blocks
 = 
ª£rved_blocks_≥r_∂™e
;

151 
mëad©a
->
∂™e_mëa
[
i
].
vÆid_∑ges
 = 0;

152 
mëad©a
->
∂™e_mëa
[
i
].
˛ón_ö_¥ogªss
 = 0;

153 
mëad©a
->
∂™e_mëa
[
i
].
˛ón_ö_block
 = -1;

154 
mëad©a
->
∂™e_mëa
[
i
].
block_Æloc_pos
 = i*
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
;

155 
mëad©a
->
∂™e_mëa
[
i
].
∑runô_num
 = i / 
	`SSD_PLANES_PER_PARUNIT
(
cuºdisk
);

156 
mëad©a
->
∂™e_mëa
[
i
].
num_˛óns
 = 0;

161 
i
 = 0; i < (Ë
	`SSD_PARUNITS_PER_ELEM
(
cuºdisk
); i ++) {

162 
mëad©a
->
∑runôs
[
i
].
∂™e_to_˛ón
 = 
	`SSD_PLANES_PER_PARUNIT
(
cuºdisk
)*i;

167 
∂™e_block_m≠pög
) {

168 
PLANE_BLOCKS_CONCAT
:

169 
mëad©a
->
a˘ive_∑ge
 = 
ußbÀ_blocks_≥r_∂™e
 * 
cuºdisk
->
∑øms
.
∑ges_≥r_block
;

172 
PLANE_BLOCKS_PAIRWISE_STRIPE
:

173 
mëad©a
->
a˘ive_∑ge
 = (2 * 
ußbÀ_blocks_≥r_∂™e
Ë* 
cuºdisk
->
∑øms
.
∑ges_≥r_block
;

176 
PLANE_BLOCKS_FULL_STRIPE
:

177 
mëad©a
->
a˘ive_∑ge
 = (
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
 * 
ußbÀ_blocks_≥r_∂™e
Ë* cuºdisk->∑øms.
∑ges_≥r_block
;

181 
	`Ârötf
(
°dîr
, "Eº‹: unknow¿∂™e_block_m≠pög %d\n", 
∂™e_block_m≠pög
);

182 
	`exô
(1);

185 
	`ASSERT
(
mëad©a
->
a˘ive_∑ge
 =mëad©a->
∂™e_mëa
[0].active_page);

186 
a˘ive_block
 = 
mëad©a
->
a˘ive_∑ge
 / 
cuºdisk
->
∑øms
.
∑ges_≥r_block
;

190 
exp‹t_size
 = 
ußbÀ_blocks
 * 
	`SSD_DATA_PAGES_PER_BLOCK
(
cuºdisk
);

191 
cuºdisk
->
d©a_∑ges_≥r_ñem
 = 
exp‹t_size
;

197 i‡((
mëad©a
->
lba_èbÀ
 = (*)
	`mÆloc
(
exp‹t_size
 * ())Ë=
NULL
) {

198 
	`Ârötf
(
°dîr
, "Error: mallocÅoÜbaÅable in ssd_element_metadata_init failed\n");

199 
	`Ârötf
(
°dîr
, "AŒoˇti⁄ sizê%d\n", 
exp‹t_size
 * ());

200 
	`exô
(1);

206 i‡((
tŸ_blocks
 % (() * 8)) != 0) {

207 
	`Ârötf
(
°dîr
, "This case isÇot yet handled\n");

208 
	`exô
(1);

211 
byãs_to_Æloc
 = 
tŸ_blocks
 / (() * 8);

212 i‡(!(
mëad©a
->
‰ì_blocks
 = (*)
	`mÆloc
(
byãs_to_Æloc
))) {

213 
	`Ârötf
(
°dîr
, "Error: mallocÅo free_blocks in ssd_element_metadata_init failed\n");

214 
	`Ârötf
(
°dîr
, "AŒoˇti⁄ sizê%d\n", 
byãs_to_Æloc
);

215 
	`exô
(1);

217 
	`bzîo
(
mëad©a
->
‰ì_blocks
, 
byãs_to_Æloc
);

221 i‡(!(
mëad©a
->
block_ußge
 = (
block_mëad©a
 *)
	`mÆloc
(
tŸ_blocks
 * (block_metadata)))) {

222 
	`Ârötf
(
°dîr
, "Error: mallocÅo block_usage in ssd_element_metadata_init failed\n");

223 
	`Ârötf
(
°dîr
, "AŒoˇti⁄ sizê%d\n", 
tŸ_blocks
 * (
block_mëad©a
));

224 
	`exô
(1);

226 
	`bzîo
(
mëad©a
->
block_ußge
, 
tŸ_blocks
 * (
block_mëad©a
));

228 
i
 = 0; i < 
tŸ_blocks
; i ++) {

229 
j
;

231 
mëad©a
->
block_ußge
[
i
].
block_num
 = i;

232 
mëad©a
->
block_ußge
[
i
].
∑ge
 = (*)
	`mÆloc
((Ë* 
cuºdisk
->
∑øms
.
∑ges_≥r_block
);

234 
j
 = 0; j < 
cuºdisk
->
∑øms
.
∑ges_≥r_block
; j ++) {

235 
mëad©a
->
block_ußge
[
i
].
∑ge
[
j
] = -1;

239 
∂™e_block_m≠pög
) {

240 
PLANE_BLOCKS_CONCAT
:

241 
mëad©a
->
block_ußge
[
i
].
∂™e_num
 = i / 
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
;

244 
PLANE_BLOCKS_PAIRWISE_STRIPE
:

245 
mëad©a
->
block_ußge
[
i
].
∂™e_num
 = (i/(2*
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
))*2 + i%2;

248 
PLANE_BLOCKS_FULL_STRIPE
:

249 
mëad©a
->
block_ußge
[
i
].
∂™e_num
 = i % 
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
;

253 
	`Ârötf
(
°dîr
, "Eº‹: unknow¿∂™e_block_m≠pög %d\n", 
∂™e_block_m≠pög
);

254 
	`exô
(1);

258 
mëad©a
->
block_ußge
[
i
].
ªm_li„time
 = 
SSD_MAX_ERASURES
;

259 
mëad©a
->
block_ußge
[
i
].
time_of_œ°_îasuª
 = 
simtime
;

262 
mëad©a
->
block_ußge
[
i
].
°©e
 = 
SSD_BLOCK_CLEAN
;

265 
mëad©a
->
block_ußge
[
i
].
b¢
 = 0;

273 
µage
 = 0;

274 
i
 = 0;

275 
i
 < 
exp‹t_size
) {

276 
pgnum_ö_g™g
;

277 
µ_ödex
;

278 
∂™e_num
;

279 
block
 = 
	`SSD_PAGE_TO_BLOCK
(
µage
, 
cuºdisk
);

281 
	`ASSERT
(
block
 < ()
cuºdisk
->
∑øms
.
blocks_≥r_ñemít
);

284 i‡(
	`ssd_œ°_∑ge_ö_block
(
µage
, 
cuºdisk
)) {

287 
mëad©a
->
block_ußge
[
block
].
°©e
 = 
SSD_BLOCK_SEALED
;

290 
µage
 ++;

291 
block
 = 
	`SSD_PAGE_TO_BLOCK
(
µage
, 
cuºdisk
);

296 
∂™e_block_m≠pög
) {

297 
PLANE_BLOCKS_CONCAT
:

299 
block_ödex
 = 
block
 % 
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
;

300 i‡((
block_ödex
 >
ußbÀ_blocks_≥r_∂™e
Ë&& (block_ödex < 
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
)) {

302 
µage
 = 
	`ssd_fú°_∑ge_ö_√xt_block
’∑ge, 
cuºdisk
);

308 
PLANE_BLOCKS_PAIRWISE_STRIPE
:

310 
block_ödex
 = 
block
 % (2*
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
);

311 i‡((
block_ödex
 >2*
ußbÀ_blocks_≥r_∂™e
Ë&& (block_ödex < 2*
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
)) {

312 
µage
 = 
	`ssd_fú°_∑ge_ö_√xt_block
’∑ge, 
cuºdisk
);

318 
PLANE_BLOCKS_FULL_STRIPE
:

320 i‡((
block
 >
ußbÀ_blocks
Ë&& (block < ()
cuºdisk
->
∑øms
.
blocks_≥r_ñemít
)) {

321 
	`¥ötf
("Error:Åhe control shouldÇot come here ...\n");

322 
µage
 = 
	`ssd_fú°_∑ge_ö_√xt_block
’∑ge, 
cuºdisk
);

328 
	`Ârötf
(
°dîr
, "Eº‹: unknow¿∂™e_block_m≠pög %d\n", 
∂™e_block_m≠pög
);

329 
	`exô
(1);

335 
µ_ödex
 = 
µage
 % 
cuºdisk
->
∑øms
.
∑ges_≥r_block
;

338 
mëad©a
->
lba_èbÀ
[
i
] = 
µage
;

339 
pgnum_ö_g™g
 = 
ñem_ödex
 * 
exp‹t_size
 + 
i
;

340 
g
->
pg2ñem
[
pgnum_ö_g™g
].
e
 = 
ñem_numbî
;

346 i‡(
µ_ödex
 == 0) {

347 
bôpos
 = 
	`ssd_block_to_bôpos
(
cuºdisk
, 
block
);

348 
	`ssd_£t_bô
(
mëad©a
->
‰ì_blocks
, 
bôpos
);

349 
mëad©a
->
block_ußge
[
block
].
°©e
 = 
SSD_BLOCK_INUSE
;

350 
mëad©a
->
block_ußge
[
block
].
b¢
 = bsn ++;

354 
∂™e_num
 = 
mëad©a
->
block_ußge
[
block
].plane_num;

355 
mëad©a
->
block_ußge
[
block
].
∑ge
[
µ_ödex
] = 
i
;

356 
mëad©a
->
block_ußge
[
block
].
num_vÆid
 ++;

357 
mëad©a
->
∂™e_mëa
[
∂™e_num
].
vÆid_∑ges
 ++;

360 
µage
 ++;

363 
i
 ++;

369 
cuºdisk
->
∑øms
.
c›y_back
) {

370 
SSD_COPY_BACK_DISABLE
:

371 
bôpos
 = 
	`ssd_block_to_bôpos
(
cuºdisk
, 
a˘ive_block
);

372 
	`ssd_£t_bô
(
mëad©a
->
‰ì_blocks
, 
bôpos
);

373 
mëad©a
->
block_ußge
[
a˘ive_block
].
°©e
 = 
SSD_BLOCK_INUSE
;

374 
mëad©a
->
block_ußge
[
a˘ive_block
].
b¢
 = bsn ++;

377 
SSD_COPY_BACK_ENABLE
:

378 
i
 = 0; i < ()
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
; i ++) {

379 
∂™e_a˘ive_block
 = 
	`SSD_PAGE_TO_BLOCK
(
mëad©a
->
∂™e_mëa
[
i
].
a˘ive_∑ge
, 
cuºdisk
);

381 
bôpos
 = 
	`ssd_block_to_bôpos
(
cuºdisk
, 
∂™e_a˘ive_block
);

382 
	`ssd_£t_bô
(
mëad©a
->
‰ì_blocks
, 
bôpos
);

383 
mëad©a
->
block_ußge
[
∂™e_a˘ive_block
].
°©e
 = 
SSD_BLOCK_INUSE
;

384 
mëad©a
->
block_ußge
[
∂™e_a˘ive_block
].
b¢
 = bsn ++;

385 
mëad©a
->
tŸ_‰ì_blocks
 --;

386 
mëad©a
->
∂™e_mëa
[
i
].
‰ì_blocks
 --;

391 
	`Ârötf
(
°dîr
, "Error: invalid copy backÖolicy %d\n",

392 
cuºdisk
->
∑øms
.
c›y_back
);

393 
	`exô
(1);

398 
mëad©a
->
b¢
 = bsn;

400 
	}
}

402 
	$ssd_∂™e_öô
(
ssd_ñemít
 *
ñem
, 
ssd_t
 *
s
, 
devno
)

404 
i
;

407 
ñem
->
num_∂™es
 = 
s
->
∑øms
.
∂™es_≥r_pkg
;

410 
i
 = 0; i < 
ñem
->
num_∂™es
; i ++) {

411 
ñem
->
∂™e
[
i
].
medü_busy
 = 
FALSE
;

412 
ñem
->
∂™e
[
i
].
num_blocks
 = 
s
->
∑øms
.
blocks_≥r_∂™e
;

415 
ñem
->
∂™e
[
i
].
∑ú_∂™e
 = i ^ 0x1;

417 
	}
}

422 
	$ssd_vîify_∑ømëîs
(
ssd_t
 *
cuºdisk
)

425 
	`ASSERT
(
cuºdisk
->
∑øms
.
mö_‰ìblks_≥r˚¡
 < cuºdisk->∑øms.
ª£rve_blocks
);

427 i‡(
cuºdisk
->
∑øms
.
wrôe_pﬁicy
 == 1) {

428 
	`¥ötf
("Simple writeÖolicy with block-sizedÖages (256 KB) isÇot supported\n");

429 
	`ASSERT
(0);

432 
	`ASSERT
((
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
 * cuºdisk->∑øms.
blocks_≥r_∂™e
Ë=cuºdisk->∑øms.
blocks_≥r_ñemít
);

434 i‡(
cuºdisk
->
∑øms
.
Æloc_poﬁ_logic
 == 2) {

435 
	`ASSERT
(
cuºdisk
->
∑øms
.
c›y_back
 =
SSD_COPY_BACK_ENABLE
);

437 
	}
}

439 
	$ssd_Æloc_queues
(
ssd_t
 *
t
)

445 
i
;

446 
i
 = 0; i < 
	`SSD_NUM_GANG
(
t
); i ++) {

447 
ioq
 *
q
 = 
	`mÆloc
((
ioqueue
));

448 
	`mem˝y
(
q
, 
t
->
queue
, (
ioqueue
));

449 
t
->
g™g_mëa
[
i
].
queue
 = 
q
;

450 
	`as£π
(
q
 !
NULL
);

453 
i
=0;i<
t
->
∑øms
.
√Àmíts
;i++) {

454 
ioq
 *
q
 = 
	`mÆloc
((
ioqueue
));

455 
	`mem˝y
(
q
, 
t
->
queue
, (
ioqueue
));

456 
t
->
ñemíts
[
i
].
queue
 = 
q
;

457 
	`as£π
(
q
 !
NULL
);

459 
	}
}

461 
	$ssd_öôülize
 ()

463 
¥öt1
 = 1;

464 
i
, 
j
;

466 i‡(
disksim
->
ssdöfo
 =
NULL
) {

467 
	`ssd_öôülize_disköfo
 ();

472 
	`ssd_£tˇŒbacks
();

476 
i
=0; i<
numssds
; i++) {

477 
exp_size
;

478 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
i
);

479 
	`ssd_Æloc_queues
(
cuºdisk
);

482 
	`ssd_vîify_∑ømëîs
(
cuºdisk
);

485 
cuºdisk
->
devno
 = 
i
;

487 i‡(!
cuºdisk
) ;

489 
cuºdisk
->
numblocks
 = cuºdisk->
∑øms
.
√Àmíts
 *

490 
cuºdisk
->
∑øms
.
blocks_≥r_ñemít
 *

491 
cuºdisk
->
∑øms
.
∑ges_≥r_block
 *

492 
cuºdisk
->
∑øms
.
∑ge_size
;

493 
cuºdisk
->
ªc⁄√˘_ªas⁄
 = -1;

494 
	`addli°t€xåaq
 ((
evít
 **Ë&
cuºdisk
->
buswaô
);

495 
cuºdisk
->
busow√d
 = -1;

496 
cuºdisk
->
com∂ëi⁄_queue
 = 
NULL
;

498 
	`ioqueue_öôülize
 (
cuºdisk
->
queue
, 
i
);

499 
	`ssd_°©öô
(
i
, 
TRUE
);

500 
cuºdisk
->
timög_t
 = 
	`ssd_√w_timög_t
(&cuºdisk->
∑øms
);

503 
exp_size
 = 
	`ssd_ñem_exp‹t_size
(
cuºdisk
);

504 
j
 = 0; j < 
	`SSD_NUM_GANG
(
cuºdisk
); j ++) {

505 
tŸ_∑ges
 = 
exp_size
 * 
cuºdisk
->
∑øms
.
ñemíts_≥r_g™g
;

506 
cuºdisk
->
g™g_mëa
[
j
].
busy
 = 0;

507 
cuºdisk
->
g™g_mëa
[
j
].
˛ónög
 = 0;

508 
cuºdisk
->
g™g_mëa
[
j
].
ªqs_waôög
 = 0;

509 
cuºdisk
->
g™g_mëa
[
j
].
ﬁde°
 = 0;

510 
cuºdisk
->
g™g_mëa
[
j
].
pg2ñem
 = 
	`mÆloc
((
ssd_ñem_numbî
Ë* 
tŸ_∑ges
);

511 
	`mem£t
(
cuºdisk
->
g™g_mëa
[
j
].
pg2ñem
, 0, (
ssd_ñem_numbî
Ë* 
tŸ_∑ges
);

513 
	`ioqueue_öôülize
 (
cuºdisk
->
g™g_mëa
[
j
].
queue
, 
i
);

516 
j
=0; j<
cuºdisk
->
∑øms
.
√Àmíts
; j++) {

517 
ssd_ñemít
 *
ñem
 = &
cuºdisk
->
ñemíts
[
j
];

518 
	`ioqueue_öôülize
 (
ñem
->
queue
, 
i
);

521 
ñem
->
medü_busy
 = 
FALSE
;

524 
ñem
->
pö_busy
 = 
FALSE
;

527 
	`ssd_∂™e_öô
(
ñem
, 
cuºdisk
, 
i
);

531 
	`mem£t
(&
ñem
->
°©
, 0, (elem->stat));

532 i‡(
cuºdisk
->
∑øms
.
wrôe_pﬁicy
 =
DISKSIM_SSD_WRITE_POLICY_OSR
) {

533 
	`ssd_ñemít_mëad©a_öô
(
j
, &(
ñem
->
mëad©a
), 
cuºdisk
);

537 
	`mem£t
(&
ñem
->
°©
, 0, (
ssd_ñemít_°©
));

541 
	}
}

543 
	$ssd_ª£t°©s
 ()

545 
i
;

547 
i
=0; i<
MAXDEVICES
; i++) {

548 
ssd_t
 *
cuºdisk
 = 
	`gëssd
 (
i
);

549 i‡(
cuºdisk
) {

550 
j
;

551 
	`ioqueue_ª£t°©s
(
cuºdisk
->
queue
);

552 
j
=0; j<
cuºdisk
->
∑øms
.
√Àmíts
; j++) {

553 
	`ioqueue_ª£t°©s
(
cuºdisk
->
ñemíts
[
j
].
queue
);

555 
	`ssd_°©öô
(
i
, 0);

558 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_init.h

4 #i‚de‡
DISKSIM_SSD_INIT_H


5 
	#DISKSIM_SSD_INIT_H


	)

7 
	~"ssd.h
"

9 
ssd_öôülize_disköfo
();

10 
ssd_ñem_exp‹t_size
(
ssd_t
 *
cuºdisk
);

11 
ssd_ñemít_mëad©a_öô
(
ñem_numbî
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
cuºdisk
);

12 
ssd_∂™e_öô
(
ssd_ñemít
 *
ñem
, 
ssd_t
 *
s
, 
devno
);

13 
ssd_vîify_∑ømëîs
(
ssd_t
 *
cuºdisk
);

14 
ssd_öôülize
 ();

15 
ssd_ª£t°©s
 ();

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_timing.c

4 
	~"ssd.h
"

5 
	~"ssd_timög.h
"

6 
	~"ssd_˛ón.h
"

7 
	~"ssd_g™g.h
"

8 
	~"ssd_utûs.h
"

9 
	~"moduÀs/ssdmodñ_ssd_∑øm.h
"

11 
	smy_timög_t
 {

12 
ssd_timög_t
 
	mt
;

13 
ssd_timög_∑øms
 *
	m∑øms
;

14 
	m√xt_wrôe_∑ge
[
SSD_MAX_ELEMENTS
];

17 
	$ssd_choo£_ñemít
(
ssd_timög_t
 *
t
, 
blkno
)

19 
my_timög_t
 *
â
 = (my_timög_à*Ë
t
;

20  (
blkno
/(
â
->
∑øms
->
ñemít_°ride_∑ges
*â->∑øms->
∑ge_size
)Ë%Åt->∑øms->
√Àmíts
;

21 
	}
}

23 
	$ssd_choo£_Æig√d_cou¡
(
∑ge_size
, 
blkno
, 
cou¡
)

25 
ªs
 = 
∑ge_size
 - (
blkno
 %Öage_size);

26 i‡(
ªs
 > 
cou¡
)

27 
ªs
 = 
cou¡
;

28  
ªs
;

29 
	}
}

38 
	$ssd_wrôe_pﬁicy_sim∂e
(
blkno
, 
cou¡
, 
ñem_num
, 
ssd_t
 *
s
)

40 
co°
;

41 
∑ges_moved
;

42 
my_timög_t
 *
â
 = (my_timög_à*)(
s
->
timög_t
);

49 
blockpos
, 
œ°pos
;

50 
µb
 = 
â
->
∑øms
->
∑ges_≥r_block
;

51 
œ°_≤
 = 
â
->
√xt_wrôe_∑ge
[
ñem_num
];

52 
≠n
 = 
blkno
/
â
->
∑øms
->
∑ge_size
;

53 
≤
 = ((
≠n
 - (≠¿% (
â
->
∑øms
->
ñemít_°ride_∑ges
*â->∑øms->
√Àmíts
)))/

54 
â
->
∑øms
->
√Àmíts
Ë+ (
≠n
 %Åt->∑øms->
ñemít_°ride_∑ges
);

56 
blockpos
 = 
≤
 % 
µb
;

57 
œ°pos
 = 
œ°_≤
 % 
µb
;

59 i‡(
œ°_≤
 >0 && 
≤
 >œ°_≤ && (≤/
µb
 ==Üast_pn/ppb)) {

61 
co°
 = 
â
->
∑øms
->
∑ge_wrôe_œãncy
;

64 
co°
 +(
≤
-
œ°_≤
Ë* (
â
->
∑øms
->
∑ge_ªad_œãncy
 +Åt->∑øms->
∑ge_wrôe_œãncy
);

67 
∑ges_moved
 = 
≤
 - 
œ°_≤
;

70 
co°
 = 
â
->
∑øms
->
∑ge_wrôe_œãncy
;

73 
co°
 +
â
->
∑øms
->
block_îa£_œãncy
;

76 
s
->
ñemíts
[
ñem_num
].
°©
.
num_˛ón
 ++;

79 
co°
 +
blockpos
 * (
â
->
∑øms
->
∑ge_ªad_œãncy
 +Åt->∑øms->
∑ge_wrôe_œãncy
);

82 
∑ges_moved
 = 
blockpos
;

84 i‡(
œ°_≤
 >= 0) {

86 
co°
 +(
µb
-
œ°pos
) *

87 (
â
->
∑øms
->
∑ge_ªad_œãncy
 +Åt->∑øms->
∑ge_wrôe_œãncy
);

90 
∑ges_moved
 +
µb
 - 
œ°pos
;

94 
≤
 =Ön + 1;

95 i‡((
blockpos
) == 0)

96 
â
->
√xt_wrôe_∑ge
[
ñem_num
] = -1;

98 
â
->
√xt_wrôe_∑ge
[
ñem_num
] = 
≤
;

101 
s
->
ñemíts
[
ñem_num
].
°©
.
∑ges_moved
 +=Öages_moved;

104 
co°
 +
	`ssd_d©a_å™s„r_co°
(
s
, 
cou¡
);

106  
co°
;

107 
	}
}

109 
	$ssd_ªad_pﬁicy_sim∂e
(
cou¡
, 
ssd_t
 *
s
)

111 
co°
 = 
s
->
∑øms
.
∑ge_ªad_œãncy
;

112 
co°
 +
	`ssd_d©a_å™s„r_co°
(
s
, 
cou¡
);

114  
co°
;

115 
	}
}

124 
	$ssd_‰ì_bôs
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
)

126 
i
;

127 
‰ìcou¡
 = 0;

128 
°¨t
 = 
∂™e_num
 * 
s
->
∑øms
.
blocks_≥r_∂™e
;

129 
i
 = 
°¨t
; i < sèπ + ()
s
->
∑øms
.
blocks_≥r_∂™e
; i ++) {

130 i‡(!
	`ssd_bô_⁄
(
mëad©a
->
‰ì_blocks
, 
i
)) {

131 
‰ìcou¡
 ++;

135  
‰ìcou¡
;

136 
	}
}

142 
	$ssd_as£π_∂™e_‰ìbôs
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
)

144 
f1
;

146 
f1
 = 
	`ssd_‰ì_bôs
(
∂™e_num
, 
ñem_num
, 
mëad©a
, 
s
);

147 
	`ASSERT
(
f1
 =
mëad©a
->
∂™e_mëa
[
∂™e_num
].
‰ì_blocks
);

148 
	}
}

154 
	$ssd_as£π_‰ì_blocks
(
ssd_t
 *
s
, 
ssd_ñemít_mëad©a
 *
mëad©a
)

156 
tmp
 = 0;

157 
i
;

160 
i
 = 0; i < 
s
->
∑øms
.
∂™es_≥r_pkg
; i ++) {

161 
tmp
 +
mëad©a
->
∂™e_mëa
[
i
].
‰ì_blocks
;

163 
	`ASSERT
(
mëad©a
->
tŸ_‰ì_blocks
 =
tmp
);

164 
	}
}

169 
	$ssd_as£π_∑ge_vîsi⁄
(
¥ev_∑ge
, 
a˘ive_∑ge
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
)

171 
¥ev_block
 = 
¥ev_∑ge
 / 
s
->
∑øms
.
∑ges_≥r_block
;

172 
a˘ive_block
 = 
a˘ive_∑ge
 / 
s
->
∑øms
.
∑ges_≥r_block
;

174 i‡(
¥ev_block
 !
a˘ive_block
) {

175 
	`ASSERT
(
mëad©a
->
block_ußge
[
¥ev_block
].
b¢
 < mëad©a->block_ußge[
a˘ive_block
].bsn);

177 
	`ASSERT
(
¥ev_∑ge
 < 
a˘ive_∑ge
);

179 
	}
}

181 
	$ssd_as£π_vÆid_∑ges
(
∂™e_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
)

183 #i‡
SSD_ASSERT_ALL


184 
i
;

185 
block_vÆid_∑ges
 = 0;

186 
°¨t_bôpos
 = 
∂™e_num
 * 
s
->
∑øms
.
blocks_≥r_∂™e
;

188 
i
 = 
°¨t_bôpos
; i < (°¨t_bôpo†+ ()
s
->
∑øms
.
blocks_≥r_∂™e
); i ++) {

189 
block
 = 
	`ssd_bôpos_to_block
(
i
, 
s
);

190 
block_vÆid_∑ges
 +
mëad©a
->
block_ußge
[
block
].
num_vÆid
;

193 
	`ASSERT
(
block_vÆid_∑ges
 =
mëad©a
->
∂™e_mëa
[
∂™e_num
].
vÆid_∑ges
);

197 
	}
}

199 
	$ssd_d©a_å™s„r_co°
(
ssd_t
 *
s
, 
£˘‹s_cou¡
)

201  (
£˘‹s_cou¡
 * (
SSD_BYTES_PER_SECTOR
Ë* 
s
->
∑øms
.
chù_x„r_œãncy
);

202 
	}
}

204 
	$ssd_œ°_∑ge_ö_block
(
∑ge_num
, 
ssd_t
 *
s
)

206  (((
∑ge_num
 + 1Ë% 
s
->
∑øms
.
∑ges_≥r_block
) == 0);

207 
	}
}

209 
	$ssd_bôpos_to_block
(
bôpos
, 
ssd_t
 *
s
)

211 
block
 = -1;

213 
s
->
∑øms
.
∂™e_block_m≠pög
) {

214 
PLANE_BLOCKS_CONCAT
:

215 
block
 = 
bôpos
;

218 
PLANE_BLOCKS_PAIRWISE_STRIPE
:

220 
∂™e_∑ú
 = 
bôpos
 / (
s
->
∑øms
.
blocks_≥r_∂™e
*2);

221 
°rùe_no
 = (
bôpos
/2Ë% 
s
->
∑øms
.
blocks_≥r_∂™e
;

222 
off£t
 = 
bôpos
 % 2;

224 
block
 = 
∂™e_∑ú
 * (
s
->
∑øms
.
blocks_≥r_∂™e
*2) + \

225 (
°rùe_no
 * 2) + \

226 
off£t
;

230 
PLANE_BLOCKS_FULL_STRIPE
:

232 
°rùe_no
 = 
bôpos
 % 
s
->
∑øms
.
blocks_≥r_∂™e
;

233 
cﬁ_no
 = 
bôpos
 / 
s
->
∑øms
.
blocks_≥r_∂™e
;

234 
block
 = (
°rùe_no
 * 
s
->
∑øms
.
∂™es_≥r_pkg
Ë+ 
cﬁ_no
;

239 
	`Ârötf
(
°dîr
, "Eº‹: unknow¿∂™e_block_m≠pög %d\n", 
s
->
∑øms
.
∂™e_block_m≠pög
);

240 
	`exô
(1);

243  
block
;

244 
	}
}

246 
	$ssd_block_to_bôpos
(
ssd_t
 *
cuºdisk
, 
block
)

248 
bôpos
 = -1;

252 
cuºdisk
->
∑øms
.
∂™e_block_m≠pög
) {

253 
PLANE_BLOCKS_CONCAT
:

254 
bôpos
 = 
block
;

257 
PLANE_BLOCKS_PAIRWISE_STRIPE
:

259 
block_ödex
 = 
block
 % (2*
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
);

260 
∑ús_to_skù
 = 
block
 / (2*
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
);

261 
∂™es_to_skù
 = 
block
 % 2;

262 
blocks_to_skù
 = 
block_ödex
 / 2;

264 
bôpos
 = 
∑ús_to_skù
 * (2*
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
) + \

265 
∂™es_to_skù
 * 
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
 + \

266 
blocks_to_skù
;

270 
PLANE_BLOCKS_FULL_STRIPE
:

272 
∂™es_to_skù
 = 
block
 % 
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
;

273 
blocks_to_skù
 = 
block
 / 
cuºdisk
->
∑øms
.
∂™es_≥r_pkg
;

274 
bôpos
 = 
∂™es_to_skù
 * 
cuºdisk
->
∑øms
.
blocks_≥r_∂™e
 + 
blocks_to_skù
;

279 
	`Ârötf
(
°dîr
, "Error: unknownÖlane_block_mapping %d\n",

280 
cuºdisk
->
∑øms
.
∂™e_block_m≠pög
);

281 
	`exô
(1);

284 
	`ASSERT
((
bôpos
 >0Ë&& (bôpo†< 
cuºdisk
->
∑øms
.
blocks_≥r_ñemít
));

286  
bôpos
;

287 
	}
}

289 
	$ssd_bôpos_to_∂™e
(
bôpos
, 
ssd_t
 *
s
)

291  (
bôpos
 / 
s
->
∑øms
.
blocks_≥r_∂™e
);

292 
	}
}

300 
	$_ssd_wrôe_∑ge_o§
(
ssd_t
 *
s
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
Õn
)

302 
co°
;

303 
a˘ive_∑ge
 = 
mëad©a
->active_page;

304 
a˘ive_block
 = 
	`SSD_PAGE_TO_BLOCK
(
a˘ive_∑ge
, 
s
);

305 
∑gïos_ö_block
 = 
a˘ive_∑ge
 % 
s
->
∑øms
.
∑ges_≥r_block
;

306 
a˘ive_∂™e
 = 
mëad©a
->
block_ußge
[
a˘ive_block
].
∂™e_num
;

309 i‡(
mëad©a
->
lba_èbÀ
[
Õn
] != -1) {

315 
¥ev_∑ge
 = 
mëad©a
->
lba_èbÀ
[
Õn
];

316 
¥ev_block
 = 
	`SSD_PAGE_TO_BLOCK
(
¥ev_∑ge
, 
s
);

317 
∑gïos_ö_¥ev_block
 = 
¥ev_∑ge
 % 
s
->
∑øms
.
∑ges_≥r_block
;

318 
¥ev_∂™e
 = 
mëad©a
->
block_ußge
[
¥ev_block
].
∂™e_num
;

321 
	`ssd_as£π_∑ge_vîsi⁄
(
¥ev_∑ge
, 
a˘ive_∑ge
, 
mëad©a
, 
s
);

323 i‡(
mëad©a
->
block_ußge
[
¥ev_block
].
∑ge
[
∑gïos_ö_¥ev_block
] !
Õn
) {

324 
	`Ârötf
(
°dîr
, "Error:Üpn %dÇot found inÖrev block %dÖos %d\n",

325 
Õn
, 
¥ev_block
, 
∑gïos_ö_¥ev_block
);

326 
	`ASSERT
(0);

328 
mëad©a
->
block_ußge
[
¥ev_block
].
∑ge
[
∑gïos_ö_¥ev_block
] = -1;

329 
mëad©a
->
block_ußge
[
¥ev_block
].
num_vÆid
 --;

330 
mëad©a
->
∂™e_mëa
[
¥ev_∂™e
].
vÆid_∑ges
 --;

331 
	`ssd_as£π_vÆid_∑ges
(
¥ev_∂™e
, 
mëad©a
, 
s
);

334 
	`Ârötf
(
°dîr
, "Error: This case shouldÇot beÉxecuted\n");

338 
mëad©a
->
lba_èbÀ
[
Õn
] = 
a˘ive_∑ge
;

341 
mëad©a
->
block_ußge
[
a˘ive_block
].
∑ge
[
∑gïos_ö_block
] = 
Õn
;

342 
mëad©a
->
block_ußge
[
a˘ive_block
].
num_vÆid
 ++;

343 
mëad©a
->
∂™e_mëa
[
a˘ive_∂™e
].
vÆid_∑ges
 ++;

344 
	`ssd_as£π_vÆid_∑ges
(
a˘ive_∂™e
, 
mëad©a
, 
s
);

347 i‡(
mëad©a
->
block_ußge
[
a˘ive_block
].
num_vÆid
 >
s
->
∑øms
.
∑ges_≥r_block
) {

348 
	`Ârötf
(
°dîr
, "Error:Üen %d of block %d is greaterÅhan orÉqualÅoÖagesÖer block %d\n",

349 
mëad©a
->
block_ußge
[
a˘ive_block
].
num_vÆid
,á˘ive_block, 
s
->
∑øms
.
∑ges_≥r_block
);

350 
	`exô
(1);

354 
co°
 = 
s
->
∑øms
.
∑ge_wrôe_œãncy
;

358 
mëad©a
->
a˘ive_∑ge
 =áctive_page + 1;

359 
mëad©a
->
∂™e_mëa
[
a˘ive_∂™e
].
a˘ive_∑ge
 = metadata->active_page;

363 i‡(
	`ssd_œ°_∑ge_ö_block
(
mëad©a
->
a˘ive_∑ge
, 
s
)) {

365 
co°
 +
	`ssd_d©a_å™s„r_co°
(
s
, 
SSD_SECTORS_PER_SUMMARY_PAGE
);

368 
co°
 +
s
->
∑øms
.
∑ge_wrôe_œãncy
;

372 
mëad©a
->
block_ußge
[
a˘ive_block
].
∑ge
[
s
->
∑øms
.
∑ges_≥r_block
 - 1] = -1;

373 
mëad©a
->
block_ußge
[
a˘ive_block
].
°©e
 = 
SSD_BLOCK_SEALED
;

377  
co°
;

378 
	}
}

388 
	$_ssd_Æloc_a˘ive_block
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
)

390 
ssd_ñemít_mëad©a
 *
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

391 *
‰ì_blocks
 = 
mëad©a
->free_blocks;

392 
a˘ive_block
 = -1;

393 
¥ev_pos
;

394 
bôpos
;

396 i‡(
∂™e_num
 != -1) {

397 
¥ev_pos
 = 
mëad©a
->
∂™e_mëa
[
∂™e_num
].
block_Æloc_pos
;

399 
¥ev_pos
 = 
mëad©a
->
block_Æloc_pos
;

403 
bôpos
 = 
	`ssd_föd_zîo_bô
(
‰ì_blocks
, 
s
->
∑øms
.
blocks_≥r_ñemít
, 
¥ev_pos
);

404 
	`ASSERT
((
bôpos
 >0Ë&& (bôpo†< 
s
->
∑øms
.
blocks_≥r_ñemít
));

407 i‡(
∂™e_num
 != -1) {

408 i‡(
	`ssd_bôpos_to_∂™e
(
bôpos
, 
s
Ë!
∂™e_num
) {

415 
mëad©a
->
∂™e_mëa
[
∂™e_num
].
block_Æloc_pos
 =Öœ√_num * 
s
->
∑øms
.
blocks_≥r_∂™e
;

416 
¥ev_pos
 = 
mëad©a
->
∂™e_mëa
[
∂™e_num
].
block_Æloc_pos
;

417 
bôpos
 = 
	`ssd_föd_zîo_bô
(
‰ì_blocks
, 
s
->
∑øms
.
blocks_≥r_ñemít
, 
¥ev_pos
);

418 
	`ASSERT
((
bôpos
 >0Ë&& (bôpo†< 
s
->
∑øms
.
blocks_≥r_ñemít
));

420 i‡(
	`ssd_bôpos_to_∂™e
(
bôpos
, 
s
Ë!
∂™e_num
) {

421 
	`¥ötf
("Eº‹:Åhi†∂™ê%d i†fuŒ\n", 
∂™e_num
);

422 
	`¥ötf
("this case isÇot yet handled\n");

423 
	`exô
(1);

427 
mëad©a
->
∂™e_mëa
[
∂™e_num
].
block_Æloc_pos
 = \

428 (
∂™e_num
 * 
s
->
∑øms
.
blocks_≥r_∂™e
Ë+ ((
bôpos
+1) % s->params.blocks_per_plane);

430 
mëad©a
->
block_Æloc_pos
 = (
bôpos
+1Ë% 
s
->
∑øms
.
blocks_≥r_ñemít
;

434 
a˘ive_block
 = 
	`ssd_bôpos_to_block
(
bôpos
, 
s
);

436 i‡(
a˘ive_block
 != -1) {

437 
∂™e_mëad©a
 *
pm
;

440 
	`ASSERT
(
mëad©a
->
block_ußge
[
a˘ive_block
].
∂™e_num
 =
	`ssd_bôpos_to_∂™e
(
bôpos
, 
s
));

441 
	`ASSERT
(
mëad©a
->
block_ußge
[
a˘ive_block
].
b¢
 == 0);

442 
	`ASSERT
(
mëad©a
->
block_ußge
[
a˘ive_block
].
num_vÆid
 == 0);

443 
	`ASSERT
(
mëad©a
->
block_ußge
[
a˘ive_block
].
°©e
 =
SSD_BLOCK_CLEAN
);

445 i‡(
∂™e_num
 == -1) {

446 
∂™e_num
 = 
mëad©a
->
block_ußge
[
a˘ive_block
].plane_num;

448 
	`ASSERT
(
∂™e_num
 =
mëad©a
->
block_ußge
[
a˘ive_block
].plane_num);

451 
pm
 = &
mëad©a
->
∂™e_mëa
[
∂™e_num
];

454 
mëad©a
->
tŸ_‰ì_blocks
 --;

455 
pm
->
‰ì_blocks
 --;

458 
	`ssd_as£π_‰ì_blocks
(
s
, 
mëad©a
);

461 
	`ssd_£t_bô
(
‰ì_blocks
, 
bôpos
);

462 
mëad©a
->
block_ußge
[
a˘ive_block
].
°©e
 = 
SSD_BLOCK_INUSE
;

463 
mëad©a
->
block_ußge
[
a˘ive_block
].
b¢
 = metadata->bsn ++;

466 
pm
->
a˘ive_∑ge
 = 
a˘ive_block
 * 
s
->
∑øms
.
∑ges_≥r_block
;

467 
mëad©a
->
a˘ive_∑ge
 = 
pm
->active_page;

471 
	`Ârötf
(
°dîr
, "Eº‹: c™nŸ födá fªêblock i¿ssdÉÀmíà%d\n", 
ñem_num
);

472 
	`exô
(-1);

474 
	}
}

476 
li°node
 **
	$ssd_pick_∑runôs
(
ssd_ªq
 **
ªqs
, 
tŸÆ
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
)

478 
i
;

479 
Õn
;

480 
¥ev_∑ge
;

481 
¥ev_block
;

482 
∂™e_num
;

483 
∑runô_num
;

484 
li°node
 **
∑runôs
;

485 
fûÀd
 = 0;

489 
∑runôs
 = (
li°node
 **)
	`mÆloc
(
	`SSD_PARUNITS_PER_ELEM
(
s
) * (listnode *));

490 
i
 = 0; i < 
	`SSD_PARUNITS_PER_ELEM
(
s
); i ++) {

491 
	`Œ_¸óã
(&
∑runôs
[
i
]);

495 
i
 = 0; i < 
tŸÆ
; i ++) {

496 i‡(
ªqs
[
i
]->
is_ªad
) {

498 
Õn
 = 
	`ssd_logiˇl_∑gío
(
ªqs
[
i
]->
blk
, 
s
);

499 
¥ev_∑ge
 = 
mëad©a
->
lba_èbÀ
[
Õn
];

500 
	`ASSERT
(
¥ev_∑ge
 != -1);

501 
¥ev_block
 = 
	`SSD_PAGE_TO_BLOCK
(
¥ev_∑ge
, 
s
);

502 
∂™e_num
 = 
mëad©a
->
block_ußge
[
¥ev_block
].plane_num;

503 
∑runô_num
 = 
mëad©a
->
∂™e_mëa
[
∂™e_num
].parunit_num;

504 
ªqs
[
i
]->
∂™e_num
 =Ölane_num;

505 
	`Œ_ö£π_©_èû
(
∑runôs
[
∑runô_num
], (*)
ªqs
[
i
]);

506 
fûÀd
 ++;

511 i‡(
fûÀd
 =
tŸÆ
) {

512  
∑runôs
;

515 
i
 = 0; i < 
tŸÆ
; i ++) {

518 i‡(!
ªqs
[
i
]->
is_ªad
) {

519 
j
;

520 
¥ev_b¢
 = -1;

521 
mö_vÆid
;

523 
∂™e_num
 = -1;

524 
Õn
 = 
	`ssd_logiˇl_∑gío
(
ªqs
[
i
]->
blk
, 
s
);

525 
¥ev_∑ge
 = 
mëad©a
->
lba_èbÀ
[
Õn
];

526 
	`ASSERT
(
¥ev_∑ge
 != -1);

527 
¥ev_block
 = 
	`SSD_PAGE_TO_BLOCK
(
¥ev_∑ge
, 
s
);

528 
¥ev_b¢
 = 
mëad©a
->
block_ußge
[
¥ev_block
].
b¢
;

530 i‡(
s
->
∑øms
.
Æloc_poﬁ_logic
 =
SSD_ALLOC_POOL_PLANE
) {

531 
∂™e_num
 = 
mëad©a
->
block_ußge
[
¥ev_block
].plane_num;

534 
j
 = 
mëad©a
->
∂™e_to_wrôe
;

536 
a˘ive_block
;

537 
a˘ive_b¢
;

538 
∂™e_mëad©a
 *
pm
 = &
mëad©a
->
∂™e_mëa
[
j
];

540 
a˘ive_block
 = 
	`SSD_PAGE_TO_BLOCK
(
pm
->
a˘ive_∑ge
, 
s
);

541 
a˘ive_b¢
 = 
mëad©a
->
block_ußge
[
a˘ive_block
].
b¢
;

544 i‡((
a˘ive_b¢
 > 
¥ev_b¢
) ||

545 ((
a˘ive_b¢
 =
¥ev_b¢
Ë&& (
pm
->
a˘ive_∑ge
 > ()
¥ev_∑ge
))) {

546 
‰ì_∑ges_ö_a˘_blk
;

547 
k
;

548 
p
;

549 
tmp
;

550 
size
;

551 
addôive
 = 0;

553 
p
 = 
mëad©a
->
∂™e_mëa
[
j
].
∑runô_num
;

554 
size
 = 
	`Œ_gë_size
(
∑runôs
[
p
]);

558 
k
 = 0; k < 
size
; k ++) {

559 
ssd_ªq
 *
r
;

560 
li°node
 *
n
 = 
	`Œ_gë_¡h_node
(
∑runôs
[
p
], 
k
);

561 
	`ASSERT
(
n
 !
NULL
);

563 
r
 = ((
ssd_ªq
 *)
n
->
d©a
);

566 i‡((
r
->
∂™e_num
 =
j
) &&

567 (!
r
->
is_ªad
)) {

568 
addôive
 ++;

573 
‰ì_∑ges_ö_a˘_blk
 = 
s
->
∑øms
.
∑ges_≥r_block
 - ((
pm
->
a˘ive_∑ge
%s->∑øms.∑ges_≥r_blockË+ 
addôive
);

574 
tmp
 = 
pm
->
‰ì_blocks
 * 
s
->
∑øms
.
∑ges_≥r_block
 + 
‰ì_∑ges_ö_a˘_blk
;

576 i‡(
∂™e_num
 == -1) {

578 
mö_vÆid
 = 
tmp
;

579 
∂™e_num
 = 
j
;

581 i‡(
mö_vÆid
 < 
tmp
) {

582 
mö_vÆid
 = 
tmp
;

583 
∂™e_num
 = 
j
;

589 
j
 = (j+1Ë% 
s
->
∑øms
.
∂™es_≥r_pkg
;

590 } 
j
 !
mëad©a
->
∂™e_to_wrôe
);

593 i‡(
∂™e_num
 != -1) {

595 
mëad©a
->
∂™e_to_wrôe
 = (
∂™e_num
+1Ë% 
s
->
∑øms
.
∂™es_≥r_pkg
;

597 
ªqs
[
i
]->
∂™e_num
 =Ölane_num;

598 
∑runô_num
 = 
mëad©a
->
∂™e_mëa
[
∂™e_num
].parunit_num;

599 
	`Œ_ö£π_©_èû
(
∑runôs
[
∑runô_num
], (*)
ªqs
[
i
]);

600 
fûÀd
 ++;

602 
	`Ârötf
(
°dîr
, "Error: cannot findáÖlaneÅo write\n");

603 
	`exô
(1);

608 
	`ASSERT
(
fûÀd
 =
tŸÆ
);

610  
∑runôs
;

611 
	}
}

613 
	$ssd_issue_ovîœµed_ios
(
ssd_ªq
 **
ªqs
, 
tŸÆ
, 
ñem_num
, 
ssd_t
 *
s
)

615 
max_co°
 = 0;

616 
∑runô_›_co°
[
SSD_MAX_PARUNITS_PER_ELEM
];

617 
∑runô_tŸ_co°
[
SSD_MAX_PARUNITS_PER_ELEM
];

618 
ssd_ñemít_mëad©a
 *
mëad©a
;

619 
Õn
;

620 
i
;

621 
ªad_cy˛e
 = 0;

622 
li°node
 **
∑runôs
;

625 
i
 = 1; i < 
tŸÆ
; i ++) {

626 
	`ASSERT
(
ªqs
[
i
]->
is_ªad
 ==Ñeqs[0]->is_read);

630 i‡(
ªqs
[0]->
is_ªad
) {

631 
ªad_cy˛e
 = 1;

634 
	`mem£t
(
∑runô_tŸ_co°
, 0, ()*
SSD_MAX_PARUNITS_PER_ELEM
);

637 
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

638 
∑runôs
 = 
	`ssd_pick_∑runôs
(
ªqs
, 
tŸÆ
, 
ñem_num
, 
mëad©a
, 
s
);

643 
max_›_co°
 = 0;

644 
a˘ive_∑runôs
 = 0;

645 
›_cou¡
 = 0;

648 
i
 = 0; i < 
	`SSD_PARUNITS_PER_ELEM
(
s
); i ++) {

649 i‡(
	`Œ_gë_size
(
∑runôs
[
i
]) > 0) {

650 
a˘ive_∑runôs
 ++;

655 i‡(
a˘ive_∑runôs
 == 0) {

660 
	`mem£t
(
∑runô_›_co°
, 0, ()*
SSD_MAX_PARUNITS_PER_ELEM
);

665 
max_co°
 = 0;

666 
i
 = 0; i < 
	`SSD_PARUNITS_PER_ELEM
(
s
); i ++) {

667 
size
;

669 
size
 = 
	`Œ_gë_size
(
∑runôs
[
i
]);

670 i‡(
size
 > 0) {

672 
ssd_ªq
 *
r
;

673 
li°node
 *
n
 = 
	`Œ_gë_¡h_node
(
∑runôs
[
i
], 0);

675 
›_cou¡
 ++;

676 
	`ASSERT
(
›_cou¡
 <
a˘ive_∑runôs
);

679 
r
 = (
ssd_ªq
 *)
n
->
d©a
;

680 
Õn
 = 
	`ssd_logiˇl_∑gío
(
r
->
blk
, 
s
);

682 i‡(
r
->
is_ªad
) {

683 
∑runô_›_co°
[
i
] = 
s
->
∑øms
.
∑ge_ªad_œãncy
;

685 
∂™e_num
 = 
r
->plane_num;

687 i‡(
	`ssd_œ°_∑ge_ö_block
(
mëad©a
->
∂™e_mëa
[
∂™e_num
].
a˘ive_∑ge
, 
s
)) {

688 
	`_ssd_Æloc_a˘ive_block
(
∂™e_num
, 
ñem_num
, 
s
);

693 
mëad©a
->
a˘ive_∑ge
 = mëad©a->
∂™e_mëa
[
∂™e_num
].active_page;

695 
∑runô_›_co°
[
i
] = 
	`_ssd_wrôe_∑ge_o§
(
s
, 
mëad©a
, 
Õn
);

698 
	`ASSERT
(
r
->
cou¡
 <
s
->
∑øms
.
∑ge_size
);

702 i‡(
ªad_cy˛e
) {

703 i‡(
	`SSD_PARUNITS_PER_ELEM
(
s
) > 4) {

704 
	`¥ötf
("modifyáccÅime here ...\n");

705 
	`ASSERT
(0);

707 i‡(
›_cou¡
 == 1) {

708 
r
->
ac˘ime
 = 
∑runô_›_co°
[
i
] + 
	`ssd_d©a_å™s„r_co°
(
s
,s->
∑øms
.
∑ge_size
);

709 
r
->
schtime
 = 
∑runô_tŸ_co°
[
i
] + (
›_cou¡
-1)*
	`ssd_d©a_å™s„r_co°
(
s
,s->
∑øms
.
∑ge_size
Ë+Ñ->
ac˘ime
;

711 
r
->
ac˘ime
 = 
	`ssd_d©a_å™s„r_co°
(
s
,s->
∑øms
.
∑ge_size
);

712 
r
->
schtime
 = 
∑runô_tŸ_co°
[
i
] + 
›_cou¡
*
	`ssd_d©a_å™s„r_co°
(
s
,s->
∑øms
.
∑ge_size
Ë+ 
∑runô_›_co°
[i];

716 
r
->
ac˘ime
 = 
∑runô_›_co°
[
i
] + 
	`ssd_d©a_å™s„r_co°
(
s
,s->
∑øms
.
∑ge_size
);

717 
r
->
schtime
 = 
∑runô_tŸ_co°
[
i
] + (
›_cou¡
-1)*
	`ssd_d©a_å™s„r_co°
(
s
,s->
∑øms
.
∑ge_size
Ë+Ñ->
ac˘ime
;

722 i‡(
max_co°
 < 
r
->
schtime
) {

723 
max_co°
 = 
r
->
schtime
;

727 
	`Œ_ªÀa£_node
(
∑runôs
[
i
], 
n
);

734 
i
 = 0; i < 
	`SSD_PARUNITS_PER_ELEM
(
s
); i ++) {

735 
∑runô_tŸ_co°
[
i
] = 
max_co°
;

739 
i
 = 0; i < 
	`SSD_PARUNITS_PER_ELEM
(
s
); i ++) {

740 
	`Œ_ªÀa£
(
∑runôs
[
i
]);

742 
	`‰ì
(
∑runôs
);

744  
max_co°
;

745 
	}
}

747 
	$ssd_wrôe_⁄e_a˘ive_∑ge
(
blkno
, 
cou¡
, 
ñem_num
, 
ssd_t
 *
s
)

749 
co°
 = 0;

750 
˛ónög_övoked
 = 0;

751 
ssd_ñemít_mëad©a
 *
mëad©a
;

752 
Õn
;

754 
mëad©a
 = &(
s
->
ñemíts
[
ñem_num
].metadata);

757 
Õn
 = 
	`ssd_logiˇl_∑gío
(
blkno
, 
s
);

763 i‡(
	`ssd_œ°_∑ge_ö_block
(
mëad©a
->
a˘ive_∑ge
, 
s
)) {

766 i‡(
	`ssd_°¨t_˛ónög
(-1, 
ñem_num
, 
s
)) {

768 
	`¥ötf
 ("We shouldÇot clean here ...\n");

769 
	`ASSERT
(0);

773 i‡(
s
->
∑øms
.
˛ónög_ö_background
) {

774 
	`exô
(1);

777 
˛ónög_övoked
 = 1;

778 
co°
 +
	`ssd_˛ón_ñemít_no_c›yback
(
ñem_num
, 
s
);

786 i‡(!
˛ónög_övoked
 ||

787 
	`ssd_œ°_∑ge_ö_block
(
mëad©a
->
a˘ive_∑ge
, 
s
)) {

788 
	`_ssd_Æloc_a˘ive_block
(-1, 
ñem_num
, 
s
);

794 
co°
 +
	`_ssd_wrôe_∑ge_o§
(
s
, 
mëad©a
, 
Õn
);

795 
co°
 +
	`ssd_d©a_å™s„r_co°
(
s
, 
cou¡
);

797  
co°
;

798 
	}
}

804 
	gssd_compuã_ac˚ss_time_⁄e_a˘ive_∑ge


805 (
ssd_ªq
 **
	gªqs
, 
	gtŸÆ
, 
	gñem_num
, 
ssd_t
 *
	gs
)

808 
	gco°
;

809 
	gblkno
;

810 
	gcou¡
;

811 
	gis_ªad
;

814 
ASSERT
(
tŸÆ
 == 1);

816 
	gblkno
 = 
ªqs
[0]->
blk
;

817 
	gcou¡
 = 
ªqs
[0]->
cou¡
;

818 
	gis_ªad
 = 
ªqs
[0]->
is_ªad
;

820 i‡(
	gis_ªad
) {

822 
	gs
->
	g∑øms
.
	gwrôe_pﬁicy
) {

823 
	gDISKSIM_SSD_WRITE_POLICY_SIMPLE
:

824 
DISKSIM_SSD_WRITE_POLICY_OSR
:

826 
co°
 = 
ssd_ªad_pﬁicy_sim∂e
(
cou¡
, 
s
);

830 
Ârötf
(
°dîr
, "Error: unknown writeÖolicy %d in ssd_compute_access_time\n",

831 
s
->
∑øms
.
wrôe_pﬁicy
);

832 
exô
(1);

835 
	gs
->
	g∑øms
.
	gwrôe_pﬁicy
) {

836 
	gDISKSIM_SSD_WRITE_POLICY_SIMPLE
:

837 
co°
 = 
ssd_wrôe_pﬁicy_sim∂e
(
blkno
, 
cou¡
, 
ñem_num
, 
s
);

840 
	gDISKSIM_SSD_WRITE_POLICY_OSR
:

841 
co°
 = 
ssd_wrôe_⁄e_a˘ive_∑ge
(
blkno
, 
cou¡
, 
ñem_num
, 
s
);

845 
Ârötf
(
°dîr
, "Error: unknown writeÖolicy %d in ssd_compute_access_time\n",

846 
s
->
∑øms
.
wrôe_pﬁicy
);

847 
exô
(1);

851 
	gªqs
[0]->
	gac˘ime
 = 
co°
;

852 
	gªqs
[0]->
	gschtime
 = 
co°
;

880 
	$ssd_compuã_ac˚ss_time
(
ssd_t
 *
s
, 
ñem_num
, 
ssd_ªq
 **
ªqs
, 
tŸÆ
)

882 i‡(
tŸÆ
 == 0) {

886 i‡(
s
->
∑øms
.
c›y_back
 =
SSD_COPY_BACK_DISABLE
) {

887 
	`ssd_compuã_ac˚ss_time_⁄e_a˘ive_∑ge
(
ªqs
, 
tŸÆ
, 
ñem_num
, 
s
);

889 
	`ssd_issue_ovîœµed_ios
(
ªqs
, 
tŸÆ
, 
ñem_num
, 
s
);

891 
	}
}

893 
	$ssd_‰ì_timög_ñemít
(
ssd_timög_t
 *
t
)

895 
	`‰ì
(
t
);

896 
	}
}

898 
ssd_timög_t
 *
	$ssd_√w_timög_t
(
ssd_timög_∑øms
 *
∑øms
)

900 
i
;

901 
my_timög_t
 *
â
 = 
	`mÆloc
((my_timing_t));

902 
â
->
∑øms
 =Öarams;

903 
â
->
t
.
choo£_ñemít
 = 
ssd_choo£_ñemít
;

905 
â
->
t
.
‰ì
 = 
ssd_‰ì_timög_ñemít
;

906 
i
=0; i<
SSD_MAX_ELEMENTS
; i++)

907 
â
->
√xt_wrôe_∑ge
[
i
] = -1;

908  &
â
->
t
;

909 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_timing.h

4 #i‚de‡
DISKSIM_SSD_TIMING_H


5 
	#DISKSIM_SSD_TIMING_H


	)

7 
	s_ssd_timög_t
 {

8 (*
	mchoo£_ñemít
)(
_ssd_timög_t
 *
	mt
, 
	mblkno
);

9 (*
	m‰ì
)(
_ssd_timög_t
 *
	mt
);

10 } 
	tssd_timög_t
;

21 
ssd_timög_t
 *
ssd_√w_timög_t
(
ssd_timög_∑øms
 *
∑øms
);

22 
ssd_choo£_Æig√d_cou¡
(
∑ge_size
, 
blkno
, 
cou¡
);

23 
ssd_compuã_ac˚ss_time
(
ssd_t
 *
s
, 
ñem_num
, 
ssd_ªq
 **
ªqs
, 
tŸÆ
);

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_utils.c

4 
	~"ssd_utûs.h
"

13 
	$ssd_˛ór_bô
(*
c
, 
pos
)

15 
byã
 = 
pos
 / 8;

16 
bô_pos
 = 7 - (
pos
 % 8);

18 
c
[
byã
] = (c[byã] & (~(0x1 << 
bô_pos
)));

21 
	}
}

27 
	$ssd_£t_bô
(*
c
, 
pos
)

29 
byã
 = 
pos
 / 8;

30 
bô_pos
 = 7 - (
pos
 % 8);

32 
c
[
byã
] = (c[byã] | (0x1 << 
bô_pos
));

35 
	}
}

38 
	$ssd_bô_⁄
(*
c
, 
pos
)

40 
byã
 = 
pos
 / 8;

41 
bô_pos
 = 7 - (
pos
 % 8);

43  (
c
[
byã
] & (0x1 << 
bô_pos
));

44 
	}
}

52 
	$ssd_föd_zîo_bô
(*
c
, 
tŸÆ
, 
°¨t
)

54 
bô
 = 
°¨t
;

55 
ãmp
 = 
tŸÆ
;

57 
ãmp
) {

58 
byã
 = 
bô
 / 8;

59 i‡((
c
[
byã
] >> (7 - (
bô
 % 8))) & 0x1) {

60 
bô
 = (bô + 1Ë% 
tŸÆ
;

61 
ãmp
 --;

63  
bô
;

68 
	}
}

74 
	$Œ_¸óã
(
li°node
 **
°¨t
)

76 *
°¨t
 = (
li°node
 *)
	`mÆloc
((listnode));

77 
	`mem£t
(*
°¨t
, 0, (
li°node
));

79 (*
°¨t
)->
d©a
 = (
hódî_d©a
 *)
	`mÆloc
((header_data));

80 ((
hódî_d©a
 *)(*
°¨t
)->
d©a
)->
size
 = 0;

81 
	}
}

84 
	$Œ_ªÀa£
(
li°node
 *
°¨t
)

86 
	`‰ì
(
°¨t
->
d©a
);

88 
°¨t
) {

89 
li°node
 *
√xt
 = 
°¨t
->next;

91 i‡(
√xt
) {

92 
√xt
->
¥ev
 = 
NULL
;

94 i‡(
√xt
 =
°¨t
) {

95 
√xt
 = 
NULL
;

99 i‡(
°¨t
->
¥ev
) {

100 
°¨t
->
¥ev
->
√xt
 = 
NULL
;

107 
	`‰ì
(
°¨t
);

109 
°¨t
 = 
√xt
;

113 
	}
}

115 
li°node
 *
	$_Œ_ö£π_©_èû
(
li°node
 *
°¨t
,Üi°nodê*
toö£π
)

117 i‡((!
°¨t
Ë|| (!
toö£π
)) {

118 
	`Ârötf
(
°dîr
, "Error: invalid valueÅo _ll_insert_at_tail\n");

119 
	`exô
(-1);

121 i‡(
°¨t
->
¥ev
) {

122 
li°node
 *
¥evnode
 = 
°¨t
->
¥ev
;

124 
toö£π
->
√xt
 = 
¥evnode
->next;

125 
¥evnode
->
√xt
->
¥ev
 = 
toö£π
;

126 
¥evnode
->
√xt
 = 
toö£π
;

127 
toö£π
->
¥ev
 = 
¥evnode
;

129 
°¨t
->
¥ev
 = 
toö£π
;

130 
°¨t
->
√xt
 = 
toö£π
;

131 
toö£π
->
¥ev
 = 
°¨t
;

132 
toö£π
->
√xt
 = 
°¨t
;

135  
toö£π
;

137 
	}
}

141 
li°node
 *
	$_Œ_ö£π_©_hód
(
li°node
 *
°¨t
,Üi°nodê*
toö£π
)

143 i‡((!
°¨t
Ë|| (!
toö£π
)) {

144 
	`Ârötf
(
°dîr
, "Error: invalid valueÅo _ll_insert_at_head\n");

145 
	`exô
(-1);

147 i‡(
°¨t
->
√xt
) {

148 
li°node
 *
√xäode
 = 
°¨t
->
√xt
;

150 
toö£π
->
¥ev
 = 
√xäode
->prev;

151 
√xäode
->
¥ev
->
√xt
 = 
toö£π
;

152 
√xäode
->
¥ev
 = 
toö£π
;

153 
toö£π
->
√xt
 = 
√xäode
;

155 
°¨t
->
√xt
 = 
toö£π
;

156 
°¨t
->
¥ev
 = 
toö£π
;

157 
toö£π
->
√xt
 = 
°¨t
;

158 
toö£π
->
¥ev
 = 
°¨t
;

161  
toö£π
;

163 
	}
}

168 
li°node
 *
	$Œ_ö£π_©_èû
(
li°node
 *
°¨t
, *
d©a
)

171 
li°node
 *
√wnode
 = 
	`mÆloc
((listnode));

172 
√wnode
->
d©a
 = data;

175 ((
hódî_d©a
 *)(
°¨t
->
d©a
))->
size
 ++;

177  
	`_Œ_ö£π_©_èû
(
°¨t
, 
√wnode
);

178 
	}
}

186 
li°node
 *
	$Œ_ö£π_©_hód
(
li°node
 *
°¨t
, *
d©a
)

189 
li°node
 *
√wnode
 = 
	`mÆloc
((listnode));

190 
√wnode
->
d©a
 = data;

193 ((
hódî_d©a
 *)(
°¨t
->
d©a
))->
size
 ++;

195  
	`_Œ_ö£π_©_hód
(
°¨t
, 
√wnode
);

196 
	}
}

201 
	$Œ_ªÀa£_node
(
li°node
 *
°¨t
,Üi°nodê*
node
)

203 i‡((!
node
Ë|| (!
°¨t
)) {

204 
	`Ârötf
(
°dîr
, "Error: invalid items onÅheÜist\n");

205 
	`exô
(-1);

207 ((
hódî_d©a
 *)(
°¨t
->
d©a
))->
size
 --;

211 i‡(((
hódî_d©a
 *)(
°¨t
->
d©a
))->
size
 > 0) {

212 
li°node
 *
node•ªv
 = 
node
->
¥ev
;

214 
node•ªv
->
√xt
 = 
node
->next;

215 
node
->
√xt
->
¥ev
 = 
node•ªv
;

222 i‡((
°¨t
->
√xt
 !
node
Ë|| (°¨t->
¥ev
 !=Çode)) {

223 
	`Ârötf
(
°dîr
, "Error: sanity check failed\n");

224 
	`exô
(-1);

228 
°¨t
->
√xt
 = 
NULL
;

229 
°¨t
->
¥ev
 = 
NULL
;

236 
	`‰ì
(
node
);

238 
	}
}

243 
	$Œ_ªÀa£_èû
(
li°node
 *
°¨t
)

245 
li°node
 *
èû
 = 
°¨t
->
¥ev
;

247 i‡((!
èû
Ë|| (èû =
°¨t
)) {

248 
	`Ârötf
(
°dîr
, "Warning:ÅheÜist isÉmpty.ÇoÉlementÅoÑelease\n");

251 
	`Œ_ªÀa£_node
(
°¨t
, 
èû
);

253 
	}
}

255 
li°node
 *
	$Œ_gë_èû
(
li°node
 *
°¨t
)

257  (
°¨t
->
¥ev
->
d©a
);

258 
	}
}

260 
li°node
 *
	$Œ_gë_hód
(
li°node
 *
°¨t
)

262  (
°¨t
->
√xt
->
d©a
);

263 
	}
}

268 
	$Œ_gë_size
(
li°node
 *
°¨t
)

270  ((
hódî_d©a
 *)(
°¨t
->
d©a
))->
size
;

271 
	}
}

279 
li°node
 *
	$Œ_gë_¡h_node
(
li°node
 *
°¨t
, 
n
)

281 
i
;

282 
ªvî£
;

283 
li°node
 *
node
;

285 i‡(
n
 >
	`Œ_gë_size
(
°¨t
)) {

286 
	`Ârötf
(
°dîr
, "Error:Ç (%d) is greaterÅhan size %d\n",

287 
n
, 
	`Œ_gë_size
(
°¨t
));

288  
NULL
;

291 i‡(
n
 > 
	`Œ_gë_size
(
°¨t
)/2) {

292 
i
 = 
	`Œ_gë_size
(
°¨t
) - 1;

293 
ªvî£
 = 1;

294 
node
 = 
°¨t
->
¥ev
;

296 
i
 = 0;

297 
ªvî£
 = 0;

298 
node
 = 
°¨t
->
√xt
;

302 (
node
Ë&& (nodê!
°¨t
)) {

303 i‡(
i
 =
n
) {

304  
node
;

307 i‡(
ªvî£
) {

308 
node
 =Çode->
¥ev
;

309 
i
 --;

311 
node
 =Çode->
√xt
;

312 
i
 ++;

316 
	`Ârötf
(
°dîr
, "Eº‹: c™nŸ födÅhê%dÇodêöÜi°\n", 
n
);

317  
NULL
;

318 
	}
}

321 
li°node
 *
	$Œ_föd_d©a
(
li°node
 *
°¨t
,*
d©a
){

322 
size
 = ((
hódî_d©a
 *)(
°¨t
->
d©a
))->size;

323 
li°node
 *
p
 = 
°¨t
->
√xt
;

325 if(
p
 =
NULL
)

328 
°¨t
!=
p
){

330 if(
p
->
d©a
 == data)

331  
p
;

333 
p
 =Ö->
√xt
;

336  
NULL
;

337 
	}
}

380 
	#N
 624

	)

381 
	#M
 397

	)

382 
	#MATRIX_A
 0x9908b0d‡

	)

383 
	#UPPER_MASK
 0x80000000

	)

384 
	#LOWER_MASK
 0x7ffffff‡

	)

387 
	#TEMPERING_MASK_B
 0x9d2c5680

	)

388 
	#TEMPERING_MASK_C
 0xefc60000

	)

389 
	#TEMPERING_SHIFT_U
(
y
Ë(y >> 11)

	)

390 
	#TEMPERING_SHIFT_S
(
y
Ë(y << 7)

	)

391 
	#TEMPERING_SHIFT_T
(
y
Ë(y << 15)

	)

392 
	#TEMPERING_SHIFT_L
(
y
Ë(y >> 18)

	)

394 
	gmt
[
N
];

395 
	gmti
=
N
+1;

399 
	$sgíønd
(
£ed
)

400 
£ed
;

402 
i
;

404 
i
=0;i<
N
;i++) {

405 
mt
[
i
] = 
£ed
 & 0xffff0000;

406 
£ed
 = 69069 * seed + 1;

407 
mt
[
i
] |(
£ed
 & 0xffff0000) >> 16;

408 
£ed
 = 69069 * seed + 1;

410 
mti
 = 
N
;

411 
	}
}

423 
	$lsgíønd
(
£ed_¨øy
)

424 
£ed_¨øy
[];

427 
i
;

429 
i
=0;i<
N
;i++)

430 
mt
[
i
] = 
£ed_¨øy
[i];

431 
mti
=
N
;

432 
	}
}

435 
	$gíønd
()

437 
y
;

438 
mag01
[2]={0x0, 
MATRIX_A
};

441 i‡(
mti
 >
N
) {

442 
kk
;

444 i‡(
mti
 =
N
+1)

445 
	`sgíønd
(4357);

447 
kk
=0;kk<
N
-
M
;kk++) {

448 
y
 = (
mt
[
kk
]&
UPPER_MASK
)|(mt[kk+1]&
LOWER_MASK
);

449 
mt
[
kk
] = mt[kk+
M
] ^ (
y
 >> 1Ë^ 
mag01
[y & 0x1];

451 ;
kk
<
N
-1;kk++) {

452 
y
 = (
mt
[
kk
]&
UPPER_MASK
)|(mt[kk+1]&
LOWER_MASK
);

453 
mt
[
kk
] = mt[kk+(
M
-
N
)] ^ (
y
 >> 1Ë^ 
mag01
[y & 0x1];

455 
y
 = (
mt
[
N
-1]&
UPPER_MASK
)|(mt[0]&
LOWER_MASK
);

456 
mt
[
N
-1] = mt[
M
-1] ^ (
y
 >> 1Ë^ 
mag01
[y & 0x1];

458 
mti
 = 0;

461 
y
 = 
mt
[
mti
++];

462 
y
 ^
	`TEMPERING_SHIFT_U
(y);

463 
y
 ^
	`TEMPERING_SHIFT_S
(yË& 
TEMPERING_MASK_B
;

464 
y
 ^
	`TEMPERING_SHIFT_T
(yË& 
TEMPERING_MASK_C
;

465 
y
 ^
	`TEMPERING_SHIFT_L
(y);

467  
y
;

468 
	}
}

471 
	#DEVIDE
 10

	)

473 
	#SCALE_DOWN
 5

	)

474 
	#SIZE
 100

	)

475 
	#SIZE_DOWN
 (
SIZE
/
SCALE_DOWN
)

	)

476 
	#MKINDEX
(
k
,
i
,
j
Ë(k*
SIZE_DOWN
*SIZE_DOWN + i*SIZE_DOWN+j)

	)

477 
	#MKINDEX2
(
k
,
i
,
j
Ë(k*
SIZE
*SIZE + i*SIZE+j)

	)

483 
	$wow_ˇlc_bñady
(
csize1
,
csize2
, 
hô1
, 
hô2
,*
˝
, *
kp
){

484 
i
, 
j
, 
k
;

485 
hô_øtio
;

486 *
¨øy
;

487 
mö_îr‹
 = 1.0;

488 
mö_i
 = 0,
mö_j
 = 0;

491 
¨øy
 = (*)
	`mÆloc
((Ë* 2 * (
SIZE
/
SCALE_DOWN
) * SIZE/SCALE_DOWN);

492 if(
¨øy
 =
NULL
){

493 
	`¥ötf
(" mallocÉrror \n");

494 
	`exô
(1);

497 
k
 = 0;k < 2;k++){

498 
i
 = 1;ò< 
SIZE_DOWN
;i++){

499 
j
 = 1;j < 
SIZE_DOWN
; j++){

500 
¨øy
[
	`MKINDEX
(
k
, 
i
, 
j
)] = 0;

507 
i
 = 1;ò< 
SIZE
;i++){

508 
j
 = 1;j < 
SIZE
; j++){

510 
hô_øtio
 = 
	`BELADY
((()
i
/
DEVIDE
), (()
j
/DEVIDE),
csize1
);

512 if(()(
hô_øtio
*100Ë=()(
hô1
*100)){

513 
¨øy
[
	`MKINDEX
(0, 
i
/
SCALE_DOWN
, 
j
/SCALE_DOWN)] = 1;

519 
i
 = 1;ò< 
SIZE
;i++){

520 
j
 = 1;j < 
SIZE
; j++){

522 
hô_øtio
 = 
	`BELADY
((()
i
/
DEVIDE
), (()
j
/DEVIDE),
csize2
);

524 if(()(
hô_øtio
*100Ë=()(
hô2
*100)){

525 
¨øy
[
	`MKINDEX
(1, 
i
/
SCALE_DOWN
, 
j
/SCALE_DOWN)] = 1;

531 
i
 = 1;ò< 
SIZE_DOWN
;i++){

532 
j
 = 1;j < 
SIZE_DOWN
; j++){

533 if(
¨øy
[
	`MKINDEX
(0, 
i
, 
j
)] &&árray[MKINDEX(1, i,j)]){

534 
îr1
, 
îr2
;

538 
îr1
 = 
	`BELADY
(()
i
*
SCALE_DOWN
/
DEVIDE
, ()
j
*SCALE_DOWN/DEVIDE, 
csize1
Ë- 
hô1
;

539 
îr1
 = 
	`sqπ
(err1*err1);

540 
îr2
 = 
	`BELADY
(()
i
*
SCALE_DOWN
/
DEVIDE
, ()
j
*SCALE_DOWN/DEVIDE, 
csize2
Ë- 
hô2
;

541 
îr2
 = 
	`sqπ
(err2*err2);

543 if(
mö_îr‹
 > 
îr1
+
îr2
){

544 
mö_îr‹
 = 
îr1
 + 
îr2
;

545 
mö_i
 = 
i
;

546 
mö_j
 = 
j
;

552 if(
mö_i
 && 
mö_j
) {

559 if(
˝
){

560 *
˝
 = ()
mö_i
*
SCALE_DOWN
/
DEVIDE
;

562 if(
kp
){

563 *
kp
 = ()
mö_j
*
SCALE_DOWN
/
DEVIDE
;

566 
	`fÊush
(
°dout
);

568 
	`‰ì
(
¨øy
);

570  (
mö_i
 && 
mö_j
);

571 
	}
}

575 
li°node
 *
Œ_föd_node
÷i°nodê*
°¨t
,*
d©a
, (*
CompFunc
) (const *,const *)){

576 
size
 = ((
hódî_d©a
 *)(
°¨t
->
d©a
))->size;

577 
li°node
 *
p
 = 
°¨t
->
√xt
;

580 if(
p
 =
NULL
)

583 
°¨t
!=
p
){

585 if(
	`CompFunc
(
p
->
d©a
, data))

586  
p
;

588 
p
 =Ö->
√xt
;

591  
NULL
;

592 
	}
}

596 
li°node
 *
_Œ_ö£π_©_s‹t
÷i°nodê*
°¨t
,Üi°nodê*
toö£π
, (*
CompFunc
) (const *,const *)){

597 
li°node
 *
g_√w
, *
g_¥ev
;

598 
li°node
 *
ãmp
;

599 
g_√w
 = 
toö£π
->
d©a
;

601 i‡((!
°¨t
Ë|| (!
toö£π
)) {

602 
	`Ârötf
(
°dîr
, "Error: invalid valueÅo _ll_insert_at_tail\n");

603 
	`exô
(-1);

605 i‡(
°¨t
->
¥ev
) {

606 
li°node
 *
¥evnode
 = 
°¨t
->
¥ev
;

607 
g_¥ev
 = 
¥evnode
->
d©a
;

609 
	`CompFunc
(
g_√w
, 
g_¥ev
Ë> 0 && 
¥evnode
 !
°¨t
){

610 
¥evnode
 =Öªvnode->
¥ev
;

611 
g_¥ev

¥evnode
->
d©a
;

614 
toö£π
->
√xt
 = 
¥evnode
->next;

615 
¥evnode
->
√xt
->
¥ev
 = 
toö£π
;

616 
¥evnode
->
√xt
 = 
toö£π
;

617 
toö£π
->
¥ev
 = 
¥evnode
;

619 
°¨t
->
¥ev
 = 
toö£π
;

620 
°¨t
->
√xt
 = 
toö£π
;

621 
toö£π
->
¥ev
 = 
°¨t
;

622 
toö£π
->
√xt
 = 
°¨t
;

625  
toö£π
;

627 
	}
}

628 
li°node
 *
Œ_ö£π_©_s‹t
÷i°nodê*
°¨t
, *
d©a
, (*
comp_func
) (const *,const *))

631 
li°node
 *
√wnode
 = 
	`mÆloc
((listnode));

632 
√wnode
->
d©a
 = data;

635 ((
hódî_d©a
 *)(
°¨t
->
d©a
))->
size
 ++;

637  
	`_Œ_ö£π_©_s‹t
(
°¨t
, 
√wnode
, 
comp_func
);

638 
	}
}

682 
li°node
 *
	$_Œ_ö£π_©_√xt
(
li°node
 *
°¨t
,Üi°nodê*
±r
,Üi°nodê*
toö£π
){

683 
li°node
 *
g_√w
, *
g_¥ev
;

684 
li°node
 *
ãmp
;

685 
g_√w
 = 
toö£π
->
d©a
;

687 i‡((!
°¨t
Ë|| (!
toö£π
)) {

688 
	`Ârötf
(
°dîr
, "Error: invalid valueÅo _ll_insert_at_tail\n");

689 
	`exô
(-1);

691 i‡(
°¨t
->
√xt
) {

693 
li°node
 *
√xäode
 = 
±r
;

695 
toö£π
->
√xt
 = 
√xäode
->next;

696 
√xäode
->
√xt
->
¥ev
 = 
toö£π
;

697 
√xäode
->
√xt
 = 
toö£π
;

698 
toö£π
->
¥ev
 = 
√xäode
;

700 
°¨t
->
¥ev
 = 
toö£π
;

701 
°¨t
->
√xt
 = 
toö£π
;

702 
toö£π
->
¥ev
 = 
°¨t
;

703 
toö£π
->
√xt
 = 
°¨t
;

706  
toö£π
;

708 
	}
}

709 
li°node
 *
	$Œ_ö£π_©_√xt
(
li°node
 *
°¨t
,Üi°nodê*
±r
,*
d©a
)

712 
li°node
 *
√wnode
 = 
	`mÆloc
((listnode));

713 
√wnode
->
d©a
 = data;

716 ((
hódî_d©a
 *)(
°¨t
->
d©a
))->
size
 ++;

719  
	`_Œ_ö£π_©_√xt
(
°¨t
, 
±r
, 
√wnode
);

720 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_utils.h

4 #i‚de‡
__DISKSIM_SSD_UTILS_H__


5 
	#__DISKSIM_SSD_UTILS_H__


	)

6 
	~"ssd.h
"

7 
	~<m©h.h
>

12 
ssd_˛ór_bô
(*
c
, 
pos
);

13 
ssd_£t_bô
(*
c
, 
pos
);

14 
ssd_bô_⁄
(*
c
, 
pos
);

15 
ssd_föd_zîo_bô
(*
c
, 
tŸÆ
, 
°¨t
);

22 
	g_li°node
;

24 
	s_li°node
 {

25 
_li°node
 *
	m¥ev
;

26 
_li°node
 *
	m√xt
;

27 *
	md©a
;

28 } 
	tli°node
;

30 
	s_hódî_d©a
 {

31 
	msize
;

32 } 
	thódî_d©a
;

34 
Œ_¸óã
(
li°node
 **
°¨t
);

35 
Œ_ªÀa£
(
li°node
 *
°¨t
);

36 
li°node
 *
Œ_ö£π_©_èû
÷i°nodê*
°¨t
, *
d©a
);

37 
li°node
 *
Œ_ö£π_©_hód
÷i°nodê*
°¨t
, *
d©a
);

38 
Œ_ªÀa£_node
(
li°node
 *
°¨t
,Üi°nodê*
node
);

39 
Œ_ªÀa£_èû
(
li°node
 *
°¨t
);

40 
li°node
 *
Œ_gë_èû
÷i°nodê*
°¨t
);

41 
Œ_gë_size
(
li°node
 *
°¨t
);

42 
li°node
 *
Œ_gë_¡h_node
÷i°nodê*
°¨t
, 
n
);

45 
	#RND
(
x
Ë((x>0)?(
	`gíønd
(Ë% (x)):0)

	)

46 
gíønd
();

47 
sgíønd
();

49 
li°node
 *
Œ_föd_node
÷i°nodê*
°¨t
,*
d©a
, (*
CompFunc
) (const *,const *));

51 
	`wow_ˇlc_bñady
(
csize1
,
csize2
, 
hô1
, 
hô2
, *, *);

52 
li°node
 *
	`_Œ_ö£π_©_s‹t
÷i°nodê*
°¨t
,Üi°nodê*
toö£π
, (*
CompFunc
) (const *,const *));

53 
li°node
 *
	`Œ_ö£π_©_s‹t
÷i°nodê*
°¨t
, *
d©a
, (*
comp_func
) (const *,const *));

54 
li°node
 *
	`Œ_ö£π_©_√xt
÷i°nodê*
°¨t
,Üi°nodê*
±r
,*
d©a
);

57 
	#BELADY
(
c
, 
k
, 
n
Ë(1 - (cË* 
	`pow
“ ,(-k)))

	)

	@/Users/ysoh/disksim-4.0-fcl/utils/params/libparam_to_v3.c

34 
	~<lib∑øm/lib∑øm.h
>

36 
	~<moduÀs/disksim_disk_∑øm.h
>

43 
	~<diskmodñ/moduÀs/dm_disk_∑øm.h
>

44 
	~<diskmodñ/moduÀs/dm_œyout_g1_∑øm.h
>

45 
	~<diskmodñ/moduÀs/dm_mech_g1_∑øm.h
>

49 
	~<°dio.h
>

50 
	~<°dlib.h
>

51 
	~<°rög.h
>

53 
	~<libddbg/libddbg.h
>

57 
	#DISKSIM_dønd48
 
dønd48


	)

59 
	gnums
[4];

61 
	ewh©
 {

62 
	mDISK
,

63 
	mDMDISK
,

64 
	mDMLAYOUT
,

65 
	mDMMECH


68 *
	gﬁd•ec
;

69 *
	g√w•ec
;

70 *
	gmodñfûe
;

73 
	$fix_z⁄ñi°
(
Õ_li°
 *
l
) {

74 
c
;

75 
z⁄ëy≥
;

76 
	`Õ_lookup_ty≥
("dm_œyout_g1_z⁄e", &
z⁄ëy≥
);

78 
c
 = 0; c < 
l
->
vÆues_Àn
; c++) {

79 if(!
l
->
vÆues
[
c
]) { ; }

81 
l
->
vÆues
[
c
]->
v
.
b
->
ty≥
 = 
z⁄ëy≥
;

83 
	}
}

87 *
	$no›
(
Õ_block
 *
junk1
, 
junk2
Ë{  0; 
	}
}

88 *
	$lﬂdî
(
Õ_block
 *
b
, 
foo
) {

89 
c
;

90 
modñfûï¨am
[80];

91 
modñ«me
[80];

92 
FILE
 *
df
, *
mf
;

94 
Õ_block
 
disk
, 
dmdisk
, 
œyout
, 
mech
;

95 
Õ_∑øm
 
œyout_p
, 
mech_p
, 
modñfûe_p
;

96 
Õ_vÆue
 
œyout_v
, 
mech_v
, 
modñfûe_v
;

98 
	`bzîo
(&
mech
, (
Õ_block
));

99 
	`bzîo
(&
disk
, (
Õ_block
));

100 
	`bzîo
(&
dmdisk
, (
Õ_block
));

101 
	`bzîo
(&
œyout
, (
Õ_block
));

103 
	`bzîo
(&
œyout_p
, (
Õ_∑øm
));

104 
	`bzîo
(&
mech_p
, (
Õ_∑øm
));

105 
	`bzîo
(&
modñfûe_p
, (
Õ_∑øm
));

107 
	`•rötf
(
modñfûï¨am
, "sour˚ %s", 
modñfûe
);

109 
modñfûe_p
.
«me
 = 
	`°rdup
("Model");

110 
modñfûe_p
.
v
 = &
modñfûe_v
;

111 
modñfûe_p
.
v
->v.
s
 = 
modñfûï¨am
;

112 
modñfûe_p
.
v
->
t
 = 
S
;

115 
	`Õ_add_∑øm
(&
disk
.
∑øms
, &disk.
∑øms_Àn
, &
modñfûe_p
);

117 
c
 = 0; c < 
b
->
∑øms_Àn
; c++) {

118 if(!
b
->
∑øms
[
c
]) {

123 if(
	`Õ_∑øm_«me
(
nums
[
DMDISK
], 
b
->
∑øms
[
c
]->
«me
) != -1) {

124 
	`Õ_add_∑øm
(&
dmdisk
.
∑øms
, &dmdisk.
∑øms_Àn
, 
b
->∑øms[
c
]);

127 if(
	`Õ_∑øm_«me
(
nums
[
DMLAYOUT
], 
b
->
∑øms
[
c
]->
«me
) != -1) {

128 if(!
	`°rcmp
(
b
->
∑øms
[
c
]->
«me
, "Zones")) {

129 
	`fix_z⁄ñi°
(
	`LVAL
(
b
->
∑øms
[
c
]));

131 
	`Õ_add_∑øm
(&
œyout
.
∑øms
, &œyout.
∑øms_Àn
, 
b
->∑øms[
c
]);

134 if(
	`Õ_∑øm_«me
(
nums
[
DMMECH
], 
b
->
∑øms
[
c
]->
«me
) != -1) {

135 
	`Õ_add_∑øm
(&
mech
.
∑øms
, &mech.
∑øms_Àn
, 
b
->∑øms[
c
]);

138 if(
	`Õ_∑øm_«me
(
nums
[
DISK
], 
b
->
∑øms
[
c
]->
«me
) != -1) {

139 if(!
	`°rcmp
(
b
->
∑øms
[
c
]->
«me
, "Scheduler")) {

140 
	`Õ_lookup_ty≥
("disksim_ioqueue", &
b
->
∑øms
[
c
]->
v
->v.b->
ty≥
);

142 
	`Õ_add_∑øm
(&
disk
.
∑øms
, &disk.
∑øms_Àn
, 
b
->∑øms[
c
]);

146 
	`Õ_lookup_ty≥
("disksim_disk", &
disk
.
ty≥
);

149 
œyout_p
.
«me
 = 
	`°rdup
("Layout Model");

150 
œyout_p
.
v
 = &
œyout_v
;

151 
œyout_p
.
v
->v.
b
 = &
œyout
;

152 
œyout_p
.
v
->
t
 = 
BLOCK
;

155 
mech_p
.
«me
 = 
	`°rdup
("Mechanical Model");

156 
mech_p
.
v
 = &
mech_v
;

157 
mech_p
.
v
->v.
b
 = &
mech
;

158 
mech_p
.
v
->
t
 = 
BLOCK
;

161 
dmdisk
.
«me
 = 
	`°rdup
(
b
->name);

162 
disk
.
«me
 = 
	`°rdup
(
b
->name);

164 
	`•rötf
(
modñ«me
, "%s_modñ", 
b
->
«me
);

165 
dmdisk
.
«me
 = 
modñ«me
;

166 
dmdisk
.
ty≥
 = 
nums
[
DMDISK
];

167 
mech
.
ty≥
 = 
nums
[
DMMECH
];

168 
œyout
.
ty≥
 = 
nums
[
DMLAYOUT
];

170 
	`Õ_add_∑øm
(&
dmdisk
.
∑øms
, &dmdisk.
∑øms_Àn
, &
œyout_p
);

171 
	`Õ_add_∑øm
(&
dmdisk
.
∑øms
, &dmdisk.
∑øms_Àn
, &
mech_p
);

175 
	`ddbg_as£π
(
df
 = 
	`f›í
(
√w•ec
, "w"));

176 
	`ddbg_as£π
(
mf
 = 
	`f›í
(
modñfûe
, "w"));

179 
	`u≈¨£_block
(&
disk
, 
df
);

180 
	`¥ötf
("\n\n\n");

181 
	`u≈¨£_block
(&
dmdisk
, 
mf
);

184 
	}
}

187 
	$maö
(
¨gc
, **
¨gv
) {

189 
FILE
 *
öputfûe
;

191 
Õ_mod
 
disk
 = { "disk",

192 
disksim_disk_∑øms
,

193 
DISKSIM_DISK_MAX
,

194 
lﬂdî
,

199 
Õ_mod
 
dsdisk
 = { "disksim_disk",

200 
disksim_disk_∑øms
,

201 
DISKSIM_DISK_MAX
,

202 
lﬂdî
,

207 
Õ_mod
 
ioqueue
 = { "ioqueue", 0, 0, 
no›
, 0, 0, 0, 0 };

209 
Õ_mod
 
dsioqueue
 = { "disksim_ioqueue", 0, 0, 
no›
, 0, 0, 0, 0 };

211 
Õ_mod
 
z⁄e
 = { "z⁄e", 0, 0, 
no›
, 0, 0, 0, 0 };

213 
Õ_mod
 
dmz⁄e
 = { "dm_œyout_g1_z⁄e", 0, 0, 
no›
, 0, 0, 0, 0 };

214 
Õ_mod
 
dm_disk
 = 
dm_disk_mod
;

215 
Õ_mod
 
dm_œyout_g1
 = 
dm_œyout_g1_mod
;

216 
Õ_mod
 
dm_mech_g1
 = 
dm_mech_g1_mod
;

218 if(
¨gc
 != 5) {

219 
	`Ârötf
(
°dîr
, "usage: convert_diskspec <oldspec> <diskname> <newspec> <model>\n");

220 
	`exô
(1);

223 
ﬁd•ec
 = 
¨gv
[1];

224 
√w•ec
 = 
¨gv
[3];

225 
modñfûe
 = 
¨gv
[4];

227 
	`ddbg_as£π_£tfûe
(
°dîr
);

229 
öputfûe
 = 
	`f›í
(
ﬁd•ec
, "r");

231 
nums
[
DISK
] = 
	`Õ_ªgi°î_moduÀ
(&
disk
);

232 
	`Õ_ªgi°î_moduÀ
(&
dsdisk
);

233 
	`Õ_ªgi°î_moduÀ
(&
ioqueue
);

234 
	`Õ_ªgi°î_moduÀ
(&
dsioqueue
);

235 
	`Õ_ªgi°î_moduÀ
(&
z⁄e
);

236 
	`Õ_ªgi°î_moduÀ
(&
dmz⁄e
);

238 
nums
[
DMDISK
] = 
	`Õ_ªgi°î_moduÀ
(&
dm_disk
);

239 
nums
[
DMLAYOUT
] = 
	`Õ_ªgi°î_moduÀ
(&
dm_œyout_g1
);

240 
nums
[
DMMECH
] = 
	`Õ_ªgi°î_moduÀ
(&
dm_mech_g1
);

242 
	`Õ_öô_ty≥tbl
();

243 
	`Õ_lﬂdfûe
(
öputfûe
,

246 
ﬁd•ec
,

250 
	`Õ_ö°™tüã
(
¨gv
[2],árgv[2]);

253 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/utils/params/merge_blocks.c

2 
	~<lib∑øm/lib∑øm.h
>

3 
	~<°dio.h
>

4 
	~<°rög.h
>

7 
	~<moduÀs/moduÀs.h
>

8 
	~<diskmodñ/moduÀs/moduÀs.h
>

20 
Õ_block
 *

21 
	$do_sub°
(
Õ_block
 *
b
,

22 
Õ_block
 *
√wthög
,

23 *
de°∑th
,

24 *
§˝©h
)

26 
i
;

28 if(
§˝©h
) {

30 *
ª°
 = 
	`°rchr
(
§˝©h
, ':');

32 if(
ª°
) {

34 *
ª°
 = 0;

35 
ª°
++;

38 
i
 = 0; i < 
√wthög
->
∑øms_Àn
; i++) {

39 if(
√wthög
->
∑øms
[
i
]) {

40 if(!
	`°rcmp
(
§˝©h
, 
√wthög
->
∑øms
[
i
]->
«me
)) {

41  
	`do_sub°
(
b
, 
√wthög
->
∑øms
[
i
]->
v
->v.b, 
de°∑th
, 0);

45 
	`Ârötf
(
°dîr
, "***Érror: couldn't find %s in %s\n",

46 
§˝©h
,

47 
√wthög
->
«me
);

48 
	`exô
(1);

52 if(!
de°∑th
) {

53 
√wthög
->
«me
 = 0;

54  
√wthög
;

57 *
ª°
 = 
	`°rchr
(
de°∑th
, ':');

59 if(
ª°
) {

61 *
ª°
 = 0;

62 
ª°
++;

65 
i
 = 0; i < 
b
->
∑øms_Àn
; i++) {

66 if(
b
->
∑øms
[
i
]) {

67 if(!
	`°rcmp
(
de°∑th
, 
b
->
∑øms
[
i
]->
«me
)) {

68 
b
->
∑øms
[
i
]->
v
->
t
 = 
BLOCK
;

69 
b
->
∑øms
[
i
]->
v
->v.b = 
√wthög
;

70  
b
;

74 
	`Ârötf
(
°dîr
, "***Érror: couldn't find %s in %s\n",

75 
de°∑th
,

76 
b
->
«me
);

77 
	`exô
(1);

79 
	}
}

82 
	$maö
(
¨gc
, **
¨gv
)

84 
i
;

85 *
de°∑th
, *
§˝©h
;

86 
FILE
 *
öfûe
 = 0, *
√wblockfûe
 = 0, *
outfûe
 = 0;

88 
Õ_ét
 **
éts1
, **
éts2
;

89 
éts1_Àn
, 
éts2_Àn
;

90 
Õ_block
 *
ªsu…
;

92 if(
¨gc
 != 6) {

93 
	`Ârötf
(
°dîr
, "usage: merge_blocks <f1> <path> <f2> <path> <outfile>\n");

94 
	`exô
(1);

97 
i
 = 0; i <
DM_MAX_MODULE
; i++)

98 
	`Õ_ªgi°î_moduÀ
(
dm_mods
[
i
]);

100 
i
 = 0; i <
DISKSIM_MAX_MODULE
; i++)

101 
	`Õ_ªgi°î_moduÀ
(
disksim_mods
[
i
]);

103 
	`Õ_öô_ty≥tbl
();

105 
de°∑th
 = 
¨gv
[2];

106 
§˝©h
 = 
¨gv
[4];

108 
öfûe
 = 
	`f›í
(
¨gv
[1], "r");

109 
√wblockfûe
 = 
	`f›í
(
¨gv
[3], "r");

110 
outfûe
 = 
	`f›í
(
¨gv
[5], "w");

112 
	`Õ_lﬂdfûe
(
öfûe
, &
éts1
, &
éts1_Àn
, 
¨gv
[1], 0, 0);

113 
	`Õ_lﬂdfûe
(
√wblockfûe
, &
éts2
, &
éts2_Àn
, 
¨gv
[3], 0, 0);

116 
ªsu…
 = 
	`do_sub°
(
éts1
[0]->
ô
.
block
, 
éts2
[0]->it.block,

117 
de°∑th
, 
§˝©h
);

119 
	`u≈¨£_block
(
ªsu…
, 
outfûe
);

123 
	}
}

	@/Users/ysoh/disksim-4.0-fcl/w32build/deprecated/deprecated.c

1 
	~<°rög.h
>

2 
	~<°dio.h
>

3 
	~<°d¨g.h
>

5 
	#O_RDONLY
 
_O_RDONLY


	)

7 *
	$°rdup
(*
s
)

9  
	`_°rdup
(
s
);

10 
	}
}

12 
	$°rˇ£cmp
(*
s1
, *
s2
)

14  
	`_°ricmp
(
s1
, 
s2
);

15 
	}
}

17 
	$ªad
(
fd
, *
buf
, 
bufsiz
)

19  
	`_ªad
(
fd
, 
buf
, 
bufsiz
);

20 
	}
}

22 
	$wrôe
(
fd
, *
buf
, 
bufsiz
)

24  
	`_wrôe
(
fd
, 
buf
, 
bufsiz
);

25 
	}
}

27 
	$dup
(
fd
)

29  
	`_dup
(
fd
);

30 
	}
}

32 
	$dup2
(
fd1
, 
fd2
)

34  
	`_dup2
(
fd1
, 
fd2
);

35 
	}
}

37 
	$›í
(*
fûíame
, 
oÊag
)

39  
	`_›í
(
fûíame
, 
oÊag
);

40 
	}
}

42 
	$˛o£
(
fd
)

44  
	`_˛o£
(
fd
);

45 
	}
}

48 
	$bzîo
(*
±r
, 
size_t
 
size
)

50 
	`mem£t
(
±r
,0,
size
);

51 
	}
}

53 
	#max
(
x
, 
y
Ë(((xË> (y)Ë? (xË: (y))

	)

57 
	#œ°_£p
(
∑th
Ë
	`max
’©h, 1+max(
	`°ºchr
’©h, '\\'), sårchr’©h, '/')))

	)

61 *
	$dú«me
(*
∑th
)

63 *(
	`œ°_£p
(
∑th
)) = '\0';

64  
∑th
;

65 
	}
}

67 *
	$ba£«me
(*
∑th
)

69  
	`œ°_£p
(
∑th
);

70 
	}
}

72 
	$¢¥ötf
(*
°r
, 
n
, c⁄° *
f‹m©
, ...)

74 
va_li°
 
¨gs
;

75 
	`va_°¨t
(
¨gs
, 
f‹m©
);

76  
	`v¢¥ötf_s
(
°r
, 
n
, 
_TRUNCATE
, 
f‹m©
, 
¨gs
);

77 
	}
}

	@/usr/include/alloca.h

24 #i‚de‡
_ALLOCA_H_


25 
	#_ALLOCA_H_


	)

27 
	~<sys/cdefs.h
>

28 
	~<_ty≥s.h
>

30 #i‚def 
_SIZE_T


31 
	#_SIZE_T


	)

32 
__d¨wö_size_t
 
	tsize_t
;

35 
__BEGIN_DECLS


36 *
Æloˇ
(
size_t
);

37 
	g__END_DECLS


39 #i‡
deföed
(
__GNUC__
) && __GNUC__ >= 3

41 #unde‡
Æloˇ


42 #unde‡
__Æloˇ


43 
	#Æloˇ
(
size
Ë
	`__Æloˇ
(size)

	)

44 
	#__Æloˇ
(
size
Ë
	`__buûtö_Æloˇ
(size)

	)

	@/usr/include/assert.h

42 
	~<sys/cdefs.h
>

43 #ifde‡
__˝lu•lus


44 
	~<°dlib.h
>

52 #unde‡
as£π


53 #unde‡
__as£π


55 #ifde‡
NDEBUG


56 
	#as£π
(
e
Ë(()0)

	)

59 #i‚de‡
__GNUC__


61 
	g__BEGIN_DECLS


62 #i‚de‡
__˝lu•lus


63 
	$ab‹t
(Ë
__dód2
;

65 
	`¥ötf
(c⁄° * 
__ª°ri˘
, ...);

66 
__END_DECLS


68 
	#as£π
(
e
) \

69 ((Ë((
e
Ë? 0 : 
	`__as£π
 (#e, 
__FILE__
, 
__LINE__
)))

	)

70 
	#__as£π
(
e
, 
fûe
, 
löe
) \

71 (()
	`¥ötf
 ("%s:%u: faûedás£πi⁄ `%s'\n", 
fûe
, 
löe
, 
e
), 
	`ab‹t
())

	)

75 
__BEGIN_DECLS


76 
	$__as£π_πn
(c⁄° *, c⁄° *, , c⁄° *Ë
__dód2
;

77 #i‡
	`deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && ((__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__-0) < 1070)

78 
	$__ïrötf
(c⁄° *, c⁄° *, , c⁄° *Ë
__dód2
;

80 
__END_DECLS


82 #i‡
	`deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && ((__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__-0) < 1070)

83 
	#__as£π
(
e
, 
fûe
, 
löe
) \

84 
	`__ïrötf
 ("%s:%u: faûedás£πi⁄ `%s'\n", 
fûe
, 
löe
, 
e
)

	)

87 
	#__as£π
(
e
, 
fûe
, 
löe
) \

88 
	`__as£π_πn
 ((c⁄° *)-1L, 
fûe
, 
löe
, 
e
)

	)

91 #i‡
__DARWIN_UNIX03


92 
	#as£π
(
e
) \

93 (
	`__buûtö_ex≥˘
(!(
e
), 0Ë? 
	`__as£π_πn
(
__func__
, 
__FILE__
, 
__LINE__
, #eË: ()0)

	)

95 
	#as£π
(
e
) \

96 (
	`__buûtö_ex≥˘
(!(
e
), 0Ë? 
	`__as£π
 (#e, 
__FILE__
, 
__LINE__
Ë: ()0)

	)

	@/usr/include/cache.h

25 #i‚de‡
_CACHE_H_


26 
	#_CACHE_H_


	)

28 
	~<T¨gëC⁄dôi⁄Æs.h
>

29 
	~<°ddef.h
>

30 
	~<°döt.h
>

31 
	~<°dboﬁ.h
>

33 #i‡
TARGET_OS_WIN32


35 #i‚de‡
CACHE_PUBLIC_API


36 
	#CACHE_PUBLIC_API
 
	`__de˛•ec
–
dŒimp‹t
 )

	)

41 
	~<sys/cdefs.h
>

42 #i‚de‡
CACHE_PUBLIC_API


43 #ifde‡
__GNUC__


45 
	#CACHE_PUBLIC_API
 
	`__©åibuã__
((
	`__visibûôy__
("deÁu…")))

	)

48 #îr‹ 
__GNUC__
 
nŸ
 
deföed


49 
	#CACHE_PUBLIC_API


	)

55 #i‚de‡
__BEGIN_DECLS


56 
	#__BEGIN_DECLS
 "C" {

	)

58 #i‚de‡
__END_DECLS


59 
	#__END_DECLS
 }

	)

62 
__BEGIN_DECLS


73 
ˇche_s
 
	tˇche_t
;

84 
ˇche_©åibuãs_s
 
	tˇche_©åibuãs_t
;

97 
size_t
 
	tˇche_co°_t
;

120 
CACHE_PUBLIC_API
 
ˇche_¸óã
(c⁄° *
«me
, 
ˇche_©åibuãs_t
 *
©ås
, 
ˇche_t
 **
ˇche_out
);

156 
CACHE_PUBLIC_API
 
ˇche_£t_™d_ªèö
(
ˇche_t
 *
ˇche
, *
key
, *
vÆue
, 
ˇche_co°_t
 
co°
);

179 
CACHE_PUBLIC_API
 
ˇche_gë_™d_ªèö
(
ˇche_t
 *
ˇche
, *
key
, **
vÆue_out
);

199 
CACHE_PUBLIC_API
 
ˇche_ªÀa£_vÆue
(
ˇche_t
 *
ˇche
, *
vÆue
);

220 
CACHE_PUBLIC_API
 
ˇche_ªmove
(
ˇche_t
 *
ˇche
, *
key
);

233 
CACHE_PUBLIC_API
 
ˇche_ªmove_Æl
(
ˇche_t
 *
ˇche
);

252 
CACHE_PUBLIC_API
 
ˇche_de°roy
(
ˇche_t
 *
ˇche
);

274 
uöçå_t
 (*
	tˇche_key_hash_cb_t
)(*
	tkey
, *
	tu£r_d©a
);

298 
boﬁ
 (*
	tˇche_key_is_equÆ_cb_t
)(*
	tkey1
, *
	tkey2
, *
	tu£r_d©a
);

322 (*
ˇche_key_ªèö_cb_t
)(*
	tkey_ö
, **
	tkey_out
, *
	tu£r_d©a
);

341 (*
ˇche_vÆue_ªèö_cb_t
)(*
	tvÆue_ö
, *
	tu£r_d©a
);

361 (*
ˇche_ªÀa£_cb_t
)(*
	tkey_‹_vÆue
, *
	tu£r_d©a
);

379 
boﬁ
 (*
	tˇche_vÆue_make_n⁄purgóbÀ_cb_t
)(*
	tvÆue
, *
	tu£r_d©a
);

397 (*
ˇche_vÆue_make_purgóbÀ_cb_t
)(*
	tvÆue
, *
	tu£r_d©a
);

417 
CACHE_PUBLIC_API
 
	sˇche_©åibuãs_s
 {

418 
uöt32_t
 
vîsi⁄
;

419 
ˇche_key_hash_cb_t
 
key_hash_cb
;

420 
ˇche_key_is_equÆ_cb_t
 
key_is_equÆ_cb
;

422 
ˇche_key_ªèö_cb_t
 
key_ªèö_cb
;

423 
ˇche_ªÀa£_cb_t
 
key_ªÀa£_cb
;

424 
ˇche_ªÀa£_cb_t
 
vÆue_ªÀa£_cb
;

426 
ˇche_vÆue_make_n⁄purgóbÀ_cb_t
 
vÆue_make_n⁄purgóbÀ_cb
;

427 
ˇche_vÆue_make_purgóbÀ_cb_t
 
vÆue_make_purgóbÀ_cb
;

429 *
u£r_d©a
;

432 
ˇche_vÆue_ªèö_cb_t
 
vÆue_ªèö_cb
;

434 
	#CACHE_ATTRIBUTES_VERSION_1
 1

	)

435 
	#CACHE_ATTRIBUTES_VERSION_2
 2

	)

437 
__END_DECLS


	@/usr/include/ctype.h

66 #i‚def 
_CTYPE_H_


67 
	#_CTYPE_H_


	)

69 
	~<ru√ty≥.h
>

71 
	#_CTYPE_A
 0x00000100L

	)

72 
	#_CTYPE_C
 0x00000200L

	)

73 
	#_CTYPE_D
 0x00000400L

	)

74 
	#_CTYPE_G
 0x00000800L

	)

75 
	#_CTYPE_L
 0x00001000L

	)

76 
	#_CTYPE_P
 0x00002000L

	)

77 
	#_CTYPE_S
 0x00004000L

	)

78 
	#_CTYPE_U
 0x00008000L

	)

79 
	#_CTYPE_X
 0x00010000L

	)

80 
	#_CTYPE_B
 0x00020000L

	)

81 
	#_CTYPE_R
 0x00040000L

	)

82 
	#_CTYPE_I
 0x00080000L

	)

83 
	#_CTYPE_T
 0x00100000L

	)

84 
	#_CTYPE_Q
 0x00200000L

	)

85 
	#_CTYPE_SW0
 0x20000000L

	)

86 
	#_CTYPE_SW1
 0x40000000L

	)

87 
	#_CTYPE_SW2
 0x80000000L

	)

88 
	#_CTYPE_SW3
 0xc0000000L

	)

89 
	#_CTYPE_SWM
 0xe0000000L

	)

90 
	#_CTYPE_SWS
 30

	)

92 #ifde‡
_NONSTD_SOURCE


96 
	#_A
 
_CTYPE_A


	)

97 
	#_C
 
_CTYPE_C


	)

98 
	#_D
 
_CTYPE_D


	)

99 
	#_G
 
_CTYPE_G


	)

100 
	#_L
 
_CTYPE_L


	)

101 
	#_P
 
_CTYPE_P


	)

102 
	#_S
 
_CTYPE_S


	)

103 
	#_U
 
_CTYPE_U


	)

104 
	#_X
 
_CTYPE_X


	)

105 
	#_B
 
_CTYPE_B


	)

106 
	#_R
 
_CTYPE_R


	)

107 
	#_I
 
_CTYPE_I


	)

108 
	#_T
 
_CTYPE_T


	)

109 
	#_Q
 
_CTYPE_Q


	)

110 
	#_SW0
 
_CTYPE_SW0


	)

111 
	#_SW1
 
_CTYPE_SW1


	)

112 
	#_SW2
 
_CTYPE_SW2


	)

113 
	#_SW3
 
_CTYPE_SW3


	)

120 #ifde‡
_EXTERNALIZE_CTYPE_INLINES_


121 
	#_USE_CTYPE_INLINE_


	)

122 
	#__DARWIN_CTYPE_°©ic_ölöe


	)

124 
	#__DARWIN_CTYPE_°©ic_ölöe
 
__ölöe


	)

131 #ifde‡
_EXTERNALIZE_CTYPE_INLINES_TOP_


132 
	#_USE_CTYPE_INLINE_


	)

133 
	#__DARWIN_CTYPE_TOP_°©ic_ölöe


	)

135 
	#__DARWIN_CTYPE_TOP_°©ic_ölöe
 
__ölöe


	)

141 #i‡!
deföed
(
_DONT_USE_CTYPE_INLINE_
) && \

142 (
deföed
(
_USE_CTYPE_INLINE_
Ë|| deföed(
__GNUC__
Ë|| 
	$deföed
(
__˝lu•lus
))

145 
__BEGIN_DECLS


146 
	`___ru√ty≥
(
__d¨wö_˘_ru√_t
);

147 
__d¨wö_˘_ru√_t
 
	`___tﬁowî
(__darwin_ct_rune_t);

148 
__d¨wö_˘_ru√_t
 
	`___touµî
(__darwin_ct_rune_t);

149 
__END_DECLS


151 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

152 
	$ißscii
(
_c
)

154  ((
_c
 & ~0x7F) == 0);

155 
	}
}

157 #ifde‡
USE_ASCII


158 
__DARWIN_CTYPE_°©ic_ölöe
 

159 
	$__maskru√
(
__d¨wö_˘_ru√_t
 
_c
, 
_f
)

161  
_DeÁu…Ru√LoˇÀ
.
__ru√ty≥
[
_c
 & 0xff] & 
_f
;

162 
	}
}

164 
__BEGIN_DECLS


165 
__maskru√
(
__d¨wö_˘_ru√_t
, );

166 
	g__END_DECLS


169 
__DARWIN_CTYPE_°©ic_ölöe
 

170 
	$__i°y≥
(
__d¨wö_˘_ru√_t
 
_c
, 
_f
)

172 #ifde‡
USE_ASCII


173  !!(
	`__maskru√
(
_c
, 
_f
));

175  (
	`ißscii
(
_c
Ë? !!(
_DeÁu…Ru√LoˇÀ
.
__ru√ty≥
[_c] & 
_f
)

176 : !!
	`__maskru√
(
_c
, 
_f
));

178 
	}
}

180 
__DARWIN_CTYPE_°©ic_ölöe
 
__d¨wö_˘_ru√_t


181 
	$__is˘y≥
(
__d¨wö_˘_ru√_t
 
_c
, 
_f
)

183 #ifde‡
USE_ASCII


184  !!(
	`__maskru√
(
_c
, 
_f
));

186  (
_c
 < 0 || _¯>
_CACHED_RUNES
) ? 0 :

187 !!(
_DeÁu…Ru√LoˇÀ
.
__ru√ty≥
[
_c
] & 
_f
);

189 
	}
}

191 #ifde‡
USE_ASCII


192 
__DARWIN_CTYPE_°©ic_ölöe
 
__d¨wö_˘_ru√_t


193 
	$__touµî
(
__d¨wö_˘_ru√_t
 
_c
)

195  
_DeÁu…Ru√LoˇÀ
.
__m≠uµî
[
_c
 & 0xff];

196 
	}
}

198 
__DARWIN_CTYPE_°©ic_ölöe
 
__d¨wö_˘_ru√_t


199 
	$__tﬁowî
(
__d¨wö_˘_ru√_t
 
_c
)

201  
_DeÁu…Ru√LoˇÀ
.
__m≠lowî
[
_c
 & 0xff];

202 
	}
}

204 
__BEGIN_DECLS


205 
__d¨wö_˘_ru√_t
 
__touµî
(__darwin_ct_rune_t);

206 
__d¨wö_˘_ru√_t
 
__tﬁowî
(__darwin_ct_rune_t);

207 
	g__END_DECLS


210 
__DARWIN_CTYPE_°©ic_ölöe
 

211 
	$__wcwidth
(
__d¨wö_˘_ru√_t
 
_c
)

213 
_x
;

215 i‡(
_c
 == 0)

217 
_x
 = ()
	`__maskru√
(
_c
, 
_CTYPE_SWM
|
_CTYPE_R
);

218 i‡((
_x
 & 
_CTYPE_SWM
) != 0)

219  ((
_x
 & 
_CTYPE_SWM
Ë>> 
_CTYPE_SWS
);

220  ((
_x
 & 
_CTYPE_R
) != 0 ? 1 : -1);

221 
	}
}

223 #i‚de‡
_EXTERNALIZE_CTYPE_INLINES_


225 
	#_tﬁowî
(
c
Ë
	`__tﬁowî
(c)

	)

226 
	#_touµî
(
c
Ë
	`__touµî
(c)

	)

228 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

229 
	$iß um
(
_c
)

231  (
	`__i°y≥
(
_c
, 
_CTYPE_A
|
_CTYPE_D
));

232 
	}
}

234 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

235 
	$ißÕha
(
_c
)

237  (
	`__i°y≥
(
_c
, 
_CTYPE_A
));

238 
	}
}

240 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

241 
	$isbœnk
(
_c
)

243  (
	`__i°y≥
(
_c
, 
_CTYPE_B
));

244 
	}
}

246 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

247 
	$is˙ål
(
_c
)

249  (
	`__i°y≥
(
_c
, 
_CTYPE_C
));

250 
	}
}

253 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

254 
	$isdigô
(
_c
)

256  (
	`__is˘y≥
(
_c
, 
_CTYPE_D
));

257 
	}
}

259 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

260 
	$isgøph
(
_c
)

262  (
	`__i°y≥
(
_c
, 
_CTYPE_G
));

263 
	}
}

265 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

266 
	$i¶owî
(
_c
)

268  (
	`__i°y≥
(
_c
, 
_CTYPE_L
));

269 
	}
}

271 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

272 
	$i•röt
(
_c
)

274  (
	`__i°y≥
(
_c
, 
_CTYPE_R
));

275 
	}
}

277 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

278 
	$i•un˘
(
_c
)

280  (
	`__i°y≥
(
_c
, 
_CTYPE_P
));

281 
	}
}

283 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

284 
	$is•a˚
(
_c
)

286  (
	`__i°y≥
(
_c
, 
_CTYPE_S
));

287 
	}
}

289 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

290 
	$isuµî
(
_c
)

292  (
	`__i°y≥
(
_c
, 
_CTYPE_U
));

293 
	}
}

296 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

297 
	$isxdigô
(
_c
)

299  (
	`__is˘y≥
(
_c
, 
_CTYPE_X
));

300 
	}
}

302 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

303 
	$tﬂscii
(
_c
)

305  (
_c
 & 0x7F);

306 
	}
}

308 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

309 
	$tﬁowî
(
_c
)

311  (
	`__tﬁowî
(
_c
));

312 
	}
}

314 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

315 
	$touµî
(
_c
)

317  (
	`__touµî
(
_c
));

318 
	}
}

320 #i‡!
deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

321 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

322 
	$digôtoöt
(
_c
)

324  (
	`__maskru√
(
_c
, 0x0F));

325 
	}
}

327 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

328 
	$ishexnumbî
(
_c
)

330  (
	`__i°y≥
(
_c
, 
_CTYPE_X
));

331 
	}
}

333 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

334 
	$isideogøm
(
_c
)

336  (
	`__i°y≥
(
_c
, 
_CTYPE_I
));

337 
	}
}

339 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

340 
	$i¢umbî
(
_c
)

342  (
	`__i°y≥
(
_c
, 
_CTYPE_D
));

343 
	}
}

345 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

346 
	$i•h⁄ogøm
(
_c
)

348  (
	`__i°y≥
(
_c
, 
_CTYPE_Q
));

349 
	}
}

351 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

352 
	$i§u√
(
_c
)

354  (
	`__i°y≥
(
_c
, 0xFFFFFFF0L));

355 
	}
}

357 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

358 
	$is•ecül
(
_c
)

360  (
	`__i°y≥
(
_c
, 
_CTYPE_T
));

361 
	}
}

367 
__BEGIN_DECLS


368 
iß um
();

369 
ißÕha
();

370 
isbœnk
();

371 
is˙ål
();

372 
isdigô
();

373 
isgøph
();

374 
i¶owî
();

375 
i•röt
();

376 
i•un˘
();

377 
is•a˚
();

378 
isuµî
();

379 
isxdigô
();

380 
tﬁowî
();

381 
touµî
();

382 
ißscii
();

383 
tﬂscii
();

385 #i‡!
deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

386 
_tﬁowî
();

387 
_touµî
();

388 
digôtoöt
();

389 
ishexnumbî
();

390 
isideogøm
();

391 
i¢umbî
();

392 
i•h⁄ogøm
();

393 
i§u√
();

394 
is•ecül
();

396 
	g__END_DECLS


400 #ifde‡
_USE_EXTENDED_LOCALES_


401 
	~<xloˇÀ/_˘y≥.h
>

	@/usr/include/errno.h

23 
	~<sys/î∫o.h
>

	@/usr/include/fcntl.h

23 
	~<sys/f˙é.h
>

	@/usr/include/getopt.h

40 #i‚de‡
_GETOPT_H_


41 
	#_GETOPT_H_


	)

43 
	~<sys/cdefs.h
>

44 
	~<uni°d.h
>

50 
	#no_¨gumít
 0

	)

51 
	#ªquúed_¨gumít
 1

	)

52 
	#›ti⁄Æ_¨gumít
 2

	)

54 
	s›ti⁄
 {

56 c⁄° *
	m«me
;

61 
	mhas_¨g
;

63 *
	mÊag
;

65 
	mvÆ
;

68 
__BEGIN_DECLS


69 
gë›t_l⁄g
(, * const *, const *,

70 c⁄° 
›ti⁄
 *, *);

71 
gë›t_l⁄g_⁄ly
(, * const *, const *,

72 c⁄° 
›ti⁄
 *, *);

73 #i‚de‡
_GETOPT


74 
	#_GETOPT


	)

75 
	$gë›t
(, * c⁄° [], c⁄° *Ë
	`__DARWIN_ALIAS
(
gë›t
);

77 *
›èrg
;

78 
›töd
, 
›ãº
, 
›t›t
;

80 #i‚de‡
_OPTRESET


81 
	#_OPTRESET


	)

82 
›åe£t
;

84 
__END_DECLS


	@/usr/include/inttypes.h

31 #i‡!
deföed
(
_INTTYPES_H_
)

32 
	#_INTTYPES_H_


	)

34 #unde‡
__PRI_8_LENGTH_MODIFIER__


35 #unde‡
__PRI_64_LENGTH_MODIFIER__


36 #unde‡
__SCN_64_LENGTH_MODIFIER__


38 #i‡
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
-0 > 1020

39 
	#__PRI_8_LENGTH_MODIFIER__
 "hh"

	)

40 
	#__PRI_64_LENGTH_MODIFIER__
 "Œ"

	)

41 
	#__SCN_64_LENGTH_MODIFIER__
 "Œ"

	)

47 
	#__PRI_8_LENGTH_MODIFIER__
 ""

	)

48 
	#__PRI_64_LENGTH_MODIFIER__
 "q"

	)

49 
	#__SCN_64_LENGTH_MODIFIER__
 "q"

	)

51 
	#__PRI_MAX_LENGTH_MODIFIER__
 "j"

	)

52 
	#__SCN_MAX_LENGTH_MODIFIER__
 "j"

	)

54 
	#PRId8
 
__PRI_8_LENGTH_MODIFIER__
 "d"

	)

55 
	#PRIi8
 
__PRI_8_LENGTH_MODIFIER__
 "i"

	)

56 
	#PRIo8
 
__PRI_8_LENGTH_MODIFIER__
 "o"

	)

57 
	#PRIu8
 
__PRI_8_LENGTH_MODIFIER__
 "u"

	)

58 
	#PRIx8
 
__PRI_8_LENGTH_MODIFIER__
 "x"

	)

59 
	#PRIX8
 
__PRI_8_LENGTH_MODIFIER__
 "X"

	)

61 
	#PRId16
 "hd"

	)

62 
	#PRIi16
 "hi"

	)

63 
	#PRIo16
 "ho"

	)

64 
	#PRIu16
 "hu"

	)

65 
	#PRIx16
 "hx"

	)

66 
	#PRIX16
 "hX"

	)

68 
	#PRId32
 "d"

	)

69 
	#PRIi32
 "i"

	)

70 
	#PRIo32
 "o"

	)

71 
	#PRIu32
 "u"

	)

72 
	#PRIx32
 "x"

	)

73 
	#PRIX32
 "X"

	)

75 
	#PRId64
 
__PRI_64_LENGTH_MODIFIER__
 "d"

	)

76 
	#PRIi64
 
__PRI_64_LENGTH_MODIFIER__
 "i"

	)

77 
	#PRIo64
 
__PRI_64_LENGTH_MODIFIER__
 "o"

	)

78 
	#PRIu64
 
__PRI_64_LENGTH_MODIFIER__
 "u"

	)

79 
	#PRIx64
 
__PRI_64_LENGTH_MODIFIER__
 "x"

	)

80 
	#PRIX64
 
__PRI_64_LENGTH_MODIFIER__
 "X"

	)

82 
	#PRIdLEAST8
 
PRId8


	)

83 
	#PRIiLEAST8
 
PRIi8


	)

84 
	#PRIoLEAST8
 
PRIo8


	)

85 
	#PRIuLEAST8
 
PRIu8


	)

86 
	#PRIxLEAST8
 
PRIx8


	)

87 
	#PRIXLEAST8
 
PRIX8


	)

89 
	#PRIdLEAST16
 
PRId16


	)

90 
	#PRIiLEAST16
 
PRIi16


	)

91 
	#PRIoLEAST16
 
PRIo16


	)

92 
	#PRIuLEAST16
 
PRIu16


	)

93 
	#PRIxLEAST16
 
PRIx16


	)

94 
	#PRIXLEAST16
 
PRIX16


	)

96 
	#PRIdLEAST32
 
PRId32


	)

97 
	#PRIiLEAST32
 
PRIi32


	)

98 
	#PRIoLEAST32
 
PRIo32


	)

99 
	#PRIuLEAST32
 
PRIu32


	)

100 
	#PRIxLEAST32
 
PRIx32


	)

101 
	#PRIXLEAST32
 
PRIX32


	)

103 
	#PRIdLEAST64
 
PRId64


	)

104 
	#PRIiLEAST64
 
PRIi64


	)

105 
	#PRIoLEAST64
 
PRIo64


	)

106 
	#PRIuLEAST64
 
PRIu64


	)

107 
	#PRIxLEAST64
 
PRIx64


	)

108 
	#PRIXLEAST64
 
PRIX64


	)

110 
	#PRIdFAST8
 
PRId8


	)

111 
	#PRIiFAST8
 
PRIi8


	)

112 
	#PRIoFAST8
 
PRIo8


	)

113 
	#PRIuFAST8
 
PRIu8


	)

114 
	#PRIxFAST8
 
PRIx8


	)

115 
	#PRIXFAST8
 
PRIX8


	)

117 
	#PRIdFAST16
 
PRId16


	)

118 
	#PRIiFAST16
 
PRIi16


	)

119 
	#PRIoFAST16
 
PRIo16


	)

120 
	#PRIuFAST16
 
PRIu16


	)

121 
	#PRIxFAST16
 
PRIx16


	)

122 
	#PRIXFAST16
 
PRIX16


	)

124 
	#PRIdFAST32
 
PRId32


	)

125 
	#PRIiFAST32
 
PRIi32


	)

126 
	#PRIoFAST32
 
PRIo32


	)

127 
	#PRIuFAST32
 
PRIu32


	)

128 
	#PRIxFAST32
 
PRIx32


	)

129 
	#PRIXFAST32
 
PRIX32


	)

131 
	#PRIdFAST64
 
PRId64


	)

132 
	#PRIiFAST64
 
PRIi64


	)

133 
	#PRIoFAST64
 
PRIo64


	)

134 
	#PRIuFAST64
 
PRIu64


	)

135 
	#PRIxFAST64
 
PRIx64


	)

136 
	#PRIXFAST64
 
PRIX64


	)

139 
	#PRIdPTR
 "ld"

	)

140 
	#PRIiPTR
 "li"

	)

141 
	#PRIoPTR
 "lo"

	)

142 
	#PRIuPTR
 "lu"

	)

143 
	#PRIxPTR
 "lx"

	)

144 
	#PRIXPTR
 "lX"

	)

146 
	#PRIdMAX
 
__PRI_MAX_LENGTH_MODIFIER__
 "d"

	)

147 
	#PRIiMAX
 
__PRI_MAX_LENGTH_MODIFIER__
 "i"

	)

148 
	#PRIoMAX
 
__PRI_MAX_LENGTH_MODIFIER__
 "o"

	)

149 
	#PRIuMAX
 
__PRI_MAX_LENGTH_MODIFIER__
 "u"

	)

150 
	#PRIxMAX
 
__PRI_MAX_LENGTH_MODIFIER__
 "x"

	)

151 
	#PRIXMAX
 
__PRI_MAX_LENGTH_MODIFIER__
 "X"

	)

153 #i‡
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
-0 > 1020

154 
	#SCNd8
 
__PRI_8_LENGTH_MODIFIER__
 "d"

	)

155 
	#SCNi8
 
__PRI_8_LENGTH_MODIFIER__
 "i"

	)

156 
	#SCNo8
 
__PRI_8_LENGTH_MODIFIER__
 "o"

	)

157 
	#SCNu8
 
__PRI_8_LENGTH_MODIFIER__
 "u"

	)

158 
	#SCNx8
 
__PRI_8_LENGTH_MODIFIER__
 "x"

	)

160 
	#SCNd8
 "hhd"

	)

161 
	#SCNi8
 "hhi"

	)

162 
	#SCNo8
 "hho"

	)

163 
	#SCNu8
 "hhu"

	)

164 
	#SCNx8
 "hhx"

	)

167 
	#SCNd16
 "hd"

	)

168 
	#SCNi16
 "hi"

	)

169 
	#SCNo16
 "ho"

	)

170 
	#SCNu16
 "hu"

	)

171 
	#SCNx16
 "hx"

	)

173 
	#SCNd32
 "d"

	)

174 
	#SCNi32
 "i"

	)

175 
	#SCNo32
 "o"

	)

176 
	#SCNu32
 "u"

	)

177 
	#SCNx32
 "x"

	)

179 
	#SCNd64
 
__SCN_64_LENGTH_MODIFIER__
 "d"

	)

180 
	#SCNi64
 
__SCN_64_LENGTH_MODIFIER__
 "i"

	)

181 
	#SCNo64
 
__SCN_64_LENGTH_MODIFIER__
 "o"

	)

182 
	#SCNu64
 
__SCN_64_LENGTH_MODIFIER__
 "u"

	)

183 
	#SCNx64
 
__SCN_64_LENGTH_MODIFIER__
 "x"

	)

185 
	#SCNdLEAST8
 
SCNd8


	)

186 
	#SCNiLEAST8
 
SCNi8


	)

187 
	#SCNoLEAST8
 
SCNo8


	)

188 
	#SCNuLEAST8
 
SCNu8


	)

189 
	#SCNxLEAST8
 
SCNx8


	)

191 
	#SCNdLEAST16
 
SCNd16


	)

192 
	#SCNiLEAST16
 
SCNi16


	)

193 
	#SCNoLEAST16
 
SCNo16


	)

194 
	#SCNuLEAST16
 
SCNu16


	)

195 
	#SCNxLEAST16
 
SCNx16


	)

197 
	#SCNdLEAST32
 
SCNd32


	)

198 
	#SCNiLEAST32
 
SCNi32


	)

199 
	#SCNoLEAST32
 
SCNo32


	)

200 
	#SCNuLEAST32
 
SCNu32


	)

201 
	#SCNxLEAST32
 
SCNx32


	)

203 
	#SCNdLEAST64
 
SCNd64


	)

204 
	#SCNiLEAST64
 
SCNi64


	)

205 
	#SCNoLEAST64
 
SCNo64


	)

206 
	#SCNuLEAST64
 
SCNu64


	)

207 
	#SCNxLEAST64
 
SCNx64


	)

209 
	#SCNdFAST8
 
SCNd8


	)

210 
	#SCNiFAST8
 
SCNi8


	)

211 
	#SCNoFAST8
 
SCNo8


	)

212 
	#SCNuFAST8
 
SCNu8


	)

213 
	#SCNxFAST8
 
SCNx8


	)

215 
	#SCNdFAST16
 
SCNd16


	)

216 
	#SCNiFAST16
 
SCNi16


	)

217 
	#SCNoFAST16
 
SCNo16


	)

218 
	#SCNuFAST16
 
SCNu16


	)

219 
	#SCNxFAST16
 
SCNx16


	)

221 
	#SCNdFAST32
 
SCNd32


	)

222 
	#SCNiFAST32
 
SCNi32


	)

223 
	#SCNoFAST32
 
SCNo32


	)

224 
	#SCNuFAST32
 
SCNu32


	)

225 
	#SCNxFAST32
 
SCNx32


	)

227 
	#SCNdFAST64
 
SCNd64


	)

228 
	#SCNiFAST64
 
SCNi64


	)

229 
	#SCNoFAST64
 
SCNo64


	)

230 
	#SCNuFAST64
 
SCNu64


	)

231 
	#SCNxFAST64
 
SCNx64


	)

233 
	#SCNdPTR
 "ld"

	)

234 
	#SCNiPTR
 "li"

	)

235 
	#SCNoPTR
 "lo"

	)

236 
	#SCNuPTR
 "lu"

	)

237 
	#SCNxPTR
 "lx"

	)

239 
	#SCNdMAX
 
__SCN_MAX_LENGTH_MODIFIER__
 "d"

	)

240 
	#SCNiMAX
 
__SCN_MAX_LENGTH_MODIFIER__
 "i"

	)

241 
	#SCNoMAX
 
__SCN_MAX_LENGTH_MODIFIER__
 "o"

	)

242 
	#SCNuMAX
 
__SCN_MAX_LENGTH_MODIFIER__
 "u"

	)

243 
	#SCNxMAX
 
__SCN_MAX_LENGTH_MODIFIER__
 "x"

	)

245 
	~<sys/cdefs.h
>

246 
	~<_ty≥s.h
>

247 
	~<°döt.h
>

249 #i‡!
deföed
(
__STDC_VERSION__
) || (__STDC_VERSION__ < 199901L)

251 #i‡!
deföed
(
ª°ri˘
)

252 
	#ª°ri˘


	)

253 
	#__RESTRICT_KEYWORD_DEFINED__


	)

257 
__BEGIN_DECLS


260 
ötmax_t
 
imaxabs
(ötmax_à
j
);

264 
ötmax_t
 
	mquŸ
;

265 
ötmax_t
 
	mªm
;

266 } 
	timaxdiv_t
;

268 
imaxdiv_t
 
imaxdiv
(
ötmax_t
 
numî
, i¡max_à
díom
);

271 
ötmax_t
 
°πoimax
(c⁄° * 
ª°ri˘
 
≈å
, **Ñe°ri˘ 
íd±r
, 
ba£
);

272 
uötmax_t
 
°πoumax
(c⁄° * 
ª°ri˘
 
≈å
, **Ñe°ri˘ 
íd±r
, 
ba£
);

274 #i‚de‡
__˝lu•lus


275 #i‚def 
_WCHAR_T


276 
	#_WCHAR_T


	)

277 
__d¨wö_wch¨_t
 
	twch¨_t
;

282 
ötmax_t
 
wc°oimax
(c⁄° 
wch¨_t
 * 
ª°ri˘
 
≈å
, wch¨_à**Ñe°ri˘ 
íd±r
, 
ba£
);

283 
uötmax_t
 
wc°oumax
(c⁄° 
wch¨_t
 * 
ª°ri˘
 
≈å
, wch¨_à**Ñe°ri˘ 
íd±r
, 
ba£
);

286 #i‡!
deföed
(
__˝lu•lus
Ë&& deföed(
__WCHAR_MAX__
) && __WCHAR_MAX__ <= 0xffffU

287 #¥agm®
GCC
 
pois⁄
 
wc°oimax
 
wc°oumax


290 
	g__END_DECLS


292 #ifde‡
_USE_EXTENDED_LOCALES_


293 
	~<xloˇÀ/_öây≥s.h
>

308 #i‡
deföed
(
__RESTRICT_KEYWORD_DEFINED__
)

309 #unde‡
ª°ri˘


310 #unde‡
__RESTRICT_KEYWORD_DEFINED__


	@/usr/include/libgen.h

31 #i‚de‡
_LIBGEN_H_


32 
	#_LIBGEN_H_


	)

34 
	~<sys/cdefs.h
>

36 
	g__BEGIN_DECLS


38 #i‡
__DARWIN_UNIX03


40 *
ba£«me
(*);

41 *
dú«me
(*);

45 *
ba£«me
(const *);

46 *
dú«me
(const *);

50 
	g__END_DECLS


	@/usr/include/math.h

22 #i‚de‡
__MATH_H__


23 
	#__MATH_H__


	)

25 #i‡(
deföed
(
__µc__
Ë|| deföed(
__µc64__
))

26 
	~"¨chôe˘uª/µc/m©h.h
"

27 #ñi‡(
deföed
 (
__i386__
Ë|| deföed–
__x86_64__
 ))

28 
	~"¨chôe˘uª/i386/m©h.h
"

29 #ñi‡
deföed
(
__¨m__
)

30 
	~"¨chôe˘uª/¨m/m©h.h
"

32 #îr‹ 
Unknown
 
¨chôe˘uª


	@/usr/include/signal.h

58 #i‚de‡
_USER_SIGNAL_H


59 
	#_USER_SIGNAL_H


	)

61 
	~<sys/cdefs.h
>

62 
	~<_ty≥s.h
>

63 
	~<sys/sig«l.h
>

65 #i‚de‡
_PTHREAD_T


66 
__d¨wö_±hªad_t
 
	t±hªad_t
;

67 
	#_PTHREAD_T


	)

70 #i‡!
deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

71 
__c⁄°
 *__c⁄° 
sys_sig«me
[
NSIG
];

72 
__c⁄°
 *__c⁄° 
sys_sigli°
[
NSIG
];

75 
__BEGIN_DECLS


76 
øi£
();

77 
	g__END_DECLS


79 #i‚def 
_ANSI_SOURCE


80 
__BEGIN_DECLS


81 (*
bsd_sig«l
(, (*)()))();

82 
	$kûl
(
pid_t
, Ë
	`__DARWIN_ALIAS
(
kûl
);

83 
	$kûÕg
(
pid_t
, Ë
	`__DARWIN_ALIAS
(
kûÕg
);

84 
	`±hªad_kûl
(
±hªad_t
, );

85 
	$±hªad_sigmask
(, c⁄° 
sig£t_t
 *, sig£t_à*Ë
	`__DARWIN_ALIAS
(
±hªad_sigmask
);

86 
	`siga˘i⁄
(, c⁄° 
siga˘i⁄
 * 
__ª°ri˘
,

87 
siga˘i⁄
 * 
__ª°ri˘
);

88 
	`sigadd£t
(
sig£t_t
 *, );

89 
	$sigÆt°ack
(c⁄° 
°ack_t
 * 
__ª°ri˘
, sèck_à* __ª°ri˘Ë
	`__DARWIN_ALIAS
(
sigÆt°ack
);

90 
	`sigdñ£t
(
sig£t_t
 *, );

91 
	`sigem±y£t
(
sig£t_t
 *);

92 
	`sigfûl£t
(
sig£t_t
 *);

93 
	`sighﬁd
();

94 
	`sigign‹e
();

95 
	`sigöãºu±
(, );

96 
	`sigismembî
(c⁄° 
sig£t_t
 *, );

97 
	$sig∑u£
(Ë
	`__DARWIN_ALIAS_C
(
sig∑u£
);

98 
	`sig≥ndög
(
sig£t_t
 *);

99 
	`sig¥ocmask
(, c⁄° 
sig£t_t
 * 
__ª°ri˘
, sigset_t * __restrict);

100 
	`sigªl£
();

101 (*
	`sig£t
(, (*)()))();

102 
	$sigsu•íd
(c⁄° 
sig£t_t
 *Ë
	`__DARWIN_ALIAS_C
(
sigsu•íd
);

103 
	$sigwaô
(c⁄° 
sig£t_t
 * 
__ª°ri˘
, * __ª°ri˘Ë
	`__DARWIN_ALIAS_C
(
sigwaô
);

104 #i‡!
	`deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

105 
	`psig«l
(, const *);

106 
	`sigblock
();

107 
	`sig£tmask
();

108 
	`sigvec
(, 
sigvec
 *, sigvec *);

110 
__END_DECLS


113 #i‡
	`deföed
(
__i386__
Ë|| deföed(
__x86_64__
)

115 
__ölöe
 

116 
	$__sigbôs
(
__signo
)

118  
__signo
 > 
__DARWIN_NSIG
 ? 0 : (1 << (__signo - 1));

119 
	}
}

121 
	#__sigbôs
(
signo
Ë(1 << ((signoË- 1))

	)

124 
	#sigadd£t
(
£t
, 
signo
Ë(*(£tË|
	`__sigbôs
(signo), 0)

	)

125 
	#sigdñ£t
(
£t
, 
signo
Ë(*(£tË&~
	`__sigbôs
(signo), 0)

	)

126 
	#sigismembî
(
£t
, 
signo
Ë((*(£tË& 
	`__sigbôs
(signo)Ë!0)

	)

127 
	#sigem±y£t
(
£t
Ë(*(£tË0, 0)

	)

128 
	#sigfûl£t
(
£t
Ë(*(£tË~(
sig£t_t
)0, 0)

	)

	@/usr/include/stddef.h

61 #i‡!
deföed
(
__STDDEF_H__
)

63 #i‡!
deföed
(
__√ed_wch¨_t
Ë&& !deföed(
__√ed_size_t
) \

64 && !
deföed
(
__√ed_±rdiff_t
Ë&& !deföed(
__√ed_NULL
) \

65 && !
	$deföed
(
__√ed_wöt_t
)

66 
	#__STDDEF_H__


	)

69 
	~<_ty≥s.h
>

71 #i‡
	`deföed
(
__STDDEF_H__
Ë|| deföed(
__√ed_±rdiff_t
)

72 #i‚de‡
_PTRDIFF_T


73 
	#_PTRDIFF_T


	)

74 
__d¨wö_±rdiff_t
 
	t±rdiff_t
;

78 #i‡
	`deföed
(
__STDDEF_H__
Ë|| deföed(
__√ed_size_t
)

79 #i‚def 
_SIZE_T


80 
	#_SIZE_T


	)

83 
__d¨wö_size_t
 
	tsize_t
;

87 #i‡
	`deföed
(
__STDDEF_H__
Ë|| deföed(
__√ed_wch¨_t
)

88 #i‚def 
__˝lu•lus


89 #i‚def 
_WCHAR_T


90 
	#_WCHAR_T


	)

91 
__d¨wö_wch¨_t
 
	twch¨_t
;

96 #i‡(
	`deföed
(
__STDDEF_H__
Ë&& !deföed(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))) \

97 || 
	$deföed
(
__√ed_wöt_t
)

98 #i‚def 
_WINT_T


99 
	#_WINT_T


	)

100 
__d¨wö_wöt_t
 
	twöt_t
;

104 #i‡
	`deföed
(
__STDDEF_H__
Ë|| deföed(
__√ed_NULL
)

105 #i‚de‡
NULL


106 
	#NULL
 
__DARWIN_NULL


	)

110 #ifde‡
__STDDEF_H__


111 #i‡
	`deföed
(
__GNUC__
Ë&& (__GNUC__ =3 && 
__GNUC_MINOR__
 >= 5 || __GNUC__ > 3)

112 #i‚de‡
__off£tof


113 
	#__off£tof
(
ty≥
, 
fõld
Ë
	`__buûtö_off£tof
—y≥, fõld)

	)

115 
	#off£tof
(
ty≥
, 
fõld
Ë
	`__buûtö_off£tof
—y≥, fõld)

	)

117 #i‚de‡
__off£tof


118 
	#__off£tof
(
ty≥
, 
fõld
Ë((
size_t
)(&(—y≥ *)0)->fõld))

	)

120 
	#off£tof
(
ty≥
, 
fõld
Ë((
size_t
)(&(—y≥ *)0)->fõld))

	)

126 #unde‡
__√ed_±rdiff_t


127 #unde‡
__√ed_size_t


128 #unde‡
__√ed_wch¨_t


129 #unde‡
__√ed_wöt_t


130 #unde‡
__√ed_NULL


	@/usr/include/stdio.h

61 #i‚def 
_STDIO_H_


62 
	#_STDIO_H_


	)

64 
	~<sys/cdefs.h
>

65 
	~<Avaûabûôy.h
>

67 
	~<_ty≥s.h
>

69 #i‚de‡
_VA_LIST


70 
	#_VA_LIST


	)

73 
__d¨wö_va_li°
 
	tva_li°
;

76 #i‚def 
_SIZE_T


77 
	#_SIZE_T


	)

78 
__d¨wö_size_t
 
	tsize_t
;

81 #i‚de‡
NULL


82 
	#NULL
 
__DARWIN_NULL


	)

85 
__d¨wö_off_t
 
	tÂos_t
;

87 
	#_FSTDIO


	)

96 
	s__sbuf
 {

97 *
	m_ba£
;

98 
	m_size
;

102 
	g__sFILEX
;

130 
	s__sFILE
 {

131 *
	m_p
;

132 
	m_r
;

133 
	m_w
;

134 
	m_Êags
;

135 
	m_fûe
;

136 
__sbuf
 
	m_bf
;

137 
	m_lbfsize
;

140 *
	m_cookõ
;

141 (*
	m_˛o£
)(*);

142 (*
	m_ªad
) (*, *, );

143 
Âos_t
 (*
_£ek
Ë(*, 
	mÂos_t
, );

144 (*
	m_wrôe
)(*, const *, );

147 
__sbuf
 
	m_ub
;

148 
__sFILEX
 *
	m_exåa
;

149 
	m_ur
;

152 
	m_ubuf
[3];

153 
	m_nbuf
[1];

156 
__sbuf
 
	m_lb
;

159 
	m_blksize
;

160 
Âos_t
 
	m_off£t
;

161 } 
	tFILE
;

163 
__BEGIN_DECLS


164 
FILE
 *
__°döp
;

165 
FILE
 *
__°douç
;

166 
FILE
 *
__°dîΩ
;

167 
	g__END_DECLS


169 
	#__SLBF
 0x0001

	)

170 
	#__SNBF
 0x0002

	)

171 
	#__SRD
 0x0004

	)

172 
	#__SWR
 0x0008

	)

174 
	#__SRW
 0x0010

	)

175 
	#__SEOF
 0x0020

	)

176 
	#__SERR
 0x0040

	)

177 
	#__SMBF
 0x0080

	)

178 
	#__SAPP
 0x0100

	)

179 
	#__SSTR
 0x0200

	)

180 
	#__SOPT
 0x0400

	)

181 
	#__SNPT
 0x0800

	)

182 
	#__SOFF
 0x1000

	)

183 
	#__SMOD
 0x2000

	)

184 
	#__SALC
 0x4000

	)

185 
	#__SIGN
 0x8000

	)

196 
	#_IOFBF
 0

	)

197 
	#_IOLBF
 1

	)

198 
	#_IONBF
 2

	)

200 
	#BUFSIZ
 1024

	)

201 
	#EOF
 (-1)

	)

204 
	#FOPEN_MAX
 20

	)

205 
	#FILENAME_MAX
 1024

	)

208 #i‚de‡
_ANSI_SOURCE


209 
	#P_tmpdú
 "/v¨/tmp/"

	)

211 
	#L_tm≤am
 1024

	)

212 
	#TMP_MAX
 308915776

	)

214 #i‚de‡
SEEK_SET


215 
	#SEEK_SET
 0

	)

217 #i‚de‡
SEEK_CUR


218 
	#SEEK_CUR
 1

	)

220 #i‚de‡
SEEK_END


221 
	#SEEK_END
 2

	)

224 
	#°dö
 
__°döp


	)

225 
	#°dout
 
__°douç


	)

226 
	#°dîr
 
__°dîΩ


	)

228 #ifde‡
_DARWIN_UNLIMITED_STREAMS


229 #i‡
deföed
(
__IPHONE_OS_VERSION_MIN_REQUIRED
Ë&& __IPHONE_OS_VERSION_MIN_REQUIRED < 
__IPHONE_3_2


231 #ñi‡
deföed
(
__MAC_OS_X_VERSION_MIN_REQUIRED
Ë&& __MAC_OS_X_VERSION_MIN_REQUIRED < 
__MAC_10_6


238 
__BEGIN_DECLS


239 
˛óªº
(
FILE
 *);

240 
f˛o£
(
FILE
 *);

241 
„of
(
FILE
 *);

242 
„º‹
(
FILE
 *);

243 
fÊush
(
FILE
 *);

244 
fgëc
(
FILE
 *);

245 
fgëpos
(
FILE
 * 
__ª°ri˘
, 
Âos_t
 *);

246 *
fgës
(* 
__ª°ri˘
, , 
FILE
 *);

247 #i‡
deföed
(
_DARWIN_UNLIMITED_STREAMS
Ë|| deföed(
_DARWIN_C_SOURCE
)

248 
FILE
 *
	$f›í
(c⁄° * 
__ª°ri˘
, c⁄° * __ª°ri˘Ë
	`__DARWIN_ALIAS_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
, 
	`__DARWIN_EXTSN
(
f›í
));

250 
FILE
 *
	$f›í
(c⁄° * 
__ª°ri˘
, c⁄° * __ª°ri˘Ë
	`__DARWIN_ALIAS_STARTING
(
__MAC_10_6
, 
__IPHONE_2_0
, 
	`__DARWIN_ALIAS
(
f›í
));

252 
	$Ârötf
(
FILE
 * 
__ª°ri˘
, c⁄° * __ª°ri˘, ...Ë
	$__DARWIN_LDBL_COMPAT
(
Ârötf
Ë
	`__¥ötÊike
(2, 3);

253 
	`Âutc
(, 
FILE
 *);

254 
	$Âuts
(c⁄° * 
__ª°ri˘
, 
FILE
 * __ª°ri˘Ë
	`__DARWIN_ALIAS
(
Âuts
);

255 
size_t
 
	`‰ód
(* 
__ª°ri˘
, size_t, size_t, 
FILE
 * __restrict);

256 
FILE
 *
	$‰e›í
(c⁄° * 
__ª°ri˘
, const * __restrict,

257 
FILE
 * 
__ª°ri˘
Ë
	`__DARWIN_ALIAS
(
‰e›í
);

258 
	$fsˇnf
(
FILE
 * 
__ª°ri˘
, c⁄° * __ª°ri˘, ...Ë
	$__DARWIN_LDBL_COMPAT
(
fsˇnf
Ë
	`__sˇnÊike
(2, 3);

259 
	`f£ek
(
FILE
 *, , );

260 
	`f£ços
(
FILE
 *, c⁄° 
Âos_t
 *);

261 
	`·ñl
(
FILE
 *);

262 
size_t
 
	$fwrôe
(c⁄° * 
__ª°ri˘
, 
size_t
, size_t, 
FILE
 * __ª°ri˘Ë
	`__DARWIN_ALIAS
(
fwrôe
);

263 
	`gëc
(
FILE
 *);

264 
	`gëch¨
();

265 *
	`gës
(*);

266 
	`≥º‹
(const *);

267 
	$¥ötf
(c⁄° * 
__ª°ri˘
, ...Ë
	$__DARWIN_LDBL_COMPAT
(
¥ötf
Ë
	`__¥ötÊike
(1, 2);

268 
	`putc
(, 
FILE
 *);

269 
	`putch¨
();

270 
	`puts
(const *);

271 
	`ªmove
(const *);

272 
	`ª«me
 (const *, const *);

273 
	`ªwöd
(
FILE
 *);

274 
	$sˇnf
(c⁄° * 
__ª°ri˘
, ...Ë
	$__DARWIN_LDBL_COMPAT
(
sˇnf
Ë
	`__sˇnÊike
(1, 2);

275 
	`£tbuf
(
FILE
 * 
__ª°ri˘
, * __restrict);

276 
	`£tvbuf
(
FILE
 * 
__ª°ri˘
, * __ª°ri˘, , 
size_t
);

277 
	$•rötf
(* 
__ª°ri˘
, c⁄° * __ª°ri˘, ...Ë
	$__DARWIN_LDBL_COMPAT
(
•rötf
Ë
	`__¥ötÊike
(2, 3);

278 
	$ssˇnf
(c⁄° * 
__ª°ri˘
, c⁄° * __ª°ri˘, ...Ë
	$__DARWIN_LDBL_COMPAT
(
ssˇnf
Ë
	`__sˇnÊike
(2, 3);

279 
FILE
 *
	`tmpfûe
();

280 *
	`tm≤am
(*);

281 
	`ungëc
(, 
FILE
 *);

282 
	$vÂrötf
(
FILE
 * 
__ª°ri˘
, c⁄° * __ª°ri˘, 
va_li°
Ë
	$__DARWIN_LDBL_COMPAT
(
vÂrötf
Ë
	`__¥ötÊike
(2, 0);

283 
	$v¥ötf
(c⁄° * 
__ª°ri˘
, 
va_li°
Ë
	$__DARWIN_LDBL_COMPAT
(
v¥ötf
Ë
	`__¥ötÊike
(1, 0);

284 
	$v•rötf
(* 
__ª°ri˘
, c⁄° * __ª°ri˘, 
va_li°
Ë
	$__DARWIN_LDBL_COMPAT
(
v•rötf
Ë
	`__¥ötÊike
(2, 0);

285 
__END_DECLS


293 #i‡
__DARWIN_C_LEVEL
 >= 198808L

294 
	#L_˘îmid
 1024

	)

296 
__BEGIN_DECLS


297 #i‚de‡
__CTERMID_DEFINED


299 
	#__CTERMID_DEFINED
 1

	)

300 *
	`˘îmid
(*);

303 #i‡
	`deföed
(
_DARWIN_UNLIMITED_STREAMS
Ë|| deföed(
_DARWIN_C_SOURCE
)

304 
FILE
 *
	$fd›í
(, c⁄° *Ë
	`__DARWIN_ALIAS_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
, 
	`__DARWIN_EXTSN
(
fd›í
));

306 
FILE
 *
	$fd›í
(, c⁄° *Ë
	`__DARWIN_ALIAS_STARTING
(
__MAC_10_6
, 
__IPHONE_2_0
, 
	`__DARWIN_ALIAS
(
fd›í
));

308 
	`fûío
(
FILE
 *);

309 
__END_DECLS


317 #i‡
__DARWIN_C_LEVEL
 >= 199209L

318 
__BEGIN_DECLS


319 
	`p˛o£
(
FILE
 *);

320 #i‡
	`deföed
(
_DARWIN_UNLIMITED_STREAMS
Ë|| deföed(
_DARWIN_C_SOURCE
)

321 
FILE
 *
	$p›í
(c⁄° *, c⁄° *Ë
	`__DARWIN_ALIAS_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
, 
	`__DARWIN_EXTSN
(
p›í
));

323 
FILE
 *
	$p›í
(c⁄° *, c⁄° *Ë
	`__DARWIN_ALIAS_STARTING
(
__MAC_10_6
, 
__IPHONE_2_0
, 
	`__DARWIN_ALIAS
(
p›í
));

325 
__END_DECLS


337 #i‡
__DARWIN_C_LEVEL
 >= 199506L

340 
__BEGIN_DECLS


341 
	`__§gë
(
FILE
 *);

342 
	$__svfsˇnf
(
FILE
 *, c⁄° *, 
va_li°
Ë
	$__DARWIN_LDBL_COMPAT
(
__svfsˇnf
Ë
	`__sˇnÊike
(2, 0);

343 
	`__swbuf
(, 
FILE
 *);

344 
__END_DECLS


350 
	#__sgëc
(
p
Ë(--’)->
_r
 < 0 ? 
	`__§gë
’Ë: ()(*’)->
_p
++))

	)

351 #i‡
	`deföed
(
__GNUC__
Ë&& deföed(
__STDC__
)

352 
__ölöe
 
	$__•utc
(
_c
, 
FILE
 *
_p
) {

353 i‡(--
_p
->
_w
 >0 || (_p->_w >_p->
_lbfsize
 && ()
_c
 != '\n'))

354  (*
_p
->_p++ = 
_c
);

356  (
	`__swbuf
(
_c
, 
_p
));

357 
	}
}

362 
	#__•utc
(
c
, 
p
) \

363 (--(
p
)->
_w
 < 0 ? \

364 (
p
)->
_w
 >’)->
_lbfsize
 ? \

365 (*(
p
)->
_p
 = (
c
)), *(p)->_p != '\n' ? \

366 ()*(
p
)->
_p
++ : \

367 
	`__swbuf
('\n', 
p
) : \

368 
	`__swbuf
(()(
c
), 
p
) : \

369 (*(
p
)->
_p
 = (
c
), ()*’)->_p++))

	)

372 
	#__s„of
(
p
Ë((’)->
_Êags
 & 
__SEOF
Ë!0)

	)

373 
	#__s„º‹
(
p
Ë((’)->
_Êags
 & 
__SERR
Ë!0)

	)

374 
	#__s˛óªº
(
p
Ë(()(’)->
_Êags
 &~(
__SERR
|
__SEOF
)))

	)

375 
	#__sfûío
(
p
Ë(’)->
_fûe
)

	)

377 
__BEGIN_DECLS


378 
Êockfûe
(
FILE
 *);

379 
·rylockfûe
(
FILE
 *);

380 
fu∆ockfûe
(
FILE
 *);

381 
gëc_u∆ocked
(
FILE
 *);

382 
gëch¨_u∆ocked
();

383 
putc_u∆ocked
(, 
FILE
 *);

384 
putch¨_u∆ocked
();

387 #i‡!
deföed
(
_POSIX_C_SOURCE
) || _POSIX_C_SOURCE < 200112L

388 
gëw
(
FILE
 *);

389 
putw
(, 
FILE
 *);

392 *
	$ãm≤am
(c⁄° *, c⁄° *Ë
	`__DARWIN_ALIAS
(
ãm≤am
);

393 
__END_DECLS


395 #i‚de‡
löt


396 
	#gëc_u∆ocked
(
Â
Ë
	`__sgëc
(Â)

	)

397 
	#putc_u∆ocked
(
x
, 
Â
Ë
	`__•utc
(x, fp)

	)

400 
	#gëch¨_u∆ocked
(Ë
	`gëc_u∆ocked
(
°dö
)

	)

401 
	#putch¨_u∆ocked
(
x
Ë
	`putc_u∆ocked
(x, 
°dout
)

	)

411 #i‡
__DARWIN_C_LEVEL
 >= 200112L

412 #i‚def 
_OFF_T


413 
	#_OFF_T


	)

414 
__d¨wö_off_t
 
	toff_t
;

417 
__BEGIN_DECLS


418 
	`f£eko
(
FILE
 *, 
off_t
, );

419 
off_t
 
	`·ñlo
(
FILE
 *);

420 
__END_DECLS


423 #i‡
__DARWIN_C_LEVEL
 >200112L || 
	`deföed
(
_C99_SOURCE
Ë|| deföed(
__˝lu•lus
)

424 
__BEGIN_DECLS


425 
	$¢¥ötf
(* 
__ª°ri˘
, 
size_t
, c⁄° * __ª°ri˘, ...Ë
	$__DARWIN_LDBL_COMPAT
(
¢¥ötf
Ë
	`__¥ötÊike
(3, 4);

426 
	$vfsˇnf
(
FILE
 * 
__ª°ri˘
, c⁄° * __ª°ri˘, 
va_li°
Ë
	$__DARWIN_LDBL_COMPAT
(
vfsˇnf
Ë
	`__sˇnÊike
(2, 0);

427 
	$vsˇnf
(c⁄° * 
__ª°ri˘
, 
va_li°
Ë
	$__DARWIN_LDBL_COMPAT
(
vsˇnf
Ë
	`__sˇnÊike
(1, 0);

428 
	$v¢¥ötf
(* 
__ª°ri˘
, 
size_t
, c⁄° * __ª°ri˘, 
va_li°
Ë
	$__DARWIN_LDBL_COMPAT
(
v¢¥ötf
Ë
	`__¥ötÊike
(3, 0);

429 
	$vssˇnf
(c⁄° * 
__ª°ri˘
, c⁄° * __ª°ri˘, 
va_li°
Ë
	$__DARWIN_LDBL_COMPAT
(
vssˇnf
Ë
	`__sˇnÊike
(2, 0);

430 
__END_DECLS


439 #i‡
__DARWIN_C_LEVEL
 >= 200809L

440 #i‚de‡
_SSIZE_T


441 
	#_SSIZE_T


	)

442 
__d¨wö_ssize_t
 
	tssize_t
;

445 
__BEGIN_DECLS


446 
	$d¥ötf
(, c⁄° * 
__ª°ri˘
, ...Ë
	$__DARWIN_LDBL_COMPAT
(
d¥ötf
Ë
	$__¥ötÊike
(2, 3Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

447 
	$vd¥ötf
(, c⁄° * 
__ª°ri˘
, 
va_li°
Ë
	$__DARWIN_LDBL_COMPAT
(
vd¥ötf
Ë
	$__¥ötÊike
(2, 0Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

448 
ssize_t
 
	$gëdñim
(** 
__ª°ri˘
, 
size_t
 * __ª°ri˘, , 
FILE
 * __ª°ri˘Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

449 
ssize_t
 
	$gëlöe
(** 
__ª°ri˘
, 
size_t
 * __ª°ri˘, 
FILE
 * __ª°ri˘Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

450 
__END_DECLS


457 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


458 
__BEGIN_DECLS


459 
__c⁄°
 
sys_√º
;

460 
__c⁄°
 *__c⁄° 
sys_îæi°
[];

462 
	$a•rötf
(**, c⁄° *, ...Ë
	$__DARWIN_LDBL_COMPAT
(
a•rötf
Ë
	`__¥ötÊike
(2, 3);

463 *
	`˘îmid_r
(*);

464 *
	`fgë 
(
FILE
 *, 
size_t
 *);

465 
__c⁄°
 *
	`fmtcheck
(const *, const *);

466 
	`Âurge
(
FILE
 *);

467 
	`£tbuf„r
(
FILE
 *, *, );

468 
	`£éöebuf
(
FILE
 *);

469 
	$va•rötf
(**, c⁄° *, 
va_li°
Ë
	$__DARWIN_LDBL_COMPAT
(
va•rötf
Ë
	`__¥ötÊike
(2, 0);

470 
FILE
 *
	`z›í
(const *, const *, );

476 
FILE
 *
	`fun›í
(const *,

479 
	$Âos_t
 (*)(*, 
Âos_t
, ),

481 
__END_DECLS


482 
	#‰›í
(
cookõ
, 
‚
Ë
	`fun›í
(cookõ, fn, 0, 0, 0)

	)

483 
	#fw›í
(
cookõ
, 
‚
Ë
	`fun›í
(cookõ, 0, fn, 0, 0)

	)

485 
	#„of_u∆ocked
(
p
Ë
	`__s„of
’)

	)

486 
	#„º‹_u∆ocked
(
p
Ë
	`__s„º‹
’)

	)

487 
	#˛óªº_u∆ocked
(
p
Ë
	`__s˛óªº
’)

	)

488 
	#fûío_u∆ocked
(
p
Ë
	`__sfûío
’)

	)

493 #ifde‡
_USE_EXTENDED_LOCALES_


494 
	~<xloˇÀ/_°dio.h
>

497 #i‡
	`deföed
 (
__GNUC__
Ë&& 
_FORTIFY_SOURCE
 > 0 && !deföed (
__˝lu•lus
)

499 
	~<£cuª/_°dio.h
>

	@/usr/include/stdlib.h

58 #i‚de‡
_STDLIB_H_


59 
	#_STDLIB_H_


	)

61 
	~<Avaûabûôy.h
>

63 
	~<_ty≥s.h
>

64 #i‡!
deföed
(
_ANSI_SOURCE
)

65 
	~<sys/waô.h
>

66 #i‡(!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

67 
	~<Æloˇ.h
>

71 #i‚def 
_SIZE_T


72 
	#_SIZE_T


	)

75 
__d¨wö_size_t
 
	tsize_t
;

78 #i‡!
deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

79 #i‚de‡
_CT_RUNE_T


80 
	#_CT_RUNE_T


	)

81 
__d¨wö_˘_ru√_t
 
	t˘_ru√_t
;

84 #i‚de‡
_RUNE_T


85 
	#_RUNE_T


	)

86 
__d¨wö_ru√_t
 
	tru√_t
;

90 #i‚def 
__˝lu•lus


91 #i‚def 
_WCHAR_T


92 
	#_WCHAR_T


	)

93 
__d¨wö_wch¨_t
 
	twch¨_t
;

98 
	mquŸ
;

99 
	mªm
;

100 } 
	tdiv_t
;

103 
	mquŸ
;

104 
	mªm
;

105 } 
	tldiv_t
;

107 #i‡!
__DARWIN_NO_LONG_LONG


109 
	mquŸ
;

110 
	mªm
;

111 } 
	tŒdiv_t
;

114 #i‚de‡
NULL


115 
	#NULL
 
__DARWIN_NULL


	)

118 
	#EXIT_FAILURE
 1

	)

119 
	#EXIT_SUCCESS
 0

	)

121 
	#RAND_MAX
 0x7fffffff

	)

123 #ifde‡
_USE_EXTENDED_LOCALES_


124 
	~<_xloˇÀ.h
>

127 #i‚de‡
MB_CUR_MAX


128 #ifde‡
_USE_EXTENDED_LOCALES_


129 
	#MB_CUR_MAX
 (
	`___mb_cur_max
())

	)

130 #i‚de‡
MB_CUR_MAX_L


131 
	#MB_CUR_MAX_L
(
x
Ë(
	`___mb_cur_max_l
(x))

	)

134 
__mb_cur_max
;

135 
	#MB_CUR_MAX
 
__mb_cur_max


	)

139 #i‡!
deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)) \

140 && 
deföed
(
_USE_EXTENDED_LOCALES_
Ë&& !
	$deföed
(
MB_CUR_MAX_L
)

141 
	#MB_CUR_MAX_L
(
x
Ë(
	`___mb_cur_max_l
(x))

	)

144 
__BEGIN_DECLS


145 
	$ab‹t
(Ë
__dód2
;

146 
	$abs
(Ë
__puª2
;

147 
	`©exô
((*)());

148 
	`©of
(const *);

149 
	`©oi
(const *);

150 
	`©ﬁ
(const *);

151 #i‡!
__DARWIN_NO_LONG_LONG


153 
	`©ﬁl
(const *);

155 *
	`b£¨ch
(c⁄° *, c⁄° *, 
size_t
,

156 
size_t
, (*)(const *, const *));

157 *
	`ˇŒoc
(
size_t
, size_t);

158 
div_t
 
	$div
(, Ë
__puª2
;

159 
	$exô
(Ë
__dód2
;

160 
	`‰ì
(*);

161 *
	`gëív
(const *);

162 
	$œbs
(Ë
__puª2
;

163 
ldiv_t
 
	$ldiv
(, Ë
__puª2
;

164 #i‡!
__DARWIN_NO_LONG_LONG


166 
	`Œabs
();

167 
Œdiv_t
 
	`Œdiv
(, );

169 *
	`mÆloc
(
size_t
);

170 
	`mbÀn
(c⁄° *, 
size_t
);

171 
size_t
 
	`mb°owcs
(
wch¨_t
 * 
__ª°ri˘
 , const * __restrict, size_t);

172 
	`mbtowc
(
wch¨_t
 * 
__ª°ri˘
, c⁄° * __ª°ri˘, 
size_t
);

173 
	$posix_memÆign
(**, 
size_t
, size_tË
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_0
);

174 
	`qs‹t
(*, 
size_t
, size_t,

176 
	`ønd
();

177 *
	`ªÆloc
(*, 
size_t
);

178 
	`§™d
();

179 
	$°πod
(c⁄° *, **Ë
	`__DARWIN_ALIAS
(
°πod
);

180 
	$°πof
(c⁄° *, **Ë
	`__DARWIN_ALIAS
(
°πof
);

181 
	`°πﬁ
(const *, **, );

183 
	$°πﬁd
(c⁄° *, **Ë
	`__DARWIN_LDBL_COMPAT
(
°πﬁd
);

184 #i‡!
__DARWIN_NO_LONG_LONG


186 
	`°πﬁl
(const *, **, );

189 
	`°πoul
(const *, **, );

190 #i‡!
__DARWIN_NO_LONG_LONG


192 
	`°πouŒ
(const *, **, );

194 
	$sy°em
(c⁄° *Ë
	`__DARWIN_ALIAS_C
(
sy°em
);

195 
size_t
 
	`wc°ombs
(* 
__ª°ri˘
, c⁄° 
wch¨_t
 * __restrict, size_t);

196 
	`w˘omb
(*, 
wch¨_t
);

198 #i‚de‡
_ANSI_SOURCE


199 
	$_Exô
(Ë
__dód2
;

200 
	`a64l
(const *);

201 
	`dønd48
();

202 *
	`ecvt
(, , *
__ª°ri˘
, *__restrict);

203 
	`î™d48
([3]);

204 *
	`fcvt
(, , *
__ª°ri˘
, *__restrict);

205 *
	`gcvt
(, , *);

206 
	`gësub›t
(**, * const *, **);

207 
	`gø¡±
();

208 #i‡
__DARWIN_UNIX03


209 *
	`öô°©e
(, *, 
size_t
);

211 *
	`öô°©e
(, *, );

213 
	`jønd48
([3]);

214 *
	`l64a
();

215 
	`lc⁄g48
([7]);

216 
	`Ã™d48
();

217 *
	`mkãmp
(*);

218 
	`mk°emp
(*);

219 
	`mønd48
();

220 
	`ƒ™d48
([3]);

221 
	`posix_›í±
();

222 *
	`±¢ame
();

223 
	$puãnv
(*Ë
	`__DARWIN_ALIAS
(
puãnv
);

224 
	`øndom
();

225 
	`ønd_r
(*);

226 #i‡(
__DARWIN_UNIX03
 && !
	`deföed
(
_POSIX_C_SOURCE
)Ë|| deföed(
_DARWIN_C_SOURCE
Ë|| deföed(
_DARWIN_BETTER_REALPATH
)

227 *
	$ªÆ∑th
(c⁄° * 
__ª°ri˘
, * __ª°ri˘Ë
	`__DARWIN_EXTSN
(
ªÆ∑th
);

229 *
	$ªÆ∑th
(c⁄° * 
__ª°ri˘
, * __ª°ri˘Ë
	`__DARWIN_ALIAS
(
ªÆ∑th
);

232 *
	`£ed48
([3]);

233 
	$£ãnv
(c⁄° *, c⁄° *, Ë
	`__DARWIN_ALIAS
(
£ãnv
);

234 #i‡
__DARWIN_UNIX03


235 
	$£tkey
(c⁄° *Ë
	`__DARWIN_ALIAS
(
£tkey
);

237 
	`£tkey
(const *);

239 *
	`£t°©e
(const *);

240 
	`§™d48
();

241 #i‡
__DARWIN_UNIX03


242 
	`§™dom
();

244 
	`§™dom
();

246 
	`u∆ock±
();

247 #i‡
__DARWIN_UNIX03


248 
	$un£ãnv
(c⁄° *Ë
	`__DARWIN_ALIAS
(
un£ãnv
);

250 
	`un£ãnv
(const *);

254 #i‡!
	`deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

255 
	~<machöe/ty≥s.h
>

257 #i‚de‡
_DEV_T


258 
__d¨wö_dev_t
 
	tdev_t
;

259 
	#_DEV_T


	)

262 #i‚def 
_MODE_T


263 
__d¨wö_mode_t
 
	tmode_t
;

264 
	#_MODE_T


	)

267 
u_öt32_t


268 
	`¨c4øndom
();

269 
	`¨c4øndom_addøndom
(* , );

270 
	$¨c4øndom_buf
(* , 
size_t
 ) 
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

271 
	`¨c4øndom_°ú
();

272 
u_öt32_t


273 
	$¨c4øndom_unif‹m
(
u_öt32_t
 ) 
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

274 #ifde‡
__BLOCKS__


275 
	`©exô_b
((^)()Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
);

276 *
	`b£¨ch_b
(c⁄° *, c⁄° *, 
size_t
,

277 
size_t
, (^)(c⁄° *, c⁄° *)Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
);

281 *
	`cgëˇp
(*, const *, );

282 
	`cgë˛o£
();

283 
	`cgëít
(**, **, const *);

284 
	`cgëfú°
(**, **);

285 
	`cgëm©ch
(const *, const *);

286 
	`cgë√xt
(**, **);

287 
	`cgënum
(*, const *, *);

288 
	`cgë£t
(const *);

289 
	`cgë°r
(*, const *, **);

290 
	`cgëu°r
(*, const *, **);

292 
	$d´m⁄
(, Ë
	$__DARWIN_1050
(
d´m⁄
Ë
	`__OSX_AVAILABLE_BUT_DEPRECATED
(
__MAC_10_0
, 
__MAC_10_5
, 
__IPHONE_2_0
, __IPHONE_2_0);

293 *
	`dev«me
(
dev_t
, 
mode_t
);

294 *
	`dev«me_r
(
dev_t
, 
mode_t
, *
buf
, 
Àn
);

295 *
	`gëbsize
(*, *);

296 
	`gëlﬂdavg
([], );

298 *
	`gë¥og«me
();

300 
	`hóps‹t
(*, 
size_t
, size_t,

302 #ifde‡
__BLOCKS__


303 
	`hóps‹t_b
(*, 
size_t
, size_t,

304 (^)(c⁄° *, c⁄° *)Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
);

306 
	`mîges‹t
(*, 
size_t
, size_t,

308 #ifde‡
__BLOCKS__


309 
	`mîges‹t_b
(*, 
size_t
, size_t,

310 (^)(c⁄° *, c⁄° *)Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
);

312 
	`ps‹t
(*, 
size_t
, size_t,

313 (*)(c⁄° *, c⁄° *)Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
);

314 #ifde‡
__BLOCKS__


315 
	`ps‹t_b
(*, 
size_t
, size_t,

316 (^)(c⁄° *, c⁄° *)Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
);

318 
	`ps‹t_r
(*, 
size_t
, size_t, *,

319 (*)(*, c⁄° *, c⁄° *)Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
);

320 #ifde‡
__BLOCKS__


321 
	`qs‹t_b
(*, 
size_t
, size_t,

322 (^)(c⁄° *, c⁄° *)Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
);

324 
	`qs‹t_r
(*, 
size_t
, size_t, *,

326 
	`ødixs‹t
(const **, , const *,

328 
	`£çrog«me
(const *);

329 
	`§adixs‹t
(const **, , const *,

331 
	`§™ddev
();

332 
	`§™domdev
();

333 *
	`ªÆlocf
(*, 
size_t
);

334 #i‡!
__DARWIN_NO_LONG_LONG


336 
	`°πoq
(const *, **, );

338 
	`°πouq
(const *, **, );

340 *
sub›èrg
;

341 *
	`vÆloc
(
size_t
);

345 #i‡!
	`deföed
(
__˝lu•lus
Ë&& deföed(
__WCHAR_MAX__
) && __WCHAR_MAX__ <= 0xffffU

346 #¥agm®
GCC
 
pois⁄
 
mb°owcs
 
mbtowc
 
wc°ombs
 
w˘omb


348 
__END_DECLS


350 #ifde‡
_USE_EXTENDED_LOCALES_


351 
	~<xloˇÀ/_°dlib.h
>

	@/usr/include/string.h

58 #i‚de‡
_STRING_H_


59 
	#_STRING_H_


	)

61 
	~<_ty≥s.h
>

63 
	~<sys/cdefs.h
>

64 
	~<Avaûabûôy.h
>

66 #i‚def 
_SIZE_T


67 
	#_SIZE_T


	)

68 
__d¨wö_size_t
 
	tsize_t
;

71 #i‚de‡
NULL


72 
	#NULL
 
__DARWIN_NULL


	)

79 
__BEGIN_DECLS


80 *
memchr
(c⁄° *, , 
size_t
);

81 
memcmp
(c⁄° *, c⁄° *, 
size_t
);

82 *
mem˝y
(*, c⁄° *, 
size_t
);

83 *
memmove
(*, c⁄° *, 
size_t
);

84 *
mem£t
(*, , 
size_t
);

85 *
°rˇt
(*, const *);

86 *
°rchr
(const *, );

87 
°rcmp
(const *, const *);

88 
°rcﬁl
(const *, const *);

89 *
°r˝y
(*, const *);

90 
size_t
 
°rc•n
(const *, const *);

91 *
	$°ªº‹
(Ë
	`__DARWIN_ALIAS
(
°ªº‹
);

92 
size_t
 
	`°æí
(const *);

93 *
	`°∫ˇt
(*, c⁄° *, 
size_t
);

94 
	`°∫cmp
(c⁄° *, c⁄° *, 
size_t
);

95 *
	`°∫˝y
(*, c⁄° *, 
size_t
);

96 *
	`°Ωbrk
(const *, const *);

97 *
	`°ºchr
(const *, );

98 
size_t
 
	`°r•n
(const *, const *);

99 *
	`°r°r
(const *, const *);

100 *
	`°πok
(*, const *);

101 
size_t
 
	`°rx‰m
(*, const *, size_t);

102 
__END_DECLS


112 #i‡
__DARWIN_C_LEVEL
 >= 199506L

113 
__BEGIN_DECLS


114 *
	`°πok_r
(*, const *, **);

115 
__END_DECLS


124 #i‡
__DARWIN_C_LEVEL
 >= 200112L

125 
__BEGIN_DECLS


126 
	`°ªº‹_r
(, *, 
size_t
);

127 *
	`°rdup
(const *);

128 *
	`memc˝y
(*, c⁄° *, , 
size_t
);

129 
__END_DECLS


138 #i‡
__DARWIN_C_LEVEL
 >= 200809L

139 
__BEGIN_DECLS


140 *
	`°p˝y
(*, const *);

141 *
	$°≤˝y
(*, c⁄° *, 
size_t
Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

142 *
	$°∫dup
(c⁄° *, 
size_t
Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

143 
size_t
 
	$°∫Àn
(c⁄° *, 
size_t
Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

144 *
	`°rsig«l
(
sig
);

145 
__END_DECLS


152 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


153 #i‚de‡
_SSIZE_T


154 
	#_SSIZE_T


	)

155 
__d¨wö_ssize_t
 
	tssize_t
;

158 
__BEGIN_DECLS


159 *
	$memmem
(c⁄° *, 
size_t
, c⁄° *, size_tË
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

160 
	$mem£t_∑âîn4
(*, c⁄° *, 
size_t
Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_3_0
);

161 
	$mem£t_∑âîn8
(*, c⁄° *, 
size_t
Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_3_0
);

162 
	$mem£t_∑âîn16
(*, c⁄° *, 
size_t
Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_3_0
);

164 *
	`°rˇ£°r
(const *, const *);

165 *
	`°∫°r
(c⁄° *, c⁄° *, 
size_t
);

166 
size_t
 
	`°æˇt
(*, const *, size_t);

167 
size_t
 
	`°æ˝y
(*, const *, size_t);

168 
	`°rmode
(, *);

169 *
	`°r£p
(**, const *);

172 
	`swab
(c⁄° * 
__ª°ri˘
, * __ª°ri˘, 
ssize_t
);

173 
__END_DECLS


180 
	~"°rögs.h
"

184 #ifde‡
_USE_EXTENDED_LOCALES_


185 
	~<xloˇÀ/_°rög.h
>

188 #i‡
	`deföed
 (
__GNUC__
Ë&& 
_FORTIFY_SOURCE
 > 0 && !deföed (
__˝lu•lus
)

190 
	~<£cuª/_°rög.h
>

	@/usr/include/sys/malloc.h

71 #i‚de‡
_SYS_MALLOC_H_


72 
	#_SYS_MALLOC_H_


	)

74 
	~<sys/≠∂ópi›ts.h
>

	@/usr/include/sys/mman.h

76 #i‚def 
_SYS_MMAN_H_


77 
	#_SYS_MMAN_H_


	)

79 
	~<sys/≠∂ópi›ts.h
>

80 
	~<sys/cdefs.h
>

82 
	~<sys/_ty≥s.h
>

88 #i‚def 
_MODE_T


89 
__d¨wö_mode_t
 
	tmode_t
;

90 
	#_MODE_T


	)

93 #i‚de‡
_OFF_T


94 
__d¨wö_off_t
 
	toff_t
;

95 
	#_OFF_T


	)

98 #i‚de‡
_SIZE_T


99 
	#_SIZE_T


	)

100 
__d¨wö_size_t
 
	tsize_t
;

107 
	#PROT_NONE
 0x00

	)

108 
	#PROT_READ
 0x01

	)

109 
	#PROT_WRITE
 0x02

	)

110 
	#PROT_EXEC
 0x04

	)

116 
	#MAP_SHARED
 0x0001

	)

117 
	#MAP_PRIVATE
 0x0002

	)

118 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

119 
	#MAP_COPY
 
MAP_PRIVATE


	)

125 
	#MAP_FIXED
 0x0010

	)

126 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

127 
	#MAP_RENAME
 0x0020

	)

128 
	#MAP_NORESERVE
 0x0040

	)

129 
	#MAP_RESERVED0080
 0x0080

	)

130 
	#MAP_NOEXTEND
 0x0100

	)

131 
	#MAP_HASSEMAPHORE
 0x0200

	)

132 
	#MAP_NOCACHE
 0x0400

	)

133 
	#MAP_JIT
 0x0800

	)

139 
	#MCL_CURRENT
 0x0001

	)

140 
	#MCL_FUTURE
 0x0002

	)

145 
	#MAP_FAILED
 ((*)-1Ë

	)

150 
	#MS_ASYNC
 0x0001

	)

151 
	#MS_INVALIDATE
 0x0002

	)

152 
	#MS_SYNC
 0x0010

	)

154 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

155 
	#MS_KILLPAGES
 0x0004

	)

156 
	#MS_DEACTIVATE
 0x0008

	)

161 
	#MAP_FILE
 0x0000

	)

162 
	#MAP_ANON
 0x1000

	)

169 
	#POSIX_MADV_NORMAL
 0

	)

170 
	#POSIX_MADV_RANDOM
 1

	)

171 
	#POSIX_MADV_SEQUENTIAL
 2

	)

172 
	#POSIX_MADV_WILLNEED
 3

	)

173 
	#POSIX_MADV_DONTNEED
 4

	)

175 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

176 
	#MADV_NORMAL
 
POSIX_MADV_NORMAL


	)

177 
	#MADV_RANDOM
 
POSIX_MADV_RANDOM


	)

178 
	#MADV_SEQUENTIAL
 
POSIX_MADV_SEQUENTIAL


	)

179 
	#MADV_WILLNEED
 
POSIX_MADV_WILLNEED


	)

180 
	#MADV_DONTNEED
 
POSIX_MADV_DONTNEED


	)

181 
	#MADV_FREE
 5

	)

182 
	#MADV_ZERO_WIRED_PAGES
 6

	)

183 
	#MADV_FREE_REUSABLE
 7

	)

184 
	#MADV_FREE_REUSE
 8

	)

185 
	#MADV_CAN_REUSE
 9

	)

190 
	#MINCORE_INCORE
 0x1

	)

191 
	#MINCORE_REFERENCED
 0x2

	)

192 
	#MINCORE_MODIFIED
 0x4

	)

193 
	#MINCORE_REFERENCED_OTHER
 0x8

	)

194 
	#MINCORE_MODIFIED_OTHER
 0x10

	)

199 
__BEGIN_DECLS


201 
mlockÆl
();

202 
mu∆ockÆl
();

204 
mlock
(c⁄° *, 
size_t
);

205 #i‚de‡
_MMAP


206 
	#_MMAP


	)

208 * 
	$mm≠
(*, 
size_t
, , , , 
off_t
Ë
	`__DARWIN_ALIAS
(
mm≠
);

211 
	$m¥Ÿe˘
(*, 
size_t
, Ë
	`__DARWIN_ALIAS
(
m¥Ÿe˘
);

213 
	$msync
(*, 
size_t
, Ë
	`__DARWIN_ALIAS_C
(
msync
);

215 
	`mu∆ock
(c⁄° *, 
size_t
);

217 
	$munm≠
(*, 
size_t
Ë
	`__DARWIN_ALIAS
(
munm≠
);

219 
	`shm_›í
(const *, , ...);

220 
	`shm_u∆ök
(const *);

222 
	`posix_madvi£
(*, 
size_t
, );

224 #i‡!
	`deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

225 
	`madvi£
(*, 
size_t
, );

226 
	`möc‹e
(c⁄° *, 
size_t
, *);

227 
	`möhîô
(*, 
size_t
, );

229 
__END_DECLS


	@/usr/include/sys/stat.h

70 #i‚de‡
_SYS_STAT_H_


71 
	#_SYS_STAT_H_


	)

73 
	~<sys/_ty≥s.h
>

74 
	~<sys/cdefs.h
>

75 
	~<Avaûabûôy.h
>

78 
	#__√ed_°ru˘_time•ec


	)

79 
	~<sys/_°ru˘s.h
>

86 #i‚de‡
_BLKCNT_T


87 
__d¨wö_blk˙t_t
 
	tblk˙t_t
;

88 
	#_BLKCNT_T


	)

91 #i‚de‡
_BLKSIZE_T


92 
__d¨wö_blksize_t
 
	tblksize_t
;

93 
	#_BLKSIZE_T


	)

96 #i‚de‡
_DEV_T


97 
__d¨wö_dev_t
 
	tdev_t
;

98 
	#_DEV_T


	)

101 #i‚def 
_INO_T


102 
__d¨wö_öo_t
 
	töo_t
;

103 
	#_INO_T


	)

106 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

107 #i‚def 
_INO64_T


108 
__d¨wö_öo64_t
 
	töo64_t
;

109 
	#_INO64_T


	)

113 #i‚def 
_MODE_T


114 
__d¨wö_mode_t
 
	tmode_t
;

115 
	#_MODE_T


	)

118 #i‚de‡
_NLINK_T


119 
__uöt16_t
 
	t∆ök_t
;

120 
	#_NLINK_T


	)

123 #i‚de‡
_UID_T


124 
__d¨wö_uid_t
 
	tuid_t
;

125 
	#_UID_T


	)

128 #i‚de‡
_GID_T


129 
__d¨wö_gid_t
 
	tgid_t
;

130 
	#_GID_T


	)

133 #i‚de‡
_OFF_T


134 
__d¨wö_off_t
 
	toff_t
;

135 
	#_OFF_T


	)

138 #i‚def 
_TIME_T


139 
	#_TIME_T


	)

140 
__d¨wö_time_t
 
	ttime_t
;

144 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

153 
	so°©
 {

154 
__uöt16_t
 
	m°_dev
;

155 
öo_t
 
	m°_öo
;

156 
mode_t
 
	m°_mode
;

157 
∆ök_t
 
	m°_∆ök
;

158 
__uöt16_t
 
	m°_uid
;

159 
__uöt16_t
 
	m°_gid
;

160 
__uöt16_t
 
	m°_rdev
;

161 
__öt32_t
 
	m°_size
;

162 
time•ec
 
	m°_©ime•ec
;

163 
time•ec
 
	m°_mtime•ec
;

164 
time•ec
 
	m°_˘ime•ec
;

165 
__öt32_t
 
	m°_blksize
;

166 
__öt32_t
 
	m°_blocks
;

167 
__uöt32_t
 
	m°_Êags
;

168 
__uöt32_t
 
	m°_gí
;

171 
	#__DARWIN_STRUCT_STAT64_TIMES
 \

172 
time•ec
 
°_©ime•ec
; \

173 
time•ec
 
°_mtime•ec
; \

174 
time•ec
 
°_˘ime•ec
; \

175 
time•ec
 
°_búthtime•ec
;

	)

179 
	#__DARWIN_STRUCT_STAT64_TIMES
 \

180 
time_t
 
°_©ime
; \

181 
°_©imí£c
; \

182 
time_t
 
°_mtime
; \

183 
°_mtimí£c
; \

184 
time_t
 
°_˘ime
; \

185 
°_˘imí£c
; \

186 
time_t
 
°_búthtime
; \

187 
°_búthtimí£c
;

	)

201 
	#__DARWIN_STRUCT_STAT64
 { \

202 
dev_t
 
°_dev
; \

203 
mode_t
 
°_mode
; \

204 
∆ök_t
 
°_∆ök
; \

205 
__d¨wö_öo64_t
 
°_öo
; \

206 
uid_t
 
°_uid
; \

207 
gid_t
 
°_gid
; \

208 
dev_t
 
°_rdev
; \

209 
__DARWIN_STRUCT_STAT64_TIMES
 \

210 
off_t
 
°_size
; \

211 
blk˙t_t
 
°_blocks
; \

212 
blksize_t
 
°_blksize
; \

213 
__uöt32_t
 
°_Êags
; \

214 
__uöt32_t
 
°_gí
; \

215 
__öt32_t
 
°_l•¨e
; \

216 
__öt64_t
 
°_q•¨e
[2]; \

217 }

	)

223 #i‡
__DARWIN_64_BIT_INO_T


225 
°©
 
	g__DARWIN_STRUCT_STAT64
;

229 
	s°©
 {

230 
dev_t
 
	m°_dev
;

231 
öo_t
 
	m°_öo
;

232 
mode_t
 
	m°_mode
;

233 
∆ök_t
 
	m°_∆ök
;

234 
uid_t
 
	m°_uid
;

235 
gid_t
 
	m°_gid
;

236 
dev_t
 
	m°_rdev
;

237 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

238 
time•ec
 
	m°_©ime•ec
;

239 
time•ec
 
	m°_mtime•ec
;

240 
time•ec
 
	m°_˘ime•ec
;

242 
time_t
 
	m°_©ime
;

243 
	m°_©imí£c
;

244 
time_t
 
	m°_mtime
;

245 
	m°_mtimí£c
;

246 
time_t
 
	m°_˘ime
;

247 
	m°_˘imí£c
;

249 
off_t
 
	m°_size
;

250 
blk˙t_t
 
	m°_blocks
;

251 
blksize_t
 
	m°_blksize
;

252 
__uöt32_t
 
	m°_Êags
;

253 
__uöt32_t
 
	m°_gí
;

254 
__öt32_t
 
	m°_l•¨e
;

255 
__öt64_t
 
	m°_q•¨e
[2];

260 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

262 #i‡!
__DARWIN_ONLY_64_BIT_INO_T


264 
°©64
 
	g__DARWIN_STRUCT_STAT64
;

273 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

274 
	#°_©ime
 
°_©ime•ec
.
tv_£c


	)

275 
	#°_mtime
 
°_mtime•ec
.
tv_£c


	)

276 
	#°_˘ime
 
°_˘ime•ec
.
tv_£c


	)

277 
	#°_búthtime
 
°_búthtime•ec
.
tv_£c


	)

284 #i‚de‡
S_IFMT


286 
	#S_IFMT
 0170000

	)

287 
	#S_IFIFO
 0010000

	)

288 
	#S_IFCHR
 0020000

	)

289 
	#S_IFDIR
 0040000

	)

290 
	#S_IFBLK
 0060000

	)

291 
	#S_IFREG
 0100000

	)

292 
	#S_IFLNK
 0120000

	)

293 
	#S_IFSOCK
 0140000

	)

294 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

295 
	#S_IFWHT
 0160000

	)

300 
	#S_IRWXU
 0000700

	)

301 
	#S_IRUSR
 0000400

	)

302 
	#S_IWUSR
 0000200

	)

303 
	#S_IXUSR
 0000100

	)

305 
	#S_IRWXG
 0000070

	)

306 
	#S_IRGRP
 0000040

	)

307 
	#S_IWGRP
 0000020

	)

308 
	#S_IXGRP
 0000010

	)

310 
	#S_IRWXO
 0000007

	)

311 
	#S_IROTH
 0000004

	)

312 
	#S_IWOTH
 0000002

	)

313 
	#S_IXOTH
 0000001

	)

315 
	#S_ISUID
 0004000

	)

316 
	#S_ISGID
 0002000

	)

317 
	#S_ISVTX
 0001000

	)

319 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

320 
	#S_ISTXT
 
S_ISVTX


	)

321 
	#S_IREAD
 
S_IRUSR


	)

322 
	#S_IWRITE
 
S_IWUSR


	)

323 
	#S_IEXEC
 
S_IXUSR


	)

333 
	#S_ISBLK
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFBLK
Ë

	)

334 
	#S_ISCHR
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFCHR
Ë

	)

335 
	#S_ISDIR
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFDIR
Ë

	)

336 
	#S_ISFIFO
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFIFO
Ë

	)

337 
	#S_ISREG
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFREG
Ë

	)

338 
	#S_ISLNK
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFLNK
Ë

	)

339 
	#S_ISSOCK
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFSOCK
Ë

	)

340 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

341 
	#S_ISWHT
(
m
Ë(((mË& 
S_IFMT
Ë=
S_IFWHT
Ë

	)

359 
	#S_TYPEISMQ
(
buf
Ë(0Ë

	)

360 
	#S_TYPEISSEM
(
buf
Ë(0Ë

	)

361 
	#S_TYPEISSHM
(
buf
Ë(0Ë

	)

377 
	#S_TYPEISTMO
(
buf
Ë(0Ë

	)

380 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

381 
	#ACCESSPERMS
 (
S_IRWXU
|
S_IRWXG
|
S_IRWXO
Ë

	)

383 
	#ALLPERMS
 (
S_ISUID
|
S_ISGID
|
S_ISTXT
|
S_IRWXU
|
S_IRWXG
|
S_IRWXO
)

	)

385 
	#DEFFILEMODE
 (
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IWGRP
|
S_IROTH
|
S_IWOTH
)

	)

387 
	#S_BLKSIZE
 512

	)

394 
	#UF_SETTABLE
 0x0000fff‡

	)

395 
	#UF_NODUMP
 0x00000001

	)

396 
	#UF_IMMUTABLE
 0x00000002

	)

397 
	#UF_APPEND
 0x00000004

	)

398 
	#UF_OPAQUE
 0x00000008

	)

404 
	#UF_COMPRESSED
 0x00000020

	)

405 
	#UF_TRACKED
 0x00000040

	)

407 
	#UF_HIDDEN
 0x00008000

	)

412 
	#SF_SETTABLE
 0xffff0000

	)

413 
	#SF_ARCHIVED
 0x00010000

	)

414 
	#SF_IMMUTABLE
 0x00020000

	)

415 
	#SF_APPEND
 0x00040000

	)

428 
__BEGIN_DECLS


430 
	$chmod
(c⁄° *, 
mode_t
Ë
	`__DARWIN_ALIAS
(
chmod
);

431 
	$fchmod
(, 
mode_t
Ë
	`__DARWIN_ALIAS
(
fchmod
);

432 
	$f°©
(, 
°©
 *Ë
	`__DARWIN_INODE64
(
f°©
);

433 
	$l°©
(c⁄° *, 
°©
 *Ë
	`__DARWIN_INODE64
(
l°©
);

434 
	`mkdú
(c⁄° *, 
mode_t
);

435 
	`mkfifo
(c⁄° *, 
mode_t
);

436 
	$°©
(c⁄° *, 
°©
 *Ë
	`__DARWIN_INODE64
(stat);

437 
	`mknod
(c⁄° *, 
mode_t
, 
dev_t
);

438 
mode_t
 
	`umask
(mode_t);

440 #i‡!
	`deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

441 #i‚de‡
_FILESEC_T


442 
_fûe£c
;

443 
_fûe£c
 *
	tfûe£c_t
;

444 
	#_FILESEC_T


	)

446 
	`chÊags
(c⁄° *, 
__uöt32_t
);

447 
	`chmodx_≈
(c⁄° *, 
fûe£c_t
);

448 
	`fchÊags
(, 
__uöt32_t
);

449 
	`fchmodx_≈
(, 
fûe£c_t
);

450 
	$f°©x_≈
(, 
°©
 *, 
fûe£c_t
Ë
	`__DARWIN_INODE64
(
f°©x_≈
);

451 
	$lchÊags
(c⁄° *, 
__uöt32_t
Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_2_0
);

452 
	$lchmod
(c⁄° *, 
mode_t
Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_2_0
);

453 
	$l°©x_≈
(c⁄° *, 
°©
 *, 
fûe£c_t
Ë
	`__DARWIN_INODE64
(
l°©x_≈
);

454 
	`mkdúx_≈
(c⁄° *, 
fûe£c_t
);

455 
	`mkfifox_≈
(c⁄° *, 
fûe£c_t
);

456 
	$°©x_≈
(c⁄° *, 
°©
 *, 
fûe£c_t
Ë
	`__DARWIN_INODE64
(
°©x_≈
);

457 
	$umaskx_≈
(
fûe£c_t
Ë
	`__OSX_AVAILABLE_BUT_DEPRECATED
(
__MAC_10_4
,
__MAC_10_6
,
__IPHONE_NA
,__IPHONE_NA);

459 #i‡!
__DARWIN_ONLY_64_BIT_INO_T


461 
	$f°©x64_≈
(, 
°©64
 *, 
fûe£c_t
Ë
	`__OSX_AVAILABLE_BUT_DEPRECATED
(
__MAC_10_5
,
__MAC_10_6
,
__IPHONE_NA
,__IPHONE_NA);

462 
	$l°©x64_≈
(c⁄° *, 
°©64
 *, 
fûe£c_t
Ë
	`__OSX_AVAILABLE_BUT_DEPRECATED
(
__MAC_10_5
,
__MAC_10_6
,
__IPHONE_NA
,__IPHONE_NA);

463 
	$°©x64_≈
(c⁄° *, 
°©64
 *, 
fûe£c_t
Ë
	`__OSX_AVAILABLE_BUT_DEPRECATED
(
__MAC_10_5
,
__MAC_10_6
,
__IPHONE_NA
,__IPHONE_NA);

464 
	$f°©64
(, 
°©64
 *Ë
	`__OSX_AVAILABLE_BUT_DEPRECATED
(
__MAC_10_5
,
__MAC_10_6
,
__IPHONE_NA
,__IPHONE_NA);

465 
	$l°©64
(c⁄° *, 
°©64
 *Ë
	`__OSX_AVAILABLE_BUT_DEPRECATED
(
__MAC_10_5
,
__MAC_10_6
,
__IPHONE_NA
,__IPHONE_NA);

466 
	$°©64
(c⁄° *, 
°©64
 *Ë
	`__OSX_AVAILABLE_BUT_DEPRECATED
(
__MAC_10_5
,
__MAC_10_6
,
__IPHONE_NA
,__IPHONE_NA);

470 
__END_DECLS


	@/usr/include/sys/time.h

64 #i‚de‡
_SYS_TIME_H_


65 
	#_SYS_TIME_H_


	)

67 
	~<sys/cdefs.h
>

68 
	~<sys/_ty≥s.h
>

69 
	~<Avaûabûôy.h
>

75 
	#__√ed_fd_£t


	)

76 
	#__√ed_°ru˘_time•ec


	)

77 
	#__√ed_°ru˘_timevÆ


	)

78 
	~<sys/_°ru˘s.h
>

80 #i‚def 
_TIME_T


81 
	#_TIME_T


	)

82 
__d¨wö_time_t
 
	ttime_t
;

85 #i‚de‡
_SUSECONDS_T


86 
	#_SUSECONDS_T


	)

87 
__d¨wö_su£c⁄ds_t
 
	tsu£c⁄ds_t
;

94 
	sôimîvÆ
 {

95 
timevÆ
 
	mô_öãrvÆ
;

96 
timevÆ
 
	mô_vÆue
;

103 
	#ITIMER_REAL
 0

	)

104 
	#ITIMER_VIRTUAL
 1

	)

105 
	#ITIMER_PROF
 2

	)

113 #i‚def 
FD_SETSIZE


114 
	#FD_SETSIZE
 
__DARWIN_FD_SETSIZE


	)

116 #i‚de‡
FD_SET


117 
	#FD_SET
(
n
, 
p
Ë
	`__DARWIN_FD_SET
“,Ö)

	)

119 #i‚def 
FD_CLR


120 
	#FD_CLR
(
n
,
p
Ë
	`__DARWIN_FD_CLR
“,Ö)

	)

122 #i‚de‡
FD_ISSET


123 
	#FD_ISSET
(
n
, 
p
Ë
	`__DARWIN_FD_ISSET
“,Ö)

	)

125 #i‚de‡
FD_ZERO


126 
	#FD_ZERO
(
p
Ë
	`__DARWIN_FD_ZERO
’)

	)

129 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

131 #i‚de‡
FD_COPY


132 
	#FD_COPY
(
f
, 
t
Ë
	`__DARWIN_FD_COPY
(f,Å)

	)

135 
	#TIMEVAL_TO_TIMESPEC
(
tv
, 
ts
) { \

136 (
ts
)->
tv_£c
 = (
tv
)->tv_sec; \

137 (
ts
)->
tv_n£c
 = (
tv
)->
tv_u£c
 * 1000; \

138 }

	)

139 
	#TIMESPEC_TO_TIMEVAL
(
tv
, 
ts
) { \

140 (
tv
)->
tv_£c
 = (
ts
)->tv_sec; \

141 (
tv
)->
tv_u£c
 = (
ts
)->
tv_n£c
 / 1000; \

142 }

	)

144 
	stimez⁄e
 {

145 
	mtz_möuãswe°
;

146 
	mtz_d°time
;

148 
	#DST_NONE
 0

	)

149 
	#DST_USA
 1

	)

150 
	#DST_AUST
 2

	)

151 
	#DST_WET
 3

	)

152 
	#DST_MET
 4

	)

153 
	#DST_EET
 5

	)

154 
	#DST_CAN
 6

	)

157 
	#timî˛ór
(
tvp
Ë—vp)->
tv_£c
 = (tvp)->
tv_u£c
 = 0

	)

158 
	#timîis£t
(
tvp
Ë(—vp)->
tv_£c
 || (tvp)->
tv_u£c
)

	)

159 
	#timîcmp
(
tvp
, 
uvp
, 
cmp
) \

160 (((
tvp
)->
tv_£c
 =(
uvp
)->tv_sec) ? \

161 ((
tvp
)->
tv_u£c
 
	`cmp
 (
uvp
)->tv_usec) : \

162 ((
tvp
)->
tv_£c
 
	`cmp
 (
uvp
)->tv_£c))

	)

163 
	#timîadd
(
tvp
, 
uvp
, 
vvp
) \

165 (
vvp
)->
tv_£c
 = (
tvp
)->tv_£¯+ (
uvp
)->tv_sec; \

166 (
vvp
)->
tv_u£c
 = (
tvp
)->tv_u£¯+ (
uvp
)->tv_usec; \

167 i‡((
vvp
)->
tv_u£c
 >= 1000000) { \

168 (
vvp
)->
tv_£c
++; \

169 (
vvp
)->
tv_u£c
 -= 1000000; \

171 } 0)

	)

172 
	#timîsub
(
tvp
, 
uvp
, 
vvp
) \

174 (
vvp
)->
tv_£c
 = (
tvp
)->tv_£¯- (
uvp
)->tv_sec; \

175 (
vvp
)->
tv_u£c
 = (
tvp
)->tv_u£¯- (
uvp
)->tv_usec; \

176 i‡((
vvp
)->
tv_u£c
 < 0) { \

177 (
vvp
)->
tv_£c
--; \

178 (
vvp
)->
tv_u£c
 += 1000000; \

180 } 0)

	)

182 
	#timevÆcmp
(
l
, 
r
, 
cmp
Ë
	`timîcmp
÷,Ñ, cmpË

	)

187 
	s˛ocköfo
 {

188 
	mhz
;

189 
	mtick
;

190 
	mtickadj
;

191 
	m°©hz
;

192 
	m¥ofhz
;

197 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

198 
	~<time.h
>

201 
	g__BEGIN_DECLS


203 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

204 
adjtime
(c⁄° 
timevÆ
 *, timeval *);

205 
futimes
(, c⁄° 
timevÆ
 *);

206 
	$lutimes
(c⁄° *, c⁄° 
timevÆ
 *Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_2_0
);

207 
	`£âimeofday
(c⁄° 
timevÆ
 *, c⁄° 
timez⁄e
 *);

210 
	`gëôimî
(, 
ôimîvÆ
 *);

211 
	`gëtimeofday
(
timevÆ
 * 
__ª°ri˘
, * __restrict);

213 
	~<sys/_£À˘.h
>

215 
	`£tôimî
(, c⁄° 
ôimîvÆ
 * 
__ª°ri˘
,

216 
ôimîvÆ
 * 
__ª°ri˘
);

217 
	`utimes
(c⁄° *, c⁄° 
timevÆ
 *);

219 
__END_DECLS


	@/usr/include/sys/types.h

69 #i‚de‡
_SYS_TYPES_H_


70 
	#_SYS_TYPES_H_


	)

72 
	~<sys/≠∂ópi›ts.h
>

74 #i‚de‡
__ASSEMBLER__


75 
	~<sys/cdefs.h
>

78 
	~<machöe/ty≥s.h
>

79 
	~<sys/_ty≥s.h
>

81 
	~<machöe/ídün.h
>

83 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

84 
	tu_ch¨
;

85 
	tu_sh‹t
;

86 
	tu_öt
;

87 #i‚de‡
_U_LONG


88 
	tu_l⁄g
;

89 
	#_U_LONG


	)

91 
	tush‹t
;

92 
	tuöt
;

95 
u_öt64_t
 
	tu_quad_t
;

96 
öt64_t
 
	tquad_t
;

97 
quad_t
 * 
	tqaddr_t
;

99 * 
	tˇddr_t
;

100 
öt32_t
 
	tdaddr_t
;

102 #i‚de‡
_DEV_T


103 
__d¨wö_dev_t
 
	tdev_t
;

104 
	#_DEV_T


	)

107 
u_öt32_t
 
	tfix±_t
;

109 #i‚de‡
_BLKCNT_T


110 
__d¨wö_blk˙t_t
 
	tblk˙t_t
;

111 
	#_BLKCNT_T


	)

114 #i‚de‡
_BLKSIZE_T


115 
__d¨wö_blksize_t
 
	tblksize_t
;

116 
	#_BLKSIZE_T


	)

119 #i‚de‡
_GID_T


120 
__d¨wö_gid_t
 
	tgid_t
;

121 
	#_GID_T


	)

124 #i‚de‡
_IN_ADDR_T


125 
	#_IN_ADDR_T


	)

126 
__uöt32_t
 
	tö_addr_t
;

129 #i‚de‡
_IN_PORT_T


130 
	#_IN_PORT_T


	)

131 
__uöt16_t
 
	tö_p‹t_t
;

134 #i‚def 
_INO_T


135 
__d¨wö_öo_t
 
	töo_t
;

136 
	#_INO_T


	)

139 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

140 #i‚def 
_INO64_T


141 
__d¨wö_öo64_t
 
	töo64_t
;

142 
	#_INO64_T


	)

146 #i‚de‡
_KEY_T


147 
	#_KEY_T


	)

148 
__öt32_t
 
	tkey_t
;

151 #i‚def 
_MODE_T


152 
__d¨wö_mode_t
 
	tmode_t
;

153 
	#_MODE_T


	)

156 #i‚de‡
_NLINK_T


157 
__uöt16_t
 
	t∆ök_t
;

158 
	#_NLINK_T


	)

161 #i‚de‡
_ID_T


162 
	#_ID_T


	)

163 
__d¨wö_id_t
 
	tid_t
;

166 #i‚de‡
_PID_T


167 
__d¨wö_pid_t
 
	tpid_t
;

168 
	#_PID_T


	)

171 #i‚de‡
_OFF_T


172 
__d¨wö_off_t
 
	toff_t
;

173 
	#_OFF_T


	)

176 
öt32_t
 
	t£gsz_t
;

177 
öt32_t
 
	tswblk_t
;

179 #i‚de‡
_UID_T


180 
__d¨wö_uid_t
 
	tuid_t
;

181 
	#_UID_T


	)

184 #i‚de‡
_ID_T


185 
__d¨wö_id_t
 
	tid_t
;

186 
	#_ID_T


	)

189 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

191 #i‡
deföed
(
__˝lu•lus
)

197 
ölöe
 
__öt32_t
 
	$maj‹
(
__uöt32_t
 
_x
)

199  (
__öt32_t
)(((
__uöt32_t
)
_x
 >> 24) & 0xff);

200 
	}
}

202 
ölöe
 
__öt32_t
 
	$mö‹
(
__uöt32_t
 
_x
)

204  (
__öt32_t
)((
_x
) & 0xffffff);

205 
	}
}

207 
ölöe
 
dev_t
 
	$makedev
(
__uöt32_t
 
_maj‹
, __uöt32_à
_mö‹
)

209  (
dev_t
)(((
_maj‹
Ë<< 24Ë| (
_mö‹
));

210 
	}
}

214 
	#maj‹
(
x
Ë((
öt32_t
)(((
u_öt32_t
)(xË>> 24Ë& 0xff))

	)

215 
	#mö‹
(
x
Ë((
öt32_t
)((xË& 0xffffff))

	)

216 
	#makedev
(
x
,
y
Ë((
dev_t
)(((xË<< 24Ë| (y)))

	)

221 #i‚def 
_CLOCK_T


222 
	#_CLOCK_T


	)

223 
__d¨wö_˛ock_t
 
	t˛ock_t
;

226 #i‚de‡
_SIZE_T


227 
	#_SIZE_T


	)

230 
__d¨wö_size_t
 
	tsize_t
;

233 #i‚def 
_SSIZE_T


234 
	#_SSIZE_T


	)

235 
__d¨wö_ssize_t
 
	tssize_t
;

238 #i‚def 
_TIME_T


239 
	#_TIME_T


	)

240 
__d¨wö_time_t
 
	ttime_t
;

243 #i‚de‡
_USECONDS_T


244 
	#_USECONDS_T


	)

245 
__d¨wö_u£c⁄ds_t
 
	tu£c⁄ds_t
;

248 #i‚de‡
_SUSECONDS_T


249 
	#_SUSECONDS_T


	)

250 
__d¨wö_su£c⁄ds_t
 
	tsu£c⁄ds_t
;

253 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

259 
	#__√ed_fd_£t


	)

260 
	~<sys/_°ru˘s.h
>

262 
	#NBBY
 
__DARWIN_NBBY


	)

263 
	#NFDBITS
 
__DARWIN_NFDBITS


	)

264 
	#howm™y
(
x
, 
y
Ë
	`__DARWIN_howm™y
(x, yË

	)

265 
__öt32_t
 
	tfd_mask
;

273 #i‚def 
FD_SETSIZE


274 
	#FD_SETSIZE
 
__DARWIN_FD_SETSIZE


	)

276 #i‚de‡
FD_SET


277 
	#FD_SET
(
n
, 
p
Ë
	`__DARWIN_FD_SET
“,Ö)

	)

279 #i‚de‡
FD_CLR


280 
	#FD_CLR
(
n
, 
p
Ë
	`__DARWIN_FD_CLR
“,Ö)

	)

282 #i‚de‡
FD_ISSET


283 
	#FD_ISSET
(
n
, 
p
Ë
	`__DARWIN_FD_ISSET
“,Ö)

	)

285 #i‚de‡
FD_ZERO


286 
	#FD_ZERO
(
p
Ë
	`__DARWIN_FD_ZERO
’)

	)

288 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

289 #i‚de‡
FD_COPY


290 
	#FD_COPY
(
f
, 
t
Ë
	`__DARWIN_FD_COPY
(f,Å)

	)

295 #i‡
deföed
(
__STDC__
Ë&& deföed(
KERNEL
)

301 
	g¥oc
;

302 
	gpgΩ
;

303 
	gu¸ed
;

304 
	grußge
;

305 
	gfûe
;

306 
	gbuf
;

307 
	gây
;

308 
	guio
;

314 #i‚de‡
__POSIX_LIB__


316 #i‚de‡
_PTHREAD_ATTR_T


317 
	#_PTHREAD_ATTR_T


	)

318 
__d¨wö_±hªad_©å_t
 
	t±hªad_©å_t
;

320 #i‚de‡
_PTHREAD_COND_T


321 
	#_PTHREAD_COND_T


	)

322 
__d¨wö_±hªad_c⁄d_t
 
	t±hªad_c⁄d_t
;

324 #i‚de‡
_PTHREAD_CONDATTR_T


325 
	#_PTHREAD_CONDATTR_T


	)

326 
__d¨wö_±hªad_c⁄d©å_t
 
	t±hªad_c⁄d©å_t
;

328 #i‚de‡
_PTHREAD_MUTEX_T


329 
	#_PTHREAD_MUTEX_T


	)

330 
__d¨wö_±hªad_muãx_t
 
	t±hªad_muãx_t
;

332 #i‚de‡
_PTHREAD_MUTEXATTR_T


333 
	#_PTHREAD_MUTEXATTR_T


	)

334 
__d¨wö_±hªad_muãx©å_t
 
	t±hªad_muãx©å_t
;

336 #i‚de‡
_PTHREAD_ONCE_T


337 
	#_PTHREAD_ONCE_T


	)

338 
__d¨wö_±hªad_⁄˚_t
 
	t±hªad_⁄˚_t
;

340 #i‚de‡
_PTHREAD_RWLOCK_T


341 
	#_PTHREAD_RWLOCK_T


	)

342 
__d¨wö_±hªad_rwlock_t
 
	t±hªad_rwlock_t
;

344 #i‚de‡
_PTHREAD_RWLOCKATTR_T


345 
	#_PTHREAD_RWLOCKATTR_T


	)

346 
__d¨wö_±hªad_rwlock©å_t
 
	t±hªad_rwlock©å_t
;

348 #i‚de‡
_PTHREAD_T


349 
	#_PTHREAD_T


	)

350 
__d¨wö_±hªad_t
 
	t±hªad_t
;

355 #i‚de‡
_PTHREAD_KEY_T


356 
	#_PTHREAD_KEY_T


	)

357 
__d¨wö_±hªad_key_t
 
	t±hªad_key_t
;

361 #i‚de‡
_FSBLKCNT_T


362 
	#_FSBLKCNT_T


	)

363 
__d¨wö_fsblk˙t_t
 
	tfsblk˙t_t
;

366 #i‚de‡
_FSFILCNT_T


367 
	#_FSFILCNT_T


	)

368 
__d¨wö_fsfû˙t_t
 
	tfsfû˙t_t
;

	@/usr/include/syslog.h

23 
	~<sys/sy¶og.h
>

	@/usr/include/time.h

63 #i‚de‡
_TIME_H_


64 
	#_TIME_H_


	)

66 
	~<_ty≥s.h
>

68 
	#__√ed_°ru˘_time•ec


	)

69 
	~<_°ru˘s.h
>

71 #i‚de‡
NULL


72 
	#NULL
 
__DARWIN_NULL


	)

75 #i‚def 
_CLOCK_T


76 
	#_CLOCK_T


	)

77 
__d¨wö_˛ock_t
 
	t˛ock_t
;

80 #i‚def 
_SIZE_T


81 
	#_SIZE_T


	)

82 
__d¨wö_size_t
 
	tsize_t
;

85 #i‚def 
_TIME_T


86 
	#_TIME_T


	)

87 
__d¨wö_time_t
 
	ttime_t
;

90 
	stm
 {

91 
	mtm_£c
;

92 
	mtm_mö
;

93 
	mtm_hour
;

94 
	mtm_mday
;

95 
	mtm_m⁄
;

96 
	mtm_yór
;

97 
	mtm_wday
;

98 
	mtm_yday
;

99 
	mtm_isd°
;

100 
	mtm_gmtoff
;

101 *
	mtm_z⁄e
;

104 #i‡
__DARWIN_UNIX03


105 
	#CLOCKS_PER_SEC
 1000000

	)

107 
	~<machöe/_limôs.h
>

109 
	#CLOCKS_PER_SEC
 (
__DARWIN_CLK_TCK
)

	)

112 #i‚de‡
_ANSI_SOURCE


113 *
tz«me
[];

116 
gëd©e_îr
;

117 #i‡
__DARWIN_UNIX03


118 
timez⁄e
 
__DARWIN_ALIAS
(timezone);

120 
daylight
;

122 
__BEGIN_DECLS


123 *
as˘ime
(c⁄° 
tm
 *);

124 
˛ock_t
 
	$˛ock
(Ë
	`__DARWIN_ALIAS
(
˛ock
);

125 *
	`˘ime
(c⁄° 
time_t
 *);

126 
	`dif·ime
(
time_t
,Åime_t);

127 
tm
 *
	`gëd©e
(const *);

128 
tm
 *
	`gmtime
(c⁄° 
time_t
 *);

129 
tm
 *
	`loˇ…ime
(c⁄° 
time_t
 *);

130 
time_t
 
	$mktime
(
tm
 *Ë
	`__DARWIN_ALIAS
(
mktime
);

131 
size_t
 
	$°r·ime
(* 
__ª°ri˘
, 
size_t
, c⁄° * __ª°ri˘, c⁄° 
tm
 * __ª°ri˘Ë
	`__DARWIN_ALIAS
(
°r·ime
);

132 *
	$°Ωtime
(c⁄° * 
__ª°ri˘
, c⁄° * __ª°ri˘, 
tm
 * __ª°ri˘Ë
	`__DARWIN_ALIAS
(
°Ωtime
);

133 
time_t
 
	`time
(time_t *);

135 #i‚de‡
_ANSI_SOURCE


136 
	`tz£t
();

140 *
	`as˘ime_r
(c⁄° 
tm
 * 
__ª°ri˘
, * __restrict);

141 *
	`˘ime_r
(c⁄° 
time_t
 *, *);

142 
tm
 *
	`gmtime_r
(c⁄° 
time_t
 * 
__ª°ri˘
, tm * __restrict);

143 
tm
 *
	`loˇ…ime_r
(c⁄° 
time_t
 * 
__ª°ri˘
, tm * __restrict);

145 #i‡!
	`deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

146 
time_t
 
	`posix2time
(time_t);

147 #i‡!
__DARWIN_UNIX03


148 *
	`timez⁄e
(, );

150 
	`tz£twÆl
();

151 
time_t
 
	`time2posix
(time_t);

152 
time_t
 
	`timñoˇl
(
tm
 * const);

153 
time_t
 
	`timegm
(
tm
 * const);

156 #i‡!
	`deföed
(
_ANSI_SOURCE
)

157 
	$«no¶ìp
(c⁄° 
time•ec
 *, time•e¯*Ë
	`__DARWIN_ALIAS_C
(
«no¶ìp
);

159 
__END_DECLS


161 #ifde‡
_USE_EXTENDED_LOCALES_


162 
	~<xloˇÀ/_time.h
>

	@/usr/include/unistd.h

68 #i‚de‡
_UNISTD_H_


69 
	#_UNISTD_H_


	)

71 
	~<_ty≥s.h
>

72 
	~<sys/uni°d.h
>

73 
	~<Avaûabûôy.h
>

75 #i‚de‡
_GID_T


76 
	#_GID_T


	)

77 
__d¨wö_gid_t
 
	tgid_t
;

80 #i‚de‡
_INTPTR_T


81 
	#_INTPTR_T


	)

82 
__d¨wö_öçå_t
 
	töçå_t
;

85 #i‚de‡
_OFF_T


86 
	#_OFF_T


	)

87 
__d¨wö_off_t
 
	toff_t
;

90 #i‚de‡
_PID_T


91 
	#_PID_T


	)

92 
__d¨wö_pid_t
 
	tpid_t
;

95 #i‚de‡
_SIZE_T


96 
	#_SIZE_T


	)

99 
__d¨wö_size_t
 
	tsize_t
;

102 #i‚def 
_SSIZE_T


103 
	#_SSIZE_T


	)

104 
__d¨wö_ssize_t
 
	tssize_t
;

107 #i‚de‡
_UID_T


108 
	#_UID_T


	)

109 
__d¨wö_uid_t
 
	tuid_t
;

112 #i‚de‡
_USECONDS_T


113 
	#_USECONDS_T


	)

114 
__d¨wö_u£c⁄ds_t
 
	tu£c⁄ds_t
;

117 #i‚de‡
NULL


118 
	#NULL
 
__DARWIN_NULL


	)

121 
	#STDIN_FILENO
 0

	)

122 
	#STDOUT_FILENO
 1

	)

123 
	#STDERR_FILENO
 2

	)

128 
	#_XOPEN_VERSION
 600

	)

129 
	#_XOPEN_XCU_VERSION
 4

	)

133 
	#_POSIX_ADVISORY_INFO
 (-1Ë

	)

134 
	#_POSIX_ASYNCHRONOUS_IO
 (-1Ë

	)

135 
	#_POSIX_BARRIERS
 (-1Ë

	)

136 
	#_POSIX_CHOWN_RESTRICTED
 200112L

	)

137 
	#_POSIX_CLOCK_SELECTION
 (-1Ë

	)

138 
	#_POSIX_CPUTIME
 (-1Ë

	)

139 
	#_POSIX_FSYNC
 200112L

	)

140 
	#_POSIX_IPV6
 200112L

	)

141 
	#_POSIX_JOB_CONTROL
 200112L

	)

142 
	#_POSIX_MAPPED_FILES
 200112L

	)

143 
	#_POSIX_MEMLOCK
 (-1Ë

	)

144 
	#_POSIX_MEMLOCK_RANGE
 (-1Ë

	)

145 
	#_POSIX_MEMORY_PROTECTION
 200112L

	)

146 
	#_POSIX_MESSAGE_PASSING
 (-1Ë

	)

147 
	#_POSIX_MONOTONIC_CLOCK
 (-1Ë

	)

148 
	#_POSIX_NO_TRUNC
 200112L

	)

149 
	#_POSIX_PRIORITIZED_IO
 (-1Ë

	)

150 
	#_POSIX_PRIORITY_SCHEDULING
 (-1Ë

	)

151 
	#_POSIX_RAW_SOCKETS
 (-1Ë

	)

152 
	#_POSIX_READER_WRITER_LOCKS
 200112L

	)

153 
	#_POSIX_REALTIME_SIGNALS
 (-1Ë

	)

154 
	#_POSIX_REGEXP
 200112L

	)

155 
	#_POSIX_SAVED_IDS
 200112L

	)

156 
	#_POSIX_SEMAPHORES
 (-1Ë

	)

157 
	#_POSIX_SHARED_MEMORY_OBJECTS
 (-1Ë

	)

158 
	#_POSIX_SHELL
 200112L

	)

159 
	#_POSIX_SPAWN
 (-1Ë

	)

160 
	#_POSIX_SPIN_LOCKS
 (-1Ë

	)

161 
	#_POSIX_SPORADIC_SERVER
 (-1Ë

	)

162 
	#_POSIX_SYNCHRONIZED_IO
 (-1Ë

	)

163 
	#_POSIX_THREAD_ATTR_STACKADDR
 200112L

	)

164 
	#_POSIX_THREAD_ATTR_STACKSIZE
 200112L

	)

165 
	#_POSIX_THREAD_CPUTIME
 (-1Ë

	)

166 
	#_POSIX_THREAD_PRIO_INHERIT
 (-1Ë

	)

167 
	#_POSIX_THREAD_PRIO_PROTECT
 (-1Ë

	)

168 
	#_POSIX_THREAD_PRIORITY_SCHEDULING
 (-1Ë

	)

169 
	#_POSIX_THREAD_PROCESS_SHARED
 200112L

	)

170 
	#_POSIX_THREAD_SAFE_FUNCTIONS
 200112L

	)

171 
	#_POSIX_THREAD_SPORADIC_SERVER
 (-1Ë

	)

172 
	#_POSIX_THREADS
 200112L

	)

173 
	#_POSIX_TIMEOUTS
 (-1Ë

	)

174 
	#_POSIX_TIMERS
 (-1Ë

	)

175 
	#_POSIX_TRACE
 (-1Ë

	)

176 
	#_POSIX_TRACE_EVENT_FILTER
 (-1Ë

	)

177 
	#_POSIX_TRACE_INHERIT
 (-1Ë

	)

178 
	#_POSIX_TRACE_LOG
 (-1Ë

	)

179 
	#_POSIX_TYPED_MEMORY_OBJECTS
 (-1Ë

	)

180 #i‚de‡
_POSIX_VDISABLE


181 
	#_POSIX_VDISABLE
 0xf‡

	)

184 #i‡
__DARWIN_C_LEVEL
 >= 199209L

185 
	#_POSIX2_C_BIND
 200112L

	)

186 
	#_POSIX2_C_DEV
 200112L

	)

187 
	#_POSIX2_CHAR_TERM
 200112L

	)

188 
	#_POSIX2_FORT_DEV
 (-1Ë

	)

189 
	#_POSIX2_FORT_RUN
 200112L

	)

190 
	#_POSIX2_LOCALEDEF
 200112L

	)

191 
	#_POSIX2_PBS
 (-1)

	)

192 
	#_POSIX2_PBS_ACCOUNTING
 (-1)

	)

193 
	#_POSIX2_PBS_CHECKPOINT
 (-1)

	)

194 
	#_POSIX2_PBS_LOCATE
 (-1)

	)

195 
	#_POSIX2_PBS_MESSAGE
 (-1)

	)

196 
	#_POSIX2_PBS_TRACK
 (-1)

	)

197 
	#_POSIX2_SW_DEV
 200112L

	)

198 
	#_POSIX2_UPE
 200112L

	)

201 
	#__ILP32_OFF32
 (-1)

	)

202 
	#__ILP32_OFFBIG
 (-1)

	)

203 
	#__LP64_OFF64
 (-1)

	)

204 
	#__LPBIG_OFFBIG
 (-1)

	)

206 #ifde‡
__LP64__


207 #unde‡
__LP64_OFF64


208 
	#__LP64_OFF64
 (1)

	)

209 #unde‡
__LPBIG_OFFBIG


210 
	#__LPBIG_OFFBIG
 (1)

	)

212 #unde‡
__ILP32_OFFBIG


213 
	#__ILP32_OFFBIG
 (1)

	)

216 #i‡
__DARWIN_C_LEVEL
 >= 200112L

217 
	#_POSIX_V6_ILP32_OFF32
 
__ILP32_OFF32


	)

218 
	#_POSIX_V6_ILP32_OFFBIG
 
__ILP32_OFFBIG


	)

219 
	#_POSIX_V6_LP64_OFF64
 
__LP64_OFF64


	)

220 
	#_POSIX_V6_LPBIG_OFFBIG
 
__LPBIG_OFFBIG


	)

223 #i‡
__DARWIN_C_LEVEL
 >= 200809L

224 
	#_POSIX_V7_ILP32_OFF32
 
__ILP32_OFF32


	)

225 
	#_POSIX_V7_ILP32_OFFBIG
 
__ILP32_OFFBIG


	)

226 
	#_POSIX_V7_LP64_OFF64
 
__LP64_OFF64


	)

227 
	#_POSIX_V7_LPBIG_OFFBIG
 
__LPBIG_OFFBIG


	)

230 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


231 
	#_V6_ILP32_OFF32
 
__ILP32_OFF32


	)

232 
	#_V6_ILP32_OFFBIG
 
__ILP32_OFFBIG


	)

233 
	#_V6_LP64_OFF64
 
__LP64_OFF64


	)

234 
	#_V6_LPBIG_OFFBIG
 
__LPBIG_OFFBIG


	)

237 #i‡(
__DARWIN_C_LEVEL
 >199506L && __DARWIN_C_LEVEL < 200809LË|| __DARWIN_C_LEVEL >
__DARWIN_C_FULL


239 
	#_XBS5_ILP32_OFF32
 
__ILP32_OFF32


	)

240 
	#_XBS5_ILP32_OFFBIG
 
__ILP32_OFFBIG


	)

241 
	#_XBS5_LP64_OFF64
 
__LP64_OFF64


	)

242 
	#_XBS5_LPBIG_OFFBIG
 
__LPBIG_OFFBIG


	)

245 #i‡
__DARWIN_C_LEVEL
 >= 199506L

246 
	#_XOPEN_CRYPT
 (1)

	)

247 
	#_XOPEN_ENH_I18N
 (1Ë

	)

248 
	#_XOPEN_LEGACY
 (-1Ë

	)

249 
	#_XOPEN_REALTIME
 (-1Ë

	)

250 
	#_XOPEN_REALTIME_THREADS
 (-1Ë

	)

251 
	#_XOPEN_SHM
 (1)

	)

252 
	#_XOPEN_STREAMS
 (-1Ë

	)

253 
	#_XOPEN_UNIX
 (1)

	)

257 
	#_SC_ARG_MAX
 1

	)

258 
	#_SC_CHILD_MAX
 2

	)

259 
	#_SC_CLK_TCK
 3

	)

260 
	#_SC_NGROUPS_MAX
 4

	)

261 
	#_SC_OPEN_MAX
 5

	)

262 
	#_SC_JOB_CONTROL
 6

	)

263 
	#_SC_SAVED_IDS
 7

	)

264 
	#_SC_VERSION
 8

	)

265 
	#_SC_BC_BASE_MAX
 9

	)

266 
	#_SC_BC_DIM_MAX
 10

	)

267 
	#_SC_BC_SCALE_MAX
 11

	)

268 
	#_SC_BC_STRING_MAX
 12

	)

269 
	#_SC_COLL_WEIGHTS_MAX
 13

	)

270 
	#_SC_EXPR_NEST_MAX
 14

	)

271 
	#_SC_LINE_MAX
 15

	)

272 
	#_SC_RE_DUP_MAX
 16

	)

273 
	#_SC_2_VERSION
 17

	)

274 
	#_SC_2_C_BIND
 18

	)

275 
	#_SC_2_C_DEV
 19

	)

276 
	#_SC_2_CHAR_TERM
 20

	)

277 
	#_SC_2_FORT_DEV
 21

	)

278 
	#_SC_2_FORT_RUN
 22

	)

279 
	#_SC_2_LOCALEDEF
 23

	)

280 
	#_SC_2_SW_DEV
 24

	)

281 
	#_SC_2_UPE
 25

	)

282 
	#_SC_STREAM_MAX
 26

	)

283 
	#_SC_TZNAME_MAX
 27

	)

285 #i‡
__DARWIN_C_LEVEL
 >= 199309L

286 
	#_SC_ASYNCHRONOUS_IO
 28

	)

287 
	#_SC_PAGESIZE
 29

	)

288 
	#_SC_MEMLOCK
 30

	)

289 
	#_SC_MEMLOCK_RANGE
 31

	)

290 
	#_SC_MEMORY_PROTECTION
 32

	)

291 
	#_SC_MESSAGE_PASSING
 33

	)

292 
	#_SC_PRIORITIZED_IO
 34

	)

293 
	#_SC_PRIORITY_SCHEDULING
 35

	)

294 
	#_SC_REALTIME_SIGNALS
 36

	)

295 
	#_SC_SEMAPHORES
 37

	)

296 
	#_SC_FSYNC
 38

	)

297 
	#_SC_SHARED_MEMORY_OBJECTS
 39

	)

298 
	#_SC_SYNCHRONIZED_IO
 40

	)

299 
	#_SC_TIMERS
 41

	)

300 
	#_SC_AIO_LISTIO_MAX
 42

	)

301 
	#_SC_AIO_MAX
 43

	)

302 
	#_SC_AIO_PRIO_DELTA_MAX
 44

	)

303 
	#_SC_DELAYTIMER_MAX
 45

	)

304 
	#_SC_MQ_OPEN_MAX
 46

	)

305 
	#_SC_MAPPED_FILES
 47

	)

306 
	#_SC_RTSIG_MAX
 48

	)

307 
	#_SC_SEM_NSEMS_MAX
 49

	)

308 
	#_SC_SEM_VALUE_MAX
 50

	)

309 
	#_SC_SIGQUEUE_MAX
 51

	)

310 
	#_SC_TIMER_MAX
 52

	)

313 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


314 
	#_SC_NPROCESSORS_CONF
 57

	)

315 
	#_SC_NPROCESSORS_ONLN
 58

	)

318 #i‡
__DARWIN_C_LEVEL
 >= 200112L

319 
	#_SC_2_PBS
 59

	)

320 
	#_SC_2_PBS_ACCOUNTING
 60

	)

321 
	#_SC_2_PBS_CHECKPOINT
 61

	)

322 
	#_SC_2_PBS_LOCATE
 62

	)

323 
	#_SC_2_PBS_MESSAGE
 63

	)

324 
	#_SC_2_PBS_TRACK
 64

	)

325 
	#_SC_ADVISORY_INFO
 65

	)

326 
	#_SC_BARRIERS
 66

	)

327 
	#_SC_CLOCK_SELECTION
 67

	)

328 
	#_SC_CPUTIME
 68

	)

329 
	#_SC_FILE_LOCKING
 69

	)

330 
	#_SC_GETGR_R_SIZE_MAX
 70

	)

331 
	#_SC_GETPW_R_SIZE_MAX
 71

	)

332 
	#_SC_HOST_NAME_MAX
 72

	)

333 
	#_SC_LOGIN_NAME_MAX
 73

	)

334 
	#_SC_MONOTONIC_CLOCK
 74

	)

335 
	#_SC_MQ_PRIO_MAX
 75

	)

336 
	#_SC_READER_WRITER_LOCKS
 76

	)

337 
	#_SC_REGEXP
 77

	)

338 
	#_SC_SHELL
 78

	)

339 
	#_SC_SPAWN
 79

	)

340 
	#_SC_SPIN_LOCKS
 80

	)

341 
	#_SC_SPORADIC_SERVER
 81

	)

342 
	#_SC_THREAD_ATTR_STACKADDR
 82

	)

343 
	#_SC_THREAD_ATTR_STACKSIZE
 83

	)

344 
	#_SC_THREAD_CPUTIME
 84

	)

345 
	#_SC_THREAD_DESTRUCTOR_ITERATIONS
 85

	)

346 
	#_SC_THREAD_KEYS_MAX
 86

	)

347 
	#_SC_THREAD_PRIO_INHERIT
 87

	)

348 
	#_SC_THREAD_PRIO_PROTECT
 88

	)

349 
	#_SC_THREAD_PRIORITY_SCHEDULING
 89

	)

350 
	#_SC_THREAD_PROCESS_SHARED
 90

	)

351 
	#_SC_THREAD_SAFE_FUNCTIONS
 91

	)

352 
	#_SC_THREAD_SPORADIC_SERVER
 92

	)

353 
	#_SC_THREAD_STACK_MIN
 93

	)

354 
	#_SC_THREAD_THREADS_MAX
 94

	)

355 
	#_SC_TIMEOUTS
 95

	)

356 
	#_SC_THREADS
 96

	)

357 
	#_SC_TRACE
 97

	)

358 
	#_SC_TRACE_EVENT_FILTER
 98

	)

359 
	#_SC_TRACE_INHERIT
 99

	)

360 
	#_SC_TRACE_LOG
 100

	)

361 
	#_SC_TTY_NAME_MAX
 101

	)

362 
	#_SC_TYPED_MEMORY_OBJECTS
 102

	)

363 
	#_SC_V6_ILP32_OFF32
 103

	)

364 
	#_SC_V6_ILP32_OFFBIG
 104

	)

365 
	#_SC_V6_LP64_OFF64
 105

	)

366 
	#_SC_V6_LPBIG_OFFBIG
 106

	)

367 
	#_SC_IPV6
 118

	)

368 
	#_SC_RAW_SOCKETS
 119

	)

369 
	#_SC_SYMLOOP_MAX
 120

	)

372 #i‡
__DARWIN_C_LEVEL
 >= 199506L

373 
	#_SC_ATEXIT_MAX
 107

	)

374 
	#_SC_IOV_MAX
 56

	)

375 
	#_SC_PAGE_SIZE
 
_SC_PAGESIZE


	)

376 
	#_SC_XOPEN_CRYPT
 108

	)

377 
	#_SC_XOPEN_ENH_I18N
 109

	)

378 
	#_SC_XOPEN_LEGACY
 110

	)

379 
	#_SC_XOPEN_REALTIME
 111

	)

380 
	#_SC_XOPEN_REALTIME_THREADS
 112

	)

381 
	#_SC_XOPEN_SHM
 113

	)

382 
	#_SC_XOPEN_STREAMS
 114

	)

383 
	#_SC_XOPEN_UNIX
 115

	)

384 
	#_SC_XOPEN_VERSION
 116

	)

385 
	#_SC_XOPEN_XCU_VERSION
 121

	)

388 #i‡(
__DARWIN_C_LEVEL
 >199506L && __DARWIN_C_LEVEL < 200809LË|| __DARWIN_C_LEVEL >
__DARWIN_C_FULL


390 
	#_SC_XBS5_ILP32_OFF32
 122

	)

391 
	#_SC_XBS5_ILP32_OFFBIG
 123

	)

392 
	#_SC_XBS5_LP64_OFF64
 124

	)

393 
	#_SC_XBS5_LPBIG_OFFBIG
 125

	)

396 #i‡
__DARWIN_C_LEVEL
 >= 200112L

397 
	#_SC_SS_REPL_MAX
 126

	)

398 
	#_SC_TRACE_EVENT_NAME_MAX
 127

	)

399 
	#_SC_TRACE_NAME_MAX
 128

	)

400 
	#_SC_TRACE_SYS_MAX
 129

	)

401 
	#_SC_TRACE_USER_EVENT_MAX
 130

	)

404 #i‡
__DARWIN_C_LEVEL
 < 200112L || __DARWIN_C_LEVEL >
__DARWIN_C_FULL


406 
	#_SC_PASS_MAX
 131

	)

409 #i‡
__DARWIN_C_LEVEL
 >= 199209L

410 #i‚de‡
_CS_PATH


411 
	#_CS_PATH
 1

	)

415 #i‡
__DARWIN_C_LEVEL
 >= 200112

416 
	#_CS_POSIX_V6_ILP32_OFF32_CFLAGS
 2

	)

417 
	#_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
 3

	)

418 
	#_CS_POSIX_V6_ILP32_OFF32_LIBS
 4

	)

419 
	#_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
 5

	)

420 
	#_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
 6

	)

421 
	#_CS_POSIX_V6_ILP32_OFFBIG_LIBS
 7

	)

422 
	#_CS_POSIX_V6_LP64_OFF64_CFLAGS
 8

	)

423 
	#_CS_POSIX_V6_LP64_OFF64_LDFLAGS
 9

	)

424 
	#_CS_POSIX_V6_LP64_OFF64_LIBS
 10

	)

425 
	#_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
 11

	)

426 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
 12

	)

427 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
 13

	)

428 
	#_CS_POSIX_V6_WIDTH_RESTRICTED_ENVS
 14

	)

431 #i‡(
__DARWIN_C_LEVEL
 >199506L && __DARWIN_C_LEVEL < 200809LË|| __DARWIN_C_LEVEL >
__DARWIN_C_FULL


433 
	#_CS_XBS5_ILP32_OFF32_CFLAGS
 20

	)

434 
	#_CS_XBS5_ILP32_OFF32_LDFLAGS
 21

	)

435 
	#_CS_XBS5_ILP32_OFF32_LIBS
 22

	)

436 
	#_CS_XBS5_ILP32_OFF32_LINTFLAGS
 23

	)

437 
	#_CS_XBS5_ILP32_OFFBIG_CFLAGS
 24

	)

438 
	#_CS_XBS5_ILP32_OFFBIG_LDFLAGS
 25

	)

439 
	#_CS_XBS5_ILP32_OFFBIG_LIBS
 26

	)

440 
	#_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
 27

	)

441 
	#_CS_XBS5_LP64_OFF64_CFLAGS
 28

	)

442 
	#_CS_XBS5_LP64_OFF64_LDFLAGS
 29

	)

443 
	#_CS_XBS5_LP64_OFF64_LIBS
 30

	)

444 
	#_CS_XBS5_LP64_OFF64_LINTFLAGS
 31

	)

445 
	#_CS_XBS5_LPBIG_OFFBIG_CFLAGS
 32

	)

446 
	#_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
 33

	)

447 
	#_CS_XBS5_LPBIG_OFFBIG_LIBS
 34

	)

448 
	#_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
 35

	)

451 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


452 
	#_CS_DARWIN_USER_DIR
 65536

	)

453 
	#_CS_DARWIN_USER_TEMP_DIR
 65537

	)

454 
	#_CS_DARWIN_USER_CACHE_DIR
 65538

	)

458 #ifde‡
_DARWIN_UNLIMITED_GETGROUPS


459 #i‡
deföed
(
__IPHONE_OS_VERSION_MIN_REQUIRED
Ë&& __IPHONE_OS_VERSION_MIN_REQUIRED < 
__IPHONE_3_2


461 #ñi‡
deföed
(
__MAC_OS_X_VERSION_MIN_REQUIRED
Ë&& __MAC_OS_X_VERSION_MIN_REQUIRED < 
__MAC_10_6


468 
__BEGIN_DECLS


469 
	$_exô
(Ë
__dód2
;

470 
	`ac˚ss
(const *, );

472 
	`Æ¨m
();

473 
	`chdú
(const *);

474 
	`chown
(c⁄° *, 
uid_t
, 
gid_t
);

476 
	$˛o£
(Ë
	`__DARWIN_ALIAS_C
(
˛o£
);

478 
	`dup
();

479 
	`dup2
(, );

480 
	`exe˛
(const *, const *, ...);

481 
	`exe˛e
(const *, const *, ...);

482 
	`exe˛p
(const *, const *, ...);

483 
	`execv
(const *, * const *);

484 
	`execve
(const *, * const *, * const *);

485 
	`execvp
(const *, * const *);

486 
pid_t
 
	`f‹k
();

487 
	`Â©hc⁄f
(, );

488 *
	`gëcwd
(*, 
size_t
);

489 
gid_t
 
	`gëegid
();

490 
uid_t
 
	`gëeuid
();

491 
gid_t
 
	`gëgid
();

492 #i‡
	`deföed
(
_DARWIN_UNLIMITED_GETGROUPS
Ë|| deföed(
_DARWIN_C_SOURCE
)

493 
	$gëgroups
(, 
gid_t
 []Ë
	`__DARWIN_ALIAS_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
, 
	`__DARWIN_EXTSN
(
gëgroups
));

495 
	`gëgroups
(, 
gid_t
 []);

497 *
	`gëlogö
();

498 
pid_t
 
	`gëpgΩ
();

499 
pid_t
 
	`gëpid
();

500 
pid_t
 
	`gëµid
();

501 
uid_t
 
	`gëuid
();

502 
	`ißây
();

503 
	`lök
(const *, const *);

504 
off_t
 
	`l£ek
(, off_t, );

505 
	`∑thc⁄f
(const *, );

507 
	$∑u£
(Ë
	`__DARWIN_ALIAS_C
(
∑u£
);

509 
	`pùe
([2]);

511 
ssize_t
 
	$ªad
(, *, 
size_t
Ë
	`__DARWIN_ALIAS_C
(
ªad
);

513 
	`rmdú
(const *);

514 
	`£tgid
(
gid_t
);

515 
	`£çgid
(
pid_t
,Öid_t);

516 
pid_t
 
	`£tsid
();

517 
	`£tuid
(
uid_t
);

520 
	$¶ìp
(Ë
	`__DARWIN_ALIAS_C
(
¶ìp
);

522 
	`sysc⁄f
();

523 
pid_t
 
	`tcgëpgΩ
();

524 
	`tc£çgΩ
(, 
pid_t
);

525 *
	`ây«me
();

527 #i‡
__DARWIN_UNIX03


528 
	$ây«me_r
(, *, 
size_t
Ë
	`__DARWIN_ALIAS
(
ây«me_r
);

530 *
	`ây«me_r
(, *, 
size_t
);

533 
	`u∆ök
(const *);

535 
ssize_t
 
	$wrôe
(, c⁄° *, 
size_t
Ë
	`__DARWIN_ALIAS_C
(
wrôe
);

536 
__END_DECLS


544 #i‡
__DARWIN_C_LEVEL
 >= 199209L

545 
__BEGIN_DECLS


546 
size_t
 
	$c⁄f°r
(, *, 
size_t
Ë
	`__DARWIN_ALIAS
(
c⁄f°r
);

548 
	$gë›t
(, * c⁄° [], c⁄° *Ë
	`__DARWIN_ALIAS
(
gë›t
);

550 *
›èrg
;

551 
›töd
, 
›ãº
, 
›t›t
;

552 
__END_DECLS


563 #i‡
__DARWIN_C_LEVEL
 >= 199506L

565 
	#F_ULOCK
 0

	)

566 
	#F_LOCK
 1

	)

567 
	#F_TLOCK
 2

	)

568 
	#F_TEST
 3

	)

570 
__BEGIN_DECLS


574 #i‡!
	`deföed
(
_POSIX_C_SOURCE
) || _POSIX_C_SOURCE < 200112L

575 *
	`brk
(const *);

576 
	$chroŸ
(c⁄° *Ë
	`__POSIX_C_DEPRECATED
(199506L);

579 *
	`¸y±
(const *, const *);

580 #i‚de‡
__CTERMID_DEFINED


582 
	#__CTERMID_DEFINED
 1

	)

583 *
	`˘îmid
(*);

585 #i‡
__DARWIN_UNIX03


586 
	$í¸y±
(*, Ë
	`__DARWIN_ALIAS
(
í¸y±
);

588 
	`í¸y±
(*, );

590 
	`fchdú
();

591 
	`gëho°id
();

592 
pid_t
 
	`gëpgid
(pid_t);

593 
pid_t
 
	`gësid
(pid_t);

596 #i‡!
	`deföed
(
_POSIX_C_SOURCE
) || _POSIX_C_SOURCE < 200112L

597 
	$gëdèbÀsize
(Ë
	`__POSIX_C_DEPRECATED
(199506L);

598 
	$gë∑gesize
(Ë
__puª2
 
	`__POSIX_C_DEPRECATED
(199506L);

599 *
	$gë∑ss
(c⁄° *Ë
	`__POSIX_C_DEPRECATED
(199506L);

603 #i‡!
	`deföed
(
_POSIX_C_SOURCE
) || _POSIX_C_SOURCE < 200809L

604 *
	$gëwd
(*Ë
	`__POSIX_C_DEPRECATED
(200112L);

607 
	$lchown
(c⁄° *, 
uid_t
, 
gid_t
Ë
	`__DARWIN_ALIAS
(
lchown
);

609 
	$lockf
(, , 
off_t
Ë
	`__DARWIN_ALIAS_C
(
lockf
);

611 
	$ni˚
(Ë
	`__DARWIN_ALIAS
(
ni˚
);

613 
ssize_t
 
	$¥ód
(, *, 
size_t
, 
off_t
Ë
	`__DARWIN_ALIAS_C
(
¥ód
);

615 
ssize_t
 
	$pwrôe
(, c⁄° *, 
size_t
, 
off_t
Ë
	`__DARWIN_ALIAS_C
(
pwrôe
);

618 #i‡!
	`deföed
(
_POSIX_C_SOURCE
) || _POSIX_C_SOURCE < 200112L

621 *
	`sbrk
();

624 #i‡
__DARWIN_UNIX03


625 
pid_t
 
	$£çgΩ
(Ë
	`__DARWIN_ALIAS
(
£çgΩ
);

627 
	`£çgΩ
(
pid_t
 
pid
,Öid_à
pgΩ
);

630 
	$£åegid
(
gid_t
, gid_tË
	`__DARWIN_ALIAS
(
£åegid
);

632 
	$£åeuid
(
uid_t
, uid_tË
	`__DARWIN_ALIAS
(
£åeuid
);

634 
	`swab
(c⁄° * 
__ª°ri˘
, * __ª°ri˘, 
ssize_t
);

635 
	`sync
();

636 
	`åunˇã
(c⁄° *, 
off_t
);

637 
u£c⁄ds_t
 
	`uÆ¨m
(useconds_t, useconds_t);

638 
	$u¶ìp
(
u£c⁄ds_t
Ë
	`__DARWIN_ALIAS_C
(
u¶ìp
);

639 
pid_t
 
	`vf‹k
();

642 
	$fsync
(Ë
	`__DARWIN_ALIAS_C
(
fsync
);

644 
	`·runˇã
(, 
off_t
);

645 
	`gëlogö_r
(*, 
size_t
);

646 
__END_DECLS


656 #i‡
__DARWIN_C_LEVEL
 >= 200112L

657 
__BEGIN_DECLS


658 
	`fchown
(, 
uid_t
, 
gid_t
);

659 
	`gëho°«me
(*, 
size_t
);

660 
ssize_t
 
	`ªadlök
(c⁄° * 
__ª°ri˘
, * __ª°ri˘, 
size_t
);

661 
	`£ãgid
(
gid_t
);

662 
	`£ãuid
(
uid_t
);

663 
	`symlök
(const *, const *);

664 
__END_DECLS


671 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


672 
	~<sys/£À˘.h
>

674 #i‚de‡
_DEV_T


675 
	#_DEV_T


	)

676 
__d¨wö_dev_t
 
	tdev_t
;

679 #i‚de‡
_MODE_T


680 
	#_MODE_T


	)

681 
__d¨wö_mode_t
 
	tmode_t
;

684 #i‚de‡
_UUID_T


685 
	#_UUID_T


	)

686 
__d¨wö_uuid_t
 
	tuuid_t
;

689 
__BEGIN_DECLS


690 
	$_Exô
(Ë
__dód2
;

691 
	`ac˚ssx_≈
(c⁄° 
ac˚ssx_des¸ùt‹
 *, 
size_t
, *, 
uid_t
);

692 
	`ac˘
(const *);

693 
	`add_¥ofû
(*, 
size_t
, , );

694 
	`ídu£rshñl
();

695 
	`execvP
(const *, const *, * const *);

696 *
	`fÊag°o°r
();

697 
	`gëdomaö«me
(*, );

698 
	`gëgrou∂i°
(const *, , *, *);

699 
	$gëho°uuid
(
uuid_t
, c⁄° 
time•ec
 *Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_2_0
);

700 
mode_t
 
	`gëmode
(const *, mode_t);

701 
	`gë≥îeid
(, 
uid_t
 *, 
gid_t
 *);

702 
	`gësgroups_≈
(*, 
uuid_t
);

703 *
	`gëu£rshñl
();

704 
	`gëwgroups_≈
(*, 
uuid_t
);

705 
	`öôgroups
(const *, );

706 
	`úu£rok
(, , const *, const *);

707 
	`úu£rok_ß
(const *, , , const *, const *);

708 
	`is£tugid
();

709 *
	`mkdãmp
(*);

710 
	`mknod
(c⁄° *, 
mode_t
, 
dev_t
);

711 
	`mk°emp
(*);

712 
	`mk°emps
(*, );

713 *
	`mkãmp
(*);

714 
	`nfssvc
(, *);

715 
	`¥ofû
(*, 
size_t
, , );

716 
	`±hªad_£tugid_≈
(
uid_t
, 
gid_t
);

717 
	`±hªad_gëugid_≈
–
uid_t
 *, 
gid_t
 *);

718 
	`rcmd
(**, , const *, const *, const *, *);

719 
	`rcmd_af
(**, , const *, const *, const *, *,

721 
	`ªboŸ
();

722 
	`ªvoke
(const *);

723 
	`ºesvp‹t
(*);

724 
	`ºesvp‹t_af
(*, );

725 
	`ru£rok
(const *, , const *, const *);

726 
	`£tdomaö«me
(const *, );

727 
	`£tgroups
(, c⁄° 
gid_t
 *);

728 
	`£tho°id
();

729 
	`£tho°«me
(const *, );

730 #i‡
__DARWIN_UNIX03


731 
	$£tkey
(c⁄° *Ë
	`__DARWIN_ALIAS
(
£tkey
);

733 
	`£tkey
(const *);

735 
	`£éogö
(const *);

736 *
	$£tmode
(c⁄° *Ë
	`__DARWIN_ALIAS_STARTING
(
__MAC_10_6
, 
__IPHONE_2_0
, 
	`__DARWIN_ALIAS
(
£tmode
));

737 
	`£ågid
(
gid_t
);

738 
	`£åuid
(
uid_t
);

739 
	`£tsgroups_≈
(, c⁄° 
uuid_t
);

740 
	`£tu£rshñl
();

741 
	`£twgroups_≈
(, c⁄° 
uuid_t
);

742 
	`°πofÊags
(**, *, *);

743 
	`sw≠⁄
(const *);

744 
	`sysˇŒ
(, ...);

745 
	`ây¶Ÿ
();

746 
	`undñëe
(const *);

747 
	`unwhôeout
(const *);

748 *
	`vÆloc
(
size_t
);

750 *
sub›èrg
;

751 
	`gësub›t
(**, * const *, **);

754 #ifde‡
__LP64__


755 
	$fgë©åli°
(,*,*,
size_t
,Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_0
);

756 
	$f£èâæi°
(,*,*,
size_t
,Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_0
);

757 
	$gë©åli°
(c⁄° *,*,*,
size_t
,Ë
	`__DARWIN_ALIAS
(
gë©åli°
);

758 
	$£èâæi°
(c⁄° *,*,*,
size_t
,Ë
	`__DARWIN_ALIAS
(
£èâæi°
);

759 
	`exch™ged©a
(const *,const *,);

760 
	`gëdúíåõßâr
(,*,*,
size_t
,*,*,*,);

763 
	$fgë©åli°
(,*,*,
size_t
,Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_0
);

764 
	$f£èâæi°
(,*,*,
size_t
,Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_0
);

765 
	$gë©åli°
(c⁄° *,*,*,
size_t
,Ë
	`__DARWIN_ALIAS
(
gë©åli°
);

766 
	$£èâæi°
(c⁄° *,*,*,
size_t
,Ë
	`__DARWIN_ALIAS
(
£èâæi°
);

767 
	`exch™ged©a
(const *,const *,);

768 
	`gëdúíåõßâr
(,*,*,
size_t
,*,*,*,);

772 
fs£¨chblock
;

773 
£¨ch°©e
;

775 
	`£¨chfs
(c⁄° *, 
fs£¨chblock
 *, *, , , 
£¨ch°©e
 *);

776 
	`fs˘l
(const *,,*,);

777 
	$ffs˘l
(,,*,Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_0
);

779 
›åe£t
;

781 
__END_DECLS


	@memsmodel/mems_disksim.h

39 #i‚de‡
MEMS_DISKSIM_H


40 
	#MEMS_DISKSIM_H


	)

42 
mems_evít_¨rive
 (
i‹eq_evít
 *
cuº
);

43 
mems_bus_dñay_com∂ëe
 (
devno
, 
i‹eq_evít
 *
cuº
, 
£¡bu¢o
);

44 
mems_bus_ow√rshù_gø¡
 (
devno
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
);

46 
mems_˛ón°©s
 ();

47 
mems_gë_ac˘ime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
maxtime
);

48 
mems_gë_avg_£˘≥rcyl
 (
devno
);

49 
mems_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
);

50 
mems_gë_bu¢o
 (
i‹eq_evít
 *
cuº
);

51 
mems_gë_dïth
 (
devno
);

52 
mems_gë_öbus
 (
devno
);

53 
mems_gë_m≠pög
 (
m≠ty≥
, 
devno
, 
blkno
, *
cyÕå
, *
surÁ˚±r
, *
blk±r
);

54 
mems_gë_maxout°™dög
 (
devno
);

55 
mems_gë_numbî_of_blocks
 (
devno
);

56 
mems_gë_numcyls
 (
devno
);

57 
mems_gë_£ektime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
);

58 
mems_gë_£rvtime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
);

59 
mems_gë_¶Ÿno
 (
devno
);

60 
mems_öôülize
 ();

61 
mems_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

62 
mems_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
);

63 
mems_¥öt°©s
 ();

64 
mems_ªad_•ecs
 (
FILE
 *
∑rfûe
, 
devno
, 
c›õs
);

65 
mems_ªad_t›röts
 (
FILE
 *
∑rfûe
);

66 
mems_ª£t°©s
 ();

67 
mems_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
);

68 
mems_gë_di°™˚
 (
devno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
);

78 
devi˚_hódî
 
mems_hdr_öôülizî
;

	@memsmodel/mems_global.h

33 #i‚de‡
_MEMS_GLOBAL_H_


34 
	#_MEMS_GLOBAL_H_


	)

36 
	~"disksim_globÆ.h
"

37 
	~"disksim_iosim.h
"

38 
	~"disksim_°©.h
"

40 
	#MEMS_MAXSLEDS
 9

	)

41 
	#MEMS_SEEKCACHE
 2

	)

43 
	#gëmems
(
d
Ë(
disksim
->
memsöfo
->
devi˚s
[d])

	)

45 
	#MEMS_SLED_INACTIVE
 0

	)

46 
	#MEMS_SLED_IDLE
 1

	)

47 
	#MEMS_SLED_ACTIVE
 2

	)

49 
	#MEMS_SEEK_PIECEWISE
 0

	)

50 
	#MEMS_SEEK_HONG
 1

	)

52 
	sco‹d
 {

53 
	mx_pos
;

54 
	my_pos
;

55 
	my_vñ
;

56 } 
	tco‹d_t
;

58 
	stù£˘‹_co‹d_£t
 {

59 
co‹d_t
 
	m£rvo_°¨t
;

60 
co‹d_t
 
	mtù£˘‹_°¨t
;

61 
co‹d_t
 
	mtù£˘‹_íd
;

62 } 
	ttù£˘‹_co‹d_£t_t
;

64 
	stù£t
 {

65 
	mtù_°¨t
;

66 
	mtù_íd
;

67 
	mnum_tùs
;

68 } 
	ttù£t_t
;

72 
	smems_¥e„tch_öfo
 {

73 
	mfú°block
;

74 
	mœ°block
;

76 
	mcom∂ëed_block
;

77 
	m√xt_block_°¨t
;

78 
	m√xt_block_íd
;

83 
	smems_£ekˇche
 {

84 
	mtime
;

85 
co‹d_t
 
	mbegö
;

86 
co‹d_t
 
	míd
;

87 
	mx_£ek_time
;

88 
	my_£ek_time
;

89 
	mtu∫¨ound_time
;

90 
	mtu∫¨ound_numbî
;

94 
	smems_£gmít
 {

95 
	mtime
;

96 
mems_£gmít
 *
	m√xt
;

97 
mems_£gmít
 *
	m¥ev
;

98 
	m°¨tblkno
;

99 
	mídblkno
;

103 
	smems_°©
 {

104 
°©gí
 
	mªque°_íîgy_uj
;

105 
	mtŸÆ_íîgy_j
;

106 
	m£rvicög_íîgy_j
;

107 
	m°¨tup_íîgy_j
;

108 
	midÀ_íîgy_j
;

109 
	möa˘ive_íîgy_j
;

111 
°©gí
 
	m£ek_time
;

112 
°©gí
 
	mx_£ek_time
;

113 
°©gí
 
	my_£ek_time
;

115 
	mnum_öôül_tu∫¨ounds
;

117 
°©gí
 
	mtu∫¨ound_time
;

118 
°©gí
 
	mtu∫¨ound_numbî
;

120 
	mnum_°ªam_tu∫¨ounds
;

122 
°©gí
 
	m°ªam_tu∫¨ound_time
;

123 
°©gí
 
	m°ªam_tu∫¨ound_numbî
;

125 
°©gí
 
	msubåack_ac˚s£s
;

126 
°©gí
 
	mtùs_≥r_ac˚ss
;

128 
	mnum_•öups
;

129 
	mnum_•ödowns
;

130 
°©gí
 
	möa˘ive_time
;

132 
	mnum_buf„r_ac˚s£s
;

133 
	mnum_buf„r_hôs
;

135 
°©gí
 
	m¥e„tched_blocks
;

136 
°©gí
 
	mb©ch_ª•⁄£_time
;

142 
mems
 *
	mdev
;

144 
	ma˘ive
;

145 
	mnumblocks
;

147 
mems_°©
 
	m°©
;

149 
ioq
 *
	mqueue
;

150 
i‹eq_evít
 *
	ma˘ive_ªque°
;

151 
mems_¥e„tch_öfo
 *
	m¥e„tch_öfo
;

152 
	m¥e„tch_dïth
;

154 
	mœ°ªq_com±ime
;

155 
	möa˘ive_dñay_ms
;

156 
	m°¨tup_time_ms
;

157 
	mœ°ªq_lbn
;

159 
co‹d_t
 
	mpos
;

160 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t
;

161 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_up
;

162 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_dn
;

163 
tù£t
 
	mtù£t
;

165 
	mœyout_pﬁicy
;

166 
	mx_Àngth_nm
;

167 
	my_Àngth_nm
;

169 
	mbô_Àngth_nm
;

170 
	mtù_£˘‹_Àngth_bôs
;

171 
	m£rvo_bur°_Àngth_bôs
;

172 
	mtù_£˘‹s_≥r_lbn
;

174 
	mtùs_ußbÀ
;

175 
	mtùs_simu…™eous
;

176 
	mbidúe˘i⁄Æ_ac˚ss
;

177 
	mx_ac˚l_nm_s2
;

178 
	my_ac˚l_nm_s2
;

180 
	my_ac˚ss_•ìd_bô_s
;

181 
	m¶ed_ªs⁄™t_‰eq_hz
;

182 
	mnum_time_c⁄°™ts
;

183 
	m•rög_Á˘‹
;

188 
mems_£ekˇche
 
	m£ekˇche
[
MEMS_SEEKCACHE
];

189 
	m£ekˇche_√xt
;

191 
	ma˘ive_powî_mw
;

192 
	möa˘ive_powî_mw
;

193 
	mtù_powî_mw
;

194 } 
	tmems_¶ed_t
;

197 
	smems
 {

198 
devi˚_hódî
 
	mhdr
;

199 
	mdevno
;

200 
	möôed
;

202 
mems_°©
 
	m°©
;

204 
	movîhód
;

205 
	mblkå™°ime
;

206 
	m¥öt°©s
;

207 
	mmaxqÀn
;

208 
	mnumblocks
;

210 
	mdïth
[
MAXINBUSES
];

211 
	möbu£s
[
MAXINBUSES
];

212 
	m¶Ÿno
[
MAXINBUSES
];

213 
	mnumöbu£s
;

215 
	mbusow√d
;

216 
i‹eq_evít
 *
	mbuswaô
;

217 
ioq
 *
	mqueue
;

218 
i‹eq_evít
 *
	md©ax„r_ªq
;

219 
i‹eq_evít
 *
	md©ax„r_queue
;

221 
mems_¶ed_t
 *
	m¶ed
;

222 
	mnum_¶eds
;

224 
	mnum£gs
;

225 
	m£gsize
;

226 
mems_£gmít
 *
	m£gli°
;

228 
	m£ek_fun˘i⁄
;

230 
	m¥ecompuã_£ek_cou¡
;

231 *
	m¥ecompuã_£ek_di°™˚s
;

232 *
	m¥ecompuã_x_£ek_times
;

233 *
	m¥ecompuã_y_£ek_times
;

235 } 
	tmems_t
;

238 
	smems_öfo
 {

239 
mems_t
 **
	mdevi˚s
;

240 
	mnumdevi˚s
;

241 
	mdevi˚s_Àn
;

244 
	smems_x
 {

245 
	mfú°block
;

246 
	mœ°block
;

248 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_up
;

249 
tù£˘‹_co‹d_£t_t
 
	mco‹d£t_dn
;

250 
tù£t_t
 
	mtù£t
;

251 
	mfú°block_cylödî
, 
	mfú°block_surÁ˚
, 
	mfú°block_block
;

253 
tù£˘‹_co‹d_£t_t
 
	mœ°block_up_co‹d_£t
;

254 
tù£˘‹_co‹d_£t_t
 
	mœ°block_dn_co‹d_£t
;

255 
tù£t_t
 
	mœ°block_tù£t
;

256 
	mœ°block_cylödî
, 
	mœ°block_surÁ˚
, 
	mœ°block_block
;

258 
	mcom∂ëed_block_medü
;

259 
	mcom∂ëed_block_bus
;

260 
	m√xt_block_°¨t
;

261 
	m√xt_block_íd
;

263 
	mbus_d⁄e
;

264 
	mmedü_d⁄e
;

266 
mems_x
 *
	m√xt
;

267 
mems_x
 *
	m¥ev
;

268 
i‹eq_evít
 *
	mªque°
;

269 } 
	tmems_exã¡_t
;

272 
	mfú°block
;

273 
	mœ°block
;

275 
	mb©ch_¨rivÆ_time
;

277 
mems_exã¡_t
 *
	mexã¡s
;

278 
	mnum_exã¡s
;

280 
mems_exã¡_t
 *
	mbus_exã¡
;

282 
	mbus_≥ndög
;

283 
	mbus_d⁄e
;

284 
	mmedü_d⁄e
;

286 
	mcom∂ëed_block_medü
;

287 
	mcom∂ëed_block_bus
;

288 
	m√xt_block_°¨t
;

289 
	m√xt_block_íd
;

292 
	mªque°_íîgy_uj
;

293 
	mfú°£ek
;

294 
	msubåack_ac˚ss_num
;

295 
	msubåack_ac˚ss_tùs
;

296 } 
	tmems_ªqöfo_t
;

298 
mems
* 
memsmodñ_mems_lﬂd∑øms
(
Õ_block
* 
b
, * 
num±r
);

	@memsmodel/modules/modules.h

2 #i‚de‡
_MEMSMODEL_MODULES_H


3 
	#_MEMSMODEL_MODULES_H


	)

6 
	~"memsmodñ_mems_∑øm.h
"

9 
Õ_mod
 *
	gmemsmodñ_mods
[] = {

10 &
memsmodñ_mems_mod


14 
	mMEMSMODEL_MOD_MEMS


15 } 
	tmemsmodñ_mod_t
;

17 
	#MEMSMODEL_MAX_MODULE
 0

	)

	@ssdmodel/ssd.h

4 
	~"disksim_globÆ.h
"

5 
	~"disksim_iosim.h
"

6 
	~"disksim_°©.h
"

7 
	~"disksim_ioqueue.h
"

8 
	~"disksim_bus.h
"

9 
	~"c⁄fig.h
"

11 #i‚de‡
DISKSIM_SSD_H


12 
	#DISKSIM_SSD_H


	)

14 
ssd
 *
gëssd
 (
devno
);

17 
devi˚_hódî
 
ssd_hdr_öôülizî
;

21 
	#SSD_MAX_ELEMENTS
 64

	)

22 
	#SSD_MAX_PLANES_PER_ELEM
 16

	)

23 
	#SSD_MAX_PARUNITS_PER_ELEM
 
SSD_MAX_PLANES_PER_ELEM


	)

24 
	#SSD_MAX_ELEMS_PER_GANG
 
SSD_MAX_ELEMENTS


25 
	#SSD_BITS_ELEMS_PER_GANG
 8

	)

29 
°©gí
 
	mac˘ime°©s
;

30 
	mªque°edbus
;

31 
	mwaôögf‹bus
;

32 
	mnumbuswaôs
;

33 } 
	tssd_°©_t
;

38 
	s_ssd_ñemít_°©
 {

39 
	mnum_˛ón
;

40 
	m∑ges_moved
;

41 
	mtŸ_x„r_co°
;

42 
	mavg_li„time
;

43 
	mtŸ_ªqs_issued
;

44 
	mtŸ_time_èkí
;

45 
	mtŸ_˛ón_time
;

46 } 
	tssd_ñemít_°©
;

52 
	mSSD_BLOCK_CLEAN
,

53 
	mSSD_BLOCK_INUSE
,

54 
	mSSD_BLOCK_SEALED


55 } 
	tSSD_BLOCK_STATES
;

66 
	s_block_mëad©a
 {

67 
	mblock_num
;

68 
	m∂™e_num
;

70 *
	m∑ge
;

74 
	mnum_vÆid
;

78 
	mªm_li„time
;

84 
	mtime_of_œ°_îasuª
;

86 
	m°©e
;

93 
	mb¢
;

94 } 
	tblock_mëad©a
;

100 
	s_∂™e_mëad©a
 {

102 
	m‰ì_blocks
;

104 
	mvÆid_∑ges
;

107 
	ma˘ive_∑ge
;

110 
	m˛ón_ö_¥ogªss
;

112 
	m˛ón_ö_block
;

113 
	mblock_Æloc_pos
;

114 
	m∑runô_num
;

115 
	mnum_˛óns
;

116 } 
	t∂™e_mëad©a
;

118 
	s_∑runô
 {

119 
	m∂™e_to_˛ón
;

120 } 
	t∑runô
;

126 
	s_ssd_ñemít_mëad©a
 {

127 *
	mlba_èbÀ
;

130 *
	m‰ì_blocks
;

135 
	mtŸ_‰ì_blocks
;

139 
	ma˘ive_∑ge
;

142 
∂™e_mëad©a
 
	m∂™e_mëa
[
SSD_MAX_PLANES_PER_ELEM
];

144 
block_mëad©a
 *
	mblock_ußge
;

148 
	mb¢
;

150 
	m∂™e_to_˛ón
;

151 
	m∂™e_to_wrôe
;

152 
	mblock_Æloc_pos
;

154 
∑runô
 
	m∑runôs
[
SSD_MAX_PARUNITS_PER_ELEM
];

156 
	mg™g_num
;

157 
	mªqs_waôög
;

158 
	mtŸ_migøti⁄s
;

159 
	mtŸ_pgs_migøãd
;

160 
	mmig_co°
;

161 } 
	tssd_ñemít_mëad©a
;

167 
	s_ssd_∂™e
 {

171 
	mmedü_busy
;

172 
	m∑ú_∂™e
;

174 
	mnum_blocks
;

175 } 
	tssd_∂™e
;

185 
	s_ssd_ñemít
 {

186 
ioq
 *
	mqueue
;

187 
	mmedü_busy
;

188 
ssd_ñemít_mëad©a
 
	mmëad©a
;

189 
ssd_ñemít_°©
 
	m°©
;

191 
	mpö_busy
;

192 
	mnum_∂™es
;

193 
ssd_∂™e
 
	m∂™e
[
SSD_MAX_PLANES_PER_ELEM
];

194 } 
	tssd_ñemít
;

196 
	s_ssd_ñem_numbî
 {

197 
	me
:
SSD_BITS_ELEMS_PER_GANG
;

198 } 
	tssd_ñem_numbî
;

200 
	s_g™g_mëad©a
 {

201 
ioq
 *
	mqueue
;

202 
	m˛ónög
;

203 
	mbusy
;

204 
	mªqs_waôög
;

205 
	mﬁde°
;

206 
	mñem_‰ì_∑ges
[
SSD_MAX_ELEMENTS
];

207 
ssd_ñem_numbî
 *
	mpg2ñem
;

208 } 
	tg™g_mëad©a
;

211 
	#SSD_SIMPLE_MODEL
 1

	)

212 
	#SSD_SIMPLE_DW_MODEL
 2

	)

213 
	#SSD_LOGDISK_MODEL
 3

	)

216 
	#DISKSIM_SSD_MAX_WRITE_POLICIES
 2

	)

217 
	#DISKSIM_SSD_WRITE_POLICY_SIMPLE
 1

	)

218 
	#DISKSIM_SSD_WRITE_POLICY_OSR
 2

	)

222 
	#DISKSIM_SSD_MAX_RESERVE
 50

	)

225 
	#SSD_DATA_BYTES_PER_SECTOR
 512

	)

226 
	#SSD_MDATA_BYTES_PER_SECTOR
 16

	)

227 
	#SSD_BYTES_PER_SECTOR
 (
SSD_DATA_BYTES_PER_SECTOR
 + 
SSD_MDATA_BYTES_PER_SECTOR
)

	)

230 
	#SSD_SECTORS_PER_SUMMARY_PAGE
 1

	)

243 
	#PLANE_BLOCKS_CONCAT
 1

	)

258 
	#PLANE_BLOCKS_PAIRWISE_STRIPE
 2

	)

270 
	#PLANE_BLOCKS_FULL_STRIPE
 3

	)

274 
	#SSD_COPY_BACK_DISABLE
 0

	)

275 
	#SSD_COPY_BACK_ENABLE
 1

	)

278 
	#SSD_ALLOC_POOL_GANG
 0

	)

279 
	#SSD_ALLOC_POOL_CHIP
 1

280 
	#SSD_ALLOC_POOL_PLANE
 2

	)

283 
	#SSD_SHARED_BUS_GANG
 1

284 
	#SSD_SHARED_CONTROL_GANG
 2

285 

	)

286 
	s_ssd_timög_∑øms
 {

287 
	mssd_modñ
;

288 
	m√Àmíts
;

289 
	m∑ge_size
;

290 
	m∑ges_≥r_block
;

291 
	mblocks_≥r_ñemít
;

292 
	mñemít_°ride_∑ges
;

296 
	mchù_x„r_œãncy
;

297 
	m∑ge_ªad_œãncy
;

298 
	m∑ge_wrôe_œãncy
;

299 
	mblock_îa£_œãncy
;

301 
	mwrôe_pﬁicy
;

305 
	mª£rve_blocks
;

307 
	mmö_‰ìblks_≥r˚¡
;

309 
	m˛ónög_pﬁicy
;

312 
	m∂™es_≥r_pkg
;

314 
	mblocks_≥r_∂™e
;

316 
	m∂™e_block_m≠pög
;

318 
	mc›y_back
;

320 
	mnum_∑runôs
;

322 
	mñemíts_≥r_g™g
;

324 
	mg™g_sh¨e
;

326 
	m˛ónög_ö_background
;

328 
	mÆloc_poﬁ_logic
;

329 } 
	tssd_timög_∑øms
;

331 
	g_ssd_timög_t
;

334 
	sssd
 {

335 
devi˚_hódî
 
	mhdr
;

336 
ssd_timög_∑øms
 
	m∑øms
;

337 
_ssd_timög_t
 *
	mtimög_t
;

339 
	movîhód
;

340 
	mbus_å™ß˘i⁄_œãncy
;

341 
	mnumblocks
;

342 
	mdevno
;

343 
	möôed
;

344 
	mªc⁄√˘_ªas⁄
;

346 
i‹eq_evít
 *
	mch™√l_a˘ivôy
;

347 
i‹eq_evít
 *
	mcom∂ëi⁄_queue
;

348 
ioq
 *
	mqueue
;

350 
ssd_ñemít
 
	mñemíts
[
SSD_MAX_ELEMENTS
];

353 
	md©a_∑ges_≥r_ñem
;

354 
g™g_mëad©a
 
	mg™g_mëa
[
SSD_MAX_ELEMENTS
];

356 
	mblkå™°ime
;

357 
	mmaxqÀn
;

358 
	mbusow√d
;

359 
i‹eq_evít
 *
	mbuswaô
;

360 
	m√vîdisc⁄√˘
;

361 
	mnumöbu£s
;

362 
	möbu£s
[
MAXINBUSES
];

363 
	mdïth
[
MAXINBUSES
];

364 
	m¶Ÿno
[
MAXINBUSES
];

366 
	m¥öt°©s
;

367 
ssd_°©_t
 
	m°©
;

368 } 
	tssd_t
;

370 
	sssd_öfo
 {

371 
ssd
 **
	mssds
;

372 
	mnumssds
;

373 
	mssds_Àn
;

374 } 
	tssdöfo_t
;

377 
	s_ssd_ªq
 {

378 
	mblk
;

379 
	mcou¡
;

380 
	mis_ªad
;

381 
	m∂™e_num
;

382 
i‹eq_evít
 *
	m‹g_ªq
;

383 
	mac˘ime
;

384 
	mschtime
;

385 
	mö˛ude
;

387 } 
	tssd_ªq
;

390 
	#SSD_PAGE_TO_BLOCK
(
≤um
, 
s
Ë(’num)/(s->
∑øms
.
∑ges_≥r_block
))

	)

391 
	#SSD_PAGES_PER_ELEM
(
s
Ë((s)->
∑øms
.
blocks_≥r_ñemít
 * (s)->∑øms.
∑ges_≥r_block
)

	)

392 
	#ADDRESSABLE_PAGES_PER_ELEM
(
s
Ë((s)->
d©a_∑ges_≥r_ñem
)

	)

393 
	#SSD_PLANES_PER_ELEM
(
s
Ë((s)->
∑øms
.
∂™es_≥r_pkg
)

	)

394 
	#SSD_PARUNITS_PER_ELEM
(
s
Ë((s)->
∑øms
.
num_∑runôs
)

	)

395 
	#SSD_PLANES_PER_PARUNIT
(
s
Ë(
	`SSD_PLANES_PER_ELEM
(s)/
	`SSD_PARUNITS_PER_ELEM
(s))

	)

396 
	#SSD_DATA_PAGES_PER_BLOCK
(
s
Ë((s)->
∑øms
.
∑ges_≥r_block
 - 1)

	)

397 
	#SSD_GANG_PAGE_SIZE
(
s
Ë((s)->
∑øms
.
ñemíts_≥r_g™g
 * (s)->∑øms.
∑ge_size
)

	)

398 
	#numssds
 (
disksim
->
ssdöfo
->
numssds
)

	)

400 
	#ALLOC_UNIT_GANG
 1

	)

401 
	#ALLOC_UNIT_ELEM
 2

	)

402 
	#SSD_NUM_GANG
(
s
Ë((s)->
∑øms
.
√Àmíts
 / (s)->∑øms.
ñemíts_≥r_g™g
)

	)

403 
	#SSD_GANG_SIZE
(
s
Ë(
	`ADDRESSABLE_PAGES_PER_ELEM
(sË* (s)->
∑øms
.
ñemíts_≥r_g™g
)

	)

404 
	#MIN_REQS
 99999999

	)

405 
	#MAX_REQS
 100

	)

406 
	#MAX_REQS_ELEM_QUEUE
 100

	)

407 
	#SYNC_GANG
 1

	)

408 
	#MIGRATE
 1

	)

411 
ssd_ªad_t›röts
 (
FILE
 *
∑rfûe
);

412 
ssd_ªad_•ecs
 (
FILE
 *
∑rfûe
, 
devno
, 
c›õs
);

413 
ssd_£t_sync£t
 (
£t°¨t
, 
£ãnd
);

414 
ssd_∑øm_ovîride
 (*
∑øm«me
, *
∑ømvÆ
, 
fú°
, 
œ°
);

415 
ssd_£tˇŒbacks
 ();

416 
ssd_öôülize
 ();

417 
ssd_ª£t°©s
 ();

418 
ssd_¥öt°©s
 ();

419 
ssd_¥öt£t°©s
 (*
£t
, 
£tsize
, *
sour˚°r
);

420 
ssd_˛ón°©s
 ();

421 
ssd_£t_dïth
 (
devno
, 
öbu¢o
, 
dïth
, 
¶Ÿno
);

422 
ssd_gë_dïth
 (
devno
);

423 
ssd_gë_öbus
 (
devno
);

424 
ssd_gë_bu¢o
 (
i‹eq_evít
 *
cuº
);

425 
ssd_gë_¶Ÿno
 (
devno
);

426 
ssd_gë_numbî_of_blocks
 (
devno
);

427 
ssd_gë_maxout°™dög
 (
devno
);

428 
ssd_gë_numdisks
 ();

429 
ssd_gë_numcyls
 (
devno
);

430 
ssd_gë_blkå™°ime
 (
i‹eq_evít
 *
cuº
);

431 
ssd_gë_avg_£˘≥rcyl
 (
devno
);

432 
ssd_gë_m≠pög
 (
m≠ty≥
, 
devno
, 
blkno
, *
cyÕå
, *
surÁ˚±r
, *
blk±r
);

433 
ssd_evít_¨rive
 (
i‹eq_evít
 *
cuº
);

434 
ssd_gë_di°™˚
 (
devno
, 
i‹eq_evít
 *
ªq
, 
exa˘
, 
dúe˘i⁄
);

435 
ssd_gë_£rvtime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
checkˇche
, 
maxtime
);

436 
ssd_gë_ac˘ime
 (
devno
, 
i‹eq_evít
 *
ªq
, 
maxtime
);

437 
ssd_bus_dñay_com∂ëe
 (
devno
, 
i‹eq_evít
 *
cuº
, 
£¡bu¢o
);

438 
ssd_bus_ow√rshù_gø¡
 (
devno
, 
i‹eq_evít
 *
cuº
, 
bu¢o
, 
¨bdñay
);

440 
ssd_as£π_‰ì_blocks
(
ssd_t
 *
s
, 
ssd_ñemít_mëad©a
 *
mëad©a
);

441 
ssd_as£π_vÆid_∑ges
(
∂™e_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

442 
ssd_d©a_å™s„r_co°
(
ssd_t
 *
s
, 
£˘‹s_cou¡
);

443 
ssd_œ°_∑ge_ö_block
(
∑ge_num
, 
ssd_t
 *
s
);

444 
_ssd_wrôe_∑ge_o§
(
ssd_t
 *
s
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
Õn
);

445 
ssd_logiˇl_∑gío
(
blkno
, 
ssd_t
 *
s
);

446 
ssd_block_to_bôpos
(
ssd_t
 *
cuºdisk
, 
block
);

447 
ssd_bôpos_to_block
(
bôpos
, 
ssd_t
 *
s
);

448 
_ssd_Æloc_a˘ive_block
(
∂™e_num
, 
ñem_num
, 
ssd_t
 *
s
);

449 
ssd_‰ì_bôs
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

450 
ssd_as£π_∂™e_‰ìbôs
(
∂™e_num
, 
ñem_num
, 
ssd_ñemít_mëad©a
 *
mëad©a
, 
ssd_t
 *
s
);

451 
ssd_ªad_pﬁicy_sim∂e
(
cou¡
, 
ssd_t
 *
s
);

452 
ssd_com∂ëe_∑ª¡
(
i‹eq_evít
 *
cuº
, 
ssd_t
 *
cuºdisk
);

453 
_ssd_övoke_ñemít_˛ónög
(
ñem_num
, 
ssd_t
 *
s
);

454 
ssd_Æªady_¥e£¡
(
ssd_ªq
 **
ªqs
, 
tŸÆ
, 
i‹eq_evít
 *
ªq
);

	@/usr/include/Availability.h

24 #i‚de‡
__AVAILABILITY__


25 
	#__AVAILABILITY__


	)

119 
	#__MAC_10_0
 1000

	)

120 
	#__MAC_10_1
 1010

	)

121 
	#__MAC_10_2
 1020

	)

122 
	#__MAC_10_3
 1030

	)

123 
	#__MAC_10_4
 1040

	)

124 
	#__MAC_10_5
 1050

	)

125 
	#__MAC_10_6
 1060

	)

126 
	#__MAC_10_7
 1070

	)

127 
	#__MAC_NA
 9999

	)

129 
	#__IPHONE_2_0
 20000

	)

130 
	#__IPHONE_2_1
 20100

	)

131 
	#__IPHONE_2_2
 20200

	)

132 
	#__IPHONE_3_0
 30000

	)

133 
	#__IPHONE_3_1
 30100

	)

134 
	#__IPHONE_3_2
 30200

	)

135 
	#__IPHONE_4_0
 40000

	)

136 
	#__IPHONE_4_1
 40100

	)

137 
	#__IPHONE_4_2
 40200

	)

138 
	#__IPHONE_4_3
 40300

	)

139 
	#__IPHONE_NA
 99999

	)

141 
	~<AvaûabûôyI¡î«l.h
>

144 #ifde‡
__IPHONE_OS_VERSION_MIN_REQUIRED


145 
	#__OSX_AVAILABLE_STARTING
(
_mac
, 
_ùh⁄e
Ë
__AVAILABILITY_INTERNAL
##
	)
_iphone

146 
	#__OSX_AVAILABLE_BUT_DEPRECATED
(
_macI¡ro
, 
_macDï
, 
_ùh⁄eI¡ro
, 
_ùh⁄eDï
) \

147 
__AVAILABILITY_INTERNAL
##
_ùh⁄eI¡ro
##
_DEP
##
_ùh⁄eDï


	)

149 #ñi‡
deföed
(
__MAC_OS_X_VERSION_MIN_REQUIRED
)

150 
	#__OSX_AVAILABLE_STARTING
(
_mac
, 
_ùh⁄e
Ë
__AVAILABILITY_INTERNAL
##
	)
_mac

151 
	#__OSX_AVAILABLE_BUT_DEPRECATED
(
_macI¡ro
, 
_macDï
, 
_ùh⁄eI¡ro
, 
_ùh⁄eDï
) \

152 
__AVAILABILITY_INTERNAL
##
_macI¡ro
##
_DEP
##
_macDï


	)

155 
	#__OSX_AVAILABLE_STARTING
(
_mac
, 
_ùh⁄e
)

	)

156 
	#__OSX_AVAILABLE_BUT_DEPRECATED
(
_macI¡ro
, 
_macDï
, 
_ùh⁄eI¡ro
, 
_ùh⁄eDï
)

	)

	@/usr/include/TargetConditionals.h

35 #i‚de‡
__TARGETCONDITIONALS__


36 
	#__TARGETCONDITIONALS__


	)

87 #i‡
deföed
(
__GNUC__
Ë&& ( deföed(
__APPLE_CPP__
Ë|| deföed(
__APPLE_CC__
Ë|| deföed(
__MACOS_CLASSIC__
) )

88 
	#TARGET_OS_MAC
 1

	)

89 
	#TARGET_OS_WIN32
 0

	)

90 
	#TARGET_OS_UNIX
 0

	)

91 
	#TARGET_OS_EMBEDDED
 0

	)

92 
	#TARGET_OS_IPHONE
 0

	)

93 
	#TARGET_IPHONE_SIMULATOR
 0

	)

94 #i‡
deföed
(
__µc__
)

95 
	#TARGET_CPU_PPC
 1

	)

96 
	#TARGET_CPU_PPC64
 0

	)

97 
	#TARGET_CPU_68K
 0

	)

98 
	#TARGET_CPU_X86
 0

	)

99 
	#TARGET_CPU_X86_64
 0

	)

100 
	#TARGET_CPU_ARM
 0

	)

101 
	#TARGET_CPU_MIPS
 0

	)

102 
	#TARGET_CPU_SPARC
 0

	)

103 
	#TARGET_CPU_ALPHA
 0

	)

104 
	#TARGET_RT_LITTLE_ENDIAN
 0

	)

105 
	#TARGET_RT_BIG_ENDIAN
 1

	)

106 
	#TARGET_RT_64_BIT
 0

	)

107 #ifde‡
__MACOS_CLASSIC__


108 
	#TARGET_RT_MAC_CFM
 1

	)

109 
	#TARGET_RT_MAC_MACHO
 0

	)

111 
	#TARGET_RT_MAC_CFM
 0

	)

112 
	#TARGET_RT_MAC_MACHO
 1

	)

114 #ñi‡
deföed
(
__µc64__
)

115 
	#TARGET_CPU_PPC
 0

	)

116 
	#TARGET_CPU_PPC64
 1

	)

117 
	#TARGET_CPU_68K
 0

	)

118 
	#TARGET_CPU_X86
 0

	)

119 
	#TARGET_CPU_X86_64
 0

	)

120 
	#TARGET_CPU_ARM
 0

	)

121 
	#TARGET_CPU_MIPS
 0

	)

122 
	#TARGET_CPU_SPARC
 0

	)

123 
	#TARGET_CPU_ALPHA
 0

	)

124 
	#TARGET_RT_LITTLE_ENDIAN
 0

	)

125 
	#TARGET_RT_BIG_ENDIAN
 1

	)

126 
	#TARGET_RT_64_BIT
 1

	)

127 
	#TARGET_RT_MAC_CFM
 0

	)

128 
	#TARGET_RT_MAC_MACHO
 1

	)

129 #ñi‡
deföed
(
__i386__
)

130 
	#TARGET_CPU_PPC
 0

	)

131 
	#TARGET_CPU_PPC64
 0

	)

132 
	#TARGET_CPU_68K
 0

	)

133 
	#TARGET_CPU_X86
 1

	)

134 
	#TARGET_CPU_X86_64
 0

	)

135 
	#TARGET_CPU_ARM
 0

	)

136 
	#TARGET_CPU_MIPS
 0

	)

137 
	#TARGET_CPU_SPARC
 0

	)

138 
	#TARGET_CPU_ALPHA
 0

	)

139 
	#TARGET_RT_MAC_CFM
 0

	)

140 
	#TARGET_RT_MAC_MACHO
 1

	)

141 
	#TARGET_RT_LITTLE_ENDIAN
 1

	)

142 
	#TARGET_RT_BIG_ENDIAN
 0

	)

143 
	#TARGET_RT_64_BIT
 0

	)

144 #ñi‡
deföed
(
__x86_64__
)

145 
	#TARGET_CPU_PPC
 0

	)

146 
	#TARGET_CPU_PPC64
 0

	)

147 
	#TARGET_CPU_68K
 0

	)

148 
	#TARGET_CPU_X86
 0

	)

149 
	#TARGET_CPU_X86_64
 1

	)

150 
	#TARGET_CPU_ARM
 0

	)

151 
	#TARGET_CPU_MIPS
 0

	)

152 
	#TARGET_CPU_SPARC
 0

	)

153 
	#TARGET_CPU_ALPHA
 0

	)

154 
	#TARGET_RT_MAC_CFM
 0

	)

155 
	#TARGET_RT_MAC_MACHO
 1

	)

156 
	#TARGET_RT_LITTLE_ENDIAN
 1

	)

157 
	#TARGET_RT_BIG_ENDIAN
 0

	)

158 
	#TARGET_RT_64_BIT
 1

	)

159 #ñi‡
deföed
(
__¨m__
)

160 
	#TARGET_CPU_PPC
 0

	)

161 
	#TARGET_CPU_PPC64
 0

	)

162 
	#TARGET_CPU_68K
 0

	)

163 
	#TARGET_CPU_X86
 0

	)

164 
	#TARGET_CPU_X86_64
 0

	)

165 
	#TARGET_CPU_ARM
 1

	)

166 
	#TARGET_CPU_MIPS
 0

	)

167 
	#TARGET_CPU_SPARC
 0

	)

168 
	#TARGET_CPU_ALPHA
 0

	)

169 
	#TARGET_RT_MAC_CFM
 0

	)

170 
	#TARGET_RT_MAC_MACHO
 1

	)

171 
	#TARGET_RT_LITTLE_ENDIAN
 1

	)

172 
	#TARGET_RT_BIG_ENDIAN
 0

	)

173 
	#TARGET_RT_64_BIT
 0

	)

175 #îr‹ 
uƒecognized
 
GNU
 
C
 
compûî


182 #ñi‡
deföed
(
__MWERKS__
)

183 
	#TARGET_OS_MAC
 1

	)

184 
	#TARGET_OS_WIN32
 0

	)

185 
	#TARGET_OS_UNIX
 0

	)

186 
	#TARGET_OS_EMBEDDED
 0

	)

187 #i‡
deföed
(
__POWERPC__
)

188 
	#TARGET_CPU_PPC
 1

	)

189 
	#TARGET_CPU_PPC64
 0

	)

190 
	#TARGET_CPU_68K
 0

	)

191 
	#TARGET_CPU_X86
 0

	)

192 
	#TARGET_CPU_MIPS
 0

	)

193 
	#TARGET_CPU_SPARC
 0

	)

194 
	#TARGET_CPU_ALPHA
 0

	)

195 
	#TARGET_RT_LITTLE_ENDIAN
 0

	)

196 
	#TARGET_RT_BIG_ENDIAN
 1

	)

197 #ñi‡
deföed
(
__INTEL__
)

198 
	#TARGET_CPU_PPC
 0

	)

199 
	#TARGET_CPU_PPC64
 0

	)

200 
	#TARGET_CPU_68K
 0

	)

201 
	#TARGET_CPU_X86
 1

	)

202 
	#TARGET_CPU_MIPS
 0

	)

203 
	#TARGET_CPU_SPARC
 0

	)

204 
	#TARGET_CPU_ALPHA
 0

	)

205 
	#TARGET_RT_LITTLE_ENDIAN
 1

	)

206 
	#TARGET_RT_BIG_ENDIAN
 0

	)

208 #îr‹ 
unknown
 
Mërowîks
 
CPU
 
ty≥


210 
	#TARGET_RT_64_BIT
 0

	)

211 #ifde‡
__MACH__


212 
	#TARGET_RT_MAC_CFM
 0

	)

213 
	#TARGET_RT_MAC_MACHO
 1

	)

215 
	#TARGET_RT_MAC_CFM
 1

	)

216 
	#TARGET_RT_MAC_MACHO
 0

	)

223 #i‡
deföed
(
TARGET_CPU_PPC
) && TARGET_CPU_PPC

224 
	#TARGET_CPU_PPC64
 0

	)

225 
	#TARGET_CPU_68K
 0

	)

226 
	#TARGET_CPU_X86
 0

	)

227 
	#TARGET_CPU_X86_64
 0

	)

228 
	#TARGET_CPU_ARM
 0

	)

229 
	#TARGET_CPU_MIPS
 0

	)

230 
	#TARGET_CPU_SPARC
 0

	)

231 
	#TARGET_CPU_ALPHA
 0

	)

232 #ñi‡
deföed
(
TARGET_CPU_PPC64
) && TARGET_CPU_PPC64

233 
	#TARGET_CPU_PPC
 0

	)

234 
	#TARGET_CPU_68K
 0

	)

235 
	#TARGET_CPU_X86
 0

	)

236 
	#TARGET_CPU_X86_64
 0

	)

237 
	#TARGET_CPU_ARM
 0

	)

238 
	#TARGET_CPU_MIPS
 0

	)

239 
	#TARGET_CPU_SPARC
 0

	)

240 
	#TARGET_CPU_ALPHA
 0

	)

241 #ñi‡
deföed
(
TARGET_CPU_X86
) && TARGET_CPU_X86

242 
	#TARGET_CPU_PPC
 0

	)

243 
	#TARGET_CPU_PPC64
 0

	)

244 
	#TARGET_CPU_X86_64
 0

	)

245 
	#TARGET_CPU_68K
 0

	)

246 
	#TARGET_CPU_ARM
 0

	)

247 
	#TARGET_CPU_MIPS
 0

	)

248 
	#TARGET_CPU_SPARC
 0

	)

249 
	#TARGET_CPU_ALPHA
 0

	)

250 #ñi‡
deföed
(
TARGET_CPU_X86_64
) && TARGET_CPU_X86_64

251 
	#TARGET_CPU_PPC
 0

	)

252 
	#TARGET_CPU_PPC64
 0

	)

253 
	#TARGET_CPU_X86
 0

	)

254 
	#TARGET_CPU_68K
 0

	)

255 
	#TARGET_CPU_ARM
 0

	)

256 
	#TARGET_CPU_MIPS
 0

	)

257 
	#TARGET_CPU_SPARC
 0

	)

258 
	#TARGET_CPU_ALPHA
 0

	)

259 #ñi‡
deföed
(
TARGET_CPU_ARM
) && TARGET_CPU_ARM

260 
	#TARGET_CPU_PPC
 0

	)

261 
	#TARGET_CPU_PPC64
 0

	)

262 
	#TARGET_CPU_X86
 0

	)

263 
	#TARGET_CPU_X86_64
 0

	)

264 
	#TARGET_CPU_68K
 0

	)

265 
	#TARGET_CPU_MIPS
 0

	)

266 
	#TARGET_CPU_SPARC
 0

	)

267 
	#TARGET_CPU_ALPHA
 0

	)

284 #îr‹ 
T¨gëC⁄dôi⁄Æs
.
h
: 
unknown
 
compûî
 (
£e
 
commít
 
above
)

285 
	#TARGET_CPU_PPC
 0

	)

286 
	#TARGET_CPU_68K
 0

	)

287 
	#TARGET_CPU_X86
 0

	)

288 
	#TARGET_CPU_ARM
 0

	)

289 
	#TARGET_CPU_MIPS
 0

	)

290 
	#TARGET_CPU_SPARC
 0

	)

291 
	#TARGET_CPU_ALPHA
 0

	)

293 
	#TARGET_OS_MAC
 1

	)

294 
	#TARGET_OS_WIN32
 0

	)

295 
	#TARGET_OS_UNIX
 0

	)

296 
	#TARGET_OS_EMBEDDED
 0

	)

297 #i‡
TARGET_CPU_PPC
 || 
TARGET_CPU_PPC64


298 
	#TARGET_RT_BIG_ENDIAN
 1

	)

299 
	#TARGET_RT_LITTLE_ENDIAN
 0

	)

301 
	#TARGET_RT_BIG_ENDIAN
 0

	)

302 
	#TARGET_RT_LITTLE_ENDIAN
 1

	)

304 #i‡
TARGET_CPU_PPC64
 || 
TARGET_CPU_X86_64


305 
	#TARGET_RT_64_BIT
 1

	)

307 
	#TARGET_RT_64_BIT
 0

	)

309 #ifde‡
__MACH__


310 
	#TARGET_RT_MAC_MACHO
 1

	)

311 
	#TARGET_RT_MAC_CFM
 0

	)

313 
	#TARGET_RT_MAC_MACHO
 0

	)

314 
	#TARGET_RT_MAC_CFM
 1

	)

	@/usr/include/_structs.h

24 
	~<sys/_°ru˘s.h
>

	@/usr/include/_types.h

24 #i‚de‡
__TYPES_H_


25 
	#__TYPES_H_


	)

27 
	~<sys/_ty≥s.h
>

29 #i‡
__GNUC__
 > 2 || __GNUC__ =2 && 
__GNUC_MINOR__
 >= 7

30 
	#__°rfm⁄like
(
fmèrg
, 
fú°v¨¨g
) \

31 
	`__©åibuã__
((
	`__f‹m©__
 (
__°rfm⁄__
, 
fmèrg
, 
fú°v¨¨g
)))

	)

32 
	#__°r·imñike
(
fmèrg
) \

33 
	`__©åibuã__
((
	`__f‹m©__
 (
__°r·ime__
, 
fmèrg
, 0)))

	)

35 
	#__°rfm⁄like
(
fmèrg
, 
fú°v¨¨g
)

	)

36 
	#__°r·imñike
(
fmèrg
)

	)

39 
	t__d¨wö_∆_ôem
;

40 
	t__d¨wö_w˘øns_t
;

41 #ifde‡
__LP64__


42 
__uöt32_t
 
	t__d¨wö_w˘y≥_t
;

44 
	t__d¨wö_w˘y≥_t
;

47 #ifde‡
__WCHAR_MAX__


48 
	#__DARWIN_WCHAR_MAX
 
__WCHAR_MAX__


	)

50 
	#__DARWIN_WCHAR_MAX
 0x7fffffff

	)

53 #i‡
__DARWIN_WCHAR_MAX
 > 0xffffU

54 
	#__DARWIN_WCHAR_MIN
 (-0x7ffffff‡- 1)

	)

56 
	#__DARWIN_WCHAR_MIN
 0

	)

58 
	#__DARWIN_WEOF
 ((
__d¨wö_wöt_t
)-1)

	)

60 #i‚de‡
_FORTIFY_SOURCE


61 #i‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && ((__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__-0) < 1050)

62 
	#_FORTIFY_SOURCE
 0

	)

64 
	#_FORTIFY_SOURCE
 2

	)

	@/usr/include/_xlocale.h

24 #i‚de‡
__XLOCALE_H_


25 
	#__XLOCALE_H_


	)

27 
	~<sys/cdefs.h
>

29 
__BEGIN_DECLS


30 
___mb_cur_max
();

31 
___mb_cur_max_l
(
loˇÀ_t
);

32 
	g__END_DECLS


	@/usr/include/architecture/i386/math.h

30 #i‚de‡
__MATH__


31 
	#__MATH__


	)

33 
	~<sys/cdefs.h
>

35 #ifde‡
__˝lu•lus


48 #i‡
__FLT_EVAL_METHOD__
 == 0

49 
	tÊﬂt_t
;

50 
	tdoubÀ_t
;

51 #ñi‡
__FLT_EVAL_METHOD__
 == 1

52 
	tÊﬂt_t
;

53 
	tdoubÀ_t
;

54 #ñi‡
__FLT_EVAL_METHOD__
 == 2 || __FLT_EVAL_METHOD__ == -1

55 
	tÊﬂt_t
;

56 
	tdoubÀ_t
;

62 #i‡
deföed
(
__GNUC__
)

63 
	#HUGE_VAL
 
	`__buûtö_huge_vÆ
()

	)

64 
	#HUGE_VALF
 
	`__buûtö_huge_vÆf
()

	)

65 
	#HUGE_VALL
 
	`__buûtö_huge_vÆl
()

	)

66 
	#NAN
 
	`__buûtö_«nf
("0x7fc00000"Ë

	)

67 
	#__MATH_H_ALWAYS_INLINE__
 
	`__©åibuã__
 ((
Æways_ölöe
))

	)

69 
	#HUGE_VAL
 1e500

	)

70 
	#HUGE_VALF
 1e50f

	)

71 
	#HUGE_VALL
 1e5000L

	)

72 
	#NAN
 
	`__«n
–)

	)

73 
	#__MATH_H_ALWAYS_INLINE__


	)

76 
	#INFINITY
 
HUGE_VALF


	)

83 
	#FP_NAN
 1

	)

84 
	#FP_INFINITE
 2

	)

85 
	#FP_ZERO
 3

	)

86 
	#FP_NORMAL
 4

	)

87 
	#FP_SUBNORMAL
 5

	)

88 
	#FP_SUPERNORMAL
 6

	)

95 #unde‡
FP_FAST_FMA


96 #unde‡
FP_FAST_FMAF


97 #unde‡
FP_FAST_FMAL


100 
	#FP_ILOGB0
 (-2147483647 - 1)

	)

101 
	#FP_ILOGBNAN
 (-2147483647 - 1)

	)

104 
	#MATH_ERRNO
 1

	)

105 
	#MATH_ERREXCEPT
 2

	)

107 
	#m©h_îrh™dlög
 (
	`__m©h_îrh™dlög
())

	)

108 
__m©h_îrh™dlög
 ( );

123 
	#Â˛assify
(
x
) \

124 – (
x
Ë=(Ë? 
	`__Â˛assifyf
(()(x)) \

125 :  (
x
Ë=(Ë? 
	`__Â˛assifyd
(()(x)) \

126 : 
	`__Â˛assify
 (()(
x
)))

	)

128 
__Â˛assifyf
();

129 
__Â˛assifyd
();

130 
__Â˛assify
 ();

132 #i‡
deföed
–
__GNUC__
 ) && 0 =
__FINITE_MATH_ONLY__


138 
	#i¢‹mÆ
(
x
) \

139 – (
x
Ë=(Ë? 
	`__ölöe_i¢‹mÆf
(()(x)) \

140 :  (
x
Ë=(Ë? 
	`__ölöe_i¢‹mÆd
(()(x)) \

141 : 
	`__ölöe_i¢‹mÆ
 (()(
x
)))

	)

143 
	#isföôe
(
x
) \

144 – (
x
Ë=(Ë? 
	`__ölöe_isföôef
(()(x)) \

145 :  (
x
Ë=(Ë? 
	`__ölöe_isföôed
(()(x)) \

146 : 
	`__ölöe_isföôe
 (()(
x
)))

	)

148 
	#isöf
(
x
) \

149 – (
x
Ë=(Ë? 
	`__ölöe_isöff
(()(x)) \

150 :  (
x
Ë=(Ë? 
	`__ölöe_isöfd
(()(x)) \

151 : 
	`__ölöe_isöf
 (()(
x
)))

	)

153 
	#i¢™
(
x
) \

154 – (
x
Ë=(Ë? 
	`__ölöe_i¢™f
(()(x)) \

155 :  (
x
Ë=(Ë? 
	`__ölöe_i¢™d
(()(x)) \

156 : 
	`__ölöe_i¢™
 (()(
x
)))

	)

158 
	#signbô
(
x
) \

159 – (
x
Ë=(Ë? 
	`__ölöe_signbôf
(()(x)) \

160 :  (
x
Ë=(Ë? 
	`__ölöe_signbôd
(()(x)) \

161 : 
	`__ölöe_signbô
(()(
x
)))

	)

163 
__ölöe__
 
__ölöe_isföôef
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

164 
__ölöe__
 
__ölöe_isföôed
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

165 
__ölöe__
 
__ölöe_isföôe
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

166 
__ölöe__
 
__ölöe_isöff
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

167 
__ölöe__
 
__ölöe_isöfd
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

168 
__ölöe__
 
__ölöe_isöf
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

169 
__ölöe__
 
__ölöe_i¢™f
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

170 
__ölöe__
 
__ölöe_i¢™d
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

171 
__ölöe__
 
__ölöe_i¢™
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

172 
__ölöe__
 
__ölöe_i¢‹mÆf
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

173 
__ölöe__
 
__ölöe_i¢‹mÆd
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

174 
__ölöe__
 
__ölöe_i¢‹mÆ
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

175 
__ölöe__
 
__ölöe_signbôf
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

176 
__ölöe__
 
__ölöe_signbôd
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

177 
__ölöe__
 
__ölöe_signbô
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

179 
__ölöe__
 
__ölöe_isöff
–
__x
 ) {  
__buûtö_Ábsf
(__xË=
__buûtö_öff
(); }

180 
__ölöe__
 
__ölöe_isöfd
–
__x
 ) {  
__buûtö_Ábs
(__xË=
__buûtö_öf
(); }

181 
__ölöe__
 
__ölöe_isöf
–
__x
 ) {  
__buûtö_Áb¶
(__xË=
__buûtö_öÊ
(); }

182 
__ölöe__
 
__ölöe_isföôef
–
__x
 ) {  
	g__x
 =__x && 
__buûtö_Ábsf
(__xË!
__buûtö_öff
(); }

183 
__ölöe__
 
__ölöe_isföôed
–
__x
 ) {  
	g__x
 =__x && 
__buûtö_Ábs
(__xË!
__buûtö_öf
(); }

184 
__ölöe__
 
__ölöe_isföôe
–
__x
 ) {  
	g__x
 =__x && 
__buûtö_Áb¶
(__xË!
__buûtö_öÊ
(); }

185 
__ölöe__
 
__ölöe_i¢™f
–
__x
 ) {  
	g__x
 != __x; }

186 
__ölöe__
 
__ölöe_i¢™d
–
__x
 ) {  
	g__x
 != __x; }

187 
__ölöe__
 
__ölöe_i¢™
–
__x
 ) {  
	g__x
 != __x; }

188 
__ölöe__
 
__ölöe_signbôf
–
__x
 ) { uni⁄{ 
	g__f
; 
	g__u
; }__u; __u.__f = __x;  ()(__u.__u >> 31); }

189 
__ölöe__
 
__ölöe_signbôd
–
__x
 ) { uni⁄{ 
	g__f
; 
	g__u
[2]; }__u; __u.__f = __x;  ()(__u.__u[1] >> 31); }

190 
__ölöe__
 
__ölöe_signbô
–
__x
 ){ uni⁄{ 
	g__ld
; såu˘{ 
	g__m
[2]; 
	g__£xp
; }
	g__p
; }
	g__u
; __u.__ld = __x;  () ((() __u.__p.__sexp) >> 15); }

191 
__ölöe__
 
__ölöe_i¢‹mÆf
–
__x
 ) { 
	gÁbsf
 = 
__buûtö_Ábsf
(__x); if–
	g__x
 !__x )  0;  fabs‡< 
__buûtö_öff
(Ë&& fabs‡>
__FLT_MIN__
; }

192 
__ölöe__
 
__ölöe_i¢‹mÆd
–
__x
 ) { 
	gÁbsf
 = 
__buûtö_Ábs
(__x); if–
	g__x
 !__x )  0;  fabs‡< 
__buûtö_öf
(Ë&& fabs‡>
__DBL_MIN__
; }

193 
__ölöe__
 
__ölöe_i¢‹mÆ
–
__x
 ) { 
	gÁbsf
 = 
__buûtö_Áb¶
(__x); if–
	g__x
 !__x )  0;  fabs‡< 
__buûtö_öÊ
(Ë&& fabs‡>
__LDBL_MIN__
; }

197 
	#i¢‹mÆ
(
x
) \

198 – (
x
Ë=(Ë? 
	`__i¢‹mÆf
(()(x)) \

199 :  (
x
Ë=(Ë? 
	`__i¢‹mÆd
(()(x)) \

200 : 
	`__i¢‹mÆ
 (()(
x
)))

	)

202 
	#isföôe
(
x
) \

203 – (
x
Ë=(Ë? 
	`__isföôef
(()(x)) \

204 :  (
x
Ë=(Ë? 
	`__isföôed
(()(x)) \

205 : 
	`__isföôe
 (()(
x
)))

	)

207 
	#isöf
(
x
) \

208 – (
x
Ë=(Ë? 
	`__isöff
(()(x)) \

209 :  (
x
Ë=(Ë? 
	`__isöfd
(()(x)) \

210 : 
	`__isöf
 (()(
x
)))

	)

212 
	#i¢™
(
x
) \

213 – (
x
Ë=(Ë? 
	`__i¢™f
(()(x)) \

214 :  (
x
Ë=(Ë? 
	`__i¢™d
(()(x)) \

215 : 
	`__i¢™
 (()(
x
)))

	)

217 
	#signbô
(
x
) \

218 – (
x
Ë=(Ë? 
	`__signbôf
(()(x)) \

219 :  (
x
Ë=(Ë? 
	`__signbôd
(()(x)) \

220 : 
	`__signbôl
(()(
x
)))

	)

223 
__i¢‹mÆf
 ();

224 
__i¢‹mÆd
 ();

225 
__i¢‹mÆ
 ();

227 
__isföôef
 ();

228 
__isföôed
 ();

229 
__isföôe
 ();

231 
__isöff
 ();

232 
__isöfd
 ();

233 
__isöf
 ();

235 
__i¢™f
 ();

236 
__i¢™d
 ();

237 
__i¢™
 ();

239 
__signbôf
 ();

240 
__signbôd
 ();

241 
__signbôl
 ();

253 
acos
( );

254 
acosf
( );

256 
asö
( );

257 
asöf
( );

259 
©™
( );

260 
©™f
( );

262 
©™2
( , );

263 
©™2f
( , );

265 
cos
( );

266 
cosf
( );

268 
sö
( );

269 
söf
( );

271 
èn
( );

272 
ènf
( );

274 
acosh
( );

275 
acoshf
( );

277 
asöh
( );

278 
asöhf
( );

280 
©™h
( );

281 
©™hf
( );

283 
cosh
( );

284 
coshf
( );

286 
söh
( );

287 
söhf
( );

289 
ènh
( );

290 
ènhf
( );

292 
exp
 ( );

293 
expf
 ( );

295 
exp2
 ( );

296 
exp2f
 ( );

298 
expm1
 ( );

299 
expm1f
 ( );

301 
log
 ( );

302 
logf
 ( );

304 
log10
 ( );

305 
log10f
 ( );

307 
log2
 ( );

308 
log2f
 ( );

310 
log1p
 ( );

311 
log1pf
 ( );

313 
logb
 ( );

314 
logbf
 ( );

316 
modf
 ( , * );

317 
modff
 ( , * );

319 
ldexp
 ( , );

320 
ldexpf
 ( , );

322 
‰exp
 ( , * );

323 
‰expf
 ( , * );

325 
ûogb
 ( );

326 
ûogbf
 ( );

328 
sˇlbn
 ( , );

329 
sˇlbnf
 ( , );

331 
sˇlb 
 ( , );

332 
sˇlb f
 ( , );

334 
Ábs
( );

335 
Ábsf
( );

337 
cbπ
( );

338 
cbπf
( );

340 
hypŸ
 ( , );

341 
hypŸf
 ( , );

343 
pow
 ( , );

344 
powf
 ( , );

346 
sqπ
( );

347 
sqπf
( );

349 
îf
( );

350 
îff
( );

352 
îfc
( );

353 
îfcf
( );

360 
lgamma
( );

361 
lgammaf
( );

363 
tgamma
( );

364 
tgammaf
( );

366 
˚û
 ( );

367 
˚ûf
 ( );

369 
Êo‹
 ( );

370 
Êo‹f
 ( );

372 
√¨byöt
 ( );

373 
√¨byötf
 ( );

375 
röt
 ( );

376 
rötf
 ( );

378 
Ãöt
 ( );

379 
Ãötf
 ( );

381 
round
 ( );

382 
roundf
 ( );

384 
Ãound
 ( );

385 
Ãoundf
 ( );

387 #i‡!(
__DARWIN_NO_LONG_LONG
)

389 
Œröt
 ( );

390 
Œrötf
 ( );

391 
Œround
 ( );

392 
Œroundf
 ( );

395 
åunc
 ( );

396 
åuncf
 ( );

398 
fmod
 ( , );

399 
fmodf
 ( , );

401 
ªmaödî
 ( , );

402 
ªmaödîf
 ( , );

404 
ªmquo
 ( , , * );

405 
ªmquof
 ( , , * );

407 
c›ysign
 ( , );

408 
c›ysignf
 ( , );

410 
«n
( const * );

411 
«nf
( const * );

413 
√xè·î
 ( , );

414 
√xè·îf
 ( , );

416 
fdim
 ( , );

417 
fdimf
 ( , );

419 
fmax
 ( , );

420 
fmaxf
 ( , );

422 
fmö
 ( , );

423 
fmöf
 ( , );

425 
fma
 ( , , );

426 
fmaf
 ( , , );

428 
aco¶
();

429 
asöl
();

430 
©™l
();

431 
©™2l
(, );

432 
co¶
();

433 
söl
();

434 
è∆
();

435 
acoshl
();

436 
asöhl
();

437 
©™hl
();

438 
coshl
();

439 
söhl
();

440 
ènhl
();

441 
ex∂
();

442 
exp2l
();

443 
expm1l
();

444 
logl
();

445 
log10l
();

446 
log2l
();

447 
log1∂
();

448 
logbl
();

449 
modÊ
(, *);

450 
ldex∂
(, );

451 
‰ex∂
(, *);

452 
ûogbl
();

453 
sˇlb∆
(, );

454 
sˇlb l
(, );

455 
Áb¶
();

456 
cbπl
();

457 
hypŸl
(, );

458 
powl
(, );

459 
sqπl
();

460 
îÊ
();

461 
îf˛
();

468 
lgammÆ
();

470 
tgammÆ
();

471 
˚ûl
();

472 
Êo‹l
();

473 
√¨byöé
();

474 
röé
();

475 
Ãöé
();

476 
roundl
();

477 
Ãoundl
();

479 #i‡!(
__DARWIN_NO_LONG_LONG
)

481 
Œröé
();

482 
Œroundl
();

485 
åun˛
();

486 
fmodl
(, );

487 
ªmaödîl
(, );

488 
ªmquﬁ
(, , *);

489 
c›ysig∆
(, );

490 
«∆
(const *);

491 
√xè·îl
(, );

492 
√xâow¨d
(, );

493 
√xâow¨df
(, );

494 
√xâow¨dl
(, );

495 
fdiml
(, );

496 
fmaxl
(, );

497 
fmöl
(, );

498 
fmÆ
(, , );

500 
	#isgª©î
(
x
, 
y
Ë
	`__buûtö_isgª©î
 ((x),(y))

	)

501 
	#isgª©îequÆ
(
x
, 
y
Ë
	`__buûtö_isgª©îequÆ
 ((x),(y))

	)

502 
	#i¶ess
(
x
, 
y
Ë
	`__buûtö_i¶ess
 ((x),(y))

	)

503 
	#i¶es£quÆ
(
x
, 
y
Ë
	`__buûtö_i¶es£quÆ
 ((x),(y))

	)

504 
	#i¶essgª©î
(
x
, 
y
Ë
	`__buûtö_i¶essgª©î
 ((x),(y))

	)

505 
	#isun‹dîed
(
x
, 
y
Ë
	`__buûtö_isun‹dîed
 ((x),(y))

	)

507 
__öf
( );

508 
__öff
( );

509 
__öÊ
( );

510 
__«n
( );

512 #i‡!
deföed
(
_ANSI_SOURCE
)

513 
j0
 ( );

515 
j1
 ( );

517 
jn
 ( , );

519 
y0
 ( );

521 
y1
 ( );

523 
yn
 ( , );

525 
sˇlb
 ( , );

528 
	#M_E
 2.71828182845904523536028747135266250

	)

529 
	#M_LOG2E
 1.44269504088896340735992468100189214

	)

530 
	#M_LOG10E
 0.434294481903251827651128918916605082

	)

531 
	#M_LN2
 0.693147180559945309417232121458176568

	)

532 
	#M_LN10
 2.30258509299404568401799145468436421

	)

533 
	#M_PI
 3.14159265358979323846264338327950288

	)

534 
	#M_PI_2
 1.57079632679489661923132169163975144

	)

535 
	#M_PI_4
 0.785398163397448309615660845819875721

	)

536 
	#M_1_PI
 0.318309886183790671537767526745028724

	)

537 
	#M_2_PI
 0.636619772367581343075535053490057448

	)

538 
	#M_2_SQRTPI
 1.12837916709551257389615890312154517

	)

539 
	#M_SQRT2
 1.41421356237309504880168872420969808

	)

540 
	#M_SQRT1_2
 0.707106781186547524400844362104849039

	)

542 
	#MAXFLOAT
 (()3.40282346638528860e+38)

	)

543 
signgam
;

548 #i‡!
deföed
(
__NOEXTENSIONS__
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

549 
	#__WANT_EXTENSIONS__


	)

552 #ifde‡
__WANT_EXTENSIONS__


554 
	#FP_SNAN
 
FP_NAN


	)

555 
	#FP_QNAN
 
FP_NAN


	)

558 
röâﬁ
 ( );

561 
roundtﬁ
 ( );

566 #i‡!
deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

567 #i‡(!
deföed
(
_XOPEN_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

568 #i‡!
deföed
(
__˝lu•lus
)

570 
	sex˚±i⁄
 {

571 
	gty≥
;

572 *
	g«me
;

573 
	g¨g1
;

574 
	g¨g2
;

575 
	gªtvÆ
;

579 
	#HUGE
 
MAXFLOAT


	)

586 
	#X_TLOSS
 1.41484755040568800000e+16

	)

588 
	#DOMAIN
 1

	)

589 
	#SING
 2

	)

590 
	#OVERFLOW
 3

	)

591 
	#UNDERFLOW
 4

	)

592 
	#TLOSS
 5

	)

593 
	#PLOSS
 6

	)

598 #i‡!
deföed
–
__STRICT_ANSI__
Ë&& !deföed(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

601 
föôe
 ( );

604 
gamma
 ( );

606 #i‡(!
deföed
(
_XOPEN_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

608 #i‡!
deföed
(
__˝lu•lus
)

609 
m©hîr
 ( 
ex˚±i⁄
 * );

615 
signifiˇnd
 ( );

622 
dªm
 ( , );

629 #ifde‡
_REENTRANT


630 
	~<AvaûabûôyMa¸os.h
>

632 
lgammaf_r
 ( , * ) 
AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER
;

633 
lgamma_r
 ( , * ) 
AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER
;

634 
lgammÆ_r
 ( , * ) 
AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER
;

642 #ifde‡
__˝lu•lus


	@/usr/include/architecture/ppc/math.h

30 #i‚de‡
__MATH__


31 
	#__MATH__


	)

33 
	~"sys/cdefs.h
"

35 #i‡(!
deföed
(
__WANT_LONG_DOUBLE_FORMAT__
))

36 #i‡
deföed
(
__APPLE_CC__
Ë&& deföed(
__LONG_DOUBLE_128__
)

37 
	#__WANT_LONG_DOUBLE_FORMAT__
 128

	)

39 
	#__WANT_LONG_DOUBLE_FORMAT__
 64

	)

43 #i‡–
__WANT_LONG_DOUBLE_FORMAT__
 - 0L == 128L )

44 
	#__LIBMLDBL_COMPAT
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË"$LDBL128")

	)

45 #ñi‡–
__WANT_LONG_DOUBLE_FORMAT__
 - 0L == 64L )

46 
	#__LIBMLDBL_COMPAT
(
sym
Ë

	)

48 
	#__LIBMLDBL_COMPAT
(
sym
Ë

	)

51 #ifde‡
__˝lu•lus


64 #i‡
__FLT_EVAL_METHOD__
 == 0

65 
	tÊﬂt_t
;

66 
	tdoubÀ_t
;

67 #ñi‡
__FLT_EVAL_METHOD__
 == 1

68 
	tÊﬂt_t
;

69 
	tdoubÀ_t
;

70 #ñi‡
__FLT_EVAL_METHOD__
 == 2 || __FLT_EVAL_METHOD__ == -1

71 
	tÊﬂt_t
;

72 
	tdoubÀ_t
;

78 #i‡
deföed
(
__GNUC__
Ë&& ! deföed–
__XLC__
 )

79 
	#HUGE_VAL
 
	`__buûtö_huge_vÆ
()

	)

80 
	#HUGE_VALF
 
	`__buûtö_huge_vÆf
()

	)

81 
	#HUGE_VALL
 
	`__buûtö_huge_vÆl
()

	)

82 
	#NAN
 
	`__buûtö_«nf
("0x7fc00000"Ë

	)

83 
	#__MATH_H_ALWAYS_INLINE__
 
	`__©åibuã__
 ((
Æways_ölöe
))

	)

85 
	#HUGE_VAL
 1e500

	)

86 
	#HUGE_VALF
 1e50f

	)

87 
	#HUGE_VALL
 1e500L

	)

88 
	#NAN
 
	`__«n
–)

	)

89 
	#__MATH_H_ALWAYS_INLINE__


	)

92 
	#INFINITY
 
HUGE_VALF


	)

98 
	#FP_NAN
 1

	)

99 
	#FP_INFINITE
 2

	)

100 
	#FP_ZERO
 3

	)

101 
	#FP_NORMAL
 4

	)

102 
	#FP_SUBNORMAL
 5

	)

103 
	#FP_SUPERNORMAL
 6

	)

106 #unde‡
FP_FAST_FMA


107 #unde‡
FP_FAST_FMAF


108 #unde‡
FP_FAST_FMAL


111 
	#FP_ILOGB0
 (-2147483647)

	)

112 
	#FP_ILOGBNAN
 (2147483647)

	)

115 
	#MATH_ERRNO
 1

	)

116 
	#MATH_ERREXCEPT
 2

	)

118 
	#m©h_îrh™dlög
 (
	`__m©h_îrh™dlög
())

	)

119 
__m©h_îrh™dlög
 ( );

134 #i‡(
__WANT_LONG_DOUBLE_FORMAT__
 - 0L == 128L)

135 
	#Â˛assify
(
x
) \

136 – (
x
Ë=(Ë? 
	`__Â˛assifyf
(()x) \

137 :  (
x
Ë=(Ë? 
	`__Â˛assifyd
(()x) \

138 : 
	`__Â˛assify
 (()
x
))

	)

140 
__Â˛assifyf
();

141 
__Â˛assifyd
();

142 
__Â˛assify
 ();

144 #i‡
deföed
–
__GNUC__
 ) && ! deföed–
__XLC__
 ) && 0 =
__FINITE_MATH_ONLY__


151 
	#i¢‹mÆ
(
x
) \

152 – (
x
Ë=(Ë? 
	`__ölöe_i¢‹mÆf
(()(x)) \

153 :  (
x
Ë=(Ë? 
	`__ölöe_i¢‹mÆd
(()(x)) \

154 : 
	`__ölöe_i¢‹mÆ
 (()(
x
)))

	)

156 
	#isföôe
(
x
) \

157 – (
x
Ë=(Ë? 
	`__ölöe_isföôef
(()(x)) \

158 :  (
x
Ë=(Ë? 
	`__ölöe_isföôed
(()(x)) \

159 : 
	`__ölöe_isföôe
 (()(
x
)))

	)

161 
	#isöf
(
x
) \

162 – (
x
Ë=(Ë? 
	`__ölöe_isöff
(()(x)) \

163 :  (
x
Ë=(Ë? 
	`__ölöe_isöfd
(()(x)) \

164 : 
	`__ölöe_isöf
 (()(
x
)))

	)

166 
	#i¢™
(
x
) \

167 – (
x
Ë=(Ë? 
	`__ölöe_i¢™f
(()(x)) \

168 :  (
x
Ë=(Ë? 
	`__ölöe_i¢™d
(()(x)) \

169 : 
	`__ölöe_i¢™
 (()(
x
)))

	)

171 
	#signbô
(
x
) \

172 – (
x
Ë=(Ë? 
	`__ölöe_signbôf
(()(x)) \

173 :  (
x
Ë=(Ë? 
	`__ölöe_signbôd
(()(x)) \

174 : 
	`__ölöe_signbô
(()(
x
)))

	)

179 
__ölöe__
 
__ölöe_isföôef
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

180 
__ölöe__
 
__ölöe_isföôed
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

181 
__ölöe__
 
__ölöe_isföôe
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

182 
__ölöe__
 
__ölöe_isöff
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

183 
__ölöe__
 
__ölöe_isöfd
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

184 
__ölöe__
 
__ölöe_isöf
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

185 
__ölöe__
 
__ölöe_i¢™f
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

186 
__ölöe__
 
__ölöe_i¢™d
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

187 
__ölöe__
 
__ölöe_i¢™
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

188 
__ölöe__
 
__ölöe_i¢‹mÆf
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

189 
__ölöe__
 
__ölöe_i¢‹mÆd
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

190 
__ölöe__
 
__ölöe_i¢‹mÆ
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

191 
__ölöe__
 
__ölöe_signbôf
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

192 
__ölöe__
 
__ölöe_signbôd
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

193 
__ölöe__
 
__ölöe_signbô
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

195 
__ölöe__
 
__ölöe_isöff
–
__x
 ) {  
__buûtö_Ábsf
(__xË=
__buûtö_öff
(); }

196 
__ölöe__
 
__ölöe_isöfd
–
__x
 ) {  
__buûtö_Ábs
(__xË=
__buûtö_öf
(); }

197 
__ölöe__
 
__ölöe_isöf
–
__x
 ) {  
__buûtö_Áb¶
(__xË=
__buûtö_öÊ
(); }

198 
__ölöe__
 
__ölöe_isföôef
–
__x
 ) {  
	g__x
 =__x && 
__buûtö_Ábsf
(__xË!
__buûtö_öff
(); }

199 
__ölöe__
 
__ölöe_isföôed
–
__x
 ) {  
	g__x
 =__x && 
__buûtö_Ábs
(__xË!
__buûtö_öf
(); }

200 
__ölöe__
 
__ölöe_isföôe
–
__x
 ) {  
	g__x
 =__x && 
__buûtö_Áb¶
(__xË!
__buûtö_öÊ
(); }

201 
__ölöe__
 
__ölöe_i¢™f
–
__x
 ) {  
	g__x
 != __x; }

202 
__ölöe__
 
__ölöe_i¢™d
–
__x
 ) {  
	g__x
 != __x; }

203 
__ölöe__
 
__ölöe_i¢™
–
__x
 ) {  
	g__x
 != __x; }

204 
__ölöe__
 
__ölöe_signbôf
–
__x
 ) { uni⁄{ 
	g__f
; 
	g__u
; }__u; __u.__f = __x;  ()(__u.__u >> 31); }

205 
__ölöe__
 
__ölöe_signbôd
–
__x
 ) { uni⁄{ 
	g__f
; 
	g__u
; }__u; __u.__f = __x;  ()(__u.__u >> ( 8 * ( __u.__u) - 1)); }

206 
__ölöe__
 
__ölöe_signbô
–
__x
 ){ uni⁄{ 
	g__ld
; 
	g__p
; }
	g__u
; __u.__ld = __x;  () (__u.__p >> ( 8 * ( __u.__p) - 1)); }

207 
__ölöe__
 
__ölöe_i¢‹mÆf
–
__x
 ) { 
	gÁbsf
 = 
__buûtö_Ábsf
(__x); if–
	g__x
 !__x )  0;  fabs‡< 
__buûtö_öff
(Ë&& fabs‡>
__FLT_MIN__
; }

208 
__ölöe__
 
__ölöe_i¢‹mÆd
–
__x
 ) { 
	gÁbsf
 = 
__buûtö_Ábs
(__x); if–
	g__x
 !__x )  0;  fabs‡< 
__buûtö_öf
(Ë&& fabs‡>
__DBL_MIN__
; }

209 
__ölöe__
 
__ölöe_i¢‹mÆ
–
__x
 ) { 
	gÁbsf
 = 
__buûtö_Áb¶
(__x); if–
	g__x
 !__x )  0;  fabs‡< 
__buûtö_öÊ
(Ë&& fabs‡>
__LDBL_MIN__
; }

213 
	#i¢‹mÆ
(
x
) \

214 – (
x
Ë=(Ë? 
	`__i¢‹mÆf
(()(x)) \

215 :  (
x
Ë=(Ë? 
	`__i¢‹mÆd
(()(x)) \

216 : 
	`__i¢‹mÆ
 (()(
x
)))

	)

218 
	#isföôe
(
x
) \

219 – (
x
Ë=(Ë? 
	`__isföôef
(()(x)) \

220 :  (
x
Ë=(Ë? 
	`__isföôed
(()(x)) \

221 : 
	`__isföôe
 (()(
x
)))

	)

223 
	#isöf
(
x
) \

224 – (
x
Ë=(Ë? 
	`__isöff
(()(x)) \

225 :  (
x
Ë=(Ë? 
	`__isöfd
(()(x)) \

226 : 
	`__isöf
 (()(
x
)))

	)

228 
	#i¢™
(
x
) \

229 – (
x
Ë=(Ë? 
	`__i¢™f
(()(x)) \

230 :  (
x
Ë=(Ë? 
	`__i¢™d
(()(x)) \

231 : 
	`__i¢™
 (()(
x
)))

	)

233 
	#signbô
(
x
) \

234 – (
x
Ë=(Ë? 
	`__signbôf
(()(x)) \

235 :  (
x
Ë=(Ë? 
	`__signbôd
(()(x)) \

236 : 
	`__signbôl
(()(
x
)))

	)

239 
__i¢‹mÆf
 ();

240 
__i¢‹mÆd
 ();

241 
__i¢‹mÆ
 ();

243 
__isföôef
 ();

244 
__isföôed
 ();

245 
__isföôe
 ();

247 
__isöff
 ();

248 
__isöfd
 ();

249 
__isöf
 ();

251 
__i¢™f
 ();

252 
__i¢™d
 ();

253 
__i¢™
 ();

255 
__signbôf
 ();

256 
__signbôd
 ();

257 
__signbôl
 ();

262 
	#Â˛assify
(
x
) \

263 – (
x
Ë=(Ë? 
	`__Â˛assifyf
(()(x)Ë: 
	`__Â˛assifyd
(()(x)Ë)

	)

265 
__Â˛assifyf
();

266 
__Â˛assifyd
();

268 #i‡
deföed
–
__GNUC__
 ) && ! deföed–
__XLC__
 ) && 0 =
__FINITE_MATH_ONLY__


274 
	#i¢‹mÆ
(
x
) \

275 – (
x
Ë=(Ë? 
	`__ölöe_i¢‹mÆf
(()(x)Ë: 
	`__ölöe_i¢‹mÆd
(()(x)Ë)

	)

277 
	#isföôe
(
x
) \

278 – (
x
Ë=(Ë? 
	`__ölöe_isföôef
(()(x)Ë: 
	`__ölöe_isföôed
(()(x)Ë)

	)

280 
	#isöf
(
x
) \

281 – (
x
Ë=(Ë? 
	`__ölöe_isöff
(()(x)Ë: 
	`__ölöe_isöfd
(()(x)Ë)

	)

283 
	#i¢™
(
x
) \

284 – (
x
Ë=(Ë? 
	`__ölöe_i¢™f
(()(x)Ë: 
	`__ölöe_i¢™d
(()(x)Ë)

	)

286 
	#signbô
(
x
) \

287 – (
x
Ë=(Ë? 
	`__ölöe_signbôf
(()(x)Ë: 
	`__ölöe_signbôd
(()(x)Ë)

	)

292 
__ölöe__
 
__ölöe_isföôef
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

293 
__ölöe__
 
__ölöe_isföôed
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

294 
__ölöe__
 
__ölöe_isföôe
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

295 
__ölöe__
 
__ölöe_isöff
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

296 
__ölöe__
 
__ölöe_isöfd
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

297 
__ölöe__
 
__ölöe_isöf
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

298 
__ölöe__
 
__ölöe_i¢™f
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

299 
__ölöe__
 
__ölöe_i¢™d
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

300 
__ölöe__
 
__ölöe_i¢™
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

301 
__ölöe__
 
__ölöe_i¢‹mÆf
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

302 
__ölöe__
 
__ölöe_i¢‹mÆd
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

303 
__ölöe__
 
__ölöe_i¢‹mÆ
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

304 
__ölöe__
 
__ölöe_signbôf
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

305 
__ölöe__
 
__ölöe_signbôd
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

306 
__ölöe__
 
__ölöe_signbô
 (Ë
	g__MATH_H_ALWAYS_INLINE__
;

308 
__ölöe__
 
__ölöe_isöff
–
__x
 ) {  
__buûtö_Ábsf
(__xË=
__buûtö_öff
(); }

309 
__ölöe__
 
__ölöe_isöfd
–
__x
 ) {  
__buûtö_Ábs
(__xË=
__buûtö_öf
(); }

310 
__ölöe__
 
__ölöe_isöf
–
__x
 ) {  
__buûtö_Áb¶
(__xË=
__buûtö_öÊ
(); }

311 
__ölöe__
 
__ölöe_isföôef
–
__x
 ) {  
	g__x
 =__x && 
__buûtö_Ábsf
(__xË!
__buûtö_öff
(); }

312 
__ölöe__
 
__ölöe_isföôed
–
__x
 ) {  
	g__x
 =__x && 
__buûtö_Ábs
(__xË!
__buûtö_öf
(); }

313 
__ölöe__
 
__ölöe_isföôe
–
__x
 ) {  
	g__x
 =__x && 
__buûtö_Áb¶
(__xË!
__buûtö_öÊ
(); }

314 
__ölöe__
 
__ölöe_i¢™f
–
__x
 ) {  
	g__x
 != __x; }

315 
__ölöe__
 
__ölöe_i¢™d
–
__x
 ) {  
	g__x
 != __x; }

316 
__ölöe__
 
__ölöe_i¢™
–
__x
 ) {  
	g__x
 != __x; }

317 
__ölöe__
 
__ölöe_signbôf
–
__x
 ) { uni⁄{ 
	g__f
; 
	g__u
; }__u; __u.__f = __x;  ()(__u.__u >> 31); }

318 
__ölöe__
 
__ölöe_signbôd
–
__x
 ) { uni⁄{ 
	g__f
; 
	g__u
; }__u; __u.__f = __x;  ()(__u.__u >> ( 8 * ( __u.__u) - 1)); }

319 
__ölöe__
 
__ölöe_signbô
–
__x
 ){ uni⁄{ 
	g__ld
; 
	g__p
; }
	g__u
; __u.__ld = __x;  () (__u.__p >> ( 8 * ( __u.__p) - 1)); }

320 
__ölöe__
 
__ölöe_i¢‹mÆf
–
__x
 ) { 
	gÁbsf
 = 
__buûtö_Ábsf
(__x); if–
	g__x
 !__x )  0;  fabs‡< 
__buûtö_öff
(Ë&& fabs‡>
__FLT_MIN__
; }

321 
__ölöe__
 
__ölöe_i¢‹mÆd
–
__x
 ) { 
	gÁbsf
 = 
__buûtö_Ábs
(__x); if–
	g__x
 !__x )  0;  fabs‡< 
__buûtö_öf
(Ë&& fabs‡>
__DBL_MIN__
; }

322 
__ölöe__
 
__ölöe_i¢‹mÆ
–
__x
 ) { 
	gÁbsf
 = 
__buûtö_Áb¶
(__x); if–
	g__x
 !__x )  0;  fabs‡< 
__buûtö_öÊ
(Ë&& fabs‡>
__LDBL_MIN__
; }

326 
	#i¢‹mÆ
(
x
) \

327 – (
x
Ë=(Ë? 
	`__i¢‹mÆf
(()(x)Ë: 
	`__i¢‹mÆd
(()(x)Ë)

	)

329 
	#isföôe
(
x
) \

330 – (
x
Ë=(Ë? 
	`__isföôef
(()(x)Ë: 
	`__isföôed
(()(x)Ë)

	)

332 
	#isöf
(
x
) \

333 – (
x
Ë=(Ë? 
	`__isöff
(()(x)Ë: 
	`__isöfd
(()(x)Ë)

	)

335 
	#i¢™
(
x
) \

336 – (
x
Ë=(Ë? 
	`__i¢™f
(()(x)Ë: 
	`__i¢™d
(()(x)Ë)

	)

338 
	#signbô
(
x
) \

339 – (
x
Ë=(Ë? 
	`__signbôf
(()(x)Ë: 
	`__signbôd
(()(x)Ë)

	)

342 
__i¢‹mÆf
 ();

343 
__i¢‹mÆd
 ();

345 
__isföôef
 ();

346 
__isföôed
 ();

348 
__isöff
 ();

349 
__isöfd
 ();

351 
__i¢™f
 ();

352 
__i¢™d
 ();

354 
__signbôf
 ();

355 
__signbôd
 ();

368 
acos
( );

369 
acosf
( );

371 
asö
( );

372 
asöf
( );

374 
©™
( );

375 
©™f
( );

377 
©™2
( , );

378 
©™2f
( , );

380 
cos
( );

381 
cosf
( );

383 
sö
( );

384 
söf
( );

386 
èn
( );

387 
ènf
( );

389 
acosh
( );

390 
acoshf
( );

392 
asöh
( );

393 
asöhf
( );

395 
©™h
( );

396 
©™hf
( );

398 
cosh
( );

399 
coshf
( );

401 
söh
( );

402 
söhf
( );

404 
ènh
( );

405 
ènhf
( );

407 
exp
( );

408 
expf
( );

410 
exp2
( );

411 
exp2f
( );

413 
expm1
( );

414 
expm1f
( );

416 
log
( );

417 
logf
( );

419 
log10
( );

420 
log10f
( );

422 
log2
( );

423 
log2f
( );

425 
log1p
( );

426 
log1pf
( );

428 
logb
( );

429 
logbf
( );

431 
modf
( , * );

432 
modff
( , * );

434 
ldexp
( , );

435 
ldexpf
( , );

437 
‰exp
( , * );

438 
‰expf
( , * );

440 
ûogb
( );

441 
ûogbf
( );

443 
sˇlbn
( , );

444 
sˇlbnf
( , );

446 
sˇlb 
( , );

447 
sˇlb f
( , );

449 
Ábs
( );

450 
Ábsf
( );

452 
cbπ
( );

453 
cbπf
( );

455 
hypŸ
( , );

456 
hypŸf
( , );

458 
pow
( , );

459 
powf
( , );

461 
sqπ
( );

462 
sqπf
( );

464 
îf
( );

465 
îff
( );

467 
îfc
( );

468 
îfcf
( );

470 
lgamma
( );

471 
lgammaf
( );

473 
tgamma
( );

474 
tgammaf
( );

476 
˚û
( );

477 
˚ûf
( );

479 
Êo‹
( );

480 
Êo‹f
( );

482 
√¨byöt
( );

483 
√¨byötf
( );

485 
röt
( );

486 
rötf
( );

488 
Ãöt
( );

489 
Ãötf
( );

491 
round
( );

492 
roundf
( );

494 
Ãound
( );

495 
Ãoundf
( );

497 #i‡–
deföed
 (
__STDC_VERSION__
Ë&& __STDC_VERSION__ >199901L ) || ! deföed–
__STRICT_ANSI__
 ) || ! deföed–
__GNUC__
 )

499 
Œröt
( );

500 
Œrötf
( );

502 
Œround
( );

503 
Œroundf
( );

506 
åunc
( );

507 
åuncf
( );

509 
fmod
( , );

510 
fmodf
( , );

512 
ªmaödî
( , );

513 
ªmaödîf
( , );

515 
ªmquo
( , , * );

516 
ªmquof
( , , * );

518 
c›ysign
( , );

519 
c›ysignf
( , );

521 
«n
( const * );

522 
«nf
( const * );

524 
√xè·î
( , );

525 
√xè·îf
( , );

528 
fdim
( , );

529 
fdimf
( , );

531 
fmax
( , );

532 
fmaxf
( , );

534 
fmö
( , );

535 
fmöf
( , );

537 
fma
( , , );

538 
fmaf
( , , );

540 #i‡–
__WANT_LONG_DOUBLE_FORMAT__
 - 0L > 0L )

541 
aco¶
–Ë
__LIBMLDBL_COMPAT
(acosl);

542 
asöl
–Ë
__LIBMLDBL_COMPAT
(asinl);

543 
©™l
–Ë
__LIBMLDBL_COMPAT
(atanl);

544 
©™2l
–, Ë
__LIBMLDBL_COMPAT
(atan2l);

545 
co¶
–Ë
__LIBMLDBL_COMPAT
(cosl);

546 
söl
–Ë
__LIBMLDBL_COMPAT
(sinl);

547 
è∆
–Ë
__LIBMLDBL_COMPAT
(tanl);

548 
acoshl
–Ë
__LIBMLDBL_COMPAT
(acoshl);

549 
asöhl
–Ë
__LIBMLDBL_COMPAT
(asinhl);

550 
©™hl
–Ë
__LIBMLDBL_COMPAT
(atanhl);

551 
coshl
–Ë
__LIBMLDBL_COMPAT
(coshl);

552 
söhl
–Ë
__LIBMLDBL_COMPAT
(sinhl);

553 
ènhl
–Ë
__LIBMLDBL_COMPAT
(tanhl);

554 
ex∂
–Ë
__LIBMLDBL_COMPAT
(expl);

555 
exp2l
–Ë
__LIBMLDBL_COMPAT
(exp2l);

556 
expm1l
–Ë
__LIBMLDBL_COMPAT
(expm1l);

557 
logl
–Ë
__LIBMLDBL_COMPAT
(logl);

558 
log10l
–Ë
__LIBMLDBL_COMPAT
(log10l);

559 
log2l
–Ë
__LIBMLDBL_COMPAT
(log2l);

560 
log1∂
–Ë
__LIBMLDBL_COMPAT
(log1pl);

561 
logbl
–Ë
__LIBMLDBL_COMPAT
(logbl);

562 
modÊ
–, * ) 
__LIBMLDBL_COMPAT
(modfl);

563 
ldex∂
–, Ë
__LIBMLDBL_COMPAT
(ldexpl);

564 
‰ex∂
–, * ) 
__LIBMLDBL_COMPAT
(frexpl);

565 
ûogbl
–Ë
__LIBMLDBL_COMPAT
(ilogbl);

566 
sˇlb∆
–, Ë
__LIBMLDBL_COMPAT
(scalbnl);

567 
sˇlb l
–, Ë
__LIBMLDBL_COMPAT
(scalblnl);

568 
Áb¶
–Ë
__LIBMLDBL_COMPAT
(fabsl);

569 
cbπl
–Ë
__LIBMLDBL_COMPAT
(cbrtl);

570 
hypŸl
–, Ë
__LIBMLDBL_COMPAT
(hypotl);

571 
powl
–, Ë
__LIBMLDBL_COMPAT
(powl);

572 
sqπl
–Ë
__LIBMLDBL_COMPAT
(sqrtl);

573 
îÊ
–Ë
__LIBMLDBL_COMPAT
(erfl);

574 
îf˛
–Ë
__LIBMLDBL_COMPAT
(erfcl);

575 
lgammÆ
–Ë
__LIBMLDBL_COMPAT
(lgammal);

576 
tgammÆ
–Ë
__LIBMLDBL_COMPAT
(tgammal);

577 
˚ûl
–Ë
__LIBMLDBL_COMPAT
(ceill);

578 
Êo‹l
–Ë
__LIBMLDBL_COMPAT
(floorl);

579 
√¨byöé
–Ë
__LIBMLDBL_COMPAT
(nearbyintl);

580 
röé
–Ë
__LIBMLDBL_COMPAT
(rintl);

581 
Ãöé
–Ë
__LIBMLDBL_COMPAT
(lrintl);

582 
roundl
–Ë
__LIBMLDBL_COMPAT
(roundl);

583 
Ãoundl
–Ë
__LIBMLDBL_COMPAT
(lroundl);

585 #i‡–
deföed
 (
__STDC_VERSION__
Ë&& __STDC_VERSION__ >199901L ) || ! deföed–
__STRICT_ANSI__
 ) || ! deföed–
__GNUC__
 )

587 
Œröé
–Ë
__LIBMLDBL_COMPAT
(llrintl);

588 
Œroundl
–Ë
__LIBMLDBL_COMPAT
(llroundl);

591 
åun˛
–Ë
__LIBMLDBL_COMPAT
(truncl);

592 
fmodl
–, Ë
__LIBMLDBL_COMPAT
(fmodl);

593 
ªmaödîl
–, Ë
__LIBMLDBL_COMPAT
(remainderl);

594 
ªmquﬁ
–, , * ) 
__LIBMLDBL_COMPAT
(remquol);

595 
c›ysig∆
–, Ë
__LIBMLDBL_COMPAT
(copysignl);

596 
«∆
–c⁄° * ) 
__LIBMLDBL_COMPAT
(nanl);

597 
√xè·îl
–, Ë
__LIBMLDBL_COMPAT
(nextafterl);

598 
√xâow¨d
–, Ë
__LIBMLDBL_COMPAT
(nexttoward);

599 
√xâow¨df
–, Ë
__LIBMLDBL_COMPAT
(nexttowardf);

600 
√xâow¨dl
–, Ë
__LIBMLDBL_COMPAT
(nexttowardl);

601 
fdiml
–, Ë
__LIBMLDBL_COMPAT
(fdiml);

602 
fmaxl
–, Ë
__LIBMLDBL_COMPAT
(fmaxl);

603 
fmöl
–, Ë
__LIBMLDBL_COMPAT
(fminl);

604 
fmÆ
–, , Ë
__LIBMLDBL_COMPAT
(fmal);

607 
	#isgª©î
(
x
, 
y
Ë
	`__buûtö_isgª©î
 ((x),(y))

	)

608 
	#isgª©îequÆ
(
x
, 
y
Ë
	`__buûtö_isgª©îequÆ
 ((x),(y))

	)

609 
	#i¶ess
(
x
, 
y
Ë
	`__buûtö_i¶ess
 ((x),(y))

	)

610 
	#i¶es£quÆ
(
x
, 
y
Ë
	`__buûtö_i¶es£quÆ
 ((x),(y))

	)

611 
	#i¶essgª©î
(
x
, 
y
Ë
	`__buûtö_i¶essgª©î
 ((x),(y))

	)

612 
	#isun‹dîed
(
x
, 
y
Ë
	`__buûtö_isun‹dîed
 ((x),(y))

	)

614 
__öf
( );

615 
__öff
( );

616 
__«n
( );

618 #i‡!
deföed
(
_ANSI_SOURCE
)

619 
j0
 ( );

620 
j1
 ( );

621 
jn
 ( , );

623 
y0
 ( );

624 
y1
 ( );

625 
yn
 ( , );

662 #i‡
deföed
–
__µc__
 )

663 #i‡
deföed
–
__GNUC__
 ) && ! deföed–
__XLC__
 ) && ( ! deföed–
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) || __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__-0 >= 1040 )

664 
sˇlb
 ( , Ë
__asm
("_scalb$UNIX2003" );

666 
sˇlb
 ( , );

669 
sˇlb
 ( , );

672 
	#M_E
 2.71828182845904523536028747135266250

	)

673 
	#M_LOG2E
 1.44269504088896340735992468100189214

	)

674 
	#M_LOG10E
 0.434294481903251827651128918916605082

	)

675 
	#M_LN2
 0.693147180559945309417232121458176568

	)

676 
	#M_LN10
 2.30258509299404568401799145468436421

	)

677 
	#M_PI
 3.14159265358979323846264338327950288

	)

678 
	#M_PI_2
 1.57079632679489661923132169163975144

	)

679 
	#M_PI_4
 0.785398163397448309615660845819875721

	)

680 
	#M_1_PI
 0.318309886183790671537767526745028724

	)

681 
	#M_2_PI
 0.636619772367581343075535053490057448

	)

682 
	#M_2_SQRTPI
 1.12837916709551257389615890312154517

	)

683 
	#M_SQRT2
 1.41421356237309504880168872420969808

	)

684 
	#M_SQRT1_2
 0.707106781186547524400844362104849039

	)

686 
	#MAXFLOAT
 (()3.40282346638528860e+38)

	)

687 
signgam
;

691 #i‡!
deföed
(
__NOEXTENSIONS__
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

692 
	#__WANT_EXTENSIONS__


	)

695 #ifde‡
__WANT_EXTENSIONS__


697 
	#FP_SNAN
 
FP_NAN


	)

698 
	#FP_QNAN
 
FP_NAN


	)

700 
röâﬁ
 ( );

702 
roundtﬁ
 ( );

704 
	s__com∂ex_s
 {

705 
	gRól
;

706 
	gImag
;

707 } 
	t__com∂ex_t
;

712 #i‡!
deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

714 #i‡(!
deföed
(
_XOPEN_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

715 
	efdvîsi⁄
 {
	g_fdlibm_õì
 = -1, 
	g_fdlibm_svid
, 
	g_fdlibm_x›í
, 
	g_fdlibm_posix
};

716 
	#fdlibm_õì
 
_fdlibm_õì


	)

717 
	#fdlibm_svid
 
_fdlibm_svid


	)

718 
	#fdlibm_x›í
 
_fdlibm_x›í


	)

719 
	#fdlibm_posix
 
_fdlibm_posix


	)

721 
	#_LIB_VERSION_TYPE
 
fdvîsi⁄


	)

722 
	#_LIB_VERSION
 
_fdlib_vîsi⁄


	)

731 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

733 
	#_IEEE_
 
fdlibm_õì


	)

734 
	#_SVID_
 
fdlibm_svid


	)

735 
	#_XOPEN_
 
fdlibm_x›í


	)

736 
	#_POSIX_
 
fdlibm_posix


	)

738 #i‡!
deföed
(
__˝lu•lus
)

739 
	sex˚±i⁄
 {

740 
	gty≥
;

741 *
	g«me
;

742 
	g¨g1
;

743 
	g¨g2
;

744 
	gªtvÆ
;

748 
	#HUGE
 
MAXFLOAT


	)

755 
	#X_TLOSS
 1.41484755040568800000e+16

	)

757 
	#DOMAIN
 1

	)

758 
	#SING
 2

	)

759 
	#OVERFLOW
 3

	)

760 
	#UNDERFLOW
 4

	)

761 
	#TLOSS
 5

	)

762 
	#PLOSS
 6

	)

767 #i‡!
deföed
–
__STRICT_ANSI__
Ë&& !deföed(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

769 
föôe
 ( );

771 
gamma
 ( );

773 #i‡(!
deföed
(
_XOPEN_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

775 #i‡!
deföed
(
__˝lu•lus
)

776 
m©hîr
 ( 
ex˚±i⁄
 * );

782 
signifiˇnd
 ( );

787 
dªm
 ( , );

793 #ifde‡
_REENTRANT


794 
gamma_r
 ( , * );

795 
lgamma_r
 ( , * );

807 #i‡
deföed
(
__FAST_MATH__
Ë&& !deföed(
__˝lu•lus
)

809 
	#__FSELS
(
e
,
t
,
f
Ë((”Ë>0.0fË? (tË: (f))

	)

810 
	#__FSEL
(
e
,
t
,
f
Ë((”Ë>0.0Ë? (tË: (f))

	)

812 
__ölöe__
 
__Á°m©h_Êo‹f
–
f
 ) 
__©åibuã__
((
__Æways_ölöe__
));

813 
__ölöe__
 
__Á°m©h_Êo‹f
–
f
 )

815 
	gb
, 
	gc
, 
	gd
, 
	ge
, 
	gg
, 
	gh
, 
	gt
;

817 
	gc
 = 
__FSELS
–
f
, -8388608.f, 8388608.‡); 
	gb
 = 
Ábsf
( f );

818 
	gd
 = 
f
 - 
c
; 
	ge
 = 
b
 - 8388608.f;

819 
__asm__
("" : "+f" (
d
));

820 
	gd
 = 
d
 + 
c
;

821 
	gg
 = 
f
 - 
d
;

822 
	gh
 = 
__FSELS
–
g
, 0.0f, 1.0f );

823 
	gt
 = 
d
 - 
h
;

824  
__FSELS
–
e
, 
f
, 
t
 );

827 
__ölöe__
 
__Á°m©h_˚ûf
–
f
 ) 
__©åibuã__
((
__Æways_ölöe__
));

828 
__ölöe__
 
__Á°m©h_˚ûf
–
f
 )

830 
	gb
, 
	gc
, 
	gd
, 
	ge
, 
	gg
, 
	gh
, 
	gt
;

832 
	gc
 = 
__FSELS
–
f
, -8388608.f, 8388608.‡); 
	gb
 = 
Ábsf
( f );

833 
	gd
 = 
f
 - 
c
; 
	ge
 = 
b
 - 8388608.f;

834 
__asm__
("" : "+f" (
d
));

835 
	gd
 = 
d
 + 
c
;

836 
	gg
 = 
d
 - 
f
;

837 
	gh
 = 
__FSELS
–
g
, 0.0f, 1.0f );

838 
	gt
 = 
d
 + 
h
;

839  
__FSELS
–
e
, 
f
, 
t
 );

842 
__ölöe__
 
__Á°m©h_Êo‹
–
f
 ) 
__©åibuã__
((
__Æways_ölöe__
));

843 
__ölöe__
 
__Á°m©h_Êo‹
–
f
 )

845 
	gb
, 
	gc
, 
	gd
, 
	ge
, 
	gg
, 
	gh
, 
	gt
;

847 
	gc
 = 
__FSEL
–
f
, -4503599627370496., 4503599627370496. ); 
	gb
 = 
Ábs
( f );

848 
	gd
 = 
f
 - 
c
; 
	ge
 = 
b
 - 4503599627370496.;

849 
__asm__
("" : "+f" (
d
));

850 
	gd
 = 
d
 + 
c
;

851 
	gg
 = 
f
 - 
d
;

852 
	gh
 = 
__FSEL
–
g
, 0.0, 1.0 );

853 
	gt
 = 
d
 - 
h
;

854  
__FSEL
–
e
, 
f
, 
t
 );

857 
__ölöe__
 
__Á°m©h_˚û
–
f
 ) 
__©åibuã__
((
__Æways_ölöe__
));

858 
__ölöe__
 
__Á°m©h_˚û
–
f
 )

860 
	gb
, 
	gc
, 
	gd
, 
	ge
, 
	gg
, 
	gh
, 
	gt
;

862 
	gc
 = 
__FSEL
–
f
, -4503599627370496., 4503599627370496. ); 
	gb
 = 
Ábs
( f );

863 
	gd
 = 
f
 - 
c
; 
	ge
 = 
b
 - 4503599627370496.;

864 
__asm__
("" : "+f" (
d
));

865 
	gd
 = 
d
 + 
c
;

866 
	gg
 = 
d
 - 
f
;

867 
	gh
 = 
__FSEL
–
g
, 0.0, 1.0 );

868 
	gt
 = 
d
 + 
h
;

869  
__FSEL
–
e
, 
f
, 
t
 );

872 
	#Êo‹f
(
x
Ë
	`__Á°m©h_Êo‹f
((x))

	)

873 
	#˚ûf
(
x
Ë
	`__Á°m©h_˚ûf
((x))

	)

874 
	#Êo‹
(
x
Ë
	`__Á°m©h_Êo‹
((x))

	)

875 
	#˚û
(
x
Ë
	`__Á°m©h_˚û
((x))

	)

879 #ifde‡
__˝lu•lus


	@/usr/include/machine/_limits.h

28 #i‚de‡
_BSD_MACHINE__LIMITS_H_


29 
	#_BSD_MACHINE__LIMITS_H_


	)

31 #i‡
deföed
 (
__i386__
Ë|| deföed(
__x86_64__
)

32 
	~"i386/_limôs.h
"

33 #ñi‡
deföed
 (
__¨m__
)

34 
	~"¨m/_limôs.h
"

36 #îr‹ 
¨chôe˘uª
 
nŸ
 
suµ‹ãd


	@/usr/include/machine/endian.h

31 #i‚de‡
_BSD_MACHINE_ENDIAN_H_


32 
	#_BSD_MACHINE_ENDIAN_H_


	)

34 #i‡
deföed
 (
__i386__
Ë|| deföed(
__x86_64__
)

35 
	~"i386/ídün.h
"

36 #ñi‡
deföed
 (
__¨m__
)

37 
	~"¨m/ídün.h
"

39 #îr‹ 
¨chôe˘uª
 
nŸ
 
suµ‹ãd


	@/usr/include/machine/types.h

31 #i‚de‡
_BSD_MACHINE_TYPES_H_


32 
	#_BSD_MACHINE_TYPES_H_


	)

34 #i‡
deföed
 (
__i386__
Ë|| deföed(
__x86_64__
)

35 
	~"i386/ty≥s.h
"

36 #ñi‡
deföed
 (
__¨m__
)

37 
	~"¨m/ty≥s.h
"

39 #îr‹ 
¨chôe˘uª
 
nŸ
 
suµ‹ãd


	@/usr/include/runetype.h

39 #i‚def 
_RUNETYPE_H_


40 
	#_RUNETYPE_H_


	)

42 
	~<_ty≥s.h
>

44 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

46 #i‚def 
_SIZE_T


47 
	#_SIZE_T


	)

48 
__d¨wö_size_t
 
	tsize_t
;

51 #i‚def 
_CT_RUNE_T


52 
	#_CT_RUNE_T


	)

53 
__d¨wö_˘_ru√_t
 
	t˘_ru√_t
;

56 #i‚def 
_RUNE_T


57 
	#_RUNE_T


	)

58 
__d¨wö_ru√_t
 
	tru√_t
;

61 #i‚def 
__˝lu•lus


62 #i‚def 
_WCHAR_T


63 
	#_WCHAR_T


	)

64 
__d¨wö_wch¨_t
 
	twch¨_t
;

68 #i‚def 
_WINT_T


69 
	#_WINT_T


	)

70 
__d¨wö_wöt_t
 
	twöt_t
;

75 
	#_CACHED_RUNES
 (1 <<8 )

	)

76 
	#_CRMASK
 (~(
_CACHED_RUNES
 - 1))

	)

82 
__d¨wö_ru√_t
 
	m__mö
;

83 
__d¨wö_ru√_t
 
	m__max
;

84 
__d¨wö_ru√_t
 
	m__m≠
;

85 
__uöt32_t
 *
	m__ty≥s
;

86 } 
	t_Ru√E¡ry
;

89 
	m__ƒ™ges
;

90 
_Ru√E¡ry
 *
	m__ønges
;

91 } 
	t_Ru√R™ge
;

94 
	m__«me
[14];

95 
__uöt32_t
 
	m__mask
;

96 } 
	t_Ru√Ch¨Cœss
;

99 
	m__magic
[8];

100 
	m__ícodög
[32];

102 
__d¨wö_ru√_t
 (*
__sgëru√
)(c⁄° *, 
	m__d¨wö_size_t
, const **);

103 (*
	m__•uåu√
)(
	m__d¨wö_ru√_t
, *, 
	m__d¨wö_size_t
, **);

104 
__d¨wö_ru√_t
 
	m__övÆid_ru√
;

106 
__uöt32_t
 
	m__ru√ty≥
[
_CACHED_RUNES
];

107 
__d¨wö_ru√_t
 
	m__m≠lowî
[
_CACHED_RUNES
];

108 
__d¨wö_ru√_t
 
	m__m≠uµî
[
_CACHED_RUNES
];

115 
_Ru√R™ge
 
	m__ru√ty≥_ext
;

116 
_Ru√R™ge
 
	m__m≠lowî_ext
;

117 
_Ru√R™ge
 
	m__m≠uµî_ext
;

119 *
	m__v¨übÀ
;

120 
	m__v¨übÀ_Àn
;

125 
	m__nch¨˛as£s
;

126 
_Ru√Ch¨Cœss
 *
	m__ch¨˛as£s
;

127 } 
	t_Ru√LoˇÀ
;

129 
	#_RUNE_MAGIC_A
 "Ru√MagA"

	)

131 
__BEGIN_DECLS


132 
_Ru√LoˇÀ
 
_DeÁu…Ru√LoˇÀ
;

133 
_Ru√LoˇÀ
 *
_CuºítRu√LoˇÀ
;

134 
	g__END_DECLS


	@/usr/include/secure/_stdio.h

24 #i‚de‡
_STDIO_H_


25 #îr‹ 
îr‹
 "Never use <secure/_stdio.h> directly; include <stdio.h> instead."

28 #i‚de‡
_SECURE__STDIO_H_


29 
	#_SECURE__STDIO_H_


	)

31 
	~<£cuª/_comm⁄.h
>

33 #i‡
_USE_FORTIFY_LEVEL
 > 0

35 #unde‡
•rötf


36 #unde‡
v•rötf


38 #i‡
__DARWIN_C_LEVEL
 >= 200112L

39 #unde‡
¢¥ötf


40 #unde‡
v¢¥ötf


45 
	$__•rötf_chk
 (* 
__ª°ri˘
, , 
size_t
,

46 c⁄° * 
__ª°ri˘
, ...)

47 
	`__DARWIN_LDBL_COMPAT
 (
__•rötf_chk
);

49 
	#•rötf
(
°r
, ...) \

50 
	`__buûtö___•rötf_chk
 (
°r
, 0, 
	`__d¨wö_obsz
(°r), 
__VA_ARGS__
)

	)

52 
	$__¢¥ötf_chk
 (* 
__ª°ri˘
, 
size_t
, , size_t,

53 c⁄° * 
__ª°ri˘
, ...)

54 
	`__DARWIN_LDBL_COMPAT
 (
__¢¥ötf_chk
);

56 #i‡
__DARWIN_C_LEVEL
 >= 200112L

57 
	#¢¥ötf
(
°r
, 
Àn
, ...) \

58 
	`__buûtö___¢¥ötf_chk
 (
°r
, 
Àn
, 0, 
	`__d¨wö_obsz
(°r), 
__VA_ARGS__
)

	)

60 
	$__v•rötf_chk
 (* 
__ª°ri˘
, , 
size_t
,

61 c⁄° * 
__ª°ri˘
, 
va_li°
)

62 
	`__DARWIN_LDBL_COMPAT
 (
__v•rötf_chk
);

64 
	#v•rötf
(
°r
, 
f‹m©
, 
≠
) \

65 
	`__buûtö___v•rötf_chk
 (
°r
, 0, 
	`__d¨wö_obsz
(°r), 
f‹m©
, 
≠
)

	)

67 
	$__v¢¥ötf_chk
 (* 
__ª°ri˘
, 
size_t
, , size_t,

68 c⁄° * 
__ª°ri˘
, 
va_li°
)

69 
	`__DARWIN_LDBL_COMPAT
 (
__v¢¥ötf_chk
);

71 
	#v¢¥ötf
(
°r
, 
Àn
, 
f‹m©
, 
≠
) \

72 
	`__buûtö___v¢¥ötf_chk
 (
°r
, 
Àn
, 0, 
	`__d¨wö_obsz
(°r), 
f‹m©
, 
≠
)

	)

	@/usr/include/secure/_string.h

24 #i‚de‡
_STRING_H_


28 #i‚de‡
_SECURE__STRING_H_


29 
	#_SECURE__STRING_H_


	)

31 
	~<sys/cdefs.h
>

32 
	~<£cuª/_comm⁄.h
>

34 #i‡
_USE_FORTIFY_LEVEL
 > 0

39 #unde‡
mem˝y


40 #unde‡
memmove


41 #unde‡
mem£t


42 #unde‡
°r˝y


43 #i‡
__DARWIN_C_LEVEL
 >= 200809L

44 #unde‡
°p˝y


45 #unde‡
°≤˝y


47 #unde‡
°∫˝y


48 #unde‡
°rˇt


49 #i‡! (
deföed
(
__IPHONE_OS_VERSION_MIN_REQUIRED
) && __IPHONE_OS_VERSION_MIN_REQUIRED < 32000)

50 #unde‡
°∫ˇt


53 
	#mem˝y
(
de°
, 
§c
, 
Àn
) \

54 ((
	`__d¨wö_obsz0
 (
de°
Ë!(
size_t
) -1) \

55 ? 
	`__buûtö___mem˝y_chk
 (
de°
, 
§c
, 
Àn
, 
	`__d¨wö_obsz0
 (dest)) \

56 : 
	`__ölöe_mem˝y_chk
 (
de°
, 
§c
, 
Àn
))

	)

58 
__ölöe
 *

59 
	$__ölöe_mem˝y_chk
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__Àn
)

61  
	`__buûtö___mem˝y_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__d¨wö_obsz0
(__dest));

62 
	}
}

64 
	#memmove
(
de°
, 
§c
, 
Àn
) \

65 ((
	`__d¨wö_obsz0
 (
de°
Ë!(
size_t
) -1) \

66 ? 
	`__buûtö___memmove_chk
 (
de°
, 
§c
, 
Àn
, 
	`__d¨wö_obsz0
 (dest)) \

67 : 
	`__ölöe_memmove_chk
 (
de°
, 
§c
, 
Àn
))

	)

69 
__ölöe
 *

70 
	$__ölöe_memmove_chk
 (*
__de°
, c⁄° *
__§c
, 
size_t
 
__Àn
)

72  
	`__buûtö___memmove_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__d¨wö_obsz0
(__dest));

73 
	}
}

75 
	#mem£t
(
de°
, 
vÆ
, 
Àn
) \

76 ((
	`__d¨wö_obsz0
 (
de°
Ë!(
size_t
) -1) \

77 ? 
	`__buûtö___mem£t_chk
 (
de°
, 
vÆ
, 
Àn
, 
	`__d¨wö_obsz0
 (dest)) \

78 : 
	`__ölöe_mem£t_chk
 (
de°
, 
vÆ
, 
Àn
))

	)

80 
__ölöe
 *

81 
	$__ölöe_mem£t_chk
 (*
__de°
, 
__vÆ
, 
size_t
 
__Àn
)

83  
	`__buûtö___mem£t_chk
 (
__de°
, 
__vÆ
, 
__Àn
, 
	`__d¨wö_obsz0
(__dest));

84 
	}
}

86 
	#°r˝y
(
de°
, 
§c
) \

87 ((
	`__d¨wö_obsz0
 (
de°
Ë!(
size_t
) -1) \

88 ? 
	`__buûtö___°r˝y_chk
 (
de°
, 
§c
, 
	`__d¨wö_obsz
 (dest)) \

89 : 
	`__ölöe_°r˝y_chk
 (
de°
, 
§c
))

	)

91 
__ölöe
 *

92 
	$__ölöe_°r˝y_chk
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

94  
	`__buûtö___°r˝y_chk
 (
__de°
, 
__§c
, 
	`__d¨wö_obsz
(__dest));

95 
	}
}

97 #i‡
__DARWIN_C_LEVEL
 >= 200809L

98 
	#°p˝y
(
de°
, 
§c
) \

99 ((
	`__d¨wö_obsz0
 (
de°
Ë!(
size_t
) -1) \

100 ? 
	`__buûtö___°p˝y_chk
 (
de°
, 
§c
, 
	`__d¨wö_obsz
 (dest)) \

101 : 
	`__ölöe_°p˝y_chk
 (
de°
, 
§c
))

	)

103 
__ölöe
 *

104 
	$__ölöe_°p˝y_chk
 (*
__de°
, c⁄° *
__§c
)

106  
	`__buûtö___°p˝y_chk
 (
__de°
, 
__§c
, 
	`__d¨wö_obsz
(__dest));

107 
	}
}

109 
	#°≤˝y
(
de°
, 
§c
, 
Àn
) \

110 ((
	`__d¨wö_obsz0
 (
de°
Ë!(
size_t
) -1) \

111 ? 
	`__buûtö___°≤˝y_chk
 (
de°
, 
§c
, 
Àn
, 
	`__d¨wö_obsz
 (dest)) \

112 : 
	`__ölöe_°≤˝y_chk
 (
de°
, 
§c
, 
Àn
))

	)

114 
__ölöe
 *

115 
	$__ölöe_°≤˝y_chk
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

116 
size_t
 
__Àn
)

118  
	`__buûtö___°≤˝y_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__d¨wö_obsz
(__dest));

119 
	}
}

122 
	#°∫˝y
(
de°
, 
§c
, 
Àn
) \

123 ((
	`__d¨wö_obsz0
 (
de°
Ë!(
size_t
) -1) \

124 ? 
	`__buûtö___°∫˝y_chk
 (
de°
, 
§c
, 
Àn
, 
	`__d¨wö_obsz
 (dest)) \

125 : 
	`__ölöe_°∫˝y_chk
 (
de°
, 
§c
, 
Àn
))

	)

127 
__ölöe
 *

128 
	$__ölöe_°∫˝y_chk
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

129 
size_t
 
__Àn
)

131  
	`__buûtö___°∫˝y_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__d¨wö_obsz
(__dest));

132 
	}
}

134 
	#°rˇt
(
de°
, 
§c
) \

135 ((
	`__d¨wö_obsz0
 (
de°
Ë!(
size_t
) -1) \

136 ? 
	`__buûtö___°rˇt_chk
 (
de°
, 
§c
, 
	`__d¨wö_obsz
 (dest)) \

137 : 
	`__ölöe_°rˇt_chk
 (
de°
, 
§c
))

	)

139 
__ölöe
 *

140 
	$__ölöe_°rˇt_chk
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
)

142  
	`__buûtö___°rˇt_chk
 (
__de°
, 
__§c
, 
	`__d¨wö_obsz
(__dest));

143 
	}
}

145 #i‡! (
deföed
(
__IPHONE_OS_VERSION_MIN_REQUIRED
) && __IPHONE_OS_VERSION_MIN_REQUIRED < 32000)

146 
	#°∫ˇt
(
de°
, 
§c
, 
Àn
) \

147 ((
	`__d¨wö_obsz0
 (
de°
Ë!(
size_t
) -1) \

148 ? 
	`__buûtö___°∫ˇt_chk
 (
de°
, 
§c
, 
Àn
, 
	`__d¨wö_obsz
 (dest)) \

149 : 
	`__ölöe_°∫ˇt_chk
 (
de°
, 
§c
, 
Àn
))

	)

151 
__ölöe
 *

152 
	$__ölöe_°∫ˇt_chk
 (*
__ª°ri˘
 
__de°
, c⁄° *__ª°ri˘ 
__§c
,

153 
size_t
 
__Àn
)

155  
	`__buûtö___°∫ˇt_chk
 (
__de°
, 
__§c
, 
__Àn
, 
	`__d¨wö_obsz
(__dest));

156 
	}
}

	@/usr/include/stdbool.h

29 #i‚de‡
_STDBOOL_H_


30 
	#_STDBOOL_H_


	)

32 
	#__boﬁ_åue_Ál£_¨e_deföed
 1

	)

34 #i‚de‡
__˝lu•lus


36 
	#boﬁ
 
_Boﬁ


	)

37 #i‡
__STDC_VERSION__
 < 199901L && 
__GNUC__
 < 3

38 
	t_Boﬁ
;

41 
	#Ál£
 0

	)

42 
	#åue
 1

	)

	@/usr/include/stdint.h

6 #i‚de‡
_STDINT_H_


7 
	#_STDINT_H_


	)

9 #i‡
__LP64__


10 
	#__WORDSIZE
 64

	)

12 
	#__WORDSIZE
 32

	)

18 #i‚de‡
_INT8_T


19 
	#_INT8_T


	)

20 sig√d 
	töt8_t
;

23 #i‚de‡
_INT16_T


24 
	#_INT16_T


	)

25 
	töt16_t
;

28 #i‚de‡
_INT32_T


29 
	#_INT32_T


	)

30 
	töt32_t
;

33 #i‚de‡
_INT64_T


34 
	#_INT64_T


	)

35 
	töt64_t
;

38 #i‚de‡
_UINT8_T


39 
	#_UINT8_T


	)

40 
	tuöt8_t
;

43 #i‚de‡
_UINT16_T


44 
	#_UINT16_T


	)

45 
	tuöt16_t
;

48 #i‚de‡
_UINT32_T


49 
	#_UINT32_T


	)

50 
	tuöt32_t
;

53 #i‚de‡
_UINT64_T


54 
	#_UINT64_T


	)

55 
	tuöt64_t
;

59 
öt8_t
 
	töt_Àa°8_t
;

60 
öt16_t
 
	töt_Àa°16_t
;

61 
öt32_t
 
	töt_Àa°32_t
;

62 
öt64_t
 
	töt_Àa°64_t
;

63 
uöt8_t
 
	tuöt_Àa°8_t
;

64 
uöt16_t
 
	tuöt_Àa°16_t
;

65 
uöt32_t
 
	tuöt_Àa°32_t
;

66 
uöt64_t
 
	tuöt_Àa°64_t
;

70 
öt8_t
 
	töt_Á°8_t
;

71 
öt16_t
 
	töt_Á°16_t
;

72 
öt32_t
 
	töt_Á°32_t
;

73 
öt64_t
 
	töt_Á°64_t
;

74 
uöt8_t
 
	tuöt_Á°8_t
;

75 
uöt16_t
 
	tuöt_Á°16_t
;

76 
uöt32_t
 
	tuöt_Á°32_t
;

77 
uöt64_t
 
	tuöt_Á°64_t
;

82 #i‚de‡
_INTPTR_T


83 
	#_INTPTR_T


	)

84 
	töçå_t
;

87 #i‚de‡
_UINTPTR_T


88 
	#_UINTPTR_T


	)

89 
	tuöçå_t
;

94 #i‚de‡
_INTMAX_T


95 
	#_INTMAX_T


	)

96 #ifde‡
__INTMAX_TYPE__


97 
__INTMAX_TYPE__
 
	tötmax_t
;

99 
	tötmax_t
;

103 #i‚de‡
_UINTMAX_T


104 
	#_UINTMAX_T


	)

105 #ifde‡
__UINTMAX_TYPE__


106 
__UINTMAX_TYPE__
 
	tuötmax_t
;

108 
	tuötmax_t
;

119 
	#INT8_MAX
 127

	)

120 
	#INT16_MAX
 32767

	)

121 
	#INT32_MAX
 2147483647

	)

122 
	#INT64_MAX
 9223372036854775807LL

	)

124 
	#INT8_MIN
 -128

	)

125 
	#INT16_MIN
 -32768

	)

132 
	#INT32_MIN
 (-
INT32_MAX
-1)

	)

133 
	#INT64_MIN
 (-
INT64_MAX
-1)

	)

135 
	#UINT8_MAX
 255

	)

136 
	#UINT16_MAX
 65535

	)

137 
	#UINT32_MAX
 4294967295U

	)

138 
	#UINT64_MAX
 18446744073709551615ULL

	)

141 
	#INT_LEAST8_MIN
 
INT8_MIN


	)

142 
	#INT_LEAST16_MIN
 
INT16_MIN


	)

143 
	#INT_LEAST32_MIN
 
INT32_MIN


	)

144 
	#INT_LEAST64_MIN
 
INT64_MIN


	)

146 
	#INT_LEAST8_MAX
 
INT8_MAX


	)

147 
	#INT_LEAST16_MAX
 
INT16_MAX


	)

148 
	#INT_LEAST32_MAX
 
INT32_MAX


	)

149 
	#INT_LEAST64_MAX
 
INT64_MAX


	)

151 
	#UINT_LEAST8_MAX
 
UINT8_MAX


	)

152 
	#UINT_LEAST16_MAX
 
UINT16_MAX


	)

153 
	#UINT_LEAST32_MAX
 
UINT32_MAX


	)

154 
	#UINT_LEAST64_MAX
 
UINT64_MAX


	)

157 
	#INT_FAST8_MIN
 
INT8_MIN


	)

158 
	#INT_FAST16_MIN
 
INT16_MIN


	)

159 
	#INT_FAST32_MIN
 
INT32_MIN


	)

160 
	#INT_FAST64_MIN
 
INT64_MIN


	)

162 
	#INT_FAST8_MAX
 
INT8_MAX


	)

163 
	#INT_FAST16_MAX
 
INT16_MAX


	)

164 
	#INT_FAST32_MAX
 
INT32_MAX


	)

165 
	#INT_FAST64_MAX
 
INT64_MAX


	)

167 
	#UINT_FAST8_MAX
 
UINT8_MAX


	)

168 
	#UINT_FAST16_MAX
 
UINT16_MAX


	)

169 
	#UINT_FAST32_MAX
 
UINT32_MAX


	)

170 
	#UINT_FAST64_MAX
 
UINT64_MAX


	)

174 #i‡
__WORDSIZE
 == 64

175 
	#INTPTR_MIN
 
INT64_MIN


	)

176 
	#INTPTR_MAX
 
INT64_MAX


	)

178 
	#INTPTR_MIN
 
INT32_MIN


	)

179 
	#INTPTR_MAX
 
INT32_MAX


	)

182 #i‡
__WORDSIZE
 == 64

183 
	#UINTPTR_MAX
 
UINT64_MAX


	)

185 
	#UINTPTR_MAX
 
UINT32_MAX


	)

189 
	#INTMAX_MIN
 
INT64_MIN


	)

190 
	#INTMAX_MAX
 
INT64_MAX


	)

192 
	#UINTMAX_MAX
 
UINT64_MAX


	)

195 #i‡
__WORDSIZE
 == 64

196 
	#PTRDIFF_MIN
 
INT64_MIN


	)

197 
	#PTRDIFF_MAX
 
INT64_MAX


	)

199 
	#PTRDIFF_MIN
 
INT32_MIN


	)

200 
	#PTRDIFF_MAX
 
INT32_MAX


	)

207 #i‡
__WORDSIZE
 == 64

208 
	#SIZE_MAX
 
UINT64_MAX


	)

210 
	#SIZE_MAX
 
UINT32_MAX


	)

213 #i‚de‡
WCHAR_MAX


214 #ifde‡
__WCHAR_MAX__


215 
	#WCHAR_MAX
 
__WCHAR_MAX__


	)

217 
	#WCHAR_MAX
 0x7fffffff

	)

225 #i‚de‡
WCHAR_MIN


226 #i‡
WCHAR_MAX
 == 0xffff

227 
	#WCHAR_MIN
 0

	)

229 
	#WCHAR_MIN
 (-
WCHAR_MAX
-1)

	)

233 
	#WINT_MIN
 
INT32_MIN


	)

234 
	#WINT_MAX
 
INT32_MAX


	)

236 
	#SIG_ATOMIC_MIN
 
INT32_MIN


	)

237 
	#SIG_ATOMIC_MAX
 
INT32_MAX


	)

240 
	#INT8_C
(
v
Ë(v)

	)

241 
	#INT16_C
(
v
Ë(v)

	)

242 
	#INT32_C
(
v
Ë(v)

	)

243 
	#INT64_C
(
v
Ë(v ## 
LL
)

	)

245 
	#UINT8_C
(
v
Ë(v ## 
U
)

	)

246 
	#UINT16_C
(
v
Ë(v ## 
U
)

	)

247 
	#UINT32_C
(
v
Ë(v ## 
U
)

	)

248 
	#UINT64_C
(
v
Ë(v ## 
ULL
)

	)

250 
	#INTMAX_C
(
v
Ë(v ## 
LL
)

	)

251 
	#UINTMAX_C
(
v
Ë(v ## 
ULL
)

	)

	@/usr/include/strings.h

58 #i‚de‡
_STRINGS_H_


59 
	#_STRINGS_H_


	)

61 
	~<_ty≥s.h
>

63 
	~<sys/cdefs.h
>

64 
	~<Avaûabûôy.h
>

66 #i‚def 
_SIZE_T


67 
	#_SIZE_T


	)

68 
__d¨wö_size_t
 
	tsize_t
;

71 
	g__BEGIN_DECLS


73 #i‡!
deföed
(
_POSIX_C_SOURCE
) || _POSIX_C_SOURCE < 200809L

74 
	$bcmp
(c⁄° *, c⁄° *, 
size_t
Ë
	`__POSIX_C_DEPRECATED
(200112L);

75 
	$bc›y
(c⁄° *, *, 
size_t
Ë
	`__POSIX_C_DEPRECATED
(200112L);

76 
	$bzîo
(*, 
size_t
Ë
	`__POSIX_C_DEPRECATED
(200112L);

77 *
	$ödex
(c⁄° *, Ë
	`__POSIX_C_DEPRECATED
(200112L);

78 *
	$rödex
(c⁄° *, Ë
	`__POSIX_C_DEPRECATED
(200112L);

81 
	`ffs
();

82 
	`°rˇ£cmp
(const *, const *);

83 
	`°∫ˇ£cmp
(c⁄° *, c⁄° *, 
size_t
);

84 
__END_DECLS


87 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


88 
__BEGIN_DECLS


89 
	$ff¶
(Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_2_0
);

90 
	$Ês
(Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_2_0
);

91 
	$Ê¶
(Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_2_0
);

92 
__END_DECLS


94 
	~<°rög.h
>

	@/usr/include/sys/_select.h

36 #i‚de‡
_SYS__SELECT_H_


37 
	#_SYS__SELECT_H_


	)

39 
	$£À˘
(, 
fd_£t
 * 
__ª°ri˘
, fd_set * __restrict,

40 
fd_£t
 * 
__ª°ri˘
, 
timevÆ
 * __restrict)

41 #i‡
	`deföed
(
_DARWIN_C_SOURCE
Ë|| deföed(
_DARWIN_UNLIMITED_SELECT
)

42 
	$__DARWIN_EXTSN_C
(
£À˘
)

44 #i‡
	`deföed
(
__LP64__
Ë&& !
__DARWIN_NON_CANCELABLE


45 
	$__DARWIN_1050
(
£À˘
)

47 
	$__DARWIN_ALIAS_C
(
£À˘
)

	@/usr/include/sys/_structs.h

29 
	~<sys/cdefs.h
>

30 
	~<sys/_ty≥s.h
>

32 #ifde‡
__√ed_uc⁄ãxt_t


33 #i‚de‡
__√ed_°ru˘_uc⁄ãxt


34 
	#__√ed_°ru˘_uc⁄ãxt


	)

38 #ifde‡
__√ed_uc⁄ãxt64_t


39 #i‚de‡
__√ed_°ru˘_uc⁄ãxt64


40 
	#__√ed_°ru˘_uc⁄ãxt64


	)

44 #ifde‡
__√ed_°ru˘_uc⁄ãxt


45 #i‚de‡
__√ed_°ru˘_mc⁄ãxt


46 
	#__√ed_°ru˘_mc⁄ãxt


	)

50 #ifde‡
__√ed_°ru˘_uc⁄ãxt64


51 #i‚de‡
__√ed_°ru˘_mc⁄ãxt64


52 
	#__√ed_°ru˘_mc⁄ãxt64


	)

56 #i‡
deföed
(
__√ed_°ru˘_mc⁄ãxt
Ë|| deföed(
__√ed_°ru˘_mc⁄ãxt64
)

57 
	~<machöe/_°ru˘s.h
>

60 #i‡
deföed
(
__√ed_°ack_t
Ë|| deföed(
__√ed_°ru˘_uc⁄ãxt
Ë|| deföed(
__√ed_°ru˘_uc⁄ãxt64
)

61 #i‚de‡
__√ed_°ru˘_sigÆt°ack


62 
	#__√ed_°ru˘_sigÆt°ack


	)

66 #ifde‡
__√ed_°ru˘_sigÆt°ack


67 #unde‡
__√ed_°ru˘_sigÆt°ack


69 #i‚de‡
_STRUCT_SIGALTSTACK


70 #i‡
__DARWIN_UNIX03


71 
	#_STRUCT_SIGALTSTACK
 
__d¨wö_sigÆt°ack


	)

73 
	#_STRUCT_SIGALTSTACK
 
sigÆt°ack


	)

75 
	g_STRUCT_SIGALTSTACK


77 *
	gss_•
;

78 
__d¨wö_size_t
 
	gss_size
;

79 
	gss_Êags
;

84 #ifde‡
__√ed_°ru˘_time•ec


85 #unde‡
__√ed_°ru˘_time•ec


86 #i‚de‡
_STRUCT_TIMESPEC


87 
	#_STRUCT_TIMESPEC
 
time•ec


	)

88 
	g_STRUCT_TIMESPEC


90 
__d¨wö_time_t
 
	gtv_£c
;

91 
	gtv_n£c
;

96 #ifde‡
__√ed_°ru˘_timevÆ


97 #unde‡
__√ed_°ru˘_timevÆ


98 #i‚de‡
_STRUCT_TIMEVAL


99 
	#_STRUCT_TIMEVAL
 
timevÆ


	)

100 
	g_STRUCT_TIMEVAL


102 
__d¨wö_time_t
 
	gtv_£c
;

103 
__d¨wö_su£c⁄ds_t
 
	gtv_u£c
;

108 #ifde‡
__√ed_°ru˘_timevÆ32


109 #unde‡
__√ed_°ru˘_timevÆ32


110 #i‚de‡
_STRUCT_TIMEVAL32


111 
	#_STRUCT_TIMEVAL32
 
timevÆ32


	)

112 
	g_STRUCT_TIMEVAL32


114 
__öt32_t
 
	gtv_£c
;

115 
__öt32_t
 
	gtv_u£c
;

120 #ifde‡
__√ed_°ru˘_uc⁄ãxt


121 #unde‡
__√ed_°ru˘_uc⁄ãxt


122 #i‚de‡
_STRUCT_UCONTEXT


123 #i‡
__DARWIN_UNIX03


124 
	#_STRUCT_UCONTEXT
 
__d¨wö_uc⁄ãxt


	)

126 
	#_STRUCT_UCONTEXT
 
uc⁄ãxt


	)

128 
	g_STRUCT_UCONTEXT


130 
	guc_⁄°ack
;

131 
__d¨wö_sig£t_t
 
	guc_sigmask
;

132 
_STRUCT_SIGALTSTACK
 
	guc_°ack
;

133 
_STRUCT_UCONTEXT
 *
	guc_lök
;

134 
__d¨wö_size_t
 
	guc_mcsize
;

135 
_STRUCT_MCONTEXT
 *
	guc_mc⁄ãxt
;

136 #ifde‡
_XOPEN_SOURCE


137 
_STRUCT_MCONTEXT
 
	g__mc⁄ãxt_d©a
;

143 #ifde‡
__√ed_°ru˘_uc⁄ãxt64


144 #unde‡
__√ed_°ru˘_uc⁄ãxt64


145 #i‚de‡
_STRUCT_UCONTEXT64


146 #i‡
__DARWIN_UNIX03


147 
	#_STRUCT_UCONTEXT64
 
__d¨wö_uc⁄ãxt64


	)

149 
	#_STRUCT_UCONTEXT64
 
uc⁄ãxt64


	)

151 
	g_STRUCT_UCONTEXT64


153 
	guc_⁄°ack
;

154 
__d¨wö_sig£t_t
 
	guc_sigmask
;

155 
_STRUCT_SIGALTSTACK
 
	guc_°ack
;

156 
_STRUCT_UCONTEXT64
 *
	guc_lök
;

157 
__d¨wö_size_t
 
	guc_mcsize
;

158 
_STRUCT_MCONTEXT64
 *
	guc_mc⁄ãxt64
;

164 #ifde‡
__√ed_fd_£t


165 #unde‡
__√ed_fd_£t


166 #i‚de‡
_FD_SET


167 
	#_FD_SET


	)

174 #ifde‡
FD_SETSIZE


175 
	#__DARWIN_FD_SETSIZE
 
FD_SETSIZE


	)

177 
	#__DARWIN_FD_SETSIZE
 1024

	)

179 
	#__DARWIN_NBBY
 8

	)

180 
	#__DARWIN_NFDBITS
 ((
__öt32_t
Ë* 
__DARWIN_NBBY
Ë

	)

181 
	#__DARWIN_howm™y
(
x
, 
y
Ë((((xË% (y)Ë=0Ë? ((xË/ (y)Ë: (((xË/ (y)Ë+ 1)Ë

	)

183 
__BEGIN_DECLS


184 
	sfd_£t
 {

185 
__öt32_t
 
	mfds_bôs
[
__DARWIN_howm™y
(
__DARWIN_FD_SETSIZE
, 
__DARWIN_NFDBITS
)];

186 } 
	tfd_£t
;

187 
__END_DECLS


190 
__ölöe
 

191 
	$__d¨wö_fd_is£t
(
_n
, c⁄° 
fd_£t
 *
_p
)

193  (
_p
->
fds_bôs
[
_n
/
__DARWIN_NFDBITS
] & (1<<(_n % __DARWIN_NFDBITS)));

194 
	}
}

196 
	#__DARWIN_FD_SET
(
n
, 
p
Ëdÿ{ 
__fd
 = (n); (’)->
fds_bôs
[__fd/
__DARWIN_NFDBITS
] |(1<<(__fd % __DARWIN_NFDBITS))); } 0)

	)

197 
	#__DARWIN_FD_CLR
(
n
, 
p
Ëdÿ{ 
__fd
 = (n); (’)->
fds_bôs
[__fd/
__DARWIN_NFDBITS
] &~(1<<(__fd % __DARWIN_NFDBITS))); } 0)

	)

198 
	#__DARWIN_FD_ISSET
(
n
, 
p
Ë
	`__d¨wö_fd_is£t
(“), (p))

	)

200 #i‡
__GNUC__
 > 3 || __GNUC__ =3 && 
__GNUC_MINOR__
 >= 3

205 
	#__DARWIN_FD_ZERO
(
p
Ë
	`__buûtö_bzîo
’, (*’)))

	)

207 
	#__DARWIN_FD_ZERO
(
p
Ë
	`bzîo
’, (*’)))

	)

210 
	#__DARWIN_FD_COPY
(
f
, 
t
Ë
	`bc›y
(f,Å, (*(f)))

	)

214 #ifde‡
__√ed_°ack_t


215 #unde‡
__√ed_°ack_t


216 #i‚de‡
_STACK_T


217 
	#_STACK_T


	)

218 
_STRUCT_SIGALTSTACK
 
	t°ack_t
;

222 #ifde‡
__√ed_uc⁄ãxt_t


223 #unde‡
__√ed_uc⁄ãxt_t


225 #i‚de‡
_UCONTEXT_T


226 
	#_UCONTEXT_T


	)

227 
_STRUCT_UCONTEXT
 
	tuc⁄ãxt_t
;

231 #ifde‡
__√ed_uc⁄ãxt64_t


232 #unde‡
__√ed_uc⁄ãxt64_t


233 #i‚de‡
_UCONTEXT64_T


234 
	#_UCONTEXT64_T


	)

235 
_STRUCT_UCONTEXT64
 
	tuc⁄ãxt64_t
;

	@/usr/include/sys/_types.h

29 #i‚de‡
_SYS__TYPES_H_


30 
	#_SYS__TYPES_H_


	)

32 
	~<sys/cdefs.h
>

33 
	~<machöe/_ty≥s.h
>

36 #i‡
deföed
(
__LP64__
)

37 
	#__PTHREAD_SIZE__
 1168

	)

38 
	#__PTHREAD_ATTR_SIZE__
 56

	)

39 
	#__PTHREAD_MUTEXATTR_SIZE__
 8

	)

40 
	#__PTHREAD_MUTEX_SIZE__
 56

	)

41 
	#__PTHREAD_CONDATTR_SIZE__
 8

	)

42 
	#__PTHREAD_COND_SIZE__
 40

	)

43 
	#__PTHREAD_ONCE_SIZE__
 8

	)

44 
	#__PTHREAD_RWLOCK_SIZE__
 192

	)

45 
	#__PTHREAD_RWLOCKATTR_SIZE__
 16

	)

47 
	#__PTHREAD_SIZE__
 596

	)

48 
	#__PTHREAD_ATTR_SIZE__
 36

	)

49 
	#__PTHREAD_MUTEXATTR_SIZE__
 8

	)

50 
	#__PTHREAD_MUTEX_SIZE__
 40

	)

51 
	#__PTHREAD_CONDATTR_SIZE__
 4

	)

52 
	#__PTHREAD_COND_SIZE__
 24

	)

53 
	#__PTHREAD_ONCE_SIZE__
 4

	)

54 
	#__PTHREAD_RWLOCK_SIZE__
 124

	)

55 
	#__PTHREAD_RWLOCKATTR_SIZE__
 12

	)

58 
	s__d¨wö_±hªad_h™dÀr_ªc


60 (*
	m__routöe
)(*);

61 *
	m__¨g
;

62 
__d¨wö_±hªad_h™dÀr_ªc
 *
	m__√xt
;

64 
	s_›aque_±hªad_©å_t
 { 
	m__sig
; 
	m__›aque
[
__PTHREAD_ATTR_SIZE__
]; };

65 
	s_›aque_±hªad_c⁄d_t
 { 
	m__sig
; 
	m__›aque
[
__PTHREAD_COND_SIZE__
]; };

66 
	s_›aque_±hªad_c⁄d©å_t
 { 
	m__sig
; 
	m__›aque
[
__PTHREAD_CONDATTR_SIZE__
]; };

67 
	s_›aque_±hªad_muãx_t
 { 
	m__sig
; 
	m__›aque
[
__PTHREAD_MUTEX_SIZE__
]; };

68 
	s_›aque_±hªad_muãx©å_t
 { 
	m__sig
; 
	m__›aque
[
__PTHREAD_MUTEXATTR_SIZE__
]; };

69 
	s_›aque_±hªad_⁄˚_t
 { 
	m__sig
; 
	m__›aque
[
__PTHREAD_ONCE_SIZE__
]; };

70 
	s_›aque_±hªad_rwlock_t
 { 
	m__sig
; 
	m__›aque
[
__PTHREAD_RWLOCK_SIZE__
]; };

71 
	s_›aque_±hªad_rwlock©å_t
 { 
	m__sig
; 
	m__›aque
[
__PTHREAD_RWLOCKATTR_SIZE__
]; };

72 
	s_›aque_±hªad_t
 { 
	m__sig
; 
__d¨wö_±hªad_h™dÀr_ªc
 *
	m__˛ónup_°ack
; 
	m__›aque
[
__PTHREAD_SIZE__
]; };

80 #ifde‡
__˝lu•lus


81 #ifde‡
__GNUG__


82 
	#__DARWIN_NULL
 
__nuŒ


	)

84 #ifde‡
__LP64__


85 
	#__DARWIN_NULL
 (0L)

	)

87 
	#__DARWIN_NULL
 0

	)

91 
	#__DARWIN_NULL
 ((*)0)

	)

94 
__öt64_t
 
	t__d¨wö_blk˙t_t
;

95 
__öt32_t
 
	t__d¨wö_blksize_t
;

96 
__öt32_t
 
	t__d¨wö_dev_t
;

97 
	t__d¨wö_fsblk˙t_t
;

98 
	t__d¨wö_fsfû˙t_t
;

99 
__uöt32_t
 
	t__d¨wö_gid_t
;

100 
__uöt32_t
 
	t__d¨wö_id_t
;

101 
__uöt64_t
 
	t__d¨wö_öo64_t
;

102 #i‡
__DARWIN_64_BIT_INO_T


103 
__d¨wö_öo64_t
 
	t__d¨wö_öo_t
;

105 
__uöt32_t
 
	t__d¨wö_öo_t
;

107 
__d¨wö_«tuøl_t
 
	t__d¨wö_mach_p‹t_«me_t
;

108 
__d¨wö_mach_p‹t_«me_t
 
	t__d¨wö_mach_p‹t_t
;

109 
__uöt16_t
 
	t__d¨wö_mode_t
;

110 
__öt64_t
 
	t__d¨wö_off_t
;

111 
__öt32_t
 
	t__d¨wö_pid_t
;

112 
_›aque_±hªad_©å_t


113 
	t__d¨wö_±hªad_©å_t
;

114 
_›aque_±hªad_c⁄d_t


115 
	t__d¨wö_±hªad_c⁄d_t
;

116 
_›aque_±hªad_c⁄d©å_t


117 
	t__d¨wö_±hªad_c⁄d©å_t
;

118 
	t__d¨wö_±hªad_key_t
;

119 
_›aque_±hªad_muãx_t


120 
	t__d¨wö_±hªad_muãx_t
;

121 
_›aque_±hªad_muãx©å_t


122 
	t__d¨wö_±hªad_muãx©å_t
;

123 
_›aque_±hªad_⁄˚_t


124 
	t__d¨wö_±hªad_⁄˚_t
;

125 
_›aque_±hªad_rwlock_t


126 
	t__d¨wö_±hªad_rwlock_t
;

127 
_›aque_±hªad_rwlock©å_t


128 
	t__d¨wö_±hªad_rwlock©å_t
;

129 
_›aque_±hªad_t


130 *
	t__d¨wö_±hªad_t
;

131 
__uöt32_t
 
	t__d¨wö_sig£t_t
;

132 
__öt32_t
 
	t__d¨wö_su£c⁄ds_t
;

133 
__uöt32_t
 
	t__d¨wö_uid_t
;

134 
__uöt32_t
 
	t__d¨wö_u£c⁄ds_t
;

135 
	t__d¨wö_uuid_t
[16];

136 
	t__d¨wö_uuid_°rög_t
[37];

	@/usr/include/sys/appleapiopts.h

29 #i‚de‡
__SYS_APPLEAPIOPTS_H__


30 
	#__SYS_APPLEAPIOPTS_H__


	)

33 #i‚de‡
__APPLE_API_STANDARD


34 
	#__APPLE_API_STANDARD


	)

37 #i‚de‡
__APPLE_API_STABLE


38 
	#__APPLE_API_STABLE


	)

41 #i‚de‡
__APPLE_API_STRICT_CONFORMANCE


43 #i‚de‡
__APPLE_API_EVOLVING


44 
	#__APPLE_API_EVOLVING


	)

47 #i‚de‡
__APPLE_API_UNSTABLE


48 
	#__APPLE_API_UNSTABLE


	)

51 #i‚de‡
__APPLE_API_PRIVATE


52 
	#__APPLE_API_PRIVATE


	)

55 #i‚de‡
__APPLE_API_OBSOLETE


56 
	#__APPLE_API_OBSOLETE


	)

	@/usr/include/sys/cdefs.h

67 #i‚def 
_CDEFS_H_


68 
	#_CDEFS_H_


	)

70 #i‡
deföed
(
__˝lu•lus
)

71 
	#__BEGIN_DECLS
 "C" {

	)

72 
	#__END_DECLS
 }

	)

74 
	#__BEGIN_DECLS


	)

75 
	#__END_DECLS


	)

85 #i‡
deföed
(
__STDC__
Ë|| deföed(
__˝lu•lus
)

86 
	#__P
(
¥Ÿos
Ë¥Ÿo†

	)

87 
	#__CONCAT
(
x
,
y
Ëx ## 
	)
y

88 
	#__STRING
(
x
Ë#x

	)

90 
	#__c⁄°
 c⁄°

	)

91 
	#__sig√d
 sig√d

	)

92 
	#__vﬁ©ûe
 vﬁ©ûe

	)

93 #i‡
deföed
(
__˝lu•lus
)

94 
	#__ölöe
 
ölöe


	)

96 #i‚de‡
__GNUC__


97 
	#__ölöe


	)

102 
	#__P
(
¥Ÿos
Ë(Ë

	)

103 
	#__CONCAT
(
x
,
y
Ëx 
	)
y

104 
	#__STRING
(
x
Ë"x"

	)

106 #i‚de‡
__GNUC__


107 
	#__c⁄°


	)

108 
	#__ölöe


	)

109 
	#__sig√d


	)

110 
	#__vﬁ©ûe


	)

121 #i‚def 
NO_ANSI_KEYWORDS


122 c⁄° 
__c⁄°


	)

123 
	#ölöe
 
__ölöe


	)

124 sig√d 
__sig√d


	)

125 vﬁ©ûê
__vﬁ©ûe


	)

137 #i‡
deföed
(
__MWERKS__
) && (__MWERKS__ > 0x2400)

139 #ñi‡
__GNUC__
 > 2 || __GNUC__ =2 && 
__GNUC_MINOR__
 >= 5

140 
	#__dód2
 
	`__©åibuã__
((
__n‹ëu∫__
))

	)

141 
	#__puª2
 
	`__©åibuã__
((
__c⁄°__
))

	)

142 #i‡
__GNUC__
 =2 && 
__GNUC_MINOR__
 >= 5 && __GNUC_MINOR__ < 7

143 
	#__unu£d


	)

145 
	#__unu£d
 
	`__©åibuã__
((
__unu£d__
))

	)

148 
	#__©åibuã__
(
x
Ë

	)

149 #i‡
deföed
(
__GNUC__
Ë&& !deföed(
__STRICT_ANSI__
)

151 
	#__dód
 
__vﬁ©ûe


	)

152 
	#__puª
 
__c⁄°


	)

157 #i‚de‡
__dód


158 
	#__dód


	)

159 
	#__puª


	)

161 #i‚de‡
__dód2


162 
	#__dód2


	)

163 
	#__puª2


	)

164 
	#__unu£d


	)

167 #i‡
deföed
(
__GNUC__
) && __GNUC__ >= 4

168 
	#__u£d
 
	`__©åibuã__
((
__u£d__
))

	)

170 
	#__u£d


	)

179 #i‡!(
__GNUC__
 =2 && 
__GNUC_MINOR__
 == 95)

180 #i‡
__STDC_VERSION__
 < 199901

181 
	#__ª°ri˘


	)

183 
	#__ª°ri˘
 
ª°ri˘


	)

195 #i‡
__GNUC__
 > 2 || __GNUC__ =2 && 
__GNUC_MINOR__
 >= 7

196 
	#__¥ötÊike
(
fmèrg
, 
fú°v¨¨g
) \

197 
	`__©åibuã__
((
	`__f‹m©__
 (
__¥ötf__
, 
fmèrg
, 
fú°v¨¨g
)))

	)

198 
	#__sˇnÊike
(
fmèrg
, 
fú°v¨¨g
) \

199 
	`__©åibuã__
((
	`__f‹m©__
 (
__sˇnf__
, 
fmèrg
, 
fú°v¨¨g
)))

	)

201 
	#__¥ötÊike
(
fmèrg
, 
fú°v¨¨g
)

	)

202 
	#__sˇnÊike
(
fmèrg
, 
fú°v¨¨g
)

	)

205 
	#__IDSTRING
(
«me
,
°rög
Ëc⁄° «me[] 
__u£d
 = 
	)
string

207 #i‚de‡
__COPYRIGHT


208 
	#__COPYRIGHT
(
s
Ë
	`__IDSTRING
(
c›yright
,s)

	)

211 #i‚de‡
__RCSID


212 
	#__RCSID
(
s
Ë
	`__IDSTRING
(
rcsid
,s)

	)

215 #i‚de‡
__SCCSID


216 
	#__SCCSID
(
s
Ë
	`__IDSTRING
(
sccsid
,s)

	)

219 #i‚de‡
__PROJECT_VERSION


220 
	#__PROJECT_VERSION
(
s
Ë
	`__IDSTRING
(
¥oje˘_vîsi⁄
,s)

	)

262 
	#__DARWIN_ONLY_64_BIT_INO_T
 0

	)

264 
	#__DARWIN_ONLY_VERS_1050
 0

	)

284 #i‡!
deföed
(
__DARWIN_ONLY_UNIX_CONFORMANCE
)

285 #i‡
deföed
(
__LP64__
)

286 
	#__DARWIN_ONLY_UNIX_CONFORMANCE
 1

	)

288 
	#__DARWIN_ONLY_UNIX_CONFORMANCE
 0

	)

292 #i‡!
deföed
(
__DARWIN_UNIX03
)

293 #i‡ 
__DARWIN_ONLY_UNIX_CONFORMANCE


294 #i‡
deföed
(
_NONSTD_SOURCE
)

297 
	#__DARWIN_UNIX03
 1

	)

298 #ñi‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && ((__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__-0) < 1040)

299 
	#__DARWIN_UNIX03
 0

	)

300 #ñi‡
deföed
(
_DARWIN_C_SOURCE
Ë|| deföed(
_XOPEN_SOURCE
Ë|| deföed(
_POSIX_C_SOURCE
)

301 #i‡
deföed
(
_NONSTD_SOURCE
)

304 
	#__DARWIN_UNIX03
 1

	)

305 #ñi‡
deföed
(
_NONSTD_SOURCE
)

306 
	#__DARWIN_UNIX03
 0

	)

308 #i‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && ((__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__-0) < 1050)

309 
	#__DARWIN_UNIX03
 0

	)

311 
	#__DARWIN_UNIX03
 1

	)

316 #i‡!
deföed
(
__DARWIN_64_BIT_INO_T
)

317 #i‡ 
deföed
(
_DARWIN_USE_64_BIT_INODE
)

318 #i‡
deföed
(
_DARWIN_NO_64_BIT_INODE
)

321 
	#__DARWIN_64_BIT_INO_T
 1

	)

322 #ñi‡
deföed
(
_DARWIN_NO_64_BIT_INODE
)

323 #i‡
__DARWIN_ONLY_64_BIT_INO_T


326 
	#__DARWIN_64_BIT_INO_T
 0

	)

328 #i‡
__DARWIN_ONLY_64_BIT_INO_T


329 
	#__DARWIN_64_BIT_INO_T
 1

	)

330 #ñi‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
Ë&& ((__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__-0Ë< 1060Ë|| 
__DARWIN_UNIX03
 == 0

331 
	#__DARWIN_64_BIT_INO_T
 0

	)

333 
	#__DARWIN_64_BIT_INO_T
 1

	)

338 #i‡!
deföed
(
__DARWIN_VERS_1050
)

339 #i‡ 
__DARWIN_ONLY_VERS_1050


340 
	#__DARWIN_VERS_1050
 1

	)

341 #ñi‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
Ë&& ((__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__-0Ë< 1050Ë|| 
__DARWIN_UNIX03
 == 0

342 
	#__DARWIN_VERS_1050
 0

	)

344 
	#__DARWIN_VERS_1050
 1

	)

348 #i‡!
deföed
(
__DARWIN_NON_CANCELABLE
)

349 
	#__DARWIN_NON_CANCELABLE
 0

	)

355 #i‡
__DARWIN_UNIX03


356 #i‡
__DARWIN_ONLY_UNIX_CONFORMANCE


357 
	#__DARWIN_SUF_UNIX03


	)

359 
	#__DARWIN_SUF_UNIX03
 "$UNIX2003"

	)

362 #i‡
__DARWIN_64_BIT_INO_T


363 #i‡
__DARWIN_ONLY_64_BIT_INO_T


364 
	#__DARWIN_SUF_64_BIT_INO_T


	)

366 
	#__DARWIN_SUF_64_BIT_INO_T
 "$INODE64"

	)

369 
	#__DARWIN_SUF_64_BIT_INO_T


	)

372 #i‡
__DARWIN_VERS_1050


373 #i‡
__DARWIN_ONLY_VERS_1050


374 
	#__DARWIN_SUF_1050


	)

376 
	#__DARWIN_SUF_1050
 "$1050"

	)

379 
	#__DARWIN_SUF_1050


	)

382 #i‡
__DARWIN_NON_CANCELABLE


383 
	#__DARWIN_SUF_NON_CANCELABLE
 "$NOCANCEL"

	)

385 
	#__DARWIN_SUF_NON_CANCELABLE


	)

389 
	#__DARWIN_SUF_UNIX03


	)

390 
	#__DARWIN_SUF_64_BIT_INO_T


	)

391 
	#__DARWIN_SUF_NON_CANCELABLE


	)

392 
	#__DARWIN_SUF_1050


	)

395 
	#__DARWIN_SUF_EXTSN
 "$DARWIN_EXTSN"

	)

400 
	#__DARWIN_ALIAS
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_UNIX03
)

	)

401 
	#__DARWIN_ALIAS_C
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_NON_CANCELABLE
 
__DARWIN_SUF_UNIX03
)

	)

402 
	#__DARWIN_ALIAS_I
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_64_BIT_INO_T
 
__DARWIN_SUF_UNIX03
)

	)

403 
	#__DARWIN_INODE64
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_64_BIT_INO_T
)

	)

405 
	#__DARWIN_1050
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_1050
)

	)

406 
	#__DARWIN_1050ALIAS
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_1050
 
__DARWIN_SUF_UNIX03
)

	)

407 
	#__DARWIN_1050ALIAS_C
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_1050
 
__DARWIN_SUF_NON_CANCELABLE
 
__DARWIN_SUF_UNIX03
)

	)

408 
	#__DARWIN_1050ALIAS_I
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_1050
 
__DARWIN_SUF_64_BIT_INO_T
 
__DARWIN_SUF_UNIX03
)

	)

409 
	#__DARWIN_1050INODE64
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_1050
 
__DARWIN_SUF_64_BIT_INO_T
)

	)

411 
	#__DARWIN_EXTSN
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_EXTSN
)

	)

412 
	#__DARWIN_EXTSN_C
(
sym
Ë
	`__asm
("_" 
	`__STRING
(symË
__DARWIN_SUF_EXTSN
 
__DARWIN_SUF_NON_CANCELABLE
)

	)

417 
	~<sys/_symbﬁ_Æüsög.h
>

419 #i‡
deföed
(
__IPHONE_OS_VERSION_MIN_REQUIRED
)

420 
	#__DARWIN_ALIAS_STARTING
(
_mac
, 
_ùh⁄e
, 
x
Ë
__DARWIN_ALIAS_STARTING_IPHONE_
##
	`_ùh⁄e
(x)

	)

421 #ñi‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
)

422 
	#__DARWIN_ALIAS_STARTING
(
_mac
, 
_ùh⁄e
, 
x
Ë
__DARWIN_ALIAS_STARTING_MAC_
##
	`_mac
(x)

	)

424 
	#__DARWIN_ALIAS_STARTING
(
_mac
, 
_ùh⁄e
, 
x
)

	)

449 #i‡
deföed
(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE == 1L

450 #unde‡
_POSIX_C_SOURCE


451 
	#_POSIX_C_SOURCE
 199009L

	)

455 #i‡
deföed
(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE == 2L

456 #unde‡
_POSIX_C_SOURCE


457 
	#_POSIX_C_SOURCE
 199209L

	)

461 #ifde‡
_XOPEN_SOURCE


462 #i‡
_XOPEN_SOURCE
 - 0L >700L && (!
deföed
(
_POSIX_C_SOURCE
) || _POSIX_C_SOURCE - 0L < 200809L)

463 #unde‡
_POSIX_C_SOURCE


464 
	#_POSIX_C_SOURCE
 200809L

	)

465 #ñi‡
_XOPEN_SOURCE
 - 0L >600L && (!
deföed
(
_POSIX_C_SOURCE
) || _POSIX_C_SOURCE - 0L < 200112L)

466 #unde‡
_POSIX_C_SOURCE


467 
	#_POSIX_C_SOURCE
 200112L

	)

468 #ñi‡
_XOPEN_SOURCE
 - 0L >500L && (!
deföed
(
_POSIX_C_SOURCE
) || _POSIX_C_SOURCE - 0L < 199506L)

469 #unde‡
_POSIX_C_SOURCE


470 
	#_POSIX_C_SOURCE
 199506L

	)

478 #i‡
deföed
(
_POSIX_SOURCE
Ë&& !deföed(
_POSIX_C_SOURCE
)

479 
	#_POSIX_C_SOURCE
 198808L

	)

485 #i‡
deföed
(
__GNUC__
Ë&& ((__GNUC__ >4Ë|| ((__GNUC__ =3Ë&& (
__GNUC_MINOR__
 >= 1)))

486 
	#__dïªˇãd
 
	`__©åibuã__
((
dïªˇãd
))

	)

487 
	#__u«vaûabÀ
 
	`__©åibuã__
((
u«vaûabÀ
))

	)

489 
	#__dïªˇãd


	)

490 
	#__u«vaûabÀ


	)

494 
	~<sys/_posix_avaûabûôy.h
>

496 
	#__POSIX_C_DEPRECATED
(
vî
Ë
___POSIX_C_DEPRECATED_STARTING_
##
	)
ver

504 
	#__DARWIN_C_ANSI
 010000L

	)

505 
	#__DARWIN_C_FULL
 900000L

	)

507 #i‡ 
deföed
(
_ANSI_SOURCE
)

508 
	#__DARWIN_C_LEVEL
 
__DARWIN_C_ANSI


	)

509 #ñi‡
deföed
(
_POSIX_C_SOURCE
Ë&& !deföed(
_DARWIN_C_SOURCE
Ë&& !deföed(
_NONSTD_SOURCE
)

510 
	#__DARWIN_C_LEVEL
 
_POSIX_C_SOURCE


	)

512 
	#__DARWIN_C_LEVEL
 
__DARWIN_C_FULL


	)

521 
	#__DARWIN_NO_LONG_LONG
 (
	`deföed
(
__STRICT_ANSI__
) \

522 && (
__STDC_VERSION__
-0 < 199901L) \

523 && !
	`deföed
(
__GNUG__
))

	)

531 #i‡
deföed
(
__¨m__
)

532 
	#__DARWIN_LDBL_COMPAT
(
x
Ë

	)

533 
	#__DARWIN_LDBL_COMPAT2
(
x
Ë

	)

534 
	#__DARWIN_LONG_DOUBLE_IS_DOUBLE
 1

	)

535 #ñi‡
deföed
(
__i386__
Ë|| deföed(
__x86_64__
)

536 
	#__DARWIN_LDBL_COMPAT
(
x
Ë

	)

537 
	#__DARWIN_LDBL_COMPAT2
(
x
Ë

	)

538 
	#__DARWIN_LONG_DOUBLE_IS_DOUBLE
 0

	)

540 #îr‹ 
Unknown
 
¨chôe˘uª


551 #i‡
__DARWIN_64_BIT_INO_T


552 
	#_DARWIN_FEATURE_64_BIT_INODE
 1

	)

559 #i‡
__DARWIN_LONG_DOUBLE_IS_DOUBLE


560 
	#_DARWIN_FEATURE_LONG_DOUBLE_IS_DOUBLE
 1

	)

569 #i‡
__DARWIN_ONLY_64_BIT_INO_T


570 
	#_DARWIN_FEATURE_ONLY_64_BIT_INODE
 1

	)

577 #i‡
__DARWIN_ONLY_VERS_1050


578 
	#_DARWIN_FEATURE_ONLY_VERS_1050
 1

	)

585 #i‡
__DARWIN_ONLY_UNIX_CONFORMANCE


586 
	#_DARWIN_FEATURE_ONLY_UNIX_CONFORMANCE
 1

	)

593 #i‡
__DARWIN_UNIX03


594 
	#_DARWIN_FEATURE_UNIX_CONFORMANCE
 3

	)

603 #i‚de‡
__CAST_AWAY_QUALIFIER


604 
	#__CAST_AWAY_QUALIFIER
(
v¨übÀ
, 
quÆifõr
, 
ty≥
Ë—y≥Ë()(v¨übÀ)

	)

	@/usr/include/sys/errno.h

69 #i‚def 
_SYS_ERRNO_H_


70 
	#_SYS_ERRNO_H_


	)

72 
	~<sys/cdefs.h
>

74 
__BEGIN_DECLS


75 * 
__îr‹
();

76 
	#î∫o
 (*
	`__îr‹
())

	)

77 
	g__END_DECLS


83 
	#EPERM
 1

	)

84 
	#ENOENT
 2

	)

85 
	#ESRCH
 3

	)

86 
	#EINTR
 4

	)

87 
	#EIO
 5

	)

88 
	#ENXIO
 6

	)

89 
	#E2BIG
 7

	)

90 
	#ENOEXEC
 8

	)

91 
	#EBADF
 9

	)

92 
	#ECHILD
 10

	)

93 
	#EDEADLK
 11

	)

95 
	#ENOMEM
 12

	)

96 
	#EACCES
 13

	)

97 
	#EFAULT
 14

	)

98 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


99 
	#ENOTBLK
 15

	)

101 
	#EBUSY
 16

	)

102 
	#EEXIST
 17

	)

103 
	#EXDEV
 18

	)

104 
	#ENODEV
 19

	)

105 
	#ENOTDIR
 20

	)

106 
	#EISDIR
 21

	)

107 
	#EINVAL
 22

	)

108 
	#ENFILE
 23

	)

109 
	#EMFILE
 24

	)

110 
	#ENOTTY
 25

	)

111 
	#ETXTBSY
 26

	)

112 
	#EFBIG
 27

	)

113 
	#ENOSPC
 28

	)

114 
	#ESPIPE
 29

	)

115 
	#EROFS
 30

	)

116 
	#EMLINK
 31

	)

117 
	#EPIPE
 32

	)

120 
	#EDOM
 33

	)

121 
	#ERANGE
 34

	)

124 
	#EAGAIN
 35

	)

125 
	#EWOULDBLOCK
 
EAGAIN


	)

126 
	#EINPROGRESS
 36

	)

127 
	#EALREADY
 37

	)

130 
	#ENOTSOCK
 38

	)

131 
	#EDESTADDRREQ
 39

	)

132 
	#EMSGSIZE
 40

	)

133 
	#EPROTOTYPE
 41

	)

134 
	#ENOPROTOOPT
 42

	)

135 
	#EPROTONOSUPPORT
 43

	)

136 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


137 
	#ESOCKTNOSUPPORT
 44

	)

139 
	#ENOTSUP
 45

	)

140 #i‡!
__DARWIN_UNIX03
 && !
deföed
(
KERNEL
)

149 
	#EOPNOTSUPP
 
ENOTSUP


	)

152 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


153 
	#EPFNOSUPPORT
 46

	)

155 
	#EAFNOSUPPORT
 47

	)

156 
	#EADDRINUSE
 48

	)

157 
	#EADDRNOTAVAIL
 49

	)

160 
	#ENETDOWN
 50

	)

161 
	#ENETUNREACH
 51

	)

162 
	#ENETRESET
 52

	)

163 
	#ECONNABORTED
 53

	)

164 
	#ECONNRESET
 54

	)

165 
	#ENOBUFS
 55

	)

166 
	#EISCONN
 56

	)

167 
	#ENOTCONN
 57

	)

168 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


169 
	#ESHUTDOWN
 58

	)

170 
	#ETOOMANYREFS
 59

	)

172 
	#ETIMEDOUT
 60

	)

173 
	#ECONNREFUSED
 61

	)

175 
	#ELOOP
 62

	)

176 
	#ENAMETOOLONG
 63

	)

179 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


180 
	#EHOSTDOWN
 64

	)

182 
	#EHOSTUNREACH
 65

	)

183 
	#ENOTEMPTY
 66

	)

186 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


187 
	#EPROCLIM
 67

	)

188 
	#EUSERS
 68

	)

190 
	#EDQUOT
 69

	)

193 
	#ESTALE
 70

	)

194 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


195 
	#EREMOTE
 71

	)

196 
	#EBADRPC
 72

	)

197 
	#ERPCMISMATCH
 73

	)

198 
	#EPROGUNAVAIL
 74

	)

199 
	#EPROGMISMATCH
 75

	)

200 
	#EPROCUNAVAIL
 76

	)

203 
	#ENOLCK
 77

	)

204 
	#ENOSYS
 78

	)

206 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


207 
	#EFTYPE
 79

	)

208 
	#EAUTH
 80

	)

209 
	#ENEEDAUTH
 81

	)

212 
	#EPWROFF
 82

	)

213 
	#EDEVERR
 83

	)

216 
	#EOVERFLOW
 84

	)

219 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


220 
	#EBADEXEC
 85

	)

221 
	#EBADARCH
 86

	)

222 
	#ESHLIBVERS
 87

	)

223 
	#EBADMACHO
 88

	)

226 
	#ECANCELED
 89

	)

228 
	#EIDRM
 90

	)

229 
	#ENOMSG
 91

	)

230 
	#EILSEQ
 92

	)

231 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


232 
	#ENOATTR
 93

	)

235 
	#EBADMSG
 94

	)

236 
	#EMULTIHOP
 95

	)

237 
	#ENODATA
 96

	)

238 
	#ENOLINK
 97

	)

239 
	#ENOSR
 98

	)

240 
	#ENOSTR
 99

	)

241 
	#EPROTO
 100

	)

242 
	#ETIME
 101

	)

244 #i‡
__DARWIN_UNIX03
 || 
deföed
(
KERNEL
)

246 
	#EOPNOTSUPP
 102

	)

249 
	#ENOPOLICY
 103

	)

251 #i‡
__DARWIN_C_LEVEL
 >= 200809L

252 
	#ENOTRECOVERABLE
 104

	)

253 
	#EOWNERDEAD
 105

	)

256 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


257 
	#ELAST
 105

	)

	@/usr/include/sys/fcntl.h

70 #i‚de‡
_SYS_FCNTL_H_


71 
	#_SYS_FCNTL_H_


	)

78 
	~<sys/_ty≥s.h
>

79 
	~<sys/cdefs.h
>

80 
	~<Avaûabûôy.h
>

83 #i‚de‡
_SIZE_T


84 
	#_SIZE_T


	)

85 
__d¨wö_size_t
 
	tsize_t
;

88 #i‚def 
_MODE_T


89 
__d¨wö_mode_t
 
	tmode_t
;

90 
	#_MODE_T


	)

93 #i‚de‡
_OFF_T


94 
__d¨wö_off_t
 
	toff_t
;

95 
	#_OFF_T


	)

98 #i‚de‡
_PID_T


99 
__d¨wö_pid_t
 
	tpid_t
;

100 
	#_PID_T


	)

111 
	#O_RDONLY
 0x0000

	)

112 
	#O_WRONLY
 0x0001

	)

113 
	#O_RDWR
 0x0002

	)

114 
	#O_ACCMODE
 0x0003

	)

124 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

125 
	#FREAD
 0x0001

	)

126 
	#FWRITE
 0x0002

	)

128 
	#O_NONBLOCK
 0x0004

	)

129 
	#O_APPEND
 0x0008

	)

130 #i‚de‡
O_SYNC


131 
	#O_SYNC
 0x0080

	)

133 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

134 
	#O_SHLOCK
 0x0010

	)

135 
	#O_EXLOCK
 0x0020

	)

136 
	#O_ASYNC
 0x0040

	)

137 
	#O_FSYNC
 
O_SYNC


	)

138 
	#O_NOFOLLOW
 0x0100

	)

140 
	#O_CREAT
 0x0200

	)

141 
	#O_TRUNC
 0x0400

	)

142 
	#O_EXCL
 0x0800

	)

143 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

144 
	#O_EVTONLY
 0x8000

	)

148 
	#O_NOCTTY
 0x20000

	)

151 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

152 
	#O_DIRECTORY
 0x100000

	)

153 
	#O_SYMLINK
 0x200000

	)

156 #i‚de‡
O_DSYNC


157 
	#O_DSYNC
 0x400000

	)

161 #i‡
__DARWIN_C_LEVEL
 >= 200809L

162 
	#O_CLOEXEC
 0x1000000

	)

171 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

172 
	#FAPPEND
 
O_APPEND


	)

173 
	#FASYNC
 
O_ASYNC


	)

174 
	#FFSYNC
 
O_FSYNC


	)

175 
	#FFDSYNC
 
O_DSYNC


	)

176 
	#FNONBLOCK
 
O_NONBLOCK


	)

177 
	#FNDELAY
 
O_NONBLOCK


	)

178 
	#O_NDELAY
 
O_NONBLOCK


	)

185 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

186 
	#CPF_OVERWRITE
 1

	)

187 
	#CPF_IGNORE_MODE
 2

	)

188 
	#CPF_MASK
 (
CPF_OVERWRITE
|
CPF_IGNORE_MODE
)

	)

196 
	#F_DUPFD
 0

	)

197 
	#F_GETFD
 1

	)

198 
	#F_SETFD
 2

	)

199 
	#F_GETFL
 3

	)

200 
	#F_SETFL
 4

	)

201 
	#F_GETOWN
 5

	)

202 
	#F_SETOWN
 6

	)

203 
	#F_GETLK
 7

	)

204 
	#F_SETLK
 8

	)

205 
	#F_SETLKW
 9

	)

206 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

207 
	#F_FLUSH_DATA
 40

	)

208 
	#F_CHKCLEAN
 41

	)

209 
	#F_PREALLOCATE
 42

	)

210 
	#F_SETSIZE
 43

	)

211 
	#F_RDADVISE
 44

	)

212 
	#F_RDAHEAD
 45

	)

213 
	#F_READBOOTSTRAP
 46

	)

214 
	#F_WRITEBOOTSTRAP
 47

	)

215 
	#F_NOCACHE
 48

	)

216 
	#F_LOG2PHYS
 49

	)

217 
	#F_GETPATH
 50

	)

218 
	#F_FULLFSYNC
 51

	)

219 
	#F_PATHPKG_CHECK
 52

	)

220 
	#F_FREEZE_FS
 53

	)

221 
	#F_THAW_FS
 54

	)

222 
	#F_GLOBAL_NOCACHE
 55

	)

225 
	#F_ADDSIGS
 59

	)

227 
	#F_MARKDEPENDENCY
 60

	)

229 
	#F_ADDFILESIGS
 61

	)

231 
	#F_NODIRECT
 62

	)

234 
	#F_GETPROTECTIONCLASS
 63

	)

235 
	#F_SETPROTECTIONCLASS
 64

	)

237 
	#F_LOG2PHYS_EXT
 65

	)

239 
	#F_GETLKPID
 66

	)

242 
	#F_SETBACKINGSTORE
 70

	)

243 
	#F_GETPATH_MTMINFO
 71

	)

245 
	#F_SETNOSIGPIPE
 73

	)

246 
	#F_GETNOSIGPIPE
 74

	)

249 
	#FCNTL_FS_SPECIFIC_BASE
 0x00010000

	)

253 #i‡
__DARWIN_C_LEVEL
 >= 200809L

254 
	#F_DUPFD_CLOEXEC
 67

	)

258 
	#FD_CLOEXEC
 1

	)

261 
	#F_RDLCK
 1

	)

262 
	#F_UNLCK
 2

	)

263 
	#F_WRLCK
 3

	)

269 #i‚de‡
SEEK_SET


270 
	#SEEK_SET
 0

	)

271 
	#SEEK_CUR
 1

	)

272 
	#SEEK_END
 2

	)

279 #i‚de‡
S_IFMT


281 
	#S_IFMT
 0170000

	)

282 
	#S_IFIFO
 0010000

	)

283 
	#S_IFCHR
 0020000

	)

284 
	#S_IFDIR
 0040000

	)

285 
	#S_IFBLK
 0060000

	)

286 
	#S_IFREG
 0100000

	)

287 
	#S_IFLNK
 0120000

	)

288 
	#S_IFSOCK
 0140000

	)

289 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

290 
	#S_IFWHT
 0160000

	)

295 
	#S_IRWXU
 0000700

	)

296 
	#S_IRUSR
 0000400

	)

297 
	#S_IWUSR
 0000200

	)

298 
	#S_IXUSR
 0000100

	)

300 
	#S_IRWXG
 0000070

	)

301 
	#S_IRGRP
 0000040

	)

302 
	#S_IWGRP
 0000020

	)

303 
	#S_IXGRP
 0000010

	)

305 
	#S_IRWXO
 0000007

	)

306 
	#S_IROTH
 0000004

	)

307 
	#S_IWOTH
 0000002

	)

308 
	#S_IXOTH
 0000001

	)

310 
	#S_ISUID
 0004000

	)

311 
	#S_ISGID
 0002000

	)

312 
	#S_ISVTX
 0001000

	)

314 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

315 
	#S_ISTXT
 
S_ISVTX


	)

316 
	#S_IREAD
 
S_IRUSR


	)

317 
	#S_IWRITE
 
S_IWUSR


	)

318 
	#S_IEXEC
 
S_IXUSR


	)

322 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

325 
	#F_ALLOCATECONTIG
 0x00000002

	)

326 
	#F_ALLOCATEALL
 0x00000004

	)

330 
	#F_PEOFPOSMODE
 3

	)

332 
	#F_VOLPOSMODE
 4

	)

339 
	sÊock
 {

340 
off_t
 
	ml_°¨t
;

341 
off_t
 
	ml_Àn
;

342 
pid_t
 
	ml_pid
;

343 
	ml_ty≥
;

344 
	ml_whí˚
;

348 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

355 
	sødvis‹y
 {

356 
off_t
 
	mø_off£t
;

357 
	mø_cou¡
;

367 
	sfsig«tuªs
 {

368 
off_t
 
	mfs_fûe_°¨t
;

369 *
	mfs_blob_°¨t
;

370 
size_t
 
	mfs_blob_size
;

371 } 
	tfsig«tuªs_t
;

374 
	#LOCK_SH
 0x01

	)

375 
	#LOCK_EX
 0x02

	)

376 
	#LOCK_NB
 0x04

	)

377 
	#LOCK_UN
 0x08

	)

381 
	sf°‹e
 {

382 
	mf°_Êags
;

383 
	mf°_posmode
;

384 
off_t
 
	mf°_off£t
;

385 
off_t
 
	mf°_Àngth
;

386 
off_t
 
	mf°_byãßŒoc
;

387 } 
	tf°‹e_t
;

391 
	sfboŸ°ø±øns„r
 {

392 
off_t
 
	mfbt_off£t
;

393 
size_t
 
	mfbt_Àngth
;

394 *
	mfbt_buf„r
;

395 } 
	tfboŸ°ø±øns„r_t
;

419 #¥agm®
∑ck
(4)

421 
	slog2phys
 {

422 
	ml2p_Êags
;

423 
off_t
 
	ml2p_c⁄tigbyãs
;

426 
off_t
 
	ml2p_devoff£t
;

431 #¥agm®
∑ck
()

433 
	#O_POPUP
 0x80000000

	)

434 
	#O_ALERT
 0x20000000

	)

440 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

441 #i‚de‡
_FILESEC_T


442 
	g_fûe£c
;

443 
_fûe£c
 *
	tfûe£c_t
;

444 
	#_FILESEC_T


	)

447 
	mFILESEC_OWNER
 = 1,

448 
	mFILESEC_GROUP
 = 2,

449 
	mFILESEC_UUID
 = 3,

450 
	mFILESEC_MODE
 = 4,

451 
	mFILESEC_ACL
 = 5,

452 
	mFILESEC_GRPUUID
 = 6,

455 
	mFILESEC_ACL_RAW
 = 100,

456 
	mFILESEC_ACL_ALLOCSIZE
 = 101

457 } 
	tfûe£c_¥›îty_t
;

460 
	#FILESEC_GUID
 
FILESEC_UUID


	)

463 
__BEGIN_DECLS


464 
	$›í
(c⁄° *, , ...Ë
	`__DARWIN_ALIAS_C
(
›í
);

465 
	$¸ót
(c⁄° *, 
mode_t
Ë
	`__DARWIN_ALIAS_C
(
¸ót
);

466 
	$f˙é
(, , ...Ë
	`__DARWIN_ALIAS_C
(
f˙é
);

467 #i‡!
	`deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

469 
	`›íx_≈
(c⁄° *, , 
fûe£c_t
);

470 
	`Êock
(, );

471 
fûe£c_t
 
	`fûe£c_öô
();

472 
fûe£c_t
 
	`fûe£c_dup
(filesec_t);

473 
	`fûe£c_‰ì
(
fûe£c_t
);

474 
	`fûe£c_gë_¥›îty
(
fûe£c_t
, 
fûe£c_¥›îty_t
, *);

475 
	`fûe£c_quîy_¥›îty
(
fûe£c_t
, 
fûe£c_¥›îty_t
, *);

476 
	`fûe£c_£t_¥›îty
(
fûe£c_t
, 
fûe£c_¥›îty_t
, const *);

477 
	$fûe£c_un£t_¥›îty
(
fûe£c_t
, 
fûe£c_¥›îty_t
Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_6
, 
__IPHONE_3_2
);

478 
	#_FILESEC_UNSET_PROPERTY
 ((*)0)

	)

479 
	#_FILESEC_REMOVE_ACL
 ((*)1)

	)

481 
__END_DECLS


	@/usr/include/sys/select.h

63 #i‚de‡
_SYS_SELECT_H_


64 
	#_SYS_SELECT_H_


	)

66 
	~<sys/≠∂ópi›ts.h
>

67 
	~<sys/cdefs.h
>

68 
	~<sys/_ty≥s.h
>

75 
	#__√ed_fd_£t


	)

76 
	#__√ed_°ru˘_time•ec


	)

77 
	#__√ed_°ru˘_timevÆ


	)

78 
	~<sys/_°ru˘s.h
>

85 #i‚def 
_TIME_T


86 
	#_TIME_T


	)

87 
__d¨wö_time_t
 
	ttime_t
;

90 #i‚de‡
_SUSECONDS_T


91 
	#_SUSECONDS_T


	)

92 
__d¨wö_su£c⁄ds_t
 
	tsu£c⁄ds_t
;

95 #i‚de‡
_SIGSET_T


96 
	#_SIGSET_T


	)

97 
__d¨wö_sig£t_t
 
	tsig£t_t
;

112 #i‚def 
FD_SETSIZE


113 
	#FD_SETSIZE
 
__DARWIN_FD_SETSIZE


	)

115 #i‚de‡
FD_SET


116 
	#FD_SET
(
n
, 
p
Ë
	`__DARWIN_FD_SET
“,Ö)

	)

118 #i‚de‡
FD_CLR


119 
	#FD_CLR
(
n
, 
p
Ë
	`__DARWIN_FD_CLR
“,Ö)

	)

121 #i‚de‡
FD_ISSET


122 
	#FD_ISSET
(
n
, 
p
Ë
	`__DARWIN_FD_ISSET
“,Ö)

	)

124 #i‚de‡
FD_ZERO


125 
	#FD_ZERO
(
p
Ë
	`__DARWIN_FD_ZERO
’)

	)

127 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

128 #i‚de‡
FD_COPY


129 
	#FD_COPY
(
f
, 
t
Ë
	`__DARWIN_FD_COPY
(f,Å)

	)

134 
	g__BEGIN_DECLS


136 #i‚de‡ 
__MWERKS__


137 
	$p£À˘
(, 
fd_£t
 * 
__ª°ri˘
, fd_set * __restrict,

138 
fd_£t
 * 
__ª°ri˘
, c⁄° 
time•ec
 * __restrict,

139 c⁄° 
sig£t_t
 * 
__ª°ri˘
)

140 #i‡
	`deföed
(
_DARWIN_C_SOURCE
Ë|| deföed(
_DARWIN_UNLIMITED_SELECT
)

141 
	$__DARWIN_EXTSN_C
(
p£À˘
)

143 #i‡
	`deföed
(
__LP64__
Ë&& !
__DARWIN_NON_CANCELABLE


144 
	$__DARWIN_1050
(
p£À˘
)

146 
	$__DARWIN_ALIAS_C
(
p£À˘
)

152 
	~<sys/_£À˘.h
>

154 
__END_DECLS


	@/usr/include/sys/signal.h

69 #i‚def 
_SYS_SIGNAL_H_


70 
	#_SYS_SIGNAL_H_


	)

72 
	~<sys/cdefs.h
>

73 
	~<sys/≠∂ópi›ts.h
>

75 
	#__DARWIN_NSIG
 32

	)

77 #i‡!
deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

78 
	#NSIG
 
__DARWIN_NSIG


	)

81 
	~<machöe/sig«l.h
>

83 
	#SIGHUP
 1

	)

84 
	#SIGINT
 2

	)

85 
	#SIGQUIT
 3

	)

86 
	#SIGILL
 4

	)

87 
	#SIGTRAP
 5

	)

88 
	#SIGABRT
 6

	)

89 #i‡ (
deföed
(
_POSIX_C_SOURCE
Ë&& !deföed(
_DARWIN_C_SOURCE
))

90 
	#SIGPOLL
 7

	)

92 
	#SIGIOT
 
SIGABRT


	)

93 
	#SIGEMT
 7

	)

95 
	#SIGFPE
 8

	)

96 
	#SIGKILL
 9

	)

97 
	#SIGBUS
 10

	)

98 
	#SIGSEGV
 11

	)

99 
	#SIGSYS
 12

	)

100 
	#SIGPIPE
 13

	)

101 
	#SIGALRM
 14

	)

102 
	#SIGTERM
 15

	)

103 
	#SIGURG
 16

	)

104 
	#SIGSTOP
 17

	)

105 
	#SIGTSTP
 18

	)

106 
	#SIGCONT
 19

	)

107 
	#SIGCHLD
 20

	)

108 
	#SIGTTIN
 21

	)

109 
	#SIGTTOU
 22

	)

110 #i‡ (!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

111 
	#SIGIO
 23

	)

113 
	#SIGXCPU
 24

	)

114 
	#SIGXFSZ
 25

	)

115 
	#SIGVTALRM
 26

	)

116 
	#SIGPROF
 27

	)

117 #i‡ (!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

118 
	#SIGWINCH
 28

	)

119 
	#SIGINFO
 29

	)

121 
	#SIGUSR1
 30

	)

122 
	#SIGUSR2
 31

	)

124 #i‡
deföed
(
_ANSI_SOURCE
Ë|| 
__DARWIN_UNIX03
 || deföed(
__˝lu•lus
)

130 
	#SIG_DFL
 ((*)())0

	)

131 
	#SIG_IGN
 ((*)())1

	)

132 
	#SIG_HOLD
 ((*)())5

	)

133 
	#SIG_ERR
 (((*)())-1)

	)

136 
	#SIG_DFL
 ((*)–))0

	)

137 
	#SIG_IGN
 ((*)–))1

	)

138 
	#SIG_HOLD
 ((*)–))5

	)

139 
	#SIG_ERR
 (((*)–))-1)

	)

142 #i‚de‡
_ANSI_SOURCE


143 
	~<sys/_ty≥s.h
>

145 
	#__√ed_mc⁄ãxt_t


	)

146 
	#__√ed_°ack_t


	)

147 
	#__√ed_uc⁄ãxt_t


	)

148 
	~<sys/_°ru˘s.h
>

150 #i‚de‡
_PID_T


151 
	#_PID_T


	)

152 
__d¨wö_pid_t
 
	tpid_t
;

155 #i‚de‡
_PTHREAD_ATTR_T


156 
	#_PTHREAD_ATTR_T


	)

157 
__d¨wö_±hªad_©å_t
 
	t±hªad_©å_t
;

160 #i‚de‡
_SIGSET_T


161 
	#_SIGSET_T


	)

162 
__d¨wö_sig£t_t
 
	tsig£t_t
;

165 #i‚def 
_SIZE_T


166 
	#_SIZE_T


	)

167 
__d¨wö_size_t
 
	tsize_t
;

170 #i‚de‡
_UID_T


171 
	#_UID_T


	)

172 
__d¨wö_uid_t
 
	tuid_t
;

175 
	usigvÆ
 {

177 
	msivÆ_öt
;

178 *
	msivÆ_±r
;

181 
	#SIGEV_NONE
 0

	)

182 
	#SIGEV_SIGNAL
 1

	)

183 
	#SIGEV_THREAD
 3

	)

185 
	ssigevít
 {

186 
	msigev_nŸify
;

187 
	msigev_signo
;

188 
sigvÆ
 
	msigev_vÆue
;

189 (*
	msigev_nŸify_fun˘i⁄
)(
	msigvÆ
);

190 
±hªad_©å_t
 *
	msigev_nŸify_©åibuãs
;

194 
	s__sigöfo
 {

195 
	msi_signo
;

196 
	msi_î∫o
;

197 
	msi_code
;

198 
pid_t
 
	msi_pid
;

199 
uid_t
 
	msi_uid
;

200 
	msi_°©us
;

201 *
	msi_addr
;

202 
sigvÆ
 
	msi_vÆue
;

203 
	msi_b™d
;

204 
	m__∑d
[7];

205 } 
	tsigöfo_t
;

222 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

223 
	#ILL_NOOP
 0

	)

225 
	#ILL_ILLOPC
 1

	)

226 
	#ILL_ILLTRP
 2

	)

227 
	#ILL_PRVOPC
 3

	)

228 
	#ILL_ILLOPN
 4

	)

229 
	#ILL_ILLADR
 5

	)

230 
	#ILL_PRVREG
 6

	)

231 
	#ILL_COPROC
 7

	)

232 
	#ILL_BADSTK
 8

	)

235 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

236 
	#FPE_NOOP
 0

	)

238 
	#FPE_FLTDIV
 1

	)

239 
	#FPE_FLTOVF
 2

	)

240 
	#FPE_FLTUND
 3

	)

241 
	#FPE_FLTRES
 4

	)

242 
	#FPE_FLTINV
 5

	)

243 
	#FPE_FLTSUB
 6

	)

244 
	#FPE_INTDIV
 7

	)

245 
	#FPE_INTOVF
 8

	)

248 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

249 
	#SEGV_NOOP
 0

	)

251 
	#SEGV_MAPERR
 1

	)

252 
	#SEGV_ACCERR
 2

	)

255 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

256 
	#BUS_NOOP
 0

	)

258 
	#BUS_ADRALN
 1

	)

259 
	#BUS_ADRERR
 2

	)

260 
	#BUS_OBJERR
 3

	)

263 
	#TRAP_BRKPT
 1

	)

264 
	#TRAP_TRACE
 2

	)

267 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

268 
	#CLD_NOOP
 0

	)

270 
	#CLD_EXITED
 1

	)

271 
	#CLD_KILLED
 2

	)

272 
	#CLD_DUMPED
 3

	)

273 
	#CLD_TRAPPED
 4

	)

274 
	#CLD_STOPPED
 5

	)

275 
	#CLD_CONTINUED
 6

	)

278 
	#POLL_IN
 1

	)

279 
	#POLL_OUT
 2

	)

280 
	#POLL_MSG
 3

	)

281 
	#POLL_ERR
 4

	)

282 
	#POLL_PRI
 5

	)

283 
	#POLL_HUP
 6

	)

286 
	u__siga˘i⁄_u
 {

287 (*
	m__ß_h™dÀr
)();

288 (*
	m__ß_siga˘i⁄
)(, 
	m__sigöfo
 *,

293 
	s__siga˘i⁄
 {

294 
__siga˘i⁄_u
 
	m__siga˘i⁄_u
;

295 (*
	mß_åamp
)(*, , , 
	msigöfo_t
 *, *);

296 
sig£t_t
 
	mß_mask
;

297 
	mß_Êags
;

303 
	ssiga˘i⁄
 {

304 
__siga˘i⁄_u
 
	m__siga˘i⁄_u
;

305 
sig£t_t
 
	mß_mask
;

306 
	mß_Êags
;

312 
	#ß_h™dÀr
 
__siga˘i⁄_u
.
__ß_h™dÀr


	)

313 
	#ß_siga˘i⁄
 
__siga˘i⁄_u
.
__ß_siga˘i⁄


	)

315 
	#SA_ONSTACK
 0x0001

	)

316 
	#SA_RESTART
 0x0002

	)

317 
	#SA_RESETHAND
 0x0004

	)

318 
	#SA_NOCLDSTOP
 0x0008

	)

319 
	#SA_NODEFER
 0x0010

	)

320 
	#SA_NOCLDWAIT
 0x0020

	)

321 
	#SA_SIGINFO
 0x0040

	)

322 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

323 
	#SA_USERTRAMP
 0x0100

	)

325 
	#SA_64REGSET
 0x0200

	)

331 
	#SA_USERSPACE_MASK
 (
SA_ONSTACK
 | 
SA_RESTART
 | 
SA_RESETHAND
 | 
SA_NOCLDSTOP
 | 
SA_NODEFER
 | 
SA_NOCLDWAIT
 | 
SA_SIGINFO
)

	)

336 
	#SIG_BLOCK
 1

	)

337 
	#SIG_UNBLOCK
 2

	)

338 
	#SIG_SETMASK
 3

	)

341 
	#SI_USER
 0x10001

	)

342 
	#SI_QUEUE
 0x10002

	)

343 
	#SI_TIMER
 0x10003

	)

344 
	#SI_ASYNCIO
 0x10004

	)

345 
	#SI_MESGQ
 0x10005

	)

347 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

348 (*
	tsig_t
)();

355 
	#SS_ONSTACK
 0x0001

	)

356 
	#SS_DISABLE
 0x0004

	)

357 
	#MINSIGSTKSZ
 32768

	)

358 
	#SIGSTKSZ
 131072

	)

360 #i‡!
	`deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

365 
	ssigvec
 {

366 (*
sv_h™dÀr
)();

367 
sv_mask
;

368 
sv_Êags
;

371 
	#SV_ONSTACK
 
SA_ONSTACK


	)

372 
	#SV_INTERRUPT
 
SA_RESTART


	)

373 
	#SV_RESETHAND
 
SA_RESETHAND


	)

374 
	#SV_NODEFER
 
SA_NODEFER


	)

375 
	#SV_NOCLDSTOP
 
SA_NOCLDSTOP


	)

376 
	#SV_SIGINFO
 
SA_SIGINFO


	)

378 
	#sv_⁄°ack
 
sv_Êags


	)

384 
	ssig°ack
 {

385 *
ss_•
;

386 
ss_⁄°ack
;

389 #i‡!
	`deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

394 
	#sigmask
(
m
Ë(1 << ((m)-1))

	)

397 
	#BADSIG
 
SIG_ERR


	)

406 
__BEGIN_DECLS


407 (*
	`sig«l
(, (*)()))();

408 
__END_DECLS


	@/usr/include/sys/syslog.h

61 #i‚de‡
_SYS_SYSLOG_H_


62 
	#_SYS_SYSLOG_H_


	)

64 
	~<sys/≠∂ópi›ts.h
>

65 
	~<sys/cdefs.h
>

67 
	#_PATH_LOG
 "/v¨/run/sy¶og"

	)

78 
	#LOG_EMERG
 0

	)

79 
	#LOG_ALERT
 1

	)

80 
	#LOG_CRIT
 2

	)

81 
	#LOG_ERR
 3

	)

82 
	#LOG_WARNING
 4

	)

83 
	#LOG_NOTICE
 5

	)

84 
	#LOG_INFO
 6

	)

85 
	#LOG_DEBUG
 7

	)

87 
	#LOG_PRIMASK
 0x07

	)

89 
	#LOG_PRI
(
p
Ë(’Ë& 
LOG_PRIMASK
)

	)

90 
	#LOG_MAKEPRI
(
Ác
, 
¥i
Ë((ÁcË| (¥i))

	)

92 #ifde‡
SYSLOG_NAMES


93 
	#INTERNAL_NOPRI
 0x10

	)

95 
	#INTERNAL_MARK
 
	`LOG_MAKEPRI
((
LOG_NFACILITIES
<<3), 0)

	)

96 
	s_code
 {

97 c⁄° *
	mc_«me
;

98 
	mc_vÆ
;

99 } 
	tCODE
;

101 
CODE
 
	g¥i‹ôy«mes
[] = {

102 { "Æît", 
LOG_ALERT
, },

103 { "¸ô", 
LOG_CRIT
, },

104 { "debug", 
LOG_DEBUG
, },

105 { "emîg", 
LOG_EMERG
, },

106 { "îr", 
LOG_ERR
, },

107 { "îr‹", 
LOG_ERR
, },

108 { "öfo", 
LOG_INFO
, },

109 { "n⁄e", 
INTERNAL_NOPRI
, },

110 { "nŸi˚", 
LOG_NOTICE
, },

111 { "∑nic", 
LOG_EMERG
, },

112 { "w¨n", 
LOG_WARNING
, },

113 { "w¨nög", 
LOG_WARNING
, },

114 { 
NULL
, -1, }

119 
	#LOG_KERN
 (0<<3Ë

	)

120 
	#LOG_USER
 (1<<3Ë

	)

121 
	#LOG_MAIL
 (2<<3Ë

	)

122 
	#LOG_DAEMON
 (3<<3Ë

	)

123 
	#LOG_AUTH
 (4<<3Ë

	)

124 
	#LOG_SYSLOG
 (5<<3Ë

	)

125 
	#LOG_LPR
 (6<<3Ë

	)

126 
	#LOG_NEWS
 (7<<3Ë

	)

127 
	#LOG_UUCP
 (8<<3Ë

	)

128 
	#LOG_CRON
 (9<<3Ë

	)

129 
	#LOG_AUTHPRIV
 (10<<3Ë

	)

133 
	#LOG_FTP
 (11<<3Ë

	)

137 
	#LOG_NETINFO
 (12<<3Ë

	)

138 
	#LOG_REMOTEAUTH
 (13<<3Ë

	)

139 
	#LOG_INSTALL
 (14<<3Ë

	)

140 
	#LOG_RAS
 (15<<3Ë

	)

143 
	#LOG_LOCAL0
 (16<<3Ë

	)

144 
	#LOG_LOCAL1
 (17<<3Ë

	)

145 
	#LOG_LOCAL2
 (18<<3Ë

	)

146 
	#LOG_LOCAL3
 (19<<3Ë

	)

147 
	#LOG_LOCAL4
 (20<<3Ë

	)

148 
	#LOG_LOCAL5
 (21<<3Ë

	)

149 
	#LOG_LOCAL6
 (22<<3Ë

	)

150 
	#LOG_LOCAL7
 (23<<3Ë

	)

152 
	#LOG_LAUNCHD
 (24<<3Ë

	)

154 
	#LOG_NFACILITIES
 25

	)

155 
	#LOG_FACMASK
 0x03f8

	)

157 
	#LOG_FAC
(
p
Ë((’Ë& 
LOG_FACMASK
Ë>> 3)

	)

159 #ifde‡
SYSLOG_NAMES


160 
CODE
 
	gÁcûôy«mes
[] = {

161 { "auth", 
LOG_AUTH
, },

162 { "auth¥iv", 
LOG_AUTHPRIV
, },

163 { "¸⁄", 
LOG_CRON
, },

164 { "d´m⁄", 
LOG_DAEMON
, },

165 { "·p", 
LOG_FTP
, },

166 { "ö°Æl", 
LOG_INSTALL
 },

167 { "kîn", 
LOG_KERN
, },

168 { "Õr", 
LOG_LPR
, },

169 { "maû", 
LOG_MAIL
, },

170 { "m¨k", 
INTERNAL_MARK
, },

171 { "√töfo", 
LOG_NETINFO
, },

172 { "øs", 
LOG_RAS
 },

173 { "ªmŸóuth", 
LOG_REMOTEAUTH
 },

174 { "√ws", 
LOG_NEWS
, },

175 { "£curôy", 
LOG_AUTH
 },

176 { "sy¶og", 
LOG_SYSLOG
, },

177 { "u£r", 
LOG_USER
, },

178 { "uu˝", 
LOG_UUCP
, },

179 { "loˇl0", 
LOG_LOCAL0
, },

180 { "loˇl1", 
LOG_LOCAL1
, },

181 { "loˇl2", 
LOG_LOCAL2
, },

182 { "loˇl3", 
LOG_LOCAL3
, },

183 { "loˇl4", 
LOG_LOCAL4
, },

184 { "loˇl5", 
LOG_LOCAL5
, },

185 { "loˇl6", 
LOG_LOCAL6
, },

186 { "loˇl7", 
LOG_LOCAL7
, },

187 { "œunchd", 
LOG_LAUNCHD
 },

188 { 
NULL
, -1, }

196 
	#LOG_MASK
(
¥i
Ë(1 << (¥i)Ë

	)

197 
	#LOG_UPTO
(
¥i
Ë((1 << (’ri)+1)Ë- 1Ë

	)

205 
	#LOG_PID
 0x01

	)

206 
	#LOG_CONS
 0x02

	)

207 
	#LOG_ODELAY
 0x04

	)

208 
	#LOG_NDELAY
 0x08

	)

209 
	#LOG_NOWAIT
 0x10

	)

210 
	#LOG_PERROR
 0x20

	)

220 
	~<sys/_ty≥s.h
>

222 
__BEGIN_DECLS


223 
˛o£log
();

224 
›ílog
(const *, , );

225 
£éogmask
();

226 
	$sy¶og
(, c⁄° *, ...Ë
	$__¥ötÊike
(2, 3Ë
	`__DARWIN_LDBL_COMPAT
(
sy¶og
);

227 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


228 
	$vsy¶og
(, c⁄° *, 
__d¨wö_va_li°
Ë
	$__¥ötÊike
(2, 0Ë
	`__DARWIN_LDBL_COMPAT
(
vsy¶og
);

230 
__END_DECLS


	@/usr/include/sys/unistd.h

64 #i‚de‡
_SYS_UNISTD_H_


65 
	#_SYS_UNISTD_H_


	)

67 
	~<sys/cdefs.h
>

75 #ifdef 
_NOT_AVAILABLE


76 
	#_POSIX_SAVED_IDS


	)

79 
	#_POSIX_VERSION
 200112L

	)

80 
	#_POSIX2_VERSION
 200112L

	)

84 #i‚de‡
_POSIX_VDISABLE


85 
	#_POSIX_VDISABLE
 (()'\377')

	)

88 
	#_POSIX_THREAD_KEYS_MAX
 128

	)

91 
	#F_OK
 0

	)

92 
	#X_OK
 (1<<0Ë

	)

93 
	#W_OK
 (1<<1Ë

	)

94 
	#R_OK
 (1<<2Ë

	)

96 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

102 
	#_READ_OK
 (1<<9Ë

	)

103 
	#_WRITE_OK
 (1<<10Ë

	)

104 
	#_EXECUTE_OK
 (1<<11Ë

	)

105 
	#_DELETE_OK
 (1<<12Ë

	)

106 
	#_APPEND_OK
 (1<<13Ë

	)

107 
	#_RMFILE_OK
 (1<<14Ë

	)

108 
	#_RATTR_OK
 (1<<15Ë

	)

109 
	#_WATTR_OK
 (1<<16Ë

	)

110 
	#_REXT_OK
 (1<<17Ë

	)

111 
	#_WEXT_OK
 (1<<18Ë

	)

112 
	#_RPERM_OK
 (1<<19Ë

	)

113 
	#_WPERM_OK
 (1<<20Ë

	)

114 
	#_CHOWN_OK
 (1<<21Ë

	)

116 
	#_ACCESS_EXTENDED_MASK
 (
_READ_OK
 | 
_WRITE_OK
 | 
_EXECUTE_OK
 | \

117 
_DELETE_OK
 | 
_APPEND_OK
 | \

118 
_RMFILE_OK
 | 
_REXT_OK
 | \

119 
_WEXT_OK
 | 
_RATTR_OK
 | 
_WATTR_OK
 | 
_RPERM_OK
 | \

120 
_WPERM_OK
 | 
_CHOWN_OK
)

	)

124 #i‚de‡
SEEK_SET


125 
	#SEEK_SET
 0

	)

126 
	#SEEK_CUR
 1

	)

127 
	#SEEK_END
 2

	)

130 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

132 
	#L_SET
 
SEEK_SET


	)

133 
	#L_INCR
 
SEEK_CUR


	)

134 
	#L_XTND
 
SEEK_END


	)

137 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

138 
	sac˚ssx_des¸ùt‹
 {

139 
	mad_«me_off£t
;

140 
	mad_Êags
;

141 
	mad_∑d
[2];

143 
	#ACCESSX_MAX_DESCRIPTORS
 100

	)

144 
	#ACCESSX_MAX_TABLESIZE
 (16 * 1024)

	)

148 
	#_PC_LINK_MAX
 1

	)

149 
	#_PC_MAX_CANON
 2

	)

150 
	#_PC_MAX_INPUT
 3

	)

151 
	#_PC_NAME_MAX
 4

	)

152 
	#_PC_PATH_MAX
 5

	)

153 
	#_PC_PIPE_BUF
 6

	)

154 
	#_PC_CHOWN_RESTRICTED
 7

	)

155 
	#_PC_NO_TRUNC
 8

	)

156 
	#_PC_VDISABLE
 9

	)

158 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

159 
	#_PC_NAME_CHARS_MAX
 10

	)

160 
	#_PC_CASE_SENSITIVE
 11

	)

161 
	#_PC_CASE_PRESERVING
 12

	)

162 
	#_PC_EXTENDED_SECURITY_NP
 13

	)

163 
	#_PC_AUTH_OPAQUE_NP
 14

	)

166 
	#_PC_2_SYMLINKS
 15

	)

167 
	#_PC_ALLOC_SIZE_MIN
 16

	)

168 
	#_PC_ASYNC_IO
 17

	)

169 
	#_PC_FILESIZEBITS
 18

	)

170 
	#_PC_PRIO_IO
 19

	)

171 
	#_PC_REC_INCR_XFER_SIZE
 20

	)

172 
	#_PC_REC_MAX_XFER_SIZE
 21

	)

173 
	#_PC_REC_MIN_XFER_SIZE
 22

	)

174 
	#_PC_REC_XFER_ALIGN
 23

	)

175 
	#_PC_SYMLINK_MAX
 24

	)

176 
	#_PC_SYNC_IO
 25

	)

177 
	#_PC_XATTR_SIZE_BITS
 26

	)

180 
	#_CS_PATH
 1

	)

	@/usr/include/sys/wait.h

64 #i‚de‡
_SYS_WAIT_H_


65 
	#_SYS_WAIT_H_


	)

67 
	~<sys/cdefs.h
>

68 
	~<sys/_ty≥s.h
>

80 
	mP_ALL
,

81 
	mP_PID
,

82 
	mP_PGID


83 } 
	tidty≥_t
;

89 #i‚de‡
_PID_T


90 
__d¨wö_pid_t
 
	tpid_t
;

91 
	#_PID_T


	)

94 #i‚de‡
_ID_T


95 
__d¨wö_id_t
 
	tid_t
;

96 
	#_ID_T


	)

116 
	~<sys/sig«l.h
>

117 
	~<sys/ªsour˚.h
>

128 
	#WNOHANG
 0x00000001

	)

129 
	#WUNTRACED
 0x00000002

	)

135 #i‡
deföed
(
_POSIX_C_SOURCE
Ë&& !deföed(
_DARWIN_C_SOURCE
)

136 
	#_W_INT
(
i
Ë(i)

	)

138 
	#_W_INT
(
w
Ë(*(*)&(w)Ë

	)

139 
	#WCOREFLAG
 0200

	)

143 
	#_WSTATUS
(
x
Ë(
	`_W_INT
(xË& 0177)

	)

144 
	#_WSTOPPED
 0177

	)

150 #i‡
__DARWIN_UNIX03


151 
	#WEXITSTATUS
(
x
Ë((
	`_W_INT
(xË>> 8Ë& 0x000000ff)

	)

153 
	#WEXITSTATUS
(
x
Ë(
	`_W_INT
(xË>> 8)

	)

156 
	#WSTOPSIG
(
x
Ë(
	`_W_INT
(xË>> 8)

	)

157 
	#WIFCONTINUED
(
x
Ë(
	`_WSTATUS
(xË=
_WSTOPPED
 && 
	`WSTOPSIG
(xË=0x13)

	)

158 
	#WIFSTOPPED
(
x
Ë(
	`_WSTATUS
(xË=
_WSTOPPED
 && 
	`WSTOPSIG
(xË!0x13)

	)

159 
	#WIFEXITED
(
x
Ë(
	`_WSTATUS
(xË=0)

	)

160 
	#WIFSIGNALED
(
x
Ë(
	`_WSTATUS
(xË!
_WSTOPPED
 && _WSTATUS(xË!0)

	)

161 
	#WTERMSIG
(
x
Ë(
	`_WSTATUS
(x))

	)

162 #i‡(!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

163 
	#WCOREDUMP
(
x
Ë(
	`_W_INT
(xË& 
WCOREFLAG
)

	)

165 
	#W_EXITCODE
(
ªt
, 
sig
Ë(‘ëË<< 8 | (sig))

	)

166 
	#W_STOPCODE
(
sig
Ë((sigË<< 8 | 
_WSTOPPED
)

	)

175 
	#WEXITED
 0x00000004

	)

176 #i‡
__DARWIN_UNIX03


178 
	#WSTOPPED
 0x00000008

	)

180 
	#WCONTINUED
 0x00000010

	)

181 
	#WNOWAIT
 0x00000020

	)

184 #i‡(!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

190 
	#WAIT_ANY
 (-1Ë

	)

191 
	#WAIT_MYPGRP
 0

	)

193 
	~<machöe/ídün.h
>

201 
	uwaô
 {

202 
	mw_°©us
;

207 #i‡
__DARWIN_BYTE_ORDER
 =
__DARWIN_LITTLE_ENDIAN


208 
	mw_Tîmsig
:7,

209 
	mw_C‹edump
:1,

210 
	mw_Rëcode
:8,

211 
	mw_FûÀr
:16;

213 #i‡
__DARWIN_BYTE_ORDER
 =
__DARWIN_BIG_ENDIAN


214 
	mw_FûÀr
:16,

215 
	mw_Rëcode
:8,

216 
	mw_C‹edump
:1,

217 
	mw_Tîmsig
:7;

219 } 
	mw_T
;

226 #i‡
__DARWIN_BYTE_ORDER
 =
__DARWIN_LITTLE_ENDIAN


227 
	mw_St›vÆ
:8,

228 
	mw_St›sig
:8,

229 
	mw_FûÀr
:16;

231 #i‡
__DARWIN_BYTE_ORDER
 =
__DARWIN_BIG_ENDIAN


232 
	mw_FûÀr
:16,

233 
	mw_St›sig
:8,

234 
	mw_St›vÆ
:8;

236 } 
	mw_S
;

238 
	#w_ãrmsig
 
w_T
.
w_Tîmsig


	)

239 
	#w_c‹edump
 
w_T
.
w_C‹edump


	)

240 
	#w_ªtcode
 
w_T
.
w_Rëcode


	)

241 
	#w_°›vÆ
 
w_S
.
w_St›vÆ


	)

242 
	#w_°›sig
 
w_S
.
w_St›sig


	)

246 #i‡!(
__DARWIN_UNIX03
 - 0)

251 
	#WSTOPPED
 
_WSTOPPED


	)

254 
__BEGIN_DECLS


255 
pid_t
 
	$waô
(*Ë
	`__DARWIN_ALIAS_C
(
waô
);

256 
pid_t
 
	$waôpid
(
pid_t
, *, Ë
	`__DARWIN_ALIAS_C
(
waôpid
);

257 #i‚de‡
_ANSI_SOURCE


258 
	$waôid
(
idty≥_t
, 
id_t
, 
sigöfo_t
 *, Ë
	`__DARWIN_ALIAS_C
(
waôid
);

260 #i‡ (!
	`deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

261 
pid_t
 
	`waô3
(*, , 
rußge
 *);

262 
pid_t
 
	`waô4
’id_t, *, , 
rußge
 *);

264 
__END_DECLS


	@/usr/include/xlocale/_ctype.h

24 #i‚de‡
_XLOCALE__CTYPE_H_


25 
	#_XLOCALE__CTYPE_H_


	)

30 #i‡!
deföed
(
_DONT_USE_CTYPE_INLINE_
) && \

31 (
deföed
(
_USE_CTYPE_INLINE_
Ë|| deföed(
__GNUC__
Ë|| 
	$deföed
(
__˝lu•lus
))

34 
__BEGIN_DECLS


35 
	`___ru√ty≥_l
(
__d¨wö_˘_ru√_t
, 
loˇÀ_t
);

36 
__d¨wö_˘_ru√_t
 
	`___tﬁowî_l
(__d¨wö_˘_ru√_t, 
loˇÀ_t
);

37 
__d¨wö_˘_ru√_t
 
	`___touµî_l
(__d¨wö_˘_ru√_t, 
loˇÀ_t
);

38 
__END_DECLS


40 
__BEGIN_DECLS


41 
	`__maskru√_l
(
__d¨wö_˘_ru√_t
, , 
loˇÀ_t
);

42 
__END_DECLS


44 
__DARWIN_CTYPE_°©ic_ölöe
 

45 
	$__i°y≥_l
(
__d¨wö_˘_ru√_t
 
_c
, 
_f
, 
loˇÀ_t
 
_l
)

47  !!(
	`ißscii
(
_c
Ë? (
_DeÁu…Ru√LoˇÀ
.
__ru√ty≥
[_c] & 
_f
)

48 : 
	`__maskru√_l
(
_c
, 
_f
, 
_l
));

49 
	}
}

51 
__DARWIN_CTYPE_°©ic_ölöe
 
__d¨wö_˘_ru√_t


52 
	$__touµî_l
(
__d¨wö_˘_ru√_t
 
_c
, 
loˇÀ_t
 
_l
)

54  
	`ißscii
(
_c
Ë? 
_DeÁu…Ru√LoˇÀ
.
__m≠uµî
[_c]

55 : 
	`___touµî_l
(
_c
, 
_l
);

56 
	}
}

58 
__DARWIN_CTYPE_°©ic_ölöe
 
__d¨wö_˘_ru√_t


59 
	$__tﬁowî_l
(
__d¨wö_˘_ru√_t
 
_c
, 
loˇÀ_t
 
_l
)

61  
	`ißscii
(
_c
Ë? 
_DeÁu…Ru√LoˇÀ
.
__m≠lowî
[_c]

62 : 
	`___tﬁowî_l
(
_c
, 
_l
);

63 
	}
}

65 
__DARWIN_CTYPE_°©ic_ölöe
 

66 
	$__wcwidth_l
(
__d¨wö_˘_ru√_t
 
_c
, 
loˇÀ_t
 
_l
)

68 
_x
;

70 i‡(
_c
 == 0)

72 
_x
 = ()
	`__maskru√_l
(
_c
, 
_CTYPE_SWM
|
_CTYPE_R
, 
_l
);

73 i‡((
_x
 & 
_CTYPE_SWM
) != 0)

74  ((
_x
 & 
_CTYPE_SWM
Ë>> 
_CTYPE_SWS
);

75  ((
_x
 & 
_CTYPE_R
) != 0 ? 1 : -1);

76 
	}
}

78 #i‚de‡
_EXTERNALIZE_CTYPE_INLINES_


80 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

81 
	$digôtoöt_l
(
c
, 
loˇÀ_t
 
l
)

83  (
	`__maskru√_l
(
c
, 0x0F, 
l
));

84 
	}
}

86 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

87 
	$iß um_l
(
c
, 
loˇÀ_t
 
l
)

89  (
	`__i°y≥_l
(
c
, 
_CTYPE_A
|
_CTYPE_D
, 
l
));

90 
	}
}

92 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

93 
	$ißÕha_l
(
c
, 
loˇÀ_t
 
l
)

95  (
	`__i°y≥_l
(
c
, 
_CTYPE_A
, 
l
));

96 
	}
}

98 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

99 
	$isbœnk_l
(
c
, 
loˇÀ_t
 
l
)

101  (
	`__i°y≥_l
(
c
, 
_CTYPE_B
, 
l
));

102 
	}
}

104 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

105 
	$is˙ål_l
(
c
, 
loˇÀ_t
 
l
)

107  (
	`__i°y≥_l
(
c
, 
_CTYPE_C
, 
l
));

108 
	}
}

110 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

111 
	$isdigô_l
(
c
, 
loˇÀ_t
 
l
)

113  (
	`__i°y≥_l
(
c
, 
_CTYPE_D
, 
l
));

114 
	}
}

116 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

117 
	$isgøph_l
(
c
, 
loˇÀ_t
 
l
)

119  (
	`__i°y≥_l
(
c
, 
_CTYPE_G
, 
l
));

120 
	}
}

122 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

123 
	$ishexnumbî_l
(
c
, 
loˇÀ_t
 
l
)

125  (
	`__i°y≥_l
(
c
, 
_CTYPE_X
, 
l
));

126 
	}
}

128 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

129 
	$isideogøm_l
(
c
, 
loˇÀ_t
 
l
)

131  (
	`__i°y≥_l
(
c
, 
_CTYPE_I
, 
l
));

132 
	}
}

134 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

135 
	$i¶owî_l
(
c
, 
loˇÀ_t
 
l
)

137  (
	`__i°y≥_l
(
c
, 
_CTYPE_L
, 
l
));

138 
	}
}

140 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

141 
	$i¢umbî_l
(
c
, 
loˇÀ_t
 
l
)

143  (
	`__i°y≥_l
(
c
, 
_CTYPE_D
, 
l
));

144 
	}
}

146 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

147 
	$i•h⁄ogøm_l
(
c
, 
loˇÀ_t
 
l
)

149  (
	`__i°y≥_l
(
c
, 
_CTYPE_Q
, 
l
));

150 
	}
}

152 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

153 
	$i•röt_l
(
c
, 
loˇÀ_t
 
l
)

155  (
	`__i°y≥_l
(
c
, 
_CTYPE_R
, 
l
));

156 
	}
}

158 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

159 
	$i•un˘_l
(
c
, 
loˇÀ_t
 
l
)

161  (
	`__i°y≥_l
(
c
, 
_CTYPE_P
, 
l
));

162 
	}
}

164 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

165 
	$i§u√_l
(
c
, 
loˇÀ_t
 
l
)

167  (
	`__i°y≥_l
(
c
, 0xFFFFFFF0L, 
l
));

168 
	}
}

170 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

171 
	$is•a˚_l
(
c
, 
loˇÀ_t
 
l
)

173  (
	`__i°y≥_l
(
c
, 
_CTYPE_S
, 
l
));

174 
	}
}

176 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

177 
	$is•ecül_l
(
c
, 
loˇÀ_t
 
l
)

179  (
	`__i°y≥_l
(
c
, 
_CTYPE_T
, 
l
));

180 
	}
}

182 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

183 
	$isuµî_l
(
c
, 
loˇÀ_t
 
l
)

185  (
	`__i°y≥_l
(
c
, 
_CTYPE_U
, 
l
));

186 
	}
}

188 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

189 
	$isxdigô_l
(
c
, 
loˇÀ_t
 
l
)

191  (
	`__i°y≥_l
(
c
, 
_CTYPE_X
, 
l
));

192 
	}
}

194 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

195 
	$tﬁowî_l
(
c
, 
loˇÀ_t
 
l
)

197  (
	`__tﬁowî_l
(
c
, 
l
));

198 
	}
}

200 
__DARWIN_CTYPE_TOP_°©ic_ölöe
 

201 
	$touµî_l
(
c
, 
loˇÀ_t
 
l
)

203  (
	`__touµî_l
(
c
, 
l
));

204 
	}
}

209 
__BEGIN_DECLS


210 
digôtoöt_l
(, 
loˇÀ_t
);

211 
iß um_l
(, 
loˇÀ_t
);

212 
ißÕha_l
(, 
loˇÀ_t
);

213 
isbœnk_l
(, 
loˇÀ_t
);

214 
is˙ål_l
(, 
loˇÀ_t
);

215 
isdigô_l
(, 
loˇÀ_t
);

216 
isgøph_l
(, 
loˇÀ_t
);

217 
ishexnumbî_l
(, 
loˇÀ_t
);

218 
isideogøm_l
(, 
loˇÀ_t
);

219 
i¶owî_l
(, 
loˇÀ_t
);

220 
i¢umbî_l
(, 
loˇÀ_t
);

221 
i•h⁄ogøm_l
(, 
loˇÀ_t
);

222 
i•röt_l
(, 
loˇÀ_t
);

223 
i•un˘_l
(, 
loˇÀ_t
);

224 
i§u√_l
(, 
loˇÀ_t
);

225 
is•a˚_l
(, 
loˇÀ_t
);

226 
is•ecül_l
(, 
loˇÀ_t
);

227 
isuµî_l
(, 
loˇÀ_t
);

228 
isxdigô_l
(, 
loˇÀ_t
);

229 
tﬁowî_l
(, 
loˇÀ_t
);

230 
touµî_l
(, 
loˇÀ_t
);

231 
	g__END_DECLS


	@/usr/include/xlocale/_inttypes.h

24 #i‚de‡
_XLOCALE__INTTYPES_H_


25 
	#_XLOCALE__INTTYPES_H_


	)

27 
__BEGIN_DECLS


28 
ötmax_t
 
°πoimax_l
(c⁄° * 
__ª°ri˘
 
≈å
, ** __ª°ri˘ 
íd±r
,

29 
ba£
, 
loˇÀ_t
);

30 
uötmax_t
 
°πoumax_l
(c⁄° * 
__ª°ri˘
 
≈å
, ** __ª°ri˘ 
íd±r
,

31 
ba£
, 
loˇÀ_t
);

32 
ötmax_t
 
wc°oimax_l
(c⁄° 
wch¨_t
 * 
__ª°ri˘
 
≈å
,

33 
wch¨_t
 ** 
__ª°ri˘
 
íd±r
, 
ba£
, 
loˇÀ_t
);

34 
uötmax_t
 
wc°oumax_l
(c⁄° 
wch¨_t
 * 
__ª°ri˘
 
≈å
,

35 
wch¨_t
 ** 
__ª°ri˘
 
íd±r
, 
ba£
, 
loˇÀ_t
);

38 #i‡!
deföed
(
__˝lu•lus
Ë&& deföed(
__WCHAR_MAX__
) && __WCHAR_MAX__ <= 0xffffU

39 #¥agm®
GCC
 
pois⁄
 
wc°oimax_l
 
wc°oumax_l


41 
	g__END_DECLS


	@/usr/include/xlocale/_stdio.h

24 #i‚de‡
_XLOCALE__STDIO_H_


25 
	#_XLOCALE__STDIO_H_


	)

27 
__BEGIN_DECLS


29 
	$Ârötf_l
(
FILE
 * 
__ª°ri˘
, 
loˇÀ_t
, const * __restrict, ...)

30 
	$__DARWIN_LDBL_COMPAT2
(
Ârötf_l
Ë
	`__¥ötÊike
(3, 4);

31 
	$fsˇnf_l
(
FILE
 * 
__ª°ri˘
, 
loˇÀ_t
, const * __restrict, ...)

32 
	$__DARWIN_LDBL_COMPAT2
(
fsˇnf_l
Ë
	`__sˇnÊike
(3, 4);

33 
	$¥ötf_l
(
loˇÀ_t
, c⁄° * 
__ª°ri˘
, ...)

34 
	$__DARWIN_LDBL_COMPAT2
(
¥ötf_l
Ë
	`__¥ötÊike
(2, 3);

35 
	$sˇnf_l
(
loˇÀ_t
, c⁄° * 
__ª°ri˘
, ...)

36 
	$__DARWIN_LDBL_COMPAT2
(
sˇnf_l
Ë
	`__sˇnÊike
(2, 3);

37 
	$•rötf_l
(* 
__ª°ri˘
, 
loˇÀ_t
, const * __restrict, ...)

38 
	$__DARWIN_LDBL_COMPAT2
(
•rötf_l
Ë
	`__¥ötÊike
(3, 4);

39 
	$ssˇnf_l
(c⁄° * 
__ª°ri˘
, 
loˇÀ_t
, const * __restrict, ...)

40 
	$__DARWIN_LDBL_COMPAT2
(
ssˇnf_l
Ë
	`__sˇnÊike
(3, 4);

41 
	$vÂrötf_l
(
FILE
 * 
__ª°ri˘
, 
loˇÀ_t
, c⁄° * __ª°ri˘, 
va_li°
)

42 
	$__DARWIN_LDBL_COMPAT2
(
vÂrötf_l
Ë
	`__¥ötÊike
(3, 0);

43 
	$v¥ötf_l
(
loˇÀ_t
, c⁄° * 
__ª°ri˘
, 
va_li°
)

44 
	$__DARWIN_LDBL_COMPAT2
(
v¥ötf_l
Ë
	`__¥ötÊike
(2, 0);

45 
	$v•rötf_l
(* 
__ª°ri˘
, 
loˇÀ_t
, c⁄° * __ª°ri˘, 
va_li°
)

46 
	$__DARWIN_LDBL_COMPAT2
(
v•rötf_l
Ë
	`__¥ötÊike
(3, 0);

48 #i‡
__DARWIN_C_LEVEL
 >= 200112L

49 
	$¢¥ötf_l
(* 
__ª°ri˘
, 
size_t
, 
loˇÀ_t
, const * __restrict, ...)

50 
	$__DARWIN_LDBL_COMPAT2
(
¢¥ötf_l
Ë
	`__¥ötÊike
(4, 5);

51 
	$vfsˇnf_l
(
FILE
 * 
__ª°ri˘
, 
loˇÀ_t
, c⁄° * __ª°ri˘, 
va_li°
)

52 
	$__DARWIN_LDBL_COMPAT2
(
vfsˇnf_l
Ë
	`__sˇnÊike
(3, 0);

53 
	$vsˇnf_l
(
loˇÀ_t
, c⁄° * 
__ª°ri˘
, 
va_li°
)

54 
	$__DARWIN_LDBL_COMPAT2
(
vsˇnf_l
Ë
	`__sˇnÊike
(2, 0);

55 
	$v¢¥ötf_l
(* 
__ª°ri˘
, 
size_t
, 
loˇÀ_t
, c⁄° * __ª°ri˘, 
va_li°
)

56 
	$__DARWIN_LDBL_COMPAT2
(
v¢¥ötf_l
Ë
	`__¥ötÊike
(4, 0);

57 
	$vssˇnf_l
(c⁄° * 
__ª°ri˘
, 
loˇÀ_t
, c⁄° * __ª°ri˘, 
va_li°
)

58 
	$__DARWIN_LDBL_COMPAT2
(
vssˇnf_l
Ë
	`__sˇnÊike
(3, 0);

61 #i‡
__DARWIN_C_LEVEL
 >= 200809L

62 
	$d¥ötf_l
(, 
loˇÀ_t
, c⁄° * 
__ª°ri˘
, ...)

63 
	$__DARWIN_LDBL_COMPAT2
(
d¥ötf_l
Ë
	$__¥ötÊike
(3, 4Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

64 
	$vd¥ötf_l
(, 
loˇÀ_t
, c⁄° * 
__ª°ri˘
, 
va_li°
)

65 
	$__DARWIN_LDBL_COMPAT2
(
vd¥ötf_l
Ë
	$__¥ötÊike
(3, 0Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_7
, 
__IPHONE_4_3
);

69 #i‡
__DARWIN_C_LEVEL
 >
__DARWIN_C_FULL


70 
	$a•rötf_l
(**, 
loˇÀ_t
, const *, ...)

71 
	$__DARWIN_LDBL_COMPAT2
(
a•rötf_l
Ë
	`__¥ötÊike
(3, 4);

72 
	$va•rötf_l
(**, 
loˇÀ_t
, c⁄° *, 
va_li°
)

73 
	$__DARWIN_LDBL_COMPAT2
(
va•rötf_l
Ë
	`__¥ötÊike
(3, 0);

76 
__END_DECLS


	@/usr/include/xlocale/_stdlib.h

24 #i‚de‡
_XLOCALE__STDLIB_H_


25 
	#_XLOCALE__STDLIB_H_


	)

27 
__BEGIN_DECLS


28 
©of_l
(c⁄° *, 
loˇÀ_t
);

29 
©oi_l
(c⁄° *, 
loˇÀ_t
);

30 
©ﬁ_l
(c⁄° *, 
loˇÀ_t
);

31 #i‡!
__DARWIN_NO_LONG_LONG


33 
©ﬁl_l
(c⁄° *, 
loˇÀ_t
);

35 
mbÀn_l
(c⁄° *, 
size_t
, 
loˇÀ_t
);

36 
size_t
 
mb°owcs_l
(
wch¨_t
 * 
__ª°ri˘
 , const * __restrict, size_t,

37 
loˇÀ_t
);

38 
mbtowc_l
(
wch¨_t
 * 
__ª°ri˘
, c⁄° * __ª°ri˘, 
size_t
,

39 
loˇÀ_t
);

40 
	$°πod_l
(c⁄° *, **, 
loˇÀ_t
Ë
	`__DARWIN_ALIAS
(
°πod_l
);

41 
	$°πof_l
(c⁄° *, **, 
loˇÀ_t
Ë
	`__DARWIN_ALIAS
(
°πof_l
);

42 
	`°πﬁ_l
(c⁄° *, **, , 
loˇÀ_t
);

44 
	$°πﬁd_l
(c⁄° *, **, 
loˇÀ_t
)

45 
	`__DARWIN_LDBL_COMPAT2
(
°πﬁd_l
);

47 
	`°πﬁl_l
(c⁄° *, **, , 
loˇÀ_t
);

48 #i‡!
__DARWIN_NO_LONG_LONG


50 
	`°πoq_l
(c⁄° *, **, , 
loˇÀ_t
);

53 
	`°πoul_l
(c⁄° *, **, , 
loˇÀ_t
);

55 
	`°πouŒ_l
(c⁄° *, **, , 
loˇÀ_t
);

56 #i‡!
__DARWIN_NO_LONG_LONG


58 
	`°πouq_l
(c⁄° *, **, , 
loˇÀ_t
);

60 
size_t
 
	`wc°ombs_l
(* 
__ª°ri˘
, c⁄° 
wch¨_t
 * __restrict, size_t,

61 
loˇÀ_t
);

62 
	`w˘omb_l
(*, 
wch¨_t
, 
loˇÀ_t
);

65 #i‡!
	`deföed
(
__˝lu•lus
Ë&& deföed(
__WCHAR_MAX__
) && __WCHAR_MAX__ <= 0xffffU

66 #¥agm®
GCC
 
pois⁄
 
mb°owcs_l
 
mbtowc_l
 
wc°ombs_l
 
w˘omb_l


68 
__END_DECLS


	@/usr/include/xlocale/_string.h

24 #i‚de‡
_XLOCALE__STRING_H_


25 
	#_XLOCALE__STRING_H_


	)

27 
__BEGIN_DECLS


28 
°rcﬁl_l
(c⁄° *, c⁄° *, 
loˇÀ_t
);

29 
size_t
 
°rx‰m_l
(*, c⁄° *, size_t, 
loˇÀ_t
);

30 
°rˇ£cmp_l
(c⁄° *, c⁄° *, 
loˇÀ_t
);

31 *
°rˇ£°r_l
(c⁄° *, c⁄° *, 
loˇÀ_t
);

32 
°∫ˇ£cmp_l
(c⁄° *, c⁄° *, 
size_t
, 
loˇÀ_t
);

33 
	g__END_DECLS


	@/usr/include/xlocale/_time.h

24 #i‚de‡
_XLOCALE__TIME_H_


25 
	#_XLOCALE__TIME_H_


	)

27 
__BEGIN_DECLS


28 
size_t
 
	$°r·ime_l
(* 
__ª°ri˘
, 
size_t
, const * __restrict,

29 c⁄° 
tm
 * 
__ª°ri˘
, 
loˇÀ_t
)

30 
	$__DARWIN_ALIAS
(
°r·ime_l
Ë
	`__°r·imñike
(3);

31 *
	$°Ωtime_l
(c⁄° * 
__ª°ri˘
, const * __restrict,

32 
tm
 * 
__ª°ri˘
, 
loˇÀ_t
)

33 
	$__DARWIN_ALIAS
(
°Ωtime_l
Ë
	`__°r·imñike
(2);

34 
__END_DECLS


	@/usr/include/AvailabilityInternal.h

30 #i‚de‡
__AVAILABILITY_INTERNAL__


31 
	#__AVAILABILITY_INTERNAL__


	)

35 #i‚de‡
__IPHONE_OS_VERSION_MIN_REQUIRED


36 #ifde‡
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__


38 
	#__IPHONE_OS_VERSION_MIN_REQUIRED
 
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__


	)

42 #ifde‡
__IPHONE_OS_VERSION_MIN_REQUIRED


44 
	#__AVAILABILITY_INTERNAL_DEPRECATED
 
	`__©åibuã__
((
dïªˇãd
))

	)

45 
	#__AVAILABILITY_INTERNAL_UNAVAILABLE
 
	`__©åibuã__
((
u«vaûabÀ
))

	)

46 
	#__AVAILABILITY_INTERNAL_WEAK_IMPORT
 
	`__©åibuã__
((
wók_imp‹t
))

	)

47 
	#__AVAILABILITY_INTERNAL_REGULAR


	)

49 
	#__AVAILABILITY_INTERNAL_DEPRECATED
 
	`__©åibuã__
((
dïªˇãd
,
	`visibûôy
("deÁu…")))

	)

50 
	#__AVAILABILITY_INTERNAL_UNAVAILABLE
 
	`__©åibuã__
((
u«vaûabÀ
,
	`visibûôy
("deÁu…")))

	)

51 
	#__AVAILABILITY_INTERNAL_WEAK_IMPORT
 
	`__©åibuã__
((
wók_imp‹t
,
	`visibûôy
("deÁu…")))

	)

52 
	#__AVAILABILITY_INTERNAL_REGULAR
 
	`__©åibuã__
((
	`visibûôy
("deÁu…")))

	)

55 #ifde‡
__IPHONE_OS_VERSION_MIN_REQUIRED


57 #i‚de‡
__IPHONE_OS_VERSION_MAX_ALLOWED


58 
	#__IPHONE_OS_VERSION_MAX_ALLOWED
 
__IPHONE_4_3


	)

61 #i‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_0


62 #unde‡
__IPHONE_OS_VERSION_MIN_REQUIRED


63 
	#__IPHONE_OS_VERSION_MIN_REQUIRED
 
__IPHONE_2_0


	)

67 #i‡
__IPHONE_OS_VERSION_MAX_ALLOWED
 < 
__IPHONE_2_0


68 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

69 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_0


70 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

72 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

74 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL__IPHONE_2_0


	)

75 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_2_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

77 #i‡
__IPHONE_OS_VERSION_MAX_ALLOWED
 < 
__IPHONE_2_1


78 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

79 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_1


80 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

82 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

84 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

85 #i‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_1


86 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_2_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

87 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_2_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

89 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_2_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

90 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_2_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

93 #i‡
__IPHONE_OS_VERSION_MAX_ALLOWED
 < 
__IPHONE_2_2


94 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

95 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_2


96 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

98 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

100 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

101 #i‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_1


102 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_2_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

103 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_2_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

104 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_2_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

105 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_2


106 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_2_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

107 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_2_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

108 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_2_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

110 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_2_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

111 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_2_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

112 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_2_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

115 #i‡
__IPHONE_OS_VERSION_MAX_ALLOWED
 < 
__IPHONE_3_0


116 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

117 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_0


118 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

120 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

122 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

123 #i‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_1


124 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

125 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

126 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

127 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

128 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_2


129 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

130 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

131 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

132 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

133 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_0


134 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

135 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

136 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

137 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

139 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

140 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

141 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

142 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

145 #i‡
__IPHONE_OS_VERSION_MAX_ALLOWED
 < 
__IPHONE_3_1


146 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

147 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_1


148 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

150 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

152 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

153 #i‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_1


154 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

155 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

156 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

157 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

158 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

159 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_2


160 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

161 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

162 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

163 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

164 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

165 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_0


166 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

167 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

168 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

169 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

170 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

171 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_1


172 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

173 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

174 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

175 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

176 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

178 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

179 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

180 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

181 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

182 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

185 #i‡
__IPHONE_OS_VERSION_MAX_ALLOWED
 < 
__IPHONE_3_2


186 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

187 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_2


188 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

190 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

192 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

193 #i‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_1


194 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

195 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

196 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

197 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

198 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

199 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

200 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_2


201 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

202 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

203 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

204 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

205 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

206 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

207 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_0


208 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

209 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

210 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

211 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

212 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

213 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

214 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_1


215 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

216 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

217 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

218 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

219 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

220 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

221 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_2


222 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

223 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

224 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

225 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

226 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

227 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

229 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

230 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

231 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

232 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

233 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

234 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_3_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

237 #i‡
__IPHONE_OS_VERSION_MAX_ALLOWED
 < 
__IPHONE_4_0


238 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

239 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_0


240 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

242 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

244 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

245 #i‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_1


246 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

247 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

248 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

249 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

250 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

251 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

252 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

253 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_2


254 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

255 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

256 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

257 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

258 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

259 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

260 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

261 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_0


262 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

263 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

264 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

265 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

266 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

267 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

268 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

269 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_1


270 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

271 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

272 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

273 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

274 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

275 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

276 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

277 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_2


278 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

279 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

280 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

281 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

282 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

283 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

284 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

285 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_0


286 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

287 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

288 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

289 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

290 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

291 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

292 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

294 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

295 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

296 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

297 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

298 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

299 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

300 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_0
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

303 #i‡
__IPHONE_OS_VERSION_MAX_ALLOWED
 < 
__IPHONE_4_1


304 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

305 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_1


306 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

308 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

310 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL__IPHONE_4_1


	)

311 #i‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_1


312 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

313 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

314 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

315 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

316 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

317 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

318 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

319 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

320 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_2


321 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

322 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

323 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

324 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

325 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

326 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

327 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

328 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

329 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_0


330 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

331 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

332 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

333 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

334 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

335 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

336 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

337 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

338 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_1


339 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

340 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

341 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

342 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

343 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

344 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

345 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

346 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

347 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_2


348 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

349 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

350 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

351 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

352 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

353 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

354 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

355 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

356 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_0


357 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

358 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

359 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

360 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

361 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

362 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

363 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

364 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

365 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_1


366 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

367 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

368 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

369 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

370 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

371 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

372 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

373 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL__IPHONE_4_1


	)

375 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

376 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

377 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

378 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

379 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

380 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

381 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

382 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

385 #i‡
__IPHONE_OS_VERSION_MAX_ALLOWED
 < 
__IPHONE_4_2


386 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

387 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_2


388 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

390 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

392 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL__IPHONE_4_2


	)

393 #i‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_1


394 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

395 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

396 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

397 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

398 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

399 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

400 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

401 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

402 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

403 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_2


404 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

405 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

406 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

407 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

408 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

409 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

410 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

411 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

412 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

413 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_0


414 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

415 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

416 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

417 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

418 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

419 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

420 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

421 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

422 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

423 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_1


424 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

425 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

426 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

427 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

428 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

429 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

430 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

431 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

432 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

433 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_2


434 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

435 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

436 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

437 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

438 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

439 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

440 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

441 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

442 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

443 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_0


444 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

445 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

446 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

447 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

448 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

449 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

450 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

451 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

452 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

453 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_1


454 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

455 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

456 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

457 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

458 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

459 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

460 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

461 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_4_1


	)

462 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_4_1


	)

463 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_2


464 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

465 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

466 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

467 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

468 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

469 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

470 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

471 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

472 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL__IPHONE_4_2


	)

474 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

475 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

476 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

477 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

478 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

479 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

480 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

481 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

482 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

485 #i‡
__IPHONE_OS_VERSION_MAX_ALLOWED
 < 
__IPHONE_4_3


486 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

487 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_3


488 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

490 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

492 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL__IPHONE_4_3


	)

493 #i‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_1


494 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

495 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

496 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

497 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

498 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

499 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

500 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

501 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

502 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

503 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_1


	)

504 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_2_2


505 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

506 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

507 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

508 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

509 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

510 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

511 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

512 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

513 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

514 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_2_2


	)

515 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_0


516 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

517 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

518 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

519 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

520 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

521 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

522 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

523 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

524 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

525 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_0


	)

526 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_1


527 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

528 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

529 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

530 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

531 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

532 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

533 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

534 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

535 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

536 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_1


	)

537 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_3_2


538 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

539 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

540 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

541 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

542 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

543 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

544 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

545 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

546 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

547 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_3_2


	)

548 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_0


549 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

550 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

551 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

552 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

553 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

554 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

555 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

556 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

557 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

558 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_4_0


	)

559 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_1


560 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

561 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

562 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

563 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

564 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

565 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

566 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

567 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_4_1


	)

568 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_4_1


	)

569 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_4_1


	)

570 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_2


571 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

572 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

573 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

574 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

575 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

576 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

577 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

578 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

579 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_4_2


	)

580 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_4_2


	)

581 #ñi‡
__IPHONE_OS_VERSION_MIN_REQUIRED
 < 
__IPHONE_4_3


582 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

583 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

584 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

585 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

586 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

587 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

588 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

589 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

590 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

591 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL__IPHONE_4_3


	)

593 
	#__AVAILABILITY_INTERNAL__IPHONE_2_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

594 
	#__AVAILABILITY_INTERNAL__IPHONE_2_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

595 
	#__AVAILABILITY_INTERNAL__IPHONE_2_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

596 
	#__AVAILABILITY_INTERNAL__IPHONE_3_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

597 
	#__AVAILABILITY_INTERNAL__IPHONE_3_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

598 
	#__AVAILABILITY_INTERNAL__IPHONE_3_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

599 
	#__AVAILABILITY_INTERNAL__IPHONE_4_0_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

600 
	#__AVAILABILITY_INTERNAL__IPHONE_4_1_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

601 
	#__AVAILABILITY_INTERNAL__IPHONE_4_2_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

602 
	#__AVAILABILITY_INTERNAL__IPHONE_4_3_DEP__IPHONE_4_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

605 
	#__AVAILABILITY_INTERNAL__IPHONE_NA
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

606 
	#__AVAILABILITY_INTERNAL__IPHONE_NA_DEP__IPHONE_NA
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

608 #ñi‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
)

610 
	#__MAC_OS_X_VERSION_MIN_REQUIRED
 
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__


	)

612 #i‚de‡
__MAC_OS_X_VERSION_MAX_ALLOWED


613 
	#__MAC_OS_X_VERSION_MAX_ALLOWED
 
__MAC_10_7


	)

616 #i‡
__MAC_OS_X_VERSION_MAX_ALLOWED
 < 
__MAC_10_7


617 
	#__AVAILABILITY_INTERNAL__MAC_10_7
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

618 #ñi‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 < 
__MAC_10_7


619 
	#__AVAILABILITY_INTERNAL__MAC_10_7
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

621 
	#__AVAILABILITY_INTERNAL__MAC_10_7
 
__AVAILABILITY_INTERNAL_REGULAR


	)

623 #i‡
__MAC_OS_X_VERSION_MAX_ALLOWED
 < 
__MAC_10_6


624 
	#__AVAILABILITY_INTERNAL__MAC_10_6
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

625 #ñi‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 < 
__MAC_10_6


626 
	#__AVAILABILITY_INTERNAL__MAC_10_6
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

628 
	#__AVAILABILITY_INTERNAL__MAC_10_6
 
__AVAILABILITY_INTERNAL_REGULAR


	)

630 #i‡
__MAC_OS_X_VERSION_MAX_ALLOWED
 < 
__MAC_10_5


631 
	#__AVAILABILITY_INTERNAL__MAC_10_5
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

632 #ñi‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 < 
__MAC_10_5


633 
	#__AVAILABILITY_INTERNAL__MAC_10_5
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

635 
	#__AVAILABILITY_INTERNAL__MAC_10_5
 
__AVAILABILITY_INTERNAL_REGULAR


	)

637 #i‡
__MAC_OS_X_VERSION_MAX_ALLOWED
 < 
__MAC_10_4


638 
	#__AVAILABILITY_INTERNAL__MAC_10_4
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

639 #ñi‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 < 
__MAC_10_4


640 
	#__AVAILABILITY_INTERNAL__MAC_10_4
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

642 
	#__AVAILABILITY_INTERNAL__MAC_10_4
 
__AVAILABILITY_INTERNAL_REGULAR


	)

644 #i‡
__MAC_OS_X_VERSION_MAX_ALLOWED
 < 
__MAC_10_3


645 
	#__AVAILABILITY_INTERNAL__MAC_10_3
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

646 #ñi‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 < 
__MAC_10_3


647 
	#__AVAILABILITY_INTERNAL__MAC_10_3
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

649 
	#__AVAILABILITY_INTERNAL__MAC_10_3
 
__AVAILABILITY_INTERNAL_REGULAR


	)

651 #i‡
__MAC_OS_X_VERSION_MAX_ALLOWED
 < 
__MAC_10_2


652 
	#__AVAILABILITY_INTERNAL__MAC_10_2
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

653 #ñi‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 < 
__MAC_10_2


654 
	#__AVAILABILITY_INTERNAL__MAC_10_2
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

656 
	#__AVAILABILITY_INTERNAL__MAC_10_2
 
__AVAILABILITY_INTERNAL_REGULAR


	)

658 #i‡
__MAC_OS_X_VERSION_MAX_ALLOWED
 < 
__MAC_10_1


659 
	#__AVAILABILITY_INTERNAL__MAC_10_1
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

660 #ñi‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 < 
__MAC_10_1


661 
	#__AVAILABILITY_INTERNAL__MAC_10_1
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

663 
	#__AVAILABILITY_INTERNAL__MAC_10_1
 
__AVAILABILITY_INTERNAL_REGULAR


	)

665 #i‡
__MAC_OS_X_VERSION_MAX_ALLOWED
 < 
__MAC_10_0


666 
	#__AVAILABILITY_INTERNAL__MAC_10_0
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

667 #ñi‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 < 
__MAC_10_0


668 
	#__AVAILABILITY_INTERNAL__MAC_10_0
 
__AVAILABILITY_INTERNAL_WEAK_IMPORT


	)

670 
	#__AVAILABILITY_INTERNAL__MAC_10_0
 
__AVAILABILITY_INTERNAL_REGULAR


	)

672 
	#__AVAILABILITY_INTERNAL__MAC_NA
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

673 #i‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 >
__MAC_10_1


674 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_1
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

676 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_1
 
__AVAILABILITY_INTERNAL__MAC_10_0


	)

678 #i‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 >
__MAC_10_2


679 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

680 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_2
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

682 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_2
 
__AVAILABILITY_INTERNAL__MAC_10_0


	)

683 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_2
 
__AVAILABILITY_INTERNAL__MAC_10_1


	)

685 #i‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 >
__MAC_10_3


686 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

687 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

688 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_10_3
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

690 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_3
 
__AVAILABILITY_INTERNAL__MAC_10_0


	)

691 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_3
 
__AVAILABILITY_INTERNAL__MAC_10_1


	)

692 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_10_3
 
__AVAILABILITY_INTERNAL__MAC_10_2


	)

694 #i‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 >
__MAC_10_4


695 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_4
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

696 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_4
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

697 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_10_4
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

698 
	#__AVAILABILITY_INTERNAL__MAC_10_3_DEP__MAC_10_4
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

700 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_4
 
__AVAILABILITY_INTERNAL__MAC_10_0


	)

701 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_4
 
__AVAILABILITY_INTERNAL__MAC_10_1


	)

702 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_10_4
 
__AVAILABILITY_INTERNAL__MAC_10_2


	)

703 
	#__AVAILABILITY_INTERNAL__MAC_10_3_DEP__MAC_10_4
 
__AVAILABILITY_INTERNAL__MAC_10_3


	)

705 #i‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 >
__MAC_10_5


706 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_5
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

707 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_5
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

708 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_10_5
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

709 
	#__AVAILABILITY_INTERNAL__MAC_10_3_DEP__MAC_10_5
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

710 
	#__AVAILABILITY_INTERNAL__MAC_10_4_DEP__MAC_10_5
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

712 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_5
 
__AVAILABILITY_INTERNAL__MAC_10_0


	)

713 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_5
 
__AVAILABILITY_INTERNAL__MAC_10_1


	)

714 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_10_5
 
__AVAILABILITY_INTERNAL__MAC_10_2


	)

715 
	#__AVAILABILITY_INTERNAL__MAC_10_3_DEP__MAC_10_5
 
__AVAILABILITY_INTERNAL__MAC_10_3


	)

716 
	#__AVAILABILITY_INTERNAL__MAC_10_4_DEP__MAC_10_5
 
__AVAILABILITY_INTERNAL__MAC_10_4


	)

718 #i‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 >
__MAC_10_6


719 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

720 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

721 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

722 
	#__AVAILABILITY_INTERNAL__MAC_10_3_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

723 
	#__AVAILABILITY_INTERNAL__MAC_10_4_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

724 
	#__AVAILABILITY_INTERNAL__MAC_10_5_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

726 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL__MAC_10_0


	)

727 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL__MAC_10_1


	)

728 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL__MAC_10_2


	)

729 
	#__AVAILABILITY_INTERNAL__MAC_10_3_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL__MAC_10_3


	)

730 
	#__AVAILABILITY_INTERNAL__MAC_10_4_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL__MAC_10_4


	)

731 
	#__AVAILABILITY_INTERNAL__MAC_10_5_DEP__MAC_10_6
 
__AVAILABILITY_INTERNAL__MAC_10_5


	)

733 #i‡
__MAC_OS_X_VERSION_MIN_REQUIRED
 >
__MAC_10_7


734 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

735 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

736 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

737 
	#__AVAILABILITY_INTERNAL__MAC_10_3_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

738 
	#__AVAILABILITY_INTERNAL__MAC_10_4_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

739 
	#__AVAILABILITY_INTERNAL__MAC_10_5_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

740 
	#__AVAILABILITY_INTERNAL__MAC_10_6_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL_DEPRECATED


	)

742 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL__MAC_10_0


	)

743 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL__MAC_10_1


	)

744 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL__MAC_10_2


	)

745 
	#__AVAILABILITY_INTERNAL__MAC_10_3_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL__MAC_10_3


	)

746 
	#__AVAILABILITY_INTERNAL__MAC_10_4_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL__MAC_10_4


	)

747 
	#__AVAILABILITY_INTERNAL__MAC_10_5_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL__MAC_10_5


	)

748 
	#__AVAILABILITY_INTERNAL__MAC_10_6_DEP__MAC_10_7
 
__AVAILABILITY_INTERNAL__MAC_10_6


	)

750 
	#__AVAILABILITY_INTERNAL__MAC_10_0_DEP__MAC_NA
 
__AVAILABILITY_INTERNAL__MAC_10_0


	)

751 
	#__AVAILABILITY_INTERNAL__MAC_10_1_DEP__MAC_NA
 
__AVAILABILITY_INTERNAL__MAC_10_1


	)

752 
	#__AVAILABILITY_INTERNAL__MAC_10_2_DEP__MAC_NA
 
__AVAILABILITY_INTERNAL__MAC_10_2


	)

753 
	#__AVAILABILITY_INTERNAL__MAC_10_3_DEP__MAC_NA
 
__AVAILABILITY_INTERNAL__MAC_10_3


	)

754 
	#__AVAILABILITY_INTERNAL__MAC_10_4_DEP__MAC_NA
 
__AVAILABILITY_INTERNAL__MAC_10_4


	)

755 
	#__AVAILABILITY_INTERNAL__MAC_10_5_DEP__MAC_NA
 
__AVAILABILITY_INTERNAL__MAC_10_5


	)

756 
	#__AVAILABILITY_INTERNAL__MAC_10_6_DEP__MAC_NA
 
__AVAILABILITY_INTERNAL__MAC_10_6


	)

757 
	#__AVAILABILITY_INTERNAL__MAC_10_7_DEP__MAC_NA
 
__AVAILABILITY_INTERNAL__MAC_10_7


	)

758 
	#__AVAILABILITY_INTERNAL__MAC_NA_DEP__MAC_NA
 
__AVAILABILITY_INTERNAL_UNAVAILABLE


	)

	@/usr/include/AvailabilityMacros.h

85 #i‚de‡
__AVAILABILITYMACROS__


86 
	#__AVAILABILITYMACROS__


	)

92 
	#MAC_OS_X_VERSION_10_0
 1000

	)

93 
	#MAC_OS_X_VERSION_10_1
 1010

	)

94 
	#MAC_OS_X_VERSION_10_2
 1020

	)

95 
	#MAC_OS_X_VERSION_10_3
 1030

	)

96 
	#MAC_OS_X_VERSION_10_4
 1040

	)

97 
	#MAC_OS_X_VERSION_10_5
 1050

	)

98 
	#MAC_OS_X_VERSION_10_6
 1060

	)

99 
	#MAC_OS_X_VERSION_10_7
 1070

	)

106 #i‚de‡
MAC_OS_X_VERSION_MIN_REQUIRED


107 #ifde‡
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__


108 #i‡(
__i386__
 || 
__x86_64__
Ë&& (
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
 < 
MAC_OS_X_VERSION_10_4
)

109 #w¨nög 
Buûdög
 
I¡ñ
 
wôh
 
Mac
 
OS
 
X
 
Dïloymít
 
T¨gë
 < 10.4 
is
 
övÆid
.

110 #ñi‡
__µc64__
 && (
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
 < 
MAC_OS_X_VERSION_10_4
)

111 #w¨nög 
Buûdög
 
µc64
 
wôh
 
Mac
 
OS
 
X
 
Dïloymít
 
T¨gë
 < 10.4 
is
 
övÆid
.

113 
	#MAC_OS_X_VERSION_MIN_REQUIRED
 
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__


	)

115 #i‡
__µc64__
 || 
__i386__
 || 
__x86_64__


116 
	#MAC_OS_X_VERSION_MIN_REQUIRED
 
MAC_OS_X_VERSION_10_4


	)

117 #ñi‡
__¨m__


118 
	#MAC_OS_X_VERSION_MIN_REQUIRED
 
MAC_OS_X_VERSION_10_5


	)

120 
	#MAC_OS_X_VERSION_MIN_REQUIRED
 
MAC_OS_X_VERSION_10_1


	)

128 #i‚de‡
MAC_OS_X_VERSION_MAX_ALLOWED


129 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 > 
MAC_OS_X_VERSION_10_7


130 
	#MAC_OS_X_VERSION_MAX_ALLOWED
 
MAC_OS_X_VERSION_MIN_REQUIRED


	)

132 
	#MAC_OS_X_VERSION_MAX_ALLOWED
 
MAC_OS_X_VERSION_10_7


	)

139 #i‡
MAC_OS_X_VERSION_MAX_ALLOWED
 < 
MAC_OS_X_VERSION_MIN_REQUIRED


140 #îr‹ 
MAC_OS_X_VERSION_MAX_ALLOWED
 
mu°
 
be
 >
MAC_OS_X_VERSION_MIN_REQUIRED


142 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 < 
MAC_OS_X_VERSION_10_0


143 #îr‹ 
MAC_OS_X_VERSION_MIN_REQUIRED
 
mu°
 
be
 >
MAC_OS_X_VERSION_10_0


149 #i‡
deföed
(
__GNUC__
Ë&& ((__GNUC__ >4Ë|| ((__GNUC__ =3Ë&& (
__GNUC_MINOR__
 >1))Ë&& (
MAC_OS_X_VERSION_MIN_REQUIRED
 >= 1020)

150 
	#WEAK_IMPORT_ATTRIBUTE
 
	`__©åibuã__
((
wók_imp‹t
))

	)

151 #ñi‡
deföed
(
__MWERKS__
Ë&& (__MWERKS__ >0x3205Ë&& (
MAC_OS_X_VERSION_MIN_REQUIRED
 >1020Ë&& !deföed(
__INTEL__
)

152 
	#WEAK_IMPORT_ATTRIBUTE
 
	`__©åibuã__
((
wók_imp‹t
))

	)

154 
	#WEAK_IMPORT_ATTRIBUTE


	)

160 #i‡
deföed
(
__GNUC__
Ë&& ((__GNUC__ >4Ë|| ((__GNUC__ =3Ë&& (
__GNUC_MINOR__
 >= 1)))

161 
	#DEPRECATED_ATTRIBUTE
 
	`__©åibuã__
((
dïªˇãd
))

	)

163 
	#DEPRECATED_ATTRIBUTE


	)

169 #i‡
deföed
(
__GNUC__
Ë&& ((__GNUC__ >4Ë|| ((__GNUC__ =3Ë&& (
__GNUC_MINOR__
 >= 1)))

170 
	#UNAVAILABLE_ATTRIBUTE
 
	`__©åibuã__
((
u«vaûabÀ
))

	)

172 
	#UNAVAILABLE_ATTRIBUTE


	)

182 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER


	)

190 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED
 
DEPRECATED_ATTRIBUTE


	)

197 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_0_AND_LATER
 
DEPRECATED_ATTRIBUTE


	)

209 #i‡
MAC_OS_X_VERSION_MAX_ALLOWED
 < 
MAC_OS_X_VERSION_10_1


210 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER
 
UNAVAILABLE_ATTRIBUTE


	)

211 #ñi‡
MAC_OS_X_VERSION_MIN_REQUIRED
 < 
MAC_OS_X_VERSION_10_1


212 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER
 
WEAK_IMPORT_ATTRIBUTE


	)

214 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER


	)

223 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_1


224 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED
 
DEPRECATED_ATTRIBUTE


	)

226 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED
 
AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER


	)

235 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_1


236 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_1
 
DEPRECATED_ATTRIBUTE


	)

238 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_1
 
AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER


	)

246 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_1


247 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_1_AND_LATER
 
DEPRECATED_ATTRIBUTE


	)

249 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_1_AND_LATER


	)

263 #i‡
MAC_OS_X_VERSION_MAX_ALLOWED
 < 
MAC_OS_X_VERSION_10_2


264 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER
 
UNAVAILABLE_ATTRIBUTE


	)

265 #ñi‡
MAC_OS_X_VERSION_MIN_REQUIRED
 < 
MAC_OS_X_VERSION_10_2


266 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER
 
WEAK_IMPORT_ATTRIBUTE


	)

268 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER


	)

277 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_2


278 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED
 
DEPRECATED_ATTRIBUTE


	)

280 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED
 
AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER


	)

289 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_2


290 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_2
 
DEPRECATED_ATTRIBUTE


	)

292 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_2
 
AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER


	)

301 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_2


302 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_2
 
DEPRECATED_ATTRIBUTE


	)

304 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_2
 
AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER


	)

312 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_2


313 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_2_AND_LATER
 
DEPRECATED_ATTRIBUTE


	)

315 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_2_AND_LATER


	)

327 #i‡
MAC_OS_X_VERSION_MAX_ALLOWED
 < 
MAC_OS_X_VERSION_10_3


328 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER
 
UNAVAILABLE_ATTRIBUTE


	)

329 #ñi‡
MAC_OS_X_VERSION_MIN_REQUIRED
 < 
MAC_OS_X_VERSION_10_3


330 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER
 
WEAK_IMPORT_ATTRIBUTE


	)

332 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER


	)

341 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_3


342 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER_BUT_DEPRECATED
 
DEPRECATED_ATTRIBUTE


	)

344 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER_BUT_DEPRECATED
 
AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER


	)

353 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_3


354 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_3
 
DEPRECATED_ATTRIBUTE


	)

356 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_3
 
AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER


	)

365 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_3


366 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_3
 
DEPRECATED_ATTRIBUTE


	)

368 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_3
 
AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER


	)

377 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_3


378 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_3
 
DEPRECATED_ATTRIBUTE


	)

380 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_3
 
AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER


	)

388 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_3


389 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_3_AND_LATER
 
DEPRECATED_ATTRIBUTE


	)

391 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_3_AND_LATER


	)

404 #i‡
MAC_OS_X_VERSION_MAX_ALLOWED
 < 
MAC_OS_X_VERSION_10_4


405 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER
 
UNAVAILABLE_ATTRIBUTE


	)

406 #ñi‡
MAC_OS_X_VERSION_MIN_REQUIRED
 < 
MAC_OS_X_VERSION_10_4


407 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER
 
WEAK_IMPORT_ATTRIBUTE


	)

409 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER


	)

418 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_4


419 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER_BUT_DEPRECATED
 
DEPRECATED_ATTRIBUTE


	)

421 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER_BUT_DEPRECATED
 
AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER


	)

430 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_4


431 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_4
 
DEPRECATED_ATTRIBUTE


	)

433 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_4
 
AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER


	)

442 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_4


443 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_4
 
DEPRECATED_ATTRIBUTE


	)

445 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_4
 
AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER


	)

454 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_4


455 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_4
 
DEPRECATED_ATTRIBUTE


	)

457 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_4
 
AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER


	)

466 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_4


467 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_4
 
DEPRECATED_ATTRIBUTE


	)

469 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_4
 
AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER


	)

477 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_4


478 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_4_AND_LATER
 
DEPRECATED_ATTRIBUTE


	)

480 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_4_AND_LATER


	)

492 #i‡
MAC_OS_X_VERSION_MAX_ALLOWED
 < 
MAC_OS_X_VERSION_10_5


493 
	#AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER
 
UNAVAILABLE_ATTRIBUTE


	)

494 #ñi‡
MAC_OS_X_VERSION_MIN_REQUIRED
 < 
MAC_OS_X_VERSION_10_5


495 
	#AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER
 
WEAK_IMPORT_ATTRIBUTE


	)

497 
	#AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER


	)

506 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_5


507 
	#AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER_BUT_DEPRECATED
 
DEPRECATED_ATTRIBUTE


	)

509 
	#AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER_BUT_DEPRECATED
 
AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER


	)

518 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_5


519 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5
 
DEPRECATED_ATTRIBUTE


	)

521 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5
 
AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER


	)

530 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_5


531 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5
 
DEPRECATED_ATTRIBUTE


	)

533 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5
 
AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER


	)

542 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_5


543 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5
 
DEPRECATED_ATTRIBUTE


	)

545 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5
 
AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER


	)

554 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_5


555 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5
 
DEPRECATED_ATTRIBUTE


	)

557 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5
 
AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER


	)

566 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_5


567 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5
 
DEPRECATED_ATTRIBUTE


	)

569 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_5
 
AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER


	)

577 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_5


578 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_5_AND_LATER
 
DEPRECATED_ATTRIBUTE


	)

580 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_5_AND_LATER


	)

593 #i‡
MAC_OS_X_VERSION_MAX_ALLOWED
 < 
MAC_OS_X_VERSION_10_6


594 
	#AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER
 
UNAVAILABLE_ATTRIBUTE


	)

595 #ñi‡
MAC_OS_X_VERSION_MIN_REQUIRED
 < 
MAC_OS_X_VERSION_10_6


596 
	#AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER
 
WEAK_IMPORT_ATTRIBUTE


	)

598 
	#AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER


	)

607 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_6


608 
	#AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER_BUT_DEPRECATED
 
DEPRECATED_ATTRIBUTE


	)

610 
	#AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER_BUT_DEPRECATED
 
AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER


	)

619 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_6


620 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
DEPRECATED_ATTRIBUTE


	)

622 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER


	)

631 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_6


632 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
DEPRECATED_ATTRIBUTE


	)

634 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER


	)

643 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_6


644 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
DEPRECATED_ATTRIBUTE


	)

646 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER


	)

655 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_6


656 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
DEPRECATED_ATTRIBUTE


	)

658 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER


	)

667 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_6


668 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
DEPRECATED_ATTRIBUTE


	)

670 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER


	)

679 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_6


680 
	#AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
DEPRECATED_ATTRIBUTE


	)

682 
	#AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_6
 
AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER


	)

690 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_6


691 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_6_AND_LATER
 
DEPRECATED_ATTRIBUTE


	)

693 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_6_AND_LATER


	)

705 #i‡
MAC_OS_X_VERSION_MAX_ALLOWED
 < 
MAC_OS_X_VERSION_10_7


706 
	#AVAILABLE_MAC_OS_X_VERSION_10_7_AND_LATER
 
UNAVAILABLE_ATTRIBUTE


	)

707 #ñi‡
MAC_OS_X_VERSION_MIN_REQUIRED
 < 
MAC_OS_X_VERSION_10_7


708 
	#AVAILABLE_MAC_OS_X_VERSION_10_7_AND_LATER
 
WEAK_IMPORT_ATTRIBUTE


	)

710 
	#AVAILABLE_MAC_OS_X_VERSION_10_7_AND_LATER


	)

719 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_7


720 
	#AVAILABLE_MAC_OS_X_VERSION_10_7_AND_LATER_BUT_DEPRECATED
 
DEPRECATED_ATTRIBUTE


	)

722 
	#AVAILABLE_MAC_OS_X_VERSION_10_7_AND_LATER_BUT_DEPRECATED
 
AVAILABLE_MAC_OS_X_VERSION_10_7_AND_LATER


	)

731 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_7


732 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
DEPRECATED_ATTRIBUTE


	)

734 
	#AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
AVAILABLE_MAC_OS_X_VERSION_10_0_AND_LATER


	)

743 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_7


744 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
DEPRECATED_ATTRIBUTE


	)

746 
	#AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
AVAILABLE_MAC_OS_X_VERSION_10_1_AND_LATER


	)

755 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_7


756 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
DEPRECATED_ATTRIBUTE


	)

758 
	#AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
AVAILABLE_MAC_OS_X_VERSION_10_2_AND_LATER


	)

767 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_7


768 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
DEPRECATED_ATTRIBUTE


	)

770 
	#AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
AVAILABLE_MAC_OS_X_VERSION_10_3_AND_LATER


	)

779 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_7


780 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
DEPRECATED_ATTRIBUTE


	)

782 
	#AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
AVAILABLE_MAC_OS_X_VERSION_10_4_AND_LATER


	)

791 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_7


792 
	#AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
DEPRECATED_ATTRIBUTE


	)

794 
	#AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
AVAILABLE_MAC_OS_X_VERSION_10_5_AND_LATER


	)

803 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_7


804 
	#AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
DEPRECATED_ATTRIBUTE


	)

806 
	#AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER_BUT_DEPRECATED_IN_MAC_OS_X_VERSION_10_7
 
AVAILABLE_MAC_OS_X_VERSION_10_6_AND_LATER


	)

814 #i‡
MAC_OS_X_VERSION_MIN_REQUIRED
 >
MAC_OS_X_VERSION_10_7


815 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_7_AND_LATER
 
DEPRECATED_ATTRIBUTE


	)

817 
	#DEPRECATED_IN_MAC_OS_X_VERSION_10_7_AND_LATER


	)

	@/usr/include/i386/_limits.h

22 #i‚def 
_I386__LIMITS_H_


23 
	#_I386__LIMITS_H_


	)

25 
	#__DARWIN_CLK_TCK
 100

	)

	@/usr/include/i386/endian.h

66 #i‚de‡
_I386__ENDIAN_H_


67 
	#_I386__ENDIAN_H_


	)

69 
	~<sys/cdefs.h
>

78 
	#_QUAD_HIGHWORD
 1

	)

79 
	#_QUAD_LOWWORD
 0

	)

85 
	#__DARWIN_LITTLE_ENDIAN
 1234

	)

86 
	#__DARWIN_BIG_ENDIAN
 4321

	)

87 
	#__DARWIN_PDP_ENDIAN
 3412

	)

89 
	#__DARWIN_BYTE_ORDER
 
__DARWIN_LITTLE_ENDIAN


	)

91 #if 
deföed
(
KERNEL
Ë|| (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

93 
	#LITTLE_ENDIAN
 
__DARWIN_LITTLE_ENDIAN


	)

94 
	#BIG_ENDIAN
 
__DARWIN_BIG_ENDIAN


	)

95 
	#PDP_ENDIAN
 
__DARWIN_PDP_ENDIAN


	)

97 
	#BYTE_ORDER
 
__DARWIN_BYTE_ORDER


	)

99 
	~<sys/_ídün.h
>

	@/usr/include/i386/types.h

66 #i‚def 
_MACHTYPES_H_


67 
	#_MACHTYPES_H_


	)

69 #i‚de‡
__ASSEMBLER__


70 
	~<i386/_ty≥s.h
>

71 
	~<sys/cdefs.h
>

76 #i‚de‡
_INT8_T


77 
	#_INT8_T


	)

78 
__sig√d
 
	töt8_t
;

80 
	tu_öt8_t
;

81 #i‚de‡
_INT16_T


82 
	#_INT16_T


	)

83 
	töt16_t
;

85 
	tu_öt16_t
;

86 #i‚de‡
_INT32_T


87 
	#_INT32_T


	)

88 
	töt32_t
;

90 
	tu_öt32_t
;

91 #i‚de‡
_INT64_T


92 
	#_INT64_T


	)

93 
	töt64_t
;

95 
	tu_öt64_t
;

97 #i‡
__LP64__


98 
öt64_t
 
	tªgi°î_t
;

100 
öt32_t
 
	tªgi°î_t
;

103 #i‚de‡
_INTPTR_T


104 
	#_INTPTR_T


	)

105 
__d¨wö_öçå_t
 
	töçå_t
;

107 #i‚de‡
_UINTPTR_T


108 
	#_UINTPTR_T


	)

109 
	tuöçå_t
;

112 #i‡!
deföed
(
_ANSI_SOURCE
Ë&& (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

114 
u_öt64_t
 
	tu£r_addr_t
;

115 
u_öt64_t
 
	tu£r_size_t
;

116 
öt64_t
 
	tu£r_ssize_t
;

117 
öt64_t
 
	tu£r_l⁄g_t
;

118 
u_öt64_t
 
	tu£r_ul⁄g_t
;

119 
öt64_t
 
	tu£r_time_t
;

120 
öt64_t
 
	tu£r_off_t
;

121 
	#USER_ADDR_NULL
 ((
u£r_addr_t
Ë0)

	)

122 
	#CAST_USER_ADDR_T
(
a_±r
Ë((
u£r_addr_t
)((
uöçå_t
)◊_±r)))

	)

128 
u_öt64_t
 
	tsysˇŒ_¨g_t
;

130 #i‚de‡
__off£tof


131 
	#__off£tof
(
ty≥
, 
fõld
Ë((
size_t
)(&(—y≥ *)0)->fõld))

	)

	@/usr/include/machine/_structs.h

28 #i‡
deföed
 (
__i386__
Ë|| deföed (
__x86_64__
)

29 
	~"i386/_°ru˘s.h
"

30 #ñi‡
deföed
 (
__¨m__
)

31 
	~"¨m/_°ru˘s.h
"

33 #îr‹ 
¨chôe˘uª
 
nŸ
 
suµ‹ãd


	@/usr/include/machine/_types.h

28 #i‚de‡
_BSD_MACHINE__TYPES_H_


29 
	#_BSD_MACHINE__TYPES_H_


	)

31 #i‡
deföed
 (
__i386__
Ë|| deföed(
__x86_64__
)

32 
	~"i386/_ty≥s.h
"

33 #ñi‡
deföed
 (
__¨m__
)

34 
	~"¨m/_ty≥s.h
"

36 #îr‹ 
¨chôe˘uª
 
nŸ
 
suµ‹ãd


	@/usr/include/machine/signal.h

28 #i‚de‡
_BSD_MACHINE_SIGNAL_H_


29 
	#_BSD_MACHINE_SIGNAL_H_


	)

31 #i‡
deföed
 (
__i386__
Ë|| deföed(
__x86_64__
)

32 
	~"i386/sig«l.h
"

33 #ñi‡
deföed
 (
__¨m__
)

34 
	~"¨m/sig«l.h
"

36 #îr‹ 
¨chôe˘uª
 
nŸ
 
suµ‹ãd


	@/usr/include/secure/_common.h

24 #i‚de‡
_SECURE__COMMON_H_


25 
	#_SECURE__COMMON_H_


	)

27 #unde‡
_USE_FORTIFY_LEVEL


28 #i‡
deföed
(
_FORTIFY_SOURCE
) && _FORTIFY_SOURCE > 0

29 #i‡
_FORTIFY_SOURCE
 > 1

30 
	#_USE_FORTIFY_LEVEL
 2

	)

32 
	#_USE_FORTIFY_LEVEL
 1

	)

35 
	#_USE_FORTIFY_LEVEL
 0

	)

38 
	#__d¨wö_obsz0
(
obje˘
Ë
	`__buûtö_obje˘_size
 (obje˘, 0)

	)

39 
	#__d¨wö_obsz
(
obje˘
Ë
	`__buûtö_obje˘_size
 (obje˘, 
_USE_FORTIFY_LEVEL
 > 1)

	)

	@/usr/include/sys/_posix_availability.h

28 #i‚de‡
_CDEFS_H_


32 #i‡!
deföed
(
_DARWIN_C_SOURCE
Ë&& deföed(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE >= 198808L

33 
	#___POSIX_C_DEPRECATED_STARTING_198808L
 
__dïªˇãd


	)

35 
	#___POSIX_C_DEPRECATED_STARTING_198808L


	)

38 #i‡!
deföed
(
_DARWIN_C_SOURCE
Ë&& deföed(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE >= 199009L

39 
	#___POSIX_C_DEPRECATED_STARTING_199009L
 
__dïªˇãd


	)

41 
	#___POSIX_C_DEPRECATED_STARTING_199009L


	)

44 #i‡!
deföed
(
_DARWIN_C_SOURCE
Ë&& deföed(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE >= 199209L

45 
	#___POSIX_C_DEPRECATED_STARTING_199209L
 
__dïªˇãd


	)

47 
	#___POSIX_C_DEPRECATED_STARTING_199209L


	)

50 #i‡!
deföed
(
_DARWIN_C_SOURCE
Ë&& deföed(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE >= 199309L

51 
	#___POSIX_C_DEPRECATED_STARTING_199309L
 
__dïªˇãd


	)

53 
	#___POSIX_C_DEPRECATED_STARTING_199309L


	)

56 #i‡!
deföed
(
_DARWIN_C_SOURCE
Ë&& deföed(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE >= 199506L

57 
	#___POSIX_C_DEPRECATED_STARTING_199506L
 
__dïªˇãd


	)

59 
	#___POSIX_C_DEPRECATED_STARTING_199506L


	)

62 #i‡!
deföed
(
_DARWIN_C_SOURCE
Ë&& deföed(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE >= 200112L

63 
	#___POSIX_C_DEPRECATED_STARTING_200112L
 
__dïªˇãd


	)

65 
	#___POSIX_C_DEPRECATED_STARTING_200112L


	)

68 #i‡!
deföed
(
_DARWIN_C_SOURCE
Ë&& deföed(
_POSIX_C_SOURCE
) && _POSIX_C_SOURCE >= 200809L

69 
	#___POSIX_C_DEPRECATED_STARTING_200809L
 
__dïªˇãd


	)

71 
	#___POSIX_C_DEPRECATED_STARTING_200809L


	)

	@/usr/include/sys/_symbol_aliasing.h

28 #i‚de‡
_CDEFS_H_


32 #i‡
deföed
(
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 20000

33 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_2_0
(
x
Ë
	)
x

35 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_2_0
(
x
)

	)

38 #i‡
deföed
(
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 20100

39 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_2_1
(
x
Ë
	)
x

41 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_2_1
(
x
)

	)

44 #i‡
deföed
(
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 20200

45 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_2_2
(
x
Ë
	)
x

47 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_2_2
(
x
)

	)

50 #i‡
deföed
(
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 30000

51 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_3_0
(
x
Ë
	)
x

53 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_3_0
(
x
)

	)

56 #i‡
deföed
(
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 30100

57 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_3_1
(
x
Ë
	)
x

59 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_3_1
(
x
)

	)

62 #i‡
deföed
(
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 30200

63 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_3_2
(
x
Ë
	)
x

65 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_3_2
(
x
)

	)

68 #i‡
deföed
(
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 40000

69 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_4_0
(
x
Ë
	)
x

71 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_4_0
(
x
)

	)

74 #i‡
deföed
(
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 40100

75 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_4_1
(
x
Ë
	)
x

77 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_4_1
(
x
)

	)

80 #i‡
deföed
(
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 40200

81 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_4_2
(
x
Ë
	)
x

83 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_4_2
(
x
)

	)

86 #i‡
deföed
(
__ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_IPHONE_OS_VERSION_MIN_REQUIRED__ >= 40300

87 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_4_3
(
x
Ë
	)
x

89 
	#__DARWIN_ALIAS_STARTING_IPHONE___IPHONE_4_3
(
x
)

	)

92 #i‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1000

93 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_0
(
x
Ë
	)
x

95 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_0
(
x
)

	)

98 #i‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1010

99 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_1
(
x
Ë
	)
x

101 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_1
(
x
)

	)

104 #i‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1020

105 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_2
(
x
Ë
	)
x

107 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_2
(
x
)

	)

110 #i‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1030

111 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_3
(
x
Ë
	)
x

113 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_3
(
x
)

	)

116 #i‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1040

117 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_4
(
x
Ë
	)
x

119 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_4
(
x
)

	)

122 #i‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1050

123 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_5
(
x
Ë
	)
x

125 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_5
(
x
)

	)

128 #i‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1060

129 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_6
(
x
Ë
	)
x

131 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_6
(
x
)

	)

134 #i‡
deföed
(
__ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__
) && __ENVIRONMENT_MAC_OS_X_VERSION_MIN_REQUIRED__ >= 1070

135 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_7
(
x
Ë
	)
x

137 
	#__DARWIN_ALIAS_STARTING_MAC___MAC_10_7
(
x
)

	)

	@/usr/include/sys/resource.h

64 #i‚de‡
_SYS_RESOURCE_H_


65 
	#_SYS_RESOURCE_H_


	)

67 
	~<sys/≠∂ópi›ts.h
>

68 
	~<sys/cdefs.h
>

69 
	~<sys/_ty≥s.h
>

71 
	~<Avaûabûôy.h
>

76 
	#__√ed_°ru˘_timevÆ


	)

77 
	~<sys/_°ru˘s.h
>

80 #i‚de‡
_ID_T


81 
	#_ID_T


	)

82 
__d¨wö_id_t
 
	tid_t
;

89 
__uöt64_t
 
	tæim_t
;

100 
	#PRIO_PROCESS
 0

	)

101 
	#PRIO_PGRP
 1

	)

102 
	#PRIO_USER
 2

	)

104 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

105 
	#PRIO_DARWIN_THREAD
 3

	)

106 
	#PRIO_DARWIN_PROCESS
 4

	)

111 
	#PRIO_MIN
 -20

	)

112 
	#PRIO_MAX
 20

	)

119 
	#PRIO_DARWIN_BG
 0x1000

	)

125 
	#PRIO_DARWIN_NONUI
 0x1001

	)

139 
	#RUSAGE_SELF
 0

	)

140 
	#RUSAGE_CHILDREN
 -1

	)

151 
	srußge
 {

152 
timevÆ
 
	mru_utime
;

153 
timevÆ
 
	mru_°ime
;

154 #i‡
deföed
(
_POSIX_C_SOURCE
Ë&& !deföed(
_DARWIN_C_SOURCE
)

155 
	mru_›aque
[14];

162 
	mru_maxrss
;

163 
	#ru_fú°
 
ru_ixrss


	)

164 
	mru_ixrss
;

165 
	mru_idrss
;

166 
	mru_i§ss
;

167 
	mru_möÊt
;

168 
	mru_majÊt
;

169 
	mru_nsw≠
;

170 
	mru_öblock
;

171 
	mru_oublock
;

172 
	mru_msg¢d
;

173 
	mru_msgrcv
;

174 
	mru_nsig«ls
;

175 
	mru_nvcsw
;

176 
	mru_nivcsw
;

177 
	#ru_œ°
 
ru_nivcsw


	)

193 
	#RLIM_INFINITY
 (((
__uöt64_t
)1 << 63Ë- 1Ë

	)

194 
	#RLIM_SAVED_MAX
 
RLIM_INFINITY


	)

195 
	#RLIM_SAVED_CUR
 
RLIM_INFINITY


	)

201 
	#RLIMIT_CPU
 0

	)

202 
	#RLIMIT_FSIZE
 1

	)

203 
	#RLIMIT_DATA
 2

	)

204 
	#RLIMIT_STACK
 3

	)

205 
	#RLIMIT_CORE
 4

	)

206 
	#RLIMIT_AS
 5

	)

207 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

208 
	#RLIMIT_RSS
 
RLIMIT_AS


	)

209 
	#RLIMIT_MEMLOCK
 6

	)

210 
	#RLIMIT_NPROC
 7

	)

212 
	#RLIMIT_NOFILE
 8

	)

213 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

214 
	#RLIM_NLIMITS
 9

	)

216 
	#_RLIMIT_POSIX_FLAG
 0x1000

	)

222 
	sæimô
 {

223 
æim_t
 
	mæim_cur
;

224 
æim_t
 
	mæim_max
;

227 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

229 
	#IOPOL_TYPE_DISK
 0

	)

232 
	#IOPOL_SCOPE_PROCESS
 0

	)

233 
	#IOPOL_SCOPE_THREAD
 1

	)

236 
	#IOPOL_DEFAULT
 0

	)

237 
	#IOPOL_NORMAL
 1

	)

238 
	#IOPOL_PASSIVE
 2

	)

239 
	#IOPOL_THROTTLE
 3

	)

244 
__BEGIN_DECLS


245 
gë¥i‹ôy
(, 
id_t
);

246 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

247 
	$gëi›ﬁicy_≈
(, Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_2_0
);

249 
	$gëæimô
(, 
æimô
 *Ë
	`__DARWIN_ALIAS
(
gëæimô
);

250 
	`gërußge
(, 
rußge
 *);

251 
	`£çri‹ôy
(, 
id_t
, );

252 #i‡!
	`deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

253 
	$£ti›ﬁicy_≈
(, , Ë
	`__OSX_AVAILABLE_STARTING
(
__MAC_10_5
, 
__IPHONE_2_0
);

255 
	$£ålimô
(, c⁄° 
æimô
 *Ë
	`__DARWIN_ALIAS
(
£ålimô
);

256 
__END_DECLS


	@/usr/include/i386/_structs.h

29 
	~<sys/≠∂ópi›ts.h
>

31 #ifde‡
__√ed_mc⁄ãxt_t


32 #i‚de‡
__√ed_°ru˘_mc⁄ãxt


33 
	#__√ed_°ru˘_mc⁄ãxt


	)

37 #i‡
deföed
(
__√ed_°ru˘_mc⁄ãxt
)

38 
	~<mach/i386/_°ru˘s.h
>

42 #ifde‡
__√ed_°ru˘_mc⁄ãxt


43 #unde‡
__√ed_°ru˘_mc⁄ãxt


45 #i‚de‡
_STRUCT_MCONTEXT32


46 #i‡
__DARWIN_UNIX03


47 
	#_STRUCT_MCONTEXT32
 
__d¨wö_mc⁄ãxt32


	)

48 
	g_STRUCT_MCONTEXT32


50 
_STRUCT_X86_EXCEPTION_STATE32
 
	g__es
;

51 
_STRUCT_X86_THREAD_STATE32
 
	g__ss
;

52 
_STRUCT_X86_FLOAT_STATE32
 
	g__fs
;

55 
	#_STRUCT_MCONTEXT_AVX32
 
__d¨wö_mc⁄ãxt_avx32


	)

56 
	g_STRUCT_MCONTEXT_AVX32


58 
_STRUCT_X86_EXCEPTION_STATE32
 
	g__es
;

59 
_STRUCT_X86_THREAD_STATE32
 
	g__ss
;

60 
_STRUCT_X86_AVX_STATE32
 
	g__fs
;

64 
	#_STRUCT_MCONTEXT32
 
mc⁄ãxt32


	)

65 
	g_STRUCT_MCONTEXT32


67 
_STRUCT_X86_EXCEPTION_STATE32
 
	ges
;

68 
_STRUCT_X86_THREAD_STATE32
 
	gss
;

69 
_STRUCT_X86_FLOAT_STATE32
 
	gfs
;

72 
	#_STRUCT_MCONTEXT_AVX32
 
mc⁄ãxt_avx32


	)

73 
	g_STRUCT_MCONTEXT_AVX32


75 
_STRUCT_X86_EXCEPTION_STATE32
 
	ges
;

76 
_STRUCT_X86_THREAD_STATE32
 
	gss
;

77 
_STRUCT_X86_AVX_STATE32
 
	gfs
;

83 #i‚de‡
_STRUCT_MCONTEXT64


84 #i‡
__DARWIN_UNIX03


85 
	#_STRUCT_MCONTEXT64
 
__d¨wö_mc⁄ãxt64


	)

86 
	g_STRUCT_MCONTEXT64


88 
_STRUCT_X86_EXCEPTION_STATE64
 
	g__es
;

89 
_STRUCT_X86_THREAD_STATE64
 
	g__ss
;

90 
_STRUCT_X86_FLOAT_STATE64
 
	g__fs
;

93 
	#_STRUCT_MCONTEXT_AVX64
 
__d¨wö_mc⁄ãxt_avx64


	)

94 
	g_STRUCT_MCONTEXT_AVX64


96 
_STRUCT_X86_EXCEPTION_STATE64
 
	g__es
;

97 
_STRUCT_X86_THREAD_STATE64
 
	g__ss
;

98 
_STRUCT_X86_AVX_STATE64
 
	g__fs
;

102 
	#_STRUCT_MCONTEXT64
 
mc⁄ãxt64


	)

103 
	g_STRUCT_MCONTEXT64


105 
_STRUCT_X86_EXCEPTION_STATE64
 
	ges
;

106 
_STRUCT_X86_THREAD_STATE64
 
	gss
;

107 
_STRUCT_X86_FLOAT_STATE64
 
	gfs
;

110 
	#_STRUCT_MCONTEXT_AVX64
 
mc⁄ãxt_avx64


	)

111 
	g_STRUCT_MCONTEXT_AVX64


113 
_STRUCT_X86_EXCEPTION_STATE64
 
	ges
;

114 
_STRUCT_X86_THREAD_STATE64
 
	gss
;

115 
_STRUCT_X86_AVX_STATE64
 
	gfs
;

122 #ifde‡
__√ed_mc⁄ãxt_t


123 #unde‡
__√ed_mc⁄ãxt_t


124 #i‚de‡
_MCONTEXT_T


125 
	#_MCONTEXT_T


	)

126 #i‡
deföed
(
__LP64__
)

127 
_STRUCT_MCONTEXT64
 *
	tmc⁄ãxt_t
;

128 
	#_STRUCT_MCONTEXT
 
_STRUCT_MCONTEXT64


	)

130 
_STRUCT_MCONTEXT32
 *
	tmc⁄ãxt_t
;

131 
	#_STRUCT_MCONTEXT
 
_STRUCT_MCONTEXT32


	)

136 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

137 #i‚de‡
I386_MCONTEXT_SIZE


138 
	#I386_MCONTEXT_SIZE
 (
mc⁄ãxt
)

	)

	@/usr/include/i386/_types.h

28 #i‚def 
_BSD_I386__TYPES_H_


29 
	#_BSD_I386__TYPES_H_


	)

36 #ifde‡
__GNUC__


37 
__sig√d
 
	t__öt8_t
;

39 
	t__öt8_t
;

41 
	t__uöt8_t
;

42 
	t__öt16_t
;

43 
	t__uöt16_t
;

44 
	t__öt32_t
;

45 
	t__uöt32_t
;

46 
	t__öt64_t
;

47 
	t__uöt64_t
;

49 
	t__d¨wö_öçå_t
;

50 
	t__d¨wö_«tuøl_t
;

70 
	t__d¨wö_˘_ru√_t
;

77 
	m__mb°©e8
[128];

78 
	m_mb°©eL
;

79 } 
	t__mb°©e_t
;

81 
__mb°©e_t
 
	t__d¨wö_mb°©e_t
;

83 #i‡
deföed
(
__GNUC__
Ë&& deföed(
__PTRDIFF_TYPE__
)

84 
__PTRDIFF_TYPE__
 
	t__d¨wö_±rdiff_t
;

86 
	t__d¨wö_±rdiff_t
;

89 #i‡
deföed
(
__GNUC__
Ë&& deföed(
__SIZE_TYPE__
)

90 
__SIZE_TYPE__
 
	t__d¨wö_size_t
;

92 
	t__d¨wö_size_t
;

95 #i‡(
__GNUC__
 > 2)

96 
__buûtö_va_li°
 
	t__d¨wö_va_li°
;

98 * 
	t__d¨wö_va_li°
;

101 #i‡
deföed
(
__GNUC__
Ë&& deföed(
__WCHAR_TYPE__
)

102 
__WCHAR_TYPE__
 
	t__d¨wö_wch¨_t
;

104 
__d¨wö_˘_ru√_t
 
	t__d¨wö_wch¨_t
;

107 
__d¨wö_wch¨_t
 
	t__d¨wö_ru√_t
;

109 #i‡
deföed
(
__GNUC__
Ë&& deföed(
__WINT_TYPE__
)

110 
__WINT_TYPE__
 
	t__d¨wö_wöt_t
;

112 
__d¨wö_˘_ru√_t
 
	t__d¨wö_wöt_t
;

115 
	t__d¨wö_˛ock_t
;

116 
__uöt32_t
 
	t__d¨wö_sockÀn_t
;

117 
	t__d¨wö_ssize_t
;

118 
	t__d¨wö_time_t
;

	@/usr/include/i386/signal.h

33 #i‚def 
_I386_SIGNAL_H_


34 
	#_I386_SIGNAL_H_
 1

	)

36 
	~<sys/cdefs.h
>

38 #i‚de‡
_ANSI_SOURCE


39 
	tsig_©omic_t
;

41 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

43 
	~<sys/≠∂ópi›ts.h
>

45 #ifde‡
__APPLE_API_OBSOLETE


54 
	#__√ed_°ru˘_sigc⁄ãxt


	)

55 
	~<i386/_°ru˘s.h
>

	@/usr/include/sys/_endian.h

90 #i‚de‡
_SYS__ENDIAN_H_


91 
	#_SYS__ENDIAN_H_


	)

93 
	~<sys/cdefs.h
>

99 #i‡
deföed
(
löt
)

101 
__BEGIN_DECLS


102 
__uöt16_t
 
¡ohs
(__uint16_t);

103 
__uöt16_t
 
ht⁄s
(__uint16_t);

104 
__uöt32_t
 
¡ohl
(__uint32_t);

105 
__uöt32_t
 
ht⁄l
(__uint32_t);

106 
	g__END_DECLS


108 #ñi‡
__DARWIN_BYTE_ORDER
 =
__DARWIN_BIG_ENDIAN


110 
	#¡ohl
(
x
Ë((
__uöt32_t
)(x))

	)

111 
	#¡ohs
(
x
Ë((
__uöt16_t
)(x))

	)

112 
	#ht⁄l
(
x
Ë((
__uöt32_t
)(x))

	)

113 
	#ht⁄s
(
x
Ë((
__uöt16_t
)(x))

	)

115 #i‡ 
deföed
(
KERNEL
Ë|| (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

116 
	#NTOHL
(
x
Ë(x)

	)

117 
	#NTOHS
(
x
Ë(x)

	)

118 
	#HTONL
(
x
Ë(x)

	)

119 
	#HTONS
(
x
Ë(x)

	)

124 
	~<libkîn/_OSByãOrdî.h
>

126 
	#¡ohs
(
x
Ë
	`__DARWIN_OSSw≠I¡16
(x)

	)

127 
	#ht⁄s
(
x
Ë
	`__DARWIN_OSSw≠I¡16
(x)

	)

129 
	#¡ohl
(
x
Ë
	`__DARWIN_OSSw≠I¡32
(x)

	)

130 
	#ht⁄l
(
x
Ë
	`__DARWIN_OSSw≠I¡32
(x)

	)

132 #if 
deföed
(
KERNEL
Ë|| (!deföed(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
))

133 
	#NTOHL
(
x
Ë(xË
	`¡ohl
((
__uöt32_t
)x)

	)

134 
	#NTOHS
(
x
Ë(xË
	`¡ohs
((
__uöt16_t
)x)

	)

135 
	#HTONL
(
x
Ë(xË
	`ht⁄l
((
__uöt32_t
)x)

	)

136 
	#HTONS
(
x
Ë(xË
	`ht⁄s
((
__uöt16_t
)x)

	)

	@/usr/include/libkern/_OSByteOrder.h

29 #i‚de‡
_OS__OSBYTEORDER_H


30 
	#_OS__OSBYTEORDER_H


	)

40 
	~<sys/_ty≥s.h
>

43 
	#__DARWIN_OSSw≠C⁄°I¡16
(
x
) \

44 ((
__uöt16_t
)((((__uöt16_t)(
x
) & 0xff00) >> 8) | \

45 (((
__uöt16_t
)(
x
Ë& 0x00ffË<< 8)))

	)

47 
	#__DARWIN_OSSw≠C⁄°I¡32
(
x
) \

48 ((
__uöt32_t
)((((__uöt32_t)(
x
) & 0xff000000) >> 24) | \

49 (((
__uöt32_t
)(
x
) & 0x00ff0000) >> 8) | \

50 (((
__uöt32_t
)(
x
) & 0x0000ff00) << 8) | \

51 (((
__uöt32_t
)(
x
Ë& 0x000000ffË<< 24)))

	)

53 
	#__DARWIN_OSSw≠C⁄°I¡64
(
x
) \

54 ((
__uöt64_t
)((((__uöt64_t)(
x
) & 0xff00000000000000ULL) >> 56) | \

55 (((
__uöt64_t
)(
x
) & 0x00ff000000000000ULL) >> 40) | \

56 (((
__uöt64_t
)(
x
) & 0x0000ff0000000000ULL) >> 24) | \

57 (((
__uöt64_t
)(
x
) & 0x000000ff00000000ULL) >> 8) | \

58 (((
__uöt64_t
)(
x
) & 0x00000000ff000000ULL) << 8) | \

59 (((
__uöt64_t
)(
x
) & 0x0000000000ff0000ULL) << 24) | \

60 (((
__uöt64_t
)(
x
) & 0x000000000000ff00ULL) << 40) | \

61 (((
__uöt64_t
)(
x
Ë& 0x00000000000000ffULLË<< 56)))

	)

63 #i‡
deföed
(
__GNUC__
)

65 #i‡
deföed
(
__i386__
Ë|| deföed(
__x86_64__
)

66 
	~<libkîn/i386/_OSByãOrdî.h
>

69 #i‡
deföed
(
__¨m__
)

70 
	~<libkîn/¨m/OSByãOrdî.h
>

74 
	#__DARWIN_OSSw≠I¡16
(
x
) \

75 ((
__uöt16_t
)(
	`__buûtö_c⁄°™t_p
(
x
Ë? 
	`__DARWIN_OSSw≠C⁄°I¡16
(xË: 
	`_OSSw≠I¡16
(x)))

	)

77 
	#__DARWIN_OSSw≠I¡32
(
x
) \

78 (
	`__buûtö_c⁄°™t_p
(
x
Ë? 
	`__DARWIN_OSSw≠C⁄°I¡32
(xË: 
	`_OSSw≠I¡32
(x))

	)

80 
	#__DARWIN_OSSw≠I¡64
(
x
) \

81 (
	`__buûtö_c⁄°™t_p
(
x
Ë? 
	`__DARWIN_OSSw≠C⁄°I¡64
(xË: 
	`_OSSw≠I¡64
(x))

	)

85 #i‡
deföed
(
__i386__
Ë|| deföed(
__x86_64__
)

87 #i‡!
deföed
(
__DARWIN_OS_INLINE
)

88 #i‡
deföed
(
__STDC_VERSION__
) && __STDC_VERSION__ >= 199901L

89 
	#__DARWIN_OS_INLINE
 
ölöe


	)

90 #ñi‡
deföed
(
__MWERKS__
Ë|| deföed(
__˝lu•lus
)

91 
	#__DARWIN_OS_INLINE
 
ölöe


	)

93 
	#__DARWIN_OS_INLINE
 
__ölöe__


	)

97 
__DARWIN_OS_INLINE


98 
uöt16_t


99 
	$_OSSw≠I¡16
(

100 
uöt16_t
 
d©a


103  
	`__DARWIN_OSSw≠C⁄°I¡16
(
d©a
);

104 
	}
}

106 
__DARWIN_OS_INLINE


107 
uöt32_t


108 
	$_OSSw≠I¡32
(

109 
uöt32_t
 
d©a


112  
	`__DARWIN_OSSw≠C⁄°I¡32
(
d©a
);

113 
	}
}

115 
__DARWIN_OS_INLINE


116 
uöt64_t


117 
	$_OSSw≠I¡64
(

118 
uöt64_t
 
d©a


121  
	`__DARWIN_OSSw≠C⁄°I¡64
(
d©a
);

122 
	}
}

125 
	#__DARWIN_OSSw≠I¡16
(
x
Ë
	`_OSSw≠I¡16
(x)

	)

127 
	#__DARWIN_OSSw≠I¡32
(
x
Ë
	`_OSSw≠I¡32
(x)

	)

129 
	#__DARWIN_OSSw≠I¡64
(
x
Ë
	`_OSSw≠I¡64
(x)

	)

	@/usr/include/mach/i386/_structs.h

32 #i‚def 
_MACH_I386__STRUCTS_H_


33 
	#_MACH_I386__STRUCTS_H_


	)

41 #i‡
__DARWIN_UNIX03


42 
	#_STRUCT_X86_THREAD_STATE32
 
__d¨wö_i386_thªad_°©e


	)

43 
	g_STRUCT_X86_THREAD_STATE32


45 
	g__óx
;

46 
	g__ebx
;

47 
	g__ecx
;

48 
	g__edx
;

49 
	g__edi
;

50 
	g__esi
;

51 
	g__ebp
;

52 
	g__e•
;

53 
	g__ss
;

54 
	g__eÊags
;

55 
	g__eù
;

56 
	g__cs
;

57 
	g__ds
;

58 
	g__es
;

59 
	g__fs
;

60 
	g__gs
;

63 
	#_STRUCT_X86_THREAD_STATE32
 
i386_thªad_°©e


	)

64 
	g_STRUCT_X86_THREAD_STATE32


66 
	góx
;

67 
	gebx
;

68 
	gecx
;

69 
	gedx
;

70 
	gedi
;

71 
	gesi
;

72 
	gebp
;

73 
	ge•
;

74 
	gss
;

75 
	geÊags
;

76 
	geù
;

77 
	gcs
;

78 
	gds
;

79 
	ges
;

80 
	gfs
;

81 
	ggs
;

87 #i‡
__DARWIN_UNIX03


88 
	#_STRUCT_FP_CONTROL
 
__d¨wö_Â_c⁄åﬁ


	)

89 
	g_STRUCT_FP_CONTROL


91 
	g__övÆid
 :1,

92 
	g__dí‹m
 :1,

93 
	g__zdiv
 :1,

94 
	g__ovrÊ
 :1,

95 
	g__undÊ
 :1,

96 
	g__¥ecis
 :1,

98 
	g__pc
 :2,

99 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

100 
	#FP_PREC_24B
 0

	)

101 
	#FP_PREC_53B
 2

	)

102 
	#FP_PREC_64B
 3

	)

104 
	g__rc
 :2,

105 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

106 
	#FP_RND_NEAR
 0

	)

107 
	#FP_RND_DOWN
 1

	)

108 
	#FP_RND_UP
 2

	)

109 
	#FP_CHOP
 3

	)

114 
_STRUCT_FP_CONTROL
 
	t__d¨wö_Â_c⁄åﬁ_t
;

116 
	#_STRUCT_FP_CONTROL
 
Â_c⁄åﬁ


	)

117 
	g_STRUCT_FP_CONTROL


119 
	gövÆid
 :1,

120 
	gdí‹m
 :1,

121 
	gzdiv
 :1,

122 
	govrÊ
 :1,

123 
	gundÊ
 :1,

124 
	g¥ecis
 :1,

126 
	gpc
 :2,

127 
	#FP_PREC_24B
 0

	)

128 
	#FP_PREC_53B
 2

	)

129 
	#FP_PREC_64B
 3

	)

130 
	grc
 :2,

131 
	#FP_RND_NEAR
 0

	)

132 
	#FP_RND_DOWN
 1

	)

133 
	#FP_RND_UP
 2

	)

134 
	#FP_CHOP
 3

	)

138 
_STRUCT_FP_CONTROL
 
	tÂ_c⁄åﬁ_t
;

145 #i‡
__DARWIN_UNIX03


146 
	#_STRUCT_FP_STATUS
 
__d¨wö_Â_°©us


	)

147 
	g_STRUCT_FP_STATUS


149 
	g__övÆid
 :1,

150 
	g__dí‹m
 :1,

151 
	g__zdiv
 :1,

152 
	g__ovrÊ
 :1,

153 
	g__undÊ
 :1,

154 
	g__¥ecis
 :1,

155 
	g__°kÊt
 :1,

156 
	g__îrsumm
 :1,

157 
	g__c0
 :1,

158 
	g__c1
 :1,

159 
	g__c2
 :1,

160 
	g__tos
 :3,

161 
	g__c3
 :1,

162 
	g__busy
 :1;

164 
_STRUCT_FP_STATUS
 
	t__d¨wö_Â_°©us_t
;

166 
	#_STRUCT_FP_STATUS
 
Â_°©us


	)

167 
	g_STRUCT_FP_STATUS


169 
	gövÆid
 :1,

170 
	gdí‹m
 :1,

171 
	gzdiv
 :1,

172 
	govrÊ
 :1,

173 
	gundÊ
 :1,

174 
	g¥ecis
 :1,

175 
	g°kÊt
 :1,

176 
	gîrsumm
 :1,

177 
	gc0
 :1,

178 
	gc1
 :1,

179 
	gc2
 :1,

180 
	gtos
 :3,

181 
	gc3
 :1,

182 
	gbusy
 :1;

184 
_STRUCT_FP_STATUS
 
	tÂ_°©us_t
;

189 #i‡
__DARWIN_UNIX03


190 
	#_STRUCT_MMST_REG
 
__d¨wö_mm°_ªg


	)

191 
	g_STRUCT_MMST_REG


193 
	g__mm°_ªg
[10];

194 
	g__mm°_r§v
[6];

197 
	#_STRUCT_MMST_REG
 
mm°_ªg


	)

198 
	g_STRUCT_MMST_REG


200 
	gmm°_ªg
[10];

201 
	gmm°_r§v
[6];

208 #i‡
__DARWIN_UNIX03


209 
	#_STRUCT_XMM_REG
 
__d¨wö_xmm_ªg


	)

210 
	g_STRUCT_XMM_REG


212 
	g__xmm_ªg
[16];

215 
	#_STRUCT_XMM_REG
 
xmm_ªg


	)

216 
	g_STRUCT_XMM_REG


218 
	gxmm_ªg
[16];

226 #i‡!
deföed
(
_POSIX_C_SOURCE
Ë|| deföed(
_DARWIN_C_SOURCE
)

227 
	#FP_STATE_BYTES
 512

	)

230 #i‡
__DARWIN_UNIX03


231 
	#_STRUCT_X86_FLOAT_STATE32
 
__d¨wö_i386_Êﬂt_°©e


	)

232 
	g_STRUCT_X86_FLOAT_STATE32


234 
	g__Âu_ª£rved
[2];

235 
_STRUCT_FP_CONTROL
 
	g__Âu_fcw
;

236 
_STRUCT_FP_STATUS
 
	g__Âu_fsw
;

237 
__uöt8_t
 
	g__Âu_·w
;

238 
__uöt8_t
 
	g__Âu_r§v1
;

239 
__uöt16_t
 
	g__Âu_f›
;

240 
__uöt32_t
 
	g__Âu_ù
;

241 
__uöt16_t
 
	g__Âu_cs
;

242 
__uöt16_t
 
	g__Âu_r§v2
;

243 
__uöt32_t
 
	g__Âu_dp
;

244 
__uöt16_t
 
	g__Âu_ds
;

245 
__uöt16_t
 
	g__Âu_r§v3
;

246 
__uöt32_t
 
	g__Âu_mxc§
;

247 
__uöt32_t
 
	g__Âu_mxc§mask
;

248 
_STRUCT_MMST_REG
 
	g__Âu_°mm0
;

249 
_STRUCT_MMST_REG
 
	g__Âu_°mm1
;

250 
_STRUCT_MMST_REG
 
	g__Âu_°mm2
;

251 
_STRUCT_MMST_REG
 
	g__Âu_°mm3
;

252 
_STRUCT_MMST_REG
 
	g__Âu_°mm4
;

253 
_STRUCT_MMST_REG
 
	g__Âu_°mm5
;

254 
_STRUCT_MMST_REG
 
	g__Âu_°mm6
;

255 
_STRUCT_MMST_REG
 
	g__Âu_°mm7
;

256 
_STRUCT_XMM_REG
 
	g__Âu_xmm0
;

257 
_STRUCT_XMM_REG
 
	g__Âu_xmm1
;

258 
_STRUCT_XMM_REG
 
	g__Âu_xmm2
;

259 
_STRUCT_XMM_REG
 
	g__Âu_xmm3
;

260 
_STRUCT_XMM_REG
 
	g__Âu_xmm4
;

261 
_STRUCT_XMM_REG
 
	g__Âu_xmm5
;

262 
_STRUCT_XMM_REG
 
	g__Âu_xmm6
;

263 
_STRUCT_XMM_REG
 
	g__Âu_xmm7
;

264 
	g__Âu_r§v4
[14*16];

265 
	g__Âu_ª£rved1
;

268 
	#_STRUCT_X86_AVX_STATE32
 
__d¨wö_i386_avx_°©e


	)

269 
	g_STRUCT_X86_AVX_STATE32


271 
	g__Âu_ª£rved
[2];

272 
_STRUCT_FP_CONTROL
 
	g__Âu_fcw
;

273 
_STRUCT_FP_STATUS
 
	g__Âu_fsw
;

274 
__uöt8_t
 
	g__Âu_·w
;

275 
__uöt8_t
 
	g__Âu_r§v1
;

276 
__uöt16_t
 
	g__Âu_f›
;

277 
__uöt32_t
 
	g__Âu_ù
;

278 
__uöt16_t
 
	g__Âu_cs
;

279 
__uöt16_t
 
	g__Âu_r§v2
;

280 
__uöt32_t
 
	g__Âu_dp
;

281 
__uöt16_t
 
	g__Âu_ds
;

282 
__uöt16_t
 
	g__Âu_r§v3
;

283 
__uöt32_t
 
	g__Âu_mxc§
;

284 
__uöt32_t
 
	g__Âu_mxc§mask
;

285 
_STRUCT_MMST_REG
 
	g__Âu_°mm0
;

286 
_STRUCT_MMST_REG
 
	g__Âu_°mm1
;

287 
_STRUCT_MMST_REG
 
	g__Âu_°mm2
;

288 
_STRUCT_MMST_REG
 
	g__Âu_°mm3
;

289 
_STRUCT_MMST_REG
 
	g__Âu_°mm4
;

290 
_STRUCT_MMST_REG
 
	g__Âu_°mm5
;

291 
_STRUCT_MMST_REG
 
	g__Âu_°mm6
;

292 
_STRUCT_MMST_REG
 
	g__Âu_°mm7
;

293 
_STRUCT_XMM_REG
 
	g__Âu_xmm0
;

294 
_STRUCT_XMM_REG
 
	g__Âu_xmm1
;

295 
_STRUCT_XMM_REG
 
	g__Âu_xmm2
;

296 
_STRUCT_XMM_REG
 
	g__Âu_xmm3
;

297 
_STRUCT_XMM_REG
 
	g__Âu_xmm4
;

298 
_STRUCT_XMM_REG
 
	g__Âu_xmm5
;

299 
_STRUCT_XMM_REG
 
	g__Âu_xmm6
;

300 
_STRUCT_XMM_REG
 
	g__Âu_xmm7
;

301 
	g__Âu_r§v4
[14*16];

302 
	g__Âu_ª£rved1
;

303 
	g__avx_ª£rved1
[64];

304 
_STRUCT_XMM_REG
 
	g__Âu_ymmh0
;

305 
_STRUCT_XMM_REG
 
	g__Âu_ymmh1
;

306 
_STRUCT_XMM_REG
 
	g__Âu_ymmh2
;

307 
_STRUCT_XMM_REG
 
	g__Âu_ymmh3
;

308 
_STRUCT_XMM_REG
 
	g__Âu_ymmh4
;

309 
_STRUCT_XMM_REG
 
	g__Âu_ymmh5
;

310 
_STRUCT_XMM_REG
 
	g__Âu_ymmh6
;

311 
_STRUCT_XMM_REG
 
	g__Âu_ymmh7
;

315 
	#_STRUCT_X86_FLOAT_STATE32
 
i386_Êﬂt_°©e


	)

316 
	g_STRUCT_X86_FLOAT_STATE32


318 
	gÂu_ª£rved
[2];

319 
_STRUCT_FP_CONTROL
 
	gÂu_fcw
;

320 
_STRUCT_FP_STATUS
 
	gÂu_fsw
;

321 
__uöt8_t
 
	gÂu_·w
;

322 
__uöt8_t
 
	gÂu_r§v1
;

323 
__uöt16_t
 
	gÂu_f›
;

324 
__uöt32_t
 
	gÂu_ù
;

325 
__uöt16_t
 
	gÂu_cs
;

326 
__uöt16_t
 
	gÂu_r§v2
;

327 
__uöt32_t
 
	gÂu_dp
;

328 
__uöt16_t
 
	gÂu_ds
;

329 
__uöt16_t
 
	gÂu_r§v3
;

330 
__uöt32_t
 
	gÂu_mxc§
;

331 
__uöt32_t
 
	gÂu_mxc§mask
;

332 
_STRUCT_MMST_REG
 
	gÂu_°mm0
;

333 
_STRUCT_MMST_REG
 
	gÂu_°mm1
;

334 
_STRUCT_MMST_REG
 
	gÂu_°mm2
;

335 
_STRUCT_MMST_REG
 
	gÂu_°mm3
;

336 
_STRUCT_MMST_REG
 
	gÂu_°mm4
;

337 
_STRUCT_MMST_REG
 
	gÂu_°mm5
;

338 
_STRUCT_MMST_REG
 
	gÂu_°mm6
;

339 
_STRUCT_MMST_REG
 
	gÂu_°mm7
;

340 
_STRUCT_XMM_REG
 
	gÂu_xmm0
;

341 
_STRUCT_XMM_REG
 
	gÂu_xmm1
;

342 
_STRUCT_XMM_REG
 
	gÂu_xmm2
;

343 
_STRUCT_XMM_REG
 
	gÂu_xmm3
;

344 
_STRUCT_XMM_REG
 
	gÂu_xmm4
;

345 
_STRUCT_XMM_REG
 
	gÂu_xmm5
;

346 
_STRUCT_XMM_REG
 
	gÂu_xmm6
;

347 
_STRUCT_XMM_REG
 
	gÂu_xmm7
;

348 
	gÂu_r§v4
[14*16];

349 
	gÂu_ª£rved1
;

352 
	#_STRUCT_X86_AVX_STATE32
 
i386_avx_°©e


	)

353 
	g_STRUCT_X86_AVX_STATE32


355 
	gÂu_ª£rved
[2];

356 
_STRUCT_FP_CONTROL
 
	gÂu_fcw
;

357 
_STRUCT_FP_STATUS
 
	gÂu_fsw
;

358 
__uöt8_t
 
	gÂu_·w
;

359 
__uöt8_t
 
	gÂu_r§v1
;

360 
__uöt16_t
 
	gÂu_f›
;

361 
__uöt32_t
 
	gÂu_ù
;

362 
__uöt16_t
 
	gÂu_cs
;

363 
__uöt16_t
 
	gÂu_r§v2
;

364 
__uöt32_t
 
	gÂu_dp
;

365 
__uöt16_t
 
	gÂu_ds
;

366 
__uöt16_t
 
	gÂu_r§v3
;

367 
__uöt32_t
 
	gÂu_mxc§
;

368 
__uöt32_t
 
	gÂu_mxc§mask
;

369 
_STRUCT_MMST_REG
 
	gÂu_°mm0
;

370 
_STRUCT_MMST_REG
 
	gÂu_°mm1
;

371 
_STRUCT_MMST_REG
 
	gÂu_°mm2
;

372 
_STRUCT_MMST_REG
 
	gÂu_°mm3
;

373 
_STRUCT_MMST_REG
 
	gÂu_°mm4
;

374 
_STRUCT_MMST_REG
 
	gÂu_°mm5
;

375 
_STRUCT_MMST_REG
 
	gÂu_°mm6
;

376 
_STRUCT_MMST_REG
 
	gÂu_°mm7
;

377 
_STRUCT_XMM_REG
 
	gÂu_xmm0
;

378 
_STRUCT_XMM_REG
 
	gÂu_xmm1
;

379 
_STRUCT_XMM_REG
 
	gÂu_xmm2
;

380 
_STRUCT_XMM_REG
 
	gÂu_xmm3
;

381 
_STRUCT_XMM_REG
 
	gÂu_xmm4
;

382 
_STRUCT_XMM_REG
 
	gÂu_xmm5
;

383 
_STRUCT_XMM_REG
 
	gÂu_xmm6
;

384 
_STRUCT_XMM_REG
 
	gÂu_xmm7
;

385 
	gÂu_r§v4
[14*16];

386 
	gÂu_ª£rved1
;

387 
	g__avx_ª£rved1
[64];

388 
_STRUCT_XMM_REG
 
	g__Âu_ymmh0
;

389 
_STRUCT_XMM_REG
 
	g__Âu_ymmh1
;

390 
_STRUCT_XMM_REG
 
	g__Âu_ymmh2
;

391 
_STRUCT_XMM_REG
 
	g__Âu_ymmh3
;

392 
_STRUCT_XMM_REG
 
	g__Âu_ymmh4
;

393 
_STRUCT_XMM_REG
 
	g__Âu_ymmh5
;

394 
_STRUCT_XMM_REG
 
	g__Âu_ymmh6
;

395 
_STRUCT_XMM_REG
 
	g__Âu_ymmh7
;

400 #i‡
__DARWIN_UNIX03


401 
	#_STRUCT_X86_EXCEPTION_STATE32
 
__d¨wö_i386_ex˚±i⁄_°©e


	)

402 
	g_STRUCT_X86_EXCEPTION_STATE32


404 
__uöt16_t
 
	g__å≠no
;

405 
__uöt16_t
 
	g__˝u
;

406 
__uöt32_t
 
	g__îr
;

407 
__uöt32_t
 
	g__Áu…vaddr
;

410 
	#_STRUCT_X86_EXCEPTION_STATE32
 
i386_ex˚±i⁄_°©e


	)

411 
	g_STRUCT_X86_EXCEPTION_STATE32


413 
__uöt16_t
 
	gå≠no
;

414 
__uöt16_t
 
	g˝u
;

415 
__uöt32_t
 
	gîr
;

416 
__uöt32_t
 
	gÁu…vaddr
;

420 #i‡
__DARWIN_UNIX03


421 
	#_STRUCT_X86_DEBUG_STATE32
 
__d¨wö_x86_debug_°©e32


	)

422 
	g_STRUCT_X86_DEBUG_STATE32


424 
	g__dr0
;

425 
	g__dr1
;

426 
	g__dr2
;

427 
	g__dr3
;

428 
	g__dr4
;

429 
	g__dr5
;

430 
	g__dr6
;

431 
	g__dr7
;

434 
	#_STRUCT_X86_DEBUG_STATE32
 
x86_debug_°©e32


	)

435 
	g_STRUCT_X86_DEBUG_STATE32


437 
	gdr0
;

438 
	gdr1
;

439 
	gdr2
;

440 
	gdr3
;

441 
	gdr4
;

442 
	gdr5
;

443 
	gdr6
;

444 
	gdr7
;

452 #i‡
__DARWIN_UNIX03


453 
	#_STRUCT_X86_THREAD_STATE64
 
__d¨wö_x86_thªad_°©e64


	)

454 
	g_STRUCT_X86_THREAD_STATE64


456 
__uöt64_t
 
	g__øx
;

457 
__uöt64_t
 
	g__rbx
;

458 
__uöt64_t
 
	g__rcx
;

459 
__uöt64_t
 
	g__rdx
;

460 
__uöt64_t
 
	g__rdi
;

461 
__uöt64_t
 
	g__rsi
;

462 
__uöt64_t
 
	g__rbp
;

463 
__uöt64_t
 
	g__r•
;

464 
__uöt64_t
 
	g__r8
;

465 
__uöt64_t
 
	g__r9
;

466 
__uöt64_t
 
	g__r10
;

467 
__uöt64_t
 
	g__r11
;

468 
__uöt64_t
 
	g__r12
;

469 
__uöt64_t
 
	g__r13
;

470 
__uöt64_t
 
	g__r14
;

471 
__uöt64_t
 
	g__r15
;

472 
__uöt64_t
 
	g__rù
;

473 
__uöt64_t
 
	g__rÊags
;

474 
__uöt64_t
 
	g__cs
;

475 
__uöt64_t
 
	g__fs
;

476 
__uöt64_t
 
	g__gs
;

479 
	#_STRUCT_X86_THREAD_STATE64
 
x86_thªad_°©e64


	)

480 
	g_STRUCT_X86_THREAD_STATE64


482 
__uöt64_t
 
	gøx
;

483 
__uöt64_t
 
	grbx
;

484 
__uöt64_t
 
	grcx
;

485 
__uöt64_t
 
	grdx
;

486 
__uöt64_t
 
	grdi
;

487 
__uöt64_t
 
	grsi
;

488 
__uöt64_t
 
	grbp
;

489 
__uöt64_t
 
	gr•
;

490 
__uöt64_t
 
	gr8
;

491 
__uöt64_t
 
	gr9
;

492 
__uöt64_t
 
	gr10
;

493 
__uöt64_t
 
	gr11
;

494 
__uöt64_t
 
	gr12
;

495 
__uöt64_t
 
	gr13
;

496 
__uöt64_t
 
	gr14
;

497 
__uöt64_t
 
	gr15
;

498 
__uöt64_t
 
	grù
;

499 
__uöt64_t
 
	grÊags
;

500 
__uöt64_t
 
	gcs
;

501 
__uöt64_t
 
	gfs
;

502 
__uöt64_t
 
	ggs
;

507 #i‡
__DARWIN_UNIX03


508 
	#_STRUCT_X86_FLOAT_STATE64
 
__d¨wö_x86_Êﬂt_°©e64


	)

509 
	g_STRUCT_X86_FLOAT_STATE64


511 
	g__Âu_ª£rved
[2];

512 
_STRUCT_FP_CONTROL
 
	g__Âu_fcw
;

513 
_STRUCT_FP_STATUS
 
	g__Âu_fsw
;

514 
__uöt8_t
 
	g__Âu_·w
;

515 
__uöt8_t
 
	g__Âu_r§v1
;

516 
__uöt16_t
 
	g__Âu_f›
;

519 
__uöt32_t
 
	g__Âu_ù
;

520 
__uöt16_t
 
	g__Âu_cs
;

522 
__uöt16_t
 
	g__Âu_r§v2
;

525 
__uöt32_t
 
	g__Âu_dp
;

526 
__uöt16_t
 
	g__Âu_ds
;

528 
__uöt16_t
 
	g__Âu_r§v3
;

529 
__uöt32_t
 
	g__Âu_mxc§
;

530 
__uöt32_t
 
	g__Âu_mxc§mask
;

531 
_STRUCT_MMST_REG
 
	g__Âu_°mm0
;

532 
_STRUCT_MMST_REG
 
	g__Âu_°mm1
;

533 
_STRUCT_MMST_REG
 
	g__Âu_°mm2
;

534 
_STRUCT_MMST_REG
 
	g__Âu_°mm3
;

535 
_STRUCT_MMST_REG
 
	g__Âu_°mm4
;

536 
_STRUCT_MMST_REG
 
	g__Âu_°mm5
;

537 
_STRUCT_MMST_REG
 
	g__Âu_°mm6
;

538 
_STRUCT_MMST_REG
 
	g__Âu_°mm7
;

539 
_STRUCT_XMM_REG
 
	g__Âu_xmm0
;

540 
_STRUCT_XMM_REG
 
	g__Âu_xmm1
;

541 
_STRUCT_XMM_REG
 
	g__Âu_xmm2
;

542 
_STRUCT_XMM_REG
 
	g__Âu_xmm3
;

543 
_STRUCT_XMM_REG
 
	g__Âu_xmm4
;

544 
_STRUCT_XMM_REG
 
	g__Âu_xmm5
;

545 
_STRUCT_XMM_REG
 
	g__Âu_xmm6
;

546 
_STRUCT_XMM_REG
 
	g__Âu_xmm7
;

547 
_STRUCT_XMM_REG
 
	g__Âu_xmm8
;

548 
_STRUCT_XMM_REG
 
	g__Âu_xmm9
;

549 
_STRUCT_XMM_REG
 
	g__Âu_xmm10
;

550 
_STRUCT_XMM_REG
 
	g__Âu_xmm11
;

551 
_STRUCT_XMM_REG
 
	g__Âu_xmm12
;

552 
_STRUCT_XMM_REG
 
	g__Âu_xmm13
;

553 
_STRUCT_XMM_REG
 
	g__Âu_xmm14
;

554 
_STRUCT_XMM_REG
 
	g__Âu_xmm15
;

555 
	g__Âu_r§v4
[6*16];

556 
	g__Âu_ª£rved1
;

559 
	#_STRUCT_X86_AVX_STATE64
 
__d¨wö_x86_avx_°©e64


	)

560 
	g_STRUCT_X86_AVX_STATE64


562 
	g__Âu_ª£rved
[2];

563 
_STRUCT_FP_CONTROL
 
	g__Âu_fcw
;

564 
_STRUCT_FP_STATUS
 
	g__Âu_fsw
;

565 
__uöt8_t
 
	g__Âu_·w
;

566 
__uöt8_t
 
	g__Âu_r§v1
;

567 
__uöt16_t
 
	g__Âu_f›
;

570 
__uöt32_t
 
	g__Âu_ù
;

571 
__uöt16_t
 
	g__Âu_cs
;

573 
__uöt16_t
 
	g__Âu_r§v2
;

576 
__uöt32_t
 
	g__Âu_dp
;

577 
__uöt16_t
 
	g__Âu_ds
;

579 
__uöt16_t
 
	g__Âu_r§v3
;

580 
__uöt32_t
 
	g__Âu_mxc§
;

581 
__uöt32_t
 
	g__Âu_mxc§mask
;

582 
_STRUCT_MMST_REG
 
	g__Âu_°mm0
;

583 
_STRUCT_MMST_REG
 
	g__Âu_°mm1
;

584 
_STRUCT_MMST_REG
 
	g__Âu_°mm2
;

585 
_STRUCT_MMST_REG
 
	g__Âu_°mm3
;

586 
_STRUCT_MMST_REG
 
	g__Âu_°mm4
;

587 
_STRUCT_MMST_REG
 
	g__Âu_°mm5
;

588 
_STRUCT_MMST_REG
 
	g__Âu_°mm6
;

589 
_STRUCT_MMST_REG
 
	g__Âu_°mm7
;

590 
_STRUCT_XMM_REG
 
	g__Âu_xmm0
;

591 
_STRUCT_XMM_REG
 
	g__Âu_xmm1
;

592 
_STRUCT_XMM_REG
 
	g__Âu_xmm2
;

593 
_STRUCT_XMM_REG
 
	g__Âu_xmm3
;

594 
_STRUCT_XMM_REG
 
	g__Âu_xmm4
;

595 
_STRUCT_XMM_REG
 
	g__Âu_xmm5
;

596 
_STRUCT_XMM_REG
 
	g__Âu_xmm6
;

597 
_STRUCT_XMM_REG
 
	g__Âu_xmm7
;

598 
_STRUCT_XMM_REG
 
	g__Âu_xmm8
;

599 
_STRUCT_XMM_REG
 
	g__Âu_xmm9
;

600 
_STRUCT_XMM_REG
 
	g__Âu_xmm10
;

601 
_STRUCT_XMM_REG
 
	g__Âu_xmm11
;

602 
_STRUCT_XMM_REG
 
	g__Âu_xmm12
;

603 
_STRUCT_XMM_REG
 
	g__Âu_xmm13
;

604 
_STRUCT_XMM_REG
 
	g__Âu_xmm14
;

605 
_STRUCT_XMM_REG
 
	g__Âu_xmm15
;

606 
	g__Âu_r§v4
[6*16];

607 
	g__Âu_ª£rved1
;

608 
	g__avx_ª£rved1
[64];

609 
_STRUCT_XMM_REG
 
	g__Âu_ymmh0
;

610 
_STRUCT_XMM_REG
 
	g__Âu_ymmh1
;

611 
_STRUCT_XMM_REG
 
	g__Âu_ymmh2
;

612 
_STRUCT_XMM_REG
 
	g__Âu_ymmh3
;

613 
_STRUCT_XMM_REG
 
	g__Âu_ymmh4
;

614 
_STRUCT_XMM_REG
 
	g__Âu_ymmh5
;

615 
_STRUCT_XMM_REG
 
	g__Âu_ymmh6
;

616 
_STRUCT_XMM_REG
 
	g__Âu_ymmh7
;

617 
_STRUCT_XMM_REG
 
	g__Âu_ymmh8
;

618 
_STRUCT_XMM_REG
 
	g__Âu_ymmh9
;

619 
_STRUCT_XMM_REG
 
	g__Âu_ymmh10
;

620 
_STRUCT_XMM_REG
 
	g__Âu_ymmh11
;

621 
_STRUCT_XMM_REG
 
	g__Âu_ymmh12
;

622 
_STRUCT_XMM_REG
 
	g__Âu_ymmh13
;

623 
_STRUCT_XMM_REG
 
	g__Âu_ymmh14
;

624 
_STRUCT_XMM_REG
 
	g__Âu_ymmh15
;

628 
	#_STRUCT_X86_FLOAT_STATE64
 
x86_Êﬂt_°©e64


	)

629 
	g_STRUCT_X86_FLOAT_STATE64


631 
	gÂu_ª£rved
[2];

632 
_STRUCT_FP_CONTROL
 
	gÂu_fcw
;

633 
_STRUCT_FP_STATUS
 
	gÂu_fsw
;

634 
__uöt8_t
 
	gÂu_·w
;

635 
__uöt8_t
 
	gÂu_r§v1
;

636 
__uöt16_t
 
	gÂu_f›
;

639 
__uöt32_t
 
	gÂu_ù
;

640 
__uöt16_t
 
	gÂu_cs
;

642 
__uöt16_t
 
	gÂu_r§v2
;

645 
__uöt32_t
 
	gÂu_dp
;

646 
__uöt16_t
 
	gÂu_ds
;

648 
__uöt16_t
 
	gÂu_r§v3
;

649 
__uöt32_t
 
	gÂu_mxc§
;

650 
__uöt32_t
 
	gÂu_mxc§mask
;

651 
_STRUCT_MMST_REG
 
	gÂu_°mm0
;

652 
_STRUCT_MMST_REG
 
	gÂu_°mm1
;

653 
_STRUCT_MMST_REG
 
	gÂu_°mm2
;

654 
_STRUCT_MMST_REG
 
	gÂu_°mm3
;

655 
_STRUCT_MMST_REG
 
	gÂu_°mm4
;

656 
_STRUCT_MMST_REG
 
	gÂu_°mm5
;

657 
_STRUCT_MMST_REG
 
	gÂu_°mm6
;

658 
_STRUCT_MMST_REG
 
	gÂu_°mm7
;

659 
_STRUCT_XMM_REG
 
	gÂu_xmm0
;

660 
_STRUCT_XMM_REG
 
	gÂu_xmm1
;

661 
_STRUCT_XMM_REG
 
	gÂu_xmm2
;

662 
_STRUCT_XMM_REG
 
	gÂu_xmm3
;

663 
_STRUCT_XMM_REG
 
	gÂu_xmm4
;

664 
_STRUCT_XMM_REG
 
	gÂu_xmm5
;

665 
_STRUCT_XMM_REG
 
	gÂu_xmm6
;

666 
_STRUCT_XMM_REG
 
	gÂu_xmm7
;

667 
_STRUCT_XMM_REG
 
	gÂu_xmm8
;

668 
_STRUCT_XMM_REG
 
	gÂu_xmm9
;

669 
_STRUCT_XMM_REG
 
	gÂu_xmm10
;

670 
_STRUCT_XMM_REG
 
	gÂu_xmm11
;

671 
_STRUCT_XMM_REG
 
	gÂu_xmm12
;

672 
_STRUCT_XMM_REG
 
	gÂu_xmm13
;

673 
_STRUCT_XMM_REG
 
	gÂu_xmm14
;

674 
_STRUCT_XMM_REG
 
	gÂu_xmm15
;

675 
	gÂu_r§v4
[6*16];

676 
	gÂu_ª£rved1
;

679 
	#_STRUCT_X86_AVX_STATE64
 
x86_avx_°©e64


	)

680 
	g_STRUCT_X86_AVX_STATE64


682 
	gÂu_ª£rved
[2];

683 
_STRUCT_FP_CONTROL
 
	gÂu_fcw
;

684 
_STRUCT_FP_STATUS
 
	gÂu_fsw
;

685 
__uöt8_t
 
	gÂu_·w
;

686 
__uöt8_t
 
	gÂu_r§v1
;

687 
__uöt16_t
 
	gÂu_f›
;

690 
__uöt32_t
 
	gÂu_ù
;

691 
__uöt16_t
 
	gÂu_cs
;

693 
__uöt16_t
 
	gÂu_r§v2
;

696 
__uöt32_t
 
	gÂu_dp
;

697 
__uöt16_t
 
	gÂu_ds
;

699 
__uöt16_t
 
	gÂu_r§v3
;

700 
__uöt32_t
 
	gÂu_mxc§
;

701 
__uöt32_t
 
	gÂu_mxc§mask
;

702 
_STRUCT_MMST_REG
 
	gÂu_°mm0
;

703 
_STRUCT_MMST_REG
 
	gÂu_°mm1
;

704 
_STRUCT_MMST_REG
 
	gÂu_°mm2
;

705 
_STRUCT_MMST_REG
 
	gÂu_°mm3
;

706 
_STRUCT_MMST_REG
 
	gÂu_°mm4
;

707 
_STRUCT_MMST_REG
 
	gÂu_°mm5
;

708 
_STRUCT_MMST_REG
 
	gÂu_°mm6
;

709 
_STRUCT_MMST_REG
 
	gÂu_°mm7
;

710 
_STRUCT_XMM_REG
 
	gÂu_xmm0
;

711 
_STRUCT_XMM_REG
 
	gÂu_xmm1
;

712 
_STRUCT_XMM_REG
 
	gÂu_xmm2
;

713 
_STRUCT_XMM_REG
 
	gÂu_xmm3
;

714 
_STRUCT_XMM_REG
 
	gÂu_xmm4
;

715 
_STRUCT_XMM_REG
 
	gÂu_xmm5
;

716 
_STRUCT_XMM_REG
 
	gÂu_xmm6
;

717 
_STRUCT_XMM_REG
 
	gÂu_xmm7
;

718 
_STRUCT_XMM_REG
 
	gÂu_xmm8
;

719 
_STRUCT_XMM_REG
 
	gÂu_xmm9
;

720 
_STRUCT_XMM_REG
 
	gÂu_xmm10
;

721 
_STRUCT_XMM_REG
 
	gÂu_xmm11
;

722 
_STRUCT_XMM_REG
 
	gÂu_xmm12
;

723 
_STRUCT_XMM_REG
 
	gÂu_xmm13
;

724 
_STRUCT_XMM_REG
 
	gÂu_xmm14
;

725 
_STRUCT_XMM_REG
 
	gÂu_xmm15
;

726 
	gÂu_r§v4
[6*16];

727 
	gÂu_ª£rved1
;

728 
	g__avx_ª£rved1
[64];

729 
_STRUCT_XMM_REG
 
	g__Âu_ymmh0
;

730 
_STRUCT_XMM_REG
 
	g__Âu_ymmh1
;

731 
_STRUCT_XMM_REG
 
	g__Âu_ymmh2
;

732 
_STRUCT_XMM_REG
 
	g__Âu_ymmh3
;

733 
_STRUCT_XMM_REG
 
	g__Âu_ymmh4
;

734 
_STRUCT_XMM_REG
 
	g__Âu_ymmh5
;

735 
_STRUCT_XMM_REG
 
	g__Âu_ymmh6
;

736 
_STRUCT_XMM_REG
 
	g__Âu_ymmh7
;

737 
_STRUCT_XMM_REG
 
	g__Âu_ymmh8
;

738 
_STRUCT_XMM_REG
 
	g__Âu_ymmh9
;

739 
_STRUCT_XMM_REG
 
	g__Âu_ymmh10
;

740 
_STRUCT_XMM_REG
 
	g__Âu_ymmh11
;

741 
_STRUCT_XMM_REG
 
	g__Âu_ymmh12
;

742 
_STRUCT_XMM_REG
 
	g__Âu_ymmh13
;

743 
_STRUCT_XMM_REG
 
	g__Âu_ymmh14
;

744 
_STRUCT_XMM_REG
 
	g__Âu_ymmh15
;

749 #i‡
__DARWIN_UNIX03


750 
	#_STRUCT_X86_EXCEPTION_STATE64
 
__d¨wö_x86_ex˚±i⁄_°©e64


	)

751 
	g_STRUCT_X86_EXCEPTION_STATE64


753 
__uöt16_t
 
	g__å≠no
;

754 
__uöt16_t
 
	g__˝u
;

755 
__uöt32_t
 
	g__îr
;

756 
__uöt64_t
 
	g__Áu…vaddr
;

759 
	#_STRUCT_X86_EXCEPTION_STATE64
 
x86_ex˚±i⁄_°©e64


	)

760 
	g_STRUCT_X86_EXCEPTION_STATE64


762 
__uöt16_t
 
	gå≠no
;

763 
__uöt16_t
 
	g˝u
;

764 
__uöt32_t
 
	gîr
;

765 
__uöt64_t
 
	gÁu…vaddr
;

769 #i‡
__DARWIN_UNIX03


770 
	#_STRUCT_X86_DEBUG_STATE64
 
__d¨wö_x86_debug_°©e64


	)

771 
	g_STRUCT_X86_DEBUG_STATE64


773 
__uöt64_t
 
	g__dr0
;

774 
__uöt64_t
 
	g__dr1
;

775 
__uöt64_t
 
	g__dr2
;

776 
__uöt64_t
 
	g__dr3
;

777 
__uöt64_t
 
	g__dr4
;

778 
__uöt64_t
 
	g__dr5
;

779 
__uöt64_t
 
	g__dr6
;

780 
__uöt64_t
 
	g__dr7
;

783 
	#_STRUCT_X86_DEBUG_STATE64
 
x86_debug_°©e64


	)

784 
	g_STRUCT_X86_DEBUG_STATE64


786 
__uöt64_t
 
	gdr0
;

787 
__uöt64_t
 
	gdr1
;

788 
__uöt64_t
 
	gdr2
;

789 
__uöt64_t
 
	gdr3
;

790 
__uöt64_t
 
	gdr4
;

791 
__uöt64_t
 
	gdr5
;

792 
__uöt64_t
 
	gdr6
;

793 
__uöt64_t
 
	gdr7
;

	@/usr/include/libkern/i386/_OSByteOrder.h

29 #i‚de‡
_OS__OSBYTEORDERI386_H


30 
	#_OS__OSBYTEORDERI386_H


	)

32 #i‡!
deföed
(
__DARWIN_OS_INLINE
)

33 #i‡
deföed
(
__STDC_VERSION__
) && __STDC_VERSION__ >= 199901L

34 
	#__DARWIN_OS_INLINE
 
ölöe


	)

35 #ñi‡
deföed
(
__MWERKS__
Ë|| deföed(
__˝lu•lus
)

36 
	#__DARWIN_OS_INLINE
 
ölöe


	)

38 
	#__DARWIN_OS_INLINE
 
__ölöe__


	)

44 
__DARWIN_OS_INLINE


45 
__uöt16_t


46 
	$_OSSw≠I¡16
(

47 
__uöt16_t
 
_d©a


50  ((
_d©a
 << 8) | (_data >> 8));

51 
	}
}

53 
__DARWIN_OS_INLINE


54 
__uöt32_t


55 
	$_OSSw≠I¡32
(

56 
__uöt32_t
 
_d©a


59 #i‡
	`deföed
(
__Œvm__
)

60  
	`__buûtö_bsw≠32
(
_d©a
);

62 
	`__asm__
 ("bsw≠ %0" : "+r" (
_d©a
));

63  
_d©a
;

65 
	}
}

67 #i‡
deföed
(
__Œvm__
)

68 
__DARWIN_OS_INLINE


69 
__uöt64_t


70 
	$_OSSw≠I¡64
(

71 
__uöt64_t
 
_d©a


74  
	`__buûtö_bsw≠64
(
_d©a
);

75 
	}
}

77 #ñi‡
deföed
(
__i386__
)

78 
__DARWIN_OS_INLINE


79 
__uöt64_t


80 
	$_OSSw≠I¡64
(

81 
__uöt64_t
 
_d©a


84 
	`__asm__
 ("bswap %%eax\n\t"

87 : "+A" (
_d©a
));

88  
_d©a
;

89 
	}
}

90 #ñi‡
deföed
(
__x86_64__
)

91 
__DARWIN_OS_INLINE


92 
__uöt64_t


93 
	$_OSSw≠I¡64
(

94 
__uöt64_t
 
_d©a


97 
	`__asm__
 ("bsw≠ %0" : "+r" (
_d©a
));

98  
_d©a
;

99 
	}
}

101 #îr‹ 
Unknown
 
¨chôe˘uª


	@
1
.
1
/usr/include
373
19125
/Users/ysoh/disksim-4.0-fcl/diskmodel/convert.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/dm.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/dm_config.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/dm_load.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/dm_testsuite.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/dm_types.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/dm.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/dm_config.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/dm_types.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/marshal.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_disk_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_layout_g1_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_layout_g1_zone_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_layout_g2_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_layout_g2_zone_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_layout_g4_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/dm_mech_g1_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/include/diskmodel/modules/modules.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g1.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g1.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g1_load.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g2.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g2.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g2_load.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g4.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g4.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g4_load.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g4_private.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/layout_g4_tools/g4_skews.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/marshal.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/marshal.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/mech_g1.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/mech_g1.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/mech_g1_load.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/mech_g1_private.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/mech_g1_seektime.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_disk_param.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_disk_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g1_param.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g1_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g1_zone_param.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g1_zone_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g2_param.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g2_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g2_zone_param.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g2_zone_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g4_param.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_layout_g4_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_mech_g1_param.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/dm_mech_g1_param.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/modules/modules.h
/Users/ysoh/disksim-4.0-fcl/diskmodel/pbn.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/sqrt.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/driver.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_bogon.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_raw.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_simple.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_simple_0t.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_skew.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_torture.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/layout_track.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/mech_seek.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/template.c
/Users/ysoh/disksim-4.0-fcl/diskmodel/tests/test.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_bus_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_bus_stats_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_cachedev_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_cachemem_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_ctlr_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_ctlr_stats_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_device_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_device_stats_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_disk_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_fcl_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_global_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_iodriver_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_iodriver_stats_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_iomap_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_ioqueue_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_iosim_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_logorg_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_pf_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_pf_stats_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_simpledisk_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_stats_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_syncset_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_synthgen_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/disksim_synthio_param.h
/Users/ysoh/disksim-4.0-fcl/include/disksim/modules/modules.h
/Users/ysoh/disksim-4.0-fcl/include/disksim_interface.h
/Users/ysoh/disksim-4.0-fcl/libddbg/ddbg_assert.c
/Users/ysoh/disksim-4.0-fcl/libddbg/ddbg_trace.c
/Users/ysoh/disksim-4.0-fcl/libddbg/include/libddbg/libddbg.h
/Users/ysoh/disksim-4.0-fcl/libddbg/libddbg.h
/Users/ysoh/disksim-4.0-fcl/libddbg/test.c
/Users/ysoh/disksim-4.0-fcl/libparam/bitvector.h
/Users/ysoh/disksim-4.0-fcl/libparam/include/libparam/bitvector.h
/Users/ysoh/disksim-4.0-fcl/libparam/include/libparam/libparam.h
/Users/ysoh/disksim-4.0-fcl/libparam/lex.libparam.c
/Users/ysoh/disksim-4.0-fcl/libparam/libparam.h
/Users/ysoh/disksim-4.0-fcl/libparam/libparam.tab.c
/Users/ysoh/disksim-4.0-fcl/libparam/libparam.tab.h
/Users/ysoh/disksim-4.0-fcl/libparam/myutil.c
/Users/ysoh/disksim-4.0-fcl/libparam/util.c
/Users/ysoh/disksim-4.0-fcl/list/hash.c
/Users/ysoh/disksim-4.0-fcl/list/list.h
/Users/ysoh/disksim-4.0-fcl/list/list_sort.c
/Users/ysoh/disksim-4.0-fcl/list/list_sort.h
/Users/ysoh/disksim-4.0-fcl/list/test_list.c
/Users/ysoh/disksim-4.0-fcl/list/types.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_buffer.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_disksim.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_global.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_internals.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_mapping.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/mems_piecewise_seek.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/modules/memsmodel_mems_param.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/include/memsmodel/modules/modules.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_buffer.c
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_buffer.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_disksim.c
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_disksim.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_event.c
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_global.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_hong_seek.c
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_hong_seek.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_internals.c
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_internals.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_mapping.c
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_mapping.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_piecewise_seek.c
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_piecewise_seek.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/mems_seektest.c
/Users/ysoh/disksim-4.0-fcl/memsmodel/modules/memsmodel_mems_param.c
/Users/ysoh/disksim-4.0-fcl/memsmodel/modules/memsmodel_mems_param.h
/Users/ysoh/disksim-4.0-fcl/memsmodel/modules/modules.h
/Users/ysoh/disksim-4.0-fcl/src/config.h
/Users/ysoh/disksim-4.0-fcl/src/disksim.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_assertlib.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_bitstring.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_bus.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_bus.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_cache.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_cache.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_cachedev.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_cachedev.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_cachemem.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_cachemem.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_controller.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_controller.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_ctlr.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_ctlrdumb.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_ctlrsmart.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_device.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_device.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_disk.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_disk.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_diskcache.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_diskctlr.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_diskmap.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_bgclock.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_bglru.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_cache.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_clock_cache.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_ghost_cache.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_lru.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_map.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_map.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_rw_cache.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_seq_detect.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_wow_driver.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_fcl_wow_driver.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_global.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_hptrace.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_interface.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_interface.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_interface_private.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_intr.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_iodriver.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_iodriver.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_ioface.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_ioqueue.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_ioqueue.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_iosim.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_iosim.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_iotrace.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_iotrace.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_loadparams.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_logorg.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_logorg.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_main.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_malloc.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_malloc.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_orgface.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_pfdisp.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_pfface.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_pfsim.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_pfsim.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_rand48.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_rand48.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_redun.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_reqflags.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_simpledisk.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_simpledisk.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_stat.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_stat.h
/Users/ysoh/disksim-4.0-fcl/src/disksim_statload.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_synthio.c
/Users/ysoh/disksim-4.0-fcl/src/disksim_synthio.h
/Users/ysoh/disksim-4.0-fcl/src/hplcomb.c
/Users/ysoh/disksim-4.0-fcl/src/inline.h
/Users/ysoh/disksim-4.0-fcl/src/inst.h
/Users/ysoh/disksim-4.0-fcl/src/list.h
/Users/ysoh/disksim-4.0-fcl/src/lru_test.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_bus_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_bus_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_bus_stats_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_bus_stats_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_cachedev_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_cachedev_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_cachemem_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_cachemem_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ctlr_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ctlr_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ctlr_stats_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ctlr_stats_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_device_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_device_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_device_stats_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_device_stats_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_disk_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_disk_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_fcl_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_fcl_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_global_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_global_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iodriver_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iodriver_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iodriver_stats_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iodriver_stats_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iomap_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iomap_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ioqueue_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_ioqueue_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iosim_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_iosim_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_logorg_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_logorg_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_pf_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_pf_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_pf_stats_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_pf_stats_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_simpledisk_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_simpledisk_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_stats_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_stats_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_syncset_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_syncset_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_synthgen_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_synthgen_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_synthio_param.c
/Users/ysoh/disksim-4.0-fcl/src/modules/disksim_synthio_param.h
/Users/ysoh/disksim-4.0-fcl/src/modules/modules.h
/Users/ysoh/disksim-4.0-fcl/src/poison.h
/Users/ysoh/disksim-4.0-fcl/src/raw_layout.c
/Users/ysoh/disksim-4.0-fcl/src/rms.c
/Users/ysoh/disksim-4.0-fcl/src/syssim_driver.c
/Users/ysoh/disksim-4.0-fcl/src/syssim_driver.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/include/ssdmodel/modules/modules.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/include/ssdmodel/modules/ssdmodel_ssd_param.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/include/ssdmodel/ssd.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/modules/modules.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/modules/ssdmodel_ssd_param.c
/Users/ysoh/disksim-4.0-fcl/ssdmodel/modules/ssdmodel_ssd_param.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/old/ssd_param.c
/Users/ysoh/disksim-4.0-fcl/ssdmodel/old/ssd_param.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd.c
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_clean.c
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_clean.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_gang.c
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_gang.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_init.c
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_init.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_timing.c
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_timing.h
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_utils.c
/Users/ysoh/disksim-4.0-fcl/ssdmodel/ssd_utils.h
/Users/ysoh/disksim-4.0-fcl/utils/params/libparam_to_v3.c
/Users/ysoh/disksim-4.0-fcl/utils/params/merge_blocks.c
/Users/ysoh/disksim-4.0-fcl/w32build/deprecated/deprecated.c
/usr/include/alloca.h
/usr/include/assert.h
/usr/include/cache.h
/usr/include/ctype.h
/usr/include/errno.h
/usr/include/fcntl.h
/usr/include/getopt.h
/usr/include/inttypes.h
/usr/include/libgen.h
/usr/include/math.h
/usr/include/signal.h
/usr/include/stddef.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/string.h
/usr/include/sys/malloc.h
/usr/include/sys/mman.h
/usr/include/sys/stat.h
/usr/include/sys/time.h
/usr/include/sys/types.h
/usr/include/syslog.h
/usr/include/time.h
/usr/include/unistd.h
memsmodel/mems_disksim.h
memsmodel/mems_global.h
memsmodel/modules/modules.h
ssdmodel/ssd.h
/usr/include/Availability.h
/usr/include/TargetConditionals.h
/usr/include/_structs.h
/usr/include/_types.h
/usr/include/_xlocale.h
/usr/include/architecture/i386/math.h
/usr/include/architecture/ppc/math.h
/usr/include/machine/_limits.h
/usr/include/machine/endian.h
/usr/include/machine/types.h
/usr/include/runetype.h
/usr/include/secure/_stdio.h
/usr/include/secure/_string.h
/usr/include/stdbool.h
/usr/include/stdint.h
/usr/include/strings.h
/usr/include/sys/_select.h
/usr/include/sys/_structs.h
/usr/include/sys/_types.h
/usr/include/sys/appleapiopts.h
/usr/include/sys/cdefs.h
/usr/include/sys/errno.h
/usr/include/sys/fcntl.h
/usr/include/sys/select.h
/usr/include/sys/signal.h
/usr/include/sys/syslog.h
/usr/include/sys/unistd.h
/usr/include/sys/wait.h
/usr/include/xlocale/_ctype.h
/usr/include/xlocale/_inttypes.h
/usr/include/xlocale/_stdio.h
/usr/include/xlocale/_stdlib.h
/usr/include/xlocale/_string.h
/usr/include/xlocale/_time.h
/usr/include/AvailabilityInternal.h
/usr/include/AvailabilityMacros.h
/usr/include/i386/_limits.h
/usr/include/i386/endian.h
/usr/include/i386/types.h
/usr/include/machine/_structs.h
/usr/include/machine/_types.h
/usr/include/machine/signal.h
/usr/include/secure/_common.h
/usr/include/sys/_posix_availability.h
/usr/include/sys/_symbol_aliasing.h
/usr/include/sys/resource.h
/usr/include/i386/_structs.h
/usr/include/i386/_types.h
/usr/include/i386/signal.h
/usr/include/sys/_endian.h
/usr/include/libkern/_OSByteOrder.h
/usr/include/mach/i386/_structs.h
/usr/include/libkern/i386/_OSByteOrder.h
